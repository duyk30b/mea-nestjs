/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ([
/* 0 */,
/* 1 */
/***/ ((module) => {

module.exports = require("@fastify/cors");

/***/ }),
/* 2 */
/***/ ((module) => {

module.exports = require("@fastify/helmet");

/***/ }),
/* 3 */
/***/ ((module) => {

module.exports = require("@nestjs/common");

/***/ }),
/* 4 */
/***/ ((module) => {

module.exports = require("@nestjs/core");

/***/ }),
/* 5 */
/***/ ((module) => {

module.exports = require("@nestjs/platform-fastify");

/***/ }),
/* 6 */
/***/ ((module) => {

module.exports = require("@nestjs/swagger");

/***/ }),
/* 7 */
/***/ ((module) => {

module.exports = require("fastify-multer");

/***/ }),
/* 8 */
/***/ ((module) => {

module.exports = require("request-ip");

/***/ }),
/* 9 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ServerExceptionFilter = exports.BusinessException = exports.ValidationException = void 0;
const common_1 = __webpack_require__(3);
const throttler_1 = __webpack_require__(10);
const nestjs_i18n_1 = __webpack_require__(11);
const rxjs_1 = __webpack_require__(12);
const url = __webpack_require__(13);
const error_1 = __webpack_require__(14);
class ValidationException extends Error {
    constructor(validationErrors = []) {
        const getMessageError = (validate) => {
            return validate
                .map((i) => {
                if (i.constraints)
                    return Object.values(i.constraints).join('. ');
                if (i.children)
                    return getMessageError(i.children);
                return '---------';
            })
                .join('. ');
        };
        const msg = getMessageError(validationErrors);
        super(msg);
        this.errors = validationErrors;
    }
}
exports.ValidationException = ValidationException;
class BusinessException extends Error {
    constructor(message, args = {}, statusCode = common_1.HttpStatus.BAD_REQUEST) {
        super(message);
        this.statusCode = statusCode;
        this.args = args;
    }
    static create(options) {
        const { message, args, statusCode, details } = options;
        const exception = new BusinessException(message, args, statusCode);
        exception.details = details;
        return exception;
    }
}
exports.BusinessException = BusinessException;
let ServerExceptionFilter = class ServerExceptionFilter {
    catch(exception, host) {
        var _a, _b, _c;
        let statusCode = common_1.HttpStatus.INTERNAL_SERVER_ERROR;
        let { message } = exception;
        const { stack } = exception;
        let details = undefined;
        common_1.Logger.error(stack);
        const errors = exception.errors || [];
        const i18n = nestjs_i18n_1.I18nContext.current(host);
        switch (exception['constructor'].name) {
            case error_1.BusinessError.name: {
                statusCode = common_1.HttpStatus.BAD_REQUEST;
                break;
            }
            case ValidationException.name: {
                statusCode = common_1.HttpStatus.UNPROCESSABLE_ENTITY;
                break;
            }
            case BusinessException.name: {
                const businessException = exception;
                message = i18n.translate(exception.message, {
                    args: businessException.args,
                });
                statusCode = businessException.statusCode;
                details = businessException.details;
                break;
            }
            case throttler_1.ThrottlerException.name: {
                statusCode = common_1.HttpStatus.TOO_MANY_REQUESTS;
                message = i18n.translate('common.TooManyRequests');
                break;
            }
            case common_1.NotFoundException.name: {
                statusCode = common_1.HttpStatus.NOT_FOUND;
                break;
            }
            case common_1.ForbiddenException.name: {
                statusCode = common_1.HttpStatus.FORBIDDEN;
                message = i18n.translate('common.Forbidden');
                break;
            }
            case common_1.HttpException.name: {
                statusCode = exception.status;
                message = i18n.translate(exception.message, {});
                break;
            }
        }
        const [req, res] = host.getArgs();
        if (host.getType() === 'http') {
            const ctx = host.switchToHttp();
            const response = ctx.getResponse();
            const request = ctx.getRequest();
            const { external } = request.raw;
            const { originalUrl, method, body } = request;
            const urlParse = url.parse(originalUrl, true);
            const basicExternal = {
                ip: external.ip,
                browser: external.browser,
                mobile: external.mobile,
                uid: external.uid,
                oid: external.oid,
                username: (_a = external.user) === null || _a === void 0 ? void 0 : _a.username,
                phone: (_b = external.organization) === null || _b === void 0 ? void 0 : _b.phone,
                email: (_c = external.organization) === null || _c === void 0 ? void 0 : _c.email,
            };
            const logMessage = JSON.stringify({
                statusCode,
                message,
                type: '[HTTP]',
                method,
                path: urlParse.pathname,
                query: urlParse.query,
                errors,
                body,
                external: basicExternal,
            });
            if (statusCode === common_1.HttpStatus.UNPROCESSABLE_ENTITY) {
                common_1.Logger.warn(logMessage, exception.name);
            }
            else if (statusCode === common_1.HttpStatus.NOT_FOUND) {
                common_1.Logger.debug(logMessage, exception.name);
            }
            else {
                common_1.Logger.error(logMessage, exception.name);
            }
            return response.code(statusCode).send({
                statusCode,
                errors,
                message,
                details,
                path: originalUrl,
                time: new Date().toISOString(),
            });
        }
        else if (host.getType() === 'rpc') {
            if (res.constructor.name === 'NatsContext') {
                const response = res;
                const info = {
                    statusCode,
                    message,
                    errors,
                    details: {
                        subject: response.getSubject(),
                        request: req,
                        stack,
                    },
                };
                return (0, rxjs_1.from)([info]);
            }
            else if (res.constructor.name === 'KafkaContext') {
                const response = res;
                const info = {
                    statusCode,
                    message,
                    errors,
                    details: {
                        topic: response.getTopic(),
                        partition: response.getPartition(),
                        offset: response.getMessage().offset,
                        request: req,
                    },
                };
                return (0, rxjs_1.from)([info]);
            }
        }
    }
};
exports.ServerExceptionFilter = ServerExceptionFilter;
exports.ServerExceptionFilter = ServerExceptionFilter = __decorate([
    (0, common_1.Catch)(Error)
], ServerExceptionFilter);


/***/ }),
/* 10 */
/***/ ((module) => {

module.exports = require("@nestjs/throttler");

/***/ }),
/* 11 */
/***/ ((module) => {

module.exports = require("nestjs-i18n");

/***/ }),
/* 12 */
/***/ ((module) => {

module.exports = require("rxjs");

/***/ }),
/* 13 */
/***/ ((module) => {

module.exports = require("url");

/***/ }),
/* 14 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BusinessError = void 0;
class BusinessError extends Error {
    constructor(...messages) {
        super(messages.join(' '));
    }
}
exports.BusinessError = BusinessError;


/***/ }),
/* 15 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootGuard = exports.IsRoot = exports.ROOT_GUARD = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const exception_filter_1 = __webpack_require__(9);
exports.ROOT_GUARD = 'ROOT_GUARD';
const IsRoot = () => (0, common_1.SetMetadata)(exports.ROOT_GUARD, true);
exports.IsRoot = IsRoot;
let RootGuard = class RootGuard {
    constructor(reflector) {
        this.reflector = reflector;
    }
    async canActivate(context) {
        const requireRoot = this.reflector.getAllAndOverride(exports.ROOT_GUARD, [
            context.getHandler(),
            context.getClass(),
        ]);
        if (!requireRoot)
            return true;
        const request = context.switchToHttp().getRequest();
        const { external } = request.raw;
        if (!external.uid
            || !external.oid
            || !external.user
            || !external.organization
            || !!external.user.deletedAt
            || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        return external.oid === 1;
    }
};
exports.RootGuard = RootGuard;
exports.RootGuard = RootGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object])
], RootGuard);


/***/ }),
/* 16 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Organization_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const image_entity_1 = __webpack_require__(19);
const user_entity_1 = __webpack_require__(20);
var OrganizationStatus;
(function (OrganizationStatus) {
    OrganizationStatus[OrganizationStatus["Inactive"] = 0] = "Inactive";
    OrganizationStatus[OrganizationStatus["Active"] = 1] = "Active";
    OrganizationStatus[OrganizationStatus["Frequent"] = 2] = "Frequent";
})(OrganizationStatus || (exports.OrganizationStatus = OrganizationStatus = {}));
let Organization = Organization_1 = class Organization {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Organization_1();
        Object.assign(entity, raw);
        entity.createdAt = raw.createdAt == null ? raw.createdAt : Number(raw.createdAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Organization_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Organization.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: false }),
    __metadata("design:type", String)
], Organization.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "email", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Organization.prototype, "facebook", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "emailVerify", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', default: JSON.stringify({}) }),
    __metadata("design:type", String)
], Organization.prototype, "dataVersion", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    __metadata("design:type", Number)
], Organization.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Organization.prototype, "logoImageId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressProvince", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressDistrict", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressWard", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '[]' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Organization.prototype, "permissionIds", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], Organization.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.OneToOne)(() => image_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'logoImageId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof image_entity_1.default !== "undefined" && image_entity_1.default) === "function" ? _a : Object)
], Organization.prototype, "logoImage", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => user_entity_1.default, (user) => user.organization),
    __metadata("design:type", Array)
], Organization.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Organization.prototype, "dataVersionParse", void 0);
Organization = Organization_1 = __decorate([
    (0, typeorm_1.Entity)('Organization'),
    (0, typeorm_1.Index)('IDX_Organization__phone', ['phone'], { unique: true }),
    (0, typeorm_1.Index)('IDX_Organization__email', ['email'], { unique: true })
], Organization);
exports["default"] = Organization;


/***/ }),
/* 17 */
/***/ ((module) => {

module.exports = require("class-transformer");

/***/ }),
/* 18 */
/***/ ((module) => {

module.exports = require("typeorm");

/***/ }),
/* 19 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Image_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageHost = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
var ImageHost;
(function (ImageHost) {
    ImageHost["GoogleDriver"] = "GoogleDriver";
})(ImageHost || (exports.ImageHost = ImageHost = {}));
let Image = Image_1 = class Image {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Image_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Image_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Image.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Image.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "mimeType", void 0);
__decorate([
    (0, typeorm_1.Column)({}),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "size", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: ImageHost.GoogleDriver }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "hostType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "hostAccount", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "hostId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "waitDelete", void 0);
Image = Image_1 = __decorate([
    (0, typeorm_1.Entity)('Image')
], Image);
exports["default"] = Image;


/***/ }),
/* 20 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var User_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGroup = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const organization_entity_1 = __webpack_require__(16);
const user_role_entity_1 = __webpack_require__(22);
var UserGroup;
(function (UserGroup) {
    UserGroup["ROOT"] = "ROOT";
})(UserGroup || (exports.UserGroup = UserGroup = {}));
let User = User_1 = class User {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new User_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => User_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], User.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], User.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], User.prototype, "username", void 0);
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)({ name: 'hashPassword', type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], User.prototype, "hashPassword", void 0);
__decorate([
    (0, class_transformer_1.Expose)({ groups: [UserGroup.ROOT] }),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "secret", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "fullName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "birthday", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], User.prototype, "gender", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    __metadata("design:type", Number)
], User.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    __metadata("design:type", Number)
], User.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "deletedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => organization_entity_1.default, (organization) => organization.userList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'oid', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof organization_entity_1.default !== "undefined" && organization_entity_1.default) === "function" ? _b : Object)
], User.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)((type) => user_role_entity_1.default, (userRole) => userRole.user),
    __metadata("design:type", Array)
], User.prototype, "userRoleList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], User.prototype, "devices", void 0);
User = User_1 = __decorate([
    (0, typeorm_1.Entity)('User')
], User);
exports["default"] = User;


/***/ }),
/* 21 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryStatus = exports.AttributeLayoutType = exports.AttributeInputType = exports.DeliveryStatus = exports.MovementType = exports.PickupStrategy = exports.PaymentType = exports.DiscountType = exports.EOrder = exports.ERole = exports.EGender = void 0;
var EGender;
(function (EGender) {
    EGender[EGender["Female"] = 0] = "Female";
    EGender[EGender["Male"] = 1] = "Male";
})(EGender || (exports.EGender = EGender = {}));
var ERole;
(function (ERole) {
    ERole[ERole["Root"] = 0] = "Root";
    ERole[ERole["Admin"] = 1] = "Admin";
    ERole[ERole["User"] = 2] = "User";
})(ERole || (exports.ERole = ERole = {}));
var EOrder;
(function (EOrder) {
    EOrder[EOrder["ASC"] = 0] = "ASC";
    EOrder[EOrder["DESC"] = 1] = "DESC";
})(EOrder || (exports.EOrder = EOrder = {}));
var DiscountType;
(function (DiscountType) {
    DiscountType["Percent"] = "%";
    DiscountType["VND"] = "VN\u0110";
})(DiscountType || (exports.DiscountType = DiscountType = {}));
var PaymentType;
(function (PaymentType) {
    PaymentType[PaymentType["Prepayment"] = 1] = "Prepayment";
    PaymentType[PaymentType["ReceiveRefund"] = 2] = "ReceiveRefund";
    PaymentType[PaymentType["Close"] = 3] = "Close";
    PaymentType[PaymentType["PayDebt"] = 4] = "PayDebt";
    PaymentType[PaymentType["Reopen"] = 5] = "Reopen";
})(PaymentType || (exports.PaymentType = PaymentType = {}));
var PickupStrategy;
(function (PickupStrategy) {
    PickupStrategy[PickupStrategy["Inherit"] = -1] = "Inherit";
    PickupStrategy[PickupStrategy["NoImpact"] = 0] = "NoImpact";
    PickupStrategy[PickupStrategy["RequireBatchSelection"] = 1] = "RequireBatchSelection";
    PickupStrategy[PickupStrategy["AutoWithFIFO"] = 2] = "AutoWithFIFO";
    PickupStrategy[PickupStrategy["AutoWithExpiryDate"] = 3] = "AutoWithExpiryDate";
})(PickupStrategy || (exports.PickupStrategy = PickupStrategy = {}));
var MovementType;
(function (MovementType) {
    MovementType[MovementType["Receipt"] = 1] = "Receipt";
    MovementType[MovementType["Ticket"] = 2] = "Ticket";
    MovementType[MovementType["UserChange"] = 3] = "UserChange";
    MovementType[MovementType["StockCheck"] = 4] = "StockCheck";
})(MovementType || (exports.MovementType = MovementType = {}));
var DeliveryStatus;
(function (DeliveryStatus) {
    DeliveryStatus[DeliveryStatus["NoStock"] = 1] = "NoStock";
    DeliveryStatus[DeliveryStatus["Pending"] = 2] = "Pending";
    DeliveryStatus[DeliveryStatus["Delivered"] = 3] = "Delivered";
})(DeliveryStatus || (exports.DeliveryStatus = DeliveryStatus = {}));
var AttributeInputType;
(function (AttributeInputType) {
    AttributeInputType["InputText"] = "InputText";
    AttributeInputType["InputNumber"] = "InputNumber";
    AttributeInputType["InputDate"] = "InputDate";
    AttributeInputType["Select"] = "Select";
})(AttributeInputType || (exports.AttributeInputType = AttributeInputType = {}));
var AttributeLayoutType;
(function (AttributeLayoutType) {
    AttributeLayoutType["Table"] = "B\u1EA3ng";
    AttributeLayoutType["InputAndLabelTop"] = "Input v\u00E0 Nh\u00E3n b\u00EAn tr\u00EAn";
    AttributeLayoutType["InputAndLabelLeft"] = "Input v\u00E0 Nh\u00E3n b\u00EAn tr\u00E1i";
})(AttributeLayoutType || (exports.AttributeLayoutType = AttributeLayoutType = {}));
var TicketLaboratoryStatus;
(function (TicketLaboratoryStatus) {
    TicketLaboratoryStatus[TicketLaboratoryStatus["Empty"] = 1] = "Empty";
    TicketLaboratoryStatus[TicketLaboratoryStatus["Pending"] = 2] = "Pending";
    TicketLaboratoryStatus[TicketLaboratoryStatus["Completed"] = 3] = "Completed";
})(TicketLaboratoryStatus || (exports.TicketLaboratoryStatus = TicketLaboratoryStatus = {}));


/***/ }),
/* 22 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var UserRole_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const role_entity_1 = __webpack_require__(23);
const user_entity_1 = __webpack_require__(20);
let UserRole = UserRole_1 = class UserRole {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new UserRole_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => UserRole_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], UserRole.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "userId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, (role) => role.userRoleList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _a : Object)
], UserRole.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, (user) => user.userRoleList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'userId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _b : Object)
], UserRole.prototype, "user", void 0);
UserRole = UserRole_1 = __decorate([
    (0, typeorm_1.Entity)('UserRole')
], UserRole);
exports["default"] = UserRole;


/***/ }),
/* 23 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Role_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const user_role_entity_1 = __webpack_require__(22);
let Role = Role_1 = class Role {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Role_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Role_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Role.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "roleCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '[]' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "permissionIds", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => user_role_entity_1.default, (userRole) => userRole.role),
    __metadata("design:type", Array)
], Role.prototype, "userRoleList", void 0);
Role = Role_1 = __decorate([
    (0, typeorm_1.Entity)('Role')
], Role);
exports["default"] = Role;


/***/ }),
/* 24 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGuard = exports.IsUser = exports.USER_GUARD = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const exception_filter_1 = __webpack_require__(9);
exports.USER_GUARD = 'USER_GUARD';
const IsUser = () => (0, common_1.SetMetadata)(exports.USER_GUARD, true);
exports.IsUser = IsUser;
let UserGuard = class UserGuard {
    constructor(reflector) {
        this.reflector = reflector;
    }
    async canActivate(context) {
        const requireUser = this.reflector.getAllAndOverride(exports.USER_GUARD, [
            context.getHandler(),
            context.getClass(),
        ]);
        if (!requireUser)
            return true;
        const request = context.switchToHttp().getRequest();
        const { external } = request.raw;
        if (external.error) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!external.uid
            || !external.oid
            || !external.user
            || !external.organization
            || !!external.user.deletedAt
            || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('error.Token.AccessTokenExpired', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        return true;
    }
};
exports.UserGuard = UserGuard;
exports.UserGuard = UserGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object])
], UserGuard);


/***/ }),
/* 25 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AccessLogInterceptor = void 0;
const common_1 = __webpack_require__(3);
const rxjs_1 = __webpack_require__(12);
const operators_1 = __webpack_require__(26);
const url = __webpack_require__(13);
const exception_filter_1 = __webpack_require__(9);
let AccessLogInterceptor = class AccessLogInterceptor {
    constructor(logger = new common_1.Logger('ACCESS_LOG')) {
        this.logger = logger;
    }
    intercept(context, next) {
        var _a, _b, _c;
        const createTime = new Date();
        const className = context.getClass().name;
        const funcName = context.getHandler().name;
        const [req, res] = context.getArgs();
        const showData = true;
        const message = {};
        if (context.getType() === 'http') {
            const ctx = context.switchToHttp();
            const request = ctx.getRequest();
            const { external } = request.raw;
            const basicExternal = {
                ip: external.ip,
                browser: external.browser,
                mobile: external.mobile,
                uid: external.uid,
                oid: external.oid,
                username: (_a = external.user) === null || _a === void 0 ? void 0 : _a.username,
                phone: (_b = external.organization) === null || _b === void 0 ? void 0 : _b.phone,
                email: (_c = external.organization) === null || _c === void 0 ? void 0 : _c.email,
            };
            const urlParse = url.parse(request.originalUrl, true);
            if (basicExternal.oid) {
                message.OID = basicExternal.oid;
            }
            message.type = '[API]';
            message.method = request.method;
            message.url = `${request.protocol}://${request.raw.hostname}${urlParse.pathname}`;
            message.query = urlParse.query;
            message.className = className;
            message.funcName = funcName;
            message.external = basicExternal;
            if (showData) {
                message.body = request.body;
            }
        }
        else if (context.getType() === 'rpc') {
            if (res.constructor.name === 'NatsContext') {
                const response = res;
                message.type = '[NATS]';
                message.subject = response.getSubject();
                message.className = className;
                message.funcName = funcName;
                if (showData) {
                    message.request = req;
                }
            }
            if (res.constructor.name === 'KafkaContext') {
                const response = res;
                message.type = '[KAFKA]';
                message.topic = response.getTopic();
                message.partition = response.getPartition();
                message.offset = response.getMessage().offset;
                message.className = className;
                message.funcName = funcName;
                if (showData) {
                    message.request = req;
                }
                message.topicInfo = {
                    topic: response.getTopic(),
                    partition: response.getPartition(),
                    offset: response.getMessage().offset,
                };
            }
        }
        return next.handle().pipe((0, operators_1.catchError)((err) => {
            message.errorMessage = err.message;
            message.time = `${Date.now() - createTime.getTime()}ms`;
            if (err instanceof exception_filter_1.ValidationException) {
                message.errors = err.errors;
                this.logger.warn(JSON.stringify(message));
            }
            else {
                this.logger.error(JSON.stringify(message));
            }
            return (0, rxjs_1.throwError)(() => err);
        }), (0, operators_1.tap)((xx) => {
            message.time = `${Date.now() - createTime.getTime()}ms`;
            this.logger.log(JSON.stringify(message));
        }));
    }
};
exports.AccessLogInterceptor = AccessLogInterceptor;
exports.AccessLogInterceptor = AccessLogInterceptor = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Object])
], AccessLogInterceptor);


/***/ }),
/* 26 */
/***/ ((module) => {

module.exports = require("rxjs/operators");

/***/ }),
/* 27 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TimeoutInterceptor = void 0;
const common_1 = __webpack_require__(3);
const rxjs_1 = __webpack_require__(12);
const operators_1 = __webpack_require__(26);
let TimeoutInterceptor = class TimeoutInterceptor {
    intercept(context, next) {
        return next.handle().pipe((0, operators_1.timeout)(10000), (0, operators_1.catchError)((err) => {
            if (err instanceof rxjs_1.TimeoutError) {
                return (0, rxjs_1.throwError)(() => new common_1.RequestTimeoutException());
            }
            return (0, rxjs_1.throwError)(() => err);
        }));
    }
};
exports.TimeoutInterceptor = TimeoutInterceptor;
exports.TimeoutInterceptor = TimeoutInterceptor = __decorate([
    (0, common_1.Injectable)()
], TimeoutInterceptor);


/***/ }),
/* 28 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TransformResponseInterceptor = void 0;
const common_1 = __webpack_require__(3);
const nestjs_i18n_1 = __webpack_require__(11);
const operators_1 = __webpack_require__(26);
let TransformResponseInterceptor = class TransformResponseInterceptor {
    intercept(context, next) {
        const i18n = nestjs_i18n_1.I18nContext.current();
        return next.handle().pipe((0, operators_1.map)((response) => ({
            success: (response === null || response === void 0 ? void 0 : response.success) != null ? response === null || response === void 0 ? void 0 : response.success : true,
            message: i18n.translate((response === null || response === void 0 ? void 0 : response.message) || 'common.Success', {
                args: (response === null || response === void 0 ? void 0 : response.args) || {},
            }),
            time: new Date().toISOString(),
            meta: response === null || response === void 0 ? void 0 : response.meta,
            data: response === null || response === void 0 ? void 0 : response.data,
        })));
    }
};
exports.TransformResponseInterceptor = TransformResponseInterceptor;
exports.TransformResponseInterceptor = TransformResponseInterceptor = __decorate([
    (0, common_1.Injectable)()
], TransformResponseInterceptor);


/***/ }),
/* 29 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailConfig = exports.GlobalConfig = void 0;
const config_1 = __webpack_require__(30);
exports.GlobalConfig = (0, config_1.registerAs)('global', () => ({
    NODE_VERSION: process.versions.node,
    NODE_ENV: process.env.NODE_ENV,
    DOMAIN_FRONT_END: process.env.DOMAIN_FRONT_END,
    DOMAIN_BACK_END: process.env.DOMAIN_BACK_END,
    API_PUBLIC_HOST: process.env.API_PUBLIC_HOST || 'localhost',
    API_PUBLIC_PORT: Number(process.env.API_PUBLIC_PORT || 20000),
    FILE_SERVICE_HOST: process.env.FILE_SERVICE_HOST || 'localhost',
    FILE_SERVICE_PORT: Number(process.env.FILE_SERVICE_PORT || 20000),
    SQL_TYPE: process.env.SQL_TYPE,
    SQL_HOST: process.env.SQL_HOST,
    SQL_PORT: process.env.SQL_PORT,
    SQL_DATABASE: process.env.SQL_DATABASE,
}));
exports.EmailConfig = (0, config_1.registerAs)('email', () => ({
    name: process.env.EMAIL_NAME || 'medihome',
    host: process.env.EMAIL_HOST || 'smtp.gmail.com',
    port: +process.env.EMAIL_PORT || 465,
    user: process.env.EMAIL_USER || 'medihome.vn@gmail.com',
    password: process.env.EMAIL_PASSWORD,
    from: process.env.EMAIL_ADDRESS || 'medihome.vn@gmail.com',
    subject_prefix: process.env.EMAIL_SUBJECT_PREFIX || '【medihome】',
}));


/***/ }),
/* 30 */
/***/ ((module) => {

module.exports = require("@nestjs/config");

/***/ }),
/* 31 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const core_1 = __webpack_require__(4);
const throttler_1 = __webpack_require__(10);
const nestjs_i18n_1 = __webpack_require__(11);
const path = __webpack_require__(32);
const cache_data_module_1 = __webpack_require__(33);
const permission_guard_1 = __webpack_require__(93);
const jwt_extend_module_1 = __webpack_require__(94);
const detect_client_middleware_1 = __webpack_require__(98);
const postgresql_module_1 = __webpack_require__(99);
const google_driver_module_1 = __webpack_require__(230);
const auth_module_1 = __webpack_require__(235);
const api_file_module_1 = __webpack_require__(262);
const api_root_module_1 = __webpack_require__(298);
const api_module_1 = __webpack_require__(321);
const app_controller_1 = __webpack_require__(657);
const app_service_1 = __webpack_require__(658);
const email_module_1 = __webpack_require__(237);
const health_module_1 = __webpack_require__(659);
const image_manager_module_1 = __webpack_require__(664);
const cron_job_module_1 = __webpack_require__(665);
const event_listener_module_1 = __webpack_require__(670);
const socket_module_1 = __webpack_require__(675);
let AppModule = class AppModule {
    configure(consumer) {
        consumer.apply(nestjs_i18n_1.I18nMiddleware).forRoutes('*');
        consumer.apply(detect_client_middleware_1.DetectClientMiddleware).forRoutes('*');
    }
};
exports.AppModule = AppModule;
exports.AppModule = AppModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forRoot({
                envFilePath: [`.env.${process.env.NODE_ENV || 'local'}`, '.env'],
                isGlobal: true,
            }),
            throttler_1.ThrottlerModule.forRoot([{ ttl: 5000, limit: 10 }]),
            nestjs_i18n_1.I18nModule.forRoot({
                fallbackLanguage: 'vi',
                loader: nestjs_i18n_1.I18nJsonLoader,
                loaderOptions: {
                    path: path.join(__dirname, '../../../assets/i18n/'),
                    watch: true,
                },
                resolvers: [new nestjs_i18n_1.QueryResolver(['lang', 'l']), new nestjs_i18n_1.HeaderResolver(['x-lang'])],
                typesOutputPath: path.join(__dirname, '../../../assets/generated/i18n.generated.ts'),
            }),
            postgresql_module_1.PostgresqlModule,
            jwt_extend_module_1.JwtExtendModule,
            google_driver_module_1.GoogleDriverModule,
            health_module_1.HealthModule,
            email_module_1.EmailModule,
            image_manager_module_1.ImageManagerModule,
            cron_job_module_1.CronJobModule,
            event_listener_module_1.EventListenerModule,
            socket_module_1.SocketModule,
            cache_data_module_1.CacheDataModule,
            auth_module_1.AuthModule,
            api_module_1.ApiModule,
            api_file_module_1.ApiFileModule,
            api_root_module_1.ApiRootModule,
        ],
        controllers: [app_controller_1.AppController],
        providers: [
            {
                provide: core_1.APP_GUARD,
                useClass: throttler_1.ThrottlerGuard,
            },
            {
                provide: core_1.APP_GUARD,
                useClass: permission_guard_1.PermissionGuard,
            },
            app_service_1.AppService,
        ],
    })
], AppModule);


/***/ }),
/* 32 */
/***/ ((module) => {

module.exports = require("path");

/***/ }),
/* 33 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheDataModule = void 0;
const common_1 = __webpack_require__(3);
const redis_module_1 = __webpack_require__(34);
const cache_data_service_1 = __webpack_require__(39);
const cache_token_service_1 = __webpack_require__(92);
let CacheDataModule = class CacheDataModule {
};
exports.CacheDataModule = CacheDataModule;
exports.CacheDataModule = CacheDataModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [redis_module_1.RedisModule],
        providers: [cache_data_service_1.CacheDataService, cache_token_service_1.CacheTokenService],
        exports: [cache_data_service_1.CacheDataService, cache_token_service_1.CacheTokenService],
    })
], CacheDataModule);


/***/ }),
/* 34 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const redis_config_1 = __webpack_require__(35);
const redis_controller_1 = __webpack_require__(36);
const redis_service_1 = __webpack_require__(37);
let RedisModule = class RedisModule {
};
exports.RedisModule = RedisModule;
exports.RedisModule = RedisModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(redis_config_1.RedisConfig)],
        controllers: [redis_controller_1.RedisController],
        providers: [redis_service_1.RedisService],
        exports: [redis_service_1.RedisService],
    })
], RedisModule);


/***/ }),
/* 35 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisConfig = void 0;
const config_1 = __webpack_require__(30);
exports.RedisConfig = (0, config_1.registerAs)('redis', () => ({
    host: process.env.REDIS_HOST,
    port: Number(process.env.REDIS_PORT),
    password: process.env.REDIS_PASSWORD,
    db: process.env.REDIS_DB || '0',
}));


/***/ }),
/* 36 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const redis_service_1 = __webpack_require__(37);
let RedisController = class RedisController {
    constructor(redisService) {
        this.redisService = redisService;
    }
    async get({ key }) {
        const value = await this.redisService.get(key);
        return { data: { key, value } };
    }
    async getKeys({ pattern }) {
        const keys = await this.redisService.getKeys(pattern + '*');
        return { data: { keys } };
    }
    async set(body) {
        const { key, value, milliseconds } = body;
        await this.redisService.set(key, value, { datetime: new Date(Date.now() + milliseconds) });
        return { data: { key, value } };
    }
    async del(key) {
        await this.redisService.del(key);
        return { data: { key } };
    }
};
exports.RedisController = RedisController;
__decorate([
    (0, common_1.Get)('get/:key'),
    (0, swagger_1.ApiParam)({ name: 'key', example: 'demo', required: true }),
    __param(0, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "get", null);
__decorate([
    (0, common_1.Get)('get-keys'),
    (0, swagger_1.ApiQuery)({ name: 'pattern', example: 'TOKEN_', required: true }),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "getKeys", null);
__decorate([
    (0, common_1.Post)('set'),
    (0, swagger_1.ApiBody)({
        schema: {
            type: 'object',
            properties: {
                key: { type: 'string', example: 'demo' },
                value: { type: 'string', example: 'hah hah hah' },
                milliseconds: { type: 'number', example: 10000 },
            },
        },
    }),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "set", null);
__decorate([
    (0, common_1.Delete)('del/:key'),
    (0, swagger_1.ApiParam)({ name: 'key', example: 'demo', required: true }),
    __param(0, (0, common_1.Param)('key')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "del", null);
exports.RedisController = RedisController = __decorate([
    (0, swagger_1.ApiTags)('Redis'),
    (0, common_1.Controller)('redis'),
    __metadata("design:paramtypes", [typeof (_a = typeof redis_service_1.RedisService !== "undefined" && redis_service_1.RedisService) === "function" ? _a : Object])
], RedisController);


/***/ }),
/* 37 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var RedisService_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const redis_1 = __webpack_require__(38);
const redis_config_1 = __webpack_require__(35);
let RedisService = RedisService_1 = class RedisService {
    constructor(redisConfig) {
        this.redisConfig = redisConfig;
        this.logger = new common_1.Logger(RedisService_1.name);
    }
    async onModuleInit() {
        try {
            this.redisClient = (0, redis_1.createClient)({
                url: `redis://${this.redisConfig.host}:${this.redisConfig.port}`,
                password: this.redisConfig.password,
            });
            await this.redisClient.connect();
            this.logger.log('Redis connection established');
        }
        catch (error) {
            this.logger.error('Redis connection error', error);
        }
    }
    async onModuleDestroy() {
        if (this.redisClient) {
            await this.redisClient.quit();
        }
    }
    async get(key) {
        try {
            return await this.redisClient.get(key);
        }
        catch (error) {
            this.logger.error(`Error getting key ${key}`, error);
            throw error;
        }
    }
    async getKeys(pattern) {
        const keys = [];
        let cursor = 0;
        do {
            const scanResult = await this.redisClient.scan(cursor, { MATCH: pattern, COUNT: 1 });
            cursor = scanResult.cursor;
            keys.push(...scanResult.keys);
        } while (cursor !== 0);
        return keys;
    }
    async set(key, value, TTL) {
        try {
            const a = new Date();
            if (TTL && TTL.milliseconds) {
                await this.redisClient.set(key, value, { PX: TTL.milliseconds });
            }
            else if (TTL && TTL.datetime) {
                await this.redisClient.set(key, value, { PXAT: TTL.datetime.getTime() });
            }
            else {
                await this.redisClient.set(key, value);
            }
        }
        catch (error) {
            this.logger.error(`Error setting key ${key}`, error);
            throw error;
        }
    }
    async del(key) {
        try {
            await this.redisClient.del(key);
        }
        catch (error) {
            this.logger.error(`Error deleting key ${key}`, error);
            throw error;
        }
    }
};
exports.RedisService = RedisService;
exports.RedisService = RedisService = RedisService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(redis_config_1.RedisConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object])
], RedisService);


/***/ }),
/* 38 */
/***/ ((module) => {

module.exports = require("redis");

/***/ }),
/* 39 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheDataService = void 0;
const common_1 = __webpack_require__(3);
const setting_entity_1 = __webpack_require__(40);
const organization_repository_1 = __webpack_require__(41);
const permission_repository_1 = __webpack_require__(86);
const role_repository_1 = __webpack_require__(87);
const setting_repository_1 = __webpack_require__(88);
const user_role_repository_1 = __webpack_require__(89);
const user_repository_1 = __webpack_require__(90);
const object_helper_1 = __webpack_require__(91);
let CacheDataService = class CacheDataService {
    constructor(organizationRepository, settingRepository, userRepository, roleRepository, userRoleRepository, permissionRepository) {
        this.organizationRepository = organizationRepository;
        this.settingRepository = settingRepository;
        this.userRepository = userRepository;
        this.roleRepository = roleRepository;
        this.userRoleRepository = userRoleRepository;
        this.permissionRepository = permissionRepository;
        this.orgCache = {};
        this.permissionAllMap = null;
    }
    async getOrganization(oid) {
        var _a, _b, _c;
        if (!oid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].organization) {
            const organization = await this.organizationRepository.findOne({
                relation: { logoImage: true },
                condition: { id: oid },
            });
            try {
                organization.dataVersionParse = JSON.parse(organization.dataVersion);
                (_a = organization.dataVersionParse).product || (_a.product = 0);
                (_b = organization.dataVersionParse).batch || (_b.batch = 0);
                (_c = organization.dataVersionParse).customer || (_c.customer = 0);
            }
            catch (error) {
                organization.dataVersionParse = { product: 0, batch: 0, customer: 0 };
            }
            this.orgCache[oid].organization = organization;
        }
        return this.orgCache[oid].organization;
    }
    async getSettingMap(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].settingMapMap) {
            this.orgCache[oid].settingMapMap = {};
            const settingList = await this.settingRepository.findManyBy({ oid });
            settingList.forEach((i) => {
                const data = i.data ? JSON.parse(i.data) : i.data;
                if (i.key === setting_entity_1.SettingKey.GOOGLE_DRIVER && (data === null || data === void 0 ? void 0 : data.refreshToken)) {
                    data.refreshToken = data.refreshToken.slice(0, 20) + '...';
                }
                this.orgCache[oid].settingMapMap[i.key] = data;
            });
        }
        return this.orgCache[oid].settingMapMap;
    }
    async getEmailGoogleDriver(oid) {
        const settingMap = await this.getSettingMap(oid);
        const { email } = (settingMap === null || settingMap === void 0 ? void 0 : settingMap[setting_entity_1.SettingKey.GOOGLE_DRIVER]) || { email: '' };
        if (!email) {
            const settingMapROOT = await this.getSettingMap(1);
            const ggROOT = (settingMapROOT === null || settingMapROOT === void 0 ? void 0 : settingMapROOT[setting_entity_1.SettingKey.GOOGLE_DRIVER]) || { email: '' };
            return ggROOT.email;
        }
        return email;
    }
    async getSettingAllowNegativeQuantity(oid) {
        const settingMap = await this.getSettingMap(oid);
        const { allowNegativeQuantity } = (settingMap === null || settingMap === void 0 ? void 0 : settingMap[setting_entity_1.SettingKey.PRODUCT_SETTING]) || {};
        return !!allowNegativeQuantity;
    }
    async getUser(oid, uid) {
        if (!oid || !uid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].userMap)
            this.orgCache[oid].userMap = {};
        if (!this.orgCache[oid].userMap[uid]) {
            this.orgCache[oid].userMap[uid] = await this.userRepository.findOneBy({ oid, id: uid });
        }
        return this.orgCache[oid].userMap[uid];
    }
    async getRole(oid, rid) {
        if (!oid || !rid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].roleMap)
            this.orgCache[oid].roleMap = {};
        if (!this.orgCache[oid].roleMap[rid]) {
            this.orgCache[oid].roleMap[rid] = await this.roleRepository.findOneBy({ oid, id: rid });
        }
        return this.orgCache[oid].roleMap[rid];
    }
    async getRoleList(oid, uid) {
        if (!this.orgCache[oid].userRoleList) {
            this.orgCache[oid].userRoleList = await this.userRoleRepository.findManyBy({ oid });
        }
        const roleIdList = this.orgCache[oid].userRoleList
            .filter((i) => i.userId === uid)
            .map((i) => i.roleId);
        const result = [];
        for (let i = 0; i < roleIdList.length; i++) {
            const role = await this.getRole(oid, roleIdList[i]);
            result.push(role);
        }
        return result;
    }
    async getPermissionIdsByUserId(oid, uid) {
        if (!oid || !uid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        const user = await this.getUser(oid, uid);
        const organization = await this.getOrganization(oid);
        const organizationPermissionIds = JSON.parse(organization.permissionIds);
        let permissionIds = [];
        if (user.isAdmin) {
            permissionIds = organizationPermissionIds;
        }
        else {
            const roleList = await this.getRoleList(oid, uid);
            for (let i = 0; i < roleList.length; i++) {
                const currentPermissionIds = JSON.parse(roleList[i].permissionIds || '[]');
                permissionIds = permissionIds.concat(currentPermissionIds);
            }
            permissionIds = (0, object_helper_1.uniqueArray)(permissionIds);
        }
        return permissionIds;
    }
    async getPermissionAllMap() {
        if (!this.permissionAllMap) {
            const permissionAll = await this.permissionRepository.findManyBy({});
            this.permissionAllMap = (0, object_helper_1.arrayToKeyValue)(permissionAll, 'id');
        }
        return this.permissionAllMap;
    }
    async getPermissionAllList() {
        const map = await this.getPermissionAllMap();
        return Object.values(map);
    }
    updateOrganizationInfo(organization) {
        var _a, _b, _c;
        const oid = organization.id;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        try {
            organization.dataVersionParse = JSON.parse(organization.dataVersion);
            (_a = organization.dataVersionParse).product || (_a.product = 0);
            (_b = organization.dataVersionParse).batch || (_b.batch = 0);
            (_c = organization.dataVersionParse).customer || (_c.customer = 0);
        }
        catch (error) {
            organization.dataVersionParse = { product: 0, batch: 0, customer: 0 };
        }
        this.orgCache[oid].organization = organization;
    }
    clearUserAndRole(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].userMap = {};
        this.orgCache[oid].roleMap = {};
        this.orgCache[oid].userRoleList = null;
    }
    clearOrganization(oid) {
        if (oid === undefined)
            return (this.orgCache = {});
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].organization = null;
    }
    clearSettingMap(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].settingMapMap = null;
    }
    async reloadPermissionAll() {
        this.permissionAllMap = null;
        await this.getPermissionAllMap();
    }
    async reloadSettingMap(oid) {
        this.clearSettingMap(oid);
        await this.getSettingMap(oid);
    }
};
exports.CacheDataService = CacheDataService;
exports.CacheDataService = CacheDataService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _a : Object, typeof (_b = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _b : Object, typeof (_c = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _c : Object, typeof (_d = typeof role_repository_1.RoleRepository !== "undefined" && role_repository_1.RoleRepository) === "function" ? _d : Object, typeof (_e = typeof user_role_repository_1.UserRoleRepository !== "undefined" && user_role_repository_1.UserRoleRepository) === "function" ? _e : Object, typeof (_f = typeof permission_repository_1.PermissionRepository !== "undefined" && permission_repository_1.PermissionRepository) === "function" ? _f : Object])
], CacheDataService);


/***/ }),
/* 40 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Setting_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingKey = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
var SettingKey;
(function (SettingKey) {
    SettingKey["ROOT_SETTING"] = "ROOT_SETTING";
    SettingKey["SYSTEM_SETTING"] = "SYSTEM_SETTING";
    SettingKey["GOOGLE_DRIVER"] = "GOOGLE_DRIVER";
    SettingKey["PRODUCT_SETTING"] = "PRODUCT_SETTING";
})(SettingKey || (exports.SettingKey = SettingKey = {}));
let Setting = Setting_1 = class Setting {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Setting_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Setting_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Setting.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Setting.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Setting.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Setting.prototype, "data", void 0);
Setting = Setting_1 = __decorate([
    (0, typeorm_1.Entity)('Setting'),
    (0, typeorm_1.Index)('IDX_Setting__oid_key', ['oid', 'key'], { unique: true })
], Setting);
exports["default"] = Setting;


/***/ }),
/* 41 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let OrganizationRepository = class OrganizationRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(organizationRepository) {
        super(entities_1.Organization, organizationRepository);
        this.organizationRepository = organizationRepository;
    }
    async updateDataVersion(oid) {
        const randomNumber = Math.floor(Math.random() * 1000);
        const organization = await this.updateAndReturnEntity({ id: oid }, {
            dataVersion: JSON.stringify({
                product: randomNumber,
                batch: randomNumber,
                customer: randomNumber,
            }),
        });
        return organization;
    }
};
exports.OrganizationRepository = OrganizationRepository;
exports.OrganizationRepository = OrganizationRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Organization)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], OrganizationRepository);


/***/ }),
/* 42 */
/***/ ((module) => {

module.exports = require("@nestjs/typeorm");

/***/ }),
/* 43 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.Warehouse = exports.User = exports.UserRole = exports.Ticket = exports.TicketUser = exports.TicketSurcharge = exports.TicketRadiology = exports.TicketProduct = exports.TicketProcedure = exports.TicketLaboratory = exports.TicketLaboratoryResult = exports.TicketLaboratoryGroup = exports.TicketExpense = exports.TicketBatch = exports.TicketAttribute = exports.StockCheck = exports.StockCheckItem = exports.Setting = exports.Role = exports.Receipt = exports.ReceiptItem = exports.Radiology = exports.RadiologyGroup = exports.Product = exports.ProductMovement = exports.ProductGroup = exports.Procedure = exports.ProcedureGroup = exports.PrintHtml = exports.PrescriptionSample = exports.Permission = exports.Payment = exports.PaymentMethod = exports.Organization = exports.Laboratory = exports.LaboratoryKit = exports.LaboratoryGroup = exports.Image = exports.Distributor = exports.Customer = exports.CustomerSource = exports.Commission = exports.Batch = exports.Appointment = void 0;
var appointment_entity_1 = __webpack_require__(44);
Object.defineProperty(exports, "Appointment", ({ enumerable: true, get: function () { return appointment_entity_1.default; } }));
var batch_entity_1 = __webpack_require__(53);
Object.defineProperty(exports, "Batch", ({ enumerable: true, get: function () { return batch_entity_1.default; } }));
var commission_entity_1 = __webpack_require__(75);
Object.defineProperty(exports, "Commission", ({ enumerable: true, get: function () { return commission_entity_1.default; } }));
var customer_source_entity_1 = __webpack_require__(46);
Object.defineProperty(exports, "CustomerSource", ({ enumerable: true, get: function () { return customer_source_entity_1.default; } }));
var customer_entity_1 = __webpack_require__(47);
Object.defineProperty(exports, "Customer", ({ enumerable: true, get: function () { return customer_entity_1.default; } }));
var distributor_entity_1 = __webpack_require__(49);
Object.defineProperty(exports, "Distributor", ({ enumerable: true, get: function () { return distributor_entity_1.default; } }));
var image_entity_1 = __webpack_require__(19);
Object.defineProperty(exports, "Image", ({ enumerable: true, get: function () { return image_entity_1.default; } }));
var laboratory_group_entity_1 = __webpack_require__(61);
Object.defineProperty(exports, "LaboratoryGroup", ({ enumerable: true, get: function () { return laboratory_group_entity_1.default; } }));
var laboratory_kit_entity_1 = __webpack_require__(76);
Object.defineProperty(exports, "LaboratoryKit", ({ enumerable: true, get: function () { return laboratory_kit_entity_1.default; } }));
var laboratory_entity_1 = __webpack_require__(64);
Object.defineProperty(exports, "Laboratory", ({ enumerable: true, get: function () { return laboratory_entity_1.default; } }));
var organization_entity_1 = __webpack_require__(16);
Object.defineProperty(exports, "Organization", ({ enumerable: true, get: function () { return organization_entity_1.default; } }));
var payment_method_entity_1 = __webpack_require__(50);
Object.defineProperty(exports, "PaymentMethod", ({ enumerable: true, get: function () { return payment_method_entity_1.default; } }));
var payment_entity_1 = __webpack_require__(48);
Object.defineProperty(exports, "Payment", ({ enumerable: true, get: function () { return payment_entity_1.default; } }));
var permission_entity_1 = __webpack_require__(77);
Object.defineProperty(exports, "Permission", ({ enumerable: true, get: function () { return permission_entity_1.default; } }));
var prescription_sample_entity_1 = __webpack_require__(78);
Object.defineProperty(exports, "PrescriptionSample", ({ enumerable: true, get: function () { return prescription_sample_entity_1.default; } }));
var print_html_entity_1 = __webpack_require__(62);
Object.defineProperty(exports, "PrintHtml", ({ enumerable: true, get: function () { return print_html_entity_1.default; } }));
var procedure_group_entity_1 = __webpack_require__(68);
Object.defineProperty(exports, "ProcedureGroup", ({ enumerable: true, get: function () { return procedure_group_entity_1.default; } }));
var procedure_entity_1 = __webpack_require__(67);
Object.defineProperty(exports, "Procedure", ({ enumerable: true, get: function () { return procedure_entity_1.default; } }));
var product_group_entity_1 = __webpack_require__(55);
Object.defineProperty(exports, "ProductGroup", ({ enumerable: true, get: function () { return product_group_entity_1.default; } }));
var product_movement_entity_1 = __webpack_require__(79);
Object.defineProperty(exports, "ProductMovement", ({ enumerable: true, get: function () { return product_movement_entity_1.default; } }));
var product_entity_1 = __webpack_require__(54);
Object.defineProperty(exports, "Product", ({ enumerable: true, get: function () { return product_entity_1.default; } }));
var radiology_group_entity_1 = __webpack_require__(72);
Object.defineProperty(exports, "RadiologyGroup", ({ enumerable: true, get: function () { return radiology_group_entity_1.default; } }));
var radiology_entity_1 = __webpack_require__(71);
Object.defineProperty(exports, "Radiology", ({ enumerable: true, get: function () { return radiology_entity_1.default; } }));
var receipt_item_entity_1 = __webpack_require__(52);
Object.defineProperty(exports, "ReceiptItem", ({ enumerable: true, get: function () { return receipt_item_entity_1.default; } }));
var receipt_entity_1 = __webpack_require__(51);
Object.defineProperty(exports, "Receipt", ({ enumerable: true, get: function () { return receipt_entity_1.default; } }));
var role_entity_1 = __webpack_require__(23);
Object.defineProperty(exports, "Role", ({ enumerable: true, get: function () { return role_entity_1.default; } }));
var setting_entity_1 = __webpack_require__(40);
Object.defineProperty(exports, "Setting", ({ enumerable: true, get: function () { return setting_entity_1.default; } }));
var stock_check_item_entity_1 = __webpack_require__(81);
Object.defineProperty(exports, "StockCheckItem", ({ enumerable: true, get: function () { return stock_check_item_entity_1.default; } }));
var stock_check_entity_1 = __webpack_require__(80);
Object.defineProperty(exports, "StockCheck", ({ enumerable: true, get: function () { return stock_check_entity_1.default; } }));
var ticket_attribute_entity_1 = __webpack_require__(57);
Object.defineProperty(exports, "TicketAttribute", ({ enumerable: true, get: function () { return ticket_attribute_entity_1.default; } }));
var ticket_batch_entity_1 = __webpack_require__(58);
Object.defineProperty(exports, "TicketBatch", ({ enumerable: true, get: function () { return ticket_batch_entity_1.default; } }));
var ticket_expense_entity_1 = __webpack_require__(59);
Object.defineProperty(exports, "TicketExpense", ({ enumerable: true, get: function () { return ticket_expense_entity_1.default; } }));
var ticket_laboratory_group_entity_1 = __webpack_require__(60);
Object.defineProperty(exports, "TicketLaboratoryGroup", ({ enumerable: true, get: function () { return ticket_laboratory_group_entity_1.default; } }));
var ticket_laboratory_result_entity_1 = __webpack_require__(63);
Object.defineProperty(exports, "TicketLaboratoryResult", ({ enumerable: true, get: function () { return ticket_laboratory_result_entity_1.default; } }));
var ticket_laboratory_entity_1 = __webpack_require__(65);
Object.defineProperty(exports, "TicketLaboratory", ({ enumerable: true, get: function () { return ticket_laboratory_entity_1.default; } }));
var ticket_procedure_entity_1 = __webpack_require__(66);
Object.defineProperty(exports, "TicketProcedure", ({ enumerable: true, get: function () { return ticket_procedure_entity_1.default; } }));
var ticket_product_entity_1 = __webpack_require__(69);
Object.defineProperty(exports, "TicketProduct", ({ enumerable: true, get: function () { return ticket_product_entity_1.default; } }));
var ticket_radiology_entity_1 = __webpack_require__(70);
Object.defineProperty(exports, "TicketRadiology", ({ enumerable: true, get: function () { return ticket_radiology_entity_1.default; } }));
var ticket_surcharge_entity_1 = __webpack_require__(73);
Object.defineProperty(exports, "TicketSurcharge", ({ enumerable: true, get: function () { return ticket_surcharge_entity_1.default; } }));
var ticket_user_entity_1 = __webpack_require__(74);
Object.defineProperty(exports, "TicketUser", ({ enumerable: true, get: function () { return ticket_user_entity_1.default; } }));
var ticket_entity_1 = __webpack_require__(56);
Object.defineProperty(exports, "Ticket", ({ enumerable: true, get: function () { return ticket_entity_1.default; } }));
var user_role_entity_1 = __webpack_require__(22);
Object.defineProperty(exports, "UserRole", ({ enumerable: true, get: function () { return user_role_entity_1.default; } }));
var user_entity_1 = __webpack_require__(20);
Object.defineProperty(exports, "User", ({ enumerable: true, get: function () { return user_entity_1.default; } }));
var warehouse_entity_1 = __webpack_require__(82);
Object.defineProperty(exports, "Warehouse", ({ enumerable: true, get: function () { return warehouse_entity_1.default; } }));


/***/ }),
/* 44 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Appointment_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const customer_source_entity_1 = __webpack_require__(46);
const customer_entity_1 = __webpack_require__(47);
var AppointmentStatus;
(function (AppointmentStatus) {
    AppointmentStatus[AppointmentStatus["Waiting"] = 1] = "Waiting";
    AppointmentStatus[AppointmentStatus["Confirm"] = 2] = "Confirm";
    AppointmentStatus[AppointmentStatus["Completed"] = 3] = "Completed";
    AppointmentStatus[AppointmentStatus["Cancelled"] = 4] = "Cancelled";
})(AppointmentStatus || (exports.AppointmentStatus = AppointmentStatus = {}));
let Appointment = Appointment_1 = class Appointment extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Appointment_1();
        Object.assign(entity, raw);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Appointment_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Appointment.prototype, "reason", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "fromTicketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "toTicketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Appointment.prototype, "cancelReason", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: AppointmentStatus.Waiting }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "appointmentStatus", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _a : Object)
], Appointment.prototype, "customer", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_source_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerSourceId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof customer_source_entity_1.default !== "undefined" && customer_source_entity_1.default) === "function" ? _b : Object)
], Appointment.prototype, "customerSource", void 0);
Appointment = Appointment_1 = __decorate([
    (0, typeorm_1.Entity)('Appointment'),
    (0, typeorm_1.Index)('IDX_Appointment__fromTicketId', ['fromTicketId'])
], Appointment);
exports["default"] = Appointment;


/***/ }),
/* 45 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BaseEntity = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
class BaseEntity {
}
exports.BaseEntity = BaseEntity;
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], BaseEntity.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], BaseEntity.prototype, "id", void 0);


/***/ }),
/* 46 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var CustomerSource_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let CustomerSource = CustomerSource_1 = class CustomerSource {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new CustomerSource_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => CustomerSource_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], CustomerSource.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], CustomerSource.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], CustomerSource.prototype, "name", void 0);
CustomerSource = CustomerSource_1 = __decorate([
    (0, typeorm_1.Entity)('CustomerSource')
], CustomerSource);
exports["default"] = CustomerSource;


/***/ }),
/* 47 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Customer_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(48);
let Customer = Customer_1 = class Customer extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Customer_1();
        Object.assign(entity, raw);
        entity.birthday = raw.birthday == null ? raw.birthday : Number(raw.birthday);
        entity.debt = Number(raw.debt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Customer_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "fullName", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Customer.prototype, "facebook", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Customer.prototype, "zalo", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "birthday", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "yearOfBirth", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], Customer.prototype, "gender", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressProvince", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressDistrict", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressWard", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "relative", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "healthHistory", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.customer),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Customer.prototype, "paymentList", void 0);
Customer = Customer_1 = __decorate([
    (0, typeorm_1.Entity)('Customer')
], Customer);
exports["default"] = Customer;


/***/ }),
/* 48 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Payment_1;
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.MoneyDirection = exports.PersonType = exports.VoucherType = exports.PaymentTiming = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const customer_entity_1 = __webpack_require__(47);
const distributor_entity_1 = __webpack_require__(49);
const payment_method_entity_1 = __webpack_require__(50);
const receipt_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(56);
const user_entity_1 = __webpack_require__(20);
var PaymentTiming;
(function (PaymentTiming) {
    PaymentTiming[PaymentTiming["Other"] = 0] = "Other";
    PaymentTiming[PaymentTiming["Prepayment"] = 1] = "Prepayment";
    PaymentTiming[PaymentTiming["ReceiveRefund"] = 2] = "ReceiveRefund";
    PaymentTiming[PaymentTiming["Close"] = 3] = "Close";
    PaymentTiming[PaymentTiming["PayDebt"] = 4] = "PayDebt";
    PaymentTiming[PaymentTiming["Reopen"] = 5] = "Reopen";
    PaymentTiming[PaymentTiming["TopUp"] = 10] = "TopUp";
})(PaymentTiming || (exports.PaymentTiming = PaymentTiming = {}));
var VoucherType;
(function (VoucherType) {
    VoucherType[VoucherType["Unknown"] = 0] = "Unknown";
    VoucherType[VoucherType["Receipt"] = 1] = "Receipt";
    VoucherType[VoucherType["Ticket"] = 2] = "Ticket";
})(VoucherType || (exports.VoucherType = VoucherType = {}));
var PersonType;
(function (PersonType) {
    PersonType[PersonType["Unknown"] = 0] = "Unknown";
    PersonType[PersonType["Distributor"] = 1] = "Distributor";
    PersonType[PersonType["Customer"] = 2] = "Customer";
    PersonType[PersonType["Employee"] = 3] = "Employee";
})(PersonType || (exports.PersonType = PersonType = {}));
var MoneyDirection;
(function (MoneyDirection) {
    MoneyDirection[MoneyDirection["In"] = 1] = "In";
    MoneyDirection[MoneyDirection["Out"] = 2] = "Out";
})(MoneyDirection || (exports.MoneyDirection = MoneyDirection = {}));
let Payment = Payment_1 = class Payment {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Payment_1();
        Object.assign(entity, raw);
        entity.createdAt = Number(raw.createdAt);
        entity.paidAmount = Number(raw.paidAmount);
        entity.debtAmount = Number(raw.debtAmount);
        entity.openDebt = Number(raw.openDebt);
        entity.closeDebt = Number(raw.closeDebt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Payment_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Payment.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paymentMethodId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: VoucherType.Unknown }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "voucherType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "voucherId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: PersonType.Unknown }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "personType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "personId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: PaymentTiming.TopUp }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paymentTiming", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "moneyDirection", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paidAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "debtAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "openDebt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "closeDebt", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "cashierId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Payment.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Payment.prototype, "description", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _a : Object)
], Payment.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _b : Object)
], Payment.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _c : Object)
], Payment.prototype, "employee", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _d : Object)
], Payment.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof receipt_entity_1.default !== "undefined" && receipt_entity_1.default) === "function" ? _e : Object)
], Payment.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_f = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _f : Object)
], Payment.prototype, "cashier", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => payment_method_entity_1.default, (paymentMethod) => paymentMethod.paymentList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'paymentMethodId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof payment_method_entity_1.default !== "undefined" && payment_method_entity_1.default) === "function" ? _g : Object)
], Payment.prototype, "paymentMethod", void 0);
Payment = Payment_1 = __decorate([
    (0, typeorm_1.Entity)('Payment'),
    (0, typeorm_1.Index)('IDX_Payment__oid_createdAt', ['oid', 'createdAt']),
    (0, typeorm_1.Index)('IDX_Payment__oid_voucherId', ['oid', 'voucherId']),
    (0, typeorm_1.Index)('IDX_Payment__oid_personId', ['oid', 'personId']),
    (0, typeorm_1.Index)('IDX_Payment__oid_moneyDirection', ['oid', 'moneyDirection']),
    (0, typeorm_1.Index)('IDX_Payment__oid_paymentMethodId', ['oid', 'paymentMethodId'])
], Payment);
exports["default"] = Payment;


/***/ }),
/* 49 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Distributor_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const payment_entity_1 = __webpack_require__(48);
let Distributor = Distributor_1 = class Distributor extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Distributor_1();
        Object.assign(entity, raw);
        entity.debt = Number(raw.debt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Distributor_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "fullName", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "phone", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressProvince", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressDistrict", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressWard", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.distributor),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Distributor.prototype, "paymentList", void 0);
Distributor = Distributor_1 = __decorate([
    (0, typeorm_1.Entity)('Distributor')
], Distributor);
exports["default"] = Distributor;


/***/ }),
/* 50 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PaymentMethod_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
let PaymentMethod = PaymentMethod_1 = class PaymentMethod {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PaymentMethod_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PaymentMethod_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PaymentMethod.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.paymentMethod),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], PaymentMethod.prototype, "paymentList", void 0);
PaymentMethod = PaymentMethod_1 = __decorate([
    (0, typeorm_1.Entity)('PaymentMethod')
], PaymentMethod);
exports["default"] = PaymentMethod;


/***/ }),
/* 51 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Receipt_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const distributor_entity_1 = __webpack_require__(49);
const payment_entity_1 = __webpack_require__(48);
const receipt_item_entity_1 = __webpack_require__(52);
var ReceiptStatus;
(function (ReceiptStatus) {
    ReceiptStatus[ReceiptStatus["Schedule"] = 1] = "Schedule";
    ReceiptStatus[ReceiptStatus["Draft"] = 2] = "Draft";
    ReceiptStatus[ReceiptStatus["Deposited"] = 3] = "Deposited";
    ReceiptStatus[ReceiptStatus["Executing"] = 4] = "Executing";
    ReceiptStatus[ReceiptStatus["Debt"] = 5] = "Debt";
    ReceiptStatus[ReceiptStatus["Completed"] = 6] = "Completed";
    ReceiptStatus[ReceiptStatus["Cancelled"] = 7] = "Cancelled";
})(ReceiptStatus || (exports.ReceiptStatus = ReceiptStatus = {}));
let Receipt = Receipt_1 = class Receipt extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Receipt_1();
        Object.assign(entity, raw);
        entity.itemsActualMoney = Number(raw.itemsActualMoney);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.surcharge = Number(raw.surcharge);
        entity.totalMoney = Number(raw.totalMoney);
        entity.paid = Number(raw.paid);
        entity.debt = Number(raw.debt);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        entity.endedAt = raw.endedAt == null ? raw.endedAt : Number(raw.endedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Receipt_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], Receipt.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "year", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "month", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "date", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], Receipt.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'surcharge',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "surcharge", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "totalMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'paid',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "paid", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'debt',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Receipt.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Receipt.prototype, "endedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => receipt_item_entity_1.default, (receiptItem) => receiptItem.receipt),
    __metadata("design:type", Array)
], Receipt.prototype, "receiptItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => distributor_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'distributorId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _c : Object)
], Receipt.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.receipt),
    __metadata("design:type", Array)
], Receipt.prototype, "paymentList", void 0);
Receipt = Receipt_1 = __decorate([
    (0, typeorm_1.Entity)('Receipt'),
    (0, typeorm_1.Index)('IDX_Receipt__oid_distributorId', ['oid', 'distributorId']),
    (0, typeorm_1.Index)('IDX_Receipt__oid_startedAt', ['oid', 'startedAt'])
], Receipt);
exports["default"] = Receipt;


/***/ }),
/* 52 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ReceiptItem_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const batch_entity_1 = __webpack_require__(53);
const product_entity_1 = __webpack_require__(54);
const receipt_entity_1 = __webpack_require__(51);
let ReceiptItem = ReceiptItem_1 = class ReceiptItem extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ReceiptItem_1();
        Object.assign(entity, raw);
        entity.expiryDate = raw.expiryDate == null ? raw.expiryDate : Number(raw.expiryDate);
        entity.costPrice = Number(raw.costPrice);
        entity.quantity = Number(raw.quantity);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ReceiptItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "receiptId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], ReceiptItem.prototype, "batchCode", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "expiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "listPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ReceiptItem.prototype, "unitRate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => receipt_entity_1.default, (receipt) => receipt.receiptItemList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'receiptId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof receipt_entity_1.default !== "undefined" && receipt_entity_1.default) === "function" ? _a : Object)
], ReceiptItem.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _b : Object)
], ReceiptItem.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _c : Object)
], ReceiptItem.prototype, "product", void 0);
ReceiptItem = ReceiptItem_1 = __decorate([
    (0, typeorm_1.Entity)('ReceiptItem'),
    (0, typeorm_1.Index)('IDX_ReceiptItem__oid_batchId', ['oid', 'batchId']),
    (0, typeorm_1.Index)('IDX_ReceiptItem__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_ReceiptItem__oid_receiptId', ['oid', 'receiptId'])
], ReceiptItem);
exports["default"] = ReceiptItem;


/***/ }),
/* 53 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Batch_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const product_entity_1 = __webpack_require__(54);
let Batch = Batch_1 = class Batch {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Batch_1();
        Object.assign(entity, raw);
        entity.expiryDate = raw.expiryDate == null ? raw.expiryDate : Number(raw.expiryDate);
        entity.quantity = Number(raw.quantity);
        entity.costPrice = Number(raw.costPrice);
        entity.costAmount = Number(raw.costAmount);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Batch_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Batch.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Batch.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Batch.prototype, "batchCode", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "expiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _a : Object)
], Batch.prototype, "product", void 0);
Batch = Batch_1 = __decorate([
    (0, typeorm_1.Entity)('Batch'),
    (0, typeorm_1.Index)('IDX_Batch__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_Batch__oid_updatedAt', ['oid', 'updatedAt'])
], Batch);
exports["default"] = Batch;


/***/ }),
/* 54 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Product_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SplitBatchByCostPrice = exports.SplitBatchByExpiryDate = exports.SplitBatchByDistributor = exports.SplitBatchByWarehouse = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const batch_entity_1 = __webpack_require__(53);
const product_group_entity_1 = __webpack_require__(55);
var SplitBatchByWarehouse;
(function (SplitBatchByWarehouse) {
    SplitBatchByWarehouse[SplitBatchByWarehouse["Inherit"] = 0] = "Inherit";
    SplitBatchByWarehouse[SplitBatchByWarehouse["Override"] = 1] = "Override";
    SplitBatchByWarehouse[SplitBatchByWarehouse["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByWarehouse || (exports.SplitBatchByWarehouse = SplitBatchByWarehouse = {}));
var SplitBatchByDistributor;
(function (SplitBatchByDistributor) {
    SplitBatchByDistributor[SplitBatchByDistributor["Inherit"] = 0] = "Inherit";
    SplitBatchByDistributor[SplitBatchByDistributor["Override"] = 1] = "Override";
    SplitBatchByDistributor[SplitBatchByDistributor["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByDistributor || (exports.SplitBatchByDistributor = SplitBatchByDistributor = {}));
var SplitBatchByExpiryDate;
(function (SplitBatchByExpiryDate) {
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["Inherit"] = 0] = "Inherit";
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["Override"] = 1] = "Override";
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByExpiryDate || (exports.SplitBatchByExpiryDate = SplitBatchByExpiryDate = {}));
var SplitBatchByCostPrice;
(function (SplitBatchByCostPrice) {
    SplitBatchByCostPrice[SplitBatchByCostPrice["Inherit"] = 0] = "Inherit";
    SplitBatchByCostPrice[SplitBatchByCostPrice["OverrideAndMAC"] = 1] = "OverrideAndMAC";
    SplitBatchByCostPrice[SplitBatchByCostPrice["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByCostPrice || (exports.SplitBatchByCostPrice = SplitBatchByCostPrice = {}));
let Product = Product_1 = class Product {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Product_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costPrice = Number(raw.costPrice);
        entity.wholesalePrice = Number(raw.wholesalePrice);
        entity.retailPrice = Number(raw.retailPrice);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Product_1.fromRaw(i));
    }
    static getProductSettingRule(product, productSettingCommon, productSettingRoot) {
        const splitRule = {
            allowNegativeQuantity: false,
            pickupStrategy: product.pickupStrategy,
            splitBatchByWarehouse: product.splitBatchByWarehouse,
            splitBatchByDistributor: product.splitBatchByDistributor,
            splitBatchByExpiryDate: product.splitBatchByExpiryDate,
            splitBatchByCostPrice: product.splitBatchByCostPrice,
        };
        if (splitRule.pickupStrategy === variable_1.PickupStrategy.Inherit) {
            splitRule.pickupStrategy = productSettingCommon.pickupStrategy;
            if (splitRule.pickupStrategy === variable_1.PickupStrategy.Inherit) {
                splitRule.pickupStrategy = productSettingRoot.pickupStrategy;
            }
        }
        if (splitRule.splitBatchByWarehouse === SplitBatchByWarehouse.Inherit) {
            splitRule.splitBatchByWarehouse = productSettingCommon.splitBatchByWarehouse;
            if (splitRule.splitBatchByWarehouse === SplitBatchByWarehouse.Inherit) {
                splitRule.splitBatchByWarehouse = productSettingRoot.splitBatchByWarehouse;
            }
        }
        if (splitRule.splitBatchByDistributor === SplitBatchByDistributor.Inherit) {
            splitRule.splitBatchByDistributor = productSettingCommon.splitBatchByDistributor;
            if (splitRule.splitBatchByDistributor === SplitBatchByDistributor.Inherit) {
                splitRule.splitBatchByDistributor = productSettingRoot.splitBatchByDistributor;
            }
        }
        if (splitRule.splitBatchByExpiryDate === SplitBatchByExpiryDate.Inherit) {
            splitRule.splitBatchByExpiryDate = productSettingCommon.splitBatchByExpiryDate;
            if (splitRule.splitBatchByExpiryDate === SplitBatchByExpiryDate.Inherit) {
                splitRule.splitBatchByExpiryDate = productSettingRoot.splitBatchByExpiryDate;
            }
        }
        if (splitRule.splitBatchByCostPrice === SplitBatchByCostPrice.Inherit) {
            splitRule.splitBatchByCostPrice = productSettingCommon.splitBatchByCostPrice;
            if (splitRule.splitBatchByCostPrice === SplitBatchByCostPrice.Inherit) {
                splitRule.splitBatchByCostPrice = productSettingRoot.splitBatchByCostPrice;
            }
        }
        return splitRule;
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Product.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Product.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "productCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "brandName", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "substance", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: variable_1.PickupStrategy.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], Product.prototype, "pickupStrategy", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByWarehouse.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByWarehouse", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByDistributor.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByDistributor", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByExpiryDate.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByExpiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByCostPrice.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByCostPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "wholesalePrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "retailPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Product.prototype, "productGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "unit", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "route", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "source", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "image", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "hintUsage", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([0]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "warehouseIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "warehouseIdList", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => product_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof product_group_entity_1.default !== "undefined" && product_group_entity_1.default) === "function" ? _b : Object)
], Product.prototype, "productGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => batch_entity_1.default, (batch) => batch.product),
    __metadata("design:type", Array)
], Product.prototype, "batchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "commissionList", void 0);
Product = Product_1 = __decorate([
    (0, typeorm_1.Entity)('Product'),
    (0, typeorm_1.Index)('IDX_Product__oid_brandName', ['oid', 'brandName']),
    (0, typeorm_1.Index)('IDX_Product__oid_substance', ['oid', 'substance']),
    (0, typeorm_1.Unique)('UNIQUE_Product__oid_productCode', ['oid', 'productCode'])
], Product);
exports["default"] = Product;


/***/ }),
/* 55 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProductGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let ProductGroup = ProductGroup_1 = class ProductGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProductGroup_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProductGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], ProductGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], ProductGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], ProductGroup.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], ProductGroup.prototype, "updatedAt", void 0);
ProductGroup = ProductGroup_1 = __decorate([
    (0, typeorm_1.Entity)('ProductGroup')
], ProductGroup);
exports["default"] = ProductGroup;


/***/ }),
/* 56 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Ticket_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicStatusText = exports.TicketOrderStatusText = exports.TicketStatus = exports.TicketType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const appointment_entity_1 = __webpack_require__(44);
const customer_source_entity_1 = __webpack_require__(46);
const customer_entity_1 = __webpack_require__(47);
const payment_entity_1 = __webpack_require__(48);
const ticket_attribute_entity_1 = __webpack_require__(57);
const ticket_batch_entity_1 = __webpack_require__(58);
const ticket_expense_entity_1 = __webpack_require__(59);
const ticket_laboratory_group_entity_1 = __webpack_require__(60);
const ticket_laboratory_result_entity_1 = __webpack_require__(63);
const ticket_laboratory_entity_1 = __webpack_require__(65);
const ticket_procedure_entity_1 = __webpack_require__(66);
const ticket_product_entity_1 = __webpack_require__(69);
const ticket_radiology_entity_1 = __webpack_require__(70);
const ticket_surcharge_entity_1 = __webpack_require__(73);
const ticket_user_entity_1 = __webpack_require__(74);
var TicketType;
(function (TicketType) {
    TicketType[TicketType["Order"] = 2] = "Order";
    TicketType[TicketType["Clinic"] = 3] = "Clinic";
    TicketType[TicketType["Spa"] = 4] = "Spa";
    TicketType[TicketType["Eye"] = 5] = "Eye";
    TicketType[TicketType["Obstetric"] = 6] = "Obstetric";
})(TicketType || (exports.TicketType = TicketType = {}));
var TicketStatus;
(function (TicketStatus) {
    TicketStatus[TicketStatus["Schedule"] = 1] = "Schedule";
    TicketStatus[TicketStatus["Draft"] = 2] = "Draft";
    TicketStatus[TicketStatus["Deposited"] = 3] = "Deposited";
    TicketStatus[TicketStatus["Executing"] = 4] = "Executing";
    TicketStatus[TicketStatus["Debt"] = 5] = "Debt";
    TicketStatus[TicketStatus["Completed"] = 6] = "Completed";
    TicketStatus[TicketStatus["Cancelled"] = 7] = "Cancelled";
})(TicketStatus || (exports.TicketStatus = TicketStatus = {}));
exports.TicketOrderStatusText = {
    [TicketStatus.Schedule]: 'Xem trước',
    [TicketStatus.Draft]: 'Nháp',
    [TicketStatus.Deposited]: 'Đặt hàng',
    [TicketStatus.Executing]: 'Đang xử lý',
    [TicketStatus.Debt]: 'Đang nợ',
    [TicketStatus.Completed]: 'Hoàn thành',
    [TicketStatus.Cancelled]: 'Đã hủy',
};
exports.TicketClinicStatusText = {
    [TicketStatus.Schedule]: 'Hẹn khám',
    [TicketStatus.Draft]: 'Chờ khám',
    [TicketStatus.Deposited]: 'Đặt khám',
    [TicketStatus.Executing]: 'Đang khám',
    [TicketStatus.Debt]: 'Đang nợ',
    [TicketStatus.Completed]: 'Hoàn thành',
    [TicketStatus.Cancelled]: 'Đã hủy',
};
let Ticket = Ticket_1 = class Ticket extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Ticket_1();
        Object.assign(entity, raw);
        entity.itemsCostAmount = Number(raw.itemsCostAmount);
        entity.procedureMoney = Number(raw.procedureMoney);
        entity.productMoney = Number(raw.productMoney);
        entity.radiologyMoney = Number(raw.radiologyMoney);
        entity.laboratoryMoney = Number(raw.laboratoryMoney);
        entity.itemsActualMoney = Number(raw.itemsActualMoney);
        entity.itemsDiscount = Number(raw.itemsDiscount);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.totalMoney = Number(raw.totalMoney);
        entity.profit = Number(raw.profit);
        entity.paid = Number(raw.paid);
        entity.debt = Number(raw.debt);
        entity.surcharge = Number(raw.surcharge);
        entity.expense = Number(raw.expense);
        entity.commissionMoney = Number(raw.commissionMoney);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        entity.endedAt = raw.endedAt == null ? raw.endedAt : Number(raw.endedAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Ticket_1.fromRaw(i));
    }
    static getStatusText(ticket) {
        if (ticket.ticketType === TicketType.Order) {
            return exports.TicketOrderStatusText[ticket.status];
        }
        else {
            return exports.TicketClinicStatusText[ticket.status];
        }
        return '';
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketType.Order }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "ticketType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "customType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketStatus.Draft }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.NoStock }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], Ticket.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "year", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "month", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "date", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "dailyIndex", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "procedureMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "productMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "radiologyMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "laboratoryMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsDiscount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], Ticket.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "surcharge", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "totalMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "expense", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "commissionMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "profit", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "paid", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Ticket.prototype, "imageIds", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "endedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Ticket.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_source_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerSourceId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof customer_source_entity_1.default !== "undefined" && customer_source_entity_1.default) === "function" ? _c : Object)
], Ticket.prototype, "customerSource", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _d : Object)
], Ticket.prototype, "customer", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof appointment_entity_1.default !== "undefined" && appointment_entity_1.default) === "function" ? _e : Object)
], Ticket.prototype, "toAppointment", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_attribute_entity_1.default, (ticketAttribute) => ticketAttribute.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProduct) => ticketProduct.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProductConsumable) => ticketProductConsumable.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductConsumableList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProductPrescription) => ticketProductPrescription.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_batch_entity_1.default, (ticketBatch) => ticketBatch.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketBatchList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_procedure_entity_1.default, (ticketProcedure) => ticketProcedure.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_entity_1.default, (ticketLaboratory) => ticketLaboratory.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_group_entity_1.default, (ticketLaboratoryGroup) => ticketLaboratoryGroup.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryGroupList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_result_entity_1.default, (ticketLaboratoryResult) => ticketLaboratoryResult.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryResultList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_radiology_entity_1.default, (ticketRadiology) => ticketRadiology.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketRadiologyList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => ticket_expense_entity_1.default, (ticketExpense) => ticketExpense.ticket),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketExpenseList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => ticket_surcharge_entity_1.default, (ticketSurcharge) => ticketSurcharge.ticket),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketSurchargeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => ticket_user_entity_1.default, (ticketUser) => ticketUser.ticket),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "imageList", void 0);
Ticket = Ticket_1 = __decorate([
    (0, typeorm_1.Entity)('Ticket'),
    (0, typeorm_1.Index)('IDX_Ticket__oid_registeredAt', ['oid', 'registeredAt']),
    (0, typeorm_1.Index)('IDX_Ticket__oid_customerId', ['oid', 'customerId']),
    (0, typeorm_1.Index)('IDX_Ticket__oid_status', ['oid', 'status'])
], Ticket);
exports["default"] = Ticket;


/***/ }),
/* 57 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketAttribute_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
let TicketAttribute = TicketAttribute_1 = class TicketAttribute {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketAttribute_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketAttribute_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: false, type: 'varchar', length: 100 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketAttribute.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketAttribute.prototype, "value", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketAttributeList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketAttribute.prototype, "ticket", void 0);
TicketAttribute = TicketAttribute_1 = __decorate([
    (0, typeorm_1.Entity)('TicketAttribute'),
    (0, typeorm_1.Index)('IDX_TicketAttribute__oid_ticketId', ['oid', 'ticketId'])
], TicketAttribute);
exports["default"] = TicketAttribute;


/***/ }),
/* 58 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketBatch_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const batch_entity_1 = __webpack_require__(53);
const customer_entity_1 = __webpack_require__(47);
const product_entity_1 = __webpack_require__(54);
const ticket_entity_1 = __webpack_require__(56);
let TicketBatch = TicketBatch_1 = class TicketBatch extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketBatch_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costAmount = Number(raw.costAmount);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.actualPrice = Number(raw.actualPrice);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketBatch_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketBatch.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "ticketProductId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], TicketBatch.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "unitRate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "actualPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProductList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _b : Object)
], TicketBatch.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], TicketBatch.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _d : Object)
], TicketBatch.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _e : Object)
], TicketBatch.prototype, "batch", void 0);
TicketBatch = TicketBatch_1 = __decorate([
    (0, typeorm_1.Entity)('TicketBatch'),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_customerId', ['oid', 'customerId'])
], TicketBatch);
exports["default"] = TicketBatch;


/***/ }),
/* 59 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketExpense_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const ticket_entity_1 = __webpack_require__(56);
let TicketExpense = TicketExpense_1 = class TicketExpense extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketExpense_1();
        Object.assign(entity, raw);
        entity.money = Number(raw.money);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketExpense_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketExpense.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketExpense.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketExpense.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketExpense.prototype, "money", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketExpenseList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketExpense.prototype, "ticket", void 0);
TicketExpense = TicketExpense_1 = __decorate([
    (0, typeorm_1.Entity)('TicketExpense'),
    (0, typeorm_1.Index)('IDX_TicketExpense__ticketId', ['oid', 'ticketId'])
], TicketExpense);
exports["default"] = TicketExpense;


/***/ }),
/* 60 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratoryGroup_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(47);
const laboratory_group_entity_1 = __webpack_require__(61);
const ticket_entity_1 = __webpack_require__(56);
let TicketLaboratoryGroup = TicketLaboratoryGroup_1 = class TicketLaboratoryGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratoryGroup_1();
        Object.assign(entity, raw);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratoryGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketLaboratoryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.TicketLaboratoryStatus !== "undefined" && variable_1.TicketLaboratoryStatus) === "function" ? _a : Object)
], TicketLaboratoryGroup.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketLaboratoryGroup.prototype, "result", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _b : Object)
], TicketLaboratoryGroup.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], TicketLaboratoryGroup.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryGroupId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof laboratory_group_entity_1.default !== "undefined" && laboratory_group_entity_1.default) === "function" ? _d : Object)
], TicketLaboratoryGroup.prototype, "laboratoryGroup", void 0);
TicketLaboratoryGroup = TicketLaboratoryGroup_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratoryGroup'),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryGroup__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryGroup__oid_startedAt', ['oid', 'startedAt'])
], TicketLaboratoryGroup);
exports["default"] = TicketLaboratoryGroup;


/***/ }),
/* 61 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var LaboratoryGroup_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const print_html_entity_1 = __webpack_require__(62);
let LaboratoryGroup = LaboratoryGroup_1 = class LaboratoryGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new LaboratoryGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => LaboratoryGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], LaboratoryGroup.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "printHtmlId", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => print_html_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'printHtmlId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof print_html_entity_1.default !== "undefined" && print_html_entity_1.default) === "function" ? _a : Object)
], LaboratoryGroup.prototype, "printHtml", void 0);
LaboratoryGroup = LaboratoryGroup_1 = __decorate([
    (0, typeorm_1.Entity)('LaboratoryGroup')
], LaboratoryGroup);
exports["default"] = LaboratoryGroup;


/***/ }),
/* 62 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PrintHtml_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let PrintHtml = PrintHtml_1 = class PrintHtml {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PrintHtml_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PrintHtml_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], PrintHtml.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], PrintHtml.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "initVariable", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "dataExample", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "html", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "css", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], PrintHtml.prototype, "updatedAt", void 0);
PrintHtml = PrintHtml_1 = __decorate([
    (0, typeorm_1.Entity)('PrintHtml')
], PrintHtml);
exports["default"] = PrintHtml;


/***/ }),
/* 63 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratoryResult_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const customer_entity_1 = __webpack_require__(47);
const laboratory_entity_1 = __webpack_require__(64);
const ticket_entity_1 = __webpack_require__(56);
let TicketLaboratoryResult = TicketLaboratoryResult_1 = class TicketLaboratoryResult extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratoryResult_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratoryResult_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "laboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketLaboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketLaboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketLaboratoryResult.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "attention", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketLaboratoryResult.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _b : Object)
], TicketLaboratoryResult.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _c : Object)
], TicketLaboratoryResult.prototype, "laboratory", void 0);
TicketLaboratoryResult = TicketLaboratoryResult_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratoryResult'),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryResult__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryResult__oid_laboratoryId', ['oid', 'laboratoryId'])
], TicketLaboratoryResult);
exports["default"] = TicketLaboratoryResult;


/***/ }),
/* 64 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Laboratory_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryValueType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const laboratory_group_entity_1 = __webpack_require__(61);
const ticket_laboratory_entity_1 = __webpack_require__(65);
var LaboratoryValueType;
(function (LaboratoryValueType) {
    LaboratoryValueType[LaboratoryValueType["Number"] = 1] = "Number";
    LaboratoryValueType[LaboratoryValueType["String"] = 2] = "String";
    LaboratoryValueType[LaboratoryValueType["Options"] = 3] = "Options";
    LaboratoryValueType[LaboratoryValueType["Children"] = 4] = "Children";
})(LaboratoryValueType || (exports.LaboratoryValueType = LaboratoryValueType = {}));
let Laboratory = Laboratory_1 = class Laboratory {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Laboratory_1();
        entity.costPrice = Number(raw.costPrice);
        entity.price = Number(raw.price);
        entity.lowValue = Number(raw.lowValue);
        entity.highValue = Number(raw.highValue);
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Laboratory_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Laboratory.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "level", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "parentId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: LaboratoryValueType.Number }),
    __metadata("design:type", Number)
], Laboratory.prototype, "valueType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "unit", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        nullable: true,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "lowValue", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        nullable: true,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "highValue", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "options", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => laboratory_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof laboratory_group_entity_1.default !== "undefined" && laboratory_group_entity_1.default) === "function" ? _a : Object)
], Laboratory.prototype, "laboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_laboratory_entity_1.default, (ticketLaboratory) => ticketLaboratory.laboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'parentId', referencedColumnName: 'laboratoryId' }),
    __metadata("design:type", typeof (_b = typeof ticket_laboratory_entity_1.default !== "undefined" && ticket_laboratory_entity_1.default) === "function" ? _b : Object)
], Laboratory.prototype, "ticketLaboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Laboratory.prototype, "children", void 0);
Laboratory = Laboratory_1 = __decorate([
    (0, typeorm_1.Entity)('Laboratory'),
    (0, typeorm_1.Index)('IDX_Laboratory__oid_parentId', ['oid', 'parentId'])
], Laboratory);
exports["default"] = Laboratory;


/***/ }),
/* 65 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratory_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(47);
const laboratory_entity_1 = __webpack_require__(64);
const ticket_entity_1 = __webpack_require__(56);
let TicketLaboratory = TicketLaboratory_1 = class TicketLaboratory extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratory_1();
        Object.assign(entity, raw);
        entity.costPrice = Number(raw.costPrice);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratory_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "laboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "ticketLaboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketLaboratoryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.TicketLaboratoryStatus !== "undefined" && variable_1.TicketLaboratoryStatus) === "function" ? _a : Object)
], TicketLaboratory.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketLaboratory.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "startedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], TicketLaboratory.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _d : Object)
], TicketLaboratory.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _e : Object)
], TicketLaboratory.prototype, "laboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => laboratory_entity_1.default, (laboratory) => laboratory.ticketLaboratory),
    __metadata("design:type", Array)
], TicketLaboratory.prototype, "laboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketLaboratory.prototype, "ticketUserList", void 0);
TicketLaboratory = TicketLaboratory_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratory'),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_laboratoryId', ['oid', 'laboratoryId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_startedAt', ['oid', 'startedAt'])
], TicketLaboratory);
exports["default"] = TicketLaboratory;


/***/ }),
/* 66 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketProcedure_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(47);
const procedure_entity_1 = __webpack_require__(67);
const ticket_entity_1 = __webpack_require__(56);
var TicketProcedureStatus;
(function (TicketProcedureStatus) {
    TicketProcedureStatus[TicketProcedureStatus["Empty"] = 1] = "Empty";
    TicketProcedureStatus[TicketProcedureStatus["Pending"] = 2] = "Pending";
    TicketProcedureStatus[TicketProcedureStatus["Completed"] = 3] = "Completed";
})(TicketProcedureStatus || (exports.TicketProcedureStatus = TicketProcedureStatus = {}));
let TicketProcedure = TicketProcedure_1 = class TicketProcedure extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketProcedure_1();
        Object.assign(entity, raw);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketProcedure_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "procedureId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketProcedureStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedure.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketProcedure.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProcedure.prototype, "imageIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProcedureList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _b : Object)
], TicketProcedure.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], TicketProcedure.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => procedure_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'procedureId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof procedure_entity_1.default !== "undefined" && procedure_entity_1.default) === "function" ? _d : Object)
], TicketProcedure.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketProcedure.prototype, "imageList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketProcedure.prototype, "ticketUserList", void 0);
TicketProcedure = TicketProcedure_1 = __decorate([
    (0, typeorm_1.Entity)('TicketProcedure'),
    (0, typeorm_1.Index)('IDX_TicketProcedure__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketProcedure__oid_procedureId', ['oid', 'procedureId'])
], TicketProcedure);
exports["default"] = TicketProcedure;


/***/ }),
/* 67 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Procedure_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const procedure_group_entity_1 = __webpack_require__(68);
var ProcedureType;
(function (ProcedureType) {
    ProcedureType[ProcedureType["Basic"] = 1] = "Basic";
    ProcedureType[ProcedureType["Regimen"] = 2] = "Regimen";
    ProcedureType[ProcedureType["Remedy"] = 3] = "Remedy";
})(ProcedureType || (exports.ProcedureType = ProcedureType = {}));
let Procedure = Procedure_1 = class Procedure {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Procedure_1();
        Object.assign(entity, raw);
        entity.price = Number(raw.price);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Procedure_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Procedure.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Procedure.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Procedure.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: ProcedureType.Basic }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "procedureType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "quantityDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "gapHours", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Procedure.prototype, "procedureGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Procedure.prototype, "consumablesHint", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => procedure_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'procedureGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof procedure_group_entity_1.default !== "undefined" && procedure_group_entity_1.default) === "function" ? _a : Object)
], Procedure.prototype, "procedureGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Procedure.prototype, "commissionList", void 0);
Procedure = Procedure_1 = __decorate([
    (0, typeorm_1.Entity)('Procedure')
], Procedure);
exports["default"] = Procedure;


/***/ }),
/* 68 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProcedureGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let ProcedureGroup = ProcedureGroup_1 = class ProcedureGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProcedureGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProcedureGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], ProcedureGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], ProcedureGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], ProcedureGroup.prototype, "name", void 0);
ProcedureGroup = ProcedureGroup_1 = __decorate([
    (0, typeorm_1.Entity)('ProcedureGroup')
], ProcedureGroup);
exports["default"] = ProcedureGroup;


/***/ }),
/* 69 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketProduct_1;
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const batch_entity_1 = __webpack_require__(53);
const customer_entity_1 = __webpack_require__(47);
const product_entity_1 = __webpack_require__(54);
const ticket_entity_1 = __webpack_require__(56);
var TicketProductType;
(function (TicketProductType) {
    TicketProductType[TicketProductType["Prescription"] = 1] = "Prescription";
    TicketProductType[TicketProductType["Consumable"] = 2] = "Consumable";
})(TicketProductType || (exports.TicketProductType = TicketProductType = {}));
let TicketProduct = TicketProduct_1 = class TicketProduct extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketProduct_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.quantityPrescription = Number(raw.quantityPrescription);
        entity.costAmount = Number(raw.costAmount);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketProduct_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: variable_1.PickupStrategy.AutoWithFIFO, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketProduct.prototype, "pickupStrategy", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: JSON.stringify([0]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProduct.prototype, "warehouseIds", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketProductType.Prescription }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "type", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _b : Object)
], TicketProduct.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "unitRate", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "quantityPrescription", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _c : Object)
], TicketProduct.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProduct.prototype, "hintUsage", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProductList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _d : Object)
], TicketProduct.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _e : Object)
], TicketProduct.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _f : Object)
], TicketProduct.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _g : Object)
], TicketProduct.prototype, "batch", void 0);
TicketProduct = TicketProduct_1 = __decorate([
    (0, typeorm_1.Entity)('TicketProduct'),
    (0, typeorm_1.Index)('IDX_TicketProduct__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketProduct__oid_customerId', ['oid', 'customerId'])
], TicketProduct);
exports["default"] = TicketProduct;


/***/ }),
/* 70 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketRadiology_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(47);
const radiology_entity_1 = __webpack_require__(71);
const ticket_entity_1 = __webpack_require__(56);
var TicketRadiologyStatus;
(function (TicketRadiologyStatus) {
    TicketRadiologyStatus[TicketRadiologyStatus["Empty"] = 1] = "Empty";
    TicketRadiologyStatus[TicketRadiologyStatus["Pending"] = 2] = "Pending";
    TicketRadiologyStatus[TicketRadiologyStatus["Completed"] = 3] = "Completed";
})(TicketRadiologyStatus || (exports.TicketRadiologyStatus = TicketRadiologyStatus = {}));
let TicketRadiology = TicketRadiology_1 = class TicketRadiology extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketRadiology_1();
        Object.assign(entity, raw);
        entity.costPrice = Number(raw.costPrice);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketRadiology_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "radiologyId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketRadiologyStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketRadiology.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketRadiology.prototype, "description", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketRadiology.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketRadiology.prototype, "imageIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketRadiologyList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _b : Object)
], TicketRadiology.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], TicketRadiology.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => radiology_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'radiologyId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof radiology_entity_1.default !== "undefined" && radiology_entity_1.default) === "function" ? _d : Object)
], TicketRadiology.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketRadiology.prototype, "imageList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketRadiology.prototype, "ticketUserList", void 0);
TicketRadiology = TicketRadiology_1 = __decorate([
    (0, typeorm_1.Entity)('TicketRadiology'),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_radiologyId', ['oid', 'radiologyId']),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_startedAt', ['oid', 'startedAt'])
], TicketRadiology);
exports["default"] = TicketRadiology;


/***/ }),
/* 71 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Radiology_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const print_html_entity_1 = __webpack_require__(62);
const radiology_group_entity_1 = __webpack_require__(72);
let Radiology = Radiology_1 = class Radiology {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Radiology_1();
        entity.price = Number(raw.price);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Radiology_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Radiology.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Radiology.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Radiology.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Radiology.prototype, "printHtmlId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "requestNoteDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "descriptionDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "resultDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "customVariables", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "customStyles", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => radiology_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'radiologyGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof radiology_group_entity_1.default !== "undefined" && radiology_group_entity_1.default) === "function" ? _a : Object)
], Radiology.prototype, "radiologyGroup", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => print_html_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'printHtmlId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof print_html_entity_1.default !== "undefined" && print_html_entity_1.default) === "function" ? _b : Object)
], Radiology.prototype, "printHtml", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Radiology.prototype, "commissionList", void 0);
Radiology = Radiology_1 = __decorate([
    (0, typeorm_1.Entity)('Radiology')
], Radiology);
exports["default"] = Radiology;


/***/ }),
/* 72 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var RadiologyGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let RadiologyGroup = RadiologyGroup_1 = class RadiologyGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new RadiologyGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => RadiologyGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], RadiologyGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], RadiologyGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], RadiologyGroup.prototype, "name", void 0);
RadiologyGroup = RadiologyGroup_1 = __decorate([
    (0, typeorm_1.Entity)('RadiologyGroup')
], RadiologyGroup);
exports["default"] = RadiologyGroup;


/***/ }),
/* 73 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketSurcharge_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const ticket_entity_1 = __webpack_require__(56);
let TicketSurcharge = TicketSurcharge_1 = class TicketSurcharge extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketSurcharge_1();
        Object.assign(entity, raw);
        entity.money = Number(raw.money);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketSurcharge_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketSurcharge.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketSurcharge.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketSurcharge.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketSurcharge.prototype, "money", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketSurchargeList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketSurcharge.prototype, "ticket", void 0);
TicketSurcharge = TicketSurcharge_1 = __decorate([
    (0, typeorm_1.Entity)('TicketSurcharge'),
    (0, typeorm_1.Index)('IDX_TicketSurcharge__ticketId', ['oid', 'ticketId'])
], TicketSurcharge);
exports["default"] = TicketSurcharge;


/***/ }),
/* 74 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketUser_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const commission_entity_1 = __webpack_require__(75);
const role_entity_1 = __webpack_require__(23);
const ticket_entity_1 = __webpack_require__(56);
const user_entity_1 = __webpack_require__(20);
let TicketUser = TicketUser_1 = class TicketUser {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketUser_1();
        Object.assign(entity, raw);
        entity.commissionMoney = Number(raw.commissionMoney);
        entity.commissionPercentActual = Number(raw.commissionPercentActual);
        entity.commissionPercentExpected = Number(raw.commissionPercentExpected);
        entity.ticketItemExpectedPrice = Number(raw.ticketItemExpectedPrice);
        entity.ticketItemActualPrice = Number(raw.ticketItemActualPrice);
        entity.createdAt = Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketUser_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketUser.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "roleId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "userId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.InteractType !== "undefined" && commission_entity_1.InteractType) === "function" ? _a : Object)
], TicketUser.prototype, "interactType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "interactId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemExpectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemActualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _b : Object)
], TicketUser.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 5,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionPercentActual", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 5,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionPercentExpected", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketUserList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], TicketUser.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'userId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _d : Object)
], TicketUser.prototype, "user", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _e : Object)
], TicketUser.prototype, "role", void 0);
TicketUser = TicketUser_1 = __decorate([
    (0, typeorm_1.Entity)('TicketUser'),
    (0, typeorm_1.Index)('IDX_TicketUser__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketUser__oid_createdAt', ['oid', 'createdAt'])
], TicketUser);
exports["default"] = TicketUser;


/***/ }),
/* 75 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Commission_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionCalculatorType = exports.InteractType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const laboratory_entity_1 = __webpack_require__(64);
const procedure_entity_1 = __webpack_require__(67);
const product_entity_1 = __webpack_require__(54);
const radiology_entity_1 = __webpack_require__(71);
const role_entity_1 = __webpack_require__(23);
var InteractType;
(function (InteractType) {
    InteractType[InteractType["Ticket"] = 1] = "Ticket";
    InteractType[InteractType["Product"] = 2] = "Product";
    InteractType[InteractType["Procedure"] = 3] = "Procedure";
    InteractType[InteractType["Radiology"] = 4] = "Radiology";
    InteractType[InteractType["Laboratory"] = 5] = "Laboratory";
    InteractType[InteractType["ConsumableList"] = 6] = "ConsumableList";
    InteractType[InteractType["PrescriptionList"] = 7] = "PrescriptionList";
})(InteractType || (exports.InteractType = InteractType = {}));
var CommissionCalculatorType;
(function (CommissionCalculatorType) {
    CommissionCalculatorType[CommissionCalculatorType["VND"] = 1] = "VND";
    CommissionCalculatorType[CommissionCalculatorType["PercentExpected"] = 2] = "PercentExpected";
    CommissionCalculatorType[CommissionCalculatorType["PercentActual"] = 3] = "PercentActual";
})(CommissionCalculatorType || (exports.CommissionCalculatorType = CommissionCalculatorType = {}));
let Commission = Commission_1 = class Commission {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Commission_1();
        Object.assign(entity, raw);
        entity.commissionValue = Number(raw.commissionValue);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Commission_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Commission.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "roleId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "interactId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: InteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "interactType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "commissionValue", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Commission.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _a : Object)
], Commission.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], Commission.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof procedure_entity_1.default !== "undefined" && procedure_entity_1.default) === "function" ? _c : Object)
], Commission.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof radiology_entity_1.default !== "undefined" && radiology_entity_1.default) === "function" ? _d : Object)
], Commission.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _e : Object)
], Commission.prototype, "laboratory", void 0);
Commission = Commission_1 = __decorate([
    (0, typeorm_1.Entity)('Commission'),
    (0, typeorm_1.Index)('IDX_Commission__oid_roleId_interactType_interactId', ['oid', 'roleId', 'interactType', 'interactId'], { unique: true })
], Commission);
exports["default"] = Commission;


/***/ }),
/* 76 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var LaboratoryKit_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let LaboratoryKit = LaboratoryKit_1 = class LaboratoryKit {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new LaboratoryKit_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => LaboratoryKit_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], LaboratoryKit.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], LaboratoryKit.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], LaboratoryKit.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], LaboratoryKit.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    __metadata("design:type", String)
], LaboratoryKit.prototype, "laboratoryIds", void 0);
LaboratoryKit = LaboratoryKit_1 = __decorate([
    (0, typeorm_1.Entity)('LaboratoryKit')
], LaboratoryKit);
exports["default"] = LaboratoryKit;


/***/ }),
/* 77 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Permission_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionId = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
var PermissionId;
(function (PermissionId) {
    PermissionId[PermissionId["ORGANIZATION"] = 1] = "ORGANIZATION";
    PermissionId[PermissionId["ORGANIZATION_UPDATE_INFO"] = 100] = "ORGANIZATION_UPDATE_INFO";
    PermissionId[PermissionId["ORGANIZATION_SETTING_UPSERT"] = 101] = "ORGANIZATION_SETTING_UPSERT";
    PermissionId[PermissionId["ORGANIZATION_VERIFY_EMAIL"] = 102] = "ORGANIZATION_VERIFY_EMAIL";
    PermissionId[PermissionId["USER"] = 2] = "USER";
    PermissionId[PermissionId["ACCOUNT_CRUD"] = 201] = "ACCOUNT_CRUD";
    PermissionId[PermissionId["ROLE_CRUD"] = 202] = "ROLE_CRUD";
    PermissionId[PermissionId["COMMISSION_CRUD"] = 203] = "COMMISSION_CRUD";
    PermissionId[PermissionId["STATISTIC"] = 4] = "STATISTIC";
    PermissionId[PermissionId["STATISTIC_TICKET"] = 401] = "STATISTIC_TICKET";
    PermissionId[PermissionId["STATISTIC_RECEIPT"] = 402] = "STATISTIC_RECEIPT";
    PermissionId[PermissionId["STATISTIC_PRODUCT"] = 403] = "STATISTIC_PRODUCT";
    PermissionId[PermissionId["STATISTIC_CUSTOMER"] = 404] = "STATISTIC_CUSTOMER";
    PermissionId[PermissionId["STATISTIC_PROCEDURE"] = 405] = "STATISTIC_PROCEDURE";
    PermissionId[PermissionId["STATISTIC_LABORATORY"] = 406] = "STATISTIC_LABORATORY";
    PermissionId[PermissionId["STATISTIC_RADIOLOGY"] = 407] = "STATISTIC_RADIOLOGY";
    PermissionId[PermissionId["MASTER_DATA"] = 5] = "MASTER_DATA";
    PermissionId[PermissionId["MASTER_DATA_WAREHOUSE"] = 501] = "MASTER_DATA_WAREHOUSE";
    PermissionId[PermissionId["MASTER_DATA_PROCEDURE"] = 502] = "MASTER_DATA_PROCEDURE";
    PermissionId[PermissionId["MASTER_DATA_LABORATORY"] = 503] = "MASTER_DATA_LABORATORY";
    PermissionId[PermissionId["MASTER_DATA_RADIOLOGY"] = 504] = "MASTER_DATA_RADIOLOGY";
    PermissionId[PermissionId["MASTER_DATA_CUSTOMER_SOURCE"] = 505] = "MASTER_DATA_CUSTOMER_SOURCE";
    PermissionId[PermissionId["MASTER_DATA_PRINT_HTML"] = 506] = "MASTER_DATA_PRINT_HTML";
    PermissionId[PermissionId["MASTER_DATA_PRESCRIPTION_SAMPLE"] = 507] = "MASTER_DATA_PRESCRIPTION_SAMPLE";
    PermissionId[PermissionId["MASTER_DATA_PAYMENT_METHOD"] = 508] = "MASTER_DATA_PAYMENT_METHOD";
    PermissionId[PermissionId["PRODUCT"] = 6] = "PRODUCT";
    PermissionId[PermissionId["PRODUCT_READ"] = 600] = "PRODUCT_READ";
    PermissionId[PermissionId["PRODUCT_CREATE"] = 601] = "PRODUCT_CREATE";
    PermissionId[PermissionId["PRODUCT_UPDATE"] = 602] = "PRODUCT_UPDATE";
    PermissionId[PermissionId["PRODUCT_DELETE"] = 603] = "PRODUCT_DELETE";
    PermissionId[PermissionId["BATCH_READ"] = 610] = "BATCH_READ";
    PermissionId[PermissionId["BATCH_CREATE"] = 611] = "BATCH_CREATE";
    PermissionId[PermissionId["BATCH_UPDATE"] = 612] = "BATCH_UPDATE";
    PermissionId[PermissionId["BATCH_DELETE"] = 613] = "BATCH_DELETE";
    PermissionId[PermissionId["READ_COST_PRICE"] = 614] = "READ_COST_PRICE";
    PermissionId[PermissionId["BATCH_CHANGE_QUANTITY_AND_COST_PRICE"] = 615] = "BATCH_CHANGE_QUANTITY_AND_COST_PRICE";
    PermissionId[PermissionId["PRODUCT_MERGE"] = 616] = "PRODUCT_MERGE";
    PermissionId[PermissionId["READ_MOVEMENT"] = 620] = "READ_MOVEMENT";
    PermissionId[PermissionId["DISTRIBUTOR"] = 7] = "DISTRIBUTOR";
    PermissionId[PermissionId["DISTRIBUTOR_READ"] = 700] = "DISTRIBUTOR_READ";
    PermissionId[PermissionId["DISTRIBUTOR_CREATE"] = 701] = "DISTRIBUTOR_CREATE";
    PermissionId[PermissionId["DISTRIBUTOR_UPDATE"] = 702] = "DISTRIBUTOR_UPDATE";
    PermissionId[PermissionId["DISTRIBUTOR_DELETE"] = 703] = "DISTRIBUTOR_DELETE";
    PermissionId[PermissionId["CUSTOMER"] = 8] = "CUSTOMER";
    PermissionId[PermissionId["CUSTOMER_READ"] = 800] = "CUSTOMER_READ";
    PermissionId[PermissionId["CUSTOMER_CREATE"] = 801] = "CUSTOMER_CREATE";
    PermissionId[PermissionId["CUSTOMER_UPDATE"] = 802] = "CUSTOMER_UPDATE";
    PermissionId[PermissionId["CUSTOMER_DELETE"] = 803] = "CUSTOMER_DELETE";
    PermissionId[PermissionId["RECEIPT"] = 9] = "RECEIPT";
    PermissionId[PermissionId["RECEIPT_READ"] = 900] = "RECEIPT_READ";
    PermissionId[PermissionId["RECEIPT_DRAFT_CRUD"] = 901] = "RECEIPT_DRAFT_CRUD";
    PermissionId[PermissionId["RECEIPT_DEPOSITED_UPDATE"] = 902] = "RECEIPT_DEPOSITED_UPDATE";
    PermissionId[PermissionId["RECEIPT_DEPOSITED_DESTROY"] = 903] = "RECEIPT_DEPOSITED_DESTROY";
    PermissionId[PermissionId["RECEIPT_PAYMENT"] = 904] = "RECEIPT_PAYMENT";
    PermissionId[PermissionId["RECEIPT_REFUND_OVERPAID"] = 905] = "RECEIPT_REFUND_OVERPAID";
    PermissionId[PermissionId["RECEIPT_SEND_PRODUCT"] = 906] = "RECEIPT_SEND_PRODUCT";
    PermissionId[PermissionId["RECEIPT_CLOSE"] = 907] = "RECEIPT_CLOSE";
    PermissionId[PermissionId["RECEIPT_TERMINATE"] = 908] = "RECEIPT_TERMINATE";
    PermissionId[PermissionId["RECEIPT_CANCELLED_DESTROY"] = 909] = "RECEIPT_CANCELLED_DESTROY";
    PermissionId[PermissionId["APPOINTMENT"] = 10] = "APPOINTMENT";
    PermissionId[PermissionId["APPOINTMENT_READ"] = 1000] = "APPOINTMENT_READ";
    PermissionId[PermissionId["APPOINTMENT_CREATE"] = 1001] = "APPOINTMENT_CREATE";
    PermissionId[PermissionId["APPOINTMENT_UPDATE"] = 1002] = "APPOINTMENT_UPDATE";
    PermissionId[PermissionId["APPOINTMENT_DELETE"] = 1003] = "APPOINTMENT_DELETE";
    PermissionId[PermissionId["APPOINTMENT_REGISTER_TICKET"] = 1004] = "APPOINTMENT_REGISTER_TICKET";
    PermissionId[PermissionId["STOCK_CHECK"] = 11] = "STOCK_CHECK";
    PermissionId[PermissionId["STOCK_CHECK_READ"] = 1100] = "STOCK_CHECK_READ";
    PermissionId[PermissionId["STOCK_CHECK_DRAFT_CRUD"] = 1101] = "STOCK_CHECK_DRAFT_CRUD";
    PermissionId[PermissionId["STOCK_CHECK_DRAFT_SUBMIT"] = 1102] = "STOCK_CHECK_DRAFT_SUBMIT";
    PermissionId[PermissionId["STOCK_CHECK_PENDING_APPROVE"] = 1103] = "STOCK_CHECK_PENDING_APPROVE";
    PermissionId[PermissionId["STOCK_CHECK_CONFIRMED_RECONCILE"] = 1104] = "STOCK_CHECK_CONFIRMED_RECONCILE";
    PermissionId[PermissionId["STOCK_CHECK_VOID"] = 1105] = "STOCK_CHECK_VOID";
    PermissionId[PermissionId["STOCK_CHECK_CANCELLED_DESTROY"] = 1106] = "STOCK_CHECK_CANCELLED_DESTROY";
    PermissionId[PermissionId["PAYMENT"] = 12] = "PAYMENT";
    PermissionId[PermissionId["PAYMENT_READ"] = 1200] = "PAYMENT_READ";
    PermissionId[PermissionId["PAYMENT_CUSTOMER_MONEY_IN"] = 1201] = "PAYMENT_CUSTOMER_MONEY_IN";
    PermissionId[PermissionId["PAYMENT_DISTRIBUTOR_MONEY_OUT"] = 1202] = "PAYMENT_DISTRIBUTOR_MONEY_OUT";
    PermissionId[PermissionId["PAYMENT_OTHER_MONEY_IN"] = 1203] = "PAYMENT_OTHER_MONEY_IN";
    PermissionId[PermissionId["PAYMENT_OTHER_MONEY_OUT"] = 1204] = "PAYMENT_OTHER_MONEY_OUT";
    PermissionId[PermissionId["FILE"] = 20] = "FILE";
    PermissionId[PermissionId["FILE_PRODUCT_DOWNLOAD_EXCEL"] = 2001] = "FILE_PRODUCT_DOWNLOAD_EXCEL";
    PermissionId[PermissionId["FILE_CUSTOMER_DOWNLOAD_EXCEL"] = 2002] = "FILE_CUSTOMER_DOWNLOAD_EXCEL";
    PermissionId[PermissionId["FILE_RECEIPT_DOWNLOAD_EXCEL"] = 2003] = "FILE_RECEIPT_DOWNLOAD_EXCEL";
    PermissionId[PermissionId["FILE_TICKET_ORDER_DOWNLOAD_EXCEL"] = 2004] = "FILE_TICKET_ORDER_DOWNLOAD_EXCEL";
    PermissionId[PermissionId["FILE_TICKET_CLINIC_DOWNLOAD_EXCEL"] = 2005] = "FILE_TICKET_CLINIC_DOWNLOAD_EXCEL";
    PermissionId[PermissionId["FILE_PRODUCT_UPLOAD_EXCEL"] = 2051] = "FILE_PRODUCT_UPLOAD_EXCEL";
    PermissionId[PermissionId["FILE_CUSTOMER_UPLOAD_EXCEL"] = 2052] = "FILE_CUSTOMER_UPLOAD_EXCEL";
    PermissionId[PermissionId["FILE_RECEIPT_UPLOAD_EXCEL"] = 2053] = "FILE_RECEIPT_UPLOAD_EXCEL";
    PermissionId[PermissionId["FILE_TICKET_ORDER_UPLOAD_EXCEL"] = 2054] = "FILE_TICKET_ORDER_UPLOAD_EXCEL";
    PermissionId[PermissionId["FILE_TICKET_CLINIC_UPLOAD_EXCEL"] = 2055] = "FILE_TICKET_CLINIC_UPLOAD_EXCEL";
    PermissionId[PermissionId["TICKET_ORDER"] = 50] = "TICKET_ORDER";
    PermissionId[PermissionId["TICKET_ORDER_READ"] = 5000] = "TICKET_ORDER_READ";
    PermissionId[PermissionId["TICKET_ORDER_DRAFT_CRUD"] = 5001] = "TICKET_ORDER_DRAFT_CRUD";
    PermissionId[PermissionId["TICKET_ORDER_DEPOSITED_UPDATE"] = 5002] = "TICKET_ORDER_DEPOSITED_UPDATE";
    PermissionId[PermissionId["TICKET_ORDER_DEPOSITED_DESTROY"] = 5003] = "TICKET_ORDER_DEPOSITED_DESTROY";
    PermissionId[PermissionId["TICKET_ORDER_DEBT_SUCCESS_CRUD"] = 5004] = "TICKET_ORDER_DEBT_SUCCESS_CRUD";
    PermissionId[PermissionId["TICKET_ORDER_PAYMENT"] = 5010] = "TICKET_ORDER_PAYMENT";
    PermissionId[PermissionId["TICKET_ORDER_REFUND_OVERPAID"] = 5011] = "TICKET_ORDER_REFUND_OVERPAID";
    PermissionId[PermissionId["TICKET_ORDER_SEND_PRODUCT"] = 5012] = "TICKET_ORDER_SEND_PRODUCT";
    PermissionId[PermissionId["TICKET_ORDER_CLOSE"] = 513] = "TICKET_ORDER_CLOSE";
    PermissionId[PermissionId["TICKET_ORDER_REOPEN"] = 5014] = "TICKET_ORDER_REOPEN";
    PermissionId[PermissionId["TICKET_ORDER_RETURN_PRODUCT"] = 5015] = "TICKET_ORDER_RETURN_PRODUCT";
    PermissionId[PermissionId["TICKET_ORDER_TERMINATE"] = 5016] = "TICKET_ORDER_TERMINATE";
    PermissionId[PermissionId["TICKET_ORDER_CANCELLED_DESTROY"] = 5017] = "TICKET_ORDER_CANCELLED_DESTROY";
    PermissionId[PermissionId["TICKET_CLINIC"] = 51] = "TICKET_CLINIC";
    PermissionId[PermissionId["TICKET_CLINIC_READ"] = 5100] = "TICKET_CLINIC_READ";
    PermissionId[PermissionId["TICKET_CLINIC_CREATE"] = 5101] = "TICKET_CLINIC_CREATE";
    PermissionId[PermissionId["TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE"] = 5102] = "TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE";
    PermissionId[PermissionId["TICKET_CLINIC_START_CHECKUP"] = 5103] = "TICKET_CLINIC_START_CHECKUP";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST"] = 5104] = "TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST"] = 5105] = "TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST"] = 5106] = "TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE"] = 5107] = "TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION"] = 5108] = "TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION";
    PermissionId[PermissionId["TICKET_CLINIC_CHANGE_DISCOUNT"] = 5110] = "TICKET_CLINIC_CHANGE_DISCOUNT";
    PermissionId[PermissionId["TICKET_CLINIC_PAYMENT"] = 5111] = "TICKET_CLINIC_PAYMENT";
    PermissionId[PermissionId["TICKET_CLINIC_REFUND_OVERPAID"] = 5112] = "TICKET_CLINIC_REFUND_OVERPAID";
    PermissionId[PermissionId["TICKET_CLINIC_SEND_PRODUCT"] = 5114] = "TICKET_CLINIC_SEND_PRODUCT";
    PermissionId[PermissionId["TICKET_CLINIC_RETURN_PRODUCT"] = 5115] = "TICKET_CLINIC_RETURN_PRODUCT";
    PermissionId[PermissionId["TICKET_CLINIC_CLOSE"] = 5116] = "TICKET_CLINIC_CLOSE";
    PermissionId[PermissionId["TICKET_CLINIC_REOPEN"] = 5117] = "TICKET_CLINIC_REOPEN";
    PermissionId[PermissionId["TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE"] = 5150] = "TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE";
    PermissionId[PermissionId["TICKET_CLINIC_USER_CHOOSE_USERID"] = 5160] = "TICKET_CLINIC_USER_CHOOSE_USERID";
    PermissionId[PermissionId["TICKET_CLINIC_USER_UPDATE_COMMISSION"] = 5161] = "TICKET_CLINIC_USER_UPDATE_COMMISSION";
    PermissionId[PermissionId["TICKET_PROCEDURE_RESULT"] = 110] = "TICKET_PROCEDURE_RESULT";
    PermissionId[PermissionId["TICKET_LABORATORY_RESULT"] = 120] = "TICKET_LABORATORY_RESULT";
    PermissionId[PermissionId["TICKET_RADIOLOGY_RESULT"] = 130] = "TICKET_RADIOLOGY_RESULT";
})(PermissionId || (exports.PermissionId = PermissionId = {}));
let Permission = Permission_1 = class Permission {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Permission_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Permission_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('identity', { name: 'id', generatedIdentity: 'BY DEFAULT' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "level", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "parentId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "rootId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "pathId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "isActive", void 0);
Permission = Permission_1 = __decorate([
    (0, typeorm_1.Entity)('Permission')
], Permission);
exports["default"] = Permission;


/***/ }),
/* 78 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PrescriptionSample_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let PrescriptionSample = PrescriptionSample_1 = class PrescriptionSample {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PrescriptionSample_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PrescriptionSample_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], PrescriptionSample.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    __metadata("design:type", String)
], PrescriptionSample.prototype, "medicines", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], PrescriptionSample.prototype, "medicineList", void 0);
PrescriptionSample = PrescriptionSample_1 = __decorate([
    (0, typeorm_1.Entity)('PrescriptionSample')
], PrescriptionSample);
exports["default"] = PrescriptionSample;


/***/ }),
/* 79 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProductMovement_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(45);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(47);
const distributor_entity_1 = __webpack_require__(49);
const product_entity_1 = __webpack_require__(54);
const receipt_entity_1 = __webpack_require__(51);
const stock_check_entity_1 = __webpack_require__(80);
const ticket_entity_1 = __webpack_require__(56);
const user_entity_1 = __webpack_require__(20);
let ProductMovement = ProductMovement_1 = class ProductMovement extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProductMovement_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costAmount = Number(raw.costAmount);
        entity.openQuantityProduct = Number(raw.openQuantityProduct);
        entity.closeQuantityProduct = Number(raw.closeQuantityProduct);
        entity.openQuantityBatch = Number(raw.openQuantityBatch);
        entity.closeQuantityBatch = Number(raw.closeQuantityBatch);
        entity.openCostAmountBatch = Number(raw.openCostAmountBatch);
        entity.closeCostAmountBatch = Number(raw.closeCostAmountBatch);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.actualPrice = Number(raw.actualPrice);
        entity.createdAt = raw.createdAt == null ? raw.createdAt : Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProductMovement_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.MovementType !== "undefined" && variable_1.MovementType) === "function" ? _a : Object)
], ProductMovement.prototype, "movementType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "contactId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "voucherId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "voucherProductId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "isRefund", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openQuantityProduct", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeQuantityProduct", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openQuantityBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeQuantityBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openCostAmountBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeCostAmountBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], ProductMovement.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _c : Object)
], ProductMovement.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => receipt_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof receipt_entity_1.default !== "undefined" && receipt_entity_1.default) === "function" ? _d : Object)
], ProductMovement.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _e : Object)
], ProductMovement.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _f : Object)
], ProductMovement.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => stock_check_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof stock_check_entity_1.default !== "undefined" && stock_check_entity_1.default) === "function" ? _g : Object)
], ProductMovement.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_h = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _h : Object)
], ProductMovement.prototype, "user", void 0);
ProductMovement = ProductMovement_1 = __decorate([
    (0, typeorm_1.Entity)('ProductMovement'),
    (0, typeorm_1.Index)('IDX_ProductMovement__oid_productId_id', ['oid', 'productId', 'id']),
    (0, typeorm_1.Index)('IDX_ProductMovement__oid_contactId_movementType_id', [
        'oid',
        'contactId',
        'movementType',
        'id',
    ])
], ProductMovement);
exports["default"] = ProductMovement;


/***/ }),
/* 80 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var StockCheck_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const stock_check_item_entity_1 = __webpack_require__(81);
const user_entity_1 = __webpack_require__(20);
var StockCheckStatus;
(function (StockCheckStatus) {
    StockCheckStatus[StockCheckStatus["Draft"] = 0] = "Draft";
    StockCheckStatus[StockCheckStatus["Pending"] = 1] = "Pending";
    StockCheckStatus[StockCheckStatus["Confirmed"] = 2] = "Confirmed";
    StockCheckStatus[StockCheckStatus["Balanced"] = 4] = "Balanced";
    StockCheckStatus[StockCheckStatus["Cancelled"] = 5] = "Cancelled";
})(StockCheckStatus || (exports.StockCheckStatus = StockCheckStatus = {}));
let StockCheck = StockCheck_1 = class StockCheck {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new StockCheck_1();
        Object.assign(entity, raw);
        entity.updatedAt = Number(raw.updatedAt);
        entity.createdAt = Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => StockCheck_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "createdByUserId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "updatedByUserId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], StockCheck.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => stock_check_item_entity_1.default, (stockCheckItem) => stockCheckItem.stockCheck),
    __metadata("design:type", Array)
], StockCheck.prototype, "stockCheckItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'createdByUserId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _a : Object)
], StockCheck.prototype, "createdByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'updatedByUserId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _b : Object)
], StockCheck.prototype, "updatedByUser", void 0);
StockCheck = StockCheck_1 = __decorate([
    (0, typeorm_1.Entity)('StockCheck'),
    (0, typeorm_1.Index)('IDX_StockCheck__oid_createdAt', ['oid', 'createdAt'])
], StockCheck);
exports["default"] = StockCheck;


/***/ }),
/* 81 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var StockCheckItem_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const batch_entity_1 = __webpack_require__(53);
const product_entity_1 = __webpack_require__(54);
const stock_check_entity_1 = __webpack_require__(80);
let StockCheckItem = StockCheckItem_1 = class StockCheckItem {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new StockCheckItem_1();
        Object.assign(entity, raw);
        entity.systemQuantity = Number(raw.systemQuantity);
        entity.actualQuantity = Number(raw.actualQuantity);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => StockCheckItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "stockCheckId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "systemQuantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "actualQuantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "systemCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "actualCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], StockCheckItem.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)(() => stock_check_entity_1.default, (stockCheck) => stockCheck.stockCheckItemList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'stockCheckId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof stock_check_entity_1.default !== "undefined" && stock_check_entity_1.default) === "function" ? _a : Object)
], StockCheckItem.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], StockCheckItem.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _c : Object)
], StockCheckItem.prototype, "batch", void 0);
StockCheckItem = StockCheckItem_1 = __decorate([
    (0, typeorm_1.Entity)('StockCheckItem'),
    (0, typeorm_1.Index)('IDX_StockCheckItem__oid_stockCheckId', ['oid', 'stockCheckId'])
], StockCheckItem);
exports["default"] = StockCheckItem;


/***/ }),
/* 82 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Warehouse_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let Warehouse = Warehouse_1 = class Warehouse {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Warehouse_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Warehouse_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Warehouse.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Warehouse.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], Warehouse.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Warehouse.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Warehouse.prototype, "deletedAt", void 0);
Warehouse = Warehouse_1 = __decorate([
    (0, typeorm_1.Entity)('Warehouse')
], Warehouse);
exports["default"] = Warehouse;


/***/ }),
/* 83 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports._PostgreSqlRepository = void 0;
const postgresql_raw_1 = __webpack_require__(84);
class _PostgreSqlRepository extends postgresql_raw_1.PostgreSqlRaw {
    constructor(entity, repository) {
        super();
        this.entity = entity;
        this.repository = repository;
    }
    async pagination(options) {
        const { limit, page, condition } = options;
        const where = this.getWhereOptions(condition);
        const order = options.sort;
        const relations = options.relation;
        const [data, total] = await this.repository.findAndCount({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            order,
            take: limit,
            skip: (page - 1) * limit,
        });
        return { total, page, limit, data };
    }
    async findMany(options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await this.repository.find({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            take: options.limit,
            order,
        });
    }
    async findManyBy(condition) {
        const where = this.getWhereOptions(condition);
        return await this.repository.findBy(where);
    }
    async findManyByIds(ids) {
        if (!ids.length)
            return [];
        return await this.findManyBy({ id: { IN: ids } });
    }
    async findOne(options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await this.repository.findOne({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'join',
            where,
            order,
        });
    }
    async findOneBy(condition) {
        const where = this.getWhereOptions(condition);
        return await this.repository.findOneBy(where);
    }
    async findOneById(id) {
        return await this.findOneBy({ id });
    }
    async countBy(condition) {
        const where = this.getWhereOptions(condition);
        const number = await this.repository.countBy(where);
        return number;
    }
    async insertMany(data) {
        if (!data.length)
            return [];
        const insertResult = await this.repository.insert(data);
        const idList = insertResult.identifiers.map((i) => i.id);
        return idList;
    }
    async insertManyFullField(data) {
        if (!data.length)
            return [];
        return this.insertMany(data);
    }
    async insertManyAndReturnRaws(data) {
        if (!data.length)
            return [];
        const insertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(data)
            .returning('*')
            .execute();
        const raws = insertResult.raw;
        return raws;
    }
    async insertManyAndReturnEntity(data) {
        const raws = await this.insertManyAndReturnRaws(data);
        return this.entity.fromRaws(raws);
    }
    async insertManyFullFieldAndReturnRaws(data) {
        if (!data.length)
            return [];
        const raws = this.insertManyAndReturnRaws(data);
        return raws;
    }
    async insertManyFullFieldAndReturnEntity(data) {
        const raws = await this.insertManyAndReturnRaws(data);
        return this.entity.fromRaws(raws);
    }
    async insertOne(data) {
        const insertResult = await this.repository.insert(data);
        const id = insertResult.identifiers[0].id;
        if (!id) {
            throw new Error(`Insert Database failed: ` + JSON.stringify({ insertResult, data }));
        }
        return id;
    }
    async insertOneFullField(data) {
        const id = this.insertOne(data);
        return id;
    }
    async insertOneAndReturnRaw(data) {
        var _a;
        const insertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(data)
            .returning('*')
            .execute();
        if (((_a = insertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== 1) {
            throw new Error(`Insert Database failed: ` + JSON.stringify({ insertResult, data }));
        }
        return insertResult.raw[0];
    }
    async insertOneAndReturnEntity(data) {
        const raw = await this.insertOneAndReturnRaw(data);
        return this.entity.fromRaw(raw);
    }
    async insertOneFullFieldAndReturnRaw(data) {
        const raw = this.insertOneAndReturnRaw(data);
        return raw;
    }
    async insertOneFullFieldAndReturnEntity(data) {
        const raw = await this.insertOneAndReturnRaw(data);
        return this.entity.fromRaw(raw);
    }
    async update(condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await this.repository.update(where, data);
        return updateResult.affected;
    }
    async updateAndReturnRaw(condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await this.repository
            .createQueryBuilder()
            .update()
            .where(where)
            .set(data)
            .returning('*')
            .execute();
        const raw = updateResult.raw;
        return raw;
    }
    async updateAndReturnEntity(condition, data) {
        const raws = await this.updateAndReturnRaw(condition, data);
        return this.entity.fromRaws(raws);
    }
    async updateOneAndReturnEntity(condition, data) {
        const raws = await this.updateAndReturnRaw(condition, data);
        if (raws.length !== 1) {
            throw new Error(`Update Database failed: ` + JSON.stringify({ raws }));
        }
        return this.entity.fromRaw(raws[0]);
    }
    async upsertByConflictUnique(options) {
        var _a;
        const { upsertList, updateFields, conflictFields } = options;
        const upsertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(upsertList)
            .orUpdate(updateFields, conflictFields)
            .returning('*')
            .execute();
        if (((_a = upsertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== upsertList.length) {
            throw new Error(`Insert Database failed: ` + JSON.stringify({ upsertResult, upsertList }));
        }
        return this.entity.fromRaws(upsertResult.raw);
    }
    async delete(condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await this.repository.delete(where);
        return deleteResult.affected;
    }
    async deleteAndReturnRaw(condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await this.repository
            .createQueryBuilder()
            .delete()
            .from(this.entity)
            .where(where)
            .returning('*')
            .execute();
        const raws = deleteResult.raw;
        return raws;
    }
    async deleteAndReturnEntity(condition) {
        const raws = await this.deleteAndReturnRaw(condition);
        return this.entity.fromRaws(raws);
    }
    async findAndSelect(options) {
        const { condition, select, aggregate, groupBy } = options;
        const where = this.getWhereOptions(condition);
        const selectList = [];
        if (select) {
            if (Array.isArray(select)) {
                select.forEach((column) => {
                    selectList.push(`"${column}"`);
                });
            }
            else {
                Object.keys(select).map((column) => {
                    if (select[column]) {
                        selectList.push(`"${column}"`);
                    }
                });
            }
        }
        if (aggregate) {
            Object.keys(aggregate).forEach((customField) => {
                if (aggregate[customField].COUNT) {
                    const column = aggregate[customField].COUNT;
                    if (column === '*') {
                        selectList.push(`COUNT(${column}) AS "${customField}"`);
                    }
                    else {
                        selectList.push(`COUNT("${column}") AS "${customField}"`);
                    }
                }
                else if (aggregate[customField].SUM) {
                    const sumString = aggregate[customField].SUM.map((operator) => {
                        if (typeof operator === 'string') {
                            const column = operator;
                            return `"${column}"`;
                        }
                        if (typeof operator === 'object') {
                            return this.getOperatorRaw(operator);
                        }
                    }).join('+');
                    selectList.push(`SUM(${sumString}) AS "${customField}"`);
                }
            });
        }
        let query = this.repository.createQueryBuilder().select(selectList).where(where).groupBy();
        if (groupBy && groupBy.length) {
            const groupString = groupBy.map((field) => `"${field}"`).join(', ');
            query = query.groupBy(groupString);
        }
        return await query.getRawMany();
    }
    async updateListAndReturnEntity(options) {
        const { updateList } = options;
        const updateFields = options.updateFields;
        const conditionFields = options.conditionFields;
        if (!updateList.length)
            return [];
        if (!conditionFields.length)
            return [];
        if (!conditionFields.length)
            return [];
        const tempField = [...conditionFields, ...updateFields];
        const tableName = this.entity['name'];
        const modifiedRaw = await this.repository.query(`
        UPDATE  "${tableName}"
        SET     ${updateFields.map((field) => `"${field}" = temp."${field}"`).join(', ')}
        FROM (VALUES `
            + updateList
                .map((record) => {
                return `(${tempField
                    .map((field) => {
                    if (typeof record[field] === 'number') {
                        return `${record[field]}`;
                    }
                    else if (typeof record[field] === 'string') {
                        return `'${record[field]}'`;
                    }
                    else {
                        return `${record[field]}`;
                    }
                })
                    .join(', ')})`;
            })
                .join(', ')
            + `   ) AS temp(${tempField.map((field) => `"${field}"`).join(', ')})
        WHERE     ${conditionFields.map((field) => `"${tableName}"."${field}" = "temp"."${field}"`).join(' AND ')}
        RETURNING "${tableName}".*;
        `);
        if (modifiedRaw[0].length !== updateList.length) {
            console.log('🚀 ~ _postgresql.repository.ts:353 ~ updateList:', updateList);
            console.log('🚀 ~ _postgresql.repository.ts:353 ~ modifiedRaw:', modifiedRaw);
            throw new Error(`Update Database failed: ` + JSON.stringify({ modifiedRaw, updateList }));
        }
        return this.entity.fromRaws(modifiedRaw[0]);
    }
}
exports._PostgreSqlRepository = _PostgreSqlRepository;


/***/ }),
/* 84 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgreSqlRaw = void 0;
const typeorm_1 = __webpack_require__(18);
const base_condition_1 = __webpack_require__(85);
const _CONVERT = (value) => {
    if (typeof value === 'boolean' && value)
        return `TRUE`;
    if (typeof value === 'boolean' && !value)
        return `FALSE`;
    if (typeof value === 'number')
        return `${value}`;
    if (typeof value === 'string')
        return `'${value}'`;
    return '';
};
class PostgreSqlRaw {
    getRawConditions(tableName, conditions = {}) {
        const conditionArray = Object.entries(conditions).map(([column, target]) => {
            if (column === '$OR') {
                const conditionOr = target.map((i) => this.getRawConditions(i));
                return `(${conditionOr.join(' OR ')})`;
            }
            if (target === undefined)
                return;
            if (target == null)
                return `"${tableName}"."${column}" IS NULL`;
            if (['number', 'string', 'boolean'].includes(typeof target)) {
                return `"${tableName}"."${column}" = ${_CONVERT(target)}`;
            }
            if (typeof target === 'object') {
                if (Object.keys(target).length === 0)
                    return;
                const ruleArray = Object.entries(target).map(([rule, value]) => {
                    if (value == null)
                        return;
                    if (rule === '>' || rule === 'GT') {
                        return `"${tableName}"."${column}" > ${_CONVERT(value)}`;
                    }
                    if (rule === '>=' || rule === 'GTE') {
                        return `"${tableName}"."${column}" >= ${_CONVERT(value)}`;
                    }
                    if (rule === '<' || rule === 'LT') {
                        return `"${tableName}"."${column}" < ${_CONVERT(value)}`;
                    }
                    if (rule === '<=' || rule === 'LTE') {
                        return `"${tableName}"."${column}" <= ${_CONVERT(value)}`;
                    }
                    if (rule === '==' || rule === 'EQUAL') {
                        return `"${tableName}"."${column}" = ${_CONVERT(value)}`;
                    }
                    if (rule === '!=' || rule === 'NOT') {
                        return `"${tableName}"."${column}" != ${_CONVERT(value)}`;
                    }
                    if (rule === 'IS_NULL') {
                        if (value === true)
                            return `"${tableName}"."${column}" IS NULL`;
                        if (value === false)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                    }
                    if (rule === 'NOT_NULL') {
                        if (value === true)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                        if (value === false)
                            return `"${tableName}"."${column}" IS NULL`;
                    }
                    if (rule === 'BETWEEN') {
                        return `"${tableName}"."${column}" BETWEEN ${_CONVERT(value[0])} AND ${_CONVERT(value[1])}`;
                    }
                    if (rule === 'IN') {
                        if (value.length === 0)
                            return `"${tableName}"."${column}" IS NULL`;
                        const temp = value.map((i) => _CONVERT(i)).join(',');
                        return `"${tableName}"."${column}" IN (${temp})`;
                    }
                    if (rule === 'NOT_IN') {
                        if (value.length === 0)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                        const temp = value.map((i) => _CONVERT(i)).join(',');
                        return `"${tableName}"."${column}" NOT IN (${temp})`;
                    }
                    if (rule === 'LIKE') {
                        return `"${tableName}"."${column}" LIKE %${(0, base_condition_1.escapeSearch)(value)}%`;
                    }
                    if (rule === 'RAW_QUERY') {
                        return value;
                    }
                });
                return `(${ruleArray.join(' AND ')})`;
            }
        });
        return conditionArray.join(' AND ');
    }
    getConditions(conditions = {}) {
        const where = {};
        Object.entries(conditions).forEach(([column, target]) => {
            if (target === undefined)
                return;
            if (target == null)
                return (where[column] = (0, typeorm_1.IsNull)());
            if (['number', 'string', 'boolean'].includes(typeof target)) {
                return (where[column] = target);
            }
            if (typeof target === 'object') {
                if (Object.keys(target).length === 0)
                    return;
                const operators = [];
                Object.entries(target).forEach(([rule, value]) => {
                    if (value == null)
                        return;
                    if (rule === '>' || rule === 'GT') {
                        return operators.push((0, typeorm_1.MoreThan)(value));
                    }
                    if (rule === '>=' || rule === 'GTE') {
                        return operators.push((0, typeorm_1.MoreThanOrEqual)(value));
                    }
                    if (rule === '<' || rule === 'LT') {
                        return operators.push((0, typeorm_1.LessThan)(value));
                    }
                    if (rule === '<=' || rule === 'LTE') {
                        return operators.push((0, typeorm_1.LessThanOrEqual)(value));
                    }
                    if (rule === '==' || rule === 'EQUAL') {
                        return operators.push((0, typeorm_1.Equal)(value));
                    }
                    if (rule === '!=' || rule === 'NOT') {
                        return operators.push((0, typeorm_1.Not)(value));
                    }
                    if (rule === 'IS_NULL') {
                        if (value === true)
                            return operators.push((0, typeorm_1.IsNull)());
                        if (value === false)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                    }
                    if (rule === 'NOT_NULL') {
                        if (value === true)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                        if (value === false)
                            return operators.push((0, typeorm_1.IsNull)());
                    }
                    if (rule === 'BETWEEN') {
                        return operators.push((0, typeorm_1.Between)(value[0], value[1]));
                    }
                    if (rule === 'IN') {
                        if (value.length === 0)
                            return operators.push((0, typeorm_1.IsNull)());
                        return operators.push((0, typeorm_1.In)(value));
                    }
                    if (rule === 'NOT_IN') {
                        if (value.length === 0)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                        return operators.push((0, typeorm_1.Not)((0, typeorm_1.In)(value)));
                    }
                    if (rule === 'LIKE') {
                        const textLike = `%${(0, base_condition_1.escapeSearch)(value)}%`;
                        return operators.push((0, typeorm_1.Like)(textLike));
                    }
                    if (rule === 'RAW_QUERY') {
                        return operators.push((0, typeorm_1.Raw)((alias) => `(${value})`));
                    }
                });
                if (operators.length === 1) {
                    where[column] = operators[0];
                }
                else if (operators.length > 1) {
                    where[column] = (0, typeorm_1.And)(...operators);
                }
            }
        });
        return where;
    }
    getWhereOptions(condition = {}) {
        if (Object.keys(condition).length === 0)
            return {};
        const { $OR } = condition, otherCondition = __rest(condition, ["$OR"]);
        if ($OR && $OR.length) {
            const conditionOr = [];
            $OR.forEach((i) => {
                if (!Object.keys(i).length)
                    return;
                conditionOr.push(this.getWhereOptions(Object.assign(Object.assign({}, otherCondition), i)));
            });
            conditionOr.flat().filter((i) => Object.keys(i).length);
            if (conditionOr.length === 0) {
                return this.getConditions(otherCondition);
            }
            else if (conditionOr.length === 1) {
                return conditionOr[0];
            }
            else {
                return conditionOr;
            }
        }
        else {
            return this.getConditions(otherCondition);
        }
    }
    getOperatorRaw(operator) {
        if (operator.ADD) {
            const str = operator.ADD.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('+');
            return `(${str})`;
        }
        if (operator.SUB) {
            const str = operator.SUB.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('-');
            return `(${str})`;
        }
        if (operator.MUL) {
            const str = operator.MUL.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('*');
            return `(${str})`;
        }
        if (operator.DIV) {
            const str = operator.DIV.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('/');
            return `(${str})`;
        }
    }
}
exports.PostgreSqlRaw = PostgreSqlRaw;


/***/ }),
/* 85 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.escapeSearch = void 0;
const escapeSearch = (str = '') => {
    return str.replace(/[?%\\_]/gi, (x) => '\\' + x);
};
exports.escapeSearch = escapeSearch;


/***/ }),
/* 86 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const permission_entity_1 = __webpack_require__(77);
const _postgresql_repository_1 = __webpack_require__(83);
let PermissionRepository = class PermissionRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(permissionRepository) {
        super(permission_entity_1.default, permissionRepository);
        this.permissionRepository = permissionRepository;
    }
    async upsert(data) {
        const insertResult = await this.permissionRepository
            .createQueryBuilder()
            .insert()
            .into(permission_entity_1.default)
            .values(data)
            .orUpdate(['level', 'code', 'name', 'parentId', 'rootId', 'pathId', 'isActive'], ['id'])
            .execute();
        return { idsEffect: insertResult.identifiers.map((i) => i.id) };
    }
};
exports.PermissionRepository = PermissionRepository;
exports.PermissionRepository = PermissionRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(permission_entity_1.default)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], PermissionRepository);


/***/ }),
/* 87 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let RoleRepository = class RoleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(roleRepository) {
        super(entities_1.Role, roleRepository);
        this.roleRepository = roleRepository;
    }
};
exports.RoleRepository = RoleRepository;
exports.RoleRepository = RoleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Role)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], RoleRepository);


/***/ }),
/* 88 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let SettingRepository = class SettingRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(settingRepository) {
        super(entities_1.Setting, settingRepository);
        this.settingRepository = settingRepository;
    }
    async upsertSetting(options) {
        const { oid, key, data } = options;
        const dto = this.settingRepository.create({ oid, key, data });
        return await this.settingRepository
            .createQueryBuilder()
            .insert()
            .into(entities_1.Setting)
            .values(dto)
            .orUpdate(['data'], ['oid', 'key'])
            .execute();
    }
};
exports.SettingRepository = SettingRepository;
exports.SettingRepository = SettingRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Setting)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], SettingRepository);


/***/ }),
/* 89 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const user_role_entity_1 = __webpack_require__(22);
const _postgresql_repository_1 = __webpack_require__(83);
let UserRoleRepository = class UserRoleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(userRoleRepository) {
        super(user_role_entity_1.default, userRoleRepository);
        this.userRoleRepository = userRoleRepository;
    }
};
exports.UserRoleRepository = UserRoleRepository;
exports.UserRoleRepository = UserRoleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(user_role_entity_1.default)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], UserRoleRepository);


/***/ }),
/* 90 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let UserRepository = class UserRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(userRepository) {
        super(entities_1.User, userRepository);
        this.userRepository = userRepository;
    }
};
exports.UserRepository = UserRepository;
exports.UserRepository = UserRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.User)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], UserRepository);


/***/ }),
/* 91 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.mergeObject = exports.arrayToKeyArray = exports.arrayToKeyValue = exports.uniqueArray = exports.ESArray = exports.ESObject = void 0;
class ESObject {
}
exports.ESObject = ESObject;
ESObject.keyBy = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};
class ESArray {
}
exports.ESArray = ESArray;
ESArray.arrayToKeyValue = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};
ESArray.arrayToKeyArray = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        if (!object[key])
            object[key] = [];
        object[key].push(item);
    });
    return object;
};
ESArray.checkDuplicate = (array, property) => {
    const map = new Map();
    array.forEach((item, index) => {
        const value = item[property];
        if (!map.has(value))
            map.set(value, []);
        map.get(value).push(index);
    });
    const result = [];
    for (const [value, indices] of map.entries()) {
        if (indices.length > 1) {
            result.push({ value, indices });
        }
    }
    return result;
};
ESArray.uniqueArray = (array) => {
    return Array.from(new Set(array));
};
const uniqueArray = (array) => {
    return Array.from(new Set(array));
};
exports.uniqueArray = uniqueArray;
const arrayToKeyValue = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};
exports.arrayToKeyValue = arrayToKeyValue;
const arrayToKeyArray = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        if (!object[key])
            object[key] = [];
        object[key].push(item);
    });
    return object;
};
exports.arrayToKeyArray = arrayToKeyArray;
const mergeObject = (...params) => {
    const mergeTwoObject = (source, target) => {
        for (const key in target) {
            if (target[key] === undefined)
                continue;
            if (typeof target[key] !== 'object'
                || Array.isArray(target[key])
                || target[key] instanceof Date) {
                source[key] = target[key];
            }
            else {
                if (typeof source[key] !== 'object') {
                    source[key] = {};
                }
                mergeTwoObject(source[key], target[key]);
            }
        }
    };
    for (let i = 1; i < params.length; i++) {
        mergeTwoObject(params[0], params[i]);
    }
};
exports.mergeObject = mergeObject;


/***/ }),
/* 92 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheTokenService = void 0;
const common_1 = __webpack_require__(3);
const redis_service_1 = __webpack_require__(37);
let CacheTokenService = class CacheTokenService {
    constructor(redisService) {
        this.redisService = redisService;
    }
    getKey(data) {
        return `TOKEN_${data.oid}_${data.uid}`;
    }
    async getTokenListByKey(key) {
        const value = await this.redisService.get(key);
        const object = JSON.parse(value || '[]');
        return object;
    }
    async setTokenList(key, tokenList) {
        const tokenListRemoveExpires = tokenList.filter((i) => i.refreshExp > Date.now());
        const value = JSON.stringify(tokenListRemoveExpires);
        await this.redisService.set(key, value);
    }
    async addAccessToken(data) {
        const key = this.getKey(data);
        const tokenList = await this.getTokenListByKey(key);
        const tokenListFix = tokenList.filter((i) => i.refreshExp !== data.refreshExp);
        tokenListFix.push(Object.assign(Object.assign({}, data), { online: Date.now() }));
        await this.setTokenList(key, tokenListFix);
    }
    async updateAccessToken(data) {
        const key = this.getKey(data);
        const tokenList = await this.getTokenListByKey(key);
        const currentToken = tokenList.find((i) => i.refreshExp === data.refreshExp);
        if (currentToken) {
            Object.assign(currentToken, Object.assign(Object.assign({}, data), { online: Date.now() }));
        }
        else {
            tokenList.push(Object.assign(Object.assign({}, data), { online: Date.now() }));
        }
        await this.setTokenList(key, tokenList);
    }
    async removeRefreshToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        const tokenListFix = tokenList.filter((i) => i.refreshExp !== options.refreshExp);
        await this.setTokenList(key, tokenListFix);
    }
    async removeAllRefreshToken(options) {
        const key = this.getKey(options);
        await this.setTokenList(key, []);
    }
    async checkAccessToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        const token = tokenList.find((i) => i.accessExp === options.accessExp);
        if (!token)
            return false;
        token.online = Date.now();
        await this.setTokenList(key, tokenList);
        return true;
    }
    async checkRefreshToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        return tokenList.some((i) => i.refreshExp === options.refreshExp);
    }
    async getTokenList(options) {
        const key = this.getKey(options);
        return this.getTokenListByKey(key);
    }
    async removeAllExcludeRoot() {
        const keys = await this.redisService.getKeys('TOKEN_*');
        const keyRoot = this.getKey({ oid: 1, uid: 1 });
        for (let i = 0; i < keys.length; i++) {
            if (keys[i] === keyRoot)
                continue;
            await this.redisService.del(keys[i]);
        }
    }
};
exports.CacheTokenService = CacheTokenService;
exports.CacheTokenService = CacheTokenService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof redis_service_1.RedisService !== "undefined" && redis_service_1.RedisService) === "function" ? _a : Object])
], CacheTokenService);


/***/ }),
/* 93 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionGuard = exports.HasPermissionOr = exports.HasPermission = exports.HAS_PERMISSION_OR = exports.HAS_PERMISSION = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
exports.HAS_PERMISSION = 'HAS_PERMISSION';
exports.HAS_PERMISSION_OR = 'HAS_PERMISSION_OR';
const HasPermission = (...permissionIds) => {
    return (0, common_1.SetMetadata)(exports.HAS_PERMISSION, permissionIds);
};
exports.HasPermission = HasPermission;
const HasPermissionOr = (...permissionIds) => {
    return (0, common_1.SetMetadata)(exports.HAS_PERMISSION_OR, permissionIds);
};
exports.HasPermissionOr = HasPermissionOr;
let PermissionGuard = class PermissionGuard {
    constructor(reflector, cacheDataService) {
        this.reflector = reflector;
        this.cacheDataService = cacheDataService;
    }
    async canActivate(context) {
        let permissionIdsAnd = this.reflector.getAllAndOverride(exports.HAS_PERMISSION, [
            context.getHandler(),
            context.getClass(),
        ]);
        let permissionIdsOr = this.reflector.getAllAndOverride(exports.HAS_PERMISSION_OR, [
            context.getHandler(),
            context.getClass(),
        ]);
        if (!permissionIdsAnd)
            permissionIdsAnd = [];
        if (!permissionIdsOr)
            permissionIdsOr = [];
        if (!permissionIdsAnd.length && !permissionIdsOr.length)
            return true;
        const request = context.switchToHttp().getRequest();
        const requestExternal = request.raw;
        const { external } = requestExternal;
        if (external.error) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!external.uid || !external.oid || !external.user || !external.organization) {
            throw new exception_filter_1.BusinessException('common.AccountRequired', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!!external.user.deletedAt || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (external.oid === 1)
            return true;
        const permissionMap = await this.cacheDataService.getPermissionAllMap();
        const checkPermissionId = (permissionId) => {
            const permission = permissionMap[permissionId];
            const pathIdArr = permission.pathId.split('.').map((i) => Number(i));
            for (let i = 0; i < pathIdArr.length; i++) {
                const id = pathIdArr[i];
                const curPermission = permissionMap[id];
                if (!curPermission.isActive) {
                    return false;
                }
            }
            const organizationPermissionIds = JSON.parse(external.organization.permissionIds || '[]');
            if (!organizationPermissionIds.includes(permission.rootId)) {
                return false;
            }
            if (external.user.isAdmin)
                return true;
            return pathIdArr.some((pid) => external.permissionIds.includes(pid));
        };
        if (permissionIdsAnd.length) {
            const checkAnd = permissionIdsAnd.every(checkPermissionId);
            if (!checkAnd) {
                const permissionNameArr = permissionIdsAnd.map((i) => permissionMap[i].name).join(', ');
                throw new exception_filter_1.BusinessException('common.ForbiddenPermission', { permission: permissionNameArr }, common_1.HttpStatus.FORBIDDEN);
            }
        }
        if (permissionIdsOr.length) {
            const checkOr = permissionIdsOr.some(checkPermissionId);
            if (!checkOr) {
                const permissionNameArr = permissionIdsOr.map((i) => permissionMap[i].name).join(', ');
                throw new exception_filter_1.BusinessException('common.ForbiddenPermission', { permission: permissionNameArr }, common_1.HttpStatus.FORBIDDEN);
            }
        }
        return true;
    }
};
exports.PermissionGuard = PermissionGuard;
exports.PermissionGuard = PermissionGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object])
], PermissionGuard);


/***/ }),
/* 94 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtExtendModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const jwt_1 = __webpack_require__(95);
const jwt_extend_service_1 = __webpack_require__(96);
const jwt_config_1 = __webpack_require__(97);
let JwtExtendModule = class JwtExtendModule {
};
exports.JwtExtendModule = JwtExtendModule;
exports.JwtExtendModule = JwtExtendModule = __decorate([
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig), jwt_1.JwtModule],
        providers: [jwt_extend_service_1.JwtExtendService],
        exports: [jwt_extend_service_1.JwtExtendService],
    })
], JwtExtendModule);


/***/ }),
/* 95 */
/***/ ((module) => {

module.exports = require("@nestjs/jwt");

/***/ }),
/* 96 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtExtendService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const jwt_1 = __webpack_require__(95);
const exception_filter_1 = __webpack_require__(9);
const jwt_config_1 = __webpack_require__(97);
let JwtExtendService = class JwtExtendService {
    constructor(jwtConfig, jwtService) {
        this.jwtConfig = jwtConfig;
        this.jwtService = jwtService;
    }
    createAccessToken(user, ip) {
        const userPayload = {
            oid: user.organization.id,
            uid: user.id,
        };
        const exp = Math.floor((Date.now() + this.jwtConfig.accessTime) / 1000);
        const accessToken = this.jwtService.sign({ exp, data: userPayload }, { secret: this.jwtConfig.accessKey });
        return { accessToken, accessExp: exp * 1000 };
    }
    createRefreshToken(user, ip) {
        const userPayload = {
            oid: user.organization.id,
            uid: user.id,
        };
        const exp = Math.floor((Date.now() + this.jwtConfig.refreshTime) / 1000);
        const refreshToken = this.jwtService.sign({ exp, data: userPayload }, { secret: this.jwtConfig.refreshKey });
        return { refreshToken, refreshExp: exp * 1000 };
    }
    createTokenFromUser(user, ip) {
        const { accessToken, accessExp } = this.createAccessToken(user, ip);
        const { refreshToken, refreshExp } = this.createRefreshToken(user, ip);
        return { accessToken, refreshToken, accessExp, refreshExp };
    }
    verifyAccessToken(accessToken, ip) {
        try {
            const jwtPayload = this.jwtService.verify(accessToken, {
                secret: this.jwtConfig.accessKey,
            });
            const data = jwtPayload.data;
            return {
                data: jwtPayload.data,
                exp: jwtPayload.exp * 1000,
                iat: jwtPayload.iat * 1000,
            };
        }
        catch (error) {
            if (error.name === 'TokenExpiredError') {
                throw new exception_filter_1.BusinessException('error.Token.AccessTokenExpired', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            else if (error.name === 'JsonWebTokenError') {
                throw new exception_filter_1.BusinessException('error.Token.Invalid', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            throw error;
        }
    }
    verifyRefreshToken(refreshToken, ip) {
        try {
            const jwtPayload = this.jwtService.verify(refreshToken, {
                secret: this.jwtConfig.refreshKey,
            });
            const data = jwtPayload.data;
            return {
                data: jwtPayload.data,
                exp: jwtPayload.exp * 1000,
                iat: jwtPayload.iat * 1000,
            };
        }
        catch (error) {
            if (error.name === 'TokenExpiredError') {
                throw new exception_filter_1.BusinessException('error.Token.RefreshTokenExpired', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            else if (error.name === 'JsonWebTokenError') {
                throw new exception_filter_1.BusinessException('error.Token.Invalid', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            throw error;
        }
    }
    decodeRefreshToken(refreshToken) {
        const jwtPayload = this.jwtService.decode(refreshToken);
        return {
            data: jwtPayload.data,
            exp: jwtPayload.exp * 1000,
            iat: jwtPayload.iat * 1000,
        };
    }
};
exports.JwtExtendService = JwtExtendService;
exports.JwtExtendService = JwtExtendService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _b : Object])
], JwtExtendService);


/***/ }),
/* 97 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtConfig = void 0;
const config_1 = __webpack_require__(30);
exports.JwtConfig = (0, config_1.registerAs)('jwt', () => ({
    accessKey: process.env.JWT_ACCESS_KEY,
    refreshKey: process.env.JWT_REFRESH_KEY,
    accessTime: Number(process.env.JWT_ACCESS_TIME),
    refreshTime: Number(process.env.JWT_REFRESH_TIME),
}));


/***/ }),
/* 98 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DetectClientMiddleware = void 0;
const common_1 = __webpack_require__(3);
const request_ip_1 = __webpack_require__(8);
const cache_data_service_1 = __webpack_require__(39);
const cache_token_service_1 = __webpack_require__(92);
const jwt_extend_service_1 = __webpack_require__(96);
let DetectClientMiddleware = class DetectClientMiddleware {
    constructor(jwtExtendService, cacheTokenService, cacheDataService) {
        this.jwtExtendService = jwtExtendService;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
    }
    async use(request, response, next) {
        if (request.method === 'OPTIONS')
            return next();
        const os = request.headers['x-os'];
        const browser = request.headers['x-browser'];
        const mobile = request.headers['x-mobile'];
        const clientId = request.headers['x-client-id'];
        const authorization = request.headers.authorization || '';
        const ip = (0, request_ip_1.getClientIp)(request);
        const dataExternal = {
            clientId,
            ip,
            os,
            browser,
            mobile: mobile === '1' ? 1 : 0,
            uid: null,
            oid: null,
            user: null,
            organization: null,
            permissionIds: [],
            error: null,
        };
        const [, accessToken] = authorization.split(' ');
        if (accessToken) {
            try {
                const decode = this.jwtExtendService.verifyAccessToken(accessToken, ip);
                const { oid, uid } = decode.data;
                dataExternal.oid = oid;
                dataExternal.uid = uid;
                const checkTokenCache = await this.cacheTokenService.checkAccessToken({
                    oid,
                    uid,
                    accessExp: decode.exp,
                });
                if (checkTokenCache) {
                    dataExternal.user = await this.cacheDataService.getUser(oid, uid);
                    dataExternal.organization = await this.cacheDataService.getOrganization(oid);
                    dataExternal.permissionIds = await this.cacheDataService.getPermissionIdsByUserId(oid, uid);
                }
                else {
                    dataExternal.error = 'error.Token.AccessTokenNoCache';
                    if (process.env.NODE_ENV !== 'production') {
                    }
                }
            }
            catch (error) {
                dataExternal.error = error.message;
            }
        }
        const requestExternal = request;
        requestExternal.external = dataExternal;
        return next();
    }
};
exports.DetectClientMiddleware = DetectClientMiddleware;
exports.DetectClientMiddleware = DetectClientMiddleware = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _a : Object, typeof (_b = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object])
], DetectClientMiddleware);


/***/ }),
/* 99 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const typeorm_1 = __webpack_require__(42);
const EntityList = __webpack_require__(43);
const ManagerList = __webpack_require__(100);
const OperationList = __webpack_require__(144);
const postgresql_config_1 = __webpack_require__(229);
const RepositoryList = __webpack_require__(170);
let PostgresqlModule = class PostgresqlModule {
};
exports.PostgresqlModule = PostgresqlModule;
exports.PostgresqlModule = PostgresqlModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [
            typeorm_1.TypeOrmModule.forRootAsync({
                imports: [config_1.ConfigModule.forFeature(postgresql_config_1.PostgresqlConfig)],
                inject: [postgresql_config_1.PostgresqlConfig.KEY],
                useFactory: (sqlConfig) => sqlConfig,
            }),
            typeorm_1.TypeOrmModule.forFeature(Object.values(EntityList)),
        ],
        providers: [
            ...Object.values(ManagerList),
            ...Object.values(RepositoryList),
            ...Object.values(OperationList),
        ],
        exports: [
            ...Object.values(ManagerList),
            ...Object.values(RepositoryList),
            ...Object.values(OperationList),
        ],
    })
], PostgresqlModule);


/***/ }),
/* 100 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(101), exports);
__exportStar(__webpack_require__(103), exports);
__exportStar(__webpack_require__(104), exports);
__exportStar(__webpack_require__(105), exports);
__exportStar(__webpack_require__(106), exports);
__exportStar(__webpack_require__(107), exports);
__exportStar(__webpack_require__(108), exports);
__exportStar(__webpack_require__(109), exports);
__exportStar(__webpack_require__(110), exports);
__exportStar(__webpack_require__(111), exports);
__exportStar(__webpack_require__(112), exports);
__exportStar(__webpack_require__(113), exports);
__exportStar(__webpack_require__(114), exports);
__exportStar(__webpack_require__(115), exports);
__exportStar(__webpack_require__(116), exports);
__exportStar(__webpack_require__(117), exports);
__exportStar(__webpack_require__(118), exports);
__exportStar(__webpack_require__(119), exports);
__exportStar(__webpack_require__(120), exports);
__exportStar(__webpack_require__(121), exports);
__exportStar(__webpack_require__(122), exports);
__exportStar(__webpack_require__(123), exports);
__exportStar(__webpack_require__(124), exports);
__exportStar(__webpack_require__(125), exports);
__exportStar(__webpack_require__(126), exports);
__exportStar(__webpack_require__(127), exports);
__exportStar(__webpack_require__(128), exports);
__exportStar(__webpack_require__(129), exports);
__exportStar(__webpack_require__(130), exports);
__exportStar(__webpack_require__(131), exports);
__exportStar(__webpack_require__(132), exports);
__exportStar(__webpack_require__(133), exports);
__exportStar(__webpack_require__(134), exports);
__exportStar(__webpack_require__(135), exports);
__exportStar(__webpack_require__(136), exports);
__exportStar(__webpack_require__(137), exports);
__exportStar(__webpack_require__(138), exports);
__exportStar(__webpack_require__(139), exports);
__exportStar(__webpack_require__(140), exports);
__exportStar(__webpack_require__(141), exports);
__exportStar(__webpack_require__(142), exports);
__exportStar(__webpack_require__(143), exports);


/***/ }),
/* 101 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let AppointmentManager = class AppointmentManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Appointment);
    }
};
exports.AppointmentManager = AppointmentManager;
exports.AppointmentManager = AppointmentManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], AppointmentManager);


/***/ }),
/* 102 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports._PostgreSqlManager = void 0;
const postgresql_raw_1 = __webpack_require__(84);
class _PostgreSqlManager extends postgresql_raw_1.PostgreSqlRaw {
    constructor(entity) {
        super();
        this.entity = entity;
    }
    async findMany(manager, options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await manager.find(this.entity, {
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            take: options.limit,
            order,
        });
    }
    async findManyBy(manager, condition) {
        const where = this.getWhereOptions(condition);
        return await manager.findBy(this.entity, where);
    }
    async findOne(manager, options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await manager.findOne(this.entity, {
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'join',
            where,
            order,
        });
    }
    async findOneBy(manager, condition) {
        const where = this.getWhereOptions(condition);
        return await manager.findOneBy(this.entity, where);
    }
    async insertMany(manager, data) {
        if (!data.length)
            return [];
        const insertResult = await manager.insert(this.entity, data);
        const idList = insertResult.identifiers.map((i) => i.id);
        return idList;
    }
    async insertManyFullField(manager, data) {
        if (!data.length)
            return [];
        return this.insertMany(manager, data);
    }
    async insertManyAndReturnRaws(manager, data) {
        if (!data.length)
            return [];
        const insertResult = await manager
            .createQueryBuilder()
            .insert()
            .into(this.entity)
            .values(data)
            .returning('*')
            .execute();
        const raws = insertResult.raw;
        return raws;
    }
    async insertManyAndReturnEntity(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return this.entity.fromRaws(raws);
    }
    async insertManyFullFieldAndReturnRaws(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return raws;
    }
    async insertManyFullFieldAndReturnEntity(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return this.entity.fromRaws(raws);
    }
    async insertOne(manager, data) {
        const insertResult = await manager.insert(this.entity, data);
        const id = insertResult.identifiers[0].id;
        if (!id) {
            throw new Error(`Insert ${this.entity['name']} failed: ` + JSON.stringify({ insertResult, data }));
        }
        return id;
    }
    async insertOneFullField(manager, data) {
        const id = this.insertOne(manager, data);
        return id;
    }
    async insertOneAndReturnRaw(manager, data) {
        var _a;
        const insertResult = await manager
            .createQueryBuilder()
            .insert()
            .into(this.entity)
            .values(data)
            .returning('*')
            .execute();
        if (((_a = insertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== 1) {
            throw new Error(`Insert ${this.entity['name']} failed: ` + JSON.stringify({ insertResult, data }));
        }
        return insertResult.raw[0];
    }
    async insertOneAndReturnEntity(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return this.entity.fromRaw(raw);
    }
    async insertOneFullFieldAndReturnRaw(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return raw;
    }
    async insertOneFullFieldAndReturnEntity(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return this.entity.fromRaw(raw);
    }
    async update(manager, condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await manager.update(this.entity, where, data);
        return updateResult.affected;
    }
    async updateAndReturnRaw(manager, condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await manager
            .createQueryBuilder()
            .update(this.entity)
            .where(where)
            .set(data)
            .returning('*')
            .execute();
        const raws = updateResult.raw;
        return raws;
    }
    async updateAndReturnEntity(manager, condition, data) {
        const raws = await this.updateAndReturnRaw(manager, condition, data);
        return this.entity.fromRaws(raws);
    }
    async updateOneAndReturnEntity(manager, condition, data) {
        const raws = await this.updateAndReturnRaw(manager, condition, data);
        if (raws.length !== 1) {
            throw new Error(`Update ${this.entity['name']} failed: ` + JSON.stringify({ raws }));
        }
        return this.entity.fromRaw(raws[0]);
    }
    async upsertByConflictUnique(options) {
        var _a;
        const { manager, upsertList, updateFields, conflictFields } = options;
        const upsertResult = await manager
            .createQueryBuilder()
            .insert()
            .values(upsertList)
            .orUpdate(updateFields, conflictFields)
            .execute();
        if (((_a = upsertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== upsertList.length) {
            throw new Error(`Insert ${this.entity['name']} failed: ` + JSON.stringify({ upsertResult, upsertList }));
        }
        return this.entity.fromRaws(upsertResult.raw);
    }
    async delete(manager, condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await manager.delete(this.entity, where);
        const affected = deleteResult.affected;
        return affected;
    }
    async deleteAndReturnRaw(manager, condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await manager
            .createQueryBuilder()
            .delete()
            .from(this.entity)
            .where(where)
            .returning('*')
            .execute();
        const raws = deleteResult.raw;
        return raws;
    }
    async deleteAndReturnEntity(manager, condition) {
        const raws = await this.deleteAndReturnRaw(manager, condition);
        return this.entity.fromRaws(raws);
    }
    async deleteOneAndReturnEntity(manager, condition) {
        const raws = await this.deleteAndReturnRaw(manager, condition);
        if (raws.length !== 1) {
            throw new Error(`Delete ${this.entity['name']} failed: ` + JSON.stringify({ raws }));
        }
        return this.entity.fromRaw(raws[0]);
    }
    async bulkUpdate(options) {
        var _a;
        const { manager } = options;
        const tableName = this.entity['name'];
        const tempList = options.tempList || [];
        if (!tempList.length)
            return [];
        let compareName = [];
        let compareObject = {};
        let conditionRaw = '';
        if (options.condition) {
            conditionRaw = this.getRawConditions(tableName, options.condition);
        }
        if (Array.isArray(options.compare)) {
            compareName = [...options.compare];
            options.compare.forEach((field) => {
                compareObject[field] = true;
            });
        }
        else {
            compareName = Object.keys(options.compare);
            compareObject = Object.assign({}, options.compare);
        }
        let updateName = [];
        let updateObject = {};
        if (Array.isArray(options.update)) {
            updateName = [...options.update];
            options.update.forEach((field) => {
                updateObject[field] = true;
            });
        }
        else {
            updateName = Object.keys(options.update);
            updateObject = Object.assign({}, options.update);
        }
        if (!updateName.length)
            return [];
        const tempColumns = Object.keys(tempList[0]);
        const modifiedRaw = await manager.query(`
      UPDATE  "${tableName}"
      SET     ${updateName.map((field) => {
            if (typeof updateObject[field] === 'function') {
                return `"${field}" = ${updateObject[field]('temp', tableName)}`;
            }
            else if (typeof updateObject[field] === 'object') {
                return `"${field}" = "temp"."${field}"::${updateObject[field].cast}`;
            }
            else {
                return `"${field}" = "temp"."${field}"`;
            }
        }).join(`,
              `)}
      FROM (VALUES `
            + tempList
                .map((record) => {
                return `(${tempColumns
                    .map((field) => {
                    if (record[field] === null) {
                        return `NULL`;
                    }
                    else if (typeof record[field] === 'number') {
                        return `${record[field]}`;
                    }
                    else if (typeof record[field] === 'string') {
                        return `'${record[field]}'`;
                    }
                    else {
                        return `${record[field]}`;
                    }
                })
                    .join(', ')})`;
            })
                .join(', ')
            + `) 
          AS temp(${tempColumns.map((field) => `"${field}"`).join(', ')})
      WHERE   ${conditionRaw
                ? conditionRaw
                    + ` 
          AND `
                : ''}${compareName.map((field) => {
                if (typeof compareObject[field] !== 'function') {
                    return `"${tableName}"."${field}" = "temp"."${field}"`;
                }
                else {
                    return `"${tableName}"."${field}" = ${compareObject[field]('temp', tableName)}`;
                }
            }).join(` 
          AND `)}
      RETURNING "${tableName}".*;
      `);
        if ((_a = options.options) === null || _a === void 0 ? void 0 : _a.requireEqualLength) {
            if (modifiedRaw[0].length !== tempList.length) {
                console.log(`Update ${tableName} failed: `, modifiedRaw);
                throw new Error(`Update ${tableName} failed: ` + JSON.stringify({ modifiedRaw, tempList }));
            }
        }
        return this.entity.fromRaws(modifiedRaw[0]);
    }
}
exports._PostgreSqlManager = _PostgreSqlManager;


/***/ }),
/* 103 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let BatchManager = class BatchManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Batch);
    }
};
exports.BatchManager = BatchManager;
exports.BatchManager = BatchManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], BatchManager);


/***/ }),
/* 104 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let CommissionManager = class CommissionManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Commission);
    }
};
exports.CommissionManager = CommissionManager;
exports.CommissionManager = CommissionManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CommissionManager);


/***/ }),
/* 105 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let CustomerSourceManager = class CustomerSourceManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.CustomerSource);
    }
};
exports.CustomerSourceManager = CustomerSourceManager;
exports.CustomerSourceManager = CustomerSourceManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CustomerSourceManager);


/***/ }),
/* 106 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let CustomerManager = class CustomerManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Customer);
    }
};
exports.CustomerManager = CustomerManager;
exports.CustomerManager = CustomerManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CustomerManager);


/***/ }),
/* 107 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let DistributorManager = class DistributorManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Distributor);
    }
};
exports.DistributorManager = DistributorManager;
exports.DistributorManager = DistributorManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], DistributorManager);


/***/ }),
/* 108 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ImageManager = class ImageManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Image);
    }
};
exports.ImageManager = ImageManager;
exports.ImageManager = ImageManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ImageManager);


/***/ }),
/* 109 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let LaboratoryGroupManager = class LaboratoryGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.LaboratoryGroup);
    }
};
exports.LaboratoryGroupManager = LaboratoryGroupManager;
exports.LaboratoryGroupManager = LaboratoryGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratoryGroupManager);


/***/ }),
/* 110 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryKitManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let LaboratoryKitManager = class LaboratoryKitManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.LaboratoryKit);
    }
};
exports.LaboratoryKitManager = LaboratoryKitManager;
exports.LaboratoryKitManager = LaboratoryKitManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratoryKitManager);


/***/ }),
/* 111 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let LaboratoryManager = class LaboratoryManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Laboratory);
    }
};
exports.LaboratoryManager = LaboratoryManager;
exports.LaboratoryManager = LaboratoryManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratoryManager);


/***/ }),
/* 112 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let PaymentMethodManager = class PaymentMethodManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PaymentMethod);
    }
};
exports.PaymentMethodManager = PaymentMethodManager;
exports.PaymentMethodManager = PaymentMethodManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PaymentMethodManager);


/***/ }),
/* 113 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let PaymentManager = class PaymentManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Payment);
    }
};
exports.PaymentManager = PaymentManager;
exports.PaymentManager = PaymentManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PaymentManager);


/***/ }),
/* 114 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let PermissionManager = class PermissionManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Permission);
    }
};
exports.PermissionManager = PermissionManager;
exports.PermissionManager = PermissionManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PermissionManager);


/***/ }),
/* 115 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let PrescriptionSampleManager = class PrescriptionSampleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PrescriptionSample);
    }
};
exports.PrescriptionSampleManager = PrescriptionSampleManager;
exports.PrescriptionSampleManager = PrescriptionSampleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrescriptionSampleManager);


/***/ }),
/* 116 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let PrintHtmlManager = class PrintHtmlManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PrintHtml);
    }
};
exports.PrintHtmlManager = PrintHtmlManager;
exports.PrintHtmlManager = PrintHtmlManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrintHtmlManager);


/***/ }),
/* 117 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ProcedureManager = class ProcedureManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Procedure);
    }
};
exports.ProcedureManager = ProcedureManager;
exports.ProcedureManager = ProcedureManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProcedureManager);


/***/ }),
/* 118 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ProductGroupManager = class ProductGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ProductGroup);
    }
};
exports.ProductGroupManager = ProductGroupManager;
exports.ProductGroupManager = ProductGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductGroupManager);


/***/ }),
/* 119 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ProductMovementManager = class ProductMovementManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ProductMovement);
    }
};
exports.ProductMovementManager = ProductMovementManager;
exports.ProductMovementManager = ProductMovementManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductMovementManager);


/***/ }),
/* 120 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ProductManager = class ProductManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Product);
    }
    async reCalculateQuantityBySumBatchList(options) {
        const { manager, oid, productIdList } = options;
        const resultQuery = await manager.query(`
        UPDATE  "Product" "product" 
        SET     "quantity" = "sbq"."sumQuantity"
        FROM    ( 
                SELECT "productId", SUM("quantity") as "sumQuantity" 
                    FROM "Batch" 
                    WHERE "Batch"."productId" IN (${productIdList.toString()})
                        AND "Batch"."oid" = ${oid}
                    GROUP BY "productId" 
                ) AS "sbq" 
        WHERE   "product"."id" = "sbq"."productId" 
            AND "product"."id" IN (${productIdList.toString()})
            AND "product"."oid" = ${oid}
        RETURNING "product".*
    `);
        return entities_1.Product.fromRaws(resultQuery[0]);
    }
};
exports.ProductManager = ProductManager;
exports.ProductManager = ProductManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductManager);


/***/ }),
/* 121 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let RadiologyGroupManager = class RadiologyGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.RadiologyGroup);
    }
};
exports.RadiologyGroupManager = RadiologyGroupManager;
exports.RadiologyGroupManager = RadiologyGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RadiologyGroupManager);


/***/ }),
/* 122 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let RadiologyManager = class RadiologyManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Radiology);
    }
};
exports.RadiologyManager = RadiologyManager;
exports.RadiologyManager = RadiologyManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RadiologyManager);


/***/ }),
/* 123 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptItemManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ReceiptItemManager = class ReceiptItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ReceiptItem);
    }
};
exports.ReceiptItemManager = ReceiptItemManager;
exports.ReceiptItemManager = ReceiptItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ReceiptItemManager);


/***/ }),
/* 124 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let ReceiptManager = class ReceiptManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Receipt);
    }
};
exports.ReceiptManager = ReceiptManager;
exports.ReceiptManager = ReceiptManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ReceiptManager);


/***/ }),
/* 125 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let RoleManager = class RoleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Role);
    }
};
exports.RoleManager = RoleManager;
exports.RoleManager = RoleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RoleManager);


/***/ }),
/* 126 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let SettingManager = class SettingManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Setting);
    }
};
exports.SettingManager = SettingManager;
exports.SettingManager = SettingManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], SettingManager);


/***/ }),
/* 127 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckItemManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let StockCheckItemManager = class StockCheckItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.StockCheckItem);
    }
};
exports.StockCheckItemManager = StockCheckItemManager;
exports.StockCheckItemManager = StockCheckItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], StockCheckItemManager);


/***/ }),
/* 128 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let StockCheckManager = class StockCheckManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.StockCheck);
    }
};
exports.StockCheckManager = StockCheckManager;
exports.StockCheckManager = StockCheckManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], StockCheckManager);


/***/ }),
/* 129 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAttributeManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketAttributeManager = class TicketAttributeManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketAttribute);
    }
};
exports.TicketAttributeManager = TicketAttributeManager;
exports.TicketAttributeManager = TicketAttributeManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketAttributeManager);


/***/ }),
/* 130 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketBatchManager = class TicketBatchManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketBatch);
    }
};
exports.TicketBatchManager = TicketBatchManager;
exports.TicketBatchManager = TicketBatchManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketBatchManager);


/***/ }),
/* 131 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketExpenseManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketExpenseManager = class TicketExpenseManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketExpense);
    }
};
exports.TicketExpenseManager = TicketExpenseManager;
exports.TicketExpenseManager = TicketExpenseManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketExpenseManager);


/***/ }),
/* 132 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGroupManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketLaboratoryGroupManager = class TicketLaboratoryGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratoryGroup);
    }
};
exports.TicketLaboratoryGroupManager = TicketLaboratoryGroupManager;
exports.TicketLaboratoryGroupManager = TicketLaboratoryGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryGroupManager);


/***/ }),
/* 133 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryResultManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketLaboratoryResultManager = class TicketLaboratoryResultManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratoryResult);
    }
};
exports.TicketLaboratoryResultManager = TicketLaboratoryResultManager;
exports.TicketLaboratoryResultManager = TicketLaboratoryResultManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryResultManager);


/***/ }),
/* 134 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketLaboratoryManager = class TicketLaboratoryManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratory);
    }
};
exports.TicketLaboratoryManager = TicketLaboratoryManager;
exports.TicketLaboratoryManager = TicketLaboratoryManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryManager);


/***/ }),
/* 135 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketProcedureManager = class TicketProcedureManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketProcedure);
    }
};
exports.TicketProcedureManager = TicketProcedureManager;
exports.TicketProcedureManager = TicketProcedureManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketProcedureManager);


/***/ }),
/* 136 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketProductManager = class TicketProductManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketProduct);
    }
};
exports.TicketProductManager = TicketProductManager;
exports.TicketProductManager = TicketProductManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketProductManager);


/***/ }),
/* 137 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketRadiologyManager = class TicketRadiologyManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketRadiology);
    }
};
exports.TicketRadiologyManager = TicketRadiologyManager;
exports.TicketRadiologyManager = TicketRadiologyManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketRadiologyManager);


/***/ }),
/* 138 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSurchargeManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketSurchargeManager = class TicketSurchargeManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketSurcharge);
    }
};
exports.TicketSurchargeManager = TicketSurchargeManager;
exports.TicketSurchargeManager = TicketSurchargeManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketSurchargeManager);


/***/ }),
/* 139 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUserManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketUserManager = class TicketUserManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketUser);
    }
    async changeQuantityByTicketItem(options) {
        const { manager, information, dataChange } = options;
        const { oid, ticketId } = information;
        const modifiedRaw = await manager.query(`
        UPDATE  "TicketUser"
        SET     "quantity"  = temp."quantity"
        FROM (VALUES `
            + dataChange
                .map(({ ticketItemId, quantity }) => {
                return `(${ticketItemId}, ${quantity})`;
            })
                .join(', ')
            + `   ) AS temp("ticketItemId", "quantity")
        WHERE   "TicketUser"."oid"          = ${oid}
            AND "TicketUser"."ticketId"     = ${ticketId}
            AND "TicketUser"."interactType" = ${information.interactType}
            AND "TicketUser"."ticketItemId" = temp."ticketItemId"
        RETURNING "TicketUser".*;
        `);
        const modifiedList = entities_1.TicketUser.fromRaws(modifiedRaw[0]);
        const ticketUserModifiedList = modifiedList.filter((i) => i.quantity > 0);
        const emptyList = modifiedList.filter((i) => i.quantity === 0);
        let ticketUserDestroyedList = [];
        if (emptyList.length) {
            ticketUserDestroyedList = await this.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                id: { IN: emptyList.map((i) => i.id) },
            });
        }
        return { ticketUserModifiedList, ticketUserDestroyedList };
    }
};
exports.TicketUserManager = TicketUserManager;
exports.TicketUserManager = TicketUserManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketUserManager);


/***/ }),
/* 140 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let TicketManager = class TicketManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Ticket);
    }
};
exports.TicketManager = TicketManager;
exports.TicketManager = TicketManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketManager);


/***/ }),
/* 141 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let UserRoleManager = class UserRoleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.UserRole);
    }
};
exports.UserRoleManager = UserRoleManager;
exports.UserRoleManager = UserRoleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], UserRoleManager);


/***/ }),
/* 142 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let UserManager = class UserManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.User);
    }
};
exports.UserManager = UserManager;
exports.UserManager = UserManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], UserManager);


/***/ }),
/* 143 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseManager = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(43);
const _postgresql_manager_1 = __webpack_require__(102);
let WarehouseManager = class WarehouseManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Warehouse);
    }
};
exports.WarehouseManager = WarehouseManager;
exports.WarehouseManager = WarehouseManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], WarehouseManager);


/***/ }),
/* 144 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(145), exports);
__exportStar(__webpack_require__(147), exports);
__exportStar(__webpack_require__(148), exports);
__exportStar(__webpack_require__(149), exports);
__exportStar(__webpack_require__(150), exports);
__exportStar(__webpack_require__(151), exports);
__exportStar(__webpack_require__(152), exports);
__exportStar(__webpack_require__(153), exports);
__exportStar(__webpack_require__(154), exports);
__exportStar(__webpack_require__(155), exports);
__exportStar(__webpack_require__(156), exports);
__exportStar(__webpack_require__(157), exports);
__exportStar(__webpack_require__(158), exports);
__exportStar(__webpack_require__(159), exports);
__exportStar(__webpack_require__(160), exports);
__exportStar(__webpack_require__(161), exports);
__exportStar(__webpack_require__(162), exports);
__exportStar(__webpack_require__(163), exports);
__exportStar(__webpack_require__(164), exports);
__exportStar(__webpack_require__(165), exports);
__exportStar(__webpack_require__(166), exports);
__exportStar(__webpack_require__(167), exports);
__exportStar(__webpack_require__(168), exports);
__exportStar(__webpack_require__(169), exports);
__exportStar(__webpack_require__(209), exports);
__exportStar(__webpack_require__(210), exports);
__exportStar(__webpack_require__(211), exports);
__exportStar(__webpack_require__(212), exports);
__exportStar(__webpack_require__(213), exports);
__exportStar(__webpack_require__(214), exports);
__exportStar(__webpack_require__(215), exports);
__exportStar(__webpack_require__(216), exports);
__exportStar(__webpack_require__(217), exports);
__exportStar(__webpack_require__(218), exports);
__exportStar(__webpack_require__(219), exports);
__exportStar(__webpack_require__(220), exports);
__exportStar(__webpack_require__(221), exports);
__exportStar(__webpack_require__(222), exports);
__exportStar(__webpack_require__(223), exports);
__exportStar(__webpack_require__(224), exports);
__exportStar(__webpack_require__(225), exports);
__exportStar(__webpack_require__(227), exports);
__exportStar(__webpack_require__(228), exports);


/***/ }),
/* 145 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductPickingOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const time_helper_1 = __webpack_require__(146);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
let ProductPickingOperation = class ProductPickingOperation {
    constructor(dataSource) {
        this.dataSource = dataSource;
    }
    generatePickingPlan(data) {
        const { productOriginList, batchOriginList, voucherBatchList, allowNegativeQuantity } = data;
        const productOriginMap = object_helper_1.ESArray.arrayToKeyValue(productOriginList, 'id');
        const batchOriginMap = object_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
        const productCalcMap = {};
        productOriginList.forEach((i) => {
            if (!productCalcMap[i.id]) {
                productCalcMap[i.id] = { productId: i.id, openQuantity: i.quantity, product: i };
            }
        });
        const batchCalcListMap = {};
        batchOriginList.forEach((b) => {
            var _a;
            batchCalcListMap[_a = b.productId] || (batchCalcListMap[_a] = []);
            batchCalcListMap[b.productId].push({
                productId: b.productId,
                openQuantity: b.quantity,
                openCostAmount: b.costAmount,
                batch: b,
            });
        });
        Object.keys(batchCalcListMap).forEach((productId) => {
            batchCalcListMap[productId].sort((a, b) => (a.batch.id < b.batch.id ? -1 : 1));
        });
        const pickingMovementList = [];
        voucherBatchList.forEach((voucherProduct) => {
            var _a;
            const { voucherProductId, voucherBatchId, productId, pickupStrategy } = voucherProduct;
            const productOrigin = productOriginMap[productId];
            if (!productOrigin) {
                throw new error_1.BusinessError(`Không tìm thấy Product với productId=${productId}`);
            }
            const productCalc = productCalcMap[productId];
            if (!batchCalcListMap[productId]
                || !batchCalcListMap[productId].length
                || pickupStrategy === variable_1.PickupStrategy.NoImpact) {
                const pickingQuantity = voucherProduct.quantity;
                const pickingCostAmount = voucherProduct.quantity * productOrigin.costPrice;
                const pickingMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId: 0,
                    pickingQuantity,
                    pickingCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity - 0,
                    openQuantityBatch: 0,
                    closeQuantityBatch: 0,
                    openCostAmountBatch: 0,
                    closeCostAmountBatch: 0,
                };
                pickingMovementList.push(pickingMovement);
            }
            else if (voucherProduct.pickupStrategy === variable_1.PickupStrategy.RequireBatchSelection
                && voucherProduct.batchId !== 0) {
                const batchCalc = (_a = batchCalcListMap[productId]) === null || _a === void 0 ? void 0 : _a.find((i) => {
                    return i.batch.id === voucherProduct.batchId;
                });
                if (!batchCalc || !batchCalc.batch) {
                    throw new error_1.BusinessError(`${productOrigin.brandName} không có lô hàng phù hợp`);
                }
                if (!allowNegativeQuantity && voucherProduct.quantity > batchCalc.openQuantity) {
                    const expiryDateString = time_helper_1.ESTimer.timeToText(batchCalc.batch.expiryDate, 'DD/MM/YYYY', 7);
                    throw new error_1.BusinessError(`${productOrigin.brandName} không đủ số lượng trong kho.`, ` Lô hàng ${batchCalc.batch.batchCode} ${expiryDateString}:`, ` còn ${batchCalc.openQuantity}, lấy ${voucherProduct.quantity}`);
                }
                let pickingQuantityPositive = Math.min(batchCalc.openQuantity, voucherProduct.quantity);
                if (pickingQuantityPositive < 0)
                    pickingQuantityPositive = 0;
                const pickingQuantityNegative = voucherProduct.quantity - pickingQuantityPositive;
                if (pickingQuantityPositive > 0) {
                    const pickingQuantity = pickingQuantityPositive;
                    let pickingCostAmount = 0;
                    if (voucherProduct.costAmount == null) {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    else {
                        pickingCostAmount = Math.round((voucherProduct.costAmount * pickingQuantity) / voucherProduct.quantity);
                        if (pickingCostAmount > batchCalc.openCostAmount) {
                            pickingCostAmount = batchCalc.openCostAmount;
                        }
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
                if (pickingQuantityNegative > 0) {
                    const pickingQuantity = pickingQuantityNegative;
                    let pickingCostAmount = 0;
                    if (batchCalc.openQuantity === 0) {
                        pickingCostAmount = productOrigin.costPrice * pickingQuantity;
                    }
                    else {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
            }
            else {
                let quantityCalculator = voucherProduct.quantity;
                const batchCalcList = batchCalcListMap[productId].filter((i) => {
                    let warehouseIdList = [];
                    try {
                        warehouseIdList = JSON.parse(voucherProduct.warehouseIds);
                    }
                    catch (error) {
                        warehouseIdList = [];
                    }
                    if (!warehouseIdList.length || warehouseIdList.includes(0))
                        return true;
                    if (i.batch.warehouseId === 0)
                        return true;
                    if (warehouseIdList.includes(i.batch.warehouseId))
                        return true;
                    return false;
                });
                if (!batchCalcList.length) {
                    throw new error_1.BusinessError(`${productOrigin.brandName} không có danh sách tồn kho phù hợp`);
                }
                for (let i = 0; i < batchCalcList.length; i++) {
                    if (quantityCalculator <= 0)
                        break;
                    const batchCalc = batchCalcList[i];
                    const pickingQuantity = Math.min(quantityCalculator, batchCalc.openQuantity);
                    if (pickingQuantity <= 0)
                        continue;
                    const pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                    quantityCalculator -= pickingQuantity;
                }
                if (quantityCalculator > 0) {
                    if (!allowNegativeQuantity) {
                        throw new error_1.BusinessError(`${productOrigin.brandName} không đủ số lượng trong kho`);
                    }
                    const batchCalc = batchCalcList[batchCalcList.length - 1];
                    const pickingQuantity = quantityCalculator;
                    let pickingCostAmount = 0;
                    if (batchCalc.openQuantity === 0) {
                        pickingCostAmount = pickingQuantity * productOrigin.costPrice;
                    }
                    else {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
            }
        });
        const pickingProductMap = {};
        const pickingBatchMap = {};
        const pickingVoucherProductMap = {};
        const pickingVoucherBatchMap = {};
        pickingMovementList.forEach((mov) => {
            const { productId, batchId, voucherProductId, voucherBatchId } = mov;
            pickingProductMap[productId] || (pickingProductMap[productId] = {
                productId,
                pickingQuantity: 0,
                openQuantity: productOriginMap[productId].quantity,
                closeQuantity: 0,
            });
            pickingProductMap[productId].pickingQuantity += mov.pickingQuantity;
            pickingProductMap[productId].closeQuantity = mov.closeQuantityProduct;
            if (batchId != 0) {
                pickingBatchMap[batchId] || (pickingBatchMap[batchId] = {
                    productId,
                    batchId,
                    pickingQuantity: 0,
                    pickingCostAmount: 0,
                    openQuantity: batchOriginMap[batchId].quantity,
                    closeQuantity: 0,
                    openCostAmount: batchOriginMap[batchId].costAmount,
                    closeCostAmount: 0,
                });
                pickingBatchMap[batchId].pickingQuantity += mov.pickingQuantity;
                pickingBatchMap[batchId].pickingCostAmount += mov.pickingCostAmount;
                pickingBatchMap[batchId].closeQuantity = mov.closeQuantityBatch;
                pickingBatchMap[batchId].closeCostAmount = mov.closeQuantityBatch;
            }
            pickingVoucherProductMap[voucherProductId] || (pickingVoucherProductMap[voucherProductId] = {
                voucherProductId,
                productId,
                pickingQuantity: 0,
                pickingCostAmount: 0,
            });
            pickingVoucherProductMap[voucherProductId].pickingQuantity += mov.pickingQuantity;
            pickingVoucherProductMap[voucherProductId].pickingCostAmount += mov.pickingCostAmount;
            const keyVoucherBatch = `${voucherProductId}-${voucherBatchId}-${batchId}`;
            pickingVoucherBatchMap[keyVoucherBatch] || (pickingVoucherBatchMap[keyVoucherBatch] = {
                voucherProductId,
                productId,
                batchId,
                pickingCostAmount: 0,
                pickingQuantity: 0,
            });
            pickingVoucherBatchMap[keyVoucherBatch].pickingQuantity += mov.pickingQuantity;
            pickingVoucherBatchMap[keyVoucherBatch].pickingCostAmount += mov.pickingCostAmount;
        });
        const pickingContainer = {
            pickingMovementList,
            pickingProductList: Object.values(pickingProductMap),
            pickingBatchList: Object.values(pickingBatchMap),
            pickingVoucherProductList: Object.values(pickingVoucherProductMap),
            pickingVoucherBatchList: Object.values(pickingVoucherBatchMap),
        };
        return pickingContainer;
    }
};
exports.ProductPickingOperation = ProductPickingOperation;
exports.ProductPickingOperation = ProductPickingOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], ProductPickingOperation);


/***/ }),
/* 146 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ESTimer = void 0;
class ESTimer {
}
exports.ESTimer = ESTimer;
ESTimer.startOfDate = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfDate = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.startOfMonth = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCDate(1);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfMonth = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(timeMove.getUTCMonth() + 1, 0);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.startOfYear = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(0, 1);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfYear = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(11, 31);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.info = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    return {
        year: timeMove.getUTCFullYear(),
        month: timeMove.getUTCMonth(),
        date: timeMove.getUTCDate(),
        hour: timeMove.getUTCHours(),
        minute: timeMove.getUTCMinutes(),
        second: timeMove.getUTCSeconds(),
    };
};
ESTimer.textToTime = (text, pattern, utcOffset) => {
    const iFullYear = pattern.indexOf('YYYY');
    const iMonth = pattern.indexOf('MM');
    const iDay = pattern.indexOf('DD');
    const iHour = pattern.indexOf('hh');
    const iMinute = pattern.indexOf('mm');
    const iSecond = pattern.indexOf('ss');
    const iMs = pattern.indexOf('xxx');
    const year = iFullYear !== -1 ? Number(text.slice(iFullYear, iFullYear + 4)) : 0;
    const month = iMonth !== -1 ? Number(text.slice(iMonth, iMonth + 2)) : 0;
    const date = iDay !== -1 ? Number(text.slice(iDay, iDay + 2)) : 0;
    const hour = iHour !== -1 ? Number(text.slice(iHour, iHour + 2)) : 0;
    const minute = iMinute !== -1 ? Number(text.slice(iMinute, iMinute + 2)) : 0;
    const second = iSecond !== -1 ? Number(text.slice(iSecond, iSecond + 2)) : 0;
    const millisecond = iMs !== -1 ? Number(text.slice(iMs, iMs + 3)) : 0;
    const time = new Date();
    time.setUTCFullYear(year);
    time.setUTCMonth(month - 1);
    time.setUTCDate(date);
    time.setUTCHours(hour);
    time.setUTCMinutes(minute);
    time.setUTCSeconds(second);
    time.setMilliseconds(millisecond);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    return timeMove;
};
ESTimer.timeToText = (time, pattern = 'DD/MM/YYYY', utcOffset) => {
    if (time == null || time === '')
        return '';
    if (typeof time !== 'object')
        time = new Date(time);
    if (time.toString() === 'Invalid Date')
        return 'Invalid Date';
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const date = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    const rules = {
        YYYY: `${date.getUTCFullYear()}`,
        YY: `${date.getUTCFullYear()}`.slice(-2),
        MM: `0${date.getUTCMonth() + 1}`.slice(-2),
        DD: `0${date.getUTCDate()}`.slice(-2),
        hh: `0${date.getUTCHours()}`.slice(-2),
        mm: `0${date.getUTCMinutes()}`.slice(-2),
        ss: `0${date.getUTCSeconds()}`.slice(-2),
        xxx: `00${date.getUTCMilliseconds()}`.slice(-3),
    };
    let text = pattern;
    Object.entries(rules).forEach(([key, value]) => {
        const re = new RegExp(key, 'g');
        text = text.replace(re, value);
    });
    return text;
};


/***/ }),
/* 147 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductPutawayOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
let ProductPutawayOperation = class ProductPutawayOperation {
    constructor(dataSource) {
        this.dataSource = dataSource;
    }
    generatePutawayPlan(options) {
        const { productOriginList, batchOriginList, voucherBatchList } = options;
        const productOriginMap = object_helper_1.ESArray.arrayToKeyValue(productOriginList, 'id');
        const batchOriginMap = object_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
        const productCalcMap = {};
        productOriginList.forEach((i) => {
            if (!productCalcMap[i.id]) {
                productCalcMap[i.id] = { productId: i.id, openQuantity: i.quantity, product: i };
            }
        });
        const batchCalcMap = {};
        batchOriginList.forEach((i) => {
            if (!batchCalcMap[i.id]) {
                batchCalcMap[i.id] = {
                    batchId: i.id,
                    openQuantity: i.quantity,
                    openCostAmount: i.costAmount,
                    batch: i,
                };
            }
        });
        const putawayMovementList = [];
        voucherBatchList.forEach((voucherProduct) => {
            const { productId, batchId, voucherProductId, voucherBatchId, warehouseId } = voucherProduct;
            if (!productOriginMap[productId]) {
                throw new Error('Không tìm thấy Product với productId=' + productId);
            }
            if (batchId !== 0 && !batchOriginMap[batchId]) {
                throw new Error('Không tìm thấy Batch với batchId=' + batchId);
            }
            const productCalc = productCalcMap[productId];
            const batchCalc = batchCalcMap[batchId];
            if (batchId === 0) {
                const putawayQuantity = voucherProduct.quantity;
                const pcAmount = voucherProduct.costAmount;
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    batchId,
                    productId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount: pcAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + 0,
                    openQuantityBatch: 0,
                    closeQuantityBatch: 0,
                    openCostAmountBatch: 0,
                    closeCostAmountBatch: 0,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                return;
            }
            const expectedQuantity = batchCalc.openQuantity + voucherProduct.quantity;
            let putawayQuantityPositive = Math.min(expectedQuantity, voucherProduct.quantity);
            if (putawayQuantityPositive < 0)
                putawayQuantityPositive = 0;
            const putawayQuantityNegative = voucherProduct.quantity - putawayQuantityPositive;
            if (putawayQuantityNegative > 0) {
                const putawayQuantity = putawayQuantityNegative;
                const putawayCostAmount = Math.round((batchCalc.openCostAmount * putawayQuantity) / batchCalc.openQuantity);
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + putawayQuantity,
                    openQuantityBatch: batchCalc.openQuantity,
                    closeQuantityBatch: batchCalc.openQuantity + putawayQuantity,
                    openCostAmountBatch: batchCalc.openCostAmount,
                    closeCostAmountBatch: batchCalc.openCostAmount + putawayCostAmount,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                batchCalc.openQuantity = putawayMovement.closeQuantityBatch;
                batchCalc.openCostAmount = putawayMovement.closeCostAmountBatch;
            }
            if (putawayQuantityPositive > 0) {
                const putawayQuantity = putawayQuantityPositive;
                const putawayCostAmount = Math.round((voucherProduct.costAmount * putawayQuantityPositive) / voucherProduct.quantity);
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + putawayQuantity,
                    openQuantityBatch: batchCalc.openQuantity,
                    closeQuantityBatch: batchCalc.openQuantity + putawayQuantity,
                    openCostAmountBatch: batchCalc.openCostAmount,
                    closeCostAmountBatch: batchCalc.openCostAmount + putawayCostAmount,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                batchCalc.openQuantity = putawayMovement.closeQuantityBatch;
                batchCalc.openCostAmount = putawayMovement.closeCostAmountBatch;
            }
        });
        const putawayProductMap = {};
        const putawayBatchMap = {};
        const putawayVoucherProductMap = {};
        const putawayVoucherBatchMap = {};
        putawayMovementList.forEach((mov) => {
            const { productId, batchId, voucherProductId, voucherBatchId } = mov;
            putawayProductMap[productId] || (putawayProductMap[productId] = {
                productId,
                putawayQuantity: 0,
                openQuantity: productOriginMap[productId].quantity,
                closeQuantity: 0,
            });
            putawayProductMap[productId].putawayQuantity += mov.putawayQuantity;
            putawayProductMap[productId].closeQuantity = mov.closeQuantityProduct;
            if (batchId != 0) {
                putawayBatchMap[batchId] || (putawayBatchMap[batchId] = {
                    productId,
                    batchId,
                    putawayQuantity: 0,
                    putawayCostAmount: 0,
                    openQuantity: batchOriginMap[batchId].quantity,
                    closeQuantity: 0,
                    openCostAmount: batchOriginMap[batchId].costAmount,
                    closeCostAmount: 0,
                });
                putawayBatchMap[batchId].putawayQuantity += mov.putawayQuantity;
                putawayBatchMap[batchId].putawayCostAmount += mov.putawayCostAmount;
                putawayBatchMap[batchId].closeQuantity = mov.closeQuantityBatch;
                putawayBatchMap[batchId].closeCostAmount = mov.closeQuantityBatch;
            }
            putawayVoucherProductMap[voucherProductId] || (putawayVoucherProductMap[voucherProductId] = {
                voucherProductId,
                productId,
                putawayQuantity: 0,
                putawayCostAmount: 0,
            });
            putawayVoucherProductMap[voucherProductId].putawayQuantity += mov.putawayQuantity;
            putawayVoucherProductMap[voucherProductId].putawayCostAmount += mov.putawayCostAmount;
            const keyVoucherBatch = `${voucherProductId}-${voucherBatchId}-${batchId}`;
            putawayVoucherBatchMap[keyVoucherBatch] || (putawayVoucherBatchMap[keyVoucherBatch] = {
                voucherBatchId,
                voucherProductId,
                productId,
                batchId,
                putawayQuantity: 0,
                putawayCostAmount: 0,
            });
            putawayVoucherBatchMap[keyVoucherBatch].putawayQuantity += mov.putawayQuantity;
            putawayVoucherBatchMap[keyVoucherBatch].putawayCostAmount += mov.putawayCostAmount;
        });
        const putawayContainer = {
            putawayMovementList,
            putawayProductList: Object.values(putawayProductMap),
            putawayBatchList: Object.values(putawayBatchMap),
            putawayVoucherProductList: Object.values(putawayVoucherProductMap),
            putawayVoucherBatchList: Object.values(putawayVoucherBatchMap),
        };
        return putawayContainer;
    }
};
exports.ProductPutawayOperation = ProductPutawayOperation;
exports.ProductPutawayOperation = ProductPutawayOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], ProductPutawayOperation);


/***/ }),
/* 148 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
let ProductOperation = class ProductOperation {
    constructor(dataSource, manager) {
        this.dataSource = dataSource;
        this.manager = manager;
    }
    async reCalculateQuantityBySumBatch(options) {
        const { oid, productId } = options;
        const resultQuery = await this.manager.query(`
        UPDATE  "Product"
        SET     "quantity" = ( 
                    SELECT COALESCE(SUM("quantity"), 0)
                    FROM "Batch" WHERE "productId" = ${productId}
                )
        WHERE   "id" = ${productId} AND "oid" = ${oid}
        RETURNING *
    `);
        if (resultQuery[0].length !== 1) {
            throw new Error(`Update Product failed`);
        }
        return entities_1.Product.fromRaw(resultQuery[0][0]);
    }
    async reCalculateQuantityBySumBatchList(options) {
        const { oid, productIdList } = options;
        const resultQuery = await this.manager.query(`
        UPDATE  "Product" "product" 
        SET     "quantity" = "sbq"."sumQuantity"
        FROM    ( 
                SELECT "productId", SUM("quantity") as "sumQuantity" 
                    FROM "Batch" 
                    WHERE "Batch"."productId" IN (${productIdList.toString()})
                        AND "Batch"."oid" = ${oid}
                    GROUP BY "productId" 
                ) AS "sbq" 
        WHERE   "product"."id" = "sbq"."productId" 
            AND "product"."id" IN (${productIdList.toString()})
            AND "product"."oid" = ${oid}
        RETURNING "Product".*
    `);
        return entities_1.Product.fromRaws(resultQuery[0]);
    }
};
exports.ProductOperation = ProductOperation;
exports.ProductOperation = ProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object])
], ProductOperation);


/***/ }),
/* 149 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptDepositedOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(146);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptDepositedOperation = class ReceiptDepositedOperation {
    constructor(dataSource, receiptManager, receiptItemManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.receiptItemManager = receiptItemManager;
    }
    async update(params) {
        const { oid, receiptId, receiptUpdateDto, receiptItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receiptUpdate = Object.assign(Object.assign({}, receiptUpdateDto), { oid, status: receipt_entity_1.ReceiptStatus.Deposited, debt: () => `${receiptUpdateDto.totalMoney} - paid`, year: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).date, endedAt: null });
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                id: receiptId,
                oid,
                status: receipt_entity_1.ReceiptStatus.Deposited,
            }, receiptUpdate);
            await this.receiptItemManager.delete(manager, { oid, receiptId });
            const receiptItemListInsert = receiptItemListDto.map((i) => {
                const receiptItem = Object.assign(Object.assign({}, i), { oid,
                    receiptId, distributorId: receipt.distributorId });
                return receiptItem;
            });
            await this.receiptItemManager.insertMany(manager, receiptItemListInsert);
            return { receipt };
        });
    }
};
exports.ReceiptDepositedOperation = ReceiptDepositedOperation;
exports.ReceiptDepositedOperation = ReceiptDepositedOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _c : Object])
], ReceiptDepositedOperation);


/***/ }),
/* 150 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptDraftOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(146);
const variable_1 = __webpack_require__(21);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptDraftOperation = class ReceiptDraftOperation {
    constructor(dataSource, manager, receiptManager, receiptItemManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.receiptManager = receiptManager;
        this.receiptItemManager = receiptItemManager;
    }
    async createDraft(params) {
        const { oid, receiptInsertDto, receiptItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receiptInsert = Object.assign(Object.assign({}, receiptInsertDto), { oid, status: receipt_entity_1.ReceiptStatus.Draft, deliveryStatus: variable_1.DeliveryStatus.Pending, distributorId: receiptInsertDto.distributorId, paid: 0, debt: receiptInsertDto.totalMoney, year: time_helper_1.ESTimer.info(receiptInsertDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(receiptInsertDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(receiptInsertDto.startedAt, 7).date, endedAt: null });
            const receipt = await this.receiptManager.insertOneAndReturnEntity(manager, receiptInsert);
            const receiptItemListInsert = receiptItemListDto.map((i) => {
                const receiptItem = Object.assign(Object.assign({}, i), { oid, receiptId: receipt.id, distributorId: receiptInsert.distributorId });
                return receiptItem;
            });
            await this.receiptItemManager.insertMany(manager, receiptItemListInsert);
            return { receipt };
        });
    }
    async updateDraft(params) {
        const { oid, receiptId, receiptUpdateDto, receiptItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receiptUpdate = Object.assign(Object.assign({}, receiptUpdateDto), { oid, distributorId: receiptUpdateDto.distributorId, status: receipt_entity_1.ReceiptStatus.Draft, paid: 0, debt: receiptUpdateDto.totalMoney, year: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(receiptUpdateDto.startedAt, 7).date, endedAt: null });
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                id: receiptId,
                oid,
                status: receipt_entity_1.ReceiptStatus.Draft,
            }, receiptUpdate);
            await this.receiptItemManager.delete(manager, { oid, receiptId });
            const receiptItemListInsert = receiptItemListDto.map((i) => {
                const receiptItem = Object.assign(Object.assign({}, i), { oid,
                    receiptId, distributorId: receipt.distributorId });
                return receiptItem;
            });
            await this.receiptItemManager.insertMany(manager, receiptItemListInsert);
            return { receipt };
        });
    }
};
exports.ReceiptDraftOperation = ReceiptDraftOperation;
exports.ReceiptDraftOperation = ReceiptDraftOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _d : Object])
], ReceiptDraftOperation);


/***/ }),
/* 151 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptPayDebtOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptPayDebtOperation = class ReceiptPayDebtOperation {
    constructor(dataSource, receiptManager, distributorManager, paymentManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
    }
    async payDebt(params) {
        const { oid, cashierId, receiptId, time, money, paymentMethodId } = params;
        const PREFIX = `ReceiptId=${receiptId} pay debt failed`;
        if (money <= 0) {
            throw new Error(`${PREFIX}: money=${money}`);
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, { oid, id: receiptId, status: { IN: [receipt_entity_1.ReceiptStatus.Debt] } }, {
                status: () => `CASE 
                            WHEN("totalMoney" - paid = ${money}) THEN ${receipt_entity_1.ReceiptStatus.Completed} 
                            ELSE ${receipt_entity_1.ReceiptStatus.Debt}
                            END
                        `,
                debt: () => `debt - ${money}`,
                paid: () => `paid + ${money}`,
            });
            if (receipt.paid > receipt.totalMoney) {
                throw new Error('Số tiền thanh toán nhiều hơn số tiền cần phải trả');
            }
            const distributor = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: receipt.distributorId }, { debt: () => `debt - ${money}` });
            const distributorCloseDebt = distributor.debt;
            const distributorOpenDebt = distributorCloseDebt + money;
            const paymentInsert = {
                oid,
                cashierId,
                paymentMethodId,
                voucherType: payment_entity_1.VoucherType.Receipt,
                voucherId: receiptId,
                personType: payment_entity_1.PersonType.Distributor,
                personId: receipt.distributorId,
                createdAt: time,
                paymentTiming: payment_entity_1.PaymentTiming.PayDebt,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                paidAmount: -money,
                debtAmount: -money,
                openDebt: distributorOpenDebt,
                closeDebt: distributorCloseDebt,
                note: '',
                description: '',
            };
            const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { distributor, receipt, payment };
        });
        return transaction;
    }
};
exports.ReceiptPayDebtOperation = ReceiptPayDebtOperation;
exports.ReceiptPayDebtOperation = ReceiptPayDebtOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.DistributorManager !== "undefined" && managers_1.DistributorManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], ReceiptPayDebtOperation);


/***/ }),
/* 152 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptPaymentAndCloseOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptPaymentAndCloseOperation = class ReceiptPaymentAndCloseOperation {
    constructor(dataSource, receiptManager, distributorManager, paymentManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
    }
    async paymentAndClose(params) {
        const { oid, cashierId, receiptId, paymentMethodId, time, money, note, description } = params;
        const PREFIX = `ReceiptId=${receiptId} ship and payment failed`;
        if (money < 0) {
            throw new Error(`${PREFIX}: money = ${money}`);
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                oid,
                id: receiptId,
                deliveryStatus: { IN: [variable_1.DeliveryStatus.NoStock, variable_1.DeliveryStatus.Delivered] },
                status: { IN: [receipt_entity_1.ReceiptStatus.Draft, receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Executing] },
            }, {
                status: () => `CASE 
                              WHEN(paid + ${money} > "totalMoney") THEN ${receipt_entity_1.ReceiptStatus.Executing} 
                              WHEN(paid + ${money} < "totalMoney") THEN ${receipt_entity_1.ReceiptStatus.Debt} 
                              ELSE ${receipt_entity_1.ReceiptStatus.Completed}
                          END
                          `,
                debt: () => `"totalMoney" - paid - ${money}`,
                paid: () => `paid + ${money}`,
                endedAt: time,
            });
            if (receipt.debt == 0 && money == 0) {
                return { receipt };
            }
            if ([receipt_entity_1.ReceiptStatus.Executing, receipt_entity_1.ReceiptStatus.Completed].includes(receipt.status)) {
                const distributor = await this.distributorManager.findOneBy(manager, {
                    oid,
                    id: receipt.distributorId,
                });
                if (!distributor) {
                    throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
                }
                const distributorCloseDebt = distributor.debt;
                const distributorOpenDebt = distributorCloseDebt;
                const paymentInsert = {
                    oid,
                    cashierId,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Receipt,
                    voucherId: receiptId,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: receipt.distributorId,
                    createdAt: time,
                    paymentTiming: payment_entity_1.PaymentTiming.Close,
                    moneyDirection: payment_entity_1.MoneyDirection.Out,
                    paidAmount: -money,
                    debtAmount: 0,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                    note,
                    description,
                };
                const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                return { receipt, distributor, payment };
            }
            if ([receipt_entity_1.ReceiptStatus.Debt].includes(receipt.status)) {
                const distributor = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: receipt.distributorId }, { debt: () => `debt + ${receipt.debt}` });
                if (!distributor) {
                    throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
                }
                const distributorCloseDebt = distributor.debt;
                const distributorOpenDebt = distributorCloseDebt - receipt.debt;
                const paymentInsert = {
                    oid,
                    cashierId,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Receipt,
                    voucherId: receiptId,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: receipt.distributorId,
                    createdAt: time,
                    paymentTiming: payment_entity_1.PaymentTiming.Close,
                    moneyDirection: payment_entity_1.MoneyDirection.Out,
                    paidAmount: -money,
                    debtAmount: receipt.debt,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                    note: '',
                    description: '',
                };
                const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                return { receipt, distributor, payment };
            }
        });
        return transaction;
    }
};
exports.ReceiptPaymentAndCloseOperation = ReceiptPaymentAndCloseOperation;
exports.ReceiptPaymentAndCloseOperation = ReceiptPaymentAndCloseOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.DistributorManager !== "undefined" && managers_1.DistributorManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], ReceiptPaymentAndCloseOperation);


/***/ }),
/* 153 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptPrepaymentOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptPrepaymentOperation = class ReceiptPrepaymentOperation {
    constructor(dataSource, receiptManager, paymentManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.paymentManager = paymentManager;
    }
    async prepayment(params) {
        const { oid, cashierId, receiptId, paymentMethodId, time, money } = params;
        if (money < 0) {
            throw new Error(`Prepayment Receipt ${receiptId} failed: Money number invalid`);
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                oid,
                id: receiptId,
                status: { IN: [receipt_entity_1.ReceiptStatus.Draft, receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Executing] },
            }, {
                status: () => `CASE 
                              WHEN(status = ${receipt_entity_1.ReceiptStatus.Draft}) THEN ${receipt_entity_1.ReceiptStatus.Deposited} 
                              ELSE status
                          END
                          `,
                paid: () => `paid + ${money}`,
                debt: () => `debt - ${money}`,
            });
            let payment;
            if (money > 0) {
                const distributor = await manager.findOneBy(entities_1.Distributor, {
                    oid,
                    id: receipt.distributorId,
                });
                if (!distributor) {
                    throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
                }
                const distributorCloseDebt = distributor.debt;
                const distributorOpenDebt = distributor.debt;
                const paymentInsert = {
                    oid,
                    cashierId,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Receipt,
                    voucherId: receiptId,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: receipt.distributorId,
                    createdAt: time,
                    paymentTiming: payment_entity_1.PaymentTiming.Prepayment,
                    moneyDirection: payment_entity_1.MoneyDirection.Out,
                    paidAmount: -money,
                    debtAmount: 0,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                    note: '',
                    description: '',
                };
                payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            }
            return { receipt, payment };
        });
        return transaction;
    }
};
exports.ReceiptPrepaymentOperation = ReceiptPrepaymentOperation;
exports.ReceiptPrepaymentOperation = ReceiptPrepaymentOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _c : Object])
], ReceiptPrepaymentOperation);


/***/ }),
/* 154 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptRefundOverpaidOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptRefundOverpaidOperation = class ReceiptRefundOverpaidOperation {
    constructor(dataSource, receiptManager, paymentManager, distributorManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.paymentManager = paymentManager;
        this.distributorManager = distributorManager;
    }
    async refundOverpaid(params) {
        const { oid, cashierId, receiptId, time, paymentMethodId, money, note, description } = params;
        const PREFIX = `ReceiptId=${receiptId} refund money failed`;
        if (money < 0) {
            throw new Error(`${PREFIX} Money number invalid`);
        }
        try {
            const transaction = await this.dataSource.transaction('REPEATABLE READ', async (manager) => {
                const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                    oid,
                    id: receiptId,
                    status: { IN: [receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Executing] },
                }, {
                    paid: () => `paid - ${money}`,
                    debt: () => `debt + ${money}`,
                });
                if (receipt.paid < 0) {
                    throw new Error('Số tiền hoàn trả quá lớn');
                }
                const distributor = await this.distributorManager.findOneBy(manager, {
                    oid,
                    id: receipt.distributorId,
                });
                if (!distributor) {
                    throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
                }
                const distributorCloseDebt = distributor.debt;
                const distributorOpenDebt = distributor.debt;
                const paymentInsert = {
                    oid,
                    cashierId,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Receipt,
                    voucherId: receiptId,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: receipt.distributorId,
                    paymentTiming: payment_entity_1.PaymentTiming.ReceiveRefund,
                    createdAt: time,
                    moneyDirection: payment_entity_1.MoneyDirection.In,
                    paidAmount: money,
                    debtAmount: 0,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                    note,
                    description,
                };
                const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                return { receipt, distributor, payment };
            });
            return transaction;
        }
        catch (error) {
            throw error;
        }
    }
};
exports.ReceiptRefundOverpaidOperation = ReceiptRefundOverpaidOperation;
exports.ReceiptRefundOverpaidOperation = ReceiptRefundOverpaidOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.DistributorManager !== "undefined" && managers_1.DistributorManager) === "function" ? _d : Object])
], ReceiptRefundOverpaidOperation);


/***/ }),
/* 155 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptReopenOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let ReceiptReopenOperation = class ReceiptReopenOperation {
    constructor(dataSource, receiptManager, paymentManager, distributorManager) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.paymentManager = paymentManager;
        this.distributorManager = distributorManager;
    }
    async reopen(params) {
        const { oid, cashierId, receiptId, time, paymentMethodId, newPaid, note, description } = params;
        const PREFIX = `ReceiptId=${receiptId} refund money failed`;
        if (newPaid < 0) {
            throw new Error(`${PREFIX} newPaid number invalid`);
        }
        try {
            const transaction = await this.dataSource.transaction('REPEATABLE READ', async (manager) => {
                const receiptOrigin = await this.receiptManager.updateOneAndReturnEntity(manager, { oid, id: receiptId }, { endedAt: null });
                const receiptModified = await this.receiptManager.updateOneAndReturnEntity(manager, {
                    oid,
                    id: receiptId,
                    status: { IN: [receipt_entity_1.ReceiptStatus.Debt, receipt_entity_1.ReceiptStatus.Completed] },
                }, {
                    paid: newPaid,
                    debt: () => `"totalMoney" - ${newPaid}`,
                    status: receipt_entity_1.ReceiptStatus.Executing,
                });
                if (receiptOrigin.paid === receiptModified.paid && receiptOrigin.debt === 0) {
                    return { receipt: receiptModified };
                }
                let distributor;
                if (receiptOrigin.debt > 0) {
                    distributor = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: receiptOrigin.distributorId }, { debt: () => `debt - ${receiptOrigin.debt}` });
                }
                else {
                    distributor = await this.distributorManager.findOneBy(manager, {
                        oid,
                        id: receiptOrigin.distributorId,
                    });
                }
                if (!distributor) {
                    throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
                }
                const distributorCloseDebt = distributor.debt;
                const distributorOpenDebt = distributor.debt - receiptOrigin.debt;
                const paymentInsert = {
                    oid,
                    cashierId,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Receipt,
                    voucherId: receiptId,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: receiptOrigin.distributorId,
                    createdAt: time,
                    paymentTiming: payment_entity_1.PaymentTiming.Reopen,
                    moneyDirection: payment_entity_1.MoneyDirection.In,
                    paidAmount: -(receiptModified.paid - receiptOrigin.paid),
                    debtAmount: -receiptOrigin.debt,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                    note,
                    description,
                };
                const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                return { receipt: receiptModified, distributor, payment };
            });
            return transaction;
        }
        catch (error) {
            throw error;
        }
    }
};
exports.ReceiptReopenOperation = ReceiptReopenOperation;
exports.ReceiptReopenOperation = ReceiptReopenOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.DistributorManager !== "undefined" && managers_1.DistributorManager) === "function" ? _d : Object])
], ReceiptReopenOperation);


/***/ }),
/* 156 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptReturnProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
const product_picking_operation_1 = __webpack_require__(145);
let ReceiptReturnProductOperation = class ReceiptReturnProductOperation {
    constructor(dataSource, receiptManager, receiptItemManager, productManager, batchManager, productMovementManager, productPickingOperation) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.receiptItemManager = receiptItemManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.productPickingOperation = productPickingOperation;
    }
    async returnAllProduct(params) {
        const { oid, receiptId, time } = params;
        const PREFIX = `ReceiptId=${receiptId} refund failed`;
        const transaction = await this.dataSource.transaction('REPEATABLE READ', async (manager) => {
            const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                oid,
                id: receiptId,
                status: receipt_entity_1.ReceiptStatus.Executing,
                deliveryStatus: variable_1.DeliveryStatus.Delivered,
            }, { deliveryStatus: variable_1.DeliveryStatus.Pending });
            const receiptItemOriginList = await this.receiptItemManager.findManyBy(manager, {
                oid,
                receiptId,
            });
            const receiptItemOriginMap = object_helper_1.ESArray.arrayToKeyValue(receiptItemOriginList, 'id');
            if (receiptItemOriginList.length === 0)
                return { receipt };
            const productIdList = receiptItemOriginList.map((i) => i.productId);
            const batchIdList = receiptItemOriginList.map((i) => i.batchId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(productIdList) } }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(batchIdList) } }, { updatedAt: time });
            const pickingContainer = this.productPickingOperation.generatePickingPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: receiptItemOriginList.map((i) => {
                    return Object.assign(Object.assign({}, i), { voucherProductId: i.id, voucherBatchId: 0, warehouseIds: JSON.stringify([i.warehouseId]), costAmount: i.costPrice * i.quantity, pickupStrategy: i.batchId
                            ? variable_1.PickupStrategy.RequireBatchSelection
                            : variable_1.PickupStrategy.NoImpact });
                }),
                allowNegativeQuantity: true,
            });
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: pickingContainer.pickingProductList.map((i) => {
                    return {
                        id: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        quantity: i.closeQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = object_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: pickingContainer.pickingBatchList.map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        pickingCostAmount: i.pickingCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "pickingQuantity"`,
                    costAmount: () => `"costAmount" - "pickingCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchModifiedMap = object_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = pickingContainer.pickingMovementList.map((paMovement) => {
                const riOrigin = receiptItemOriginMap[paMovement.voucherProductId];
                const batch = batchModifiedMap[paMovement.batchId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.Receipt,
                    contactId: receipt.distributorId,
                    voucherId: receiptId,
                    voucherProductId: riOrigin.id,
                    warehouseId: riOrigin.warehouseId,
                    productId: riOrigin.productId,
                    batchId: riOrigin.batchId,
                    createdAt: time,
                    isRefund: 1,
                    expectedPrice: riOrigin.costPrice,
                    actualPrice: riOrigin.costPrice,
                    quantity: -paMovement.pickingQuantity,
                    costAmount: -paMovement.pickingCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            return {
                receipt,
                receiptItemList: receiptItemOriginMap,
                productList: productModifiedList,
                batchList: batchModifiedList,
            };
        });
        return transaction;
    }
};
exports.ReceiptReturnProductOperation = ReceiptReturnProductOperation;
exports.ReceiptReturnProductOperation = ReceiptReturnProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _f : Object, typeof (_g = typeof product_picking_operation_1.ProductPickingOperation !== "undefined" && product_picking_operation_1.ProductPickingOperation) === "function" ? _g : Object])
], ReceiptReturnProductOperation);


/***/ }),
/* 157 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptSendProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
const product_putaway_operation_1 = __webpack_require__(147);
let ReceiptSendProductOperation = class ReceiptSendProductOperation {
    constructor(dataSource, receiptManager, receiptItemManager, productManager, batchManager, productMovementManager, productPutawayOperation) {
        this.dataSource = dataSource;
        this.receiptManager = receiptManager;
        this.receiptItemManager = receiptItemManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.productPutawayOperation = productPutawayOperation;
    }
    async sendProduct(params) {
        const { oid, userId, receiptId, time } = params;
        const PREFIX = `ReceiptId=${receiptId} ship and payment failed`;
        try {
            const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
                const receipt = await this.receiptManager.updateOneAndReturnEntity(manager, {
                    oid,
                    id: receiptId,
                    status: { IN: [receipt_entity_1.ReceiptStatus.Draft, receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Executing] },
                }, { status: receipt_entity_1.ReceiptStatus.Executing, deliveryStatus: variable_1.DeliveryStatus.Delivered });
                const receiptItemOriginList = await this.receiptItemManager.findManyBy(manager, {
                    oid,
                    receiptId,
                });
                if (receiptItemOriginList.length === 0)
                    return { receipt };
                const receiptItemOriginMap = object_helper_1.ESArray.arrayToKeyValue(receiptItemOriginList, 'id');
                const productIdList = receiptItemOriginList.map((i) => i.productId);
                const batchIdList = receiptItemOriginList.map((i) => i.batchId);
                const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(productIdList) } }, { updatedAt: time });
                const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(batchIdList) } }, { updatedAt: time });
                const putawayContainer = this.productPutawayOperation.generatePutawayPlan({
                    productOriginList,
                    batchOriginList,
                    voucherBatchList: receiptItemOriginList.map((i) => {
                        return Object.assign(Object.assign({}, i), { voucherProductId: i.id, warehouseId: i.warehouseId, voucherBatchId: 0, costAmount: i.costPrice * i.quantity });
                    }),
                });
                const productModifiedList = await this.productManager.bulkUpdate({
                    manager,
                    condition: { oid },
                    compare: ['id'],
                    tempList: putawayContainer.putawayProductList.map((i) => {
                        let receiptItem;
                        receiptItemOriginList.forEach((ri) => {
                            if (ri.productId === i.productId)
                                receiptItem = ri;
                        });
                        return {
                            id: i.productId,
                            quantity: i.closeQuantity,
                            putawayQuantity: i.putawayQuantity,
                            costPrice: receiptItem.costPrice,
                            retailPrice: receiptItem.listPrice,
                        };
                    }),
                    update: ['quantity', 'costPrice', 'retailPrice'],
                    options: { requireEqualLength: true },
                });
                const batchModifiedList = await this.batchManager.bulkUpdate({
                    manager,
                    condition: { oid },
                    compare: ['id', 'productId'],
                    tempList: putawayContainer.putawayBatchList
                        .filter((i) => !!i.batchId)
                        .map((i) => {
                        let receiptItem;
                        receiptItemOriginList.forEach((ri) => {
                            if (ri.batchId === i.batchId)
                                receiptItem = ri;
                        });
                        return {
                            id: i.batchId,
                            productId: i.productId,
                            warehouseId: receiptItem.warehouseId,
                            distributorId: receiptItem.distributorId,
                            batchCode: receiptItem.batchCode,
                            expiryDate: receiptItem.expiryDate,
                            costPrice: receiptItem.costPrice,
                            putawayQuantity: i.putawayQuantity,
                            putawayCostAmount: i.putawayCostAmount,
                        };
                    }),
                    update: {
                        warehouseId: true,
                        distributorId: true,
                        batchCode: true,
                        expiryDate: { cast: 'bigint' },
                        costPrice: true,
                        quantity: () => `"quantity" + "putawayQuantity"`,
                        costAmount: () => `"costAmount" + "putawayCostAmount"`,
                    },
                    options: { requireEqualLength: true },
                });
                const productMovementInsertList = putawayContainer.putawayMovementList.map((paMovement) => {
                    const receiptItem = receiptItemOriginMap[paMovement.voucherProductId];
                    const productMovementInsert = {
                        oid,
                        movementType: variable_1.MovementType.Receipt,
                        contactId: receipt.distributorId,
                        voucherId: receipt.id,
                        voucherProductId: receiptItem.id,
                        warehouseId: paMovement.warehouseId,
                        productId: paMovement.productId,
                        batchId: paMovement.batchId,
                        createdAt: time,
                        isRefund: 0,
                        expectedPrice: receiptItem.costPrice,
                        actualPrice: receiptItem.costPrice,
                        quantity: paMovement.putawayQuantity,
                        costAmount: paMovement.putawayCostAmount,
                        openQuantityProduct: paMovement.openQuantityProduct,
                        closeQuantityProduct: paMovement.closeQuantityProduct,
                        openQuantityBatch: paMovement.openQuantityBatch,
                        closeQuantityBatch: paMovement.closeQuantityBatch,
                        openCostAmountBatch: paMovement.openCostAmountBatch,
                        closeCostAmountBatch: paMovement.closeCostAmountBatch,
                    };
                    return productMovementInsert;
                });
                await this.productMovementManager.insertMany(manager, productMovementInsertList);
                return {
                    receipt,
                    receiptItemList: receiptItemOriginList,
                    productList: productModifiedList,
                    batchList: batchModifiedList,
                };
            });
            return transaction;
        }
        catch (error) {
            throw error;
        }
    }
};
exports.ReceiptSendProductOperation = ReceiptSendProductOperation;
exports.ReceiptSendProductOperation = ReceiptSendProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.ReceiptManager !== "undefined" && managers_1.ReceiptManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _f : Object, typeof (_g = typeof product_putaway_operation_1.ProductPutawayOperation !== "undefined" && product_putaway_operation_1.ProductPutawayOperation) === "function" ? _g : Object])
], ReceiptSendProductOperation);


/***/ }),
/* 158 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticReceiptOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const receipt_entity_1 = __webpack_require__(51);
let StatisticReceiptOperation = class StatisticReceiptOperation {
    constructor(manager) {
        this.manager = manager;
    }
    async statisticReceipt(options) {
        const { oid, timeType } = options;
        const fromTime = options.fromTime.getTime();
        const toTime = options.toTime.getTime();
        const whereReceipt = {
            oid,
            status: (0, typeorm_2.In)([receipt_entity_1.ReceiptStatus.Debt, receipt_entity_1.ReceiptStatus.Completed]),
            startedAt: (0, typeorm_2.Between)(fromTime, toTime),
        };
        let query = this.manager
            .createQueryBuilder(entities_1.Receipt, 'receipt')
            .where(whereReceipt)
            .select([
            'SUM("discountMoney") AS "sumDiscountMoney"',
            'SUM("totalMoney") AS "sumTotalMoney"',
            'SUM("debt") AS "sumDebt"',
            'COUNT(*) AS "countReceipt"',
        ]);
        if (timeType === 'month') {
            query = query.addSelect(['"year"', '"month"']).groupBy('"year"').addGroupBy('"month"');
        }
        if (timeType === 'date') {
            query = query
                .addSelect(['"year"', '"month"', '"date"'])
                .groupBy('"year"')
                .addGroupBy('"month"')
                .addGroupBy('"date"');
        }
        const dataList = await query.getRawMany();
        return dataList.map((i) => ({
            oid,
            year: i.year,
            month: i.month,
            date: i.date,
            sumDiscountMoney: Number(i.sumDiscountMoney),
            sumTotalMoney: Number(i.sumTotalMoney),
            sumDebt: Number(i.sumDebt),
            countReceipt: Number(i.countReceipt),
        }));
    }
};
exports.StatisticReceiptOperation = StatisticReceiptOperation;
exports.StatisticReceiptOperation = StatisticReceiptOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object])
], StatisticReceiptOperation);


/***/ }),
/* 159 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(43);
const ticket_entity_1 = __webpack_require__(56);
let StatisticOperation = class StatisticOperation {
    constructor(dataSource, manager) {
        this.dataSource = dataSource;
        this.manager = manager;
    }
    async sumWarehouse(oid) {
        const data = await this.manager.query(`
        SELECT 
            "Batch"."warehouseId",
            SUM("Batch"."costPrice" * "Batch"."quantity") AS "sumCostAmount",
            SUM("Batch"."quantity" * "Product"."retailPrice") AS "sumRetailAmount"
        FROM "Batch"
        JOIN "Product" ON "Batch"."productId" = "Product"."id"
        WHERE "Batch"."oid" = ${oid}
        GROUP BY "Batch"."warehouseId";
    `);
        return data.map((i) => ({
            warehouseId: i.warehouseId,
            sumCostAmount: Number(i.sumCostAmount),
            sumRetailAmount: Number(i.sumRetailAmount),
        }));
    }
    async topProductHighMoney(options) {
        const { oid, limit, orderBy } = options;
        const data = await this.manager.query(`
        SELECT 
            "Product".*,
            ("Product"."retailPrice" * "Product"."quantity") AS "retailAmount",
            SUM("Batch"."quantity" * "Batch"."costPrice") AS "costAmount"
        FROM "Product"
        JOIN "Batch" ON "Product"."id" = "Batch"."productId"
        WHERE "Product"."oid" = ${oid}
        GROUP BY "Product"."id"
        ORDER BY "${orderBy}" DESC
        LIMIT ${limit};
    `);
        return data.map((i) => (Object.assign(Object.assign({}, i), { retailAmount: Number(i.retailAmount), costAmount: Number(i.costAmount) })));
    }
    async topProductBestSelling(options) {
        const { oid, fromTime, toTime, orderBy, limit } = options;
        let query = this.manager
            .createQueryBuilder(entities_1.ProductMovement, 'productMovement')
            .where('"productMovement".oid = :oid', { oid })
            .andWhere(`"productMovement"."movementType" IN (${variable_1.MovementType.Ticket})`)
            .andWhere('"productMovement"."createdAt" BETWEEN :fromTime AND :toTime', { fromTime, toTime })
            .groupBy('"productMovement"."productId"')
            .select('"productMovement"."productId"', 'productId')
            .addSelect('SUM(-"productMovement"."quantity")', 'sumQuantity')
            .addSelect('SUM(-"productMovement"."quantity" * "productMovement"."actualPrice")', 'sumActualAmount')
            .addSelect('SUM(-"productMovement"."quantity" * "productMovement"."costPrice")', 'sumCostPrice')
            .addSelect('SUM((-"productMovement".quantity) * ("productMovement"."actualPrice" - "productMovement"."costPrice"))', 'sumProfitAmount')
            .limit(limit);
        if (orderBy === 'sumActualAmount') {
            query = query.orderBy('"sumActualAmount"', 'DESC');
        }
        else if (orderBy === 'sumProfitAmount') {
            query = query.orderBy('"sumProfitAmount"', 'DESC');
        }
        else if (orderBy === 'sumQuantity') {
            query = query.orderBy('"sumQuantity"', 'DESC');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            productId: i.productId,
            sumQuantity: Number(i.sumQuantity),
            sumCostAmount: Number(i.sumCostAmount),
            sumActualAmount: Number(i.sumActualAmount),
            sumProfitAmount: Number(i.sumProfitAmount),
        }));
    }
    async topCustomerBestTicket(options) {
        const { oid, fromTime, toTime, orderBy, limit } = options;
        const whereTicket = {
            oid,
            startedAt: (0, typeorm_2.Between)(fromTime.getTime(), toTime.getTime()),
            status: (0, typeorm_2.In)([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed]),
        };
        let query = this.manager
            .createQueryBuilder(entities_1.Ticket, 'ticket')
            .where(whereTicket)
            .groupBy('"ticket"."customerId"')
            .select('"ticket"."customerId"', 'customerId')
            .addSelect('SUM("ticket"."itemsCostAmount")', 'sumItemsCostAmount')
            .addSelect('SUM("ticket"."expense")', 'sumExpense')
            .addSelect('SUM("ticket"."surcharge")', 'sumSurcharge')
            .addSelect('SUM("ticket"."totalMoney")', 'sumTotalMoney')
            .addSelect('SUM("ticket"."debt")', 'sumDebt')
            .addSelect('SUM("ticket"."profit")', 'sumProfit')
            .addSelect('COUNT(*)', 'countTicket')
            .limit(limit);
        if (orderBy === 'sumTotalMoney') {
            query = query.orderBy('"sumTotalMoney"', 'DESC');
        }
        else if (orderBy === 'sumProfit') {
            query = query.orderBy('"sumProfit"', 'DESC');
        }
        else if (orderBy === 'countTicket') {
            query = query.orderBy('"countTicket"', 'DESC');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            customerId: i.customerId,
            sumItemsCostAmount: Number(i.sumItemsCostAmount),
            sumExpense: Number(i.sumExpense),
            sumSurcharge: Number(i.sumSurcharge),
            sumTotalMoney: Number(i.sumTotalMoney),
            sumDebt: Number(i.sumDebt),
            sumProfit: Number(i.sumProfit),
            countTicket: Number(i.countTicket),
        }));
    }
};
exports.StatisticOperation = StatisticOperation;
exports.StatisticOperation = StatisticOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object])
], StatisticOperation);


/***/ }),
/* 160 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeDiscountOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketChangeDiscountOperation = class TicketChangeDiscountOperation {
    constructor(dataSource, ticketManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
    }
    async changeDiscount(params) {
        const { oid, ticketId, discountType, discountMoney, discountPercent } = params;
        const PREFIX = `ticketId=${ticketId} pay debt failed`;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing] },
            }, { updatedAt: Date.now() });
            const totalMoneyUpdate = ticketOrigin.itemsActualMoney - discountMoney;
            const debtUpdate = totalMoneyUpdate - ticketOrigin.paid;
            const profitUpdate = totalMoneyUpdate
                - ticketOrigin.itemsCostAmount
                - ticketOrigin.expense
                - ticketOrigin.commissionMoney;
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId }, {
                discountType,
                discountMoney,
                discountPercent,
                totalMoney: totalMoneyUpdate,
                debt: debtUpdate,
                profit: profitUpdate,
            });
            return { ticket };
        });
    }
};
exports.TicketChangeDiscountOperation = TicketChangeDiscountOperation;
exports.TicketChangeDiscountOperation = TicketChangeDiscountOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object])
], TicketChangeDiscountOperation);


/***/ }),
/* 161 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeItemMoneyManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const managers_1 = __webpack_require__(100);
let TicketChangeItemMoneyManager = class TicketChangeItemMoneyManager {
    constructor(dataSource, manager, ticketManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
    }
    async changeItemMoney(options) {
        const { manager, oid, ticketOrigin, itemMoney, other } = options;
        const productMoneyUpdate = ticketOrigin.productMoney + (itemMoney.productMoneyAdd || 0);
        const procedureMoneyUpdate = ticketOrigin.procedureMoney + (itemMoney.procedureMoneyAdd || 0);
        const laboratoryMoneyUpdate = ticketOrigin.laboratoryMoney + (itemMoney.laboratoryMoneyAdd || 0);
        const radiologyMoneyUpdate = ticketOrigin.radiologyMoney + (itemMoney.radiologyMoneyAdd || 0);
        const itemsCostAmountUpdate = ticketOrigin.itemsCostAmount + (itemMoney.itemsCostAmountAdd || 0);
        const itemsDiscountUpdate = ticketOrigin.itemsDiscount + (itemMoney.itemsDiscountAdd || 0);
        const itemsActualMoneyUpdate = productMoneyUpdate + procedureMoneyUpdate + laboratoryMoneyUpdate + radiologyMoneyUpdate;
        const commissionMoneyUpdate = ticketOrigin.commissionMoney + (itemMoney.commissionMoneyAdd || 0);
        const discountType = ticketOrigin.discountType;
        let discountPercent = ticketOrigin.discountPercent;
        let discountMoney = ticketOrigin.discountMoney;
        if (discountType === variable_1.DiscountType.VND) {
            discountPercent =
                itemsActualMoneyUpdate == 0 ? 0 : Math.floor((discountMoney * 100) / itemsActualMoneyUpdate);
        }
        if (discountType === variable_1.DiscountType.Percent) {
            discountMoney = Math.floor((discountPercent * itemsActualMoneyUpdate) / 100);
        }
        const totalMoneyUpdate = itemsActualMoneyUpdate - discountMoney + ticketOrigin.surcharge;
        const debtUpdate = totalMoneyUpdate - ticketOrigin.paid;
        const profitUpdate = totalMoneyUpdate - itemsCostAmountUpdate - ticketOrigin.expense - commissionMoneyUpdate;
        const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketOrigin.id }, {
            productMoney: productMoneyUpdate != ticketOrigin.productMoney ? productMoneyUpdate : undefined,
            procedureMoney: procedureMoneyUpdate != ticketOrigin.procedureMoney ? procedureMoneyUpdate : undefined,
            laboratoryMoney: laboratoryMoneyUpdate != ticketOrigin.laboratoryMoney ? laboratoryMoneyUpdate : undefined,
            radiologyMoney: radiologyMoneyUpdate != ticketOrigin.radiologyMoney ? radiologyMoneyUpdate : undefined,
            commissionMoney: commissionMoneyUpdate != ticketOrigin.commissionMoney ? commissionMoneyUpdate : undefined,
            itemsCostAmount: itemsCostAmountUpdate != ticketOrigin.itemsCostAmount ? itemsCostAmountUpdate : undefined,
            itemsActualMoney: itemsActualMoneyUpdate,
            itemsDiscount: itemsDiscountUpdate,
            discountPercent,
            discountMoney,
            totalMoney: totalMoneyUpdate,
            debt: debtUpdate,
            profit: profitUpdate,
            deliveryStatus: (other === null || other === void 0 ? void 0 : other.deliveryStatus) != null ? other.deliveryStatus : undefined,
        });
        return ticket;
    }
};
exports.TicketChangeItemMoneyManager = TicketChangeItemMoneyManager;
exports.TicketChangeItemMoneyManager = TicketChangeItemMoneyManager = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object])
], TicketChangeItemMoneyManager);


/***/ }),
/* 162 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketPayDebtOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketPayDebtOperation = class TicketPayDebtOperation {
    constructor(dataSource, ticketManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async payDebt(params) {
        const { oid, ticketId, paymentMethodId, time, money, note, cashierId } = params;
        const PREFIX = `ticketId=${ticketId} pay debt failed`;
        if (money <= 0) {
            throw new Error(`${PREFIX}: money = ${money}`);
        }
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: ticket_entity_1.TicketStatus.Debt,
            }, {
                status: () => `CASE 
              WHEN("totalMoney" > paid + ${money}) THEN ${ticket_entity_1.TicketStatus.Debt} 
              ELSE ${ticket_entity_1.TicketStatus.Completed} 
            END
          `,
                paid: () => `paid + ${money}`,
                debt: () => `debt - ${money}`,
            });
            if (ticket.paid > ticket.totalMoney) {
                throw new Error(`${PREFIX}: Money invalid, ticket=${ticket}`);
            }
            const customer = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticket.customerId }, { debt: () => `debt - ${money}` });
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customerCloseDebt + money;
            const paymentInsert = {
                oid,
                paymentMethodId,
                voucherType: payment_entity_1.VoucherType.Ticket,
                voucherId: ticketId,
                personType: payment_entity_1.PersonType.Customer,
                personId: ticket.customerId,
                paymentTiming: payment_entity_1.PaymentTiming.PayDebt,
                createdAt: time,
                moneyDirection: payment_entity_1.MoneyDirection.In,
                paidAmount: money,
                debtAmount: -money,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
                cashierId,
                note,
                description: '',
            };
            const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticket, payment, customer };
        });
    }
};
exports.TicketPayDebtOperation = TicketPayDebtOperation;
exports.TicketPayDebtOperation = TicketPayDebtOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], TicketPayDebtOperation);


/***/ }),
/* 163 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketPaymentAndCloseOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(43);
const commission_entity_1 = __webpack_require__(75);
const payment_entity_1 = __webpack_require__(48);
const ticket_product_entity_1 = __webpack_require__(69);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketPaymentAndCloseOperation = class TicketPaymentAndCloseOperation {
    constructor(dataSource, ticketManager, ticketUserManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketUserManager = ticketUserManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async paymentAndClose(params) {
        const { oid, ticketId, paymentMethodId, time, money, note, cashierId } = params;
        const PREFIX = `ticketId=${ticketId} close failed`;
        if (money < 0) {
            throw new Error(`${PREFIX}: money = ${money}`);
        }
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction('READ UNCOMMITTED');
        try {
            const manager = queryRunner.manager;
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing],
                },
            }, { updatedAt: time, endedAt: time });
            const ticketProcedureList = await manager.find(entities_1.TicketProcedure, {
                where: { ticketId },
            });
            const ticketProductList = await manager.find(entities_1.TicketProduct, {
                where: { ticketId },
            });
            const ticketLaboratoryList = await manager.find(entities_1.TicketLaboratory, {
                where: { ticketId },
            });
            const ticketRadiologyList = await manager.find(entities_1.TicketRadiology, {
                where: { ticketId },
            });
            const ticketUserList = await this.ticketUserManager.findMany(manager, {
                condition: { ticketId },
            });
            if (ticketProductList.find((i) => i.deliveryStatus === variable_1.DeliveryStatus.Pending)) {
                throw new Error('Không thể đóng phiếu khi chưa xuất hết hàng');
            }
            let commissionMoney = 0;
            let ticketUserModifiedList = [];
            let ticketUserDeletedList = [];
            if (ticketUserList.length) {
                const ticketUserRemoveList = [];
                const ticketUserUpdateList = ticketUserList.map((tu) => {
                    let commissionMoney = 0;
                    let commissionPercentActual = 0;
                    let commissionPercentExpected = 0;
                    let ticketItemExpectedPrice = 0;
                    let ticketItemActualPrice = 0;
                    if (tu.interactType === commission_entity_1.InteractType.Ticket) {
                        ticketItemExpectedPrice = ticketOrigin.totalMoney + ticketOrigin.discountMoney;
                        ticketItemActualPrice = ticketOrigin.totalMoney;
                    }
                    if (tu.interactType === commission_entity_1.InteractType.Product) {
                        const ticketProduct = ticketProductList.find((i) => i.id === tu.ticketItemId);
                        if (!ticketProduct)
                            ticketUserRemoveList.push(tu);
                        ticketItemExpectedPrice = (ticketProduct === null || ticketProduct === void 0 ? void 0 : ticketProduct.expectedPrice) || 0;
                        ticketItemActualPrice = (ticketProduct === null || ticketProduct === void 0 ? void 0 : ticketProduct.actualPrice) || 0;
                    }
                    if (tu.interactType === commission_entity_1.InteractType.Procedure) {
                        const ticketProcedure = ticketProcedureList.find((i) => i.id === tu.ticketItemId);
                        if (!ticketProcedure)
                            ticketUserRemoveList.push(tu);
                        ticketItemExpectedPrice = ticketProcedure.expectedPrice || 0;
                        ticketItemActualPrice = ticketProcedure.actualPrice || 0;
                    }
                    if (tu.interactType === commission_entity_1.InteractType.Radiology) {
                        const ticketRadiology = ticketRadiologyList.find((i) => i.id === tu.ticketItemId);
                        if (!ticketRadiology)
                            ticketUserRemoveList.push(tu);
                        ticketItemExpectedPrice = ticketRadiology.expectedPrice || 0;
                        ticketItemActualPrice = ticketRadiology.actualPrice || 0;
                    }
                    if (tu.interactType === commission_entity_1.InteractType.Laboratory) {
                        const ticketLaboratory = ticketLaboratoryList.find((i) => i.id === tu.ticketItemId);
                        if (!ticketLaboratory)
                            ticketUserRemoveList.push(tu);
                        ticketItemExpectedPrice = ticketLaboratory.expectedPrice || 0;
                        ticketItemActualPrice = ticketLaboratory.actualPrice || 0;
                    }
                    if (tu.interactType === commission_entity_1.InteractType.ConsumableList) {
                        const ticketProductConsumableList = ticketProductList.filter((i) => {
                            return i.type === ticket_product_entity_1.TicketProductType.Consumable;
                        });
                        ticketItemExpectedPrice = ticketProductConsumableList.reduce((acc, cur) => {
                            return acc + cur.expectedPrice * cur.quantity;
                        }, 0);
                        ticketItemActualPrice = ticketProductConsumableList.reduce((acc, cur) => {
                            return acc + cur.actualPrice * cur.quantity;
                        }, 0);
                    }
                    if (tu.interactType === commission_entity_1.InteractType.PrescriptionList) {
                        const ticketProductPrescriptionList = ticketProductList.filter((i) => {
                            return i.type === ticket_product_entity_1.TicketProductType.Prescription;
                        });
                        ticketItemExpectedPrice = ticketProductPrescriptionList.reduce((acc, cur) => {
                            return acc + cur.expectedPrice * cur.quantity;
                        }, 0);
                        ticketItemActualPrice = ticketProductPrescriptionList.reduce((acc, cur) => {
                            return acc + cur.actualPrice * cur.quantity;
                        }, 0);
                    }
                    const commissionCalculatorType = tu.commissionCalculatorType;
                    if (commissionCalculatorType === commission_entity_1.CommissionCalculatorType.VND) {
                        commissionMoney = tu.commissionMoney;
                        commissionPercentExpected =
                            ticketItemExpectedPrice === 0
                                ? 0
                                : Math.floor((commissionMoney * 100) / ticketItemExpectedPrice);
                        commissionPercentActual =
                            ticketItemActualPrice === 0
                                ? 0
                                : Math.floor((commissionMoney * 100) / ticketItemActualPrice);
                    }
                    if (commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected) {
                        commissionPercentExpected = tu.commissionPercentExpected || 0;
                        commissionMoney = Math.floor((ticketItemExpectedPrice * commissionPercentExpected) / 100);
                        commissionPercentActual =
                            ticketItemActualPrice === 0
                                ? 0
                                : Math.floor((commissionMoney * 100) / ticketItemActualPrice);
                    }
                    if (commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual) {
                        commissionPercentActual = tu.commissionPercentActual || 0;
                        commissionMoney = Math.floor((ticketItemActualPrice * commissionPercentActual) / 100);
                        commissionPercentExpected =
                            ticketItemExpectedPrice === 0
                                ? 0
                                : Math.floor((commissionMoney * 100) / ticketItemExpectedPrice);
                    }
                    const updateDto = {
                        id: tu.id,
                        oid,
                        ticketId,
                        roleId: tu.roleId,
                        userId: tu.userId,
                        interactId: tu.interactId,
                        interactType: tu.interactType,
                        ticketItemId: tu.ticketItemId,
                        ticketItemExpectedPrice,
                        ticketItemActualPrice,
                        quantity: tu.quantity,
                        createdAt: time,
                        commissionCalculatorType,
                        commissionMoney,
                        commissionPercentActual,
                        commissionPercentExpected,
                    };
                    return updateDto;
                });
                commissionMoney = ticketUserUpdateList.reduce((acc, cur) => {
                    return acc + cur.commissionMoney * cur.quantity;
                }, 0);
                if (ticketUserRemoveList.length) {
                    ticketUserDeletedList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                        oid,
                        id: { IN: ticketUserRemoveList.map((i) => i.id) },
                    });
                }
                ticketUserModifiedList = await this.ticketUserManager.bulkUpdate({
                    manager,
                    tempList: ticketUserUpdateList,
                    compare: ['id'],
                    condition: { oid },
                    update: [
                        'ticketItemExpectedPrice',
                        'ticketItemActualPrice',
                        'commissionCalculatorType',
                        'commissionMoney',
                        'commissionPercentActual',
                        'commissionPercentExpected',
                    ],
                });
            }
            const procedureDiscount = ticketProcedureList.reduce((acc, item) => {
                return acc + item.discountMoney * item.quantity;
            }, 0);
            const productDiscount = ticketProductList.reduce((acc, item) => {
                return acc + item.discountMoney * item.quantity;
            }, 0);
            const laboratoryDiscount = ticketLaboratoryList.reduce((acc, item) => {
                return acc + item.discountMoney;
            }, 0);
            const radiologyDiscount = ticketRadiologyList.reduce((acc, item) => {
                return acc + item.discountMoney;
            }, 0);
            const itemsDiscount = procedureDiscount + productDiscount + laboratoryDiscount + radiologyDiscount;
            const profit = ticketOrigin.totalMoney
                - ticketOrigin.itemsCostAmount
                - ticketOrigin.expense
                - commissionMoney;
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId }, {
                status: () => `CASE 
                                WHEN("totalMoney" = paid + ${money}) THEN ${ticket_entity_1.TicketStatus.Completed} 
                                ELSE ${ticket_entity_1.TicketStatus.Debt} 
                              END
                            `,
                paid: () => `paid + ${money}`,
                debt: () => `debt - ${money}`,
                itemsDiscount,
                profit,
                commissionMoney,
                endedAt: time,
            });
            if (ticket.paid > ticket.totalMoney) {
                throw new Error(`${PREFIX}: Money invalid, ticket=${ticket}`);
            }
            let customer;
            let payment;
            if (ticket.debt != 0 || money != 0) {
                if (ticket.debt > 0) {
                    customer = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticket.customerId }, { debt: () => `debt + ${ticket.debt}` });
                }
                else {
                    customer = await manager.findOneBy(entities_1.Customer, { oid, id: ticket.customerId });
                }
                if (!customer) {
                    throw new Error(`Khách hàng không tồn tại trên hệ thống`);
                }
                const customerCloseDebt = customer.debt;
                const customerOpenDebt = customerCloseDebt - ticket.debt;
                const paymentInsert = {
                    oid,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Ticket,
                    voucherId: ticketId,
                    personType: payment_entity_1.PersonType.Customer,
                    personId: ticket.customerId,
                    paymentTiming: payment_entity_1.PaymentTiming.Close,
                    createdAt: time,
                    moneyDirection: payment_entity_1.MoneyDirection.In,
                    paidAmount: money,
                    debtAmount: ticket.debt,
                    openDebt: customerOpenDebt,
                    closeDebt: customerCloseDebt,
                    cashierId,
                    note,
                    description: '',
                };
                payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            }
            await queryRunner.commitTransaction();
            return { ticket, customer, payment, ticketUserModifiedList, ticketUserDeletedList };
        }
        catch (error) {
            console.error('error:', error);
            await queryRunner.rollbackTransaction();
            throw error;
        }
        finally {
            await queryRunner.release();
        }
    }
};
exports.TicketPaymentAndCloseOperation = TicketPaymentAndCloseOperation;
exports.TicketPaymentAndCloseOperation = TicketPaymentAndCloseOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _e : Object])
], TicketPaymentAndCloseOperation);


/***/ }),
/* 164 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketPrepaymentOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketPrepaymentOperation = class TicketPrepaymentOperation {
    constructor(dataSource, ticketManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async prepayment(params) {
        const { oid, ticketId, paymentMethodId, time, money, note, cashierId } = params;
        const PREFIX = `ticketId=${ticketId} prepayment failed`;
        if (money < 0) {
            throw new Error(`${PREFIX}: money = ${money}`);
        }
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [
                        ticket_entity_1.TicketStatus.Schedule,
                        ticket_entity_1.TicketStatus.Draft,
                        ticket_entity_1.TicketStatus.Deposited,
                        ticket_entity_1.TicketStatus.Executing,
                    ],
                },
            }, {
                status: () => `CASE 
              WHEN("status" IN (${ticket_entity_1.TicketStatus.Schedule}, ${ticket_entity_1.TicketStatus.Draft})) 
                  THEN ${ticket_entity_1.TicketStatus.Deposited} 
              ELSE "status"
            END
          `,
                paid: () => `paid + ${money}`,
                debt: () => `debt - ${money}`,
            });
            if (money === 0)
                return { ticket };
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: ticket.customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                cashierId,
                paymentMethodId,
                voucherType: payment_entity_1.VoucherType.Ticket,
                voucherId: ticketId,
                personType: payment_entity_1.PersonType.Customer,
                personId: ticket.customerId,
                paymentTiming: payment_entity_1.PaymentTiming.Prepayment,
                createdAt: time,
                moneyDirection: payment_entity_1.MoneyDirection.In,
                paidAmount: money,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
                note,
                description: '',
            };
            const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticket, customer, payment };
        });
    }
};
exports.TicketPrepaymentOperation = TicketPrepaymentOperation;
exports.TicketPrepaymentOperation = TicketPrepaymentOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], TicketPrepaymentOperation);


/***/ }),
/* 165 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRefundOverpaidOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketRefundOverpaidOperation = class TicketRefundOverpaidOperation {
    constructor(dataSource, ticketManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async refundOverpaid(params) {
        const { oid, ticketId, paymentMethodId, time, money, note, cashierId, description } = params;
        const PREFIX = `ticketId=${ticketId} refund overpaid failed`;
        if (money <= 0) {
            throw new Error(`${PREFIX}: money = ${money}`);
        }
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing] },
            }, {
                paid: () => `paid - ${money}`,
                debt: () => `debt + ${money}`,
            });
            if (ticket.paid < 0) {
                throw new Error(`${PREFIX}: Money invalid, ticket=${ticket}`);
            }
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: ticket.customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                paymentMethodId,
                voucherType: payment_entity_1.VoucherType.Ticket,
                voucherId: ticketId,
                personType: payment_entity_1.PersonType.Customer,
                personId: ticket.customerId,
                paymentTiming: payment_entity_1.PaymentTiming.ReceiveRefund,
                createdAt: time,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                paidAmount: -money,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
                cashierId,
                note,
                description,
            };
            const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticket, payment };
        });
    }
};
exports.TicketRefundOverpaidOperation = TicketRefundOverpaidOperation;
exports.TicketRefundOverpaidOperation = TicketRefundOverpaidOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], TicketRefundOverpaidOperation);


/***/ }),
/* 166 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReopenOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let TicketReopenOperation = class TicketReopenOperation {
    constructor(dataSource, ticketManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async reopen(params) {
        const { oid, ticketId, paymentMethodId, time, description, note, cashierId } = params;
        let newPaid = params.newPaid;
        const PREFIX = `ticketId=${ticketId} reopen failed`;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId }, { endedAt: null });
            if (newPaid == null)
                newPaid = ticketOrigin.paid;
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed] },
            }, {
                paid: newPaid,
                debt: () => `"totalMoney" - ${newPaid}`,
                status: ticket_entity_1.TicketStatus.Executing,
                endedAt: null,
            });
            if (ticketOrigin.paid === ticketModified.paid && ticketOrigin.debt === 0) {
                return { ticket: ticketModified };
            }
            let customer;
            if (ticketOrigin.debt > 0) {
                customer = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticketOrigin.customerId }, { debt: () => `debt - ${ticketOrigin.debt}` });
            }
            else {
                customer = await this.customerManager.findOneBy(manager, {
                    oid,
                    id: ticketOrigin.customerId,
                });
            }
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customerCloseDebt + ticketOrigin.debt;
            const paymentInsert = {
                oid,
                cashierId,
                paymentMethodId,
                voucherType: payment_entity_1.VoucherType.Ticket,
                voucherId: ticketId,
                personType: payment_entity_1.PersonType.Customer,
                personId: ticketOrigin.customerId,
                createdAt: time,
                paymentTiming: payment_entity_1.PaymentTiming.Reopen,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                paidAmount: ticketModified.paid - ticketOrigin.paid,
                debtAmount: -ticketOrigin.debt,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
                note,
                description,
            };
            const payment = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticket: ticketModified, customer, payment };
        });
    }
};
exports.TicketReopenOperation = TicketReopenOperation;
exports.TicketReopenOperation = TicketReopenOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _d : Object])
], TicketReopenOperation);


/***/ }),
/* 167 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReturnProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const commission_entity_1 = __webpack_require__(75);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const product_putaway_operation_1 = __webpack_require__(147);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketReturnProductOperation = class TicketReturnProductOperation {
    constructor(dataSource, ticketManager, productManager, batchManager, ticketProductManager, ticketBatchManager, ticketUserManager, ticketChangeItemMoneyManager, productMovementManager, productPutawayOperation) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
        this.productMovementManager = productMovementManager;
        this.productPutawayOperation = productPutawayOperation;
    }
    async returnProduct(data) {
        const { oid, ticketId, time, returnList, options } = data;
        const PREFIX = `TicketId = ${ticketId}, returnProduct failed`;
        const ERROR_LOGIC = `TicketId = ${ticketId}, returnProduct has a logic error occurred: `;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: { IN: [ticket_entity_1.TicketStatus.Executing] } }, { updatedAt: Date.now() });
            if (!returnList.length)
                return { ticket: ticketOrigin };
            const ticketBatchOriginList = await this.ticketBatchManager.findManyBy(manager, {
                oid,
                ticketId,
                id: { IN: returnList.filter((i) => !!i.ticketBatchId).map((i) => i.ticketBatchId) },
            });
            const ticketBatchOriginMap = object_helper_1.ESArray.arrayToKeyValue(ticketBatchOriginList, 'id');
            const ticketProductOriginList = await this.ticketProductManager.findManyBy(manager, {
                oid,
                ticketId,
                id: { IN: ticketBatchOriginList.map((i) => i.ticketProductId) },
            });
            const ticketProductOriginMap = object_helper_1.ESArray.arrayToKeyValue(ticketProductOriginList, 'id');
            const productIdList = ticketBatchOriginList.map((i) => i.productId);
            const batchIdList = ticketBatchOriginList.map((i) => i.batchId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(productIdList) } }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: object_helper_1.ESArray.uniqueArray(batchIdList) } }, { updatedAt: time });
            const putawayContainer = this.productPutawayOperation.generatePutawayPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: returnList.map((i) => {
                    const ticketBatchOrigin = ticketBatchOriginMap[i.ticketBatchId];
                    return {
                        voucherProductId: ticketBatchOrigin.ticketProductId,
                        voucherBatchId: i.ticketBatchId,
                        warehouseId: ticketBatchOrigin.warehouseId,
                        productId: ticketBatchOrigin.productId,
                        batchId: ticketBatchOrigin.batchId,
                        quantity: i.quantityReturn,
                        costAmount: ticketBatchOrigin.quantity == 0
                            ? 0
                            : (ticketBatchOrigin.costAmount * i.quantityReturn) / ticketBatchOrigin.quantity,
                    };
                }),
            });
            const ticketProductModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Delivered } },
                compare: ['id', 'productId'],
                tempList: putawayContainer.putawayVoucherProductList.map((i) => {
                    return {
                        id: i.voucherProductId,
                        productId: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: (options === null || options === void 0 ? void 0 : options.changePendingIfNoStock)
                    ? {
                        quantity: (t, u) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN "quantity"
                                    ELSE "${u}"."quantity" - "${t}"."putawayQuantity"
                                  END`,
                        costAmount: () => `"costAmount" - "putawayCostAmount"`,
                        deliveryStatus: (t) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.Pending}
                                    ELSE "deliveryStatus"
                                  END`,
                    }
                    : {
                        quantity: () => `"quantity" - "putawayQuantity"`,
                        costAmount: () => `"costAmount" - "putawayCostAmount"`,
                        deliveryStatus: (t) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.NoStock}
                                    ELSE "deliveryStatus"
                                  END`,
                    },
                options: { requireEqualLength: true },
            });
            const ticketProductModifiedMap = object_helper_1.ESArray.arrayToKeyValue(ticketProductModifiedList, 'id');
            const ticketBatchModifiedList = await this.ticketBatchManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Delivered } },
                compare: ['id', 'ticketProductId', 'productId', 'batchId'],
                tempList: putawayContainer.putawayVoucherBatchList.map((i) => {
                    return {
                        id: i.voucherBatchId,
                        ticketProductId: i.voucherProductId,
                        productId: i.productId,
                        batchId: i.batchId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "putawayQuantity"`,
                    costAmount: () => `"costAmount" - "putawayCostAmount"`,
                    deliveryStatus: (t, u) => ` CASE
                                    WHEN  ("${u}"."quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.NoStock}
                                    ELSE ${variable_1.DeliveryStatus.Delivered}
                                  END`,
                },
                options: { requireEqualLength: true },
            });
            const ticketBatchModifiedMap = object_helper_1.ESArray.arrayToKeyValue(ticketBatchModifiedList, 'id');
            const tbModifiedNoStockList = ticketBatchModifiedList.filter((i) => {
                return i.deliveryStatus === variable_1.DeliveryStatus.NoStock;
            });
            if (tbModifiedNoStockList.length) {
                await this.ticketBatchManager.deleteAndReturnEntity(manager, {
                    oid,
                    id: { IN: tbModifiedNoStockList.map((i) => i.id) },
                });
            }
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: putawayContainer.putawayProductList.map((i) => {
                    return {
                        id: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        quantity: i.closeQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = object_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: putawayContainer.putawayBatchList
                    .filter((i) => !!i.batchId)
                    .map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" + "putawayQuantity"`,
                    costAmount: () => `"costAmount" + "putawayCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchMap = object_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = putawayContainer.putawayMovementList.map((paMovement) => {
                const tpOrigin = ticketProductOriginMap[paMovement.voucherProductId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.Ticket,
                    contactId: ticketOrigin.customerId,
                    voucherId: ticketOrigin.id,
                    voucherProductId: tpOrigin.id,
                    warehouseId: paMovement.warehouseId,
                    productId: paMovement.productId,
                    batchId: paMovement.batchId,
                    createdAt: time,
                    isRefund: 1,
                    expectedPrice: tpOrigin.expectedPrice,
                    actualPrice: tpOrigin.actualPrice,
                    quantity: paMovement.putawayQuantity,
                    costAmount: paMovement.putawayCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            const ticketUserOriginList = await this.ticketUserManager.findManyBy(manager, {
                oid,
                ticketId,
                interactType: commission_entity_1.InteractType.Product,
                ticketItemId: { IN: ticketProductModifiedList.map((i) => i.id) },
            });
            let ticketUserModifiedList = [];
            let ticketUserDestroyedList = [];
            let commissionMoneyReturn = 0;
            if (ticketUserOriginList.length) {
                const result = await this.ticketUserManager.changeQuantityByTicketItem({
                    manager,
                    information: { oid, ticketId, interactType: commission_entity_1.InteractType.Product },
                    dataChange: ticketProductModifiedList.map((i) => {
                        return { quantity: i.quantity, ticketItemId: i.id };
                    }),
                });
                ticketUserModifiedList = result.ticketUserModifiedList;
                ticketUserDestroyedList = result.ticketUserDestroyedList;
                commissionMoneyReturn =
                    ticketUserOriginList.reduce((acc, item) => {
                        return acc + item.quantity * item.commissionMoney;
                    }, 0)
                        - ticketUserModifiedList.reduce((acc, item) => {
                            return acc + item.quantity * item.commissionMoney;
                        }, 0)
                        - ticketUserDestroyedList.reduce((acc, item) => {
                            return acc + item.quantity * item.commissionMoney;
                        }, 0);
            }
            let productMoneyReturn = 0;
            let productDiscountReturn = 0;
            let itemsCostAmountReturn = 0;
            ticketProductOriginList.forEach((tpOrigin) => {
                const tpModified = ticketProductModifiedMap[tpOrigin.id];
                productMoneyReturn
                    += tpOrigin.actualPrice * tpOrigin.quantity - tpModified.actualPrice * tpModified.quantity;
                productDiscountReturn
                    += tpOrigin.discountMoney * tpOrigin.quantity
                        - tpModified.discountMoney * tpModified.quantity;
                itemsCostAmountReturn += tpOrigin.costAmount - tpModified.costAmount;
            });
            const ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                manager,
                oid,
                ticketOrigin,
                itemMoney: {
                    productMoneyAdd: -productMoneyReturn,
                    itemsCostAmountAdd: -itemsCostAmountReturn,
                    itemsDiscountAdd: -productDiscountReturn,
                    commissionMoneyAdd: -commissionMoneyReturn,
                },
            });
            return {
                ticket,
                productModifiedList,
                ticketProductModifiedList,
                ticketUserModifiedList,
                ticketUserDestroyedList,
            };
        });
    }
};
exports.TicketReturnProductOperation = TicketReturnProductOperation;
exports.TicketReturnProductOperation = TicketReturnProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.TicketBatchManager !== "undefined" && managers_1.TicketBatchManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _g : Object, typeof (_h = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _h : Object, typeof (_j = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _j : Object, typeof (_k = typeof product_putaway_operation_1.ProductPutawayOperation !== "undefined" && product_putaway_operation_1.ProductPutawayOperation) === "function" ? _k : Object])
], TicketReturnProductOperation);


/***/ }),
/* 168 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSendProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const product_picking_operation_1 = __webpack_require__(145);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketSendProductOperation = class TicketSendProductOperation {
    constructor(dataSource, ticketManager, productManager, batchManager, ticketProductManager, ticketBatchManager, productMovementManager, ticketChangeItemMoneyManager, productPickingOperation) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.productMovementManager = productMovementManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
        this.productPickingOperation = productPickingOperation;
    }
    async sendAllProduct(params) {
        const { oid, ticketId, time, allowNegativeQuantity } = params;
        const PREFIX = `TicketId = ${ticketId}, sendProduct failed`;
        const ERROR_LOGIC = `TicketId = ${ticketId}, sendProduct has a logic error occurred: `;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            let ticket = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing],
                },
            }, {
                updatedAt: Date.now(),
                status: ticket_entity_1.TicketStatus.Executing,
                deliveryStatus: variable_1.DeliveryStatus.Delivered,
            });
            const ticketProductOriginList = await this.ticketProductManager.findManyBy(manager, {
                oid,
                ticketId,
                deliveryStatus: variable_1.DeliveryStatus.Pending,
            });
            if (ticketProductOriginList.length === 0) {
                return { ticket };
            }
            const ticketProductOriginMap = object_helper_1.ESArray.arrayToKeyValue(ticketProductOriginList, 'id');
            const productIdList = ticketProductOriginList.map((i) => i.productId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: productIdList } }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, productId: { IN: productIdList } }, { updatedAt: time });
            const batchOriginMap = object_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
            const pickingContainer = this.productPickingOperation.generatePickingPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: ticketProductOriginList.map((i) => {
                    return Object.assign(Object.assign({}, i), { voucherProductId: i.id, voucherBatchId: 0, costAmount: null });
                }),
                allowNegativeQuantity,
            });
            const ticketProductModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Pending } },
                compare: ['id', 'productId', 'quantity'],
                tempList: pickingContainer.pickingVoucherProductList.map((i) => {
                    return {
                        id: i.voucherProductId,
                        productId: i.productId,
                        quantity: i.pickingQuantity,
                        costAmount: i.pickingCostAmount,
                        deliveryStatus: variable_1.DeliveryStatus.Delivered,
                    };
                }),
                update: ['costAmount', 'deliveryStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductModifiedMap = object_helper_1.ESArray.arrayToKeyValue(ticketProductModifiedList, 'id');
            const ticketBatchInsertList = pickingContainer.pickingVoucherBatchList.map((pickingTicketBatch) => {
                const tp = ticketProductModifiedMap[pickingTicketBatch.voucherProductId];
                const batchOrigin = batchOriginMap[pickingTicketBatch.batchId];
                const ticketBatchInsert = {
                    oid,
                    ticketId,
                    customerId: tp.customerId,
                    ticketProductId: tp.id,
                    warehouseId: (batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.warehouseId) || 0,
                    productId: tp.productId,
                    batchId: pickingTicketBatch.batchId || 0,
                    deliveryStatus: variable_1.DeliveryStatus.Delivered,
                    unitRate: tp.unitRate,
                    quantity: pickingTicketBatch.pickingQuantity,
                    costAmount: pickingTicketBatch.pickingCostAmount,
                    actualPrice: tp.actualPrice,
                    expectedPrice: tp.expectedPrice,
                };
                return ticketBatchInsert;
            });
            await this.ticketBatchManager.insertManyAndReturnEntity(manager, ticketBatchInsertList);
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: pickingContainer.pickingProductList.map((i) => {
                    return {
                        id: i.productId,
                        quantity: i.closeQuantity,
                        pickingQuantity: i.pickingQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = object_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: pickingContainer.pickingBatchList
                    .filter((i) => !!i.batchId)
                    .map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        pickingCostAmount: i.pickingCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "pickingQuantity"`,
                    costAmount: () => `"costAmount" - "pickingCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchModifiedMap = object_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = pickingContainer.pickingMovementList.map((paMovement) => {
                const tpOrigin = ticketProductOriginMap[paMovement.voucherProductId];
                const batch = batchModifiedMap[paMovement.batchId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.Ticket,
                    contactId: ticket.customerId,
                    voucherId: ticket.id,
                    voucherProductId: tpOrigin.id,
                    warehouseId: (batch === null || batch === void 0 ? void 0 : batch.warehouseId) || 0,
                    productId: paMovement.productId,
                    batchId: paMovement.batchId,
                    createdAt: time,
                    isRefund: 0,
                    expectedPrice: tpOrigin.expectedPrice,
                    actualPrice: tpOrigin.actualPrice,
                    quantity: -paMovement.pickingQuantity,
                    costAmount: -paMovement.pickingCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            const costAmountOrigin = ticketProductOriginList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            const costAmountModified = ticketProductModifiedList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            const costAmountAdd = costAmountModified - costAmountOrigin;
            if (costAmountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin: ticket,
                    itemMoney: {
                        itemsCostAmountAdd: costAmountAdd,
                    },
                });
            }
            return {
                ticket,
                ticketProductModifiedList,
                productModifiedList,
            };
        });
    }
};
exports.TicketSendProductOperation = TicketSendProductOperation;
exports.TicketSendProductOperation = TicketSendProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.TicketBatchManager !== "undefined" && managers_1.TicketBatchManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _g : Object, typeof (_h = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _h : Object, typeof (_j = typeof product_picking_operation_1.ProductPickingOperation !== "undefined" && product_picking_operation_1.ProductPickingOperation) === "function" ? _j : Object])
], TicketSendProductOperation);


/***/ }),
/* 169 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketStatisticOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const repositories_1 = __webpack_require__(170);
let TicketStatisticOperation = class TicketStatisticOperation {
    constructor(dataSource, manager, ticketRepository) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketRepository = ticketRepository;
    }
    async statistic(options) {
        const { groupTimeType, condition } = options;
        const where = this.ticketRepository.getWhereOptions(condition);
        let query = this.manager
            .createQueryBuilder(entities_1.Ticket, 'ticket')
            .where(where)
            .select([
            'COUNT(*) AS "countTicket"',
            'SUM("totalMoney") AS "sumTotalMoney"',
            'SUM("itemsCostAmount") AS "sumItemsCostAmount"',
            'SUM("procedureMoney") AS "sumProcedureMoney"',
            'SUM("productMoney") AS "sumProductMoney"',
            'SUM("radiologyMoney") AS "sumRadiologyMoney"',
            'SUM("laboratoryMoney") AS "sumLaboratoryMoney"',
            'SUM("surcharge") AS "sumSurcharge"',
            'SUM("expense") AS "sumExpense"',
            'SUM("discountMoney" + "itemsDiscount") AS "sumDiscountMoney"',
            'SUM("profit") AS "sumProfit"',
            'SUM("debt") AS "sumDebt"',
        ]);
        if (groupTimeType === 'month') {
            query = query.addSelect(['"year"', '"month"']).groupBy('"year"').addGroupBy('"month"');
        }
        if (groupTimeType === 'date') {
            query = query
                .addSelect(['"year"', '"month"', '"date"'])
                .groupBy('"year"')
                .addGroupBy('"month"')
                .addGroupBy('"date"');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            year: i.year,
            month: i.month,
            date: i.date,
            countTicket: Number(i.countTicket),
            sumTotalMoney: Number(i.sumTotalMoney),
            sumItemsCostAmount: Number(i.sumItemsCostAmount),
            sumProcedureMoney: Number(i.sumProcedureMoney),
            sumProductMoney: Number(i.sumProductMoney),
            sumRadiologyMoney: Number(i.sumRadiologyMoney),
            sumLaboratoryMoney: Number(i.sumLaboratoryMoney),
            sumSurcharge: Number(i.sumSurcharge),
            sumExpense: Number(i.sumExpense),
            sumDiscountMoney: Number(i.sumDiscountMoney),
            sumProfit: Number(i.sumProfit),
            sumDebt: Number(i.sumDebt),
        }));
    }
};
exports.TicketStatisticOperation = TicketStatisticOperation;
exports.TicketStatisticOperation = TicketStatisticOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _c : Object])
], TicketStatisticOperation);


/***/ }),
/* 170 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(171), exports);
__exportStar(__webpack_require__(172), exports);
__exportStar(__webpack_require__(173), exports);
__exportStar(__webpack_require__(174), exports);
__exportStar(__webpack_require__(175), exports);
__exportStar(__webpack_require__(176), exports);
__exportStar(__webpack_require__(177), exports);
__exportStar(__webpack_require__(178), exports);
__exportStar(__webpack_require__(179), exports);
__exportStar(__webpack_require__(180), exports);
__exportStar(__webpack_require__(41), exports);
__exportStar(__webpack_require__(181), exports);
__exportStar(__webpack_require__(182), exports);
__exportStar(__webpack_require__(86), exports);
__exportStar(__webpack_require__(183), exports);
__exportStar(__webpack_require__(184), exports);
__exportStar(__webpack_require__(185), exports);
__exportStar(__webpack_require__(186), exports);
__exportStar(__webpack_require__(187), exports);
__exportStar(__webpack_require__(188), exports);
__exportStar(__webpack_require__(189), exports);
__exportStar(__webpack_require__(190), exports);
__exportStar(__webpack_require__(191), exports);
__exportStar(__webpack_require__(192), exports);
__exportStar(__webpack_require__(193), exports);
__exportStar(__webpack_require__(87), exports);
__exportStar(__webpack_require__(88), exports);
__exportStar(__webpack_require__(194), exports);
__exportStar(__webpack_require__(195), exports);
__exportStar(__webpack_require__(196), exports);
__exportStar(__webpack_require__(197), exports);
__exportStar(__webpack_require__(198), exports);
__exportStar(__webpack_require__(199), exports);
__exportStar(__webpack_require__(200), exports);
__exportStar(__webpack_require__(201), exports);
__exportStar(__webpack_require__(202), exports);
__exportStar(__webpack_require__(203), exports);
__exportStar(__webpack_require__(204), exports);
__exportStar(__webpack_require__(205), exports);
__exportStar(__webpack_require__(206), exports);
__exportStar(__webpack_require__(207), exports);
__exportStar(__webpack_require__(89), exports);
__exportStar(__webpack_require__(90), exports);
__exportStar(__webpack_require__(208), exports);


/***/ }),
/* 171 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let AppointmentRepository = class AppointmentRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, appointmentRepository) {
        super(entities_1.Appointment, appointmentRepository);
        this.dataSource = dataSource;
        this.appointmentRepository = appointmentRepository;
    }
};
exports.AppointmentRepository = AppointmentRepository;
exports.AppointmentRepository = AppointmentRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Appointment)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], AppointmentRepository);


/***/ }),
/* 172 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const managers_1 = __webpack_require__(100);
const _postgresql_repository_1 = __webpack_require__(83);
let BatchRepository = class BatchRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, batchRepository, productManager, batchManager, productMovementManager, receiptItemManager, ticketProductManager, ticketBatchManager, stockCheckItemManager) {
        super(entities_1.Batch, batchRepository);
        this.dataSource = dataSource;
        this.batchRepository = batchRepository;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.receiptItemManager = receiptItemManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.stockCheckItemManager = stockCheckItemManager;
    }
    async mergeBatch(options) {
        const { oid, productId, batchIdSourceList, batchIdTarget } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const batchSourceList = await this.batchManager.deleteAndReturnEntity(manager, {
                oid,
                productId,
                id: { IN: batchIdSourceList },
            });
            const quantitySourceAdd = batchSourceList.reduce((acc, item) => acc + item.quantity, 0);
            const costAmountSourceAdd = batchSourceList.reduce((acc, item) => acc + item.costAmount, 0);
            const batchTargetModified = await this.batchManager.updateOneAndReturnEntity(manager, { oid, id: batchIdTarget, productId }, {
                quantity: () => `quantity + ${quantitySourceAdd}`,
                costAmount: () => `"costAmount" + ${costAmountSourceAdd}`,
            });
            await this.receiptItemManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.ticketProductManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.ticketBatchManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.stockCheckItemManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.productMovementManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            return batchTargetModified;
        });
    }
};
exports.BatchRepository = BatchRepository;
exports.BatchRepository = BatchRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Batch)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _g : Object, typeof (_h = typeof managers_1.TicketBatchManager !== "undefined" && managers_1.TicketBatchManager) === "function" ? _h : Object, typeof (_j = typeof managers_1.StockCheckItemManager !== "undefined" && managers_1.StockCheckItemManager) === "function" ? _j : Object])
], BatchRepository);


/***/ }),
/* 173 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let CommissionRepository = class CommissionRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, commissionRepository) {
        super(entities_1.Commission, commissionRepository);
        this.dataSource = dataSource;
        this.commissionRepository = commissionRepository;
    }
};
exports.CommissionRepository = CommissionRepository;
exports.CommissionRepository = CommissionRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Commission)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], CommissionRepository);


/***/ }),
/* 174 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let CustomerSourceRepository = class CustomerSourceRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, customerSourceRepository) {
        super(entities_1.CustomerSource, customerSourceRepository);
        this.dataSource = dataSource;
        this.customerSourceRepository = customerSourceRepository;
    }
};
exports.CustomerSourceRepository = CustomerSourceRepository;
exports.CustomerSourceRepository = CustomerSourceRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.CustomerSource)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], CustomerSourceRepository);


/***/ }),
/* 175 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let CustomerRepository = class CustomerRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, customerRepository) {
        super(entities_1.Customer, customerRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.customerRepository = customerRepository;
    }
    async sumDebt(oid) {
        const { sum } = await this.manager
            .createQueryBuilder(entities_1.Customer, 'customer')
            .select('SUM(debt)', 'sum')
            .where({ oid })
            .getRawOne();
        return Number(sum);
    }
};
exports.CustomerRepository = CustomerRepository;
exports.CustomerRepository = CustomerRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Customer)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], CustomerRepository);


/***/ }),
/* 176 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let DistributorRepository = class DistributorRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, distributorRepository) {
        super(entities_1.Distributor, distributorRepository);
        this.dataSource = dataSource;
        this.distributorRepository = distributorRepository;
    }
};
exports.DistributorRepository = DistributorRepository;
exports.DistributorRepository = DistributorRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Distributor)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], DistributorRepository);


/***/ }),
/* 177 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ImageRepository = class ImageRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, imageRepository) {
        super(entities_1.Image, imageRepository);
        this.dataSource = dataSource;
        this.imageRepository = imageRepository;
    }
};
exports.ImageRepository = ImageRepository;
exports.ImageRepository = ImageRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Image)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ImageRepository);


/***/ }),
/* 178 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let LaboratoryGroupRepository = class LaboratoryGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratoryGroupRepository) {
        super(entities_1.LaboratoryGroup, laboratoryGroupRepository);
        this.dataSource = dataSource;
        this.laboratoryGroupRepository = laboratoryGroupRepository;
    }
    async replaceAll(oid, laboratoryGroupListDto) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.LaboratoryGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(laboratoryGroupListDto.map((i) => i.id))),
            });
            const laboratoryGroupInsertDto = laboratoryGroupListDto
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = {
                    oid,
                    name: i.name,
                    printHtmlId: i.printHtmlId,
                };
                return insertDto;
            });
            if (laboratoryGroupInsertDto.length) {
                await manager.insert(entities_1.LaboratoryGroup, laboratoryGroupInsertDto);
            }
            const laboratoryGroupUpdateDto = laboratoryGroupListDto
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = {
                    id: i.id,
                    name: i.name,
                    printHtmlId: i.printHtmlId,
                };
                return updateDto;
            });
            if (laboratoryGroupUpdateDto.length) {
                await manager.query(`
          UPDATE  "LaboratoryGroup" AS "group"
          SET     "name"        = temp.name,
                  "printHtmlId" = temp."printHtmlId"
          FROM (VALUES `
                    + laboratoryGroupUpdateDto.map(({ id, name, printHtmlId }) => {
                        return `(${id}, '${name}', ${printHtmlId})`;
                    }).join(', ')
                    + `   ) AS temp("id", "name", "printHtmlId")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.LaboratoryGroupRepository = LaboratoryGroupRepository;
exports.LaboratoryGroupRepository = LaboratoryGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.LaboratoryGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratoryGroupRepository);


/***/ }),
/* 179 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryKitRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let LaboratoryKitRepository = class LaboratoryKitRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratoryKitRepository) {
        super(entities_1.LaboratoryKit, laboratoryKitRepository);
        this.dataSource = dataSource;
        this.laboratoryKitRepository = laboratoryKitRepository;
    }
};
exports.LaboratoryKitRepository = LaboratoryKitRepository;
exports.LaboratoryKitRepository = LaboratoryKitRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.LaboratoryKit)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratoryKitRepository);


/***/ }),
/* 180 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let LaboratoryRepository = class LaboratoryRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratoryRepository) {
        super(entities_1.Laboratory, laboratoryRepository);
        this.dataSource = dataSource;
        this.laboratoryRepository = laboratoryRepository;
    }
    async updateChildren(payload) {
        const { oid, laboratoryParent, laboratoryChildrenDtoList } = payload;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const whereTicketDelete = {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(laboratoryChildrenDtoList.map((i) => i.id))),
                parentId: laboratoryParent.id,
                level: 2,
            };
            await manager.delete(entities_1.Laboratory, whereTicketDelete);
            const laboratoryInsertList = laboratoryChildrenDtoList
                .filter((i) => i.id === 0)
                .map((i) => {
                const laboratoryInsert = Object.assign(Object.assign({}, i), { oid, parentId: laboratoryParent.id, laboratoryGroupId: laboratoryParent.laboratoryGroupId, level: 2 });
                return laboratoryInsert;
            });
            if (laboratoryInsertList.length) {
                await manager.insert(entities_1.Laboratory, laboratoryInsertList);
            }
            const laboratoryUpdateList = laboratoryChildrenDtoList
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = Object.assign({}, i);
                return updateDto;
            });
            if (laboratoryUpdateList.length) {
                const laboratoryUpdateResult = await manager.query(`
          UPDATE  "Laboratory" AS "laboratory"
          SET     "priority" = temp.priority,
                  "name" = temp.name,
                  "laboratoryGroupId" = ${laboratoryParent.laboratoryGroupId},
                  "price" = temp.price,
                  "valueType" = temp."valueType",
                  "unit" = temp.unit,
                  "lowValue" = temp."lowValue",
                  "highValue" = temp."highValue",
                  "options" = temp.options
          FROM (VALUES `
                    + laboratoryUpdateList.map((i) => {
                        return `(${i.id}, ${i.priority}, '${i.name}', ${i.price}, 
                    ${i.valueType}, '${i.unit}', ${i.lowValue}, 
                    ${i.highValue}, '${i.options}'
                    )`;
                    }).join(', ')
                    + `   ) AS temp("id", "priority", "name", "price", 
                          "valueType", "unit", "lowValue", 
                          "highValue", "options"
                          )
          WHERE   "laboratory"."id" = temp."id" 
              AND "laboratory"."oid" = ${oid} 
              AND "laboratory"."parentId" = ${laboratoryParent.id} 
              AND "laboratory"."level" = 2
          `);
                if (laboratoryUpdateResult[1] != laboratoryUpdateList.length) {
                    throw new Error(`Update Laboratory children failed, 
            affected = ${laboratoryUpdateResult[1]}`);
                }
            }
            return;
        });
    }
};
exports.LaboratoryRepository = LaboratoryRepository;
exports.LaboratoryRepository = LaboratoryRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Laboratory)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratoryRepository);


/***/ }),
/* 181 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let PaymentMethodRepository = class PaymentMethodRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, paymentMethodRepository) {
        super(entities_1.PaymentMethod, paymentMethodRepository);
        this.dataSource = dataSource;
        this.paymentMethodRepository = paymentMethodRepository;
    }
};
exports.PaymentMethodRepository = PaymentMethodRepository;
exports.PaymentMethodRepository = PaymentMethodRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PaymentMethod)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PaymentMethodRepository);


/***/ }),
/* 182 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let PaymentRepository = class PaymentRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, paymentRepository) {
        super(entities_1.Payment, paymentRepository);
        this.dataSource = dataSource;
        this.paymentRepository = paymentRepository;
    }
};
exports.PaymentRepository = PaymentRepository;
exports.PaymentRepository = PaymentRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Payment)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PaymentRepository);


/***/ }),
/* 183 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let PrescriptionSampleRepository = class PrescriptionSampleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, prescriptionSampleRepository) {
        super(entities_1.PrescriptionSample, prescriptionSampleRepository);
        this.dataSource = dataSource;
        this.prescriptionSampleRepository = prescriptionSampleRepository;
    }
};
exports.PrescriptionSampleRepository = PrescriptionSampleRepository;
exports.PrescriptionSampleRepository = PrescriptionSampleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PrescriptionSample)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PrescriptionSampleRepository);


/***/ }),
/* 184 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let PrintHtmlRepository = class PrintHtmlRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(printHtmlRepository) {
        super(entities_1.PrintHtml, printHtmlRepository);
        this.printHtmlRepository = printHtmlRepository;
    }
};
exports.PrintHtmlRepository = PrintHtmlRepository;
exports.PrintHtmlRepository = PrintHtmlRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.PrintHtml)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], PrintHtmlRepository);


/***/ }),
/* 185 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ProcedureGroupRepository = class ProcedureGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, procedureGroupRepository) {
        super(entities_1.ProcedureGroup, procedureGroupRepository);
        this.dataSource = dataSource;
        this.procedureGroupRepository = procedureGroupRepository;
    }
    async replaceAll(oid, data) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.ProcedureGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(data.map((i) => i.id))),
            });
            const procedureGroupInsertDto = data
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = { oid, name: i.name };
                return insertDto;
            });
            if (procedureGroupInsertDto.length) {
                await manager.insert(entities_1.ProcedureGroup, procedureGroupInsertDto);
            }
            const procedureGroupUpdateDto = data
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = { id: i.id, name: i.name };
                return updateDto;
            });
            if (procedureGroupUpdateDto.length) {
                await manager.query(`
          UPDATE "ProcedureGroup" AS "group"
          SET "name" = temp.name
          FROM (VALUES `
                    + procedureGroupUpdateDto
                        .map(({ id, name }) => `(${id}, '${name}')`)
                        .join(', ')
                    + `   ) AS temp("id", "name")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.ProcedureGroupRepository = ProcedureGroupRepository;
exports.ProcedureGroupRepository = ProcedureGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProcedureGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProcedureGroupRepository);


/***/ }),
/* 186 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ProcedureRepository = class ProcedureRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, procedureRepository) {
        super(entities_1.Procedure, procedureRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.procedureRepository = procedureRepository;
    }
};
exports.ProcedureRepository = ProcedureRepository;
exports.ProcedureRepository = ProcedureRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Procedure)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], ProcedureRepository);


/***/ }),
/* 187 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ProductGroupRepository = class ProductGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, productGroupRepository) {
        super(entities_1.ProductGroup, productGroupRepository);
        this.dataSource = dataSource;
        this.productGroupRepository = productGroupRepository;
    }
    async replaceAll(oid, data) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.ProductGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(data.map((i) => i.id))),
            });
            const productGroupInsertDto = data
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = { oid, name: i.name };
                return insertDto;
            });
            if (productGroupInsertDto.length) {
                await manager.insert(entities_1.ProductGroup, productGroupInsertDto);
            }
            const productGroupUpdateDto = data
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = { id: i.id, name: i.name };
                return updateDto;
            });
            if (productGroupUpdateDto.length) {
                await manager.query(`
          UPDATE "ProductGroup" AS "group"
          SET "name" = temp.name
          FROM (VALUES `
                    + productGroupUpdateDto
                        .map(({ id, name }) => `(${id}, '${name}')`)
                        .join(', ')
                    + `   ) AS temp("id", "name")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.ProductGroupRepository = ProductGroupRepository;
exports.ProductGroupRepository = ProductGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProductGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProductGroupRepository);


/***/ }),
/* 188 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ProductMovementRepository = class ProductMovementRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, productMovementRepository) {
        super(entities_1.ProductMovement, productMovementRepository);
        this.manager = manager;
        this.productMovementRepository = productMovementRepository;
    }
    async queryOne(condition, relation) {
        var _a, _b;
        let query = this.manager
            .createQueryBuilder(entities_1.ProductMovement, 'productMovement')
            .where('productMovement.oid = :oid', { oid: condition.oid });
        if (condition === null || condition === void 0 ? void 0 : condition.productId) {
            query = query.andWhere('productMovement.productId = :productId', {
                productId: condition.productId,
            });
        }
        if (relation === null || relation === void 0 ? void 0 : relation.receipt) {
            query = query.leftJoinAndSelect('productMovement.receipt', 'receipt', 'productMovement.movementType = :typeReceipt', { typeReceipt: variable_1.MovementType.Receipt });
            if ((_a = relation === null || relation === void 0 ? void 0 : relation.receipt) === null || _a === void 0 ? void 0 : _a.distributor) {
                query = query.leftJoinAndSelect('receipt.distributor', 'distributor');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticket) {
            query = query.leftJoinAndSelect('productMovement.ticket', 'ticket', 'productMovement.movementType = :typeInvoice', { typeInvoice: variable_1.MovementType.Ticket });
            if ((_b = relation === null || relation === void 0 ? void 0 : relation.ticket) === null || _b === void 0 ? void 0 : _b.customer) {
                query = query.leftJoinAndSelect('ticket.customer', 'customer');
            }
        }
        const productMovement = await query.getOne();
        return productMovement;
    }
    async topTotalMoneyGroupByProduct(options) {
        const { oid, type, fromTime, toTime } = options;
        return await this.manager.query(`
      SELECT productId, SUM(totalMoney) AS sumTotalMoney
      FROM ProductMovement productMovement
      WHERE oid = ${oid} AND movementType = ${type} AND (createdAt BETWEEN ${fromTime} AND ${toTime})
      GROUP BY productId
      ORDER BY sumTotalMoney DESC
      LIMIT 10
    `);
    }
};
exports.ProductMovementRepository = ProductMovementRepository;
exports.ProductMovementRepository = ProductMovementRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProductMovement)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProductMovementRepository);


/***/ }),
/* 189 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(43);
const managers_1 = __webpack_require__(100);
const _postgresql_repository_1 = __webpack_require__(83);
let ProductRepository = class ProductRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(productRepository, dataSource, productManager, batchManager, productMovementManager, receiptItemManager, ticketProductManager, ticketBatchManager, stockCheckItemManager) {
        super(entities_1.Product, productRepository);
        this.productRepository = productRepository;
        this.dataSource = dataSource;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.receiptItemManager = receiptItemManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.stockCheckItemManager = stockCheckItemManager;
    }
    async mergeProduct(options) {
        const { oid, userId, productIdSourceList, productIdTarget } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const productSourceList = await this.productManager.deleteAndReturnEntity(manager, {
                oid,
                id: { IN: productIdSourceList },
            });
            const quantitySourceAdd = productSourceList.reduce((acc, item) => acc + item.quantity, 0);
            const productTargetModified = await this.productManager.updateOneAndReturnEntity(manager, { oid, id: productIdTarget }, { quantity: () => `quantity + ${quantitySourceAdd}` });
            await this.batchManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.receiptItemManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.ticketProductManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.ticketBatchManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.stockCheckItemManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.productMovementManager.delete(manager, {
                oid,
                productId: { IN: productIdSourceList },
            });
            const productMovement = {
                oid,
                movementType: variable_1.MovementType.UserChange,
                contactId: userId,
                voucherId: 0,
                voucherProductId: 0,
                warehouseId: 0,
                productId: productIdTarget,
                batchId: 0,
                isRefund: 0,
                quantity: quantitySourceAdd,
                costAmount: 0,
                openQuantityProduct: productTargetModified.quantity - quantitySourceAdd,
                closeQuantityProduct: productTargetModified.quantity,
                openQuantityBatch: 0,
                closeQuantityBatch: 0,
                openCostAmountBatch: 0,
                closeCostAmountBatch: 0,
                actualPrice: productTargetModified.costPrice,
                expectedPrice: productTargetModified.costPrice,
                createdAt: Date.now(),
            };
            await this.productMovementManager.insertOneFullField(manager, productMovement);
            return productTargetModified;
        });
    }
};
exports.ProductRepository = ProductRepository;
exports.ProductRepository = ProductRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Product)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _b : Object, typeof (_c = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.ReceiptItemManager !== "undefined" && managers_1.ReceiptItemManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _g : Object, typeof (_h = typeof managers_1.TicketBatchManager !== "undefined" && managers_1.TicketBatchManager) === "function" ? _h : Object, typeof (_j = typeof managers_1.StockCheckItemManager !== "undefined" && managers_1.StockCheckItemManager) === "function" ? _j : Object])
], ProductRepository);


/***/ }),
/* 190 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let RadiologyGroupRepository = class RadiologyGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, radiologyGroupRepository) {
        super(entities_1.RadiologyGroup, radiologyGroupRepository);
        this.dataSource = dataSource;
        this.radiologyGroupRepository = radiologyGroupRepository;
    }
    async replaceAll(oid, data) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.RadiologyGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(data.map((i) => i.id))),
            });
            const radiologyGroupInsertDto = data
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = { oid, name: i.name };
                return insertDto;
            });
            if (radiologyGroupInsertDto.length) {
                await manager.insert(entities_1.RadiologyGroup, radiologyGroupInsertDto);
            }
            const radiologyGroupUpdateDto = data
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = { id: i.id, name: i.name };
                return updateDto;
            });
            if (radiologyGroupUpdateDto.length) {
                await manager.query(`
          UPDATE "RadiologyGroup" AS "group"
          SET "name" = temp.name
          FROM (VALUES `
                    + radiologyGroupUpdateDto
                        .map(({ id, name }) => `(${id}, '${name}')`)
                        .join(', ')
                    + `   ) AS temp("id", "name")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.RadiologyGroupRepository = RadiologyGroupRepository;
exports.RadiologyGroupRepository = RadiologyGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.RadiologyGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RadiologyGroupRepository);


/***/ }),
/* 191 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let RadiologyRepository = class RadiologyRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, radiologyRepository) {
        super(entities_1.Radiology, radiologyRepository);
        this.dataSource = dataSource;
        this.radiologyRepository = radiologyRepository;
    }
};
exports.RadiologyRepository = RadiologyRepository;
exports.RadiologyRepository = RadiologyRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Radiology)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RadiologyRepository);


/***/ }),
/* 192 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptItemRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let ReceiptItemRepository = class ReceiptItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, receiptItemRepository) {
        super(entities_1.ReceiptItem, receiptItemRepository);
        this.manager = manager;
        this.receiptItemRepository = receiptItemRepository;
    }
};
exports.ReceiptItemRepository = ReceiptItemRepository;
exports.ReceiptItemRepository = ReceiptItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ReceiptItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ReceiptItemRepository);


/***/ }),
/* 193 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const receipt_entity_1 = __webpack_require__(51);
const _postgresql_repository_1 = __webpack_require__(83);
let ReceiptRepository = class ReceiptRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, receiptRepository) {
        super(entities_1.Receipt, receiptRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.receiptRepository = receiptRepository;
    }
    async queryOneBy(condition, relation) {
        var _a, _b;
        let query = this.manager
            .createQueryBuilder(entities_1.Receipt, 'receipt')
            .where('receipt.id = :id', { id: condition.id })
            .andWhere('receipt.oid = :oid', { oid: condition.oid });
        if (relation === null || relation === void 0 ? void 0 : relation.distributor) {
            query = query.leftJoinAndSelect('receipt.distributor', 'distributor');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.receiptItemList) {
            query = query.leftJoinAndSelect('receipt.receiptItemList', 'receiptItem');
            if ((_a = relation === null || relation === void 0 ? void 0 : relation.receiptItemList) === null || _a === void 0 ? void 0 : _a.batch) {
                query = query.leftJoinAndSelect('receiptItem.batch', 'batch');
            }
            if ((_b = relation === null || relation === void 0 ? void 0 : relation.receiptItemList) === null || _b === void 0 ? void 0 : _b.product) {
                query = query.leftJoinAndSelect('receiptItem.product', 'product');
            }
        }
        const receipt = await query.getOne();
        return receipt;
    }
    async destroy(params) {
        const { oid, receiptId } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const receiptDeleteResult = await manager.delete(entities_1.Receipt, {
                oid,
                id: receiptId,
                paid: 0,
                status: (0, typeorm_2.In)([receipt_entity_1.ReceiptStatus.Draft, receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Cancelled]),
            });
            if (receiptDeleteResult.affected !== 1) {
                throw new Error(`Delete Receipt ${receiptId} failed: Status invalid`);
            }
            await manager.delete(entities_1.ReceiptItem, { oid, receiptId });
        });
    }
};
exports.ReceiptRepository = ReceiptRepository;
exports.ReceiptRepository = ReceiptRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Receipt)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], ReceiptRepository);


/***/ }),
/* 194 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckItemRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let StockCheckItemRepository = class StockCheckItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, stockCheckItemRepository) {
        super(entities_1.StockCheckItem, stockCheckItemRepository);
        this.manager = manager;
        this.stockCheckItemRepository = stockCheckItemRepository;
    }
};
exports.StockCheckItemRepository = StockCheckItemRepository;
exports.StockCheckItemRepository = StockCheckItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.StockCheckItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], StockCheckItemRepository);


/***/ }),
/* 195 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let StockCheckRepository = class StockCheckRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, stockCheckRepository) {
        super(entities_1.StockCheck, stockCheckRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.stockCheckRepository = stockCheckRepository;
    }
};
exports.StockCheckRepository = StockCheckRepository;
exports.StockCheckRepository = StockCheckRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.StockCheck)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], StockCheckRepository);


/***/ }),
/* 196 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAttributeRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketAttributeRepository = class TicketAttributeRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketAttributeRepository) {
        super(entities_1.TicketAttribute, ticketAttributeRepository);
        this.manager = manager;
        this.ticketAttributeRepository = ticketAttributeRepository;
    }
};
exports.TicketAttributeRepository = TicketAttributeRepository;
exports.TicketAttributeRepository = TicketAttributeRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketAttribute)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketAttributeRepository);


/***/ }),
/* 197 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketBatchRepository = class TicketBatchRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketBatchRepository) {
        super(entities_1.TicketBatch, ticketBatchRepository);
        this.manager = manager;
        this.ticketBatchRepository = ticketBatchRepository;
    }
};
exports.TicketBatchRepository = TicketBatchRepository;
exports.TicketBatchRepository = TicketBatchRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketBatch)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketBatchRepository);


/***/ }),
/* 198 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketExpenseRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketExpenseRepository = class TicketExpenseRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketExpenseRepository) {
        super(entities_1.TicketExpense, ticketExpenseRepository);
        this.manager = manager;
        this.ticketExpenseRepository = ticketExpenseRepository;
    }
};
exports.TicketExpenseRepository = TicketExpenseRepository;
exports.TicketExpenseRepository = TicketExpenseRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketExpense)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketExpenseRepository);


/***/ }),
/* 199 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGroupRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketLaboratoryGroupRepository = class TicketLaboratoryGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryGroupRepository) {
        super(entities_1.TicketLaboratoryGroup, ticketLaboratoryGroupRepository);
        this.manager = manager;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
    }
};
exports.TicketLaboratoryGroupRepository = TicketLaboratoryGroupRepository;
exports.TicketLaboratoryGroupRepository = TicketLaboratoryGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratoryGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryGroupRepository);


/***/ }),
/* 200 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryResultRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketLaboratoryResultRepository = class TicketLaboratoryResultRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryResultRepository) {
        super(entities_1.TicketLaboratoryResult, ticketLaboratoryResultRepository);
        this.manager = manager;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
    }
    async updateResultList(options) {
        const { oid, ticketId, ticketLaboratoryResultDtoList } = options;
        if (!ticketLaboratoryResultDtoList.length)
            return;
        const updateResult = await this.manager.query(`
        UPDATE  "TicketLaboratoryResult"
        SET     "attention" = temp.attention,
                "result" = temp.result
        FROM (VALUES `
            + ticketLaboratoryResultDtoList
                .map((i) => {
                return `(${i.id}, ${i.attention}, '${i.result}')`;
            })
                .join(', ')
            + `   ) AS temp("id", "attention", "result")
        WHERE   "TicketLaboratoryResult"."id"       = temp."id" 
            AND "TicketLaboratoryResult"."oid"      = ${oid} 
            AND "TicketLaboratoryResult"."ticketId" = ${ticketId} 
        RETURNING "TicketLaboratoryResult".*
        `);
        return entities_1.TicketLaboratoryResult.fromRaws(updateResult[0]);
    }
};
exports.TicketLaboratoryResultRepository = TicketLaboratoryResultRepository;
exports.TicketLaboratoryResultRepository = TicketLaboratoryResultRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratoryResult)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryResultRepository);


/***/ }),
/* 201 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketLaboratoryRepository = class TicketLaboratoryRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryRepository) {
        super(entities_1.TicketLaboratory, ticketLaboratoryRepository);
        this.manager = manager;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
    }
    async sumMoney(options) {
        const { oid, fromTime, toTime } = options;
        const whereTicket = {
            oid,
        };
        if (fromTime && toTime) {
            whereTicket.startedAt = (0, typeorm_2.Between)(fromTime.getTime(), toTime.getTime());
        }
        else if (fromTime) {
            whereTicket.startedAt = (0, typeorm_2.MoreThanOrEqual)(fromTime.getTime());
        }
        else if (toTime) {
            whereTicket.startedAt = (0, typeorm_2.LessThan)(toTime.getTime());
        }
        const result = await this.manager
            .createQueryBuilder(entities_1.TicketLaboratory, 'ticketLaboratory')
            .where(whereTicket)
            .select(['SUM("costPrice") AS "sumCostMoney"', 'SUM("actualPrice") AS "sumActualMoney"'])
            .getRawOne();
        return {
            sumCostMoney: Number(result.sumCostMoney),
            sumActualMoney: Number(result.sumActualMoney),
        };
    }
};
exports.TicketLaboratoryRepository = TicketLaboratoryRepository;
exports.TicketLaboratoryRepository = TicketLaboratoryRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratory)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryRepository);


/***/ }),
/* 202 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketProcedureRepository = class TicketProcedureRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketProcedureRepository) {
        super(entities_1.TicketProcedure, ticketProcedureRepository);
        this.manager = manager;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async updatePriorityList(params) {
        if (!params.updateData.length)
            return;
        const queryUpdateResult = await this.manager.query(`
      UPDATE "TicketProcedure"
      SET "priority" = temp.priority
      FROM (VALUES `
            + params.updateData
                .map(({ id, priority }) => {
                return `(${id}, ${priority})`;
            })
                .join(', ')
            + `   ) AS temp("id", "priority")
      WHERE   "TicketProcedure"."id"  = temp."id" 
          AND "TicketProcedure"."ticketId" = ${params.ticketId} 
          AND "TicketProcedure"."oid" = ${params.oid} 
      RETURNING "TicketProcedure".*; 
      `);
        const ticketProcedureList = entities_1.TicketProcedure.fromRaws(queryUpdateResult[0]);
        return ticketProcedureList;
    }
    async updateQuantityAndDiscount(params) {
        const { oid, ticketId, ticketProcedureList } = params;
        await this.manager.query(`
      UPDATE "TicketProcedure" vp
      SET "discountMoney" = v."discountMoney",
          "discountPercent" = v."discountPercent",
          "discountType" = v."discountType",
          "actualPrice" = v."actualPrice"
      FROM (VALUES `
            + ticketProcedureList
                .map((i) => {
                return (`(${i.id}, ${ticketId}, ${i.procedureId},`
                    + ` ${i.discountMoney}, ${i.discountPercent}, '${i.discountType}', ${i.actualPrice})`);
            })
                .join(', ')
            + `   ) AS v("id", "ticketId", "procedureId", 
                   "discountMoney", "discountPercent", "discountType", "actualPrice"
                  )
      WHERE vp."id" = v."id" AND vp."ticketId" = v."ticketId"
          AND vp."procedureId" = v."procedureId" AND vp."oid" = ${oid};    
      `);
    }
    async topProcedureBestSelling(options) {
        const { condition, orderBy, limit } = options;
        const where = this.getWhereOptions(condition);
        let query = this.manager
            .createQueryBuilder(entities_1.TicketProcedure, 'ticketProcedure')
            .where(where)
            .groupBy('"ticketProcedure"."procedureId"')
            .select('"ticketProcedure"."procedureId"', 'procedureId')
            .addSelect('SUM("ticketProcedure".quantity)', 'sumQuantity')
            .addSelect('SUM("ticketProcedure".quantity * "ticketProcedure"."actualPrice")', 'sumActualAmount')
            .limit(limit);
        if (orderBy === 'sumActualAmount') {
            query = query.orderBy('"sumActualAmount"', 'DESC');
        }
        else if (orderBy === 'sumQuantity') {
            query = query.orderBy('"sumQuantity"', 'DESC');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            procedureId: i.procedureId,
            sumQuantity: Number(i.sumQuantity),
            sumActualAmount: Number(i.sumActualAmount),
        }));
    }
};
exports.TicketProcedureRepository = TicketProcedureRepository;
exports.TicketProcedureRepository = TicketProcedureRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketProcedure)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketProcedureRepository);


/***/ }),
/* 203 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketProductRepository = class TicketProductRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketProductRepository) {
        super(entities_1.TicketProduct, ticketProductRepository);
        this.manager = manager;
        this.ticketProductRepository = ticketProductRepository;
    }
    async updatePriorityList(params) {
        if (!params.updateData.length)
            return;
        const queryUpdateResult = await this.manager.query(`
      UPDATE "TicketProduct"
      SET "priority" = temp.priority
      FROM (VALUES `
            + params.updateData
                .map(({ id, priority }) => {
                return `(${id}, ${priority})`;
            })
                .join(', ')
            + `   ) AS temp("id", "priority")
      WHERE   "TicketProduct"."id"  = temp."id" 
          AND "TicketProduct"."ticketId" = ${params.ticketId} 
          AND "TicketProduct"."oid" = ${params.oid} 
      RETURNING "TicketProduct".*; 
      `);
        const ticketProductList = entities_1.TicketProduct.fromRaws(queryUpdateResult[0]);
        return ticketProductList;
    }
    async updateQuantityAndDiscount(params) {
    }
};
exports.TicketProductRepository = TicketProductRepository;
exports.TicketProductRepository = TicketProductRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketProduct)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketProductRepository);


/***/ }),
/* 204 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketRadiologyRepository = class TicketRadiologyRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketRadiologyRepository) {
        super(entities_1.TicketRadiology, ticketRadiologyRepository);
        this.manager = manager;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
    }
    async sumMoney(options) {
        const { oid, fromTime, toTime } = options;
        const whereTicket = {
            oid,
        };
        if (fromTime && toTime) {
            whereTicket.startedAt = (0, typeorm_2.Between)(fromTime.getTime(), toTime.getTime());
        }
        else if (fromTime) {
            whereTicket.startedAt = (0, typeorm_2.MoreThanOrEqual)(fromTime.getTime());
        }
        else if (toTime) {
            whereTicket.startedAt = (0, typeorm_2.LessThan)(toTime.getTime());
        }
        const result = await this.manager
            .createQueryBuilder(entities_1.TicketRadiology, 'ticketRadiology')
            .where(whereTicket)
            .select(['SUM("costPrice") AS "sumCostMoney"', 'SUM("actualPrice") AS "sumActualMoney"'])
            .getRawOne();
        return {
            sumCostMoney: Number(result.sumCostMoney),
            sumActualMoney: Number(result.sumActualMoney),
        };
    }
    async updatePriorityList(params) {
        if (!params.updateData.length)
            return [];
        const queryUpdateResult = await this.manager.query(`
      UPDATE "TicketRadiology"
      SET "priority" = temp.priority
      FROM (VALUES `
            + params.updateData
                .map(({ id, priority }) => {
                return `(${id}, ${priority})`;
            })
                .join(', ')
            + `   ) AS temp("id", "priority")
      WHERE   "TicketRadiology"."id"  = temp."id" 
          AND "TicketRadiology"."ticketId" = ${params.ticketId} 
          AND "TicketRadiology"."oid" = ${params.oid} 
      RETURNING "TicketRadiology".*; 
      `);
        const ticketRadiologyList = entities_1.TicketRadiology.fromRaws(queryUpdateResult[0]);
        return ticketRadiologyList;
    }
};
exports.TicketRadiologyRepository = TicketRadiologyRepository;
exports.TicketRadiologyRepository = TicketRadiologyRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketRadiology)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketRadiologyRepository);


/***/ }),
/* 205 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSurchargeRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketSurchargeRepository = class TicketSurchargeRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketSurchargeRepository) {
        super(entities_1.TicketSurcharge, ticketSurchargeRepository);
        this.manager = manager;
        this.ticketSurchargeRepository = ticketSurchargeRepository;
    }
};
exports.TicketSurchargeRepository = TicketSurchargeRepository;
exports.TicketSurchargeRepository = TicketSurchargeRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketSurcharge)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketSurchargeRepository);


/***/ }),
/* 206 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUserRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketUserRepository = class TicketUserRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketUserRepository) {
        super(entities_1.TicketUser, ticketUserRepository);
        this.manager = manager;
        this.ticketUserRepository = ticketUserRepository;
    }
};
exports.TicketUserRepository = TicketUserRepository;
exports.TicketUserRepository = TicketUserRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketUser)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketUserRepository);


/***/ }),
/* 207 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(146);
const entities_1 = __webpack_require__(43);
const ticket_product_entity_1 = __webpack_require__(69);
const ticket_entity_1 = __webpack_require__(56);
const _postgresql_repository_1 = __webpack_require__(83);
let TicketRepository = class TicketRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, ticketRepository) {
        super(entities_1.Ticket, ticketRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketRepository = ticketRepository;
    }
    async queryOne(options) {
        var _a, _b, _c, _d, _e, _f;
        const { condition, relation } = options;
        let query = this.manager
            .createQueryBuilder(entities_1.Ticket, 'ticket')
            .where('ticket.id = :id', { id: condition.id })
            .andWhere('ticket.oid = :oid', { oid: condition.oid });
        if (relation === null || relation === void 0 ? void 0 : relation.customer)
            query = query.leftJoinAndSelect('ticket.customer', 'customer');
        if (relation === null || relation === void 0 ? void 0 : relation.paymentList) {
            query = query.leftJoinAndSelect('ticket.paymentList', 'payment');
            query.addOrderBy('payment.id', 'ASC');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketExpenseList) {
            query = query.leftJoinAndSelect('ticket.ticketExpenseList', 'ticketExpenseList');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketSurchargeList) {
            query = query.leftJoinAndSelect('ticket.ticketSurchargeList', 'ticketSurchargeList');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketAttributeList) {
            query = query.leftJoinAndSelect('ticket.ticketAttributeList', 'ticketAttributeList');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketProductList) {
            query = query.leftJoinAndSelect('ticket.ticketProductList', 'ticketProduct');
            query.addOrderBy('ticketProduct.priority', 'ASC');
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductList.product) {
                query = query.leftJoinAndSelect('ticketProduct.product', 'ticketProduct_product', 'ticketProduct.productId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList) {
            query = query.leftJoinAndSelect('ticket.ticketProductConsumableList', 'ticketProductConsumable', 'ticketProductConsumable.type = :typeConsumable', { typeConsumable: ticket_product_entity_1.TicketProductType.Consumable });
            query.addOrderBy('ticketProductConsumable.priority', 'ASC');
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList.product) {
                query = query.leftJoinAndSelect('ticketProductConsumable.product', 'ticketProductConsumable_product', 'ticketProductConsumable.productId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList) {
            query = query.leftJoinAndSelect('ticket.ticketProductPrescriptionList', 'ticketProductPrescription', 'ticketProductPrescription.type = :typePrescription', { typePrescription: ticket_product_entity_1.TicketProductType.Prescription });
            query.addOrderBy('ticketProductPrescription.priority', 'ASC');
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList.product) {
                query = query.leftJoinAndSelect('ticketProductPrescription.product', 'ticketProductPrescription_product', 'ticketProductPrescription.productId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketBatchList) {
            query = query.leftJoinAndSelect('ticket.ticketBatchList', 'ticketBatch');
            if (relation === null || relation === void 0 ? void 0 : relation.ticketBatchList.batch) {
                query = query.leftJoinAndSelect('ticketBatch.batch', 'ticketBatch_batch', 'ticketBatch.batchId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList) {
            query = query.leftJoinAndSelect('ticket.ticketProcedureList', 'ticketProcedure');
            query.addOrderBy('ticketProcedure.priority', 'ASC');
            if ((_a = relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList) === null || _a === void 0 ? void 0 : _a.procedure) {
                query = query.leftJoinAndSelect('ticketProcedure.procedure', 'procedure', 'ticketProcedure.procedureId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) {
            query = query.leftJoinAndSelect('ticket.ticketLaboratoryList', 'ticketLaboratory');
            query.addOrderBy('ticketLaboratory.priority', 'ASC');
            if ((_b = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) === null || _b === void 0 ? void 0 : _b.laboratoryList) {
                query = query.leftJoinAndSelect('ticketLaboratory.laboratoryList', 'laboratory', 'ticketLaboratory.laboratoryId = laboratory.parentId');
            }
            else if ((_c = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) === null || _c === void 0 ? void 0 : _c.laboratory) {
                query = query.leftJoinAndSelect('ticketLaboratory.laboratory', 'laboratory', 'ticketLaboratory.laboratoryId = laboratory.id');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList) {
            query = query.leftJoinAndSelect('ticket.ticketLaboratoryGroupList', 'ticketLaboratoryGroup');
            query.addOrderBy('ticketLaboratoryGroup.registeredAt', 'ASC');
            if ((_d = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList) === null || _d === void 0 ? void 0 : _d.laboratoryGroup) {
                query = query.leftJoinAndSelect('ticketLaboratory.laboratoryGroup', 'laboratoryGroup', 'ticketLaboratory.laboratoryGroupId = laboratoryGroup.id');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryResultList) {
            query = query.leftJoinAndSelect('ticket.ticketLaboratoryResultList', 'ticketLaboratoryResultList');
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList) {
            query = query.leftJoinAndSelect('ticket.ticketRadiologyList', 'ticketRadiology');
            query.addOrderBy('ticketRadiology.priority', 'ASC');
            if ((_e = relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList) === null || _e === void 0 ? void 0 : _e.radiology) {
                query = query.leftJoinAndSelect('ticketRadiology.radiology', 'radiology', 'ticketRadiology.radiologyId != 0');
            }
        }
        if (relation === null || relation === void 0 ? void 0 : relation.ticketUserList) {
            query = query.leftJoinAndSelect('ticket.ticketUserList', 'ticketUser');
            query.addOrderBy('ticketUser.id', 'ASC');
            if ((_f = relation === null || relation === void 0 ? void 0 : relation.ticketUserList) === null || _f === void 0 ? void 0 : _f.user) {
                query = query.leftJoinAndSelect('ticketUser.user', 'user', 'ticketUser.userId != 0');
            }
        }
        const ticket = await query.getOne();
        return ticket;
    }
    async countToday(oid) {
        const now = new Date();
        const number = await this.countBy({
            oid,
            registeredAt: {
                GTE: time_helper_1.ESTimer.startOfDate(now, 7).getTime(),
                LTE: time_helper_1.ESTimer.endOfDate(now, 7).getTime(),
            },
        });
        return number;
    }
    async destroy(options) {
        const { oid, ticketId } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const whereTicket = {
                id: ticketId,
                oid,
                status: (0, typeorm_2.In)([ticket_entity_1.TicketStatus.Schedule, ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Cancelled]),
            };
            const ticketDeleteResult = await manager.delete(entities_1.Ticket, whereTicket);
            if (ticketDeleteResult.affected !== 1) {
                throw new Error(`Destroy Ticket ${ticketId} failed: Status invalid`);
            }
            await manager.delete(entities_1.TicketAttribute, { oid, ticketId });
            await manager.delete(entities_1.TicketBatch, { oid, ticketId });
            await manager.delete(entities_1.TicketExpense, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratory, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratoryGroup, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratoryResult, { oid, ticketId });
            await manager.delete(entities_1.TicketProcedure, { oid, ticketId });
            await manager.delete(entities_1.TicketProduct, { oid, ticketId });
            await manager.delete(entities_1.TicketRadiology, { oid, ticketId });
            await manager.delete(entities_1.TicketSurcharge, { oid, ticketId });
            await manager.delete(entities_1.TicketUser, { oid, ticketId });
        });
    }
    async refreshLaboratoryMoney(options) {
        const { oid, ticketId } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "laboratoryMoney"   = "temp"."sumLaboratoryActualPrice",
                "itemsActualMoney"  = "ticket"."itemsActualMoney" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "totalMoney"        = "ticket"."totalMoney" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "debt"              = "ticket"."debt" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "profit"            = "ticket"."profit" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice"
        FROM    ( 
                SELECT "ticketId", SUM("actualPrice") as "sumLaboratoryActualPrice"
                    FROM "TicketLaboratory" 
                    WHERE "ticketId" = (${ticketId}) AND "oid" = ${oid}
                    GROUP BY "ticketId" 
                ) AS "temp" 
        WHERE   "ticket"."id" = "temp"."ticketId" 
                    AND "ticket"."oid" = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
    async refreshRadiologyMoney(options) {
        const { oid, ticketId } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "radiologyMoney"    = "temp"."sumRadiologyActualPrice",
                "itemsActualMoney"  = "ticket"."itemsActualMoney" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "totalMoney"        = "ticket"."totalMoney" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "debt"              = "ticket"."debt" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "profit"            = "ticket"."profit" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice"
        FROM    ( 
                SELECT "ticketId", SUM("actualPrice") as "sumRadiologyActualPrice"
                    FROM "TicketRadiology" 
                    WHERE "ticketId" = (${ticketId}) AND "oid" = ${oid}
                    GROUP BY "ticketId" 
                ) AS "temp" 
        WHERE   "ticket"."id" = "temp"."ticketId" 
                    AND "ticket"."oid" = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
    async changeLaboratoryMoney(options) {
        const { oid, ticketId, laboratoryMoney } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "laboratoryMoney"   = ${laboratoryMoney},
                "itemsActualMoney"  = "itemsActualMoney" - "laboratoryMoney" + ${laboratoryMoney},
                "totalMoney"        = "totalMoney" - "laboratoryMoney" + ${laboratoryMoney},
                "debt"              = "debt" - "laboratoryMoney"  + ${laboratoryMoney},
                "profit"            = "profit" - "laboratoryMoney" + ${laboratoryMoney}
        WHERE   "ticket"."id"       = ${ticketId}
            AND "ticket"."oid"      = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
};
exports.TicketRepository = TicketRepository;
exports.TicketRepository = TicketRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Ticket)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], TicketRepository);


/***/ }),
/* 208 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(43);
const _postgresql_repository_1 = __webpack_require__(83);
let WarehouseRepository = class WarehouseRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, warehouseRepository) {
        super(entities_1.Warehouse, warehouseRepository);
        this.dataSource = dataSource;
        this.warehouseRepository = warehouseRepository;
    }
};
exports.WarehouseRepository = WarehouseRepository;
exports.WarehouseRepository = WarehouseRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Warehouse)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], WarehouseRepository);


/***/ }),
/* 209 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketProcedureOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const ticket_procedure_entity_1 = __webpack_require__(66);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicAddTicketProcedureOperation = class TicketClinicAddTicketProcedureOperation {
    constructor(dataSource, manager, ticketManager, ticketProcedureManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketProcedure(params) {
        const { oid, ticketId, ticketProcedureDto } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProcedureInsert = Object.assign(Object.assign({}, ticketProcedureDto), { oid,
                ticketId, customerId: ticketOrigin.customerId, imageIds: JSON.stringify([]), result: '', startedAt: null, status: ticket_procedure_entity_1.TicketProcedureStatus.Completed });
            const ticketProcedure = await this.ticketProcedureManager.insertOneAndReturnEntity(manager, ticketProcedureInsert);
            const procedureMoneyAdd = ticketProcedure.quantity * ticketProcedure.actualPrice;
            const itemsDiscountAdd = ticketProcedure.quantity * ticketProcedure.discountMoney;
            let ticket = ticketOrigin;
            if (procedureMoneyAdd != 0 || itemsDiscountAdd !== 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        procedureMoneyAdd,
                        itemsDiscountAdd,
                    },
                });
            }
            return { ticket, ticketProcedure };
        });
        return transaction;
    }
};
exports.TicketClinicAddTicketProcedureOperation = TicketClinicAddTicketProcedureOperation;
exports.TicketClinicAddTicketProcedureOperation = TicketClinicAddTicketProcedureOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketProcedureManager !== "undefined" && managers_1.TicketProcedureManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicAddTicketProcedureOperation);


/***/ }),
/* 210 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketProcedureOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const commission_entity_1 = __webpack_require__(75);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicDestroyTicketProcedureOperation = class TicketClinicDestroyTicketProcedureOperation {
    constructor(dataSource, ticketManager, ticketProcedureManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketProcedure(params) {
        const { oid, ticketId, ticketProcedureId } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProcedureDestroy = await this.ticketProcedureManager.deleteOneAndReturnEntity(manager, { oid, id: ticketProcedureId });
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                interactType: commission_entity_1.InteractType.Procedure,
                ticketItemId: ticketProcedureDestroy.id,
            });
            const procedureMoneyDelete = ticketProcedureDestroy.quantity * ticketProcedureDestroy.actualPrice;
            const itemsDiscountDelete = ticketProcedureDestroy.quantity * ticketProcedureDestroy.discountMoney;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (procedureMoneyDelete != 0 || itemsDiscountDelete != 0 || commissionMoneyDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        procedureMoneyAdd: -procedureMoneyDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return { ticket, ticketProcedureDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketClinicDestroyTicketProcedureOperation = TicketClinicDestroyTicketProcedureOperation;
exports.TicketClinicDestroyTicketProcedureOperation = TicketClinicDestroyTicketProcedureOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketProcedureManager !== "undefined" && managers_1.TicketProcedureManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicDestroyTicketProcedureOperation);


/***/ }),
/* 211 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketProcedureOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicUpdateTicketProcedureOperation = class TicketClinicUpdateTicketProcedureOperation {
    constructor(dataSource, ticketManager, ticketProcedureManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketProcedure(params) {
        const { oid, ticketId, ticketProcedureId, ticketProcedureUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProcedureOrigin = await this.ticketProcedureManager.findOneBy(manager, {
                oid,
                id: ticketProcedureId,
            });
            let ticketProcedure = ticketProcedureOrigin;
            let procedureMoneyChange = 0;
            let itemsDiscountChange = 0;
            if (ticketProcedureUpdateDto) {
                ticketProcedure = await this.ticketProcedureManager.updateOneAndReturnEntity(manager, { oid, id: ticketProcedureId }, {
                    quantity: ticketProcedureUpdateDto.quantity,
                    expectedPrice: ticketProcedureUpdateDto.expectedPrice,
                    discountType: ticketProcedureUpdateDto.discountType,
                    discountMoney: ticketProcedureUpdateDto.discountMoney,
                    discountPercent: ticketProcedureUpdateDto.discountPercent,
                    actualPrice: ticketProcedureUpdateDto.actualPrice,
                });
                procedureMoneyChange =
                    ticketProcedure.quantity * ticketProcedure.actualPrice
                        - ticketProcedureOrigin.quantity * ticketProcedureOrigin.actualPrice;
                itemsDiscountChange =
                    ticketProcedure.quantity * ticketProcedure.discountMoney
                        - ticketProcedureOrigin.quantity * ticketProcedureOrigin.discountMoney;
            }
            let ticket = ticketOrigin;
            if (procedureMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        procedureMoneyAdd: procedureMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                    },
                });
            }
            return { ticket, ticketProcedure };
        });
        return transaction;
    }
};
exports.TicketClinicUpdateTicketProcedureOperation = TicketClinicUpdateTicketProcedureOperation;
exports.TicketClinicUpdateTicketProcedureOperation = TicketClinicUpdateTicketProcedureOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketProcedureManager !== "undefined" && managers_1.TicketProcedureManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketClinicUpdateTicketProcedureOperation);


/***/ }),
/* 212 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicAddTicketProductOperation = class TicketClinicAddTicketProductOperation {
    constructor(dataSource, manager, ticketManager, ticketProductManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketProductList(params) {
        const { oid, ticketId, ticketProductDtoList, ticketProductType } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProduct failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: ticket_entity_1.TicketStatus.Executing,
            }, { updatedAt: Date.now(), deliveryStatus: variable_1.DeliveryStatus.Pending });
            const ticketProductInsertList = ticketProductDtoList.map((i) => {
                const insert = Object.assign(Object.assign({}, i), { oid,
                    ticketId, customerId: ticketOrigin.customerId, deliveryStatus: variable_1.DeliveryStatus.Pending, costAmount: i.costAmount, pickupStrategy: i.pickupStrategy, type: ticketProductType });
                return insert;
            });
            const ticketProductList = await this.ticketProductManager.insertManyAndReturnEntity(manager, ticketProductInsertList);
            const productMoneyAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.actualPrice;
            }, 0);
            const itemsDiscountAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.discountMoney;
            }, 0);
            const itemsCostAmountAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            let ticket = ticketOrigin;
            if (productMoneyAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return { ticket, ticketProductList };
        });
        return transaction;
    }
};
exports.TicketClinicAddTicketProductOperation = TicketClinicAddTicketProductOperation;
exports.TicketClinicAddTicketProductOperation = TicketClinicAddTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicAddTicketProductOperation);


/***/ }),
/* 213 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const commission_entity_1 = __webpack_require__(75);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicDestroyTicketProductOperation = class TicketClinicDestroyTicketProductOperation {
    constructor(dataSource, ticketManager, ticketProductManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketProduct(params) {
        const { oid, ticketId, ticketProductId, ticketProductType } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketProduct failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProductDestroy = await this.ticketProductManager.deleteOneAndReturnEntity(manager, {
                oid,
                deliveryStatus: { IN: [variable_1.DeliveryStatus.NoStock, variable_1.DeliveryStatus.Pending] },
                id: ticketProductId,
                type: ticketProductType,
            });
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                interactType: commission_entity_1.InteractType.Product,
                ticketItemId: ticketProductDestroy.id,
            });
            let deliveryStatus = ticketOrigin.deliveryStatus;
            if (ticketProductDestroy.deliveryStatus === variable_1.DeliveryStatus.Pending) {
                const ticketProductList = await this.ticketProductManager.findMany(manager, {
                    condition: { ticketId },
                });
                deliveryStatus = variable_1.DeliveryStatus.Delivered;
                if (ticketProductList.every((i) => i.deliveryStatus === variable_1.DeliveryStatus.NoStock)) {
                    deliveryStatus = variable_1.DeliveryStatus.NoStock;
                }
                if (ticketProductList.some((i) => i.deliveryStatus === variable_1.DeliveryStatus.Pending)) {
                    deliveryStatus = variable_1.DeliveryStatus.Pending;
                }
            }
            const productMoneyDelete = ticketProductDestroy.quantity * ticketProductDestroy.actualPrice;
            const itemsCostAmountDelete = ticketProductDestroy.costAmount;
            const itemsDiscountDelete = ticketProductDestroy.quantity * ticketProductDestroy.discountMoney;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (productMoneyDelete != 0 || commissionMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd: -productMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                    },
                    other: { deliveryStatus },
                });
            }
            return { ticket, ticketProductDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketClinicDestroyTicketProductOperation = TicketClinicDestroyTicketProductOperation;
exports.TicketClinicDestroyTicketProductOperation = TicketClinicDestroyTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicDestroyTicketProductOperation);


/***/ }),
/* 214 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicUpdateTicketProductOperation = class TicketClinicUpdateTicketProductOperation {
    constructor(dataSource, ticketManager, ticketProductManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketProduct(params) {
        const { oid, ticketId, ticketProductId, ticketProductType, ticketProductUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketProduct failed: `;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProductOrigin = await this.ticketProductManager.findOneBy(manager, {
                oid,
                id: ticketProductId,
                type: ticketProductType,
            });
            if (!ticketProductOrigin) {
                throw new Error(PREFIX + 'Database.NotFound ');
            }
            let ticketProductModified = ticketProductOrigin;
            let productMoneyChange = 0;
            let itemsDiscountChange = 0;
            let itemsCostAmountChange = 0;
            if (ticketProductUpdateDto) {
                if (ticketProductOrigin.deliveryStatus === variable_1.DeliveryStatus.Pending
                    || ticketProductOrigin.deliveryStatus === variable_1.DeliveryStatus.NoStock) {
                    ticketProductModified = await this.ticketProductManager.updateOneAndReturnEntity(manager, { oid, id: ticketProductId }, {
                        quantity: ticketProductUpdateDto.quantity,
                        quantityPrescription: ticketProductUpdateDto.quantityPrescription,
                        expectedPrice: ticketProductUpdateDto.expectedPrice,
                        discountType: ticketProductUpdateDto.discountType,
                        discountMoney: ticketProductUpdateDto.discountMoney,
                        discountPercent: ticketProductUpdateDto.discountPercent,
                        costAmount: ticketProductUpdateDto.costAmount,
                        actualPrice: ticketProductUpdateDto.actualPrice,
                        hintUsage: ticketProductUpdateDto.hintUsage,
                        deliveryStatus: ticketProductUpdateDto.quantity === 0
                            ? variable_1.DeliveryStatus.NoStock
                            : variable_1.DeliveryStatus.Pending,
                    });
                    productMoneyChange =
                        ticketProductModified.quantity * ticketProductModified.actualPrice
                            - ticketProductOrigin.quantity * ticketProductOrigin.actualPrice;
                    itemsDiscountChange =
                        ticketProductModified.quantity * ticketProductModified.discountMoney
                            - ticketProductOrigin.quantity * ticketProductOrigin.discountMoney;
                    itemsCostAmountChange = ticketProductModified.costAmount - ticketProductOrigin.costAmount;
                }
                else {
                    ticketProductModified = await this.ticketProductManager.updateOneAndReturnEntity(manager, { oid, id: ticketProductId }, {
                        quantityPrescription: ticketProductUpdateDto.quantityPrescription,
                        hintUsage: ticketProductUpdateDto.hintUsage,
                    });
                }
            }
            let deliveryStatus = ticketOrigin.deliveryStatus;
            if (ticketProductModified.quantity === 0) {
                const ticketProductList = await this.ticketProductManager.findMany(manager, {
                    condition: { ticketId },
                });
                deliveryStatus = variable_1.DeliveryStatus.Delivered;
                if (ticketProductList.every((i) => i.deliveryStatus === variable_1.DeliveryStatus.NoStock)) {
                    deliveryStatus = variable_1.DeliveryStatus.NoStock;
                }
                if (ticketProductList.some((i) => i.deliveryStatus === variable_1.DeliveryStatus.Pending)) {
                    deliveryStatus = variable_1.DeliveryStatus.Pending;
                }
            }
            let ticket = ticketOrigin;
            if (productMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd: productMoneyChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                        itemsDiscountAdd: itemsDiscountChange,
                    },
                    other: { deliveryStatus },
                });
            }
            return { ticket, ticketProduct: ticketProductModified };
        });
        return transaction;
    }
};
exports.TicketClinicUpdateTicketProductOperation = TicketClinicUpdateTicketProductOperation;
exports.TicketClinicUpdateTicketProductOperation = TicketClinicUpdateTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketClinicUpdateTicketProductOperation);


/***/ }),
/* 215 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicAddTicketRadiologyOperation = class TicketClinicAddTicketRadiologyOperation {
    constructor(dataSource, manager, ticketManager, ticketRadiologyManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyInsertDto } = params;
        const PREFIX = `ticketId=${ticketId} addTicketRadiology failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiology = await this.ticketRadiologyManager.insertOneAndReturnEntity(manager, ticketRadiologyInsertDto);
            const radiologyMoneyAdd = ticketRadiology.actualPrice;
            const itemsCostAmountAdd = ticketRadiology.costPrice;
            const itemsDiscountAdd = ticketRadiology.discountMoney;
            let ticket = ticketOrigin;
            if (radiologyMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return { ticket, ticketRadiology };
        });
        return transaction;
    }
};
exports.TicketClinicAddTicketRadiologyOperation = TicketClinicAddTicketRadiologyOperation;
exports.TicketClinicAddTicketRadiologyOperation = TicketClinicAddTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketRadiologyManager !== "undefined" && managers_1.TicketRadiologyManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicAddTicketRadiologyOperation);


/***/ }),
/* 216 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const commission_entity_1 = __webpack_require__(75);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicDestroyTicketRadiologyOperation = class TicketClinicDestroyTicketRadiologyOperation {
    constructor(dataSource, ticketManager, ticketRadiologyManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyId } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketRadiology failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiologyDestroy = await this.ticketRadiologyManager.deleteOneAndReturnEntity(manager, { oid, id: ticketRadiologyId });
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                interactType: commission_entity_1.InteractType.Radiology,
                ticketItemId: ticketRadiologyDestroy.id,
            });
            const radiologyMoneyDelete = ticketRadiologyDestroy.actualPrice;
            const itemsDiscountDelete = ticketRadiologyDestroy.discountMoney;
            const itemsCostAmountDelete = ticketRadiologyDestroy.costPrice;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (radiologyMoneyDelete != 0 || commissionMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd: -radiologyMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                    },
                });
            }
            return { ticket, ticketRadiologyDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketClinicDestroyTicketRadiologyOperation = TicketClinicDestroyTicketRadiologyOperation;
exports.TicketClinicDestroyTicketRadiologyOperation = TicketClinicDestroyTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketRadiologyManager !== "undefined" && managers_1.TicketRadiologyManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketClinicDestroyTicketRadiologyOperation);


/***/ }),
/* 217 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicUpdateTicketRadiologyOperation = class TicketClinicUpdateTicketRadiologyOperation {
    constructor(dataSource, ticketManager, ticketRadiologyManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyId, ticketRadiologyUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketRadiology failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiologyOrigin = await this.ticketRadiologyManager.findOneBy(manager, {
                oid,
                id: ticketRadiologyId,
            });
            let ticketRadiology = ticketRadiologyOrigin;
            if (ticketRadiologyUpdateDto) {
                ticketRadiology = await this.ticketRadiologyManager.updateOneAndReturnEntity(manager, { oid, id: ticketRadiologyId }, {
                    expectedPrice: ticketRadiologyUpdateDto.expectedPrice,
                    discountType: ticketRadiologyUpdateDto.discountType,
                    discountMoney: ticketRadiologyUpdateDto.discountMoney,
                    discountPercent: ticketRadiologyUpdateDto.discountPercent,
                    actualPrice: ticketRadiologyUpdateDto.actualPrice,
                });
            }
            const radiologyMoneyChange = ticketRadiology.actualPrice - ticketRadiologyOrigin.actualPrice;
            const itemsDiscountChange = ticketRadiology.discountMoney - ticketRadiologyOrigin.discountMoney;
            const itemsCostAmountChange = ticketRadiology.costPrice - ticketRadiologyOrigin.costPrice;
            let ticket = ticketOrigin;
            if (radiologyMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd: radiologyMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                    },
                });
            }
            return { ticket, ticketRadiology };
        });
        return transaction;
    }
};
exports.TicketClinicUpdateTicketRadiologyOperation = TicketClinicUpdateTicketRadiologyOperation;
exports.TicketClinicUpdateTicketRadiologyOperation = TicketClinicUpdateTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketRadiologyManager !== "undefined" && managers_1.TicketRadiologyManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketClinicUpdateTicketRadiologyOperation);


/***/ }),
/* 218 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddSelectLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicAddSelectLaboratoryOperation = class TicketClinicAddSelectLaboratoryOperation {
    constructor(dataSource, manager, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addSelectLaboratoryList(params) {
        const { oid, ticketId, tlgDtoList } = params;
        const PREFIX = `ticketId=${ticketId} addSelectLaboratoryList failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const tlgEntityList = tlgDtoList.map((i) => {
                const tlgEntity = Object.assign(Object.assign({}, i), { oid,
                    ticketId, customerId: ticketOrigin.customerId, status: variable_1.TicketLaboratoryStatus.Pending, startedAt: null, result: '' });
                return tlgEntity;
            });
            const tlgInsertList = await this.ticketLaboratoryGroupManager.insertManyAndReturnEntity(manager, tlgEntityList);
            const tlEntityList = tlgDtoList
                .map((tlgDto, tlgDtoIndex) => {
                return tlgDto.ticketLaboratoryList.map((tlDto) => {
                    const tlEntity = Object.assign(Object.assign({}, tlDto), { oid,
                        ticketId, customerId: ticketOrigin.customerId, ticketLaboratoryGroupId: tlgInsertList[tlgDtoIndex].id, status: variable_1.TicketLaboratoryStatus.Pending, startedAt: null });
                    return tlEntity;
                });
            })
                .flat();
            const tlInsertList = await this.ticketLaboratoryManager.insertManyAndReturnEntity(manager, tlEntityList);
            const laboratoryMoneyAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.actualPrice;
            }, 0);
            const itemsDiscountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.discountMoney;
            }, 0);
            const itemsCostAmountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.costPrice;
            }, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryInsertList: tlInsertList,
                ticketLaboratoryGroupInsertList: tlgInsertList,
            };
        });
        return transaction;
    }
};
exports.TicketClinicAddSelectLaboratoryOperation = TicketClinicAddSelectLaboratoryOperation;
exports.TicketClinicAddSelectLaboratoryOperation = TicketClinicAddSelectLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketLaboratoryGroupManager !== "undefined" && managers_1.TicketLaboratoryGroupManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketClinicAddSelectLaboratoryOperation);


/***/ }),
/* 219 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicChangeSelectLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicChangeSelectLaboratoryOperation = class TicketClinicChangeSelectLaboratoryOperation {
    constructor(dataSource, manager, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async changeSelectLaboratoryList(params) {
        const { oid, ticketId, tlgDto } = params;
        const PREFIX = `ticketId=${ticketId} changeSelectLaboratoryList failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            let tlgUpdate;
            if (tlgDto.id !== 0) {
                tlgUpdate = await this.ticketLaboratoryGroupManager.updateOneAndReturnEntity(manager, { oid, ticketId, id: tlgDto.id }, { registeredAt: tlgDto.registeredAt });
            }
            const tlDestroyList = await this.ticketLaboratoryManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: tlgDto.id,
                laboratoryId: { NOT_IN: tlgDto.ticketLaboratoryList.map((i) => i.laboratoryId) },
            });
            const tlKeepList = await this.ticketLaboratoryManager.findManyBy(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: tlgDto.id,
            });
            const laboratoryIdKeepList = tlKeepList.map((i) => i.laboratoryId);
            const tlEntityList = tlgDto.ticketLaboratoryList
                .filter((tlDto) => !laboratoryIdKeepList.includes(tlDto.laboratoryId))
                .map((tlDto) => {
                const tlEntity = Object.assign(Object.assign({}, tlDto), { oid,
                    ticketId, customerId: ticketOrigin.customerId, ticketLaboratoryGroupId: tlgDto.id, status: variable_1.TicketLaboratoryStatus.Pending, startedAt: null });
                return tlEntity;
            });
            const tlInsertList = await this.ticketLaboratoryManager.insertManyAndReturnEntity(manager, tlEntityList);
            const laboratoryMoneyAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.actualPrice;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.actualPrice;
                }, 0);
            const itemsDiscountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.discountMoney;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.discountMoney;
                }, 0);
            const itemsCostAmountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.costPrice;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.costPrice;
                }, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryInsertList: tlInsertList,
                ticketLaboratoryDestroyList: tlDestroyList,
                ticketLaboratoryGroupUpdate: tlgUpdate,
            };
        });
        return transaction;
    }
};
exports.TicketClinicChangeSelectLaboratoryOperation = TicketClinicChangeSelectLaboratoryOperation;
exports.TicketClinicChangeSelectLaboratoryOperation = TicketClinicChangeSelectLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketLaboratoryGroupManager !== "undefined" && managers_1.TicketLaboratoryGroupManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketClinicChangeSelectLaboratoryOperation);


/***/ }),
/* 220 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketLaboratoryGroupOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicDestroyTicketLaboratoryGroupOperation = class TicketClinicDestroyTicketLaboratoryGroupOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketLaboratoryResultManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketLaboratoryResultManager = ticketLaboratoryResultManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketLaboratoryGroup(params) {
        const { oid, ticketId, ticketLaboratoryGroupId } = params;
        const PREFIX = `ticketId=${ticketLaboratoryGroupId} destroyTicketLaboratoryGroup failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const [ticketLaboratoryGroupDestroy] = await this.ticketLaboratoryGroupManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                id: ticketLaboratoryGroupId,
            });
            const ticketLaboratoryDestroyList = await this.ticketLaboratoryManager.deleteAndReturnEntity(manager, { oid, ticketId, ticketLaboratoryGroupId });
            const ticketLaboratoryResultDestroyList = await this.ticketLaboratoryResultManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId,
            });
            const laboratoryMoneyDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.actualPrice, 0);
            const itemsDiscountDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.discountMoney, 0);
            const itemsCostAmountDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.costPrice, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: -laboratoryMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryDestroyList,
                ticketLaboratoryGroupDestroy,
                ticketLaboratoryResultDestroyList,
            };
        });
        return transaction;
    }
};
exports.TicketClinicDestroyTicketLaboratoryGroupOperation = TicketClinicDestroyTicketLaboratoryGroupOperation;
exports.TicketClinicDestroyTicketLaboratoryGroupOperation = TicketClinicDestroyTicketLaboratoryGroupOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketLaboratoryGroupManager !== "undefined" && managers_1.TicketLaboratoryGroupManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketLaboratoryResultManager !== "undefined" && managers_1.TicketLaboratoryResultManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketClinicDestroyTicketLaboratoryGroupOperation);


/***/ }),
/* 221 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicDestroyTicketLaboratoryOperation = class TicketClinicDestroyTicketLaboratoryOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketLaboratoryResultManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketLaboratoryResultManager = ticketLaboratoryResultManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketLaboratory(params) {
        const { oid, ticketId, ticketLaboratoryId } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketLaboratory failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketLaboratoryDestroy = await this.ticketLaboratoryManager.deleteOneAndReturnEntity(manager, { oid, ticketId, id: ticketLaboratoryId });
            const ticketLaboratoryResultDestroyList = await this.ticketLaboratoryResultManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
                ticketLaboratoryId: ticketLaboratoryDestroy.id,
                laboratoryId: ticketLaboratoryDestroy.laboratoryId,
            });
            const ticketLaboratoryRemain = await this.ticketLaboratoryManager.findOneBy(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
            });
            let ticketLaboratoryGroupDestroy = null;
            if (!ticketLaboratoryRemain) {
                ticketLaboratoryGroupDestroy =
                    await this.ticketLaboratoryGroupManager.deleteOneAndReturnEntity(manager, {
                        oid,
                        ticketId,
                        id: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
                    });
            }
            const laboratoryMoneyDelete = ticketLaboratoryDestroy.actualPrice;
            const itemsDiscountDelete = ticketLaboratoryDestroy.discountMoney;
            const itemsCostAmountDelete = ticketLaboratoryDestroy.costPrice;
            let ticket = ticketOrigin;
            if (laboratoryMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: -laboratoryMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryDestroy,
                ticketLaboratoryGroupDestroy,
                ticketLaboratoryResultDestroyList,
            };
        });
        return transaction;
    }
};
exports.TicketClinicDestroyTicketLaboratoryOperation = TicketClinicDestroyTicketLaboratoryOperation;
exports.TicketClinicDestroyTicketLaboratoryOperation = TicketClinicDestroyTicketLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketLaboratoryGroupManager !== "undefined" && managers_1.TicketLaboratoryGroupManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketLaboratoryResultManager !== "undefined" && managers_1.TicketLaboratoryResultManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketClinicDestroyTicketLaboratoryOperation);


/***/ }),
/* 222 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_change_item_money_manager_1 = __webpack_require__(161);
let TicketClinicUpdateTicketLaboratoryOperation = class TicketClinicUpdateTicketLaboratoryOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketLaboratory(params) {
        const { oid, ticketId, ticketLaboratoryId, ticketLaboratoryUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketLaboratory failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketLaboratoryOrigin = await this.ticketLaboratoryManager.findOneBy(manager, {
                oid,
                id: ticketLaboratoryId,
            });
            let ticketLaboratory = ticketLaboratoryOrigin;
            let laboratoryMoneyChange = 0;
            let itemsDiscountChange = 0;
            let itemsCostAmountChange = 0;
            if (ticketLaboratoryUpdateDto) {
                ticketLaboratory = await this.ticketLaboratoryManager.updateOneAndReturnEntity(manager, { oid, id: ticketLaboratoryId }, {
                    expectedPrice: ticketLaboratoryUpdateDto.expectedPrice,
                    discountType: ticketLaboratoryUpdateDto.discountType,
                    discountMoney: ticketLaboratoryUpdateDto.discountMoney,
                    discountPercent: ticketLaboratoryUpdateDto.discountPercent,
                    actualPrice: ticketLaboratoryUpdateDto.actualPrice,
                });
                laboratoryMoneyChange = ticketLaboratory.actualPrice - ticketLaboratoryOrigin.actualPrice;
                itemsDiscountChange = ticketLaboratory.discountMoney - ticketLaboratoryOrigin.discountMoney;
                itemsCostAmountChange = ticketLaboratory.costPrice - ticketLaboratoryOrigin.costPrice;
            }
            let ticket = ticketOrigin;
            if (laboratoryMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: laboratoryMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                    },
                });
            }
            return { ticket, ticketLaboratory };
        });
        return transaction;
    }
};
exports.TicketClinicUpdateTicketLaboratoryOperation = TicketClinicUpdateTicketLaboratoryOperation;
exports.TicketClinicUpdateTicketLaboratoryOperation = TicketClinicUpdateTicketLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketClinicUpdateTicketLaboratoryOperation);


/***/ }),
/* 223 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDepositedOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(146);
const variable_1 = __webpack_require__(21);
const ticket_procedure_entity_1 = __webpack_require__(66);
const ticket_product_entity_1 = __webpack_require__(69);
const managers_1 = __webpack_require__(100);
const ticket_attribute_manager_1 = __webpack_require__(129);
let TicketOrderDepositedOperation = class TicketOrderDepositedOperation {
    constructor(dataSource, manager, ticketManager, ticketAttributeManager, ticketProductManager, ticketProcedureManager, ticketLaboratoryManager, ticketRadiologyManager, ticketSurchargeManager, ticketExpenseManager, ticketUserManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketAttributeManager = ticketAttributeManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketSurchargeManager = ticketSurchargeManager;
        this.ticketExpenseManager = ticketExpenseManager;
        this.ticketUserManager = ticketUserManager;
    }
    async update(params) {
        const { oid, ticketId, ticketOrderDepositedUpdateDto, ticketOrderProductDraftListDto, ticketOrderProcedureDraftListDto, ticketOrderSurchargeDraftListDto, ticketOrderExpenseDraftListDto, ticketAttributeDraftListDto, } = params;
        const registeredAt = ticketOrderDepositedUpdateDto.registeredAt;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { id: ticketId, oid }, Object.assign(Object.assign({}, ticketOrderDepositedUpdateDto), { debt: () => `${ticketOrderDepositedUpdateDto.totalMoney} - paid`, registeredAt, startedAt: registeredAt, year: time_helper_1.ESTimer.info(registeredAt, 7).year, month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1, date: time_helper_1.ESTimer.info(registeredAt, 7).date }));
            await this.ticketAttributeManager.delete(manager, { oid, ticketId });
            await this.ticketProductManager.delete(manager, { oid, ticketId });
            await this.ticketProcedureManager.delete(manager, { oid, ticketId });
            await this.ticketSurchargeManager.delete(manager, { oid, ticketId });
            await this.ticketExpenseManager.delete(manager, { oid, ticketId });
            if (ticketOrderProductDraftListDto.length) {
                const ticketProductListInsert = ticketOrderProductDraftListDto.map((i) => {
                    const ticketProduct = Object.assign(Object.assign({}, i), { oid,
                        ticketId, customerId: ticket.customerId, quantityPrescription: i.quantity, deliveryStatus: variable_1.DeliveryStatus.Pending, type: ticket_product_entity_1.TicketProductType.Prescription });
                    return ticketProduct;
                });
                await this.ticketProductManager.insertMany(manager, ticketProductListInsert);
            }
            if (ticketOrderProcedureDraftListDto.length) {
                const ticketProcedureListInsert = ticketOrderProcedureDraftListDto.map((i) => {
                    const ticketProcedure = Object.assign(Object.assign({}, i), { oid,
                        ticketId, customerId: ticket.customerId, startedAt: ticket.registeredAt, status: ticket_procedure_entity_1.TicketProcedureStatus.Completed, imageIds: JSON.stringify([]), result: '' });
                    return ticketProcedure;
                });
                await this.ticketProcedureManager.insertMany(manager, ticketProcedureListInsert);
            }
            if (ticketOrderSurchargeDraftListDto.length) {
                const ticketSurchargeListInsert = ticketOrderSurchargeDraftListDto.map((i) => {
                    const ticketSurcharge = Object.assign(Object.assign({}, i), { oid,
                        ticketId });
                    return ticketSurcharge;
                });
                await this.ticketSurchargeManager.insertMany(manager, ticketSurchargeListInsert);
            }
            if (ticketOrderExpenseDraftListDto.length) {
                const ticketExpenseListInsert = ticketOrderExpenseDraftListDto.map((i) => {
                    const ticketExpense = Object.assign(Object.assign({}, i), { oid,
                        ticketId });
                    return ticketExpense;
                });
                await this.ticketExpenseManager.insertMany(manager, ticketExpenseListInsert);
            }
            if (ticketAttributeDraftListDto === null || ticketAttributeDraftListDto === void 0 ? void 0 : ticketAttributeDraftListDto.length) {
                const ticketAttributeListInsert = ticketAttributeDraftListDto.map((i) => {
                    const ticketAttribute = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketAttribute;
                });
                await this.ticketAttributeManager.insertMany(manager, ticketAttributeListInsert);
            }
            return { ticket };
        });
    }
};
exports.TicketOrderDepositedOperation = TicketOrderDepositedOperation;
exports.TicketOrderDepositedOperation = TicketOrderDepositedOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof ticket_attribute_manager_1.TicketAttributeManager !== "undefined" && ticket_attribute_manager_1.TicketAttributeManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.TicketProcedureManager !== "undefined" && managers_1.TicketProcedureManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _g : Object, typeof (_h = typeof managers_1.TicketRadiologyManager !== "undefined" && managers_1.TicketRadiologyManager) === "function" ? _h : Object, typeof (_j = typeof managers_1.TicketSurchargeManager !== "undefined" && managers_1.TicketSurchargeManager) === "function" ? _j : Object, typeof (_k = typeof managers_1.TicketExpenseManager !== "undefined" && managers_1.TicketExpenseManager) === "function" ? _k : Object, typeof (_l = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _l : Object])
], TicketOrderDepositedOperation);


/***/ }),
/* 224 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDraftOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(146);
const variable_1 = __webpack_require__(21);
const ticket_procedure_entity_1 = __webpack_require__(66);
const ticket_product_entity_1 = __webpack_require__(69);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
const ticket_attribute_manager_1 = __webpack_require__(129);
let TicketOrderDraftOperation = class TicketOrderDraftOperation {
    constructor(dataSource, ticketManager, ticketAttributeManager, ticketProductManager, ticketProcedureManager, ticketLaboratoryManager, ticketRadiologyManager, ticketSurchargeManager, ticketExpenseManager, ticketUserManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketAttributeManager = ticketAttributeManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketSurchargeManager = ticketSurchargeManager;
        this.ticketExpenseManager = ticketExpenseManager;
        this.ticketUserManager = ticketUserManager;
    }
    async upsert(params) {
        const { oid, ticketId, ticketOrderProductDraftListDto, ticketOrderProcedureDraftListDto, ticketOrderSurchargeDraftListDto, ticketOrderExpenseDraftListDto, ticketAttributeDraftListDto, } = params;
        const ticketOrderDraftUpsertDto = params.ticketOrderDraftUpsertDto;
        const registeredAt = ticketOrderDraftUpsertDto.registeredAt;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            let ticket;
            const ticketUpsert = Object.assign(Object.assign({}, ticketOrderDraftUpsertDto), { status: ticket_entity_1.TicketStatus.Draft, deliveryStatus: ticketOrderProductDraftListDto.length
                    ? variable_1.DeliveryStatus.Pending
                    : variable_1.DeliveryStatus.NoStock, ticketType: ticket_entity_1.TicketType.Order, paid: 0, debt: ticketOrderDraftUpsertDto.totalMoney, registeredAt, startedAt: registeredAt, year: time_helper_1.ESTimer.info(registeredAt, 7).year, month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1, date: time_helper_1.ESTimer.info(registeredAt, 7).date, endedAt: null });
            if (!ticketId) {
                ticket = await this.ticketManager.insertOneAndReturnEntity(manager, Object.assign(Object.assign({}, ticketUpsert), { oid }));
            }
            else {
                ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { id: ticketId, oid }, ticketUpsert);
                await this.ticketAttributeManager.delete(manager, { oid, ticketId });
                await this.ticketProductManager.delete(manager, { oid, ticketId });
                await this.ticketProcedureManager.delete(manager, { oid, ticketId });
                await this.ticketSurchargeManager.delete(manager, { oid, ticketId });
                await this.ticketExpenseManager.delete(manager, { oid, ticketId });
            }
            if (ticketOrderProductDraftListDto.length) {
                const ticketProductListInsert = ticketOrderProductDraftListDto.map((i) => {
                    const ticketProduct = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id, customerId: ticketOrderDraftUpsertDto.customerId, deliveryStatus: variable_1.DeliveryStatus.Pending, quantityPrescription: i.quantity, type: ticket_product_entity_1.TicketProductType.Prescription, costAmount: i.costAmount });
                    return ticketProduct;
                });
                await this.ticketProductManager.insertMany(manager, ticketProductListInsert);
            }
            if (ticketOrderProcedureDraftListDto) {
                const ticketProcedureListInsert = ticketOrderProcedureDraftListDto.map((i) => {
                    const ticketProcedure = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id, customerId: ticketOrderDraftUpsertDto.customerId, startedAt: ticketOrderDraftUpsertDto.registeredAt, status: ticket_procedure_entity_1.TicketProcedureStatus.Completed, imageIds: JSON.stringify([]), result: '' });
                    return ticketProcedure;
                });
                await this.ticketProcedureManager.insertMany(manager, ticketProcedureListInsert);
            }
            if (ticketOrderSurchargeDraftListDto.length) {
                const ticketSurchargeListInsert = ticketOrderSurchargeDraftListDto.map((i) => {
                    const ticketSurcharge = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketSurcharge;
                });
                await this.ticketSurchargeManager.insertMany(manager, ticketSurchargeListInsert);
            }
            if (ticketOrderExpenseDraftListDto.length) {
                const ticketExpenseListInsert = ticketOrderExpenseDraftListDto.map((i) => {
                    const ticketExpense = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketExpense;
                });
                await this.ticketExpenseManager.insertMany(manager, ticketExpenseListInsert);
            }
            if (ticketAttributeDraftListDto === null || ticketAttributeDraftListDto === void 0 ? void 0 : ticketAttributeDraftListDto.length) {
                const ticketAttributeListInsert = ticketAttributeDraftListDto.map((i) => {
                    const ticketAttribute = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketAttribute;
                });
                await this.ticketAttributeManager.insertMany(manager, ticketAttributeListInsert);
            }
            return { ticket };
        });
    }
};
exports.TicketOrderDraftOperation = TicketOrderDraftOperation;
exports.TicketOrderDraftOperation = TicketOrderDraftOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.TicketManager !== "undefined" && managers_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof ticket_attribute_manager_1.TicketAttributeManager !== "undefined" && ticket_attribute_manager_1.TicketAttributeManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.TicketProductManager !== "undefined" && managers_1.TicketProductManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.TicketProcedureManager !== "undefined" && managers_1.TicketProcedureManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.TicketLaboratoryManager !== "undefined" && managers_1.TicketLaboratoryManager) === "function" ? _f : Object, typeof (_g = typeof managers_1.TicketRadiologyManager !== "undefined" && managers_1.TicketRadiologyManager) === "function" ? _g : Object, typeof (_h = typeof managers_1.TicketSurchargeManager !== "undefined" && managers_1.TicketSurchargeManager) === "function" ? _h : Object, typeof (_j = typeof managers_1.TicketExpenseManager !== "undefined" && managers_1.TicketExpenseManager) === "function" ? _j : Object, typeof (_k = typeof managers_1.TicketUserManager !== "undefined" && managers_1.TicketUserManager) === "function" ? _k : Object])
], TicketOrderDraftOperation);


/***/ }),
/* 225 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPaymentOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const string_helper_1 = __webpack_require__(226);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const managers_1 = __webpack_require__(100);
let CustomerPaymentOperation = class CustomerPaymentOperation {
    constructor(dataSource, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async startPayment(options) {
        const { oid, customerId, paymentMethodId, ticketPaymentList, money, time, note, cashierId } = options;
        const PREFIX = `customerId=${customerId} payment failed`;
        const totalTicketMoney = ticketPaymentList.reduce((acc, cur) => {
            if (cur.money <= 0) {
                throw new Error(`${PREFIX}: Money number invalid`);
            }
            return acc + cur.money;
        }, 0);
        const moneyRemain = money - totalTicketMoney;
        if (totalTicketMoney < 0 || money <= 0 || money < totalTicketMoney) {
            throw new Error(`${PREFIX}: Money number invalid`);
        }
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const customerModified = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: customerId }, { debt: () => `debt - ${money}` });
            const customerCloseDebt = customerModified.debt;
            let customerOpenDebt = customerCloseDebt + money;
            const paymentInsertList = [];
            let description = ``;
            if (ticketPaymentList.length) {
                description =
                    `Thanh toán ${(0, string_helper_1.formatNumber)(money)} vào các phiếu nợ::`
                        + `${ticketPaymentList.map((i) => i.ticketId + '').join(',')}`;
            }
            if (moneyRemain > 0) {
                description += ` - Cộng quỹ`;
            }
            if (ticketPaymentList.length) {
                const ticketUpdateResult = await manager.query(`
          UPDATE "Ticket" ticket
          SET "paid"            = ticket."paid" + temp."money",
              "debt"            = ticket."debt" - temp."money",
              "status"    = CASE 
                                    WHEN(ticket."debt" = temp."money") 
                                        THEN ${ticket_entity_1.TicketStatus.Completed} 
                                    ELSE ${ticket_entity_1.TicketStatus.Debt}
                                  END
          FROM (VALUES `
                    + ticketPaymentList.map((i) => `(${i.ticketId}, ${i.money})`).join(', ')
                    + `   ) AS temp("ticketId", "money")
          WHERE   ticket."oid"          = ${oid} 
              AND ticket."id"           = temp."ticketId" 
              AND ticket."customerId"   = ${customerId}
              AND ticket."status" = ${ticket_entity_1.TicketStatus.Debt}
              AND ticket."debt"         >= temp."money";
          `);
                if (ticketUpdateResult[1] != ticketPaymentList.length) {
                    throw new Error(`${PREFIX}: Update Ticket failed, affected = ${ticketUpdateResult[1]}`);
                }
                ticketPaymentList.forEach((i) => {
                    const paymentInsert = {
                        oid,
                        paymentMethodId,
                        voucherType: payment_entity_1.VoucherType.Ticket,
                        voucherId: i.ticketId,
                        personType: payment_entity_1.PersonType.Customer,
                        personId: customerId,
                        paymentTiming: payment_entity_1.PaymentTiming.PayDebt,
                        createdAt: time,
                        moneyDirection: payment_entity_1.MoneyDirection.In,
                        paidAmount: i.money,
                        debtAmount: -i.money,
                        openDebt: customerOpenDebt,
                        closeDebt: customerOpenDebt - i.money,
                        cashierId,
                        note: note || '',
                        description,
                    };
                    customerOpenDebt = paymentInsert.closeDebt;
                    paymentInsertList.push(paymentInsert);
                });
            }
            if (moneyRemain > 0) {
                const paymentInsert = {
                    oid,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Unknown,
                    voucherId: 0,
                    personType: payment_entity_1.PersonType.Customer,
                    personId: customerId,
                    paymentTiming: payment_entity_1.PaymentTiming.TopUp,
                    createdAt: time,
                    moneyDirection: payment_entity_1.MoneyDirection.In,
                    paidAmount: moneyRemain,
                    debtAmount: -moneyRemain,
                    openDebt: customerOpenDebt,
                    closeDebt: customerOpenDebt - moneyRemain,
                    cashierId,
                    note: note || '',
                    description,
                };
                paymentInsertList.push(paymentInsert);
            }
            const paymentCreatedList = await this.paymentManager.insertManyAndReturnEntity(manager, paymentInsertList);
            return { customer: customerModified };
        });
    }
};
exports.CustomerPaymentOperation = CustomerPaymentOperation;
exports.CustomerPaymentOperation = CustomerPaymentOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.CustomerManager !== "undefined" && managers_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _c : Object])
], CustomerPaymentOperation);


/***/ }),
/* 226 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.formatUrlEncode = exports.camelCaseToSnakeCase = exports.snakeCaseToCamelCase = exports.formatNumber = exports.convertViToEn = exports.decrypt = exports.encrypt = exports.randomId = exports.randomString = void 0;
const _CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789' + '!@#$%^&*()_-[]{};\':",./<>?';
const randomString = (length = 10, characters = _CHARSET) => {
    let result = '';
    for (let i = 0; i < length; i += 1) {
        result += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return result;
};
exports.randomString = randomString;
const randomId = () => Date.now().toString(36) + (0, exports.randomString)();
exports.randomId = randomId;
const generateCharset = (privateKey, charset = _CHARSET) => {
    let tempString = charset;
    let result = '';
    for (let i = 0; i < _CHARSET.length; i += 1) {
        const kIndex = i % privateKey.length;
        const charCode = privateKey.charCodeAt(kIndex);
        const tIndex = charCode % tempString.length;
        result = tempString[tIndex] + result;
        tempString = tempString.substring(tIndex + 1) + tempString.substring(0, tIndex);
    }
    return result;
};
const encrypt = (rootString, privateKey, expiryTime) => {
    if (!privateKey)
        privateKey = 'ABC123';
    const rootObject = { r: rootString, e: expiryTime != null ? Date.now() + expiryTime : null };
    const rootObjectJson = JSON.stringify(rootObject);
    let hash = generateCharset(privateKey);
    let result = '';
    for (let i = 0; i < rootObjectJson.length; i += 1) {
        hash = generateCharset(privateKey, hash);
        const index = _CHARSET.indexOf(rootObjectJson[i]);
        if (index === -1) {
            result += rootObjectJson[i];
        }
        else {
            result += hash[index];
        }
    }
    return result;
};
exports.encrypt = encrypt;
const decrypt = (cipherText, privateKey) => {
    if (!privateKey)
        privateKey = 'ABC123';
    let hash = generateCharset(privateKey);
    let rootObjectJson = '';
    for (let i = 0; i < cipherText.length; i += 1) {
        hash = generateCharset(privateKey, hash);
        const index = hash.indexOf(cipherText[i]);
        if (index === -1) {
            rootObjectJson += cipherText[i];
        }
        else {
            rootObjectJson += _CHARSET[index];
        }
    }
    let r, e;
    try {
        const parse = JSON.parse(rootObjectJson);
        r = parse.r;
        e = parse.e;
    }
    catch (error) {
        throw new Error('invalid privateKey');
    }
    if (e != null && e < Date.now()) {
        throw new Error('String invalid expiry time');
    }
    return r;
};
exports.decrypt = decrypt;
const convertViToEn = (root) => root
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/đ/g, 'd')
    .replace(/Đ/g, 'D');
exports.convertViToEn = convertViToEn;
const formatNumber = (number, part = 3, sec = ',', dec = '.') => {
    const numberStr = (number || 0).toString();
    const regex = '\\d(?=(\\d{' + part + '})+' + (numberStr.includes('.') ? '\\D' : '$') + ')';
    return numberStr.replace('.', dec).replace(new RegExp(regex, 'g'), '$&' + sec);
};
exports.formatNumber = formatNumber;
const snakeCaseToCamelCase = (input) => input.replace(/(_\w)/g, (k) => k[1].toUpperCase());
exports.snakeCaseToCamelCase = snakeCaseToCamelCase;
const camelCaseToSnakeCase = (input) => input.replace(/[A-Z]/g, (k) => `_${k.toLowerCase()}`);
exports.camelCaseToSnakeCase = camelCaseToSnakeCase;
const formatUrlEncode = (text) => {
    return text.replace(/[^a-zA-Z0-9_\-.*]+/g, '');
};
exports.formatUrlEncode = formatUrlEncode;


/***/ }),
/* 227 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPaymentOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const string_helper_1 = __webpack_require__(226);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const managers_1 = __webpack_require__(100);
let DistributorPaymentOperation = class DistributorPaymentOperation {
    constructor(dataSource, distributorManager, paymentManager) {
        this.dataSource = dataSource;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
    }
    async startPayment(options) {
        const { oid, distributorId, paymentMethodId, receiptPaymentList, money, time, note, cashierId, } = options;
        const PREFIX = `distributorId=${distributorId} payment failed`;
        const totalReceiptMoney = receiptPaymentList.reduce((acc, cur) => {
            if (cur.money <= 0) {
                throw new Error(`${PREFIX}: Money number invalid`);
            }
            return acc + cur.money;
        }, 0);
        const moneyRemain = money - totalReceiptMoney;
        if (totalReceiptMoney < 0 || money <= 0 || money < totalReceiptMoney) {
            throw new Error(`${PREFIX}: Money number invalid`);
        }
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const distributorModified = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: distributorId }, { debt: () => `debt - ${money}` });
            const distributorCloseDebt = distributorModified.debt;
            let distributorOpenDebt = distributorCloseDebt + money;
            const paymentInsertList = [];
            let description = ``;
            if (receiptPaymentList.length) {
                description =
                    `Thanh toán ${(0, string_helper_1.formatNumber)(money)} vào các phiếu nợ::`
                        + `${receiptPaymentList.map((i) => i.receiptId + '').join(',')}`;
            }
            if (moneyRemain > 0) {
                description += ` - Cộng quỹ`;
            }
            if (receiptPaymentList.length) {
                const receiptUpdateResult = await manager.query(`
          UPDATE "Receipt" receipt
          SET "paid"            = receipt."paid" + temp."money",
              "debt"            = receipt."debt" - temp."money",
              "status"          = CASE 
                                    WHEN(receipt."debt" = temp."money") 
                                        THEN ${receipt_entity_1.ReceiptStatus.Completed} 
                                    ELSE ${receipt_entity_1.ReceiptStatus.Debt}
                                  END
          FROM (VALUES `
                    + receiptPaymentList.map((i) => `(${i.receiptId}, ${i.money})`).join(', ')
                    + `   ) AS temp("receiptId", "money")
          WHERE   receipt."oid"           = ${oid} 
              AND receipt."id"            = temp."receiptId" 
              AND receipt."distributorId" = ${distributorId}
              AND receipt."status"        = ${receipt_entity_1.ReceiptStatus.Debt}
              AND receipt."debt"         >= temp."money";
          `);
                if (receiptUpdateResult[1] != receiptPaymentList.length) {
                    throw new Error(`${PREFIX}: Update Receipt failed, affected = ${receiptUpdateResult[1]}`);
                }
                receiptPaymentList.forEach((i) => {
                    const paymentInsert = {
                        oid,
                        paymentMethodId,
                        voucherType: payment_entity_1.VoucherType.Receipt,
                        voucherId: i.receiptId,
                        personType: payment_entity_1.PersonType.Distributor,
                        personId: distributorId,
                        paymentTiming: payment_entity_1.PaymentTiming.PayDebt,
                        createdAt: time,
                        moneyDirection: payment_entity_1.MoneyDirection.Out,
                        paidAmount: -i.money,
                        debtAmount: -i.money,
                        openDebt: distributorOpenDebt,
                        closeDebt: distributorOpenDebt - i.money,
                        cashierId,
                        note: note || '',
                        description,
                    };
                    distributorOpenDebt = paymentInsert.closeDebt;
                    paymentInsertList.push(paymentInsert);
                });
            }
            if (moneyRemain > 0) {
                const paymentInsert = {
                    oid,
                    paymentMethodId,
                    voucherType: payment_entity_1.VoucherType.Unknown,
                    voucherId: 0,
                    personType: payment_entity_1.PersonType.Distributor,
                    personId: distributorId,
                    paymentTiming: payment_entity_1.PaymentTiming.TopUp,
                    createdAt: time,
                    moneyDirection: payment_entity_1.MoneyDirection.Out,
                    paidAmount: -moneyRemain,
                    debtAmount: -moneyRemain,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorOpenDebt - moneyRemain,
                    cashierId,
                    note: note || '',
                    description,
                };
                paymentInsertList.push(paymentInsert);
            }
            const paymentCreatedList = await this.paymentManager.insertManyAndReturnEntity(manager, paymentInsertList);
            return { distributor: distributorModified };
        });
    }
};
exports.DistributorPaymentOperation = DistributorPaymentOperation;
exports.DistributorPaymentOperation = DistributorPaymentOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.DistributorManager !== "undefined" && managers_1.DistributorManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.PaymentManager !== "undefined" && managers_1.PaymentManager) === "function" ? _c : Object])
], DistributorPaymentOperation);


/***/ }),
/* 228 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckReconcileOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const object_helper_1 = __webpack_require__(91);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const stock_check_entity_1 = __webpack_require__(80);
const managers_1 = __webpack_require__(100);
let StockCheckReconcileOperation = class StockCheckReconcileOperation {
    constructor(dataSource, stockCheckManager, stockCheckItemManager, batchManager, productManager, productMovementManager) {
        this.dataSource = dataSource;
        this.stockCheckManager = stockCheckManager;
        this.stockCheckItemManager = stockCheckItemManager;
        this.batchManager = batchManager;
        this.productManager = productManager;
        this.productMovementManager = productMovementManager;
    }
    async startReconcile(params) {
        const { oid, stockCheckId, userId, time } = params;
        const PREFIX = `stockCheckId=${stockCheckId} StockCheckReconcileOperation failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const stockCheck = await this.stockCheckManager.updateOneAndReturnEntity(manager, { oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Confirmed }, { status: stock_check_entity_1.StockCheckStatus.Balanced, updatedByUserId: userId, updatedAt: time });
            const stockCheckItemList = await this.stockCheckItemManager.findManyBy(manager, {
                oid,
                stockCheckId,
            });
            const duplicatesBatchId = object_helper_1.ESArray.checkDuplicate(stockCheckItemList, 'batchId');
            if (duplicatesBatchId.length) {
                const batchIdList = duplicatesBatchId.map((i) => i.value);
                throw new error_1.BusinessError(PREFIX, `: Có trùng lặp batchId = ${batchIdList.join('')} }`);
            }
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                tempList: stockCheckItemList.map((i) => ({
                    id: i.batchId,
                    quantity: i.actualQuantity,
                    costAmount: i.actualCostAmount,
                })),
                compare: ['id'],
                update: ['quantity', 'costAmount'],
            });
            const batchModifiedMap = object_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productIdList = stockCheckItemList.map((i) => i.productId);
            const productModifiedList = await this.productManager.reCalculateQuantityBySumBatchList({
                manager,
                oid,
                productIdList,
            });
            const productModifiedMap = object_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const productCalcMap = {};
            productModifiedList.forEach((i) => {
                productCalcMap[i.id] = { productId: i.id, closeQuantity: i.quantity };
            });
            const productMovementInsertList = [];
            stockCheckItemList.reverse().forEach((scItem) => {
                const productModified = productModifiedMap[scItem.productId];
                const batchModified = batchModifiedMap[scItem.batchId];
                const productCalc = productCalcMap[scItem.productId];
                const quantityDifferent = scItem.actualQuantity - scItem.systemQuantity;
                const costAmountDifferent = scItem.actualCostAmount - scItem.systemCostAmount;
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.StockCheck,
                    contactId: userId,
                    voucherId: stockCheckId,
                    voucherProductId: scItem.id,
                    warehouseId: batchModified.warehouseId,
                    productId: scItem.productId,
                    batchId: scItem.batchId || 0,
                    createdAt: time,
                    isRefund: 0,
                    expectedPrice: productModified.retailPrice,
                    actualPrice: productModified.retailPrice,
                    quantity: quantityDifferent,
                    costAmount: costAmountDifferent,
                    openQuantityProduct: productCalc.closeQuantity - quantityDifferent,
                    closeQuantityProduct: productCalc.closeQuantity,
                    openQuantityBatch: batchModified.quantity - quantityDifferent,
                    closeQuantityBatch: batchModified.quantity,
                    openCostAmountBatch: batchModified.costAmount - costAmountDifferent,
                    closeCostAmountBatch: batchModified.costAmount,
                };
                productCalc.closeQuantity = productMovementInsert.openQuantityProduct;
                productMovementInsertList.unshift(productMovementInsert);
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            return { stockCheck };
        });
        return transaction;
    }
};
exports.StockCheckReconcileOperation = StockCheckReconcileOperation;
exports.StockCheckReconcileOperation = StockCheckReconcileOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof managers_1.StockCheckManager !== "undefined" && managers_1.StockCheckManager) === "function" ? _b : Object, typeof (_c = typeof managers_1.StockCheckItemManager !== "undefined" && managers_1.StockCheckItemManager) === "function" ? _c : Object, typeof (_d = typeof managers_1.BatchManager !== "undefined" && managers_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof managers_1.ProductManager !== "undefined" && managers_1.ProductManager) === "function" ? _e : Object, typeof (_f = typeof managers_1.ProductMovementManager !== "undefined" && managers_1.ProductMovementManager) === "function" ? _f : Object])
], StockCheckReconcileOperation);


/***/ }),
/* 229 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlConfig = void 0;
const config_1 = __webpack_require__(30);
exports.PostgresqlConfig = (0, config_1.registerAs)('postgres', () => ({
    type: process.env.SQL_TYPE,
    host: process.env.SQL_HOST,
    port: Number(process.env.SQL_PORT),
    database: process.env.SQL_DATABASE,
    username: process.env.SQL_USERNAME,
    password: process.env.SQL_PASSWORD,
    autoLoadEntities: true,
    logging: process.env.NODE_ENV !== 'production' ? 'all' : ['error'],
}));


/***/ }),
/* 230 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const google_driver_config_1 = __webpack_require__(231);
const google_driver_service_1 = __webpack_require__(232);
let GoogleDriverModule = class GoogleDriverModule {
};
exports.GoogleDriverModule = GoogleDriverModule;
exports.GoogleDriverModule = GoogleDriverModule = __decorate([
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(google_driver_config_1.GoogleDriverConfig)],
        controllers: [],
        providers: [google_driver_service_1.GoogleDriverService],
        exports: [google_driver_service_1.GoogleDriverService],
    })
], GoogleDriverModule);


/***/ }),
/* 231 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverConfig = void 0;
const config_1 = __webpack_require__(30);
exports.GoogleDriverConfig = (0, config_1.registerAs)('google_driver', () => ({
    clientId: process.env.GG_DRIVER_CLIENT_ID,
    clientSecret: process.env.GG_DRIVER_CLIENT_SECRET,
    redirectURI: process.env.GG_DRIVER_REDIRECT_URI,
}));


/***/ }),
/* 232 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var GoogleDriverService_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const googleapis_1 = __webpack_require__(233);
const stream = __webpack_require__(234);
const time_helper_1 = __webpack_require__(146);
const google_driver_config_1 = __webpack_require__(231);
let GoogleDriverService = GoogleDriverService_1 = class GoogleDriverService {
    constructor(googleDriverConfig) {
        this.googleDriverConfig = googleDriverConfig;
        this.logger = new common_1.Logger(GoogleDriverService_1.name);
        this.cache = {};
    }
    setCache(email, data) {
        this.cache[email] = data;
    }
    getRootFolderName() {
        return 'MEA.VN';
    }
    getDefaultFolderName(oid) {
        return `MEA_${oid.toString().padStart(3, '000')}_${new Date().getFullYear()}`;
    }
    createOAuth2Client() {
        return new googleapis_1.google.auth.OAuth2(this.googleDriverConfig.clientId, this.googleDriverConfig.clientSecret, this.googleDriverConfig.redirectURI);
    }
    createDrive(email) {
        if (!email || !this.cache[email]) {
            throw new Error('Chưa đăng nhập tài khoản Google Driver, email = ' + email);
        }
        const oAuth2Client = this.createOAuth2Client();
        oAuth2Client.setCredentials({ refresh_token: this.cache[email].refreshToken });
        const drive = googleapis_1.google.drive({
            version: 'v3',
            auth: oAuth2Client,
        });
        return drive;
    }
    async getAuthUrl(options) {
        const url = this.createOAuth2Client().generateAuthUrl({
            access_type: 'offline',
            prompt: 'consent',
            scope: [
                'https://www.googleapis.com/auth/drive',
                'https://www.googleapis.com/auth/userinfo.email',
            ],
            state: options.state,
        });
        return { url };
    }
    async logout(email) {
        this.cache[email] = null;
    }
    async loginCallback(query) {
        const oid = Number(query.state);
        const oAuth2Client = this.createOAuth2Client();
        const { tokens } = await oAuth2Client.getToken(query.code);
        const refreshToken = tokens.refresh_token;
        oAuth2Client.setCredentials({ refresh_token: refreshToken });
        const oauth2 = googleapis_1.google.oauth2({
            auth: oAuth2Client,
            version: 'v2',
        });
        const userInfo = await oauth2.userinfo.get();
        const email = userInfo.data.email;
        this.cache[email] = { refreshToken };
        const drive = this.createDrive(email);
        const rootFolder = await this.createRootFolder(drive);
        const defaultFolder = await this.createDefaultFolder(drive, {
            oid,
            rootFolderId: rootFolder.id,
        });
        this.cache[email] = {
            refreshToken,
            rootFolderId: rootFolder.id,
            defaultFolderId: defaultFolder.id,
            defaultFolderName: defaultFolder.name,
        };
        return { email, refreshToken, oid };
    }
    async createRootFolder(drive) {
        const rootFolderName = this.getRootFolderName();
        let rootFolder;
        const folderList = await this.findFolderList(drive, { folderName: rootFolderName });
        rootFolder = folderList[0];
        if (!rootFolder) {
            rootFolder = await this.createFolder(drive, { folderName: rootFolderName });
        }
        return rootFolder;
    }
    async createDefaultFolder(drive, params) {
        const { oid, rootFolderId } = params;
        const defaultFolderName = this.getDefaultFolderName(oid);
        let defaultFolder;
        const folderList = await this.findFolderList(drive, {
            folderName: defaultFolderName,
            parentId: rootFolderId,
        });
        defaultFolder = folderList[0];
        if (!defaultFolder) {
            defaultFolder = await this.createFolder(drive, {
                folderName: defaultFolderName,
                parentFolderId: rootFolderId,
            });
        }
        return defaultFolder;
    }
    async getAllFolders(email) {
        const drive = this.createDrive(email);
        const response = await drive.files.list({
            q: "mimeType='application/vnd.google-apps.folder' and trashed=false and 'me' in owners",
            fields: 'nextPageToken, files(id, name, mimeType, trashed, parents, modifiedTime)',
        });
        const folderList = response.data.files;
        return folderList;
    }
    async findFolderList(drive, condition) {
        const { folderName, parentId } = condition;
        let queryString = '';
        if (folderName)
            queryString += ` and name='${folderName}'`;
        if (parentId)
            queryString += ` and '${parentId}' in parents`;
        const response = await drive.files.list({
            q: `mimeType='application/vnd.google-apps.folder' and trashed=false and 'me' in owners`
                + queryString,
            fields: 'nextPageToken, files(id, name, mimeType, trashed, parents, modifiedTime)',
        });
        const folderList = response.data.files;
        return folderList;
    }
    async createFolder(drive, params) {
        const { folderName, parentFolderId } = params;
        const response = await drive.files.create({
            requestBody: {
                name: folderName,
                mimeType: 'application/vnd.google-apps.folder',
                parents: parentFolderId ? [parentFolderId] : [],
            },
        });
        const folder = response.data;
        await drive.permissions.create({
            fileId: folder.id,
            requestBody: {
                role: 'reader',
                type: 'anyone',
            },
        });
        return folder;
    }
    async getById(drive, fileId) {
        const response = await drive.files.get({
            fileId,
            fields: 'id, name, mimeType, parents, trashed, modifiedTime, size',
        });
        return response.data;
    }
    async trashById(drive, fileId) {
        const response = await drive.files.update({
            fileId,
            requestBody: { trashed: true },
        });
        const fileTrash = response.data;
        return fileTrash;
    }
    async deleteById(drive, fileId) {
        const response = await drive.files.update({
            fileId,
            requestBody: { trashed: true },
        });
        return response.data;
    }
    async trashMultipleFiles(options) {
        const { email, fileIds, oid } = options;
        if (!fileIds.length)
            return { success: [], failed: [] };
        let drive;
        try {
            this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start trashMultipleFiles, with ${fileIds.length} file`);
            drive = this.createDrive(email);
        }
        catch (error) {
            return { success: [], failed: fileIds };
        }
        const promiseSettled = await Promise.allSettled(fileIds.map((id) => this.trashById(drive, id)));
        const result = { success: [], failed: [] };
        promiseSettled.forEach((i, index) => {
            if (i.status === 'fulfilled') {
                result.success.push(i.value.id);
            }
            else {
                this.logger.error('Google Driver trash file error: ' + index);
                this.logger.error(i);
                result.failed.push(fileIds[index]);
            }
        });
        return result;
    }
    async deleteMultipleFiles(email, fileIds) {
        if (!fileIds.length)
            return { success: [], failed: [] };
        let drive;
        try {
            drive = this.createDrive(email);
        }
        catch (error) {
            return { success: [], failed: fileIds };
        }
        const promiseSettled = await Promise.allSettled(fileIds.map((id) => this.deleteById(drive, id)));
        const result = { success: [], failed: [] };
        promiseSettled.forEach((i, index) => {
            if (i.status === 'fulfilled') {
                result.success.push(i.value.id);
            }
            else {
                this.logger.error('Google Driver trash file error: ' + index);
                this.logger.error(i);
                result.failed.push(fileIds[index]);
            }
        });
        return result;
    }
    async createFileByStream(drive, options, permission) {
        const { title, parent, stream, mimetype } = options;
        const response = await drive.files.create({
            requestBody: {
                name: title,
                parents: [parent],
                mimeType: mimetype,
            },
            media: {
                mimeType: mimetype,
                body: stream,
            },
            fields: 'id, name, mimeType, kind, size',
        });
        const file = response.data;
        if (permission) {
            await drive.permissions.create({
                fileId: file.id,
                requestBody: {
                    role: permission.role,
                    type: permission.type,
                    emailAddress: permission.emailAddress,
                    domain: permission.domain,
                },
            });
        }
        return file;
    }
    async createFile(drive, options) {
        const { title, parent, buffer, mimetype } = options;
        const bufferStream = new stream.PassThrough();
        bufferStream.end(buffer);
        return this.createFileByStream(drive, {
            title,
            parent,
            stream: bufferStream,
            mimetype,
        }, { role: 'reader', type: 'anyone' });
    }
    async uploadFileStream(options) {
        const { fileStream, email, oid, fileName, mimetype, permission } = options;
        if (!fileStream)
            return null;
        this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start uploadFileStream with fine name ${fileName}`);
        const drive = this.createDrive(email);
        if (!this.cache[email].rootFolderId) {
            const rootFolder = await this.createRootFolder(drive);
            this.cache[email].rootFolderId = rootFolder.id;
        }
        if (this.cache[email].defaultFolderName !== this.getDefaultFolderName(oid)) {
            const defaultFolder = await this.createDefaultFolder(drive, {
                oid,
                rootFolderId: this.cache[email].rootFolderId,
            });
            this.cache[email].defaultFolderId = defaultFolder.id;
            this.cache[email].defaultFolderName = defaultFolder.name;
        }
        const file = await this.createFileByStream(drive, {
            title: fileName,
            parent: this.cache[email].defaultFolderId,
            stream: fileStream,
            mimetype,
        }, permission);
        return file;
    }
    async uploadMultipleFiles(options) {
        const { files, email, oid, customerId } = options;
        if (!files.length)
            return [];
        this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start uploadMultipleFiles, with ${files.length} file`);
        const drive = this.createDrive(email);
        if (!this.cache[email].rootFolderId) {
            const rootFolder = await this.createRootFolder(drive);
            this.cache[email].rootFolderId = rootFolder.id;
        }
        if (this.cache[email].defaultFolderName !== this.getDefaultFolderName(oid)) {
            const defaultFolder = await this.createDefaultFolder(drive, {
                oid,
                rootFolderId: this.cache[email].rootFolderId,
            });
            this.cache[email].defaultFolderId = defaultFolder.id;
            this.cache[email].defaultFolderName = defaultFolder.name;
        }
        const now = Date.now();
        const data = await Promise.all(files.map((item, index) => {
            return this.createFile(drive, {
                buffer: item.buffer,
                mimetype: item.mimetype,
                parent: this.cache[email].defaultFolderId,
                title: oid
                    + '-'
                    + customerId
                    + '-'
                    + time_helper_1.ESTimer.timeToText(now + index, 'YYYY-MM-DD-hh-mm-ss-xxx'),
            });
        }));
        return data;
    }
};
exports.GoogleDriverService = GoogleDriverService;
exports.GoogleDriverService = GoogleDriverService = GoogleDriverService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(google_driver_config_1.GoogleDriverConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object])
], GoogleDriverService);


/***/ }),
/* 233 */
/***/ ((module) => {

module.exports = require("googleapis");

/***/ }),
/* 234 */
/***/ ((module) => {

module.exports = require("stream");

/***/ }),
/* 235 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AuthModule = void 0;
const common_1 = __webpack_require__(3);
const api_auth_module_1 = __webpack_require__(236);
const api_me_module_1 = __webpack_require__(253);
let AuthModule = class AuthModule {
};
exports.AuthModule = AuthModule;
exports.AuthModule = AuthModule = __decorate([
    (0, common_1.Module)({
        imports: [api_auth_module_1.ApiAuthModule, api_me_module_1.ApiMeModule],
        controllers: [],
        providers: [],
    })
], AuthModule);


/***/ }),
/* 236 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const jwt_extend_module_1 = __webpack_require__(94);
const jwt_config_1 = __webpack_require__(97);
const environments_1 = __webpack_require__(29);
const email_module_1 = __webpack_require__(237);
const api_auth_controller_1 = __webpack_require__(240);
const api_auth_service_1 = __webpack_require__(242);
let ApiAuthModule = class ApiAuthModule {
};
exports.ApiAuthModule = ApiAuthModule;
exports.ApiAuthModule = ApiAuthModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forFeature(environments_1.GlobalConfig),
            config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig),
            jwt_extend_module_1.JwtExtendModule,
            email_module_1.EmailModule,
        ],
        controllers: [api_auth_controller_1.ApiAuthController],
        providers: [api_auth_service_1.ApiAuthService],
    })
], ApiAuthModule);


/***/ }),
/* 237 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailModule = void 0;
const mailer_1 = __webpack_require__(238);
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const environments_1 = __webpack_require__(29);
const email_service_1 = __webpack_require__(239);
let EmailModule = class EmailModule {
};
exports.EmailModule = EmailModule;
exports.EmailModule = EmailModule = __decorate([
    (0, common_1.Module)({
        imports: [
            mailer_1.MailerModule.forRootAsync({
                imports: [config_1.ConfigModule.forFeature(environments_1.EmailConfig)],
                inject: [environments_1.EmailConfig.KEY],
                useFactory: (mailConfig) => {
                    return {
                        transport: {
                            host: mailConfig.host,
                            port: mailConfig.port,
                            auth: {
                                user: mailConfig.user,
                                pass: mailConfig.password,
                            },
                        },
                        defaults: { from: `"${mailConfig.name}" <${mailConfig.from}>` },
                    };
                },
            }),
        ],
        providers: [email_service_1.EmailService],
        exports: [email_service_1.EmailService],
    })
], EmailModule);


/***/ }),
/* 238 */
/***/ ((module) => {

module.exports = require("@nestjs-modules/mailer");

/***/ }),
/* 239 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var EmailService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailService = void 0;
const mailer_1 = __webpack_require__(238);
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
let EmailService = EmailService_1 = class EmailService {
    constructor(configService, mailerService) {
        this.configService = configService;
        this.mailerService = mailerService;
        this.logger = new common_1.Logger(EmailService_1.name);
        this.subjectPrefix = this.configService.get('mail.subject_prefix');
    }
    async send(options) {
        return await this.mailerService.sendMail(options);
    }
};
exports.EmailService = EmailService;
exports.EmailService = EmailService = EmailService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof mailer_1.MailerService !== "undefined" && mailer_1.MailerService) === "function" ? _b : Object])
], EmailService);


/***/ }),
/* 240 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const external_request_1 = __webpack_require__(241);
const api_auth_service_1 = __webpack_require__(242);
const request_1 = __webpack_require__(244);
let ApiAuthController = class ApiAuthController {
    constructor(apiAuthService) {
        this.apiAuthService = apiAuthService;
    }
    async login(loginDto, dataExternal) {
        return await this.apiAuthService.login(loginDto, dataExternal);
    }
    async loginRoot(loginDto, dataExternal) {
        return await this.apiAuthService.loginRoot(loginDto, dataExternal);
    }
    async loginDemo(dataExternal) {
        return await this.apiAuthService.loginDemo(dataExternal);
    }
    async forgotPassword(body) {
        return await this.apiAuthService.forgotPassword(body);
    }
    async resetPassword(body) {
        return await this.apiAuthService.resetPassword(body);
    }
    async grantAccessToken(dataExternal, body) {
        return await this.apiAuthService.grantAccessToken(body.refreshToken, dataExternal);
    }
    async logout(body) {
        return this.apiAuthService.logout(body.refreshToken);
    }
};
exports.ApiAuthController = ApiAuthController;
__decorate([
    (0, common_1.Post)('login'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.LoginBody !== "undefined" && request_1.LoginBody) === "function" ? _b : Object, typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "login", null);
__decorate([
    (0, common_1.Post)('login-root'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof request_1.LoginRootBody !== "undefined" && request_1.LoginRootBody) === "function" ? _d : Object, typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "loginRoot", null);
__decorate([
    (0, common_1.Post)('login-demo'),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "loginDemo", null);
__decorate([
    (0, common_1.Post)('forgot-password'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof request_1.ForgotPasswordBody !== "undefined" && request_1.ForgotPasswordBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "forgotPassword", null);
__decorate([
    (0, common_1.Post)('reset-password'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof request_1.ResetPasswordBody !== "undefined" && request_1.ResetPasswordBody) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "resetPassword", null);
__decorate([
    (0, common_1.Post)('refresh-token'),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RefreshTokenBody !== "undefined" && request_1.RefreshTokenBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "grantAccessToken", null);
__decorate([
    (0, common_1.Post)('logout'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof request_1.RefreshTokenBody !== "undefined" && request_1.RefreshTokenBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "logout", null);
exports.ApiAuthController = ApiAuthController = __decorate([
    (0, swagger_1.ApiTags)('Auth'),
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_auth_service_1.ApiAuthService !== "undefined" && api_auth_service_1.ApiAuthService) === "function" ? _a : Object])
], ApiAuthController);


/***/ }),
/* 241 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.External = void 0;
const common_1 = __webpack_require__(3);
exports.External = (0, common_1.createParamDecorator)((data, ctx) => {
    const request = ctx.switchToHttp().getRequest();
    const requestExternal = request.raw;
    return requestExternal.external;
});


/***/ }),
/* 242 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const typeorm_1 = __webpack_require__(42);
const bcrypt = __webpack_require__(243);
const typeorm_2 = __webpack_require__(18);
const cache_token_service_1 = __webpack_require__(92);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(226);
const jwt_extend_service_1 = __webpack_require__(96);
const jwt_config_1 = __webpack_require__(97);
const organization_entity_1 = __webpack_require__(16);
const user_entity_1 = __webpack_require__(20);
const customer_repository_1 = __webpack_require__(175);
const distributor_repository_1 = __webpack_require__(176);
const organization_repository_1 = __webpack_require__(41);
const user_repository_1 = __webpack_require__(90);
const environments_1 = __webpack_require__(29);
const email_service_1 = __webpack_require__(239);
let ApiAuthService = class ApiAuthService {
    constructor(globalConfig, jwtConfig, dataSource, manager, emailService, cacheTokenService, jwtExtendService, organizationRepository, customerRepository, userRepository, distributorRepository) {
        this.globalConfig = globalConfig;
        this.jwtConfig = jwtConfig;
        this.dataSource = dataSource;
        this.manager = manager;
        this.emailService = emailService;
        this.cacheTokenService = cacheTokenService;
        this.jwtExtendService = jwtExtendService;
        this.organizationRepository = organizationRepository;
        this.customerRepository = customerRepository;
        this.userRepository = userRepository;
        this.distributorRepository = distributorRepository;
    }
    async login(loginDto, dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const [user] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'join',
            where: {
                username: loginDto.username,
                organization: { phone: loginDto.orgPhone },
            },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!user.isActive || user.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const checkPassword = await bcrypt.compare(loginDto.password, user.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async loginRoot(loginRootDto, dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const [root] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'join',
            where: {
                username: loginRootDto.username,
                organization: { phone: loginRootDto.orgPhone },
            },
        });
        if (!root)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!root.isActive || root.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const checkPassword = await bcrypt.compare(loginRootDto.password, root.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        const [user] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'join',
            where: {
                oid: loginRootDto.oid,
                isAdmin: 1,
            },
        });
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async loginDemo(dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const [user] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'query',
            where: { id: 4, oid: 4 },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!user.isActive || user.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async forgotPassword(body) {
        const organization = await this.organizationRepository.findOneBy({
            phone: body.organizationPhone,
            email: body.organizationEmail,
        });
        if (!organization) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.NotFound',
                details: 'Organization',
            });
        }
        const user = await this.userRepository.findOne({
            condition: {
                oid: organization.id,
                username: body.username,
            },
        });
        if (!user) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'User' });
        }
        if (!user.isActive || user.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const token = encodeURIComponent((0, string_helper_1.encrypt)(user.hashPassword, this.jwtConfig.accessKey, 30 * 60 * 1000));
        const link = `${this.globalConfig.DOMAIN_FRONT_END}/auth/reset-password`
            + `?token=${token}&organizationPhone=${body.organizationPhone}`
            + `&username=${body.username}&updatedAt=${user.updatedAt}`
            + `&ver=1`;
        const sendEmailResult = await this.emailService.send({
            to: body.organizationEmail,
            subject: '[MEA] - Quên mật khẩu',
            from: 'medihome.vn@gmail.com',
            text: 'forgot_password',
            html: '<p>Bạn nhận được yêu cầu reset mật khẩu. Nhấn vào đường link sau để cập nhật mật khẩu mới: </p>'
                + `<p><a href="${link}">${link}</a></p>`
                + '<p>Link sẽ bị vô hiệu hóa sau 30 phút</p>',
        });
        return { data: { sendEmailResult } };
    }
    async resetPassword(body) {
        const organization = await this.organizationRepository.findOneBy({
            phone: body.organizationPhone,
        });
        if (!organization) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.NotFound',
                details: 'Organization',
            });
        }
        const user = await this.userRepository.findOne({
            condition: {
                oid: organization.id,
                username: body.username,
            },
        });
        if (!user) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'User' });
        }
        if (user.updatedAt !== body.updatedAt) {
            throw new common_1.HttpException('Token đã được sử dụng', common_1.HttpStatus.BAD_GATEWAY);
        }
        let hash;
        try {
            hash = (0, string_helper_1.decrypt)(body.token, this.jwtConfig.accessKey);
        }
        catch (error) {
            throw new common_1.HttpException('Thời gian reset password đã quá hạn', common_1.HttpStatus.BAD_GATEWAY);
        }
        if (user.hashPassword !== hash) {
            throw new exception_filter_1.BusinessException('error.Token.Invalid');
        }
        const hashPassword = await bcrypt.hash(body.password, 5);
        const secret = (0, string_helper_1.encrypt)(body.password, body.username);
        await this.userRepository.update({ id: user.id }, { hashPassword, secret });
        await this.cacheTokenService.removeAllRefreshToken({ oid: user.oid, uid: user.id });
        return { data: true };
    }
    async grantAccessToken(refreshToken, dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const jwtPayloadRefresh = this.jwtExtendService.verifyRefreshToken(refreshToken, ip);
        const checkTokenCache = await this.cacheTokenService.checkRefreshToken({
            oid: jwtPayloadRefresh.data.oid,
            uid: jwtPayloadRefresh.data.uid,
            refreshExp: jwtPayloadRefresh.exp,
        });
        if (!checkTokenCache) {
            throw new exception_filter_1.BusinessException('error.Token.RefreshTokenNoCache', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        const user = await this.userRepository.findOne({
            relation: { organization: true },
            condition: {
                id: jwtPayloadRefresh.data.uid,
                oid: jwtPayloadRefresh.data.oid,
            },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const token = this.jwtExtendService.createAccessToken(user, ip);
        await this.cacheTokenService.updateAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: jwtPayloadRefresh.exp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: { accessExp: token.accessExp, accessToken: token.accessToken },
        };
    }
    async logout(refreshToken) {
        const jwtPayload = this.jwtExtendService.decodeRefreshToken(refreshToken);
        await this.cacheTokenService.removeRefreshToken({
            oid: jwtPayload.data.oid,
            uid: jwtPayload.data.uid,
            refreshExp: jwtPayload.exp,
        });
        return { data: true };
    }
};
exports.ApiAuthService = ApiAuthService;
exports.ApiAuthService = ApiAuthService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(environments_1.GlobalConfig.KEY)),
    __param(1, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __param(3, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _d : Object, typeof (_e = typeof email_service_1.EmailService !== "undefined" && email_service_1.EmailService) === "function" ? _e : Object, typeof (_f = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _f : Object, typeof (_g = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _g : Object, typeof (_h = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _h : Object, typeof (_j = typeof customer_repository_1.CustomerRepository !== "undefined" && customer_repository_1.CustomerRepository) === "function" ? _j : Object, typeof (_k = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _k : Object, typeof (_l = typeof distributor_repository_1.DistributorRepository !== "undefined" && distributor_repository_1.DistributorRepository) === "function" ? _l : Object])
], ApiAuthService);


/***/ }),
/* 243 */
/***/ ((module) => {

module.exports = require("bcrypt");

/***/ }),
/* 244 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(245), exports);
__exportStar(__webpack_require__(249), exports);
__exportStar(__webpack_require__(250), exports);
__exportStar(__webpack_require__(251), exports);
__exportStar(__webpack_require__(252), exports);


/***/ }),
/* 245 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ForgotPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ForgotPasswordBody {
}
exports.ForgotPasswordBody = ForgotPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "organizationPhone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'duycodecom@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "organizationEmail", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "username", void 0);


/***/ }),
/* 246 */
/***/ ((module) => {

module.exports = require("class-validator");

/***/ }),
/* 247 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.IsGmail = exports.IsPhone = void 0;
exports.IsNumberGreaterThan = IsNumberGreaterThan;
exports.IsEnumValue = IsEnumValue;
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
let IsPhone = class IsPhone {
    validate(text, args) {
        if (text === '')
            return true;
        if (typeof text !== 'string' || text.length !== 10)
            return false;
        return /((09|03|07|08|05)+([0-9]{8})\b)/g.test(text);
    }
    defaultMessage(args) {
        return '$property must be real phone number !';
    }
};
exports.IsPhone = IsPhone;
exports.IsPhone = IsPhone = __decorate([
    (0, class_validator_1.ValidatorConstraint)({ name: 'isPhone', async: false })
], IsPhone);
let IsGmail = class IsGmail {
    validate(text, args) {
        if (typeof text !== 'string')
            return false;
        return /^([a-zA-Z0-9]|\.|-|_)+(@gmail.com)$/.test(text);
    }
    defaultMessage(args) {
        return '$property must be a gmail address !';
    }
};
exports.IsGmail = IsGmail;
exports.IsGmail = IsGmail = __decorate([
    (0, class_validator_1.ValidatorConstraint)({ name: 'isGmail', async: false })
], IsGmail);
function IsNumberGreaterThan(options, validationOptions) {
    return function (object, propertyName) {
        (0, class_validator_1.registerDecorator)({
            name: 'isNumberGreaterThan',
            target: object.constructor,
            propertyName,
            constraints: [options],
            options: validationOptions,
            validator: {
                validate(value, args) {
                    const [options] = args.constraints;
                    return typeof value === 'number' && value > options;
                },
                defaultMessage(args) {
                    const [options] = args.constraints;
                    return `$property ($value) must be a number and greater than ${options}`;
                },
            },
        });
    };
}
function IsEnumValue(options, validationOptions) {
    return function (object, propertyName) {
        (0, class_validator_1.registerDecorator)({
            name: 'isEnumValue',
            target: object.constructor,
            propertyName,
            constraints: [options],
            options: validationOptions,
            validator: {
                validate(value, args) {
                    const [options] = args.constraints;
                    const valueOptions = (0, typescript_helper_1.valuesEnum)(options);
                    return valueOptions.includes(value);
                },
                defaultMessage(args) {
                    const [options] = args.constraints;
                    return `$property ($value) must be an enum ${(0, typescript_helper_1.stringEnum)(options)}`;
                },
            },
        });
    };
}


/***/ }),
/* 248 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.stringEnum = exports.objectEnum = exports.valuesEnum = exports.keysEnum = void 0;
const keysEnum = (e) => {
    return Object.keys(e).filter((key) => isNaN(parseInt(key)));
};
exports.keysEnum = keysEnum;
const valuesEnum = (e) => {
    return (0, exports.keysEnum)(e).map((key) => e[key]);
};
exports.valuesEnum = valuesEnum;
const objectEnum = (e) => {
    return (0, exports.keysEnum)(e).reduce((acc, key) => {
        acc[key] = e[key];
        return acc;
    }, {});
};
exports.objectEnum = objectEnum;
const stringEnum = (e) => {
    const str = (0, exports.keysEnum)(e)
        .map((key) => `${key}:${e[key]}`)
        .join(', ');
    return `{ ${str} }`;
};
exports.stringEnum = stringEnum;


/***/ }),
/* 249 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LoginRootBody = exports.LoginBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class LoginBody {
}
exports.LoginBody = LoginBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], LoginBody.prototype, "orgPhone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], LoginBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], LoginBody.prototype, "password", void 0);
class LoginRootBody extends LoginBody {
}
exports.LoginRootBody = LoginRootBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LoginRootBody.prototype, "oid", void 0);


/***/ }),
/* 250 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RefreshTokenBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RefreshTokenBody {
}
exports.RefreshTokenBody = RefreshTokenBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", String)
], RefreshTokenBody.prototype, "refreshToken", void 0);


/***/ }),
/* 251 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RegisterBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class RegisterBody {
}
exports.RegisterBody = RegisterBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'example-2@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], RegisterBody.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RegisterBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], RegisterBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], RegisterBody.prototype, "password", void 0);


/***/ }),
/* 252 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ResetPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ResetPasswordBody {
}
exports.ResetPasswordBody = ResetPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "organizationPhone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "password", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '$2b$05$G17lx6yO8fK2iJK6tqX2XODsCrawFzSht5vJQjE7wlDJO0.4zxPxO' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "token", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ResetPasswordBody.prototype, "updatedAt", void 0);


/***/ }),
/* 253 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeModule = void 0;
const common_1 = __webpack_require__(3);
const api_me_controller_1 = __webpack_require__(254);
const api_me_service_1 = __webpack_require__(255);
let ApiMeModule = class ApiMeModule {
};
exports.ApiMeModule = ApiMeModule;
exports.ApiMeModule = ApiMeModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_me_controller_1.ApiMeController],
        providers: [api_me_service_1.ApiMeService],
        exports: [],
    })
], ApiMeModule);


/***/ }),
/* 254 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const api_me_service_1 = __webpack_require__(255);
const request_1 = __webpack_require__(256);
let ApiMeController = class ApiMeController {
    constructor(apiUserService) {
        this.apiUserService = apiUserService;
    }
    async info({ oid, uid, permissionIds }) {
        return await this.apiUserService.info({ oid, uid, permissionIds });
    }
    async detail({ oid, uid }, body) {
        return await this.apiUserService.changePassword(oid, uid, body);
    }
    async updateInfo({ oid, uid }, body) {
        return await this.apiUserService.updateInfo(oid, uid, body);
    }
};
exports.ApiMeController = ApiMeController;
__decorate([
    (0, common_1.Get)('info'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiMeController.prototype, "info", null);
__decorate([
    (0, common_1.Patch)('change-password'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, typeof (_d = typeof request_1.UserChangePasswordBody !== "undefined" && request_1.UserChangePasswordBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiMeController.prototype, "detail", null);
__decorate([
    (0, common_1.Patch)('update-info'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.UserUpdateInfoBody !== "undefined" && request_1.UserUpdateInfoBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiMeController.prototype, "updateInfo", null);
exports.ApiMeController = ApiMeController = __decorate([
    (0, swagger_1.ApiTags)('Me'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('me'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_me_service_1.ApiMeService !== "undefined" && api_me_service_1.ApiMeService) === "function" ? _a : Object])
], ApiMeController);


/***/ }),
/* 255 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(243);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(226);
const user_repository_1 = __webpack_require__(90);
let ApiMeService = class ApiMeService {
    constructor(userRepository, cacheDataService) {
        this.userRepository = userRepository;
        this.cacheDataService = cacheDataService;
    }
    async info(params) {
        const { uid, oid, permissionIds } = params;
        const [user, organization, permissionAll, settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getUser(oid, uid),
            this.cacheDataService.getOrganization(oid),
            this.cacheDataService.getPermissionAllList(),
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        return {
            data: {
                user,
                organization,
                permissionIds,
                permissionAll,
                settingMap,
                settingMapRoot,
                rootSetting: settingMapRoot.ROOT_SETTING,
            },
        };
    }
    async changePassword(oid, id, body) {
        const { oldPassword, newPassword } = body;
        const user = await this.userRepository.findOneBy({ id, oid });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const checkPassword = await bcrypt.compare(oldPassword, user.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        const hashPassword = await bcrypt.hash(newPassword, 5);
        const secret = (0, string_helper_1.encrypt)(newPassword, user.username);
        await this.userRepository.update({ oid, id }, { hashPassword, secret });
        return { data: true };
    }
    async updateInfo(oid, id, body) {
        await this.userRepository.update({ oid, id }, {
            fullName: body.fullName,
            birthday: body.birthday,
            gender: body.gender,
            phone: body.phone,
        });
        const user = await this.userRepository.findOneBy({ oid, id });
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { user } };
    }
};
exports.ApiMeService = ApiMeService;
exports.ApiMeService = ApiMeService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object])
], ApiMeService);


/***/ }),
/* 256 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(257), exports);
__exportStar(__webpack_require__(258), exports);
__exportStar(__webpack_require__(260), exports);
__exportStar(__webpack_require__(261), exports);


/***/ }),
/* 257 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserChangePasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class UserChangePasswordBody {
}
exports.UserChangePasswordBody = UserChangePasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], UserChangePasswordBody.prototype, "oldPassword", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], UserChangePasswordBody.prototype, "newPassword", void 0);


/***/ }),
/* 258 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGetOneQuery = exports.UserGetManyQuery = exports.UserPaginationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const user_options_request_1 = __webpack_require__(260);
class UserPaginationQuery extends query_1.PaginationQuery {
}
exports.UserPaginationQuery = UserPaginationQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _a : Object)
], UserPaginationQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserSortQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserSortQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_options_request_1.UserSortQuery !== "undefined" && user_options_request_1.UserSortQuery) === "function" ? _b : Object)
], UserPaginationQuery.prototype, "sort", void 0);
class UserGetManyQuery {
}
exports.UserGetManyQuery = UserGetManyQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], UserGetManyQuery.prototype, "limit", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _c : Object)
], UserGetManyQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserRelationQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserRelationQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _d : Object)
], UserGetManyQuery.prototype, "relation", void 0);
class UserGetOneQuery {
}
exports.UserGetOneQuery = UserGetOneQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserRelationQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserRelationQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _e : Object)
], UserGetOneQuery.prototype, "relation", void 0);


/***/ }),
/* 259 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.MultiMongoIdQuery = exports.SortQuery = exports.LimitQuery = exports.PaginationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class PaginationQuery {
}
exports.PaginationQuery = PaginationQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => parseInt(value)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(1),
    __metadata("design:type", Number)
], PaginationQuery.prototype, "page", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => parseInt(value)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(3),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], PaginationQuery.prototype, "limit", void 0);
class LimitQuery {
}
exports.LimitQuery = LimitQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? parseInt(value) : undefined)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(3),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], LimitQuery.prototype, "limit", void 0);
class SortQuery {
}
exports.SortQuery = SortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], SortQuery.prototype, "id", void 0);
class MultiMongoIdQuery {
}
exports.MultiMongoIdQuery = MultiMongoIdQuery;
__decorate([
    (0, swagger_1.ApiProperty)({
        type: String,
        example: '63fdde9517a7317f0e8f959a,63fdde9517a7317f0e8f959a',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === null || value === void 0 ? void 0 : value.length)
            return value === null || value === void 0 ? void 0 : value.split(',');
        else
            return [];
    }),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsMongoId)({ each: true }),
    __metadata("design:type", Array)
], MultiMongoIdQuery.prototype, "ids", void 0);


/***/ }),
/* 260 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserSortQuery = exports.UserFilterQuery = exports.UserRelationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class UserRelationQuery {
}
exports.UserRelationQuery = UserRelationQuery;
class UserFilterQuery {
}
exports.UserFilterQuery = UserFilterQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[isActive]', example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (['1', 'true'].includes(value))
            return 1;
        if (['0', 'false'].includes(value))
            return 0;
        return undefined;
    }),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[fullName]' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[phone]' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "phone", void 0);
class UserSortQuery extends query_1.SortQuery {
}
exports.UserSortQuery = UserSortQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'sort[fullName]', enum: ['ASC', 'DESC'], example: 'DESC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 261 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserUpdateInfoBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class UserUpdateInfoBody {
}
exports.UserUpdateInfoBody = UserUpdateInfoBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], UserUpdateInfoBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UserUpdateInfoBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], UserUpdateInfoBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], UserUpdateInfoBody.prototype, "gender", void 0);


/***/ }),
/* 262 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_customer_module_1 = __webpack_require__(263);
const api_file_product_module_1 = __webpack_require__(268);
const api_file_receipt_module_1 = __webpack_require__(277);
const api_file_ticket_module_1 = __webpack_require__(281);
let ApiFileModule = class ApiFileModule {
};
exports.ApiFileModule = ApiFileModule;
exports.ApiFileModule = ApiFileModule = __decorate([
    (0, common_1.Module)({
        imports: [api_file_product_module_1.ApiFileProductModule, api_file_receipt_module_1.ApiFileReceiptModule, api_file_customer_module_1.ApiFileCustomerModule, api_file_ticket_module_1.ApiFileTicketModule],
        controllers: [],
        providers: [],
    })
], ApiFileModule);


/***/ }),
/* 263 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_customer_controller_1 = __webpack_require__(264);
const api_file_customer_download_excel_1 = __webpack_require__(265);
let ApiFileCustomerModule = class ApiFileCustomerModule {
};
exports.ApiFileCustomerModule = ApiFileCustomerModule;
exports.ApiFileCustomerModule = ApiFileCustomerModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_customer_controller_1.ApiFileCustomerController],
        providers: [api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel],
    })
], ApiFileCustomerModule);


/***/ }),
/* 264 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_file_customer_download_excel_1 = __webpack_require__(265);
let ApiFileCustomerController = class ApiFileCustomerController {
    constructor(apiFileCustomerDownloadExcel) {
        this.apiFileCustomerDownloadExcel = apiFileCustomerDownloadExcel;
    }
    async downloadExcel({ user, organization }) {
        return await this.apiFileCustomerDownloadExcel.downloadExcel({ organization, user });
    }
};
exports.ApiFileCustomerController = ApiFileCustomerController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_CUSTOMER_DOWNLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiFileCustomerController.prototype, "downloadExcel", null);
exports.ApiFileCustomerController = ApiFileCustomerController = __decorate([
    (0, swagger_1.ApiTags)('FileCustomer'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-customer'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel !== "undefined" && api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel) === "function" ? _a : Object])
], ApiFileCustomerController);


/***/ }),
/* 265 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const time_helper_1 = __webpack_require__(146);
const customer_repository_1 = __webpack_require__(175);
const excel_one_sheet_util_1 = __webpack_require__(266);
let ApiFileCustomerDownloadExcel = class ApiFileCustomerDownloadExcel {
    constructor(customerRepository) {
        this.customerRepository = customerRepository;
    }
    async downloadExcel(options) {
        const { user, organization } = options;
        const customerList = await this.customerRepository.findMany({
            condition: { oid: organization.id, isActive: 1 },
            sort: { id: 'ASC' },
        });
        const workbook = this.getWorkbookProduct(customerList, {
            orgName: organization.name,
            orgPhone: organization.phone,
            orgAddress: [
                organization.addressWard,
                organization.addressDistrict,
                organization.addressProvince,
            ]
                .filter((i) => !!i)
                .join(' - ')
                .replace('Tỉnh', '')
                .replace('Thành phố', '')
                .replace('Quận ', '')
                .replace('Huyện ', '')
                .replace('Phường ', '')
                .replace('Xã ', ''),
            userFullName: user.fullName,
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA-khach-hang.xlsx',
            },
        };
    }
    getWorkbookProduct(customerList, meta) {
        const dataRows = [];
        customerList.forEach((customer, index) => {
            dataRows.push({
                style: {
                    num: { alignment: { horizontal: 'center' } },
                    id: { alignment: { horizontal: 'center' } },
                    fullName: { alignment: { wrapText: true } },
                    phone: { alignment: { horizontal: 'center' } },
                    debt: { numFmt: '###,##0' },
                    birthday: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy' },
                    gender: { alignment: { horizontal: 'center' } },
                    addressProvince: { alignment: { wrapText: true } },
                    addressDistrict: { alignment: { wrapText: true } },
                    addressWard: { alignment: { wrapText: true } },
                    note: { alignment: { wrapText: true } },
                },
                data: [
                    {
                        num: index + 1,
                        id: 'KH' + customer.id,
                        fullName: customer.fullName || '',
                        phone: customer.phone || '',
                        debt: customer.debt || 0,
                        birthday: customer.birthday ? new Date(customer.birthday + 7 * 60 * 60 * 1000) : '',
                        gender: { 0: 'Nữ', 1: 'Nam' }[customer.gender] || '',
                        addressProvince: customer.addressProvince || '',
                        addressDistrict: customer.addressDistrict || '',
                        addressWard: customer.addressWard || '',
                        note: customer.note || '',
                    },
                ],
            });
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                worksheet.addRow([meta.orgName]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgPhone]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgAddress]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow(['BÁO CÁO KHÁCH HÀNG']).eachCell((cell) => {
                    cell.font = {
                        size: 16,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(4, 1, 4, 12);
                worksheet
                    .addRow([`Thời gian: ${time_helper_1.ESTimer.timeToText(new Date(), 'hh:mm:ss DD/MM/YYYY', 7)}`])
                    .eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        italic: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(5, 1, 5, 12);
                worksheet
                    .addRow(['Số khách hàng', '', customerList.length])
                    .eachCell({ includeEmpty: true }, (cell, colNumber) => {
                    cell.style = {
                        border: {
                            top: { style: 'thin' },
                            left: { style: 'thin' },
                            bottom: { style: 'thin' },
                            right: { style: 'thin' },
                        },
                        font: {
                            size: 12,
                            bold: false,
                            name: 'Times New Roman',
                        },
                        alignment: { wrapText: true, vertical: 'middle' },
                    };
                    if (colNumber === 3) {
                        cell.font.bold = true;
                        cell.style.numFmt = '###,##0';
                    }
                });
                worksheet.mergeCells(6, 1, 6, 2);
                worksheet
                    .addRow(['Tổng nợ', '', customerList.reduce((acc, cur) => acc + cur.debt, 0)])
                    .eachCell({ includeEmpty: true }, (cell, colNumber) => {
                    cell.style = {
                        border: {
                            top: { style: 'thin' },
                            left: { style: 'thin' },
                            bottom: { style: 'thin' },
                            right: { style: 'thin' },
                        },
                        font: {
                            size: 12,
                            bold: false,
                            name: 'Times New Roman',
                        },
                        alignment: { wrapText: true, vertical: 'middle' },
                    };
                    if (colNumber === 3) {
                        cell.font.bold = true;
                        cell.style.numFmt = '###,##0';
                    }
                });
                worksheet.mergeCells(7, 1, 7, 2);
                worksheet.addRow([]);
                const rowTitle = worksheet.addRow([
                    'STT',
                    'ID',
                    'Tên',
                    'SĐT',
                    'Nợ',
                    'Ngày sinh',
                    'Giới tính',
                    'Tỉnh/TP',
                    'Quận/Huyện',
                    'Phường/Xã',
                    'Ghi chú',
                ]);
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: [
                { key: 'num', width: 5 },
                { key: 'id', width: 10 },
                { key: 'fullName', width: 40 },
                { key: 'phone', width: 15 },
                { key: 'debt', width: 10 },
                { key: 'birthday', width: 15 },
                { key: 'gender', width: 10 },
                { key: 'addressProvince', width: 20 },
                { key: 'addressDistrict', width: 20 },
                { key: 'addressWard', width: 20 },
                { key: 'note', width: 30 },
            ],
            rows: dataRows,
            footerSheet: (worksheet) => {
                worksheet.addRow(['']);
                worksheet.addRow([`Người xuất báo cáo: ${meta.userFullName}`]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        italic: true,
                        name: 'Times New Roman',
                    };
                });
            },
        });
        return workbook;
    }
};
exports.ApiFileCustomerDownloadExcel = ApiFileCustomerDownloadExcel;
exports.ApiFileCustomerDownloadExcel = ApiFileCustomerDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof customer_repository_1.CustomerRepository !== "undefined" && customer_repository_1.CustomerRepository) === "function" ? _a : Object])
], ApiFileCustomerDownloadExcel);


/***/ }),
/* 266 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.excelOneSheetWorkbook = void 0;
const exceljs_1 = __webpack_require__(267);
const object_helper_1 = __webpack_require__(91);
const excelOneSheetWorkbook = (params) => {
    const { headerSheet, footerSheet, rows, layout, columns } = params;
    const sheetName = layout.sheetName || 'SHEET';
    const workbook = new exceljs_1.Workbook();
    const worksheet = workbook.addWorksheet(sheetName, {
        views: [{ showGridLines: false }],
        pageSetup: {
            orientation: 'portrait',
            fitToPage: true,
            margins: {
                left: 0.25,
                right: 0.25,
                top: 0.75,
                bottom: 0.75,
                header: 0.3,
                footer: 0.3,
            },
        },
        properties: { tabColor: { argb: '6B5B95' }, defaultRowHeight: 18.75 },
    });
    worksheet.columns = columns.map((col) => ({
        key: col.key,
        width: col.width,
    }));
    if (headerSheet && typeof headerSheet === 'function') {
        headerSheet(worksheet);
    }
    rows.forEach((row, index) => {
        row.data.forEach((item) => {
            const currentRow = worksheet.addRow(item);
            currentRow.eachCell((cell) => {
                var _a, _b;
                const keyColumn = cell._column._key;
                const style = {
                    border: {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    },
                    font: {
                        size: 12,
                        bold: false,
                        name: 'Times New Roman',
                    },
                    alignment: { wrapText: true, vertical: 'middle' },
                };
                const styleAll = ((_a = row.style) === null || _a === void 0 ? void 0 : _a['_all']) || {};
                const styleCurrent = ((_b = row.style) === null || _b === void 0 ? void 0 : _b[keyColumn]) || {};
                (0, object_helper_1.mergeObject)(style, styleAll, styleCurrent);
                if (style.mergeCells) {
                    const { value } = cell;
                    const endRow = Number(cell.row);
                    const startRow = endRow - (style.mergeCells.rowspan - 1);
                    const startColumn = Number(cell.col);
                    const endColumn = startColumn + (style.mergeCells.colspan - 1);
                    worksheet.mergeCells(startRow, startColumn, endRow, endColumn);
                    cell = worksheet.getCell(startRow, startColumn);
                    cell.value = value;
                }
                cell.style = style;
            });
        });
    });
    if (footerSheet && typeof footerSheet === 'function') {
        footerSheet(worksheet);
    }
    return workbook;
};
exports.excelOneSheetWorkbook = excelOneSheetWorkbook;


/***/ }),
/* 267 */
/***/ ((module) => {

module.exports = require("exceljs");

/***/ }),
/* 268 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_product_controller_1 = __webpack_require__(269);
const api_file_product_download_excel_1 = __webpack_require__(275);
const api_file_product_upload_excel_1 = __webpack_require__(276);
let ApiFileProductModule = class ApiFileProductModule {
};
exports.ApiFileProductModule = ApiFileProductModule;
exports.ApiFileProductModule = ApiFileProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_product_controller_1.ApiFileProductController],
        providers: [api_file_product_download_excel_1.ApiFileProductDownloadExcel, api_file_product_upload_excel_1.ApiFileProductUploadExcel],
    })
], ApiFileProductModule);


/***/ }),
/* 269 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(270);
const permission_guard_1 = __webpack_require__(93);
const interceptor_1 = __webpack_require__(271);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_file_product_download_excel_1 = __webpack_require__(275);
const api_file_product_upload_excel_1 = __webpack_require__(276);
let ApiFileProductController = class ApiFileProductController {
    constructor(apiFileProductDownloadExcel, apiFileProductUploadExcel) {
        this.apiFileProductDownloadExcel = apiFileProductDownloadExcel;
        this.apiFileProductUploadExcel = apiFileProductUploadExcel;
    }
    async downloadExcel({ user, organization }) {
        return await this.apiFileProductDownloadExcel.downloadExcel({ organization, user });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileProductUploadExcel.fileExample();
    }
    async uploadExcel({ user, oid }, file, body) {
        return await this.apiFileProductUploadExcel.uploadExcel({ oid, user, file });
    }
};
exports.ApiFileProductController = ApiFileProductController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_PRODUCT_DOWNLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('upload-excel/file-example'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_PRODUCT_UPLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_PRODUCT_UPLOAD_EXCEL),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "uploadExcel", null);
exports.ApiFileProductController = ApiFileProductController = __decorate([
    (0, swagger_1.ApiTags)('FileProduct'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_product_download_excel_1.ApiFileProductDownloadExcel !== "undefined" && api_file_product_download_excel_1.ApiFileProductDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_product_upload_excel_1.ApiFileProductUploadExcel !== "undefined" && api_file_product_upload_excel_1.ApiFileProductUploadExcel) === "function" ? _b : Object])
], ApiFileProductController);


/***/ }),
/* 270 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SingleFileUpload = exports.MultipleFileUpload = void 0;
const swagger_1 = __webpack_require__(6);
class MultipleFileUpload {
}
exports.MultipleFileUpload = MultipleFileUpload;
__decorate([
    (0, swagger_1.ApiProperty)({ type: Array, format: 'binary' }),
    __metadata("design:type", Array)
], MultipleFileUpload.prototype, "files", void 0);
class SingleFileUpload {
}
exports.SingleFileUpload = SingleFileUpload;
__decorate([
    (0, swagger_1.ApiProperty)({ type: 'string', format: 'binary' }),
    __metadata("design:type", String)
], SingleFileUpload.prototype, "file", void 0);


/***/ }),
/* 271 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(25), exports);
__exportStar(__webpack_require__(272), exports);
__exportStar(__webpack_require__(274), exports);
__exportStar(__webpack_require__(27), exports);
__exportStar(__webpack_require__(28), exports);


/***/ }),
/* 272 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.FastifyFileInterceptor = FastifyFileInterceptor;
const common_1 = __webpack_require__(3);
const fastify_multer_1 = __webpack_require__(7);
const multer_1 = __webpack_require__(273);
function FastifyFileInterceptor(fieldName, localOptions) {
    var _a;
    let MixinInterceptor = class MixinInterceptor {
        constructor(options) {
            this.multer = fastify_multer_1.default(Object.assign(Object.assign({}, options), localOptions));
        }
        async intercept(context, next) {
            const ctx = context.switchToHttp();
            await new Promise((resolve, reject) => {
                return this.multer.single(fieldName)(ctx.getRequest(), ctx.getResponse(), (error) => {
                    if (error) {
                        return reject(error);
                    }
                    resolve();
                });
            });
            return next.handle();
        }
    };
    MixinInterceptor = __decorate([
        __param(0, (0, common_1.Optional)()),
        __param(0, (0, common_1.Inject)('MULTER_MODULE_OPTIONS')),
        __metadata("design:paramtypes", [typeof (_a = typeof multer_1.Multer !== "undefined" && multer_1.Multer) === "function" ? _a : Object])
    ], MixinInterceptor);
    const Interceptor = (0, common_1.mixin)(MixinInterceptor);
    return Interceptor;
}


/***/ }),
/* 273 */
/***/ ((module) => {

module.exports = require("multer");

/***/ }),
/* 274 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.FastifyFilesInterceptor = FastifyFilesInterceptor;
const common_1 = __webpack_require__(3);
const fastify_multer_1 = __webpack_require__(7);
const multer_1 = __webpack_require__(273);
function FastifyFilesInterceptor(fieldName, maxCount, localOptions) {
    var _a;
    let MixinInterceptor = class MixinInterceptor {
        constructor(options) {
            this.multer = fastify_multer_1.default(Object.assign(Object.assign({}, options), localOptions));
        }
        async intercept(context, next) {
            const ctx = context.switchToHttp();
            await new Promise((resolve, reject) => {
                return this.multer.array(fieldName, maxCount)(ctx.getRequest(), ctx.getResponse(), (error) => {
                    if (error) {
                        return reject(error);
                    }
                    resolve();
                });
            });
            return next.handle();
        }
    };
    MixinInterceptor = __decorate([
        __param(0, (0, common_1.Optional)()),
        __param(0, (0, common_1.Inject)('MULTER_MODULE_OPTIONS')),
        __metadata("design:paramtypes", [typeof (_a = typeof multer_1.Multer !== "undefined" && multer_1.Multer) === "function" ? _a : Object])
    ], MixinInterceptor);
    const Interceptor = (0, common_1.mixin)(MixinInterceptor);
    return Interceptor;
}


/***/ }),
/* 275 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const object_helper_1 = __webpack_require__(91);
const time_helper_1 = __webpack_require__(146);
const repositories_1 = __webpack_require__(170);
const excel_one_sheet_util_1 = __webpack_require__(266);
let ApiFileProductDownloadExcel = class ApiFileProductDownloadExcel {
    constructor(productRepository, productGroupRepository, batchRepository) {
        this.productRepository = productRepository;
        this.productGroupRepository = productGroupRepository;
        this.batchRepository = batchRepository;
    }
    async downloadExcel(options) {
        const { user, organization } = options;
        const productList = await this.productRepository.findMany({
            condition: { oid: organization.id, isActive: 1 },
            sort: { id: 'ASC' },
        });
        const productGroupAll = await this.productGroupRepository.findManyBy({});
        const productGroupMap = object_helper_1.ESArray.arrayToKeyValue(productGroupAll, 'id');
        const batchList = await this.batchRepository.findMany({
            condition: { oid: organization.id, quantity: { NOT: 0 } },
        });
        const batchListMapProductId = object_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        productList.forEach((product) => {
            product.batchList = batchListMapProductId[product.id] || [];
            product.productGroup = productGroupMap[product.productGroupId];
        });
        const workbook = this.getWorkbookProduct(productList, {
            orgName: organization.name,
            orgPhone: organization.phone,
            orgAddress: [
                organization.addressWard,
                organization.addressDistrict,
                organization.addressProvince,
            ]
                .filter((i) => !!i)
                .join(' - ')
                .replace('Tỉnh', '')
                .replace('Thành phố', '')
                .replace('Quận ', '')
                .replace('Huyện ', '')
                .replace('Phường ', '')
                .replace('Xã ', ''),
            userFullName: user.fullName,
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA-san-pham.xlsx',
            },
        };
    }
    getWorkbookProduct(productList, meta) {
        const dataRows = [];
        productList.forEach((product, productIndex) => {
            var _a, _b;
            const unitArray = JSON.parse(product.unit || '[]');
            const unitNameBasic = ((_a = unitArray.find((i) => i.rate === 1)) === null || _a === void 0 ? void 0 : _a.name) || '';
            if (product.batchList.length === 0) {
                dataRows.push({
                    style: {
                        num: { alignment: { horizontal: 'center' } },
                        productCode: { alignment: { horizontal: 'center' } },
                        brandName: { alignment: { wrapText: true } },
                        substance: { alignment: { wrapText: true } },
                        batchCode: { alignment: { horizontal: 'center' } },
                        expiryDate: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy' },
                        quantity: { numFmt: '###,##0', font: { bold: true } },
                        costPrice: { numFmt: '###,##0' },
                        wholesalePrice: { numFmt: '###,##0' },
                        retailPrice: { numFmt: '###,##0' },
                        group: {},
                        unit: { alignment: { horizontal: 'center' } },
                        route: { alignment: { horizontal: 'center' } },
                    },
                    data: [
                        {
                            num: productIndex + 1,
                            productCode: product.productCode,
                            brandName: product.brandName || '',
                            substance: product.substance || '',
                            batchCode: '',
                            expiryDate: '',
                            quantity: product.quantity || 0,
                            costPrice: product.costPrice || 0,
                            wholesalePrice: product.wholesalePrice || 0,
                            retailPrice: product.retailPrice || 0,
                            group: ((_b = product.productGroup) === null || _b === void 0 ? void 0 : _b.name) || '',
                            unit: unitNameBasic,
                            route: product.route || '',
                            source: product.source || '',
                        },
                    ],
                });
            }
            else {
                product.batchList.forEach((batch, batchIndex) => {
                    var _a;
                    dataRows.push({
                        style: {
                            num: { alignment: { horizontal: 'center' } },
                            productCode: { alignment: { horizontal: 'center' } },
                            brandName: { alignment: { wrapText: true } },
                            substance: { alignment: { wrapText: true } },
                            batchCode: { alignment: { horizontal: 'center' } },
                            expiryDate: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy' },
                            quantity: { font: { bold: true } },
                            costPrice: { numFmt: '###,##0' },
                            wholesalePrice: { numFmt: '###,##0' },
                            retailPrice: { numFmt: '###,##0' },
                            group: {},
                            unit: { alignment: { horizontal: 'center' } },
                            route: { alignment: { horizontal: 'center' } },
                        },
                        data: [
                            {
                                num: productIndex + 1,
                                productCode: product.productCode,
                                brandName: product.brandName || '',
                                substance: product.substance || '',
                                batchCode: batch.batchCode || '',
                                expiryDate: batch.expiryDate ? new Date(batch.expiryDate + 7 * 60 * 60 * 1000) : '',
                                quantity: batch.quantity || 0,
                                costPrice: batch.costPrice || 0,
                                wholesalePrice: product.wholesalePrice || 0,
                                retailPrice: product.retailPrice || 0,
                                group: ((_a = product.productGroup) === null || _a === void 0 ? void 0 : _a.name) || '',
                                unit: unitNameBasic,
                                route: product.route || '',
                                source: product.source || '',
                            },
                        ],
                    });
                });
            }
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                worksheet.addRow([meta.orgName]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgPhone]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgAddress]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow(['BÁO CÁO TỒN KHO']).eachCell((cell) => {
                    cell.font = {
                        size: 16,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(4, 1, 4, 15);
                worksheet
                    .addRow([`Thời gian: ${time_helper_1.ESTimer.timeToText(new Date(), 'hh:mm:ss DD/MM/YYYY', 7)}`])
                    .eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        italic: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(5, 1, 5, 15);
                worksheet.addRow([]);
                const rowTitle = worksheet.addRow([
                    'STT',
                    'Mã SP',
                    'Tên sản phẩm',
                    'Hoạt chất',
                    'Lô',
                    'HSD',
                    'Số Lượng',
                    'Giá nhập',
                    'Giá bán sỉ',
                    'Giá bán lẻ',
                    'Nhóm',
                    'Đơn vị',
                    'Đường dùng',
                    'Nguồn gốc',
                ]);
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: [
                { key: 'num', width: 5 },
                { key: 'productCode', width: 10 },
                { key: 'brandName', width: 30 },
                { key: 'substance', width: 30 },
                { key: 'batchCode', width: 10 },
                { key: 'expiryDate', width: 10 },
                { key: 'quantity', width: 10 },
                { key: 'costPrice', width: 10 },
                { key: 'wholesalePrice', width: 10 },
                { key: 'retailPrice', width: 10 },
                { key: 'group', width: 20 },
                { key: 'unit', width: 10 },
                { key: 'route', width: 10 },
                { key: 'source', width: 20 },
            ],
            rows: dataRows,
            footerSheet: (worksheet) => {
                worksheet.addRow(['']);
                worksheet.addRow([`Người xuất báo cáo: ${meta.userFullName}`]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        italic: true,
                        name: 'Times New Roman',
                    };
                });
            },
        });
        return workbook;
    }
};
exports.ApiFileProductDownloadExcel = ApiFileProductDownloadExcel;
exports.ApiFileProductDownloadExcel = ApiFileProductDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductGroupRepository !== "undefined" && repositories_1.ProductGroupRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _c : Object])
], ApiFileProductDownloadExcel);


/***/ }),
/* 276 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const exceljs_1 = __webpack_require__(267);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const product_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(170);
const excel_one_sheet_util_1 = __webpack_require__(266);
const ProductExcelRules = [
    {
        column: 'A',
        width: 5,
        title: 'STT',
        example: 1,
        required: true,
    },
    {
        column: 'B',
        width: 15,
        title: 'Mã sản phẩm',
        type: 'string',
        example: 'SP002',
        required: true,
    },
    {
        column: 'C',
        width: 40,
        title: 'Tên sản phẩm',
        type: 'string',
        example: 'Augmentin 1g',
        required: true,
    },
    {
        column: 'D',
        width: 40,
        title: 'Hoạt chất',
        type: 'string',
        example: 'Amoxicillin 875m + Clavulanic acid 125mg',
    },
    {
        column: 'E',
        width: 15,
        title: 'Giá nhập',
        type: 'number',
        example: 80000,
    },
    {
        column: 'F',
        width: 15,
        title: 'Giá bán',
        type: 'number',
        example: 100000,
    },
    {
        column: 'G',
        width: 15,
        title: 'Đơn vị',
        type: 'string',
        example: 'Viên',
    },
    {
        column: 'H',
        width: 15,
        title: 'Đường dùng',
        type: 'string',
        example: 'Uống',
    },
    {
        column: 'I',
        width: 15,
        title: 'Nguồn gốc',
        type: 'string',
        example: 'Đức',
    },
];
let ApiFileProductUploadExcel = class ApiFileProductUploadExcel {
    constructor(productRepository) {
        this.productRepository = productRepository;
    }
    async fileExample() {
        const dataRows = [];
        const rowTitleExample = {};
        const rowTitleStyle = {};
        ProductExcelRules.forEach((rule) => {
            rowTitleExample[rule.column] = rule.title;
            rowTitleStyle[rule.column] = { alignment: { horizontal: 'center' }, font: { bold: true } };
        });
        dataRows.push({
            style: rowTitleStyle,
            data: [rowTitleExample],
        });
        const rowDataExample = {};
        ProductExcelRules.forEach((rule) => {
            rowDataExample[rule.column] = rule.example;
        });
        dataRows.push({
            data: [rowDataExample],
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            columns: ProductExcelRules.map((rule) => {
                return {
                    key: rule.column,
                    width: rule.width,
                };
            }),
            rows: dataRows,
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA-file-upload-san-pham-demo.xlsx',
            },
        };
    }
    async uploadExcel(options) {
        const { oid, user, file } = options;
        const validTypes = [
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'application/vnd.ms-excel',
            'application/wps-office.xlsx',
        ];
        const isValidType = validTypes.includes(file.mimetype);
        if (!isValidType) {
            throw new exception_filter_1.BusinessException('Chỉ chấp nhận file excel');
        }
        if (file.size > 5 * 1024 * 1024) {
            throw new exception_filter_1.BusinessException('Chỉ chấp nhận file dưới 5MB');
        }
        const workbook = new exceljs_1.Workbook();
        await workbook.xlsx.load(file.buffer);
        const worksheet = workbook.worksheets[0];
        const productPrepareList = [];
        worksheet.eachRow((row, rowNumber) => {
            if (!row.hasValues)
                return;
            if (rowNumber === 1) {
                const titleList = row.values.slice(1);
                titleList.forEach((t, index) => {
                    const rule = ProductExcelRules[index];
                    if (t !== rule.title) {
                        const msg = `Hàng ${rowNumber}, tiêu đề không đúng, cột ${rule.column} cần có tên là ${rule.title}`;
                        throw new exception_filter_1.BusinessException(msg);
                    }
                });
                return;
            }
            const values = row.values.slice(1);
            values.forEach((v, index) => {
                const rule = ProductExcelRules[index];
                const msgPrefix = `Hàng ${rowNumber}, STT ${values[0]} không đúng: `;
                if (rule.type && typeof v !== rule.type) {
                    const msg = `${msgPrefix} cột ${rule.title} cần có định dạng là ${rule.type}`;
                    throw new exception_filter_1.BusinessException(msg);
                }
                if (rule.required && v == null) {
                    const msg = `${msgPrefix} cột ${rule.title} không được để trống`;
                    throw new exception_filter_1.BusinessException(msg);
                }
                if (!values[1]) {
                    throw new exception_filter_1.BusinessException(`Mã sản phẩm không được để trống ở dòng ${index + 2}`);
                }
            });
            const productNew = {
                oid,
                productCode: values[1],
                brandName: values[2],
                substance: values[3],
                costPrice: values[4],
                retailPrice: values[5],
                unit: JSON.stringify([{ name: values[6], rate: 1, default: true }]),
                route: values[7],
                source: values[8],
                quantity: 0,
                hintUsage: '',
                productGroupId: 0,
                warehouseIds: JSON.stringify([0]),
                isActive: 1,
                wholesalePrice: 0,
                image: '',
                pickupStrategy: variable_1.PickupStrategy.Inherit,
                splitBatchByWarehouse: product_entity_1.SplitBatchByWarehouse.Inherit,
                splitBatchByDistributor: product_entity_1.SplitBatchByDistributor.Inherit,
                splitBatchByExpiryDate: product_entity_1.SplitBatchByExpiryDate.Inherit,
                splitBatchByCostPrice: product_entity_1.SplitBatchByCostPrice.Inherit,
            };
            productPrepareList.push(productNew);
        });
        const duplicatesProductCode = object_helper_1.ESArray.checkDuplicate(productPrepareList, 'productCode');
        if (duplicatesProductCode.length) {
            const { value } = duplicatesProductCode[0];
            const indices = duplicatesProductCode[0].indices.map((i) => i + 2);
            throw new exception_filter_1.BusinessException(`Có trùng lặp productCode = ${value} ở dòng ${indices.toString()}`);
        }
        const productList = await this.productRepository.upsertByConflictUnique({
            upsertList: productPrepareList,
            updateFields: ['brandName', 'substance', 'route'],
            conflictFields: ['oid', 'productCode'],
        });
        return { data: { productIdList: productList.map((i) => i.id) } };
    }
};
exports.ApiFileProductUploadExcel = ApiFileProductUploadExcel;
exports.ApiFileProductUploadExcel = ApiFileProductUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _a : Object])
], ApiFileProductUploadExcel);


/***/ }),
/* 277 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileReceiptModule = void 0;
const common_1 = __webpack_require__(3);
const api_receipt_service_1 = __webpack_require__(278);
const api_file_receipt_controller_1 = __webpack_require__(279);
const api_file_receipt_upload_excel_1 = __webpack_require__(280);
let ApiFileReceiptModule = class ApiFileReceiptModule {
};
exports.ApiFileReceiptModule = ApiFileReceiptModule;
exports.ApiFileReceiptModule = ApiFileReceiptModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_receipt_controller_1.ApiFileReceiptController],
        providers: [api_file_receipt_upload_excel_1.ApiFileReceiptUploadExcel, api_receipt_service_1.ApiReceiptService],
    })
], ApiFileReceiptModule);


/***/ }),
/* 278 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const entities_1 = __webpack_require__(43);
const payment_entity_1 = __webpack_require__(48);
const product_entity_1 = __webpack_require__(54);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const batch_repository_1 = __webpack_require__(172);
const receipt_repository_1 = __webpack_require__(193);
let ApiReceiptService = class ApiReceiptService {
    constructor(cacheDataService, receiptRepository, productRepository, batchRepository, receiptDraft, receiptDepositedOperation, paymentRepository) {
        this.cacheDataService = cacheDataService;
        this.receiptRepository = receiptRepository;
        this.productRepository = productRepository;
        this.batchRepository = batchRepository;
        this.receiptDraft = receiptDraft;
        this.receiptDepositedOperation = receiptDepositedOperation;
        this.paymentRepository = paymentRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { startedAt, distributorId, status } = query.filter || {};
        const { total, data } = await this.receiptRepository.pagination({
            page: query.page,
            limit: query.limit,
            condition: {
                oid,
                distributorId,
                status,
                startedAt,
            },
            relation: {
                distributor: relation === null || relation === void 0 ? void 0 : relation.distributor,
                receiptItemList: relation === null || relation === void 0 ? void 0 : relation.receiptItemList,
            },
            sort: query.sort || { id: 'DESC' },
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { relation, limit } = query;
        const { startedAt, distributorId, status } = query.filter || {};
        const receiptList = await this.receiptRepository.findMany({
            condition: {
                oid,
                distributorId,
                status,
                startedAt,
            },
            limit,
            relation: { distributor: relation === null || relation === void 0 ? void 0 : relation.distributor },
        });
        return { data: receiptList };
    }
    async getOne(oid, receiptId, { relation }) {
        const receipt = await this.receiptRepository.findOne({
            condition: { oid, id: receiptId },
            relation: {
                distributor: !!(relation === null || relation === void 0 ? void 0 : relation.distributor),
                receiptItemList: relation === null || relation === void 0 ? void 0 : relation.receiptItemList,
            },
            relationLoadStrategy: 'query',
        });
        if (!receipt) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (relation.paymentList) {
            receipt.paymentList = await this.paymentRepository.findMany({
                condition: { oid, voucherId: receiptId, voucherType: payment_entity_1.VoucherType.Receipt },
                sort: { id: 'ASC' },
            });
        }
        return { data: { receipt } };
    }
    async queryOne(oid, receiptId, { relation }) {
        const receipt = await this.receiptRepository.queryOneBy({ oid, id: receiptId }, {
            distributor: !!(relation === null || relation === void 0 ? void 0 : relation.distributor),
            receiptItemList: relation === null || relation === void 0 ? void 0 : relation.receiptItemList,
        });
        return { data: receipt };
    }
    async createDraft(params) {
        const { oid, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { receipt: receiptBody, receiptItemList, distributorId } = body;
        const productIdList = receiptItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = object_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique } }),
            this.batchRepository.findManyBy({ oid, productId: { IN: productIdUnique } }),
        ]);
        const batchListMap = object_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = object_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        receiptItemList.forEach((receiptItem, index) => {
            if (receiptItem.batchId)
                return;
            const batchFind = (batchListMap[receiptItem.productId] || []).find((batch) => {
                const product = productMap[receiptItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != receiptItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != receiptItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != receiptItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                receiptItem.batchId = batchFind.id;
            }
        });
        const receiptItemListNoBatch = receiptItemList.filter((i) => !i.batchId);
        const batchInsertList = receiptItemListNoBatch.map((receiptItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: receiptItem.productId,
                warehouseId: receiptItem.warehouseId,
                batchCode: receiptItem.batchCode,
                expiryDate: receiptItem.expiryDate,
                costPrice: receiptItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        receiptItemListNoBatch.forEach((receiptItem, index) => {
            receiptItem.batchId = batchIdInsertList[index];
        });
        try {
            const { receipt } = await this.receiptDraft.createDraft({
                oid,
                receiptInsertDto: Object.assign(Object.assign({}, receiptBody), { distributorId }),
                receiptItemListDto: receiptItemList,
            });
            return { data: { receiptId: receipt.id } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async updateDraft(params) {
        const { oid, receiptId, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { receipt: receiptBody, receiptItemList, distributorId } = body;
        const productIdList = receiptItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = object_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique } }),
            this.batchRepository.findManyBy({ oid, productId: { IN: productIdUnique } }),
        ]);
        const batchListMap = object_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = object_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        receiptItemList.forEach((receiptItem, index) => {
            if (receiptItem.batchId)
                return;
            const batchFind = (batchListMap[receiptItem.productId] || []).find((batch) => {
                const product = productMap[receiptItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != receiptItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != receiptItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != receiptItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                receiptItem.batchId = batchFind.id;
            }
        });
        const receiptItemListNoBatch = receiptItemList.filter((i) => !i.batchId);
        const batchInsertList = receiptItemListNoBatch.map((receiptItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: receiptItem.productId,
                warehouseId: receiptItem.warehouseId,
                batchCode: receiptItem.batchCode,
                expiryDate: receiptItem.expiryDate,
                costPrice: receiptItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        receiptItemListNoBatch.forEach((receiptItem, index) => {
            receiptItem.batchId = batchIdInsertList[index];
        });
        try {
            await this.receiptDraft.updateDraft({
                oid,
                receiptId,
                receiptUpdateDto: Object.assign(Object.assign({}, receiptBody), { distributorId }),
                receiptItemListDto: receiptItemList,
            });
            return { data: { receiptId } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async depositedUpdate(params) {
        const { oid, receiptId, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { receipt: receiptDto, receiptItemList, distributorId } = body;
        const productIdList = receiptItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = object_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique } }),
            this.batchRepository.findManyBy({ oid, productId: { IN: productIdUnique } }),
        ]);
        const batchListMap = object_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = object_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        receiptItemList.forEach((receiptItem, index) => {
            if (receiptItem.batchId)
                return;
            const batchFind = (batchListMap[receiptItem.productId] || []).find((batch) => {
                const product = productMap[receiptItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != receiptItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != receiptItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != receiptItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                receiptItem.batchId = batchFind.id;
            }
        });
        const receiptItemListNoBatch = receiptItemList.filter((i) => !i.batchId);
        const batchInsertList = receiptItemListNoBatch.map((receiptItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: receiptItem.productId,
                warehouseId: receiptItem.warehouseId,
                batchCode: receiptItem.batchCode,
                expiryDate: receiptItem.expiryDate,
                costPrice: receiptItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        receiptItemListNoBatch.forEach((receiptItem, index) => {
            receiptItem.batchId = batchIdInsertList[index];
        });
        try {
            await this.receiptDepositedOperation.update({
                oid,
                receiptId,
                receiptUpdateDto: receiptDto,
                receiptItemListDto: receiptItemList,
            });
            return { data: { receiptId } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
};
exports.ApiReceiptService = ApiReceiptService;
exports.ApiReceiptService = ApiReceiptService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof receipt_repository_1.ReceiptRepository !== "undefined" && receipt_repository_1.ReceiptRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _c : Object, typeof (_d = typeof batch_repository_1.BatchRepository !== "undefined" && batch_repository_1.BatchRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.ReceiptDraftOperation !== "undefined" && operations_1.ReceiptDraftOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.ReceiptDepositedOperation !== "undefined" && operations_1.ReceiptDepositedOperation) === "function" ? _f : Object, typeof (_g = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _g : Object])
], ApiReceiptService);


/***/ }),
/* 279 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileReceiptController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(270);
const permission_guard_1 = __webpack_require__(93);
const interceptor_1 = __webpack_require__(271);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_file_receipt_upload_excel_1 = __webpack_require__(280);
let ApiFileReceiptController = class ApiFileReceiptController {
    constructor(apiFileReceiptUploadExcel) {
        this.apiFileReceiptUploadExcel = apiFileReceiptUploadExcel;
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileReceiptUploadExcel.fileExample();
    }
    async uploadExcelForCreateDraft({ user, oid }, file, body) {
        return await this.apiFileReceiptUploadExcel.uploadExcelForCreateDraft({ oid, user, file });
    }
};
exports.ApiFileReceiptController = ApiFileReceiptController;
__decorate([
    (0, common_1.Get)('upload-excel/file-example'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_RECEIPT_UPLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiFileReceiptController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel-for-create-draft'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_RECEIPT_UPLOAD_EXCEL),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, typeof (_d = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _d : Object, typeof (_e = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiFileReceiptController.prototype, "uploadExcelForCreateDraft", null);
exports.ApiFileReceiptController = ApiFileReceiptController = __decorate([
    (0, swagger_1.ApiTags)('FileProduct'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-receipt'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_receipt_upload_excel_1.ApiFileReceiptUploadExcel !== "undefined" && api_file_receipt_upload_excel_1.ApiFileReceiptUploadExcel) === "function" ? _a : Object])
], ApiFileReceiptController);


/***/ }),
/* 280 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileReceiptUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const exceljs_1 = __webpack_require__(267);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const product_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(170);
const excel_one_sheet_util_1 = __webpack_require__(266);
const api_receipt_service_1 = __webpack_require__(278);
const ReceiptItemExcelRules = [
    {
        column: 'A',
        width: 5,
        title: 'STT',
        example: 1,
        required: true,
    },
    {
        column: 'B',
        width: 15,
        title: 'Mã sản phẩm',
        type: 'string',
        example: 'SP002',
        required: true,
    },
    {
        column: 'C',
        width: 40,
        title: 'Tên sản phẩm',
        type: 'string',
        example: 'Augmentin',
        required: true,
    },
    {
        column: 'D',
        width: 15,
        title: 'Mã lô',
        type: 'string',
        example: 'SK123',
    },
    {
        column: 'E',
        width: 20,
        title: 'Hạn sử dụng',
        type: 'date',
        example: new Date(),
    },
    {
        column: 'F',
        width: 15,
        title: 'Số lượng',
        type: 'number',
        example: 50,
    },
    {
        column: 'G',
        width: 15,
        title: 'Giá nhập',
        type: 'number',
        example: 10000,
    },
    {
        column: 'H',
        width: 15,
        title: 'Giá bán',
        type: 'number',
        example: 10000,
    },
];
let ApiFileReceiptUploadExcel = class ApiFileReceiptUploadExcel {
    constructor(productRepository, apiReceiptService) {
        this.productRepository = productRepository;
        this.apiReceiptService = apiReceiptService;
    }
    async fileExample() {
        const dataRows = [];
        const rowTitleExample = {};
        const rowTitleStyle = {};
        ReceiptItemExcelRules.forEach((rule) => {
            rowTitleExample[rule.column] = rule.title;
            rowTitleStyle[rule.column] = { alignment: { horizontal: 'center' }, font: { bold: true } };
        });
        dataRows.push({
            style: rowTitleStyle,
            data: [rowTitleExample],
        });
        const rowDataExample = {};
        ReceiptItemExcelRules.forEach((rule) => {
            rowDataExample[rule.column] = rule.example;
        });
        dataRows.push({
            data: [rowDataExample],
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Nhập hàng' },
            columns: ReceiptItemExcelRules.map((rule) => {
                return {
                    key: rule.column,
                    width: rule.width,
                };
            }),
            rows: dataRows,
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA-file-nhap-hang-demo.xlsx',
            },
        };
    }
    async uploadExcelForCreateDraft(options) {
        const { oid, user, file } = options;
        const validTypes = [
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'application/vnd.ms-excel',
            'application/wps-office.xlsx',
        ];
        const isValidType = validTypes.includes(file.mimetype);
        if (!isValidType) {
            throw new exception_filter_1.BusinessException('Chỉ chấp nhận file excel');
        }
        if (file.size > 5 * 1024 * 1024) {
            throw new exception_filter_1.BusinessException('Chỉ chấp nhận file dưới 5MB');
        }
        const workbook = new exceljs_1.Workbook();
        await workbook.xlsx.load(file.buffer);
        const worksheet = workbook.worksheets[0];
        worksheet.eachRow((row, rowNumber) => {
            if (!row.hasValues)
                return;
            if (rowNumber === 1) {
                const titleList = row.values.slice(1);
                titleList.forEach((t, index) => {
                    const rule = ReceiptItemExcelRules[index];
                    if (t !== rule.title) {
                        const msg = `Hàng ${rowNumber}, tiêu đề không đúng, cột ${rule.column} cần có tên là ${rule.title}`;
                        throw new exception_filter_1.BusinessException(msg);
                    }
                });
                return;
            }
            const values = row.values.slice(1);
            values.forEach((v, index) => {
                const rule = ReceiptItemExcelRules[index];
                const msgPrefix = `Hàng ${rowNumber}, STT ${values[0]}, cột ${rule.column}, ${rule.title} không đúng: `;
                let msgError = '';
                if (rule.required && v == null) {
                    msgError = `${msgPrefix} không được để trống`;
                }
                if (v != null && rule.type && typeof v !== rule.type) {
                    if (rule.type === 'number' && typeof v !== 'number') {
                        msgError = `${msgPrefix} cần có định dạng là số`;
                    }
                    if (rule.type === 'string' && typeof v !== 'string') {
                        msgError = `${msgPrefix} cần có định dạng là chữ`;
                    }
                    if (rule.type === 'date' && Object.prototype.toString.call(v) !== '[object Date]') {
                        msgError = `${msgPrefix} cần có định dạng là ngày`;
                    }
                }
                if (msgError) {
                    throw new exception_filter_1.BusinessException(msgError);
                }
            });
        });
        const receiptItemExcel = [];
        worksheet.eachRow((row, rowNumber) => {
            if (!row.hasValues)
                return;
            if (rowNumber === 1)
                return;
            const values = row.values.slice(1);
            receiptItemExcel.push({
                index: values[0],
                productCode: values[1],
                brandName: values[2],
                batchCode: values[3],
                expiryDate: values[4],
                quantity: values[5],
                costPrice: values[6],
                listPrice: values[7],
            });
        });
        const productCodeList = receiptItemExcel.map((i) => i.productCode);
        const productList = await this.productRepository.findManyBy({
            oid,
            productCode: { IN: productCodeList },
        });
        let productMap = object_helper_1.ESArray.arrayToKeyValue(productList, 'productCode');
        const productInsertList = [];
        receiptItemExcel.forEach((i) => {
            if (!productMap[i.productCode]) {
                const productInsert = {
                    oid,
                    productCode: i.productCode,
                    brandName: i.brandName,
                    costPrice: i.costPrice,
                    retailPrice: i.listPrice,
                    hintUsage: '',
                    image: '',
                    isActive: 1,
                    productGroupId: 0,
                    quantity: 0,
                    route: '',
                    source: '',
                    substance: '',
                    unit: JSON.stringify([]),
                    warehouseIds: JSON.stringify([0]),
                    wholesalePrice: 0,
                    pickupStrategy: variable_1.PickupStrategy.Inherit,
                    splitBatchByWarehouse: product_entity_1.SplitBatchByWarehouse.Inherit,
                    splitBatchByDistributor: product_entity_1.SplitBatchByDistributor.Inherit,
                    splitBatchByExpiryDate: product_entity_1.SplitBatchByExpiryDate.Inherit,
                    splitBatchByCostPrice: product_entity_1.SplitBatchByCostPrice.Inherit,
                };
                productInsertList.push(productInsert);
            }
        });
        const productCreatedList = await this.productRepository.insertManyFullFieldAndReturnEntity(productInsertList);
        productMap = object_helper_1.ESArray.arrayToKeyValue([...productList, ...productCreatedList], 'productCode');
        const receiptItemBodyList = receiptItemExcel.map((i) => {
            var _a;
            const item = {
                productId: productMap[i.productCode].id,
                batchCode: i.batchCode,
                batchId: 0,
                costPrice: i.costPrice,
                expiryDate: ((_a = i.expiryDate) === null || _a === void 0 ? void 0 : _a.getTime()) || null,
                quantity: i.quantity,
                unitRate: 1,
                warehouseId: 0,
                listPrice: i.listPrice,
            };
            return item;
        });
        const itemsActualMoney = receiptItemBodyList.reduce((acc, item) => acc + item.quantity * item.costPrice, 0);
        const receiptBody = {
            distributorId: 0,
            receipt: {
                discountMoney: 0,
                discountPercent: 0,
                discountType: variable_1.DiscountType.VND,
                note: '',
                startedAt: Date.now(),
                surcharge: 0,
                itemsActualMoney,
                totalMoney: itemsActualMoney,
            },
            receiptItemList: receiptItemBodyList,
        };
        const createDraftResult = await this.apiReceiptService.createDraft({
            oid,
            body: receiptBody,
        });
        return { data: createDraftResult.data };
    }
};
exports.ApiFileReceiptUploadExcel = ApiFileReceiptUploadExcel;
exports.ApiFileReceiptUploadExcel = ApiFileReceiptUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _a : Object, typeof (_b = typeof api_receipt_service_1.ApiReceiptService !== "undefined" && api_receipt_service_1.ApiReceiptService) === "function" ? _b : Object])
], ApiFileReceiptUploadExcel);


/***/ }),
/* 281 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_ticket_controller_1 = __webpack_require__(282);
const api_file_ticket_download_excel_1 = __webpack_require__(297);
let ApiFileTicketModule = class ApiFileTicketModule {
};
exports.ApiFileTicketModule = ApiFileTicketModule;
exports.ApiFileTicketModule = ApiFileTicketModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_ticket_controller_1.ApiFileTicketController],
        providers: [api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel],
    })
], ApiFileTicketModule);


/***/ }),
/* 282 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const request_1 = __webpack_require__(283);
const api_file_ticket_download_excel_1 = __webpack_require__(297);
let ApiFileTicketController = class ApiFileTicketController {
    constructor(apiFileTicketDownloadExcel) {
        this.apiFileTicketDownloadExcel = apiFileTicketDownloadExcel;
    }
    async ticketOrderDownloadExcel({ user, organization }, query) {
        return await this.apiFileTicketDownloadExcel.downloadExcel({ organization, user, query });
    }
    async ticketClinicDownloadExcel({ user, organization }, query) {
        return await this.apiFileTicketDownloadExcel.downloadExcel({ organization, user, query });
    }
};
exports.ApiFileTicketController = ApiFileTicketController;
__decorate([
    (0, common_1.Get)('ticket-oder/download-excel'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_TICKET_ORDER_DOWNLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketGetManyQuery !== "undefined" && request_1.TicketGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileTicketController.prototype, "ticketOrderDownloadExcel", null);
__decorate([
    (0, common_1.Get)('ticket-clinic/download-excel'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.FILE_TICKET_CLINIC_DOWNLOAD_EXCEL),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.TicketGetManyQuery !== "undefined" && request_1.TicketGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiFileTicketController.prototype, "ticketClinicDownloadExcel", null);
exports.ApiFileTicketController = ApiFileTicketController = __decorate([
    (0, swagger_1.ApiTags)('FileTicket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel !== "undefined" && api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel) === "function" ? _a : Object])
], ApiFileTicketController);


/***/ }),
/* 283 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(284), exports);
__exportStar(__webpack_require__(293), exports);
__exportStar(__webpack_require__(294), exports);
__exportStar(__webpack_require__(295), exports);
__exportStar(__webpack_require__(296), exports);


/***/ }),
/* 284 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketGetOneQuery = exports.TicketGetManyQuery = exports.TicketPaginationQuery = exports.TicketGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const ticket_options_request_1 = __webpack_require__(293);
class TicketGetQuery {
}
exports.TicketGetQuery = TicketGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customer: true,
            paymentList: true,
            ticketAttributeList: true,
            ticketProductList: { product: true },
            ticketProcedureList: { procedure: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_options_request_1.TicketRelationQuery !== "undefined" && ticket_options_request_1.TicketRelationQuery) === "function" ? _a : Object)
], TicketGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
            startedAt: { GT: 150000 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_options_request_1.TicketFilterQuery !== "undefined" && ticket_options_request_1.TicketFilterQuery) === "function" ? _b : Object)
], TicketGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_options_request_1.TicketSortQuery !== "undefined" && ticket_options_request_1.TicketSortQuery) === "function" ? _c : Object)
], TicketGetQuery.prototype, "sort", void 0);
class TicketPaginationQuery extends (0, swagger_1.IntersectionType)(TicketGetQuery, dto_1.PaginationQuery) {
}
exports.TicketPaginationQuery = TicketPaginationQuery;
class TicketGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketGetQuery, ['filter', 'relation', 'sort']), dto_1.LimitQuery) {
}
exports.TicketGetManyQuery = TicketGetManyQuery;
class TicketGetOneQuery extends (0, swagger_1.PickType)(TicketGetQuery, ['relation']) {
}
exports.TicketGetOneQuery = TicketGetOneQuery;


/***/ }),
/* 285 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(85), exports);
__exportStar(__webpack_require__(286), exports);
__exportStar(__webpack_require__(287), exports);
__exportStar(__webpack_require__(288), exports);
__exportStar(__webpack_require__(289), exports);
__exportStar(__webpack_require__(290), exports);
__exportStar(__webpack_require__(291), exports);
__exportStar(__webpack_require__(292), exports);
__exportStar(__webpack_require__(259), exports);


/***/ }),
/* 286 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionDate = exports.ConditionDate = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ConditionDate {
}
exports.ConditionDate = ConditionDate;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], ConditionDate.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], ConditionDate.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], ConditionDate.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], ConditionDate.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], ConditionDate.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object)
], ConditionDate.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_g = typeof Date !== "undefined" && Date) === "function" ? _g : Object)
], ConditionDate.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_h = typeof Date !== "undefined" && Date) === "function" ? _h : Object)
], ConditionDate.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_j = typeof Date !== "undefined" && Date) === "function" ? _j : Object)
], ConditionDate.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_k = typeof Date !== "undefined" && Date) === "function" ? _k : Object)
], ConditionDate.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_l = typeof Date !== "undefined" && Date) === "function" ? _l : Object)
], ConditionDate.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_m = typeof Date !== "undefined" && Date) === "function" ? _m : Object)
], ConditionDate.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionDate.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionDate.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => {
            if (v == null)
                return null;
            return new Date(v);
        });
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsDate)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionDate.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => {
            if (v == null)
                return null;
            return new Date(v);
        });
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsDate)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    __metadata("design:type", Array)
], ConditionDate.prototype, "BETWEEN", void 0);
const transformConditionDate = ({ value, key }) => {
    if (!value)
        return undefined;
    if (typeof value === 'string') {
        const validate = (0, class_validator_1.isDateString)(value);
        if (!validate)
            throw new Error(`${key} must be a DateString`);
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionDate, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionDate failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a DateString`);
    }
};
exports.transformConditionDate = transformConditionDate;


/***/ }),
/* 287 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionEnum = void 0;
exports.createConditionEnum = createConditionEnum;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
function createConditionEnum(enumObject) {
    var _a, _b, _c, _d;
    const EValue = (0, typescript_helper_1.valuesEnum)(enumObject);
    class ConditionEnum {
    }
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_a = typeof T !== "undefined" && T) === "function" ? _a : Object)
    ], ConditionEnum.prototype, "==", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_b = typeof T !== "undefined" && T) === "function" ? _b : Object)
    ], ConditionEnum.prototype, "EQUAL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_c = typeof T !== "undefined" && T) === "function" ? _c : Object)
    ], ConditionEnum.prototype, "!=", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_d = typeof T !== "undefined" && T) === "function" ? _d : Object)
    ], ConditionEnum.prototype, "NOT", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsBoolean)(),
        __metadata("design:type", Boolean)
    ], ConditionEnum.prototype, "IS_NULL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsBoolean)(),
        __metadata("design:type", Boolean)
    ], ConditionEnum.prototype, "NOT_NULL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsArray)(),
        (0, class_validator_1.ArrayMinSize)(1),
        (0, class_validator_custom_1.IsEnumValue)(enumObject, { each: true }),
        __metadata("design:type", Array)
    ], ConditionEnum.prototype, "IN", void 0);
    return ConditionEnum;
}
const transformConditionEnum = ({ value, key }, enumObject) => {
    if (value == null)
        return;
    if (typeof value === 'number' || typeof value === 'string') {
        const enumObjectValueList = (0, typescript_helper_1.valuesEnum)(enumObject);
        for (let i = 0; i < enumObjectValueList.length; i++) {
            const item = enumObjectValueList[i];
            if (item != value)
                continue;
            if (typeof item === 'number') {
                return Number(value);
            }
            if (typeof item === 'string') {
                return String(value);
            }
        }
        throw new Error(`${key} must be a enum ${(0, typescript_helper_1.stringEnum)(enumObject)}`);
    }
    else if (typeof value === 'object') {
        const ConditionEnum = createConditionEnum(enumObject);
        const instance = (0, class_transformer_1.plainToInstance)(ConditionEnum, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionEnum failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Enum or condition of Enum`);
    }
};
exports.transformConditionEnum = transformConditionEnum;


/***/ }),
/* 288 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionMongoId = exports.ConditionMongoId = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ConditionMongoId {
}
exports.ConditionMongoId = ConditionMongoId;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", Boolean)
], ConditionMongoId.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", Boolean)
], ConditionMongoId.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "LIKE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsMongoId)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionMongoId.prototype, "IN", void 0);
const transformConditionMongoId = ({ value, key }) => {
    if (!value)
        return undefined;
    if (typeof value === 'string') {
        const validate = (0, class_validator_1.isMongoId)(value);
        if (!validate)
            throw new Error(`${key} must be a mongoID`);
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionMongoId, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionMongoID failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a mongoID`);
    }
};
exports.transformConditionMongoId = transformConditionMongoId;


/***/ }),
/* 289 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionNumber = exports.ConditionNumber = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ConditionNumber {
}
exports.ConditionNumber = ConditionNumber;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionNumber.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionNumber.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ConditionNumber.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    __metadata("design:type", Array)
], ConditionNumber.prototype, "BETWEEN", void 0);
const transformConditionNumber = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'number') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionNumber, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionNumber failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Number or condition of Number`);
    }
};
exports.transformConditionNumber = transformConditionNumber;


/***/ }),
/* 290 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionString = exports.ConditionString = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ConditionString {
}
exports.ConditionString = ConditionString;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", Boolean)
], ConditionString.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", Boolean)
], ConditionString.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "LIKE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsString)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionString.prototype, "IN", void 0);
const transformConditionString = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'string') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionString, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionString failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a String`);
    }
};
exports.transformConditionString = transformConditionString;


/***/ }),
/* 291 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionTimestamp = exports.ConditionTimestamp = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ConditionTimestamp {
}
exports.ConditionTimestamp = ConditionTimestamp;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionTimestamp.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionTimestamp.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => new Date(v).getTime());
    }),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionTimestamp.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => new Date(v).getTime());
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ConditionTimestamp.prototype, "BETWEEN", void 0);
const transformConditionTimestamp = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'number') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionTimestamp, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionTimestamp failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Number or condition of Number`);
    }
};
exports.transformConditionTimestamp = transformConditionTimestamp;


/***/ }),
/* 292 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.IdMongoParam = exports.IdParam = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class IdParam {
}
exports.IdParam = IdParam;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], IdParam.prototype, "id", void 0);
class IdMongoParam {
}
exports.IdMongoParam = IdMongoParam;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '63fdde9517a7317f0e8f959a' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], IdMongoParam.prototype, "id", void 0);


/***/ }),
/* 293 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSortQuery = exports.TicketFilterQuery = exports.TicketRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const ticket_entity_1 = __webpack_require__(56);
class TicketRelationQuery {
}
exports.TicketRelationQuery = TicketRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketSurchargeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketExpenseList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketProductList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketProductConsumableList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketBatchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketLaboratoryGroupList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketLaboratoryResultList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketRadiologyList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "toAppointment", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "customerSource", void 0);
const ConditionEnumTicketType = (0, dto_1.createConditionEnum)(ticket_entity_1.TicketType);
const ConditionEnumTicketStatus = (0, dto_1.createConditionEnum)(ticket_entity_1.TicketStatus);
class TicketFilterQuery {
}
exports.TicketFilterQuery = TicketFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, ticket_entity_1.TicketStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, ticket_entity_1.TicketType)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketFilterQuery.prototype, "ticketType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketFilterQuery.prototype, "customType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _e : Object)
], TicketFilterQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], TicketFilterQuery.prototype, "startedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_g = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _g : Object)
], TicketFilterQuery.prototype, "updatedAt", void 0);
class TicketSortQuery extends dto_1.SortQuery {
}
exports.TicketSortQuery = TicketSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketSortQuery.prototype, "registeredAt", void 0);


/***/ }),
/* 294 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketPaymentMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketPaymentMoneyBody {
}
exports.TicketPaymentMoneyBody = TicketPaymentMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPaymentMoneyBody.prototype, "money", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPaymentMoneyBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketPaymentMoneyBody.prototype, "note", void 0);


/***/ }),
/* 295 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReturnProductListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ReturnListBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ReturnListBody.prototype, "ticketBatchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 3 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReturnListBody.prototype, "quantityReturn", void 0);
class TicketReturnProductListBody {
}
exports.TicketReturnProductListBody = TicketReturnProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ReturnListBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ReturnListBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReturnProductListBody.prototype, "returnList", void 0);


/***/ }),
/* 296 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketParams {
}
exports.TicketParams = TicketParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketParams.prototype, "ticketId", void 0);


/***/ }),
/* 297 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const time_helper_1 = __webpack_require__(146);
const entities_1 = __webpack_require__(43);
const ticket_entity_1 = __webpack_require__(56);
const repositories_1 = __webpack_require__(170);
const excel_one_sheet_util_1 = __webpack_require__(266);
let ApiFileTicketDownloadExcel = class ApiFileTicketDownloadExcel {
    constructor(ticketRepository) {
        this.ticketRepository = ticketRepository;
    }
    async downloadExcel(options) {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        const { user, organization, query } = options;
        let typeText = 'LƯỢT KHÁM';
        if (((_a = query.filter) === null || _a === void 0 ? void 0 : _a.ticketType) === ticket_entity_1.TicketType.Order) {
            typeText = 'LƯỢT BÁN HÀNG';
        }
        const ticketList = await this.ticketRepository.findMany({
            relation: {
                customer: true,
            },
            condition: {
                oid: organization.id,
                status: (_b = query.filter) === null || _b === void 0 ? void 0 : _b.status,
                ticketType: (_c = query.filter) === null || _c === void 0 ? void 0 : _c.ticketType,
                customType: (_d = query.filter) === null || _d === void 0 ? void 0 : _d.customType,
                customerId: (_e = query.filter) === null || _e === void 0 ? void 0 : _e.customerId,
                registeredAt: (_f = query.filter) === null || _f === void 0 ? void 0 : _f.registeredAt,
                startedAt: (_g = query.filter) === null || _g === void 0 ? void 0 : _g.startedAt,
                updatedAt: (_h = query.filter) === null || _h === void 0 ? void 0 : _h.updatedAt,
            },
            sort: { id: 'ASC' },
        });
        const workbook = this.getWorkbookProduct(ticketList, {
            orgName: organization.name,
            orgPhone: organization.phone,
            orgAddress: [
                organization.addressWard,
                organization.addressDistrict,
                organization.addressProvince,
            ]
                .filter((i) => !!i)
                .join(' - ')
                .replace('Tỉnh', '')
                .replace('Thành phố', '')
                .replace('Quận ', '')
                .replace('Huyện ', '')
                .replace('Phường ', '')
                .replace('Xã ', ''),
            userFullName: user.fullName,
            typeText,
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: `MEA_${typeText}.xlsx`,
            },
        };
    }
    getWorkbookProduct(ticketList, meta) {
        const dataRows = [];
        ticketList.forEach((ticket, ticketIndex) => {
            var _a, _b, _c, _d, _e;
            dataRows.push({
                style: {
                    num: { alignment: { horizontal: 'center' } },
                    id: { alignment: { horizontal: 'center' } },
                    ticketCode: { alignment: { horizontal: 'center' } },
                    customerName: { alignment: { wrapText: true } },
                    status: { alignment: { wrapText: true } },
                    registeredAt: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy h:mm:ss' },
                    endedAt: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy h:mm:ss' },
                    itemsCostAmount: { numFmt: '###,##0', font: { bold: true } },
                    itemsDiscount: { numFmt: '###,##0' },
                    productMoney: { numFmt: '###,##0' },
                    procedureMoney: { numFmt: '###,##0' },
                    radiologyMoney: { numFmt: '###,##0' },
                    laboratoryMoney: { numFmt: '###,##0' },
                    itemsActualMoney: { numFmt: '###,##0' },
                    discountMoney: { numFmt: '###,##0' },
                    surcharge: { numFmt: '###,##0' },
                    expense: { numFmt: '###,##0' },
                    totalMoney: { numFmt: '###,##0', font: { bold: true } },
                    paid: { numFmt: '###,##0' },
                    debt: { numFmt: '###,##0' },
                    commissionMoney: { numFmt: '###,##0' },
                    profit: { numFmt: '###,##0', font: { bold: true } },
                },
                data: [
                    {
                        num: ticketIndex + 1,
                        id: ticket.id,
                        ticketCode: ((_a = ticket.date) === null || _a === void 0 ? void 0 : _a.toString().padStart(2, '0'))
                            + ((_b = ticket.month) === null || _b === void 0 ? void 0 : _b.toString().padStart(2, '0'))
                            + ((_c = ticket.year) === null || _c === void 0 ? void 0 : _c.toString().slice(-2))
                            + '_'
                            + ((_d = ticket.dailyIndex) === null || _d === void 0 ? void 0 : _d.toString().padStart(2, '0')),
                        customerName: ((_e = ticket.customer) === null || _e === void 0 ? void 0 : _e.fullName) || '',
                        status: entities_1.Ticket.getStatusText(ticket),
                        registeredAt: ticket.registeredAt
                            ? new Date(ticket.registeredAt + 7 * 60 * 60 * 1000)
                            : '',
                        endedAt: ticket.endedAt ? new Date(ticket.endedAt + 7 * 60 * 60 * 1000) : '',
                        itemsCostAmount: ticket.itemsCostAmount,
                        itemsDiscount: ticket.itemsDiscount,
                        productMoney: ticket.productMoney || 0,
                        procedureMoney: ticket.procedureMoney || 0,
                        radiologyMoney: ticket.radiologyMoney || 0,
                        laboratoryMoney: ticket.laboratoryMoney || 0,
                        itemsActualMoney: ticket.itemsActualMoney || 0,
                        discountMoney: ticket.discountMoney,
                        surcharge: ticket.surcharge || 0,
                        expense: ticket.expense || 0,
                        totalMoney: ticket.totalMoney,
                        paid: ticket.paid || 0,
                        debt: ticket.debt || 0,
                        commissionMoney: ticket.commissionMoney || 0,
                        profit: ticket.profit || 0,
                    },
                ],
            });
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: meta.typeText },
            headerSheet: (worksheet) => {
                worksheet.addRow([meta.orgName]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgPhone]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgAddress]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow(['BÁO CÁO ' + meta.typeText.toUpperCase()]).eachCell((cell) => {
                    cell.font = {
                        size: 16,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(4, 1, 4, 15);
                worksheet
                    .addRow([`Thời gian: ${time_helper_1.ESTimer.timeToText(new Date(), 'hh:mm:ss DD/MM/YYYY', 7)}`])
                    .eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        italic: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(5, 1, 5, 15);
                worksheet.addRow([]);
                const rowTitle = worksheet.addRow([
                    'STT',
                    'ID',
                    'Mã lượt',
                    'Tên khách hàng',
                    'Trạng thái',
                    'Thời gian đăng ký',
                    'Thời gian kết thúc',
                    'Tổng vốn',
                    'Khuyến mãi thành phần',
                    'Tiền sản phẩm',
                    'Tiền dịch vụ',
                    'Tiền CĐHA',
                    'Tiền Xét nghiệm',
                    'Tổng tiền thành phần',
                    'Khuyến mãi cả đơn',
                    'Phụ thu',
                    'Chi phí',
                    'Tổng tiền',
                    'Đã thu',
                    'Còn nợ',
                    'Hoa hồng',
                    'Lợi nhuận',
                ]);
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: [
                { key: 'num', width: 5 },
                { key: 'id', width: 10 },
                { key: 'ticketCode', width: 15 },
                { key: 'customerName', width: 30 },
                { key: 'status', width: 15 },
                { key: 'registeredAt', width: 20 },
                { key: 'endedAt', width: 20 },
                { key: 'itemsCostAmount', width: 10 },
                { key: 'itemsDiscount', width: 10 },
                { key: 'productMoney', width: 10 },
                { key: 'procedureMoney', width: 10 },
                { key: 'radiologyMoney', width: 10 },
                { key: 'laboratoryMoney', width: 10 },
                { key: 'itemsActualMoney', width: 10 },
                { key: 'discountMoney', width: 10 },
                { key: 'surcharge', width: 10 },
                { key: 'expense', width: 10 },
                { key: 'totalMoney', width: 10 },
                { key: 'paid', width: 10 },
                { key: 'debt', width: 10 },
                { key: 'commissionMoney', width: 10 },
                { key: 'profit', width: 10 },
            ],
            rows: dataRows,
            footerSheet: (worksheet) => {
                worksheet.addRow(['']);
                worksheet.addRow([`Người xuất báo cáo: ${meta.userFullName}`]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        italic: true,
                        name: 'Times New Roman',
                    };
                });
            },
        });
        return workbook;
    }
};
exports.ApiFileTicketDownloadExcel = ApiFileTicketDownloadExcel;
exports.ApiFileTicketDownloadExcel = ApiFileTicketDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _a : Object])
], ApiFileTicketDownloadExcel);


/***/ }),
/* 298 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_data_module_1 = __webpack_require__(299);
const api_root_organization_module_1 = __webpack_require__(303);
const api_root_user_module_1 = __webpack_require__(313);
let ApiRootModule = class ApiRootModule {
};
exports.ApiRootModule = ApiRootModule;
exports.ApiRootModule = ApiRootModule = __decorate([
    (0, common_1.Module)({
        imports: [api_root_organization_module_1.ApiRootOrganizationModule, api_root_user_module_1.ApiRootUserModule, api_root_data_module_1.ApiRootDataModule],
        controllers: [],
        providers: [],
    })
], ApiRootModule);


/***/ }),
/* 299 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_data_controller_1 = __webpack_require__(300);
const api_root_data_service_1 = __webpack_require__(301);
let ApiRootDataModule = class ApiRootDataModule {
};
exports.ApiRootDataModule = ApiRootDataModule;
exports.ApiRootDataModule = ApiRootDataModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_data_controller_1.ApiRootDataController],
        providers: [api_root_data_service_1.ApiRootDataService],
    })
], ApiRootDataModule);


/***/ }),
/* 300 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const api_root_data_service_1 = __webpack_require__(301);
const root_migration_data_body_1 = __webpack_require__(302);
let ApiRootDataController = class ApiRootDataController {
    constructor(apiRootDataService) {
        this.apiRootDataService = apiRootDataService;
    }
    async migration(body) {
        return await this.apiRootDataService.startMigrationData(body);
    }
};
exports.ApiRootDataController = ApiRootDataController;
__decorate([
    (0, common_1.Post)('migration'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof root_migration_data_body_1.RootMigrationDataBody !== "undefined" && root_migration_data_body_1.RootMigrationDataBody) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiRootDataController.prototype, "migration", null);
exports.ApiRootDataController = ApiRootDataController = __decorate([
    (0, common_1.Controller)('root/data'),
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_data_service_1.ApiRootDataService !== "undefined" && api_root_data_service_1.ApiRootDataService) === "function" ? _a : Object])
], ApiRootDataController);


/***/ }),
/* 301 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ApiRootDataService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataService = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_attribute_repository_1 = __webpack_require__(196);
let ApiRootDataService = ApiRootDataService_1 = class ApiRootDataService {
    constructor(dataSource, ticketAttributeRepository) {
        this.dataSource = dataSource;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.logger = new common_1.Logger(ApiRootDataService_1.name);
    }
    async startMigrationData(body) {
        if (body.key !== '8aobvoyupp8')
            return;
        return { data: true };
    }
};
exports.ApiRootDataService = ApiRootDataService;
exports.ApiRootDataService = ApiRootDataService = ApiRootDataService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof ticket_attribute_repository_1.TicketAttributeRepository !== "undefined" && ticket_attribute_repository_1.TicketAttributeRepository) === "function" ? _b : Object])
], ApiRootDataService);


/***/ }),
/* 302 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootMigrationDataBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RootMigrationDataBody {
}
exports.RootMigrationDataBody = RootMigrationDataBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(10),
    __metadata("design:type", String)
], RootMigrationDataBody.prototype, "key", void 0);


/***/ }),
/* 303 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_organization_controller_1 = __webpack_require__(304);
const api_root_organization_service_1 = __webpack_require__(305);
let ApiRootOrganizationModule = class ApiRootOrganizationModule {
};
exports.ApiRootOrganizationModule = ApiRootOrganizationModule;
exports.ApiRootOrganizationModule = ApiRootOrganizationModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_organization_controller_1.ApiRootOrganizationController],
        providers: [api_root_organization_service_1.ApiRootOrganizationService],
    })
], ApiRootOrganizationModule);


/***/ }),
/* 304 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const root_guard_1 = __webpack_require__(15);
const api_root_organization_service_1 = __webpack_require__(305);
const request_1 = __webpack_require__(308);
let ApiRootOrganizationController = class ApiRootOrganizationController {
    constructor(apiRootOrganizationService) {
        this.apiRootOrganizationService = apiRootOrganizationService;
    }
    pagination(query) {
        return this.apiRootOrganizationService.pagination(query);
    }
    async createOne(body) {
        return await this.apiRootOrganizationService.createOne(body);
    }
    async updateOne({ id }, body) {
        return await this.apiRootOrganizationService.updateOne(id, body);
    }
    async clearOne({ id }, body) {
        return await this.apiRootOrganizationService.clearOne(id, body);
    }
};
exports.ApiRootOrganizationController = ApiRootOrganizationController;
__decorate([
    (0, common_1.Get)('organization/pagination'),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.RootOrganizationPaginationQuery !== "undefined" && request_1.RootOrganizationPaginationQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiRootOrganizationController.prototype, "pagination", null);
__decorate([
    (0, common_1.Post)('organization/create'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof request_1.RootOrganizationCreateBody !== "undefined" && request_1.RootOrganizationCreateBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('organization/update/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _d : Object, typeof (_e = typeof request_1.RootOrganizationUpdateBody !== "undefined" && request_1.RootOrganizationUpdateBody) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Put)('organization/clear/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.RootOrganizationClearBody !== "undefined" && request_1.RootOrganizationClearBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "clearOne", null);
exports.ApiRootOrganizationController = ApiRootOrganizationController = __decorate([
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    (0, common_1.Controller)('root'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_organization_service_1.ApiRootOrganizationService !== "undefined" && api_root_organization_service_1.ApiRootOrganizationService) === "function" ? _a : Object])
], ApiRootOrganizationController);


/***/ }),
/* 305 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var ApiRootOrganizationService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationService = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(42);
const typeorm_2 = __webpack_require__(18);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const AllEntity = __webpack_require__(43);
const entities_1 = __webpack_require__(43);
const organization_repository_1 = __webpack_require__(41);
const socket_emit_service_1 = __webpack_require__(306);
let ApiRootOrganizationService = ApiRootOrganizationService_1 = class ApiRootOrganizationService {
    constructor(socketEmitService, cacheDataService, organizationRepository, manager) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.manager = manager;
        this.logger = new common_1.Logger(ApiRootOrganizationService_1.name);
    }
    async pagination(query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.organizationRepository.pagination({
            page,
            limit,
            relation,
            condition: {},
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async createOne(body) {
        const organization = await this.organizationRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { emailVerify: 0, logoImageId: 0 }));
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async updateOne(oid, body) {
        const organizationRoot = await this.organizationRepository.findOneById(oid);
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, Object.assign(Object.assign({}, body), { emailVerify: organizationRoot.email === body.email ? organizationRoot.emailVerify : 0 }));
        if (!organization) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async clearOne(oid, body) {
        const { tableNameDeleteList, tableNameClearList } = body;
        if (tableNameClearList.includes(entities_1.Customer.name)) {
            await this.manager.update(entities_1.Customer, { oid }, { debt: 0 });
        }
        if (tableNameClearList.includes(entities_1.Distributor.name)) {
            await this.manager.update(entities_1.Distributor, { oid }, { debt: 0 });
        }
        if (tableNameClearList.includes(entities_1.Image.name)) {
            await this.manager.update(entities_1.Image, { oid }, { waitDelete: 1 });
        }
        if (tableNameClearList.includes(entities_1.Product.name)) {
            await this.manager.update(entities_1.Product, { oid }, { quantity: 0 });
        }
        for (let index = 0; index < body.tableNameDeleteList.length; index++) {
            const tableName = tableNameDeleteList[index];
            if (AllEntity[tableName]) {
                if (tableName === AllEntity.Organization.name) {
                    await this.manager.delete(AllEntity[tableName], { id: oid });
                }
                else {
                    await this.manager.delete(AllEntity[tableName], { oid });
                }
            }
        }
        if (!tableNameDeleteList.includes(entities_1.Organization.name)) {
            await this.organizationRepository.updateDataVersion(oid);
        }
        this.cacheDataService.clearOrganization(oid);
        return { data: { oid } };
    }
};
exports.ApiRootOrganizationService = ApiRootOrganizationService;
exports.ApiRootOrganizationService = ApiRootOrganizationService = ApiRootOrganizationService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(3, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _d : Object])
], ApiRootOrganizationService);


/***/ }),
/* 306 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketEmitService = void 0;
const common_1 = __webpack_require__(3);
const socket_variable_1 = __webpack_require__(307);
let SocketEmitService = class SocketEmitService {
    constructor() {
        this.connections = null;
        this.io = null;
    }
    demo(oid) {
        if (!this.io)
            return;
        const dataDemo = new Date().toISOString();
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SERVER_EMIT_DEMO, { dataDemo });
    }
    organizationUpdate(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.ORGANIZATION_UPDATE);
    }
    settingReload(oid) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SETTING_RELOAD);
    }
    customerUpsert(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.CUSTOMER_UPSERT, data);
    }
    distributorUpsert(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.DISTRIBUTOR_UPSERT, data);
    }
    productUpsert(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.PRODUCT_UPSERT, data);
    }
    productListUpdate(oid, data) {
        var _a;
        if (!this.io || !((_a = data.productList) === null || _a === void 0 ? void 0 : _a.length))
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.PRODUCT_LIST_UPDATE, data);
    }
    ticketClinicChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE, data);
    }
    ticketClinicUpdateTicketAttributeList(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE_LIST, data);
    }
    ticketClinicChangeTicketUserList(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_TICKET_USER_LIST, data);
    }
    ticketClinicChangeTicketProcedureList(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_TICKET_PROCEDURE_LIST, data);
    }
    ticketClinicChangeTicketRadiologyList(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_TICKET_RADIOLOGY_LIST, data);
    }
    ticketClinicChangeLaboratory(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_LABORATORY, data);
    }
    ticketClinicChangeConsumable(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_CONSUMABLE, data);
    }
    ticketClinicChangePrescription(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_PRESCRIPTION, data);
    }
    ticketClinicChangeBatch(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.TICKET_CLINIC_CHANGE_BATCH, data);
    }
};
exports.SocketEmitService = SocketEmitService;
exports.SocketEmitService = SocketEmitService = __decorate([
    (0, common_1.Injectable)()
], SocketEmitService);


/***/ }),
/* 307 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SOCKET_EVENT = void 0;
var SOCKET_EVENT;
(function (SOCKET_EVENT) {
    SOCKET_EVENT["SERVER_EMIT_DEMO"] = "SERVER_EMIT_DEMO";
    SOCKET_EVENT["SERVER_EMIT_TICKET_CREATE"] = "SERVER_EMIT_TICKET_CREATE";
    SOCKET_EVENT["CLIENT_EMIT_TICKET_CREATE"] = "CLIENT_EMIT_TICKET_CREATE";
    SOCKET_EVENT["ORGANIZATION_UPDATE"] = "ORGANIZATION_UPDATE";
    SOCKET_EVENT["SETTING_RELOAD"] = "SETTING_RELOAD";
    SOCKET_EVENT["CUSTOMER_UPSERT"] = "CUSTOMER_UPSERT";
    SOCKET_EVENT["DISTRIBUTOR_UPSERT"] = "DISTRIBUTOR_UPSERT";
    SOCKET_EVENT["PRODUCT_UPSERT"] = "PRODUCT_UPSERT";
    SOCKET_EVENT["PRODUCT_LIST_UPDATE"] = "PRODUCT_LIST_UPDATE";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE"] = "TICKET_CLINIC_CHANGE";
    SOCKET_EVENT["TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE_LIST"] = "TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE_LIST";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_TICKET_USER_LIST"] = "TICKET_CLINIC_CHANGE_TICKET_USER_LIST";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_TICKET_PROCEDURE_LIST"] = "TICKET_CLINIC_CHANGE_TICKET_PROCEDURE_LIST";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_TICKET_RADIOLOGY_LIST"] = "TICKET_CLINIC_CHANGE_TICKET_RADIOLOGY_LIST";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_LABORATORY"] = "TICKET_CLINIC_CHANGE_LABORATORY";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_CONSUMABLE"] = "TICKET_CLINIC_CHANGE_CONSUMABLE";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_PRESCRIPTION"] = "TICKET_CLINIC_CHANGE_PRESCRIPTION";
    SOCKET_EVENT["TICKET_CLINIC_CHANGE_BATCH"] = "TICKET_CLINIC_CHANGE_BATCH";
})(SOCKET_EVENT || (exports.SOCKET_EVENT = SOCKET_EVENT = {}));


/***/ }),
/* 308 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(309), exports);
__exportStar(__webpack_require__(310), exports);
__exportStar(__webpack_require__(311), exports);
__exportStar(__webpack_require__(312), exports);


/***/ }),
/* 309 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationClearBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RootOrganizationClearBody {
}
exports.RootOrganizationClearBody = RootOrganizationClearBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RootOrganizationClearBody.prototype, "tableNameDeleteList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RootOrganizationClearBody.prototype, "tableNameClearList", void 0);


/***/ }),
/* 310 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationGetOneQuery = exports.RootOrganizationGetManyQuery = exports.RootOrganizationPaginationQuery = exports.RootOrganizationGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const root_organization_options_request_1 = __webpack_require__(311);
class RootOrganizationGetQuery {
}
exports.RootOrganizationGetQuery = RootOrganizationGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            userList: true,
            logoImage: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof root_organization_options_request_1.RootOrganizationRelationQuery !== "undefined" && root_organization_options_request_1.RootOrganizationRelationQuery) === "function" ? _a : Object)
], RootOrganizationGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof root_organization_options_request_1.RootOrganizationFilterQuery !== "undefined" && root_organization_options_request_1.RootOrganizationFilterQuery) === "function" ? _b : Object)
], RootOrganizationGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof root_organization_options_request_1.RootOrganizationSortQuery !== "undefined" && root_organization_options_request_1.RootOrganizationSortQuery) === "function" ? _c : Object)
], RootOrganizationGetQuery.prototype, "sort", void 0);
class RootOrganizationPaginationQuery extends (0, swagger_1.IntersectionType)(RootOrganizationGetQuery, dto_1.PaginationQuery) {
}
exports.RootOrganizationPaginationQuery = RootOrganizationPaginationQuery;
class RootOrganizationGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RootOrganizationGetQuery, ['filter', 'relation', 'sort']), dto_1.LimitQuery) {
}
exports.RootOrganizationGetManyQuery = RootOrganizationGetManyQuery;
class RootOrganizationGetOneQuery extends (0, swagger_1.PickType)(RootOrganizationGetQuery, ['relation']) {
}
exports.RootOrganizationGetOneQuery = RootOrganizationGetOneQuery;


/***/ }),
/* 311 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationSortQuery = exports.RootOrganizationFilterQuery = exports.RootOrganizationRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
class RootOrganizationRelationQuery {
}
exports.RootOrganizationRelationQuery = RootOrganizationRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootOrganizationRelationQuery.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootOrganizationRelationQuery.prototype, "logoImage", void 0);
class RootOrganizationFilterQuery {
}
exports.RootOrganizationFilterQuery = RootOrganizationFilterQuery;
class RootOrganizationSortQuery extends dto_1.SortQuery {
}
exports.RootOrganizationSortQuery = RootOrganizationSortQuery;


/***/ }),
/* 312 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationUpdateBody = exports.RootOrganizationCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const organization_entity_1 = __webpack_require__(16);
class RootOrganizationCreateBody {
}
exports.RootOrganizationCreateBody = RootOrganizationCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'email', example: 'vm@gmail.com' }),
    (0, class_transformer_1.Expose)({ name: 'email' }),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return value;
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 0 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "emailVerify", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Phòng khám đa khoa Medical' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "facebook", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "level", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "dataVersion", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: JSON.stringify([1, 2, 3, 4]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (typeof i !== 'number')
                    err.push(`${i} is not number`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)({ message: `Validate permissionIds failed: Example: ${JSON.stringify([1, 2, 3, 4])}` }),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "permissionIds", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Huyện Cát Tiên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressDistrict", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: organization_entity_1.OrganizationStatus.Active }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(organization_entity_1.OrganizationStatus),
    __metadata("design:type", typeof (_a = typeof organization_entity_1.OrganizationStatus !== "undefined" && organization_entity_1.OrganizationStatus) === "function" ? _a : Object)
], RootOrganizationCreateBody.prototype, "status", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Đã thanh toán ngày' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "expiryDate", void 0);
class RootOrganizationUpdateBody extends RootOrganizationCreateBody {
}
exports.RootOrganizationUpdateBody = RootOrganizationUpdateBody;


/***/ }),
/* 313 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_user_controller_1 = __webpack_require__(314);
const api_root_user_service_1 = __webpack_require__(315);
let ApiRootUserModule = class ApiRootUserModule {
};
exports.ApiRootUserModule = ApiRootUserModule;
exports.ApiRootUserModule = ApiRootUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_user_controller_1.ApiRootUserController],
        providers: [api_root_user_service_1.ApiRootUserService],
    })
], ApiRootUserModule);


/***/ }),
/* 314 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const root_guard_1 = __webpack_require__(15);
const user_entity_1 = __webpack_require__(20);
const api_root_user_service_1 = __webpack_require__(315);
const device_logout_query_1 = __webpack_require__(317);
const root_user_get_query_1 = __webpack_require__(318);
const root_user_upsert_body_1 = __webpack_require__(320);
let ApiRootUserController = class ApiRootUserController {
    constructor(apiRootUserService) {
        this.apiRootUserService = apiRootUserService;
    }
    pagination(query) {
        return this.apiRootUserService.pagination(query);
    }
    async create(body) {
        return await this.apiRootUserService.create(body);
    }
    async update({ id }, body) {
        return await this.apiRootUserService.update(id, body);
    }
    async userDeleteOne({ id }) {
        return await this.apiRootUserService.deleteOne(id);
    }
    deviceLogout({ id }, body) {
        return this.apiRootUserService.deviceLogout({
            oid: body.oid,
            userId: +id,
            refreshExp: body.refreshExp,
        });
    }
    logoutAll() {
        return this.apiRootUserService.logoutAll();
    }
};
exports.ApiRootUserController = ApiRootUserController;
__decorate([
    (0, common_1.Get)('pagination'),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof root_user_get_query_1.RootUserPaginationQuery !== "undefined" && root_user_get_query_1.RootUserPaginationQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "pagination", null);
__decorate([
    (0, common_1.Post)('create'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof root_user_upsert_body_1.RootUserCreateBody !== "undefined" && root_user_upsert_body_1.RootUserCreateBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _d : Object, typeof (_e = typeof root_user_upsert_body_1.RootUserUpdateBody !== "undefined" && root_user_upsert_body_1.RootUserUpdateBody) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "userDeleteOne", null);
__decorate([
    (0, common_1.Post)('device-logout/:id'),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof device_logout_query_1.DeviceLogoutBody !== "undefined" && device_logout_query_1.DeviceLogoutBody) === "function" ? _h : Object]),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "deviceLogout", null);
__decorate([
    (0, common_1.Post)('logout-all'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "logoutAll", null);
exports.ApiRootUserController = ApiRootUserController = __decorate([
    (0, common_1.Controller)('root/user'),
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    (0, common_1.SerializeOptions)({ groups: [user_entity_1.UserGroup.ROOT] }),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_user_service_1.ApiRootUserService !== "undefined" && api_root_user_service_1.ApiRootUserService) === "function" ? _a : Object])
], ApiRootUserController);


/***/ }),
/* 315 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var ApiRootUserService_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(243);
const cache_data_service_1 = __webpack_require__(39);
const cache_token_service_1 = __webpack_require__(92);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(226);
const device_1 = __webpack_require__(316);
const repositories_1 = __webpack_require__(170);
const user_repository_1 = __webpack_require__(90);
const socket_emit_service_1 = __webpack_require__(306);
let ApiRootUserService = ApiRootUserService_1 = class ApiRootUserService {
    constructor(socketEmitService, cacheTokenService, cacheDataService, userRepository, organizationRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
        this.userRepository = userRepository;
        this.organizationRepository = organizationRepository;
        this.logger = new common_1.Logger(ApiRootUserService_1.name);
    }
    async pagination(query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.userRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid: filter === null || filter === void 0 ? void 0 : filter.oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        for (let i = 0; i < data.length; i++) {
            const user = data[i];
            const tokenList = await this.cacheTokenService.getTokenList({
                oid: user.oid,
                uid: user.id,
            });
            user.devices = tokenList.map((j) => {
                const device = new device_1.default();
                device.refreshExp = j.refreshExp;
                device.ip = j.ip;
                device.os = j.os;
                device.browser = j.browser;
                device.mobile = j.mobile;
                device.online =
                    (this.socketEmitService.connections[user.id] || []).some((k) => {
                        return k.refreshExp === j.refreshExp;
                    }) || j.online;
                return device;
            });
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async create(body) {
        const { oid, username, password } = body, other = __rest(body, ["oid", "username", "password"]);
        const existUser = await this.userRepository.findOneBy({
            oid,
            username,
        });
        if (existUser)
            throw new exception_filter_1.BusinessException('error.Register.ExistUsername');
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, username);
        const user = await this.userRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, other), { oid,
            username,
            secret,
            hashPassword }));
        this.cacheDataService.clearUserAndRole(user.oid);
        return { data: { user } };
    }
    async update(userId, body) {
        const { username, password } = body, other = __rest(body, ["username", "password"]);
        const userOld = await this.userRepository.findOneBy({ id: userId });
        if (!userOld)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, username);
        const [user] = await this.userRepository.updateAndReturnEntity({ id: userId }, Object.assign(Object.assign({}, other), { hashPassword,
            secret,
            username }));
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.clearUserAndRole(user.oid);
        return { data: { user } };
    }
    async deleteOne(id) {
        const [user] = await this.userRepository.updateAndReturnEntity({ id }, { deletedAt: Date.now() });
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        this.cacheDataService.clearUserAndRole(user.oid);
        return { data: { userId: user.id } };
    }
    async deviceLogout(options) {
        const { oid, userId, refreshExp } = options;
        const result = this.cacheTokenService.removeRefreshToken({
            oid,
            uid: userId,
            refreshExp,
        });
        return { data: result };
    }
    async logoutAll() {
        const result = this.cacheTokenService.removeAllExcludeRoot();
        await this.organizationRepository.updateDataVersion(undefined);
        this.cacheDataService.clearOrganization(undefined);
        return { data: result };
    }
};
exports.ApiRootUserService = ApiRootUserService;
exports.ApiRootUserService = ApiRootUserService = ApiRootUserService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object, typeof (_d = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.OrganizationRepository !== "undefined" && repositories_1.OrganizationRepository) === "function" ? _e : Object])
], ApiRootUserService);


/***/ }),
/* 316 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
class Device {
}
exports["default"] = Device;
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "refreshExp", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "ip", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "os", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "browser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "mobile", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Device.prototype, "online", void 0);


/***/ }),
/* 317 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DeviceLogoutBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class DeviceLogoutBody {
}
exports.DeviceLogoutBody = DeviceLogoutBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "refreshExp", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "oid", void 0);


/***/ }),
/* 318 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserGetOneQuery = exports.RootUserGetManyQuery = exports.RootUserPaginationQuery = exports.RootUserGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const root_user_options_request_1 = __webpack_require__(319);
class RootUserGetQuery {
}
exports.RootUserGetQuery = RootUserGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            organization: true,
            userRoleList: { role: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof root_user_options_request_1.RootUserRelationQuery !== "undefined" && root_user_options_request_1.RootUserRelationQuery) === "function" ? _a : Object)
], RootUserGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof root_user_options_request_1.RootUserFilterQuery !== "undefined" && root_user_options_request_1.RootUserFilterQuery) === "function" ? _b : Object)
], RootUserGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof root_user_options_request_1.RootUserSortQuery !== "undefined" && root_user_options_request_1.RootUserSortQuery) === "function" ? _c : Object)
], RootUserGetQuery.prototype, "sort", void 0);
class RootUserPaginationQuery extends (0, swagger_1.IntersectionType)(RootUserGetQuery, query_1.PaginationQuery) {
}
exports.RootUserPaginationQuery = RootUserPaginationQuery;
class RootUserGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RootUserGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RootUserGetManyQuery = RootUserGetManyQuery;
class RootUserGetOneQuery extends (0, swagger_1.PickType)(RootUserGetQuery, ['relation']) {
}
exports.RootUserGetOneQuery = RootUserGetOneQuery;


/***/ }),
/* 319 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserSortQuery = exports.RootUserFilterQuery = exports.RootUserRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class RootUserRelationQuery {
}
exports.RootUserRelationQuery = RootUserRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootUserRelationQuery.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], RootUserRelationQuery.prototype, "userRoleList", void 0);
class RootUserFilterQuery {
}
exports.RootUserFilterQuery = RootUserFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], RootUserFilterQuery.prototype, "updatedAt", void 0);
class RootUserSortQuery extends query_1.SortQuery {
}
exports.RootUserSortQuery = RootUserSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RootUserSortQuery.prototype, "oid", void 0);


/***/ }),
/* 320 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserUpdateBody = exports.RootUserCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class RootUserCreateBody {
}
exports.RootUserCreateBody = RootUserCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 40 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "oid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "password", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], RootUserCreateBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "isAdmin", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "isActive", void 0);
class RootUserUpdateBody extends (0, swagger_1.OmitType)(RootUserCreateBody, ['oid']) {
}
exports.RootUserUpdateBody = RootUserUpdateBody;


/***/ }),
/* 321 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiModule = void 0;
const common_1 = __webpack_require__(3);
const api_appointment_module_1 = __webpack_require__(322);
const api_batch_module_1 = __webpack_require__(334);
const api_commission_module_1 = __webpack_require__(342);
const api_customer_source_module_1 = __webpack_require__(349);
const api_customer_module_1 = __webpack_require__(356);
const api_distributor_module_1 = __webpack_require__(359);
const api_laboratory_group_module_1 = __webpack_require__(366);
const api_laboratory_kit_module_1 = __webpack_require__(373);
const api_laboratory_module_1 = __webpack_require__(380);
const api_organization_module_1 = __webpack_require__(388);
const api_payment_method_module_1 = __webpack_require__(399);
const api_payment_module_1 = __webpack_require__(406);
const api_permission_module_1 = __webpack_require__(415);
const api_prescription_sample_module_1 = __webpack_require__(421);
const api_print_html_module_1 = __webpack_require__(428);
const api_procedure_group_module_1 = __webpack_require__(435);
const api_procedure_module_1 = __webpack_require__(442);
const api_product_group_module_1 = __webpack_require__(449);
const api_product_movement_module_1 = __webpack_require__(456);
const api_product_module_1 = __webpack_require__(462);
const api_radiology_group_module_1 = __webpack_require__(470);
const api_radiology_module_1 = __webpack_require__(477);
const api_receipt_item_module_1 = __webpack_require__(486);
const api_receipt_module_1 = __webpack_require__(493);
const api_role_module_1 = __webpack_require__(502);
const api_setting_module_1 = __webpack_require__(509);
const api_statistic_module_1 = __webpack_require__(514);
const api_stock_check_module_1 = __webpack_require__(528);
const api_ticket_batch_module_1 = __webpack_require__(535);
const api_ticket_clinic_module_1 = __webpack_require__(541);
const api_ticket_laboratory_module_1 = __webpack_require__(599);
const api_ticket_order_module_1 = __webpack_require__(605);
const api_ticket_procedure_module_1 = __webpack_require__(614);
const api_ticket_product_module_1 = __webpack_require__(620);
const api_ticket_radiology_module_1 = __webpack_require__(626);
const api_ticket_module_1 = __webpack_require__(632);
const api_user_role_module_1 = __webpack_require__(635);
const api_user_module_1 = __webpack_require__(641);
const api_warehouse_module_1 = __webpack_require__(650);
let ApiModule = class ApiModule {
};
exports.ApiModule = ApiModule;
exports.ApiModule = ApiModule = __decorate([
    (0, common_1.Module)({
        imports: [
            api_appointment_module_1.ApiAppointmentModule,
            api_batch_module_1.ApiBatchModule,
            api_customer_module_1.ApiCustomerModule,
            api_customer_source_module_1.ApiCustomerSourceModule,
            api_distributor_module_1.ApiDistributorModule,
            api_permission_module_1.ApiPermissionModule,
            api_procedure_module_1.ApiProcedureModule,
            api_product_module_1.ApiProductModule,
            api_product_movement_module_1.ApiProductMovementModule,
            api_receipt_module_1.ApiReceiptModule,
            api_receipt_item_module_1.ApiReceiptItemModule,
            api_statistic_module_1.ApiStatisticModule,
            api_setting_module_1.ApiSettingModule,
            api_organization_module_1.ApiOrganizationModule,
            api_role_module_1.ApiRoleModule,
            api_commission_module_1.ApiCommissionModule,
            api_user_module_1.ApiUserModule,
            api_user_role_module_1.ApiUserRoleModule,
            api_laboratory_module_1.ApiLaboratoryModule,
            api_laboratory_group_module_1.ApiLaboratoryGroupModule,
            api_laboratory_kit_module_1.ApiLaboratoryKitModule,
            api_radiology_module_1.ApiRadiologyModule,
            api_radiology_group_module_1.ApiRadiologyGroupModule,
            api_prescription_sample_module_1.ApiPrescriptionSampleModule,
            api_warehouse_module_1.ApiWarehouseModule,
            api_product_group_module_1.ApiProductGroupModule,
            api_procedure_group_module_1.ApiProcedureGroupModule,
            api_print_html_module_1.ApiPrintHtmlModule,
            api_ticket_module_1.ApiTicketModule,
            api_ticket_order_module_1.ApiTicketOrderModule,
            api_ticket_procedure_module_1.ApiTicketProcedureModule,
            api_ticket_product_module_1.ApiTicketProductModule,
            api_ticket_batch_module_1.ApiTicketBatchModule,
            api_ticket_clinic_module_1.ApiTicketClinicModule,
            api_ticket_laboratory_module_1.ApiTicketLaboratoryModule,
            api_ticket_radiology_module_1.ApiTicketRadiologyModule,
            api_payment_method_module_1.ApiPaymentMethodModule,
            api_stock_check_module_1.ApiStockCheckModule,
            api_payment_module_1.ApiPaymentModule,
        ],
        controllers: [],
        providers: [],
    })
], ApiModule);


/***/ }),
/* 322 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentModule = void 0;
const common_1 = __webpack_require__(3);
const api_appointment_controller_1 = __webpack_require__(323);
const api_appointment_service_1 = __webpack_require__(324);
let ApiAppointmentModule = class ApiAppointmentModule {
};
exports.ApiAppointmentModule = ApiAppointmentModule;
exports.ApiAppointmentModule = ApiAppointmentModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_appointment_controller_1.ApiAppointmentController],
        providers: [api_appointment_service_1.ApiAppointmentService],
    })
], ApiAppointmentModule);


/***/ }),
/* 323 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_appointment_service_1 = __webpack_require__(324);
const request_1 = __webpack_require__(325);
let ApiAppointmentController = class ApiAppointmentController {
    constructor(apiAppointmentService) {
        this.apiAppointmentService = apiAppointmentService;
    }
    pagination({ oid }, query) {
        return this.apiAppointmentService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiAppointmentService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiAppointmentService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiAppointmentService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiAppointmentService.updateOne(oid, +id, body);
    }
    async deleteOne({ oid }, { id }) {
        return await this.apiAppointmentService.deleteOne(oid, id);
    }
    async registerTicketClinic({ oid }, { id }, body) {
        return await this.apiAppointmentService.registerTicketClinic({
            oid,
            appointmentId: id,
            body,
        });
    }
};
exports.ApiAppointmentController = ApiAppointmentController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.AppointmentPaginationQuery !== "undefined" && request_1.AppointmentPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiAppointmentController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.AppointmentGetManyQuery !== "undefined" && request_1.AppointmentGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiAppointmentController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.AppointmentGetOneQuery !== "undefined" && request_1.AppointmentGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.AppointmentCreateBody !== "undefined" && request_1.AppointmentCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.AppointmentUpdateBody !== "undefined" && request_1.AppointmentUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Post)(':id/register-ticket-clinic'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.APPOINTMENT_REGISTER_TICKET),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _s : Object, typeof (_t = typeof request_1.AppointmentRegisterTicketClinicBody !== "undefined" && request_1.AppointmentRegisterTicketClinicBody) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "registerTicketClinic", null);
exports.ApiAppointmentController = ApiAppointmentController = __decorate([
    (0, swagger_1.ApiTags)('Appointment'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('appointment'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_appointment_service_1.ApiAppointmentService !== "undefined" && api_appointment_service_1.ApiAppointmentService) === "function" ? _a : Object])
], ApiAppointmentController);


/***/ }),
/* 324 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const time_helper_1 = __webpack_require__(146);
const appointment_entity_1 = __webpack_require__(44);
const ticket_entity_1 = __webpack_require__(56);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiAppointmentService = class ApiAppointmentService {
    constructor(socketEmitService, appointmentRepository, customerRepository, ticketRepository, ticketAttributeRepository) {
        this.socketEmitService = socketEmitService;
        this.appointmentRepository = appointmentRepository;
        this.customerRepository = customerRepository;
        this.ticketRepository = ticketRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.appointmentRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                appointmentStatus: filter === null || filter === void 0 ? void 0 : filter.appointmentStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter } = query;
        const data = await this.appointmentRepository.findMany({
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                appointmentStatus: filter === null || filter === void 0 ? void 0 : filter.appointmentStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const appointment = await this.appointmentRepository.findOneBy({ oid, id });
        if (!appointment) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'Appointment' });
        }
        return { data: { appointment } };
    }
    async createOne(oid, body) {
        const { customerId: cid, customer } = body, ticketBody = __rest(body, ["customerId", "customer"]);
        let customerId = cid;
        if (!customerId) {
            customerId = await this.customerRepository.insertOneFullField(Object.assign(Object.assign({}, body.customer), { debt: 0, oid }));
        }
        const appointment = await this.appointmentRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, ticketBody), { customerId, toTicketId: 0, cancelReason: '', oid }));
        return { data: { appointment } };
    }
    async updateOne(oid, id, body) {
        const [appointment] = await this.appointmentRepository.updateAndReturnEntity({ oid, id }, body);
        if (!appointment) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Appointment',
            });
        }
        return { data: { appointment } };
    }
    async deleteOne(oid, id) {
        const affected = await this.appointmentRepository.delete({
            oid,
            id,
            appointmentStatus: {
                IN: [appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Cancelled],
            },
        });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: { appointmentId: id } };
    }
    async registerTicketClinic(options) {
        const { oid, appointmentId, body } = options;
        const appointment = await this.appointmentRepository.findOneBy({ oid, id: appointmentId });
        const customer = await this.customerRepository.findOneBy({ oid, id: appointment.customerId });
        const countToday = await this.ticketRepository.countToday(oid);
        const registeredAt = body.registeredAt;
        const ticket = await this.ticketRepository.insertOneAndReturnEntity({
            oid,
            customerId: customer.id,
            status: ticket_entity_1.TicketStatus.Schedule,
            ticketType: body.ticketType,
            registeredAt,
            dailyIndex: countToday + 1,
            year: time_helper_1.ESTimer.info(registeredAt, 7).year,
            month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1,
            date: time_helper_1.ESTimer.info(registeredAt, 7).date,
        });
        if (appointment.reason) {
            ticket.ticketAttributeList =
                await this.ticketAttributeRepository.insertManyFullFieldAndReturnEntity([
                    {
                        key: 'reason',
                        value: appointment.reason || '',
                        oid,
                        ticketId: ticket.id,
                    },
                ]);
        }
        ticket.customer = customer;
        this.socketEmitService.ticketClinicChange(oid, { type: 'CREATE', ticket });
        await this.appointmentRepository.updateAndReturnEntity({ oid, id: appointmentId }, {
            appointmentStatus: appointment_entity_1.AppointmentStatus.Completed,
            toTicketId: ticket.id,
        });
        return { data: { appointmentId } };
    }
};
exports.ApiAppointmentService = ApiAppointmentService;
exports.ApiAppointmentService = ApiAppointmentService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _e : Object])
], ApiAppointmentService);


/***/ }),
/* 325 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(326), exports);
__exportStar(__webpack_require__(327), exports);
__exportStar(__webpack_require__(328), exports);
__exportStar(__webpack_require__(329), exports);


/***/ }),
/* 326 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentGetOneQuery = exports.AppointmentGetManyQuery = exports.AppointmentPaginationQuery = exports.AppointmentGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const appointment_entity_1 = __webpack_require__(44);
const appointment_options_request_1 = __webpack_require__(327);
class AppointmentGetQuery {
}
exports.AppointmentGetQuery = AppointmentGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof appointment_options_request_1.AppointmentRelationQuery !== "undefined" && appointment_options_request_1.AppointmentRelationQuery) === "function" ? _a : Object)
], AppointmentGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 3,
            registeredAt: { GT: Date.now() },
            appointmentStatus: { IN: [appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Waiting] },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof appointment_options_request_1.AppointmentFilterQuery !== "undefined" && appointment_options_request_1.AppointmentFilterQuery) === "function" ? _b : Object)
], AppointmentGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            registeredAt: 'DESC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof appointment_options_request_1.AppointmentSortQuery !== "undefined" && appointment_options_request_1.AppointmentSortQuery) === "function" ? _c : Object)
], AppointmentGetQuery.prototype, "sort", void 0);
class AppointmentPaginationQuery extends (0, swagger_1.IntersectionType)(AppointmentGetQuery, query_1.PaginationQuery) {
}
exports.AppointmentPaginationQuery = AppointmentPaginationQuery;
class AppointmentGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(AppointmentGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.AppointmentGetManyQuery = AppointmentGetManyQuery;
class AppointmentGetOneQuery extends (0, swagger_1.PickType)(AppointmentGetQuery, ['relation']) {
}
exports.AppointmentGetOneQuery = AppointmentGetOneQuery;


/***/ }),
/* 327 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentSortQuery = exports.AppointmentFilterQuery = exports.AppointmentRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
const class_validator_custom_1 = __webpack_require__(247);
const appointment_entity_1 = __webpack_require__(44);
class AppointmentRelationQuery {
}
exports.AppointmentRelationQuery = AppointmentRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], AppointmentRelationQuery.prototype, "customer", void 0);
const ConditionEnumAppointmentStatus = (0, dto_1.createConditionEnum)(appointment_entity_1.AppointmentStatus);
class AppointmentFilterQuery {
}
exports.AppointmentFilterQuery = AppointmentFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], AppointmentFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, appointment_entity_1.AppointmentStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], AppointmentFilterQuery.prototype, "appointmentStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _c : Object)
], AppointmentFilterQuery.prototype, "registeredAt", void 0);
class AppointmentSortQuery extends query_1.SortQuery {
}
exports.AppointmentSortQuery = AppointmentSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], AppointmentSortQuery.prototype, "registeredAt", void 0);


/***/ }),
/* 328 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentRegisterTicketClinicBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const ticket_entity_1 = __webpack_require__(56);
class AppointmentRegisterTicketClinicBody {
}
exports.AppointmentRegisterTicketClinicBody = AppointmentRegisterTicketClinicBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentRegisterTicketClinicBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: ticket_entity_1.TicketType.Clinic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(ticket_entity_1.TicketType),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.TicketType !== "undefined" && ticket_entity_1.TicketType) === "function" ? _a : Object)
], AppointmentRegisterTicketClinicBody.prototype, "ticketType", void 0);


/***/ }),
/* 329 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentUpdateBody = exports.AppointmentCreateBody = exports.AppointmentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const appointment_entity_1 = __webpack_require__(44);
const request_1 = __webpack_require__(330);
class AppointmentBody {
}
exports.AppointmentBody = AppointmentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 0 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "fromTicketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng đến chăm sóc da' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AppointmentBody.prototype, "reason", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "customerSourceId", void 0);
class AppointmentCreateBody extends AppointmentBody {
}
exports.AppointmentCreateBody = AppointmentCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentCreateBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.CustomerCreateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.CustomerCreateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _a : Object)
], AppointmentCreateBody.prototype, "customer", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: appointment_entity_1.AppointmentStatus.Confirm }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(appointment_entity_1.AppointmentStatus),
    (0, class_validator_1.IsIn)([appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm]),
    __metadata("design:type", typeof (_b = typeof appointment_entity_1.AppointmentStatus !== "undefined" && appointment_entity_1.AppointmentStatus) === "function" ? _b : Object)
], AppointmentCreateBody.prototype, "appointmentStatus", void 0);
class AppointmentUpdateBody extends AppointmentBody {
}
exports.AppointmentUpdateBody = AppointmentUpdateBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: appointment_entity_1.AppointmentStatus.Confirm }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(appointment_entity_1.AppointmentStatus),
    (0, class_validator_1.IsIn)([appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Cancelled]),
    __metadata("design:type", typeof (_c = typeof appointment_entity_1.AppointmentStatus !== "undefined" && appointment_entity_1.AppointmentStatus) === "function" ? _c : Object)
], AppointmentUpdateBody.prototype, "appointmentStatus", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng thay đổi kế hoạch' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AppointmentUpdateBody.prototype, "cancelReason", void 0);


/***/ }),
/* 330 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(331), exports);
__exportStar(__webpack_require__(332), exports);
__exportStar(__webpack_require__(333), exports);


/***/ }),
/* 331 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerGetOneQuery = exports.CustomerGetManyQuery = exports.CustomerPaginationQuery = exports.CustomerGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const customer_options_request_1 = __webpack_require__(332);
class CustomerGetQuery {
}
exports.CustomerGetQuery = CustomerGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof customer_options_request_1.CustomerRelationQuery !== "undefined" && customer_options_request_1.CustomerRelationQuery) === "function" ? _a : Object)
], CustomerGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            searchText: 'ax',
            isActive: 1,
            debt: { GTE: 1000000 },
            updatedAt: { GT: Date.now() },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof customer_options_request_1.CustomerFilterQuery !== "undefined" && customer_options_request_1.CustomerFilterQuery) === "function" ? _b : Object)
], CustomerGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            debt: 'DESC',
            fullName: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof customer_options_request_1.CustomerSortQuery !== "undefined" && customer_options_request_1.CustomerSortQuery) === "function" ? _c : Object)
], CustomerGetQuery.prototype, "sort", void 0);
class CustomerPaginationQuery extends (0, swagger_1.IntersectionType)(CustomerGetQuery, query_1.PaginationQuery) {
}
exports.CustomerPaginationQuery = CustomerPaginationQuery;
class CustomerGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(CustomerGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.CustomerGetManyQuery = CustomerGetManyQuery;
class CustomerGetOneQuery extends (0, swagger_1.PickType)(CustomerGetQuery, ['relation']) {
}
exports.CustomerGetOneQuery = CustomerGetOneQuery;


/***/ }),
/* 332 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSortQuery = exports.CustomerFilterQuery = exports.CustomerRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_number_1 = __webpack_require__(289);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class CustomerRelationQuery {
}
exports.CustomerRelationQuery = CustomerRelationQuery;
class CustomerFilterQuery {
}
exports.CustomerFilterQuery = CustomerFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], CustomerFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], CustomerFilterQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], CustomerFilterQuery.prototype, "updatedAt", void 0);
class CustomerSortQuery extends query_1.SortQuery {
}
exports.CustomerSortQuery = CustomerSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CustomerSortQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CustomerSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 333 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerUpdateBody = exports.CustomerCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class CustomerCreateBody {
}
exports.CustomerCreateBody = CustomerCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "facebook", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "zalo", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "customerSourceId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1998 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "yearOfBirth", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], CustomerCreateBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Hưng Yên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Huyện Khoái Châu' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressDistrict", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Dạ Trạch' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Đức Nhuận' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Mẹ Nguyễn Thị Hương, sđt: 0988021146' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "relative", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Mổ ruột thừa năm 2018' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "healthHistory", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng không' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "isActive", void 0);
class CustomerUpdateBody extends (0, swagger_1.PartialType)(CustomerCreateBody) {
}
exports.CustomerUpdateBody = CustomerUpdateBody;


/***/ }),
/* 334 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchModule = void 0;
const common_1 = __webpack_require__(3);
const api_batch_controller_1 = __webpack_require__(335);
const api_batch_service_1 = __webpack_require__(336);
let ApiBatchModule = class ApiBatchModule {
};
exports.ApiBatchModule = ApiBatchModule;
exports.ApiBatchModule = ApiBatchModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_batch_controller_1.ApiBatchController],
        providers: [api_batch_service_1.ApiBatchService],
    })
], ApiBatchModule);


/***/ }),
/* 335 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_batch_service_1 = __webpack_require__(336);
const request_1 = __webpack_require__(337);
let ApiBatchController = class ApiBatchController {
    constructor(apiBatchService) {
        this.apiBatchService = apiBatchService;
    }
    async pagination({ oid }, query) {
        return this.apiBatchService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiBatchService.getList(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiBatchService.getOne(oid, id, query);
    }
    async updateInfo({ oid }, { id }, body) {
        return await this.apiBatchService.updateInfo(oid, id, body);
    }
    async updateInfoAndQuantity({ oid, uid }, { id }, body) {
        return await this.apiBatchService.updateInfoAndQuantity({ oid, batchId: id, body, userId: uid });
    }
    async deleteOne({ oid }, { id }) {
        return await this.apiBatchService.destroyOne({ oid, batchId: id });
    }
    async batchMerge({ oid, uid }, body) {
        return await this.apiBatchService.batchMerge({ oid, body });
    }
};
exports.ApiBatchController = ApiBatchController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.BATCH_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.BatchPaginationQuery !== "undefined" && request_1.BatchPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.BATCH_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.BatchGetManyQuery !== "undefined" && request_1.BatchGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.BATCH_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.BatchGetOneQuery !== "undefined" && request_1.BatchGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "detail", null);
__decorate([
    (0, common_1.Patch)('update-info/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.BATCH_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_1.BatchUpdateInfoBody !== "undefined" && request_1.BatchUpdateInfoBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "updateInfo", null);
__decorate([
    (0, common_1.Patch)('update-info-and-quantity-and-cost-price/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.BATCH_CHANGE_QUANTITY_AND_COST_PRICE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.BatchUpdateInfoAndQuantityBody !== "undefined" && request_1.BatchUpdateInfoAndQuantityBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "updateInfoAndQuantity", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Patch)('merge-batch'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_MERGE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_1.BatchMergeBody !== "undefined" && request_1.BatchMergeBody) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiBatchController.prototype, "batchMerge", null);
exports.ApiBatchController = ApiBatchController = __decorate([
    (0, swagger_1.ApiTags)('Batch'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('batch'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_batch_service_1.ApiBatchService !== "undefined" && api_batch_service_1.ApiBatchService) === "function" ? _a : Object])
], ApiBatchController);


/***/ }),
/* 336 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const variable_1 = __webpack_require__(21);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiBatchService = class ApiBatchService {
    constructor(socketEmitService, cacheDataService, organizationRepository, batchRepository, ticketBatchRepository, receiptItemRepository, productMovementRepository, productOperation) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.batchRepository = batchRepository;
        this.ticketBatchRepository = ticketBatchRepository;
        this.receiptItemRepository = receiptItemRepository;
        this.productMovementRepository = productMovementRepository;
        this.productOperation = productOperation;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { total, data } = await this.batchRepository.pagination({
            relation,
            relationLoadStrategy: 'query',
            page,
            limit,
            condition: {
                oid,
                id: filter === null || filter === void 0 ? void 0 : filter.id,
                warehouseId: filter === null || filter === void 0 ? void 0 : filter.warehouseId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                expiryDate: filter === null || filter === void 0 ? void 0 : filter.expiryDate,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getList(oid, query) {
        const { limit, filter, relation, sort } = query;
        const batchList = await this.batchRepository.findMany({
            relation,
            relationLoadStrategy: 'query',
            condition: {
                oid,
                id: filter === null || filter === void 0 ? void 0 : filter.id,
                warehouseId: filter === null || filter === void 0 ? void 0 : filter.warehouseId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                expiryDate: filter === null || filter === void 0 ? void 0 : filter.expiryDate,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
            },
            limit,
            sort: sort || undefined,
        });
        return { data: { batchList } };
    }
    async getOne(oid, id, query) {
        const batch = await this.batchRepository.findOne({
            relation: query.relation,
            condition: { oid, id },
        });
        return { data: { batch } };
    }
    async updateInfo(oid, id, body) {
        const batch = await this.batchRepository.updateOneAndReturnEntity({ id, oid }, body);
        return { data: { batch } };
    }
    async updateInfoAndQuantity(options) {
        const { oid, batchId, userId, body } = options;
        const batchOrigin = await this.batchRepository.findOne({
            relation: { product: true },
            condition: { oid, id: batchId },
        });
        const batchUpdated = await this.batchRepository.updateOneAndReturnEntity({ id: batchId, oid }, {
            batchCode: body.batchCode,
            expiryDate: body.expiryDate,
            warehouseId: body.warehouseId,
            distributorId: body.distributorId,
            costPrice: body.costPrice,
            quantity: body.quantity,
            costAmount: body.costAmount,
        });
        if (batchOrigin.quantity === batchUpdated.quantity
            && batchOrigin.costAmount === batchUpdated.costAmount) {
            return { data: { batch: batchUpdated } };
        }
        const productUpdated = await this.productOperation.reCalculateQuantityBySumBatch({
            oid,
            productId: batchOrigin.productId,
        });
        const productMovement = {
            oid,
            movementType: variable_1.MovementType.UserChange,
            contactId: userId,
            voucherId: 0,
            voucherProductId: 0,
            warehouseId: batchOrigin.warehouseId,
            productId: batchOrigin.productId,
            batchId: batchOrigin.id,
            isRefund: 0,
            quantity: batchUpdated.quantity - batchOrigin.quantity,
            costAmount: batchUpdated.costAmount - batchOrigin.costAmount,
            openQuantityProduct: batchOrigin.product.quantity,
            closeQuantityProduct: productUpdated.quantity,
            openQuantityBatch: batchOrigin.quantity,
            closeQuantityBatch: batchUpdated.quantity,
            openCostAmountBatch: batchOrigin.costAmount,
            closeCostAmountBatch: batchUpdated.costAmount,
            actualPrice: batchUpdated.costPrice,
            expectedPrice: batchOrigin.costPrice,
            createdAt: Date.now(),
        };
        this.productMovementRepository.insertOneFullField(productMovement);
        this.socketEmitService.productUpsert(oid, { product: productUpdated });
        return { data: { batch: batchUpdated, product: productUpdated } };
    }
    async destroyOne(options) {
        const { oid, batchId } = options;
        const [receiptItemList, ticketBatchList] = await Promise.all([
            this.receiptItemRepository.findMany({
                condition: { oid, batchId },
                limit: 10,
            }),
            this.ticketBatchRepository.findMany({
                condition: { oid, batchId },
                limit: 10,
            }),
        ]);
        if (receiptItemList.length > 0 || ticketBatchList.length > 0) {
            return {
                data: { receiptItemList, ticketBatchList },
                success: false,
            };
        }
        await this.batchRepository.delete({ oid, id: batchId });
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        return { data: { batchId, receiptItemList: [], ticketBatchList: [] } };
    }
    async batchMerge(options) {
        const { oid, body } = options;
        const { batchIdSourceList, batchIdTarget, productId } = body;
        batchIdSourceList.forEach((i) => {
            if (isNaN(i) || i <= 0) {
                throw new exception_filter_1.BusinessException('error.ValidateFailed');
            }
        });
        await this.batchRepository.mergeBatch({
            oid,
            productId,
            batchIdSourceList,
            batchIdTarget,
        });
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        return { data: true };
    }
};
exports.ApiBatchService = ApiBatchService;
exports.ApiBatchService = ApiBatchService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.OrganizationRepository !== "undefined" && repositories_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketBatchRepository !== "undefined" && repositories_1.TicketBatchRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ReceiptItemRepository !== "undefined" && repositories_1.ReceiptItemRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.ProductMovementRepository !== "undefined" && repositories_1.ProductMovementRepository) === "function" ? _g : Object, typeof (_h = typeof operations_1.ProductOperation !== "undefined" && operations_1.ProductOperation) === "function" ? _h : Object])
], ApiBatchService);


/***/ }),
/* 337 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(338), exports);
__exportStar(__webpack_require__(340), exports);
__exportStar(__webpack_require__(339), exports);
__exportStar(__webpack_require__(341), exports);


/***/ }),
/* 338 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchGetOneQuery = exports.BatchGetManyQuery = exports.BatchPaginationQuery = exports.BatchGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const batch_options_request_1 = __webpack_require__(339);
class BatchGetQuery {
}
exports.BatchGetQuery = BatchGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ product: true }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof batch_options_request_1.BatchRelationQuery !== "undefined" && batch_options_request_1.BatchRelationQuery) === "function" ? _a : Object)
], BatchGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ quantity: { GT: 10 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof batch_options_request_1.BatchFilterQuery !== "undefined" && batch_options_request_1.BatchFilterQuery) === "function" ? _b : Object)
], BatchGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'ASC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof batch_options_request_1.BatchSortQuery !== "undefined" && batch_options_request_1.BatchSortQuery) === "function" ? _c : Object)
], BatchGetQuery.prototype, "sort", void 0);
class BatchPaginationQuery extends (0, swagger_1.IntersectionType)(BatchGetQuery, query_1.PaginationQuery) {
}
exports.BatchPaginationQuery = BatchPaginationQuery;
class BatchGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(BatchGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.BatchGetManyQuery = BatchGetManyQuery;
class BatchGetOneQuery extends (0, swagger_1.PickType)(BatchGetQuery, ['relation']) {
}
exports.BatchGetOneQuery = BatchGetOneQuery;


/***/ }),
/* 339 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchSortQuery = exports.BatchFilterQuery = exports.BatchRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class BatchRelationQuery {
}
exports.BatchRelationQuery = BatchRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], BatchRelationQuery.prototype, "product", void 0);
class BatchFilterQuery {
}
exports.BatchFilterQuery = BatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "warehouseId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _e : Object)
], BatchFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], BatchFilterQuery.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_g = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _g : Object)
], BatchFilterQuery.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_h = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _h : Object)
], BatchFilterQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => BatchFilterQuery),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], BatchFilterQuery.prototype, "$OR", void 0);
class BatchSortQuery extends query_1.SortQuery {
}
exports.BatchSortQuery = BatchSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "productId", void 0);


/***/ }),
/* 340 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchMergeBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class BatchMergeBody {
}
exports.BatchMergeBody = BatchMergeBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], BatchMergeBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], BatchMergeBody.prototype, "batchIdSourceList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], BatchMergeBody.prototype, "batchIdTarget", void 0);


/***/ }),
/* 341 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchUpdateInfoAndQuantityBody = exports.BatchUpdateInfoBody = exports.BatchInsertBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class BatchInsertBody {
}
exports.BatchInsertBody = BatchInsertBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], BatchInsertBody.prototype, "batchCode", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "expiryDate", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "costPrice", void 0);
class BatchUpdateInfoBody extends (0, swagger_1.PickType)(BatchInsertBody, [
    'batchCode',
    'expiryDate',
    'warehouseId',
]) {
}
exports.BatchUpdateInfoBody = BatchUpdateInfoBody;
class BatchUpdateInfoAndQuantityBody extends (0, swagger_1.PickType)(BatchInsertBody, [
    'batchCode',
    'expiryDate',
    'warehouseId',
    'distributorId',
    'costPrice',
]) {
}
exports.BatchUpdateInfoAndQuantityBody = BatchUpdateInfoAndQuantityBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], BatchUpdateInfoAndQuantityBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], BatchUpdateInfoAndQuantityBody.prototype, "costAmount", void 0);


/***/ }),
/* 342 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCommissionModule = void 0;
const common_1 = __webpack_require__(3);
const api_commission_controller_1 = __webpack_require__(343);
const api_commission_service_1 = __webpack_require__(344);
let ApiCommissionModule = class ApiCommissionModule {
};
exports.ApiCommissionModule = ApiCommissionModule;
exports.ApiCommissionModule = ApiCommissionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_commission_controller_1.ApiCommissionController],
        providers: [api_commission_service_1.ApiCommissionService],
    })
], ApiCommissionModule);


/***/ }),
/* 343 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCommissionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_commission_service_1 = __webpack_require__(344);
const request_1 = __webpack_require__(345);
let ApiCommissionController = class ApiCommissionController {
    constructor(apiCommissionService) {
        this.apiCommissionService = apiCommissionService;
    }
    pagination({ oid }, query) {
        return this.apiCommissionService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiCommissionService.getMany(oid, query);
    }
    findOne({ oid }, { id }, query) {
        return this.apiCommissionService.getOne(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiCommissionService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiCommissionService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiCommissionService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiCommissionService.replaceList(oid, body);
    }
};
exports.ApiCommissionController = ApiCommissionController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.CommissionPaginationQuery !== "undefined" && request_1.CommissionPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiCommissionController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.CommissionGetManyQuery !== "undefined" && request_1.CommissionGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiCommissionController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.CommissionGetOneQuery !== "undefined" && request_1.CommissionGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", void 0)
], ApiCommissionController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.COMMISSION_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.CommissionCreateBody !== "undefined" && request_1.CommissionCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiCommissionController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.COMMISSION_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.CommissionUpdateBody !== "undefined" && request_1.CommissionUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiCommissionController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.COMMISSION_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiCommissionController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.COMMISSION_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.CommissionReplaceListBody !== "undefined" && request_1.CommissionReplaceListBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiCommissionController.prototype, "replaceAll", null);
exports.ApiCommissionController = ApiCommissionController = __decorate([
    (0, swagger_1.ApiTags)('Commission'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('commission'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_commission_service_1.ApiCommissionService !== "undefined" && api_commission_service_1.ApiCommissionService) === "function" ? _a : Object])
], ApiCommissionController);


/***/ }),
/* 344 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCommissionService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const commission_entity_1 = __webpack_require__(75);
const repositories_1 = __webpack_require__(170);
const commission_repository_1 = __webpack_require__(173);
let ApiCommissionService = class ApiCommissionService {
    constructor(commissionRepository, productRepository, procedureRepository, radiologyRepository, laboratoryRepository) {
        this.commissionRepository = commissionRepository;
        this.productRepository = productRepository;
        this.procedureRepository = procedureRepository;
        this.radiologyRepository = radiologyRepository;
        this.laboratoryRepository = laboratoryRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.commissionRepository.pagination({
            relation: {
                role: relation === null || relation === void 0 ? void 0 : relation.role,
            },
            page,
            limit,
            condition: {
                oid,
                interactType: filter === null || filter === void 0 ? void 0 : filter.interactType,
                roleId: filter === null || filter === void 0 ? void 0 : filter.roleId,
                interactId: filter === null || filter === void 0 ? void 0 : filter.interactId,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation(data, query.relation);
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.commissionRepository.findMany({
            relation: {
                role: relation === null || relation === void 0 ? void 0 : relation.role,
            },
            condition: {
                oid,
                interactType: filter === null || filter === void 0 ? void 0 : filter.interactType,
                roleId: filter === null || filter === void 0 ? void 0 : filter.roleId,
                interactId: filter === null || filter === void 0 ? void 0 : filter.interactId,
            },
            limit,
            sort,
        });
        if (query.relation) {
            await this.generateRelation(data, query.relation);
        }
        return { data };
    }
    async getOne(oid, id, query) {
        var _a;
        const commission = await this.commissionRepository.findOne({
            relation: { role: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.role },
            condition: { oid, id },
        });
        if (!commission)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation([commission], query.relation);
        }
        return { data: { commission } };
    }
    async createOne(oid, body) {
        const existCommission = await this.commissionRepository.findOneBy({
            oid,
            roleId: body.roleId,
            interactType: body.interactType,
            interactId: body.interactId,
        });
        if (existCommission) {
            throw new exception_filter_1.BusinessException('error.Conflict', {
                obj: `Không thể tạo bản ghi trùng lặp. `
                    + `Đã tồn tại bản ghi nội dung tương tự với id = ${existCommission.id}`,
            });
        }
        const commission = await this.commissionRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { commission } };
    }
    async updateOne(oid, id, body) {
        const existCommission = await this.commissionRepository.findOneBy({
            id: { NOT: id },
            oid,
            roleId: body.roleId,
            interactType: body.interactType,
            interactId: body.interactId,
        });
        if (existCommission) {
            throw new exception_filter_1.BusinessException('error.Conflict', {
                obj: `Không thể tạo bản ghi trùng lặp. `
                    + `Đã tồn tại bản ghi nội dung tương tự với id = ${existCommission.id}`,
            });
        }
        const commissionList = await this.commissionRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { commission: commissionList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.commissionRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceList(oid, body) {
        var _a;
        await this.commissionRepository.delete({
            oid,
            interactType: (_a = body.filter) === null || _a === void 0 ? void 0 : _a.interactType,
        });
        const commissionInsertListDto = body.commissionData.map((i) => {
            const dto = Object.assign(Object.assign({}, i), { oid });
            return dto;
        });
        const commissionList = await this.commissionRepository.insertManyAndReturnEntity(commissionInsertListDto);
        return { data: { commissionList } };
    }
    async generateRelation(data, relation) {
        const productIdList = data
            .filter((i) => i.interactType === commission_entity_1.InteractType.Product)
            .map((i) => i.interactId);
        const procedureIdList = data
            .filter((i) => i.interactType === commission_entity_1.InteractType.Procedure)
            .map((i) => i.interactId);
        const radiologyIdList = data
            .filter((i) => i.interactType === commission_entity_1.InteractType.Radiology)
            .map((i) => i.interactId);
        const laboratoryIdList = data
            .filter((i) => i.interactType === commission_entity_1.InteractType.Laboratory)
            .map((i) => i.interactId);
        const [productList, procedureList, radiologyList, laboratoryList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.product) && productIdList.length
                ? this.productRepository.findManyBy({ id: { IN: (0, object_helper_1.uniqueArray)(productIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.procedure) && procedureIdList.length
                ? this.procedureRepository.findMany({
                    condition: { id: { IN: (0, object_helper_1.uniqueArray)(procedureIdList) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.radiology) && radiologyIdList.length
                ? this.radiologyRepository.findManyBy({ id: { IN: (0, object_helper_1.uniqueArray)(radiologyIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.laboratory) && laboratoryIdList.length
                ? this.laboratoryRepository.findMany({
                    condition: { id: { IN: (0, object_helper_1.uniqueArray)(laboratoryIdList) } },
                })
                : [],
        ]);
        data.forEach((commission) => {
            if (commission.interactType === commission_entity_1.InteractType.Product) {
                commission.product = productList.find((i) => i.id === commission.interactId);
            }
            if (commission.interactType === commission_entity_1.InteractType.Procedure) {
                commission.procedure = procedureList.find((i) => i.id === commission.interactId);
            }
            if (commission.interactType === commission_entity_1.InteractType.Radiology) {
                commission.radiology = radiologyList.find((i) => i.id === commission.interactId);
            }
            if (commission.interactType === commission_entity_1.InteractType.Laboratory) {
                commission.laboratory = laboratoryList.find((i) => i.id === commission.interactId);
            }
        });
        return data;
    }
};
exports.ApiCommissionService = ApiCommissionService;
exports.ApiCommissionService = ApiCommissionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof commission_repository_1.CommissionRepository !== "undefined" && commission_repository_1.CommissionRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.LaboratoryRepository !== "undefined" && repositories_1.LaboratoryRepository) === "function" ? _e : Object])
], ApiCommissionService);


/***/ }),
/* 345 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(346), exports);
__exportStar(__webpack_require__(347), exports);
__exportStar(__webpack_require__(348), exports);


/***/ }),
/* 346 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionGetOneQuery = exports.CommissionGetManyQuery = exports.CommissionPaginationQuery = exports.CommissionGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const commission_entity_1 = __webpack_require__(75);
const commission_options_request_1 = __webpack_require__(347);
class CommissionGetQuery {
}
exports.CommissionGetQuery = CommissionGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(commission_options_request_1.CommissionRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof commission_options_request_1.CommissionRelationQuery !== "undefined" && commission_options_request_1.CommissionRelationQuery) === "function" ? _a : Object)
], CommissionGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            interactType: commission_entity_1.InteractType.Ticket,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(commission_options_request_1.CommissionFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof commission_options_request_1.CommissionFilterQuery !== "undefined" && commission_options_request_1.CommissionFilterQuery) === "function" ? _b : Object)
], CommissionGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(commission_options_request_1.CommissionSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof commission_options_request_1.CommissionSortQuery !== "undefined" && commission_options_request_1.CommissionSortQuery) === "function" ? _c : Object)
], CommissionGetQuery.prototype, "sort", void 0);
class CommissionPaginationQuery extends (0, swagger_1.IntersectionType)(CommissionGetQuery, query_1.PaginationQuery) {
}
exports.CommissionPaginationQuery = CommissionPaginationQuery;
class CommissionGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(CommissionGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.CommissionGetManyQuery = CommissionGetManyQuery;
class CommissionGetOneQuery extends (0, swagger_1.PickType)(CommissionGetQuery, ['relation']) {
}
exports.CommissionGetOneQuery = CommissionGetOneQuery;


/***/ }),
/* 347 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionSortQuery = exports.CommissionFilterQuery = exports.CommissionRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const commission_entity_1 = __webpack_require__(75);
const ConditionEnumInteractType = (0, dto_1.createConditionEnum)(commission_entity_1.InteractType);
class CommissionRelationQuery {
}
exports.CommissionRelationQuery = CommissionRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], CommissionRelationQuery.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], CommissionRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], CommissionRelationQuery.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], CommissionRelationQuery.prototype, "laboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], CommissionRelationQuery.prototype, "radiology", void 0);
class CommissionFilterQuery {
}
exports.CommissionFilterQuery = CommissionFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, commission_entity_1.InteractType)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], CommissionFilterQuery.prototype, "interactType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CommissionFilterQuery.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], CommissionFilterQuery.prototype, "interactId", void 0);
class CommissionSortQuery extends query_1.SortQuery {
}
exports.CommissionSortQuery = CommissionSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CommissionSortQuery.prototype, "interactType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CommissionSortQuery.prototype, "roleId", void 0);


/***/ }),
/* 348 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionReplaceListBody = exports.CommissionUpdateBody = exports.CommissionCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const commission_entity_1 = __webpack_require__(75);
const commission_options_request_1 = __webpack_require__(347);
class CommissionCreateBody {
}
exports.CommissionCreateBody = CommissionCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CommissionCreateBody.prototype, "roleId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: commission_entity_1.InteractType, example: commission_entity_1.InteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.InteractType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.InteractType !== "undefined" && commission_entity_1.InteractType) === "function" ? _a : Object)
], CommissionCreateBody.prototype, "interactType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CommissionCreateBody.prototype, "interactId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CommissionCreateBody.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        enum: (0, typescript_helper_1.valuesEnum)(commission_entity_1.CommissionCalculatorType),
        example: commission_entity_1.CommissionCalculatorType.VND,
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_b = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _b : Object)
], CommissionCreateBody.prototype, "commissionCalculatorType", void 0);
class CommissionUpdateBody extends (0, swagger_1.PartialType)(CommissionCreateBody) {
}
exports.CommissionUpdateBody = CommissionUpdateBody;
class CommissionReplaceListBody {
}
exports.CommissionReplaceListBody = CommissionReplaceListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: CommissionCreateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => CommissionCreateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], CommissionReplaceListBody.prototype, "commissionData", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: commission_options_request_1.CommissionFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => commission_options_request_1.CommissionFilterQuery),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof commission_options_request_1.CommissionFilterQuery !== "undefined" && commission_options_request_1.CommissionFilterQuery) === "function" ? _c : Object)
], CommissionReplaceListBody.prototype, "filter", void 0);


/***/ }),
/* 349 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceModule = void 0;
const common_1 = __webpack_require__(3);
const api_customer_source_controller_1 = __webpack_require__(350);
const api_customer_source_service_1 = __webpack_require__(351);
let ApiCustomerSourceModule = class ApiCustomerSourceModule {
};
exports.ApiCustomerSourceModule = ApiCustomerSourceModule;
exports.ApiCustomerSourceModule = ApiCustomerSourceModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_customer_source_controller_1.ApiCustomerSourceController],
        providers: [api_customer_source_service_1.ApiCustomerSourceService],
    })
], ApiCustomerSourceModule);


/***/ }),
/* 350 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_customer_source_service_1 = __webpack_require__(351);
const request_1 = __webpack_require__(352);
let ApiCustomerSourceController = class ApiCustomerSourceController {
    constructor(apiCustomerSourceService) {
        this.apiCustomerSourceService = apiCustomerSourceService;
    }
    pagination({ oid }, query) {
        return this.apiCustomerSourceService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiCustomerSourceService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiCustomerSourceService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiCustomerSourceService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiCustomerSourceService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiCustomerSourceService.destroyOne(oid, id);
    }
};
exports.ApiCustomerSourceController = ApiCustomerSourceController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.CustomerSourcePaginationQuery !== "undefined" && request_1.CustomerSourcePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.CustomerSourceGetManyQuery !== "undefined" && request_1.CustomerSourceGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.CustomerSourceCreateBody !== "undefined" && request_1.CustomerSourceCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.CustomerSourceUpdateBody !== "undefined" && request_1.CustomerSourceUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "destroyOne", null);
exports.ApiCustomerSourceController = ApiCustomerSourceController = __decorate([
    (0, swagger_1.ApiTags)('CustomerSource'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('customer-source'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_customer_source_service_1.ApiCustomerSourceService !== "undefined" && api_customer_source_service_1.ApiCustomerSourceService) === "function" ? _a : Object])
], ApiCustomerSourceController);


/***/ }),
/* 351 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const customer_source_repository_1 = __webpack_require__(174);
let ApiCustomerSourceService = class ApiCustomerSourceService {
    constructor(customerSourceRepository) {
        this.customerSourceRepository = customerSourceRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.customerSourceRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.customerSourceRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.customerSourceRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async createOne(oid, body) {
        const id = await this.customerSourceRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.customerSourceRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.customerSourceRepository.update({ id, oid }, body);
        const data = await this.customerSourceRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.customerSourceRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        const data = await this.customerSourceRepository.findOneById(id);
        return { data };
    }
};
exports.ApiCustomerSourceService = ApiCustomerSourceService;
exports.ApiCustomerSourceService = ApiCustomerSourceService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof customer_source_repository_1.CustomerSourceRepository !== "undefined" && customer_source_repository_1.CustomerSourceRepository) === "function" ? _a : Object])
], ApiCustomerSourceService);


/***/ }),
/* 352 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(353), exports);
__exportStar(__webpack_require__(354), exports);
__exportStar(__webpack_require__(355), exports);


/***/ }),
/* 353 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceGetOneQuery = exports.CustomerSourceGetManyQuery = exports.CustomerSourcePaginationQuery = exports.CustomerSourceGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const customer_source_options_request_1 = __webpack_require__(354);
class CustomerSourceGetQuery {
}
exports.CustomerSourceGetQuery = CustomerSourceGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof customer_source_options_request_1.CustomerSourceRelationQuery !== "undefined" && customer_source_options_request_1.CustomerSourceRelationQuery) === "function" ? _a : Object)
], CustomerSourceGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof customer_source_options_request_1.CustomerSourceFilterQuery !== "undefined" && customer_source_options_request_1.CustomerSourceFilterQuery) === "function" ? _b : Object)
], CustomerSourceGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof customer_source_options_request_1.CustomerSourceSortQuery !== "undefined" && customer_source_options_request_1.CustomerSourceSortQuery) === "function" ? _c : Object)
], CustomerSourceGetQuery.prototype, "sort", void 0);
class CustomerSourcePaginationQuery extends (0, swagger_1.IntersectionType)(CustomerSourceGetQuery, query_1.PaginationQuery) {
}
exports.CustomerSourcePaginationQuery = CustomerSourcePaginationQuery;
class CustomerSourceGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(CustomerSourceGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.CustomerSourceGetManyQuery = CustomerSourceGetManyQuery;
class CustomerSourceGetOneQuery extends (0, swagger_1.PickType)(CustomerSourceGetQuery, ['relation']) {
}
exports.CustomerSourceGetOneQuery = CustomerSourceGetOneQuery;


/***/ }),
/* 354 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceSortQuery = exports.CustomerSourceFilterQuery = exports.CustomerSourceRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class CustomerSourceRelationQuery {
}
exports.CustomerSourceRelationQuery = CustomerSourceRelationQuery;
class CustomerSourceFilterQuery {
}
exports.CustomerSourceFilterQuery = CustomerSourceFilterQuery;
class CustomerSourceSortQuery extends query_1.SortQuery {
}
exports.CustomerSourceSortQuery = CustomerSourceSortQuery;


/***/ }),
/* 355 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceUpdateBody = exports.CustomerSourceCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class CustomerSourceCreateBody {
}
exports.CustomerSourceCreateBody = CustomerSourceCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], CustomerSourceCreateBody.prototype, "name", void 0);
class CustomerSourceUpdateBody extends (0, swagger_1.PartialType)(CustomerSourceCreateBody) {
}
exports.CustomerSourceUpdateBody = CustomerSourceUpdateBody;


/***/ }),
/* 356 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerModule = void 0;
const common_1 = __webpack_require__(3);
const api_customer_controller_1 = __webpack_require__(357);
const api_customer_service_1 = __webpack_require__(358);
let ApiCustomerModule = class ApiCustomerModule {
};
exports.ApiCustomerModule = ApiCustomerModule;
exports.ApiCustomerModule = ApiCustomerModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_customer_controller_1.ApiCustomerController],
        providers: [api_customer_service_1.ApiCustomerService],
    })
], ApiCustomerModule);


/***/ }),
/* 357 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_customer_service_1 = __webpack_require__(358);
const request_1 = __webpack_require__(330);
let ApiCustomerController = class ApiCustomerController {
    constructor(apiCustomerService) {
        this.apiCustomerService = apiCustomerService;
    }
    pagination({ oid }, query) {
        return this.apiCustomerService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiCustomerService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiCustomerService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiCustomerService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiCustomerService.updateOne(oid, +id, body);
    }
    async destroyOne({ oid, organization }, { id }) {
        return await this.apiCustomerService.destroyOne({
            oid,
            customerId: id,
        });
    }
};
exports.ApiCustomerController = ApiCustomerController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.CustomerPaginationQuery !== "undefined" && request_1.CustomerPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.CustomerGetManyQuery !== "undefined" && request_1.CustomerGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.CustomerGetOneQuery !== "undefined" && request_1.CustomerGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.CustomerUpdateBody !== "undefined" && request_1.CustomerUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.CUSTOMER_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerController.prototype, "destroyOne", null);
exports.ApiCustomerController = ApiCustomerController = __decorate([
    (0, swagger_1.ApiTags)('Customer'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('customer'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_customer_service_1.ApiCustomerService !== "undefined" && api_customer_service_1.ApiCustomerService) === "function" ? _a : Object])
], ApiCustomerController);


/***/ }),
/* 358 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const payment_entity_1 = __webpack_require__(48);
const repositories_1 = __webpack_require__(170);
const customer_repository_1 = __webpack_require__(175);
const organization_repository_1 = __webpack_require__(41);
const socket_emit_service_1 = __webpack_require__(306);
let ApiCustomerService = class ApiCustomerService {
    constructor(socketEmitService, cacheDataService, customerRepository, paymentRepository, organizationRepository, ticketRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.customerRepository = customerRepository;
        this.paymentRepository = paymentRepository;
        this.organizationRepository = organizationRepository;
        this.ticketRepository = ticketRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.customerRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter } = query;
        const data = await this.customerRepository.findMany({
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const customer = await this.customerRepository.findOneBy({ oid, id });
        if (!customer)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { customer } };
    }
    async createOne(oid, body) {
        const customer = await this.customerRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid, debt: 0 }));
        this.socketEmitService.customerUpsert(oid, { customer });
        return { data: { customer } };
    }
    async updateOne(oid, id, body) {
        const [customer] = await this.customerRepository.updateAndReturnEntity({ oid, id }, body);
        if (!customer) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Customer',
            });
        }
        this.socketEmitService.customerUpsert(oid, { customer });
        return { data: { customer } };
    }
    async destroyOne(options) {
        const { oid, customerId } = options;
        const ticketList = await this.ticketRepository.findMany({
            condition: { oid, customerId },
            limit: 10,
        });
        if (ticketList.length > 0) {
            return {
                data: { ticketList },
                success: false,
            };
        }
        await Promise.allSettled([
            this.customerRepository.delete({ oid, id: customerId }),
            this.paymentRepository.delete({ oid, personId: customerId, personType: payment_entity_1.PersonType.Customer }),
        ]);
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        return { data: { ticketList: [], customerId } };
    }
};
exports.ApiCustomerService = ApiCustomerService;
exports.ApiCustomerService = ApiCustomerService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof customer_repository_1.CustomerRepository !== "undefined" && customer_repository_1.CustomerRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _d : Object, typeof (_e = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _f : Object])
], ApiCustomerService);


/***/ }),
/* 359 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorModule = void 0;
const common_1 = __webpack_require__(3);
const api_distributor_controller_1 = __webpack_require__(360);
const api_distributor_service_1 = __webpack_require__(361);
let ApiDistributorModule = class ApiDistributorModule {
};
exports.ApiDistributorModule = ApiDistributorModule;
exports.ApiDistributorModule = ApiDistributorModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_distributor_controller_1.ApiDistributorController],
        providers: [api_distributor_service_1.ApiDistributorService],
    })
], ApiDistributorModule);


/***/ }),
/* 360 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_distributor_service_1 = __webpack_require__(361);
const request_1 = __webpack_require__(362);
let ApiDistributorController = class ApiDistributorController {
    constructor(apiDistributorService) {
        this.apiDistributorService = apiDistributorService;
    }
    pagination({ oid }, query) {
        return this.apiDistributorService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiDistributorService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiDistributorService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiDistributorService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiDistributorService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiDistributorService.destroyOne(oid, id);
    }
};
exports.ApiDistributorController = ApiDistributorController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.DistributorPaginationQuery !== "undefined" && request_1.DistributorPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiDistributorController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.DistributorGetManyQuery !== "undefined" && request_1.DistributorGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiDistributorController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiDistributorController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.DistributorCreateBody !== "undefined" && request_1.DistributorCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiDistributorController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.DistributorUpdateBody !== "undefined" && request_1.DistributorUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiDistributorController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.DISTRIBUTOR_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiDistributorController.prototype, "destroyOne", null);
exports.ApiDistributorController = ApiDistributorController = __decorate([
    (0, swagger_1.ApiTags)('Distributor'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('distributor'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_distributor_service_1.ApiDistributorService !== "undefined" && api_distributor_service_1.ApiDistributorService) === "function" ? _a : Object])
], ApiDistributorController);


/***/ }),
/* 361 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const payment_entity_1 = __webpack_require__(48);
const repositories_1 = __webpack_require__(170);
const distributor_repository_1 = __webpack_require__(176);
const receipt_repository_1 = __webpack_require__(193);
const socket_emit_service_1 = __webpack_require__(306);
let ApiDistributorService = class ApiDistributorService {
    constructor(socketEmitService, distributorRepository, paymentRepository, receiptRepository) {
        this.socketEmitService = socketEmitService;
        this.distributorRepository = distributorRepository;
        this.paymentRepository = paymentRepository;
        this.receiptRepository = receiptRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.distributorRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.distributorRepository.findMany({
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const distributor = await this.distributorRepository.findOneBy({ oid, id });
        if (!distributor)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { distributor } };
    }
    async createOne(oid, body) {
        const distributor = await this.distributorRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid, debt: 0 }));
        this.socketEmitService.distributorUpsert(oid, { distributor });
        return { data: { distributor } };
    }
    async updateOne(oid, id, body) {
        const [distributor] = await this.distributorRepository.updateAndReturnEntity({ oid, id }, body);
        if (!distributor) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Distributor',
            });
        }
        this.socketEmitService.distributorUpsert(oid, { distributor });
        return { data: { distributor } };
    }
    async destroyOne(oid, distributorId) {
        const receiptList = await this.receiptRepository.findMany({
            condition: { oid, distributorId },
            limit: 10,
        });
        if (receiptList.length > 0) {
            return {
                data: { receiptList },
                success: false,
            };
        }
        await Promise.allSettled([
            this.distributorRepository.delete({ oid, id: distributorId }),
            this.paymentRepository.delete({
                oid,
                personId: distributorId,
                personType: payment_entity_1.PersonType.Distributor,
            }),
        ]);
        return { data: { receiptList: [], distributorId } };
    }
};
exports.ApiDistributorService = ApiDistributorService;
exports.ApiDistributorService = ApiDistributorService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof distributor_repository_1.DistributorRepository !== "undefined" && distributor_repository_1.DistributorRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _c : Object, typeof (_d = typeof receipt_repository_1.ReceiptRepository !== "undefined" && receipt_repository_1.ReceiptRepository) === "function" ? _d : Object])
], ApiDistributorService);


/***/ }),
/* 362 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(363), exports);
__exportStar(__webpack_require__(364), exports);
__exportStar(__webpack_require__(365), exports);


/***/ }),
/* 363 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorGetOneQuery = exports.DistributorGetManyQuery = exports.DistributorPaginationQuery = exports.DistributorGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const distributor_options_request_1 = __webpack_require__(364);
class DistributorGetQuery {
}
exports.DistributorGetQuery = DistributorGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof distributor_options_request_1.DistributorRelationQuery !== "undefined" && distributor_options_request_1.DistributorRelationQuery) === "function" ? _a : Object)
], DistributorGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1, debt: { GT: 15000 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof distributor_options_request_1.DistributorFilterQuery !== "undefined" && distributor_options_request_1.DistributorFilterQuery) === "function" ? _b : Object)
], DistributorGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof distributor_options_request_1.DistributorSortQuery !== "undefined" && distributor_options_request_1.DistributorSortQuery) === "function" ? _c : Object)
], DistributorGetQuery.prototype, "sort", void 0);
class DistributorPaginationQuery extends (0, swagger_1.IntersectionType)(DistributorGetQuery, query_1.PaginationQuery) {
}
exports.DistributorPaginationQuery = DistributorPaginationQuery;
class DistributorGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(DistributorGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.DistributorGetManyQuery = DistributorGetManyQuery;
class DistributorGetOneQuery extends (0, swagger_1.PickType)(DistributorGetQuery, ['relation']) {
}
exports.DistributorGetOneQuery = DistributorGetOneQuery;


/***/ }),
/* 364 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorSortQuery = exports.DistributorFilterQuery = exports.DistributorRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_number_1 = __webpack_require__(289);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class DistributorRelationQuery {
}
exports.DistributorRelationQuery = DistributorRelationQuery;
class DistributorFilterQuery {
}
exports.DistributorFilterQuery = DistributorFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], DistributorFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], DistributorFilterQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], DistributorFilterQuery.prototype, "updatedAt", void 0);
class DistributorSortQuery extends query_1.SortQuery {
}
exports.DistributorSortQuery = DistributorSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], DistributorSortQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], DistributorSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 365 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorUpdateBody = exports.DistributorCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class DistributorCreateBody {
}
exports.DistributorCreateBody = DistributorCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ default: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Huyện Cát Tiên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressDistrict", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng không' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], DistributorCreateBody.prototype, "isActive", void 0);
class DistributorUpdateBody extends (0, swagger_1.PartialType)(DistributorCreateBody) {
}
exports.DistributorUpdateBody = DistributorUpdateBody;


/***/ }),
/* 366 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_group_controller_1 = __webpack_require__(367);
const api_laboratory_group_service_1 = __webpack_require__(368);
let ApiLaboratoryGroupModule = class ApiLaboratoryGroupModule {
};
exports.ApiLaboratoryGroupModule = ApiLaboratoryGroupModule;
exports.ApiLaboratoryGroupModule = ApiLaboratoryGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_group_controller_1.ApiLaboratoryGroupController],
        providers: [api_laboratory_group_service_1.ApiLaboratoryGroupService],
    })
], ApiLaboratoryGroupModule);


/***/ }),
/* 367 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_laboratory_group_service_1 = __webpack_require__(368);
const request_1 = __webpack_require__(369);
let ApiLaboratoryGroupController = class ApiLaboratoryGroupController {
    constructor(apiLaboratoryGroupService) {
        this.apiLaboratoryGroupService = apiLaboratoryGroupService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratoryGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiLaboratoryGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiLaboratoryGroupService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiLaboratoryGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiLaboratoryGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiLaboratoryGroupService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiLaboratoryGroupService.replaceAll(oid, body);
    }
    async systemList() {
        return await this.apiLaboratoryGroupService.systemList();
    }
};
exports.ApiLaboratoryGroupController = ApiLaboratoryGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratoryGroupPaginationQuery !== "undefined" && request_1.LaboratoryGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratoryGroupGetManyQuery !== "undefined" && request_1.LaboratoryGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.LaboratoryGroupCreateBody !== "undefined" && request_1.LaboratoryGroupCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.LaboratoryGroupUpdateBody !== "undefined" && request_1.LaboratoryGroupUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.LaboratoryGroupReplaceAllBody !== "undefined" && request_1.LaboratoryGroupReplaceAllBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "systemList", null);
exports.ApiLaboratoryGroupController = ApiLaboratoryGroupController = __decorate([
    (0, swagger_1.ApiTags)('LaboratoryGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_group_service_1.ApiLaboratoryGroupService !== "undefined" && api_laboratory_group_service_1.ApiLaboratoryGroupService) === "function" ? _a : Object])
], ApiLaboratoryGroupController);


/***/ }),
/* 368 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const laboratory_group_repository_1 = __webpack_require__(178);
let ApiLaboratoryGroupService = class ApiLaboratoryGroupService {
    constructor(laboratoryGroupRepository) {
        this.laboratoryGroupRepository = laboratoryGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.laboratoryGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratoryGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, id) {
        const laboratoryGroup = await this.laboratoryGroupRepository.findOneBy({ oid, id });
        if (!laboratoryGroup)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { laboratoryGroup } };
    }
    async createOne(oid, body) {
        const laboratoryGroup = await this.laboratoryGroupRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { laboratoryGroup } };
    }
    async updateOne(oid, id, body) {
        const laboratoryGroupList = await this.laboratoryGroupRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { laboratoryGroup: laboratoryGroupList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.laboratoryGroupRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceAll(oid, body) {
        await this.laboratoryGroupRepository.replaceAll(oid, body.laboratoryGroupReplaceAll);
        return { data: true };
    }
    async systemList() {
        const data = await this.laboratoryGroupRepository.findMany({
            condition: { oid: 1 },
        });
        return { data };
    }
};
exports.ApiLaboratoryGroupService = ApiLaboratoryGroupService;
exports.ApiLaboratoryGroupService = ApiLaboratoryGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof laboratory_group_repository_1.LaboratoryGroupRepository !== "undefined" && laboratory_group_repository_1.LaboratoryGroupRepository) === "function" ? _a : Object])
], ApiLaboratoryGroupService);


/***/ }),
/* 369 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(370), exports);
__exportStar(__webpack_require__(371), exports);
__exportStar(__webpack_require__(372), exports);


/***/ }),
/* 370 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupGetOneQuery = exports.LaboratoryGroupGetManyQuery = exports.LaboratoryGroupPaginationQuery = exports.LaboratoryGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const laboratory_group_options_request_1 = __webpack_require__(371);
class LaboratoryGroupGetQuery {
}
exports.LaboratoryGroupGetQuery = LaboratoryGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_group_options_request_1.LaboratoryGroupRelationQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupRelationQuery) === "function" ? _a : Object)
], LaboratoryGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_group_options_request_1.LaboratoryGroupFilterQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupFilterQuery) === "function" ? _b : Object)
], LaboratoryGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_group_options_request_1.LaboratoryGroupSortQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupSortQuery) === "function" ? _c : Object)
], LaboratoryGroupGetQuery.prototype, "sort", void 0);
class LaboratoryGroupPaginationQuery extends (0, swagger_1.IntersectionType)(LaboratoryGroupGetQuery, query_1.PaginationQuery) {
}
exports.LaboratoryGroupPaginationQuery = LaboratoryGroupPaginationQuery;
class LaboratoryGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratoryGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratoryGroupGetManyQuery = LaboratoryGroupGetManyQuery;
class LaboratoryGroupGetOneQuery extends (0, swagger_1.PickType)(LaboratoryGroupGetQuery, ['relation']) {
}
exports.LaboratoryGroupGetOneQuery = LaboratoryGroupGetOneQuery;


/***/ }),
/* 371 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupSortQuery = exports.LaboratoryGroupFilterQuery = exports.LaboratoryGroupRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class LaboratoryGroupRelationQuery {
}
exports.LaboratoryGroupRelationQuery = LaboratoryGroupRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryGroupRelationQuery.prototype, "printHtml", void 0);
class LaboratoryGroupFilterQuery {
}
exports.LaboratoryGroupFilterQuery = LaboratoryGroupFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupFilterQuery.prototype, "printHtmlId", void 0);
class LaboratoryGroupSortQuery extends query_1.SortQuery {
}
exports.LaboratoryGroupSortQuery = LaboratoryGroupSortQuery;


/***/ }),
/* 372 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupReplaceAllBody = exports.LaboratoryGroupReplaceBody = exports.LaboratoryGroupUpdateBody = exports.LaboratoryGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class LaboratoryGroupCreateBody {
}
exports.LaboratoryGroupCreateBody = LaboratoryGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], LaboratoryGroupCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupCreateBody.prototype, "printHtmlId", void 0);
class LaboratoryGroupUpdateBody extends (0, swagger_1.PartialType)(LaboratoryGroupCreateBody) {
}
exports.LaboratoryGroupUpdateBody = LaboratoryGroupUpdateBody;
class LaboratoryGroupReplaceBody {
}
exports.LaboratoryGroupReplaceBody = LaboratoryGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], LaboratoryGroupReplaceBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], LaboratoryGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupReplaceBody.prototype, "printHtmlId", void 0);
class LaboratoryGroupReplaceAllBody {
}
exports.LaboratoryGroupReplaceAllBody = LaboratoryGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryGroupReplaceAllBody.prototype, "laboratoryGroupReplaceAll", void 0);


/***/ }),
/* 373 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryKitModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_kit_controller_1 = __webpack_require__(374);
const api_laboratory_kit_service_1 = __webpack_require__(375);
let ApiLaboratoryKitModule = class ApiLaboratoryKitModule {
};
exports.ApiLaboratoryKitModule = ApiLaboratoryKitModule;
exports.ApiLaboratoryKitModule = ApiLaboratoryKitModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_kit_controller_1.ApiLaboratoryKitController],
        providers: [api_laboratory_kit_service_1.ApiLaboratoryKitService],
    })
], ApiLaboratoryKitModule);


/***/ }),
/* 374 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryKitController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_laboratory_kit_service_1 = __webpack_require__(375);
const request_1 = __webpack_require__(376);
let ApiLaboratoryKitController = class ApiLaboratoryKitController {
    constructor(apiLaboratoryKitService) {
        this.apiLaboratoryKitService = apiLaboratoryKitService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratoryKitService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiLaboratoryKitService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiLaboratoryKitService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiLaboratoryKitService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiLaboratoryKitService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiLaboratoryKitService.destroyOne(oid, id);
    }
};
exports.ApiLaboratoryKitController = ApiLaboratoryKitController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratoryKitPaginationQuery !== "undefined" && request_1.LaboratoryKitPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryKitController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratoryKitGetManyQuery !== "undefined" && request_1.LaboratoryKitGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryKitController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryKitController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.LaboratoryKitCreateBody !== "undefined" && request_1.LaboratoryKitCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryKitController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.LaboratoryKitUpdateBody !== "undefined" && request_1.LaboratoryKitUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryKitController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryKitController.prototype, "destroyOne", null);
exports.ApiLaboratoryKitController = ApiLaboratoryKitController = __decorate([
    (0, swagger_1.ApiTags)('LaboratoryKit'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory-kit'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_kit_service_1.ApiLaboratoryKitService !== "undefined" && api_laboratory_kit_service_1.ApiLaboratoryKitService) === "function" ? _a : Object])
], ApiLaboratoryKitController);


/***/ }),
/* 375 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryKitService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const laboratory_kit_repository_1 = __webpack_require__(179);
let ApiLaboratoryKitService = class ApiLaboratoryKitService {
    constructor(laboratoryKitRepository) {
        this.laboratoryKitRepository = laboratoryKitRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.laboratoryKitRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratoryKitRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, id) {
        const laboratoryKit = await this.laboratoryKitRepository.findOneBy({ oid, id });
        if (!laboratoryKit)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { laboratoryKit } };
    }
    async createOne(oid, body) {
        const laboratoryKit = await this.laboratoryKitRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { laboratoryKit } };
    }
    async updateOne(oid, id, body) {
        const laboratoryKitList = await this.laboratoryKitRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { laboratoryKit: laboratoryKitList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.laboratoryKitRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiLaboratoryKitService = ApiLaboratoryKitService;
exports.ApiLaboratoryKitService = ApiLaboratoryKitService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof laboratory_kit_repository_1.LaboratoryKitRepository !== "undefined" && laboratory_kit_repository_1.LaboratoryKitRepository) === "function" ? _a : Object])
], ApiLaboratoryKitService);


/***/ }),
/* 376 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(377), exports);
__exportStar(__webpack_require__(378), exports);
__exportStar(__webpack_require__(379), exports);


/***/ }),
/* 377 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryKitGetOneQuery = exports.LaboratoryKitGetManyQuery = exports.LaboratoryKitPaginationQuery = exports.LaboratoryKitGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const laboratory_kit_options_request_1 = __webpack_require__(378);
class LaboratoryKitGetQuery {
}
exports.LaboratoryKitGetQuery = LaboratoryKitGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_kit_options_request_1.LaboratoryKitRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_kit_options_request_1.LaboratoryKitRelationQuery !== "undefined" && laboratory_kit_options_request_1.LaboratoryKitRelationQuery) === "function" ? _a : Object)
], LaboratoryKitGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_kit_options_request_1.LaboratoryKitFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_kit_options_request_1.LaboratoryKitFilterQuery !== "undefined" && laboratory_kit_options_request_1.LaboratoryKitFilterQuery) === "function" ? _b : Object)
], LaboratoryKitGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_kit_options_request_1.LaboratoryKitSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_kit_options_request_1.LaboratoryKitSortQuery !== "undefined" && laboratory_kit_options_request_1.LaboratoryKitSortQuery) === "function" ? _c : Object)
], LaboratoryKitGetQuery.prototype, "sort", void 0);
class LaboratoryKitPaginationQuery extends (0, swagger_1.IntersectionType)(LaboratoryKitGetQuery, query_1.PaginationQuery) {
}
exports.LaboratoryKitPaginationQuery = LaboratoryKitPaginationQuery;
class LaboratoryKitGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratoryKitGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratoryKitGetManyQuery = LaboratoryKitGetManyQuery;
class LaboratoryKitGetOneQuery extends (0, swagger_1.PickType)(LaboratoryKitGetQuery, ['relation']) {
}
exports.LaboratoryKitGetOneQuery = LaboratoryKitGetOneQuery;


/***/ }),
/* 378 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryKitSortQuery = exports.LaboratoryKitFilterQuery = exports.LaboratoryKitRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class LaboratoryKitRelationQuery {
}
exports.LaboratoryKitRelationQuery = LaboratoryKitRelationQuery;
class LaboratoryKitFilterQuery {
}
exports.LaboratoryKitFilterQuery = LaboratoryKitFilterQuery;
class LaboratoryKitSortQuery extends query_1.SortQuery {
}
exports.LaboratoryKitSortQuery = LaboratoryKitSortQuery;


/***/ }),
/* 379 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryKitUpdateBody = exports.LaboratoryKitCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class LaboratoryKitCreateBody {
}
exports.LaboratoryKitCreateBody = LaboratoryKitCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryKitCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], LaboratoryKitCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryKitCreateBody.prototype, "laboratoryIds", void 0);
class LaboratoryKitUpdateBody extends (0, swagger_1.PartialType)(LaboratoryKitCreateBody) {
}
exports.LaboratoryKitUpdateBody = LaboratoryKitUpdateBody;


/***/ }),
/* 380 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_controller_1 = __webpack_require__(381);
const api_laboratory_service_1 = __webpack_require__(382);
let ApiLaboratoryModule = class ApiLaboratoryModule {
};
exports.ApiLaboratoryModule = ApiLaboratoryModule;
exports.ApiLaboratoryModule = ApiLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_controller_1.ApiLaboratoryController],
        providers: [api_laboratory_service_1.ApiLaboratoryService],
    })
], ApiLaboratoryModule);


/***/ }),
/* 381 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_laboratory_service_1 = __webpack_require__(382);
const request_1 = __webpack_require__(383);
let ApiLaboratoryController = class ApiLaboratoryController {
    constructor(apiLaboratoryService) {
        this.apiLaboratoryService = apiLaboratoryService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratoryService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiLaboratoryService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiLaboratoryService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiLaboratoryService.create(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiLaboratoryService.update(oid, id, body);
    }
    async destroy({ oid }, { id }) {
        return await this.apiLaboratoryService.destroy(oid, id);
    }
    async systemList() {
        return await this.apiLaboratoryService.systemList();
    }
    async systemCopy({ oid }, body) {
        return await this.apiLaboratoryService.systemCopy(oid, body);
    }
};
exports.ApiLaboratoryController = ApiLaboratoryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratoryPaginationQuery !== "undefined" && request_1.LaboratoryPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratoryGetManyQuery !== "undefined" && request_1.LaboratoryGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.LaboratoryGetOneQuery !== "undefined" && request_1.LaboratoryGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.LaboratoryCreateBody !== "undefined" && request_1.LaboratoryCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.LaboratoryUpdateBody !== "undefined" && request_1.LaboratoryUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "destroy", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "systemList", null);
__decorate([
    (0, common_1.Post)('system-copy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.LaboratorySystemCopyBody !== "undefined" && request_1.LaboratorySystemCopyBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "systemCopy", null);
exports.ApiLaboratoryController = ApiLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('Laboratory'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_service_1.ApiLaboratoryService !== "undefined" && api_laboratory_service_1.ApiLaboratoryService) === "function" ? _a : Object])
], ApiLaboratoryController);


/***/ }),
/* 382 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const laboratory_entity_1 = __webpack_require__(64);
const laboratory_repository_1 = __webpack_require__(180);
const ticket_laboratory_repository_1 = __webpack_require__(201);
let ApiLaboratoryService = class ApiLaboratoryService {
    constructor(laboratoryRepository, ticketLaboratoryRepository) {
        this.laboratoryRepository = laboratoryRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.laboratoryRepository.pagination({
            relation: {
                laboratoryGroup: relation === null || relation === void 0 ? void 0 : relation.laboratoryGroup,
            },
            page,
            limit,
            condition: {
                oid,
                laboratoryGroupId: filter === null || filter === void 0 ? void 0 : filter.laboratoryGroupId,
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                parentId: filter === null || filter === void 0 ? void 0 : filter.parentId,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratoryRepository.findMany({
            relation: {
                laboratoryGroup: relation === null || relation === void 0 ? void 0 : relation.laboratoryGroup,
            },
            condition: {
                oid,
                laboratoryGroupId: filter === null || filter === void 0 ? void 0 : filter.laboratoryGroupId,
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                parentId: filter === null || filter === void 0 ? void 0 : filter.parentId,
            },
            sort,
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        var _a, _b;
        const laboratory = await this.laboratoryRepository.findOne({
            relation: {
                laboratoryGroup: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.laboratoryGroup,
            },
            condition: { oid, id },
        });
        if (!laboratory)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if ((_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.children) {
            if (laboratory.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
                laboratory.children = await this.laboratoryRepository.findMany({
                    condition: {
                        oid,
                        parentId: laboratory.id,
                        level: 2,
                    },
                    sort: { priority: 'ASC' },
                });
            }
        }
        return { data: { laboratory } };
    }
    async create(oid, body) {
        const { children } = body, laboratoryCreateDto = __rest(body, ["children"]);
        const laboratoryParentId = await this.laboratoryRepository.insertOneFullField(Object.assign(Object.assign({}, laboratoryCreateDto), { oid, level: 1, parentId: 0 }));
        const [laboratoryParent] = await this.laboratoryRepository.updateAndReturnEntity({ oid, id: laboratoryParentId }, { parentId: laboratoryParentId });
        if (laboratoryParent.valueType === laboratory_entity_1.LaboratoryValueType.Children && children.length) {
            const childrenDto = children.map((i) => {
                const childDto = Object.assign(Object.assign({}, i), { oid, laboratoryGroupId: laboratoryParent.laboratoryGroupId, level: 2, parentId: laboratoryParent.id });
                return childDto;
            });
            await this.laboratoryRepository.insertManyFullFieldAndReturnEntity(childrenDto);
        }
        return { data: { laboratory: laboratoryParent } };
    }
    async update(oid, id, body) {
        const { children } = body, laboratoryUpdateDto = __rest(body, ["children"]);
        const laboratoryOrigin = await this.laboratoryRepository.findOneBy({ oid, id });
        if (!laboratoryOrigin) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (laboratoryOrigin.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
            if (laboratoryUpdateDto.valueType !== laboratory_entity_1.LaboratoryValueType.Children) {
                await this.laboratoryRepository.delete({
                    oid,
                    level: 2,
                    parentId: id,
                });
            }
        }
        const [laboratory] = await this.laboratoryRepository.updateAndReturnEntity({ oid, id }, laboratoryUpdateDto);
        if (!laboratory)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        if (laboratory.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
            await this.laboratoryRepository.updateChildren({
                oid,
                laboratoryParent: laboratory,
                laboratoryChildrenDtoList: children,
            });
        }
        return { data: { laboratory } };
    }
    async destroy(oid, id) {
        const ticketLaboratoryList = await this.ticketLaboratoryRepository.findMany({
            condition: { oid, laboratoryId: id },
            limit: 10,
        });
        if (ticketLaboratoryList.length > 0) {
            return {
                data: { ticketLaboratoryList },
                success: false,
            };
        }
        const affected = await this.laboratoryRepository.delete({ oid, parentId: id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: { ticketLaboratoryList: [], laboratoryId: id } };
    }
    async systemList() {
        const data = await this.laboratoryRepository.findMany({
            condition: { oid: 1 },
            sort: { priority: 'ASC' },
        });
        return { data };
    }
    async systemCopy(oid, body) {
        const laboratorySystem = await this.laboratoryRepository.findMany({
            condition: { oid: 1, parentId: { IN: body.laboratoryIdList } },
            sort: { priority: 'ASC' },
        });
        const laboratoryList = laboratorySystem.filter((i) => i.level === 1);
        const laboratoryMap = (0, object_helper_1.arrayToKeyValue)(laboratoryList, 'id');
        laboratorySystem.forEach((i) => {
            var _a;
            if (!laboratoryMap[i.parentId].children) {
                laboratoryMap[i.parentId].children = [];
            }
            if (i.level === 2) {
                (_a = laboratoryMap[i.parentId].children) === null || _a === void 0 ? void 0 : _a.push(i);
            }
        });
        const laboratoryParentInsertList = laboratoryList.map((i) => {
            const dto = {
                oid,
                name: i.name,
                costPrice: i.costPrice,
                price: i.price,
                laboratoryGroupId: 0,
                level: i.level,
                valueType: i.valueType,
                lowValue: i.lowValue,
                highValue: i.highValue,
                unit: i.unit,
                options: i.options,
                parentId: 0,
                priority: 0,
            };
            return dto;
        });
        const laboratoryParentIds = await this.laboratoryRepository.insertMany(laboratoryParentInsertList);
        await this.laboratoryRepository.update({ id: { IN: laboratoryParentIds } }, {
            parentId: () => `"id"`,
            priority: () => `"id"`,
        });
        const laboratoryChildInsertList = laboratoryList
            .map((i, index) => {
            i.children.forEach((c, j) => {
                c.parentId = laboratoryParentIds[index];
                c.priority = j + 1;
            });
            return i.children;
        })
            .flat()
            .map((i) => {
            const dto = {
                oid,
                name: i.name,
                price: i.price,
                costPrice: i.costPrice,
                laboratoryGroupId: 0,
                level: i.level,
                valueType: i.valueType,
                lowValue: i.lowValue,
                highValue: i.highValue,
                unit: i.unit,
                options: i.options,
                parentId: i.parentId,
                priority: i.priority,
            };
            return dto;
        });
        await this.laboratoryRepository.insertMany(laboratoryChildInsertList);
        return { data: true };
    }
};
exports.ApiLaboratoryService = ApiLaboratoryService;
exports.ApiLaboratoryService = ApiLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof laboratory_repository_1.LaboratoryRepository !== "undefined" && laboratory_repository_1.LaboratoryRepository) === "function" ? _a : Object, typeof (_b = typeof ticket_laboratory_repository_1.TicketLaboratoryRepository !== "undefined" && ticket_laboratory_repository_1.TicketLaboratoryRepository) === "function" ? _b : Object])
], ApiLaboratoryService);


/***/ }),
/* 383 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(384), exports);
__exportStar(__webpack_require__(385), exports);
__exportStar(__webpack_require__(386), exports);
__exportStar(__webpack_require__(387), exports);


/***/ }),
/* 384 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGetOneQuery = exports.LaboratoryGetManyQuery = exports.LaboratoryPaginationQuery = exports.LaboratoryGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const laboratory_options_request_1 = __webpack_require__(385);
class LaboratoryGetQuery {
}
exports.LaboratoryGetQuery = LaboratoryGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratoryRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_options_request_1.LaboratoryRelationQuery !== "undefined" && laboratory_options_request_1.LaboratoryRelationQuery) === "function" ? _a : Object)
], LaboratoryGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ level: 1 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratoryFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_options_request_1.LaboratoryFilterQuery !== "undefined" && laboratory_options_request_1.LaboratoryFilterQuery) === "function" ? _b : Object)
], LaboratoryGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratorySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_options_request_1.LaboratorySortQuery !== "undefined" && laboratory_options_request_1.LaboratorySortQuery) === "function" ? _c : Object)
], LaboratoryGetQuery.prototype, "sort", void 0);
class LaboratoryPaginationQuery extends (0, swagger_1.IntersectionType)(LaboratoryGetQuery, query_1.PaginationQuery) {
}
exports.LaboratoryPaginationQuery = LaboratoryPaginationQuery;
class LaboratoryGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratoryGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratoryGetManyQuery = LaboratoryGetManyQuery;
class LaboratoryGetOneQuery extends (0, swagger_1.PickType)(LaboratoryGetQuery, ['relation']) {
}
exports.LaboratoryGetOneQuery = LaboratoryGetOneQuery;


/***/ }),
/* 385 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySortQuery = exports.LaboratoryFilterQuery = exports.LaboratoryRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class LaboratoryRelationQuery {
}
exports.LaboratoryRelationQuery = LaboratoryRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "laboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "children", void 0);
class LaboratoryFilterQuery {
}
exports.LaboratoryFilterQuery = LaboratoryFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "parentId", void 0);
class LaboratorySortQuery extends query_1.SortQuery {
}
exports.LaboratorySortQuery = LaboratorySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], LaboratorySortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], LaboratorySortQuery.prototype, "priority", void 0);


/***/ }),
/* 386 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySystemCopyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class LaboratorySystemCopyBody {
}
exports.LaboratorySystemCopyBody = LaboratorySystemCopyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], LaboratorySystemCopyBody.prototype, "laboratoryIdList", void 0);


/***/ }),
/* 387 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryUpdateBody = exports.LaboratoryCreateBody = exports.LaboratoryChildUpdate = exports.LaboratoryChildCreate = exports.LaboratoryParentUpsert = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const laboratory_entity_1 = __webpack_require__(64);
class LaboratoryParentUpsert {
}
exports.LaboratoryParentUpsert = LaboratoryParentUpsert;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'GOT' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "lowValue", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "highValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: laboratory_entity_1.LaboratoryValueType, example: laboratory_entity_1.LaboratoryValueType.Number }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(laboratory_entity_1.LaboratoryValueType),
    __metadata("design:type", typeof (_a = typeof laboratory_entity_1.LaboratoryValueType !== "undefined" && laboratory_entity_1.LaboratoryValueType) === "function" ? _a : Object)
], LaboratoryParentUpsert.prototype, "valueType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mg/l' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "unit", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mg/l' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "options", void 0);
class LaboratoryChildCreate extends (0, swagger_1.OmitType)(LaboratoryParentUpsert, [
    'laboratoryGroupId',
]) {
}
exports.LaboratoryChildCreate = LaboratoryChildCreate;
class LaboratoryChildUpdate extends (0, swagger_1.OmitType)(LaboratoryParentUpsert, ['laboratoryGroupId']) {
}
exports.LaboratoryChildUpdate = LaboratoryChildUpdate;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryChildUpdate.prototype, "id", void 0);
class LaboratoryCreateBody extends LaboratoryParentUpsert {
}
exports.LaboratoryCreateBody = LaboratoryCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryChildCreate, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryChildCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryCreateBody.prototype, "children", void 0);
class LaboratoryUpdateBody extends LaboratoryParentUpsert {
}
exports.LaboratoryUpdateBody = LaboratoryUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryChildUpdate, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryChildUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryUpdateBody.prototype, "children", void 0);


/***/ }),
/* 388 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const jwt_config_1 = __webpack_require__(97);
const environments_1 = __webpack_require__(29);
const email_module_1 = __webpack_require__(237);
const api_organization_controller_1 = __webpack_require__(389);
const api_organization_service_1 = __webpack_require__(391);
let ApiOrganizationModule = class ApiOrganizationModule {
};
exports.ApiOrganizationModule = ApiOrganizationModule;
exports.ApiOrganizationModule = ApiOrganizationModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig),
            config_1.ConfigModule.forFeature(environments_1.GlobalConfig),
            email_module_1.EmailModule,
        ],
        controllers: [api_organization_controller_1.ApiOrganizationController],
        providers: [api_organization_service_1.ApiOrganizationService],
    })
], ApiOrganizationModule);


/***/ }),
/* 389 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const fastify_1 = __webpack_require__(390);
const file_1 = __webpack_require__(270);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const interceptor_1 = __webpack_require__(271);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_organization_service_1 = __webpack_require__(391);
const request_1 = __webpack_require__(393);
let ApiOrganizationController = class ApiOrganizationController {
    constructor(apiOrganizationService) {
        this.apiOrganizationService = apiOrganizationService;
    }
    async info({ oid }) {
        return await this.apiOrganizationService.getInfo(oid);
    }
    async updateInfo({ oid }, body) {
        return await this.apiOrganizationService.updateInfo(oid, body);
    }
    async updateInfoAndLogo({ oid }, file, body) {
        return await this.apiOrganizationService.updateInfoAndLogo({ oid, body, file });
    }
    async changeEmail({ oid }, body) {
        return await this.apiOrganizationService.changeEmail(oid, body.email);
    }
    async sendEmailVerifyOrganizationEmail({ oid }) {
        return await this.apiOrganizationService.sendEmailVerifyOrganizationEmail(oid);
    }
    async verifyOrganizationEmail(reply, query) {
        await this.apiOrganizationService.verifyOrganizationEmail(query);
        return reply.type('text/html; charset=utf-8').send(`<h2>Kích hoạt email thành công</h2>`);
    }
};
exports.ApiOrganizationController = ApiOrganizationController;
__decorate([
    (0, common_1.Get)('info'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "info", null);
__decorate([
    (0, common_1.Patch)('update-info'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_UPDATE_INFO),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, typeof (_d = typeof request_1.OrganizationUpdateInfoBody !== "undefined" && request_1.OrganizationUpdateInfoBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "updateInfo", null);
__decorate([
    (0, common_1.Patch)('update-info-and-logo'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_UPDATE_INFO),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof request_1.OrganizationUpdateInfoAndLogoBody !== "undefined" && request_1.OrganizationUpdateInfoAndLogoBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "updateInfoAndLogo", null);
__decorate([
    (0, common_1.Patch)('change-email'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_VERIFY_EMAIL),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.OrganizationChangeEmailBody !== "undefined" && request_1.OrganizationChangeEmailBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "changeEmail", null);
__decorate([
    (0, common_1.Post)('send-email-verify-organization-email'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_VERIFY_EMAIL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "sendEmailVerifyOrganizationEmail", null);
__decorate([
    (0, common_1.Get)('verify-organization-email'),
    __param(0, (0, common_1.Res)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof fastify_1.FastifyReply !== "undefined" && fastify_1.FastifyReply) === "function" ? _l : Object, typeof (_m = typeof request_1.VerifyOrganizationEmailQuery !== "undefined" && request_1.VerifyOrganizationEmailQuery) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "verifyOrganizationEmail", null);
exports.ApiOrganizationController = ApiOrganizationController = __decorate([
    (0, swagger_1.ApiTags)('Organization'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('organization'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_organization_service_1.ApiOrganizationService !== "undefined" && api_organization_service_1.ApiOrganizationService) === "function" ? _a : Object])
], ApiOrganizationController);


/***/ }),
/* 390 */
/***/ ((module) => {

module.exports = require("fastify");

/***/ }),
/* 391 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(30);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(226);
const jwt_config_1 = __webpack_require__(97);
const image_repository_1 = __webpack_require__(177);
const organization_repository_1 = __webpack_require__(41);
const environments_1 = __webpack_require__(29);
const email_service_1 = __webpack_require__(239);
const image_manager_service_1 = __webpack_require__(392);
let ApiOrganizationService = class ApiOrganizationService {
    constructor(globalConfig, jwtConfig, emailService, cacheDataService, imageManagerService, organizationRepository, imageRepository) {
        this.globalConfig = globalConfig;
        this.jwtConfig = jwtConfig;
        this.emailService = emailService;
        this.cacheDataService = cacheDataService;
        this.imageManagerService = imageManagerService;
        this.organizationRepository = organizationRepository;
        this.imageRepository = imageRepository;
    }
    async getInfo(oid) {
        const organization = await this.organizationRepository.findOne({
            relation: { logoImage: true },
            condition: { id: oid },
        });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async updateInfo(oid, body) {
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, body);
        if (!organization) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async updateInfoAndLogo(options) {
        const { oid, body, file } = options;
        const organizationOrigin = await this.organizationRepository.findOneById(oid);
        let image;
        if (organizationOrigin.logoImageId) {
            image = await this.imageRepository.findOneBy({ oid, id: organizationOrigin.logoImageId });
        }
        const [logoImageId] = await this.imageManagerService.changeImageList({
            oid,
            customerId: 0,
            files: [file],
            filesPosition: [0],
            imageIdsKeep: [],
            imageIdsOld: image ? [image.id] : [],
        });
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, {
            name: body.name,
            addressProvince: body.addressProvince,
            addressDistrict: body.addressDistrict,
            addressWard: body.addressWard,
            addressStreet: body.addressStreet,
            logoImageId,
        });
        if (!organization)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        organization.logoImage = await this.imageRepository.findOneBy({ oid, id: logoImageId });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async changeEmail(oid, email) {
        const rootOrganization = await this.organizationRepository.findOneById(oid);
        if (rootOrganization.email === email) {
            throw new common_1.HttpException('Email mới và email cũ cùng địa chỉ', common_1.HttpStatus.BAD_REQUEST);
        }
        const existOrganization = await this.organizationRepository.findOneBy({ email });
        if (existOrganization) {
            throw new common_1.HttpException('Email đã có người khác sử dụng. Vui lòng chọn email khác', common_1.HttpStatus.BAD_REQUEST);
        }
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, {
            email,
            emailVerify: 0,
        });
        if (!organization) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.updateOrganizationInfo(organization);
        await this.sendEmailVerifyOrganizationEmail(oid);
        return { data: { organization } };
    }
    async sendEmailVerifyOrganizationEmail(oid) {
        const organization = await this.organizationRepository.findOneById(oid);
        if (!organization || !organization.email || organization.emailVerify === 1) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        const token = encodeURIComponent((0, string_helper_1.encrypt)(organization.email, this.jwtConfig.refreshKey, 30 * 60 * 1000));
        const link = `${this.globalConfig.DOMAIN_BACK_END}/organization/verify-organization-email`
            + `?oid=${oid}&email=${organization.email}&token=${token}&ver=1`;
        const sendEmailResult = await this.emailService.send({
            to: organization.email,
            subject: '[MEA] - Kích hoạt email tài khoản',
            from: 'medihome.vn@gmail.com',
            text: 'active_email',
            html: '<p>Nhấn vào đường link sau để kích hoạt email tài khoản: </p>'
                + `<p><a href="${link}">${link}</a></p>`
                + '<p>Link sẽ bị vô hiệu hóa sau 30 phút</p>',
        });
        return { data: { sendEmailResult } };
    }
    async verifyOrganizationEmail(query) {
        let email;
        try {
            email = (0, string_helper_1.decrypt)(query.token, this.jwtConfig.refreshKey);
        }
        catch (error) {
            throw new common_1.HttpException('Thời gian reset password đã quá hạn', common_1.HttpStatus.BAD_GATEWAY);
        }
        if (query.email !== email) {
            throw new exception_filter_1.BusinessException('error.Token.Invalid');
        }
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: query.oid }, { emailVerify: 1 });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
};
exports.ApiOrganizationService = ApiOrganizationService;
exports.ApiOrganizationService = ApiOrganizationService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(environments_1.GlobalConfig.KEY)),
    __param(1, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _b : Object, typeof (_c = typeof email_service_1.EmailService !== "undefined" && email_service_1.EmailService) === "function" ? _c : Object, typeof (_d = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _d : Object, typeof (_e = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _e : Object, typeof (_f = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _f : Object, typeof (_g = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _g : Object])
], ApiOrganizationService);


/***/ }),
/* 392 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ImageManagerService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageManagerService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const object_helper_1 = __webpack_require__(91);
const image_entity_1 = __webpack_require__(19);
const setting_entity_1 = __webpack_require__(40);
const image_repository_1 = __webpack_require__(177);
const setting_repository_1 = __webpack_require__(88);
const google_driver_service_1 = __webpack_require__(232);
let ImageManagerService = ImageManagerService_1 = class ImageManagerService {
    constructor(imageRepository, googleDriverService, cacheDataService, settingRepository) {
        this.imageRepository = imageRepository;
        this.googleDriverService = googleDriverService;
        this.cacheDataService = cacheDataService;
        this.settingRepository = settingRepository;
        this.logger = new common_1.Logger(ImageManagerService_1.name);
    }
    async onModuleInit() {
        try {
            const settingList = await this.settingRepository.findManyBy({ key: setting_entity_1.SettingKey.GOOGLE_DRIVER });
            settingList.forEach((setting) => {
                const data = setting.data ? JSON.parse(setting.data) : {};
                if (!data.email || !data.refreshToken)
                    return;
                this.googleDriverService.setCache(data.email, {
                    rootFolderId: '',
                    refreshToken: data.refreshToken,
                    defaultFolderId: '',
                    defaultFolderName: '',
                });
            });
        }
        catch (error) {
            this.logger.error(error.message);
        }
    }
    async changeImageList(options) {
        const { oid, customerId, imageIdsKeep, imageIdsOld, files, filesPosition } = options;
        const imageOldList = imageIdsOld.length
            ? await this.imageRepository.findManyByIds(imageIdsOld)
            : [];
        const imageRemoveList = imageOldList.filter((i) => !imageIdsKeep.includes(i.id));
        const imageRemoveMapList = (0, object_helper_1.arrayToKeyArray)(imageRemoveList, 'hostAccount');
        const email = await this.cacheDataService.getEmailGoogleDriver(oid);
        const [imageHostInsertList, ...imageHostTrashResponse] = await Promise.all([
            this.googleDriverService.uploadMultipleFiles({
                files,
                email,
                oid,
                customerId,
            }),
            ...Object.entries(imageRemoveMapList).map(([curEmail, imageList]) => {
                return this.googleDriverService.trashMultipleFiles({
                    oid,
                    email: curEmail,
                    fileIds: imageList.map((i) => i.hostId),
                });
            }),
        ]);
        const imageInsertList = imageHostInsertList.map((i, index) => {
            const draft = {
                oid,
                customerId,
                name: i.name,
                size: Number(i.size),
                mimeType: i.mimeType,
                hostType: image_entity_1.ImageHost.GoogleDriver,
                hostAccount: email,
                hostId: i.id,
            };
            return draft;
        });
        const imageHostTrashSuccess = imageHostTrashResponse.map((i) => i.success).flat();
        const imageHostTrashFailed = imageHostTrashResponse.map((i) => i.failed).flat();
        const imageIdsRemoveSuccess = imageRemoveList
            .filter((i) => imageHostTrashSuccess.includes(i.hostId))
            .map((i) => i.id);
        const imageIdsRemoveFailed = imageRemoveList
            .filter((i) => imageHostTrashFailed.includes(i.hostId))
            .map((i) => i.id);
        const [imageIdsNew] = await Promise.all([
            this.imageRepository.insertManyFullField(imageInsertList),
            imageIdsRemoveSuccess.length
                ? this.imageRepository.delete({ id: { IN: imageIdsRemoveSuccess } })
                : null,
            imageIdsRemoveFailed.length
                ? this.imageRepository.update({ id: { IN: imageIdsRemoveFailed } }, { waitDelete: 1 })
                : null,
        ]);
        const imageIdsUpdate = [...imageIdsKeep];
        filesPosition.sort((a, b) => (a < b ? -1 : 1));
        for (let i = 0; i < filesPosition.length; i++) {
            imageIdsUpdate.splice(filesPosition[i], 0, imageIdsNew[i]);
        }
        return imageIdsUpdate;
    }
};
exports.ImageManagerService = ImageManagerService;
exports.ImageManagerService = ImageManagerService = ImageManagerService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _a : Object, typeof (_b = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object, typeof (_d = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _d : Object])
], ImageManagerService);


/***/ }),
/* 393 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(394), exports);
__exportStar(__webpack_require__(395), exports);
__exportStar(__webpack_require__(396), exports);
__exportStar(__webpack_require__(397), exports);
__exportStar(__webpack_require__(398), exports);


/***/ }),
/* 394 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationChangeEmailBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class OrganizationChangeEmailBody {
}
exports.OrganizationChangeEmailBody = OrganizationChangeEmailBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'email', example: 'vm@gmail.com' }),
    (0, class_transformer_1.Transform)(({ value }) => {
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], OrganizationChangeEmailBody.prototype, "email", void 0);


/***/ }),
/* 395 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationGetOneQuery = exports.OrganizationGetManyQuery = exports.OrganizationPaginationQuery = exports.OrganizationGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const organization_options_request_1 = __webpack_require__(396);
class OrganizationGetQuery {
}
exports.OrganizationGetQuery = OrganizationGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            userList: true,
            logoImage: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof organization_options_request_1.OrganizationRelationQuery !== "undefined" && organization_options_request_1.OrganizationRelationQuery) === "function" ? _a : Object)
], OrganizationGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof organization_options_request_1.OrganizationFilterQuery !== "undefined" && organization_options_request_1.OrganizationFilterQuery) === "function" ? _b : Object)
], OrganizationGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof organization_options_request_1.OrganizationSortQuery !== "undefined" && organization_options_request_1.OrganizationSortQuery) === "function" ? _c : Object)
], OrganizationGetQuery.prototype, "sort", void 0);
class OrganizationPaginationQuery extends (0, swagger_1.IntersectionType)(OrganizationGetQuery, query_1.PaginationQuery) {
}
exports.OrganizationPaginationQuery = OrganizationPaginationQuery;
class OrganizationGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(OrganizationGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.OrganizationGetManyQuery = OrganizationGetManyQuery;
class OrganizationGetOneQuery extends (0, swagger_1.PickType)(OrganizationGetQuery, ['relation']) {
}
exports.OrganizationGetOneQuery = OrganizationGetOneQuery;


/***/ }),
/* 396 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationSortQuery = exports.OrganizationFilterQuery = exports.OrganizationRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class OrganizationRelationQuery {
}
exports.OrganizationRelationQuery = OrganizationRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], OrganizationRelationQuery.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], OrganizationRelationQuery.prototype, "logoImage", void 0);
class OrganizationFilterQuery {
}
exports.OrganizationFilterQuery = OrganizationFilterQuery;
class OrganizationSortQuery extends query_1.SortQuery {
}
exports.OrganizationSortQuery = OrganizationSortQuery;


/***/ }),
/* 397 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationUpdateInfoBody = exports.OrganizationUpdateInfoAndLogoBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const file_1 = __webpack_require__(270);
class OrganizationUpdateInfoAndLogoBody extends file_1.SingleFileUpload {
}
exports.OrganizationUpdateInfoAndLogoBody = OrganizationUpdateInfoAndLogoBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Phòng khám đa khoa Medical' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationUpdateInfoAndLogoBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationUpdateInfoAndLogoBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Huyện Cát Tiên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationUpdateInfoAndLogoBody.prototype, "addressDistrict", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationUpdateInfoAndLogoBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationUpdateInfoAndLogoBody.prototype, "addressStreet", void 0);
class OrganizationUpdateInfoBody extends (0, swagger_1.OmitType)(OrganizationUpdateInfoAndLogoBody, ['file']) {
}
exports.OrganizationUpdateInfoBody = OrganizationUpdateInfoBody;


/***/ }),
/* 398 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VerifyOrganizationEmailQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class VerifyOrganizationEmailQuery {
}
exports.VerifyOrganizationEmailQuery = VerifyOrganizationEmailQuery;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], VerifyOrganizationEmailQuery.prototype, "oid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mea@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '$2b$05$G17lx6yO8fK2iJK6tqX2XODsCrawFzSht5vJQjE7wlDJO0.4zxPxO' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "token", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '1' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "ver", void 0);


/***/ }),
/* 399 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodModule = void 0;
const common_1 = __webpack_require__(3);
const api_payment_method_controller_1 = __webpack_require__(400);
const api_payment_method_service_1 = __webpack_require__(401);
let ApiPaymentMethodModule = class ApiPaymentMethodModule {
};
exports.ApiPaymentMethodModule = ApiPaymentMethodModule;
exports.ApiPaymentMethodModule = ApiPaymentMethodModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_payment_method_controller_1.ApiPaymentMethodController],
        providers: [api_payment_method_service_1.ApiPaymentMethodService],
    })
], ApiPaymentMethodModule);


/***/ }),
/* 400 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_payment_method_service_1 = __webpack_require__(401);
const request_1 = __webpack_require__(402);
let ApiPaymentMethodController = class ApiPaymentMethodController {
    constructor(apiPaymentMethodService) {
        this.apiPaymentMethodService = apiPaymentMethodService;
    }
    pagination({ oid }, query) {
        return this.apiPaymentMethodService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiPaymentMethodService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiPaymentMethodService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiPaymentMethodService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiPaymentMethodService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiPaymentMethodService.destroyOne({ oid, paymentMethodId: id });
    }
};
exports.ApiPaymentMethodController = ApiPaymentMethodController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PaymentMethodPaginationQuery !== "undefined" && request_1.PaymentMethodPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentMethodController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PaymentMethodGetManyQuery !== "undefined" && request_1.PaymentMethodGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentMethodController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentMethodController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.PaymentMethodCreateBody !== "undefined" && request_1.PaymentMethodCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiPaymentMethodController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.PaymentMethodUpdateBody !== "undefined" && request_1.PaymentMethodUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiPaymentMethodController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiPaymentMethodController.prototype, "destroyOne", null);
exports.ApiPaymentMethodController = ApiPaymentMethodController = __decorate([
    (0, swagger_1.ApiTags)('PaymentMethod'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('payment-method'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_payment_method_service_1.ApiPaymentMethodService !== "undefined" && api_payment_method_service_1.ApiPaymentMethodService) === "function" ? _a : Object])
], ApiPaymentMethodController);


/***/ }),
/* 401 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(170);
const payment_method_repository_1 = __webpack_require__(181);
let ApiPaymentMethodService = class ApiPaymentMethodService {
    constructor(paymentMethodRepository, paymentRepository) {
        this.paymentMethodRepository = paymentMethodRepository;
        this.paymentRepository = paymentRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.paymentMethodRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.paymentMethodRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const paymentMethod = await this.paymentMethodRepository.findOneBy({ oid, id });
        if (!paymentMethod)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { paymentMethod } };
    }
    async createOne(oid, body) {
        const paymentMethod = await this.paymentMethodRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, body));
        return { data: { paymentMethod } };
    }
    async updateOne(oid, id, body) {
        const [paymentMethod] = await this.paymentMethodRepository.updateAndReturnEntity({ id, oid }, body);
        if (!paymentMethod) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'PaymentMethod',
            });
        }
        return { data: { paymentMethod } };
    }
    async destroyOne(options) {
        const { oid, paymentMethodId } = options;
        await Promise.all([
            this.paymentMethodRepository.delete({ oid, id: paymentMethodId }),
            this.paymentRepository.update({ oid, paymentMethodId }, { paymentMethodId: 0 }),
        ]);
        return { data: { paymentMethodId } };
    }
};
exports.ApiPaymentMethodService = ApiPaymentMethodService;
exports.ApiPaymentMethodService = ApiPaymentMethodService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof payment_method_repository_1.PaymentMethodRepository !== "undefined" && payment_method_repository_1.PaymentMethodRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _b : Object])
], ApiPaymentMethodService);


/***/ }),
/* 402 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(403), exports);
__exportStar(__webpack_require__(404), exports);
__exportStar(__webpack_require__(405), exports);


/***/ }),
/* 403 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodGetOneQuery = exports.PaymentMethodGetManyQuery = exports.PaymentMethodPaginationQuery = exports.PaymentMethodGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const payment_method_options_request_1 = __webpack_require__(404);
class PaymentMethodGetQuery {
}
exports.PaymentMethodGetQuery = PaymentMethodGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof payment_method_options_request_1.PaymentMethodRelationQuery !== "undefined" && payment_method_options_request_1.PaymentMethodRelationQuery) === "function" ? _a : Object)
], PaymentMethodGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof payment_method_options_request_1.PaymentMethodFilterQuery !== "undefined" && payment_method_options_request_1.PaymentMethodFilterQuery) === "function" ? _b : Object)
], PaymentMethodGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof payment_method_options_request_1.PaymentMethodSortQuery !== "undefined" && payment_method_options_request_1.PaymentMethodSortQuery) === "function" ? _c : Object)
], PaymentMethodGetQuery.prototype, "sort", void 0);
class PaymentMethodPaginationQuery extends (0, swagger_1.IntersectionType)(PaymentMethodGetQuery, query_1.PaginationQuery) {
}
exports.PaymentMethodPaginationQuery = PaymentMethodPaginationQuery;
class PaymentMethodGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PaymentMethodGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PaymentMethodGetManyQuery = PaymentMethodGetManyQuery;
class PaymentMethodGetOneQuery extends (0, swagger_1.PickType)(PaymentMethodGetQuery, ['relation']) {
}
exports.PaymentMethodGetOneQuery = PaymentMethodGetOneQuery;


/***/ }),
/* 404 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodSortQuery = exports.PaymentMethodFilterQuery = exports.PaymentMethodRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class PaymentMethodRelationQuery {
}
exports.PaymentMethodRelationQuery = PaymentMethodRelationQuery;
class PaymentMethodFilterQuery {
}
exports.PaymentMethodFilterQuery = PaymentMethodFilterQuery;
class PaymentMethodSortQuery extends query_1.SortQuery {
}
exports.PaymentMethodSortQuery = PaymentMethodSortQuery;


/***/ }),
/* 405 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodUpdateBody = exports.PaymentMethodCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class PaymentMethodCreateBody {
}
exports.PaymentMethodCreateBody = PaymentMethodCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PaymentMethodCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Tiền mặt' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], PaymentMethodCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], PaymentMethodCreateBody.prototype, "isActive", void 0);
class PaymentMethodUpdateBody extends (0, swagger_1.PartialType)(PaymentMethodCreateBody) {
}
exports.PaymentMethodUpdateBody = PaymentMethodUpdateBody;


/***/ }),
/* 406 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentModule = void 0;
const common_1 = __webpack_require__(3);
const api_payment_controller_1 = __webpack_require__(407);
const api_payment_service_1 = __webpack_require__(408);
let ApiPaymentModule = class ApiPaymentModule {
};
exports.ApiPaymentModule = ApiPaymentModule;
exports.ApiPaymentModule = ApiPaymentModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_payment_controller_1.ApiPaymentController],
        providers: [api_payment_service_1.ApiPaymentService],
    })
], ApiPaymentModule);


/***/ }),
/* 407 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_payment_service_1 = __webpack_require__(408);
const request_1 = __webpack_require__(409);
let ApiPaymentController = class ApiPaymentController {
    constructor(apiPaymentService) {
        this.apiPaymentService = apiPaymentService;
    }
    pagination({ oid }, query) {
        return this.apiPaymentService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiPaymentService.getMany(oid, query);
    }
    async sumMoney({ oid }, query) {
        return await this.apiPaymentService.sumMoney(oid, query);
    }
    customerPaymentMoneyIn({ oid }, body) {
        return this.apiPaymentService.customerPaymentMoneyIn(oid, body);
    }
    distributorPaymentMoneyOut({ oid }, body) {
        return this.apiPaymentService.distributorPaymentMoneyOut(oid, body);
    }
    otherPaymentMoneyIn({ oid, user }, body) {
        return this.apiPaymentService.otherPaymentMoneyIn({ oid, body, userId: user.id });
    }
    otherPaymentMoneyOut({ oid, user }, body) {
        return this.apiPaymentService.otherPaymentMoneyOut({ oid, body, userId: user.id });
    }
};
exports.ApiPaymentController = ApiPaymentController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PaymentPaginationQuery !== "undefined" && request_1.PaymentPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PaymentGetManyQuery !== "undefined" && request_1.PaymentGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiPaymentController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('sum-money'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.PaymentGetManyQuery !== "undefined" && request_1.PaymentGetManyQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiPaymentController.prototype, "sumMoney", null);
__decorate([
    (0, common_1.Post)('customer-money-in'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PAYMENT_CUSTOMER_MONEY_IN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.CustomerPaymentBody !== "undefined" && request_1.CustomerPaymentBody) === "function" ? _j : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentController.prototype, "customerPaymentMoneyIn", null);
__decorate([
    (0, common_1.Post)('distributor-money-out'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PAYMENT_DISTRIBUTOR_MONEY_OUT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.DistributorPaymentBody !== "undefined" && request_1.DistributorPaymentBody) === "function" ? _l : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentController.prototype, "distributorPaymentMoneyOut", null);
__decorate([
    (0, common_1.Post)('other-money-in'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_IN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.OtherPaymentBody !== "undefined" && request_1.OtherPaymentBody) === "function" ? _o : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentController.prototype, "otherPaymentMoneyIn", null);
__decorate([
    (0, common_1.Post)('other-money-out'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_OUT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof request_1.OtherPaymentBody !== "undefined" && request_1.OtherPaymentBody) === "function" ? _q : Object]),
    __metadata("design:returntype", void 0)
], ApiPaymentController.prototype, "otherPaymentMoneyOut", null);
exports.ApiPaymentController = ApiPaymentController = __decorate([
    (0, swagger_1.ApiTags)('Payment'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('payment'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_payment_service_1.ApiPaymentService !== "undefined" && api_payment_service_1.ApiPaymentService) === "function" ? _a : Object])
], ApiPaymentController);


/***/ }),
/* 408 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentService = void 0;
const common_1 = __webpack_require__(3);
const object_helper_1 = __webpack_require__(91);
const payment_entity_1 = __webpack_require__(48);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const payment_repository_1 = __webpack_require__(182);
let ApiPaymentService = class ApiPaymentService {
    constructor(paymentRepository, receiptRepository, ticketRepository, customerRepository, distributorRepository, userRepository, customerPaymentOperation, distributorPaymentOperation) {
        this.paymentRepository = paymentRepository;
        this.receiptRepository = receiptRepository;
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
        this.distributorRepository = distributorRepository;
        this.userRepository = userRepository;
        this.customerPaymentOperation = customerPaymentOperation;
        this.distributorPaymentOperation = distributorPaymentOperation;
    }
    async pagination(oid, query) {
        const { page, limit, relation, filter, sort } = query;
        const { data, total } = await this.paymentRepository.pagination({
            relationLoadStrategy: 'query',
            relation: {
                paymentMethod: relation === null || relation === void 0 ? void 0 : relation.paymentMethod,
            },
            page,
            limit,
            condition: {
                oid,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                voucherType: filter === null || filter === void 0 ? void 0 : filter.voucherType,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                paymentTiming: filter === null || filter === void 0 ? void 0 : filter.paymentTiming,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
            },
            sort,
        });
        const receiptIds = data
            .filter((i) => i.voucherType === payment_entity_1.VoucherType.Receipt)
            .map((i) => i.voucherId);
        const ticketIds = data
            .filter((i) => i.voucherType === payment_entity_1.VoucherType.Ticket)
            .map((i) => i.voucherId);
        const distributorIds = data
            .filter((i) => i.personType === payment_entity_1.PersonType.Distributor)
            .map((i) => i.personId);
        const customerIds = data
            .filter((i) => i.personType === payment_entity_1.PersonType.Customer)
            .map((i) => i.personId);
        const employeeIds = data
            .filter((i) => i.personType === payment_entity_1.PersonType.Employee)
            .map((i) => i.personId);
        const cashierIds = data.map((i) => i.cashierId);
        const userIds = [...employeeIds, ...cashierIds];
        const [receiptList, ticketList, distributorList, customerList, userList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.receipt) && receiptIds.length
                ? this.receiptRepository.findMany({
                    condition: { id: { IN: object_helper_1.ESArray.uniqueArray(receiptIds) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIds.length
                ? this.ticketRepository.findMany({
                    condition: { id: { IN: object_helper_1.ESArray.uniqueArray(ticketIds) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.distributor) && distributorIds.length
                ? this.distributorRepository.findManyBy({ id: { IN: object_helper_1.ESArray.uniqueArray(distributorIds) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIds.length
                ? this.customerRepository.findManyBy({ id: { IN: object_helper_1.ESArray.uniqueArray(customerIds) } })
                : [],
            ((relation === null || relation === void 0 ? void 0 : relation.employee) || (relation === null || relation === void 0 ? void 0 : relation.cashier)) && userIds.length
                ? this.userRepository.findMany({ condition: { id: { IN: object_helper_1.ESArray.uniqueArray(userIds) } } })
                : [],
        ]);
        data.forEach((payment) => {
            if (payment.voucherType === payment_entity_1.VoucherType.Receipt) {
                payment.receipt = receiptList.find((v) => v.id === payment.voucherId);
            }
            if (payment.voucherType === payment_entity_1.VoucherType.Ticket) {
                payment.ticket = ticketList.find((v) => v.id === payment.voucherId);
            }
            if (payment.personType === payment_entity_1.PersonType.Distributor) {
                payment.distributor = distributorList.find((c) => c.id === payment.personId);
            }
            if (payment.personType === payment_entity_1.PersonType.Customer) {
                payment.customer = customerList.find((c) => c.id === payment.personId);
            }
            if (payment.personType === payment_entity_1.PersonType.Employee) {
                payment.employee = userList.find((c) => c.id === payment.personId);
            }
            payment.cashier = userList.find((u) => u.id === payment.cashierId);
        });
        return {
            data: { paymentList: data, total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { relation, filter, limit, sort } = query;
        const paymentList = await this.paymentRepository.findMany({
            relationLoadStrategy: 'query',
            relation: {
                paymentMethod: relation === null || relation === void 0 ? void 0 : relation.paymentMethod,
            },
            condition: {
                oid,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                voucherType: filter === null || filter === void 0 ? void 0 : filter.voucherType,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                paymentTiming: filter === null || filter === void 0 ? void 0 : filter.paymentTiming,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
            },
            limit,
            sort,
        });
        return { data: { paymentList } };
    }
    async sumMoney(oid, query) {
        const { filter } = query;
        const aggregateRaw = await this.paymentRepository.findAndSelect({
            condition: {
                oid,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                voucherType: filter === null || filter === void 0 ? void 0 : filter.voucherType,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                paymentTiming: filter === null || filter === void 0 ? void 0 : filter.paymentTiming,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
            },
            select: ['moneyDirection'],
            aggregate: {
                sumPaidAmount: { SUM: ['paidAmount'] },
                count: { COUNT: '*' },
            },
            groupBy: ['moneyDirection'],
        });
        const aggregate = aggregateRaw.map((i) => {
            return {
                moneyDirection: i.moneyDirection,
                sumPaidAmount: Number(i.sumPaidAmount),
                count: Number(i.count),
            };
        });
        return { data: { aggregate } };
    }
    async customerPaymentMoneyIn(oid, body) {
        try {
            const { customer } = await this.customerPaymentOperation.startPayment({
                oid,
                customerId: body.customerId,
                paymentMethodId: body.paymentMethodId,
                time: Date.now(),
                ticketPaymentList: body.ticketPaymentList,
                note: body.note,
                money: body.money,
                cashierId: body.cashierId,
            });
            return { data: { customer } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async distributorPaymentMoneyOut(oid, body) {
        try {
            const { distributor } = await this.distributorPaymentOperation.startPayment({
                oid,
                distributorId: body.distributorId,
                paymentMethodId: body.paymentMethodId,
                time: Date.now(),
                receiptPaymentList: body.receiptPaymentList,
                note: body.note,
                money: body.money,
                cashierId: body.cashierId,
            });
            return { data: { distributor } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async otherPaymentMoneyIn(options) {
        const { oid, userId, body } = options;
        const paymentInsert = {
            oid,
            paymentMethodId: body.paymentMethodId,
            voucherType: payment_entity_1.VoucherType.Unknown,
            voucherId: 0,
            personType: payment_entity_1.PersonType.Unknown,
            personId: 0,
            paymentTiming: payment_entity_1.PaymentTiming.Other,
            createdAt: Date.now(),
            moneyDirection: payment_entity_1.MoneyDirection.In,
            paidAmount: body.money,
            debtAmount: 0,
            openDebt: 0,
            closeDebt: 0,
            cashierId: userId,
            note: body.note || '',
            description: '',
        };
        const payment = await this.paymentRepository.insertOneAndReturnEntity(paymentInsert);
        return {
            data: { payment },
        };
    }
    async otherPaymentMoneyOut(options) {
        const { oid, userId, body } = options;
        const paymentInsert = {
            oid,
            paymentMethodId: body.paymentMethodId,
            voucherType: payment_entity_1.VoucherType.Unknown,
            voucherId: 0,
            personType: payment_entity_1.PersonType.Unknown,
            personId: 0,
            paymentTiming: payment_entity_1.PaymentTiming.Other,
            createdAt: Date.now(),
            moneyDirection: payment_entity_1.MoneyDirection.Out,
            paidAmount: body.money,
            debtAmount: 0,
            openDebt: 0,
            closeDebt: 0,
            cashierId: userId,
            note: body.note || '',
            description: '',
        };
        const payment = await this.paymentRepository.insertOneAndReturnEntity(paymentInsert);
        return {
            data: { payment },
        };
    }
};
exports.ApiPaymentService = ApiPaymentService;
exports.ApiPaymentService = ApiPaymentService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof payment_repository_1.PaymentRepository !== "undefined" && payment_repository_1.PaymentRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ReceiptRepository !== "undefined" && repositories_1.ReceiptRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.DistributorRepository !== "undefined" && repositories_1.DistributorRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _f : Object, typeof (_g = typeof operations_1.CustomerPaymentOperation !== "undefined" && operations_1.CustomerPaymentOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.DistributorPaymentOperation !== "undefined" && operations_1.DistributorPaymentOperation) === "function" ? _h : Object])
], ApiPaymentService);


/***/ }),
/* 409 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(410), exports);
__exportStar(__webpack_require__(411), exports);
__exportStar(__webpack_require__(412), exports);
__exportStar(__webpack_require__(413), exports);


/***/ }),
/* 410 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPaymentBody = exports.TicketPayment = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketPayment {
}
exports.TicketPayment = TicketPayment;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPayment.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketPayment.prototype, "money", void 0);
class CustomerPaymentBody {
}
exports.CustomerPaymentBody = CustomerPaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPaymentBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPaymentBody.prototype, "cashierId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerPaymentBody.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerPaymentBody.prototype, "money", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: TicketPayment,
        isArray: true,
        example: [
            { ticketId: 12, money: 10000 },
            { ticketId: 13, money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => TicketPayment),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], CustomerPaymentBody.prototype, "ticketPaymentList", void 0);


/***/ }),
/* 411 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPaymentBody = exports.ReceiptPayment = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ReceiptPayment {
}
exports.ReceiptPayment = ReceiptPayment;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ReceiptPayment.prototype, "receiptId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReceiptPayment.prototype, "money", void 0);
class DistributorPaymentBody {
}
exports.DistributorPaymentBody = DistributorPaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPaymentBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPaymentBody.prototype, "cashierId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorPaymentBody.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DistributorPaymentBody.prototype, "money", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: ReceiptPayment,
        isArray: true,
        example: [
            { receiptId: 12, money: 10000 },
            { receiptId: 13, money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => ReceiptPayment),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], DistributorPaymentBody.prototype, "receiptPaymentList", void 0);


/***/ }),
/* 412 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OtherPaymentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class OtherPaymentBody {
}
exports.OtherPaymentBody = OtherPaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], OtherPaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], OtherPaymentBody.prototype, "money", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OtherPaymentBody.prototype, "note", void 0);


/***/ }),
/* 413 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentGetOneQuery = exports.PaymentGetManyQuery = exports.PaymentPaginationQuery = exports.PaymentGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const payment_options_1 = __webpack_require__(414);
class PaymentGetQuery {
}
exports.PaymentGetQuery = PaymentGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof payment_options_1.PaymentRelationQuery !== "undefined" && payment_options_1.PaymentRelationQuery) === "function" ? _a : Object)
], PaymentGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            personId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof payment_options_1.PaymentFilterQuery !== "undefined" && payment_options_1.PaymentFilterQuery) === "function" ? _b : Object)
], PaymentGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof payment_options_1.PaymentSortQuery !== "undefined" && payment_options_1.PaymentSortQuery) === "function" ? _c : Object)
], PaymentGetQuery.prototype, "sort", void 0);
class PaymentPaginationQuery extends (0, swagger_1.IntersectionType)(PaymentGetQuery, query_1.PaginationQuery) {
}
exports.PaymentPaginationQuery = PaymentPaginationQuery;
class PaymentGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PaymentGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PaymentGetManyQuery = PaymentGetManyQuery;
class PaymentGetOneQuery extends (0, swagger_1.PickType)(PaymentGetQuery, ['relation']) {
}
exports.PaymentGetOneQuery = PaymentGetOneQuery;


/***/ }),
/* 414 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentSortQuery = exports.PaymentFilterQuery = exports.PaymentRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const payment_entity_1 = __webpack_require__(48);
class PaymentRelationQuery {
}
exports.PaymentRelationQuery = PaymentRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "employee", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "cashier", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "paymentMethod", void 0);
class PaymentFilterQuery {
}
exports.PaymentFilterQuery = PaymentFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.VoucherType),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.VoucherType)),
    __metadata("design:type", typeof (_a = typeof payment_entity_1.VoucherType !== "undefined" && payment_entity_1.VoucherType) === "function" ? _a : Object)
], PaymentFilterQuery.prototype, "voucherType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "voucherId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.PersonType),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.PersonType)),
    __metadata("design:type", typeof (_b = typeof payment_entity_1.PersonType !== "undefined" && payment_entity_1.PersonType) === "function" ? _b : Object)
], PaymentFilterQuery.prototype, "personType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "personId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.PaymentTiming),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.PaymentTiming)),
    __metadata("design:type", typeof (_c = typeof payment_entity_1.PaymentTiming !== "undefined" && payment_entity_1.PaymentTiming) === "function" ? _c : Object)
], PaymentFilterQuery.prototype, "paymentTiming", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _d : Object)
], PaymentFilterQuery.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.MoneyDirection),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.MoneyDirection)),
    __metadata("design:type", typeof (_e = typeof payment_entity_1.MoneyDirection !== "undefined" && payment_entity_1.MoneyDirection) === "function" ? _e : Object)
], PaymentFilterQuery.prototype, "moneyDirection", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "cashierId", void 0);
class PaymentSortQuery extends query_1.SortQuery {
}
exports.PaymentSortQuery = PaymentSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PaymentSortQuery.prototype, "createdAt", void 0);


/***/ }),
/* 415 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionModule = void 0;
const common_1 = __webpack_require__(3);
const api_permission_controller_1 = __webpack_require__(416);
const api_permission_service_1 = __webpack_require__(417);
let ApiPermissionModule = class ApiPermissionModule {
};
exports.ApiPermissionModule = ApiPermissionModule;
exports.ApiPermissionModule = ApiPermissionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_permission_controller_1.ApiPermissionController],
        providers: [api_permission_service_1.ApiPermissionService],
    })
], ApiPermissionModule);


/***/ }),
/* 416 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(24);
const api_permission_service_1 = __webpack_require__(417);
const request_1 = __webpack_require__(418);
let ApiPermissionController = class ApiPermissionController {
    constructor(apiPermissionService) {
        this.apiPermissionService = apiPermissionService;
    }
    list(query) {
        return this.apiPermissionService.getMany(query);
    }
    initData() {
        return this.apiPermissionService.initData();
    }
};
exports.ApiPermissionController = ApiPermissionController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.PermissionGetManyQuery !== "undefined" && request_1.PermissionGetManyQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiPermissionController.prototype, "list", null);
__decorate([
    (0, common_1.Post)('init-data'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiPermissionController.prototype, "initData", null);
exports.ApiPermissionController = ApiPermissionController = __decorate([
    (0, swagger_1.ApiTags)('Permission'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('permission'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_permission_service_1.ApiPermissionService !== "undefined" && api_permission_service_1.ApiPermissionService) === "function" ? _a : Object])
], ApiPermissionController);


/***/ }),
/* 417 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const permission_entity_1 = __webpack_require__(77);
const permission_repository_1 = __webpack_require__(86);
let ApiPermissionService = class ApiPermissionService {
    constructor(cacheDataService, permissionRepository) {
        this.cacheDataService = cacheDataService;
        this.permissionRepository = permissionRepository;
    }
    async getMany(query) {
        const { limit, filter, sort } = query;
        const data = await this.permissionRepository.findMany({
            condition: {
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                rootId: filter === null || filter === void 0 ? void 0 : filter.rootId,
            },
            limit,
            sort,
        });
        return { data };
    }
    async initData() {
        const permissionOrganization = [
            {
                id: permission_entity_1.PermissionId.ORGANIZATION,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ORGANIZATION],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.ORGANIZATION}`,
                name: 'Quản lý cơ sở (Admin)',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.ORGANIZATION,
            },
            {
                id: permission_entity_1.PermissionId.ORGANIZATION_UPDATE_INFO,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ORGANIZATION_UPDATE_INFO],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.ORGANIZATION}.${permission_entity_1.PermissionId.ORGANIZATION_UPDATE_INFO}`,
                name: 'Sửa thông tin cơ sở',
                parentId: permission_entity_1.PermissionId.ORGANIZATION,
                rootId: permission_entity_1.PermissionId.ORGANIZATION,
            },
            {
                id: permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.ORGANIZATION}.${permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT}`,
                name: 'Chỉnh sửa cài đặt',
                parentId: permission_entity_1.PermissionId.ORGANIZATION,
                rootId: permission_entity_1.PermissionId.ORGANIZATION,
            },
            {
                id: permission_entity_1.PermissionId.ORGANIZATION_VERIFY_EMAIL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ORGANIZATION_VERIFY_EMAIL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.ORGANIZATION}.${permission_entity_1.PermissionId.ORGANIZATION_VERIFY_EMAIL}`,
                name: 'Sửa và kích hoạt email',
                parentId: permission_entity_1.PermissionId.ORGANIZATION,
                rootId: permission_entity_1.PermissionId.ORGANIZATION,
            },
        ];
        const permissionUser = [
            {
                id: permission_entity_1.PermissionId.USER,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.USER],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.USER}`,
                name: 'Quản lý nhân viên (Admin)',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.USER,
            },
            {
                id: permission_entity_1.PermissionId.ACCOUNT_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ACCOUNT_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.USER}.${permission_entity_1.PermissionId.ACCOUNT_CRUD}`,
                name: 'Thêm, Sửa, Xóa nhân viên',
                parentId: permission_entity_1.PermissionId.USER,
                rootId: permission_entity_1.PermissionId.USER,
            },
            {
                id: permission_entity_1.PermissionId.ROLE_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.ROLE_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.USER}.${permission_entity_1.PermissionId.ROLE_CRUD}`,
                name: 'Thêm, sửa, xóa vai trò',
                parentId: permission_entity_1.PermissionId.USER,
                rootId: permission_entity_1.PermissionId.USER,
            },
            {
                id: permission_entity_1.PermissionId.COMMISSION_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.COMMISSION_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.USER}.${permission_entity_1.PermissionId.COMMISSION_CRUD}`,
                name: 'Quản lý tiền hoa hồng',
                parentId: permission_entity_1.PermissionId.USER,
                rootId: permission_entity_1.PermissionId.USER,
            },
        ];
        const permissionStatistic = [
            {
                id: permission_entity_1.PermissionId.STATISTIC,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}`,
                name: 'Quản lý thống kê',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_TICKET,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_TICKET],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_TICKET}`,
                name: 'Xem thống kê phiếu thu',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_RECEIPT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_RECEIPT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_RECEIPT}`,
                name: 'Xem thống kê phiếu nhập',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_CUSTOMER,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_CUSTOMER],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_CUSTOMER}`,
                name: 'Xem thống kê khách hàng',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_PRODUCT}`,
                name: 'Xem thống kê sản phẩm',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_PROCEDURE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_PROCEDURE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_PROCEDURE}`,
                name: 'Xem thống kê dịch vụ',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_LABORATORY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_LABORATORY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_LABORATORY}`,
                name: 'Xem thống kê xét nghiệm',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
            {
                id: permission_entity_1.PermissionId.STATISTIC_RADIOLOGY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STATISTIC_RADIOLOGY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STATISTIC}.${permission_entity_1.PermissionId.STATISTIC_RADIOLOGY}`,
                name: 'Xem thống kê phiếu CĐHA',
                parentId: permission_entity_1.PermissionId.STATISTIC,
                rootId: permission_entity_1.PermissionId.STATISTIC,
            },
        ];
        const permissionMasterData = [
            {
                id: permission_entity_1.PermissionId.MASTER_DATA,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}`,
                name: 'Quản lý danh mục',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE}`,
                name: 'Quản lý danh sách kho',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE}`,
                name: 'Quản lý dịch vụ',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_LABORATORY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_LABORATORY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_LABORATORY}`,
                name: 'Quản lý phiếu xét nghiệm',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY}`,
                name: 'Quản lý phiếu CĐHA',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE}`,
                name: 'Quản lý nguồn khách hàng',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML}`,
                name: 'Quản lý danh sách mẫu in',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE}`,
                name: 'Quản lý đơn thuốc mẫu',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
            {
                id: permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.MASTER_DATA}.${permission_entity_1.PermissionId.MASTER_DATA_PAYMENT_METHOD}`,
                name: 'Quản lý các phương thức thanh toán',
                parentId: permission_entity_1.PermissionId.MASTER_DATA,
                rootId: permission_entity_1.PermissionId.MASTER_DATA,
            },
        ];
        const permissionProduct = [
            {
                id: permission_entity_1.PermissionId.PRODUCT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}`,
                name: 'Quản lý sản phẩm',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.PRODUCT_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.PRODUCT_READ}`,
                name: 'Xem sản phẩm',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.PRODUCT_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.PRODUCT_CREATE}`,
                name: 'Thêm sản phẩm',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.PRODUCT_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.PRODUCT_UPDATE}`,
                name: 'Sửa sản phẩm',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.PRODUCT_DELETE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT_DELETE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.PRODUCT_DELETE}`,
                name: 'Xóa sản phẩm',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.BATCH_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.BATCH_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.BATCH_READ}`,
                name: 'Xem lô hàng',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.BATCH_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.BATCH_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.BATCH_CREATE}`,
                name: 'Thêm lô hàng',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.BATCH_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.BATCH_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.BATCH_UPDATE}`,
                name: 'Sửa lô hàng',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.BATCH_DELETE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.BATCH_DELETE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.BATCH_DELETE}`,
                name: 'Xóa lô hàng',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.READ_COST_PRICE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.READ_COST_PRICE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.READ_COST_PRICE}`,
                name: 'Xem giá nhập',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.BATCH_CHANGE_QUANTITY_AND_COST_PRICE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.BATCH_CHANGE_QUANTITY_AND_COST_PRICE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.BATCH_CHANGE_QUANTITY_AND_COST_PRICE}`,
                name: '*** Chỉnh sửa số lượng và giá nhập',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.PRODUCT_MERGE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PRODUCT_MERGE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.PRODUCT_MERGE}`,
                name: '*** Gộp lô hàng',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
            {
                id: permission_entity_1.PermissionId.READ_MOVEMENT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.READ_MOVEMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PRODUCT}.${permission_entity_1.PermissionId.READ_MOVEMENT}`,
                name: 'Xem lịch sử nhập xuất',
                parentId: permission_entity_1.PermissionId.PRODUCT,
                rootId: permission_entity_1.PermissionId.PRODUCT,
            },
        ];
        const permissionDistributor = [
            {
                id: permission_entity_1.PermissionId.DISTRIBUTOR,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.DISTRIBUTOR],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.DISTRIBUTOR}`,
                name: 'Quản lý nhà cung cấp',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.DISTRIBUTOR,
            },
            {
                id: permission_entity_1.PermissionId.DISTRIBUTOR_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.DISTRIBUTOR_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.DISTRIBUTOR}.${permission_entity_1.PermissionId.DISTRIBUTOR_READ}`,
                name: 'Xem nhà cung cấp',
                parentId: permission_entity_1.PermissionId.DISTRIBUTOR,
                rootId: permission_entity_1.PermissionId.DISTRIBUTOR,
            },
            {
                id: permission_entity_1.PermissionId.DISTRIBUTOR_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.DISTRIBUTOR_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.DISTRIBUTOR}.${permission_entity_1.PermissionId.DISTRIBUTOR_CREATE}`,
                name: 'Thêm nhà cung cấp',
                parentId: permission_entity_1.PermissionId.DISTRIBUTOR,
                rootId: permission_entity_1.PermissionId.DISTRIBUTOR,
            },
            {
                id: permission_entity_1.PermissionId.DISTRIBUTOR_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.DISTRIBUTOR_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.DISTRIBUTOR}.${permission_entity_1.PermissionId.DISTRIBUTOR_UPDATE}`,
                name: 'Sửa nhà cung cấp',
                parentId: permission_entity_1.PermissionId.DISTRIBUTOR,
                rootId: permission_entity_1.PermissionId.DISTRIBUTOR,
            },
            {
                id: permission_entity_1.PermissionId.DISTRIBUTOR_DELETE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.DISTRIBUTOR_DELETE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.DISTRIBUTOR}.${permission_entity_1.PermissionId.DISTRIBUTOR_DELETE}`,
                name: 'Xóa nhà cung cấp',
                parentId: permission_entity_1.PermissionId.DISTRIBUTOR,
                rootId: permission_entity_1.PermissionId.DISTRIBUTOR,
            },
        ];
        const permissionCustomer = [
            {
                id: permission_entity_1.PermissionId.CUSTOMER,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.CUSTOMER],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.CUSTOMER}`,
                name: 'Quản lý khách hàng',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.CUSTOMER,
            },
            {
                id: permission_entity_1.PermissionId.CUSTOMER_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.CUSTOMER_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.CUSTOMER}.${permission_entity_1.PermissionId.CUSTOMER_READ}`,
                name: 'Xem khách hàng',
                parentId: permission_entity_1.PermissionId.CUSTOMER,
                rootId: permission_entity_1.PermissionId.CUSTOMER,
            },
            {
                id: permission_entity_1.PermissionId.CUSTOMER_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.CUSTOMER_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.CUSTOMER}.${permission_entity_1.PermissionId.CUSTOMER_CREATE}`,
                name: 'Thêm khách hàng',
                parentId: permission_entity_1.PermissionId.CUSTOMER,
                rootId: permission_entity_1.PermissionId.CUSTOMER,
            },
            {
                id: permission_entity_1.PermissionId.CUSTOMER_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.CUSTOMER_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.CUSTOMER}.${permission_entity_1.PermissionId.CUSTOMER_UPDATE}`,
                name: 'Sửa khách hàng',
                parentId: permission_entity_1.PermissionId.CUSTOMER,
                rootId: permission_entity_1.PermissionId.CUSTOMER,
            },
            {
                id: permission_entity_1.PermissionId.CUSTOMER_DELETE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.CUSTOMER_DELETE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.CUSTOMER}.${permission_entity_1.PermissionId.CUSTOMER_DELETE}`,
                name: 'Xóa khách hàng',
                parentId: permission_entity_1.PermissionId.CUSTOMER,
                rootId: permission_entity_1.PermissionId.CUSTOMER,
            },
        ];
        const permissionReceipt = [
            {
                id: permission_entity_1.PermissionId.RECEIPT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}`,
                name: 'Quản lý phiếu nhập hàng',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_READ}`,
                name: 'Xem phiếu nhập hàng',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD}`,
                name: 'Tạo, sửa, xóa phiếu nháp',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_DEPOSITED_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_DEPOSITED_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_DEPOSITED_UPDATE}`,
                name: 'Sửa phiếu nhập hàng đang tạm ứng',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_DEPOSITED_DESTROY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_DEPOSITED_DESTROY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_DEPOSITED_DESTROY}`,
                name: 'Xóa phiếu nhập hàng không còn tạm ứng',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_PAYMENT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_PAYMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_PAYMENT}`,
                name: 'Thanh toán',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_REFUND_OVERPAID,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_REFUND_OVERPAID],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_REFUND_OVERPAID}`,
                name: 'Hoàn trả tiền',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_SEND_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_SEND_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_SEND_PRODUCT}`,
                name: 'Nhập hàng',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_CLOSE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_CLOSE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_CLOSE}`,
                name: 'Đóng phiếu',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_TERMINATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_TERMINATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_TERMINATE}`,
                name: 'Hủy phiếu',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
            {
                id: permission_entity_1.PermissionId.RECEIPT_CANCELLED_DESTROY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.RECEIPT_CANCELLED_DESTROY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.RECEIPT}.${permission_entity_1.PermissionId.RECEIPT_CANCELLED_DESTROY}`,
                name: 'Xóa phiếu đã hủy',
                parentId: permission_entity_1.PermissionId.RECEIPT,
                rootId: permission_entity_1.PermissionId.RECEIPT,
            },
        ];
        const permissionAppointment = [
            {
                id: permission_entity_1.PermissionId.APPOINTMENT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}`,
                name: 'Quản lý hẹn khám',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
            {
                id: permission_entity_1.PermissionId.APPOINTMENT_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}.${permission_entity_1.PermissionId.APPOINTMENT_READ}`,
                name: 'Xem lịch hẹn khám',
                parentId: permission_entity_1.PermissionId.APPOINTMENT,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
            {
                id: permission_entity_1.PermissionId.APPOINTMENT_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}.${permission_entity_1.PermissionId.APPOINTMENT_CREATE}`,
                name: 'Tạo lịch hẹn mới',
                parentId: permission_entity_1.PermissionId.APPOINTMENT,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
            {
                id: permission_entity_1.PermissionId.APPOINTMENT_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}.${permission_entity_1.PermissionId.APPOINTMENT_UPDATE}`,
                name: 'Sửa lịch hẹn',
                parentId: permission_entity_1.PermissionId.APPOINTMENT,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
            {
                id: permission_entity_1.PermissionId.APPOINTMENT_DELETE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT_DELETE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}.${permission_entity_1.PermissionId.APPOINTMENT_DELETE}`,
                name: 'Xóa lịch hẹn',
                parentId: permission_entity_1.PermissionId.APPOINTMENT,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
            {
                id: permission_entity_1.PermissionId.APPOINTMENT_REGISTER_TICKET,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.APPOINTMENT_REGISTER_TICKET],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.APPOINTMENT}.${permission_entity_1.PermissionId.APPOINTMENT_REGISTER_TICKET}`,
                name: 'Đón khách hàng đến và tạo phiếu đón tiếp',
                parentId: permission_entity_1.PermissionId.APPOINTMENT,
                rootId: permission_entity_1.PermissionId.APPOINTMENT,
            },
        ];
        const permissionStockCheck = [
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}`,
                name: 'Quản lý phiếu kiểm kê',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_READ}`,
                name: 'Xem phiếu kiểm kê',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD}`,
                name: 'Tạo, sửa, xóa phiếu nháp',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT}`,
                name: 'Đề nghị duyệt phiếu kiểm kê',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_PENDING_APPROVE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_PENDING_APPROVE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_PENDING_APPROVE}`,
                name: 'Duyệt phiếu kiểm kê',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE}`,
                name: '*** Tiến hành cân bằng kho',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_VOID,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_VOID],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_VOID}`,
                name: 'Hủy phiếu',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
            {
                id: permission_entity_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.STOCK_CHECK}.${permission_entity_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY}`,
                name: 'Xóa phiếu đã hủy',
                parentId: permission_entity_1.PermissionId.STOCK_CHECK,
                rootId: permission_entity_1.PermissionId.STOCK_CHECK,
            },
        ];
        const permissionPayment = [
            {
                id: permission_entity_1.PermissionId.PAYMENT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}`,
                name: 'Quản lý tài chính',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
            {
                id: permission_entity_1.PermissionId.PAYMENT_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}.${permission_entity_1.PermissionId.PAYMENT_READ}`,
                name: 'Xem phiếu thu/chi',
                parentId: permission_entity_1.PermissionId.PAYMENT,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
            {
                id: permission_entity_1.PermissionId.PAYMENT_CUSTOMER_MONEY_IN,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT_CUSTOMER_MONEY_IN],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}.${permission_entity_1.PermissionId.PAYMENT_CUSTOMER_MONEY_IN}`,
                name: 'Tạo phiếu thu khách hàng',
                parentId: permission_entity_1.PermissionId.PAYMENT,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
            {
                id: permission_entity_1.PermissionId.PAYMENT_DISTRIBUTOR_MONEY_OUT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT_DISTRIBUTOR_MONEY_OUT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}.${permission_entity_1.PermissionId.PAYMENT_DISTRIBUTOR_MONEY_OUT}`,
                name: 'Tạo phiếu chi nhà cung cấp',
                parentId: permission_entity_1.PermissionId.PAYMENT,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
            {
                id: permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_IN,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_IN],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}.${permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_IN}`,
                name: 'Tạo phiếu thu khác',
                parentId: permission_entity_1.PermissionId.PAYMENT,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
            {
                id: permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_OUT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_OUT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.PAYMENT}.${permission_entity_1.PermissionId.PAYMENT_OTHER_MONEY_OUT}`,
                name: 'Tạo phiếu chi khác',
                parentId: permission_entity_1.PermissionId.PAYMENT,
                rootId: permission_entity_1.PermissionId.PAYMENT,
            },
        ];
        const permissionTicketProcedureResult = [
            {
                id: permission_entity_1.PermissionId.TICKET_PROCEDURE_RESULT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_PROCEDURE_RESULT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_PROCEDURE_RESULT}`,
                name: 'Quản lý trả kết quả phiếu dịch vụ',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.TICKET_PROCEDURE_RESULT,
            },
        ];
        const permissionTicketLaboratoryResult = [
            {
                id: permission_entity_1.PermissionId.TICKET_LABORATORY_RESULT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_LABORATORY_RESULT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_LABORATORY_RESULT}`,
                name: 'Quản lý trả kết quả phiếu xét nghiệm',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.TICKET_LABORATORY_RESULT,
            },
        ];
        const permissionTicketRadiologyResult = [
            {
                id: permission_entity_1.PermissionId.TICKET_RADIOLOGY_RESULT,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_RADIOLOGY_RESULT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_RADIOLOGY_RESULT}`,
                name: 'Quản lý trả kết quả phiếu CĐHA',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.TICKET_RADIOLOGY_RESULT,
            },
        ];
        const permissionTicketOrder = [
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}`,
                name: 'Quản lý bán hàng',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_READ}`,
                name: 'Xem hóa đơn',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD}`,
                name: 'Tạo, sửa, xóa hóa đơn nháp',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_UPDATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_UPDATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_UPDATE}`,
                name: 'Sửa hóa đơn Đặt hàng',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_DESTROY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_DESTROY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_DESTROY}`,
                name: 'Xóa hóa đơn Đặt hàng',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_DEBT_SUCCESS_CRUD,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_DEBT_SUCCESS_CRUD],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_DEBT_SUCCESS_CRUD}`,
                name: 'Tạo, sửa, xóa hóa đơn bán hàng nhanh',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT}`,
                name: 'Thanh toán',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_REFUND_OVERPAID,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_REFUND_OVERPAID],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_REFUND_OVERPAID}`,
                name: 'Hoàn trả tiền thừa',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT}`,
                name: 'Gửi hàng',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_CLOSE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_CLOSE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_CLOSE}`,
                name: 'Đóng phiếu',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_REOPEN,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_REOPEN],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_REOPEN}`,
                name: 'Mở lại phiếu',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_RETURN_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_RETURN_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_RETURN_PRODUCT}`,
                name: 'Hoàn trả hàng',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_TERMINATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_TERMINATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_TERMINATE}`,
                name: 'Hủy đơn',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_ORDER_CANCELLED_DESTROY,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_ORDER_CANCELLED_DESTROY],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_ORDER}.${permission_entity_1.PermissionId.TICKET_ORDER_CANCELLED_DESTROY}`,
                name: 'Xóa hoàn toàn hóa đơn ở trạng thái HỦY',
                parentId: permission_entity_1.PermissionId.TICKET_ORDER,
                rootId: permission_entity_1.PermissionId.TICKET_ORDER,
            },
        ];
        const permissionTicketClinic = [
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}`,
                name: 'Quản lý phòng khám',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_READ,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_READ],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_READ}`,
                name: 'Xem phiếu khám',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_CREATE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_CREATE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_CREATE}`,
                name: 'Đăng ký khám mới',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE}`,
                name: 'Xóa phiếu khám',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_START_CHECKUP,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_START_CHECKUP],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_START_CHECKUP}`,
                name: 'Bắt đầu vào khám',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST}`,
                name: 'Chỉ định dịch vụ',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST}`,
                name: 'Chỉ định Xét nghiệm',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST}`,
                name: 'Chỉ định CĐHA',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE}`,
                name: 'Sửa danh sách vật tư tiêu hao',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION}`,
                name: 'Kê đơn thuốc',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_CHANGE_DISCOUNT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_CHANGE_DISCOUNT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_CHANGE_DISCOUNT}`,
                name: 'Thay đổi chiết khấu',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_PAYMENT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_PAYMENT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_PAYMENT}`,
                name: 'Tạm ứng',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_REFUND_OVERPAID,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_REFUND_OVERPAID],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_REFUND_OVERPAID}`,
                name: 'Hoàn trả tiền thừa',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_SEND_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_SEND_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_SEND_PRODUCT}`,
                name: 'Xuất thuốc',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_RETURN_PRODUCT,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_RETURN_PRODUCT],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_RETURN_PRODUCT}`,
                name: 'Hoàn trả thuốc',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_CLOSE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_CLOSE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_CLOSE}`,
                name: 'Đóng phiếu khám',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_REOPEN,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_REOPEN],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_REOPEN}`,
                name: 'Mở lại phiếu khám',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE}`,
                name: 'Khám và chẩn đoán',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_USER_CHOOSE_USERID,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_USER_CHOOSE_USERID],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_USER_CHOOSE_USERID}`,
                name: 'Chỉ định nhân viên cho từng vai trò',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
            {
                id: permission_entity_1.PermissionId.TICKET_CLINIC_USER_UPDATE_COMMISSION,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.TICKET_CLINIC_USER_UPDATE_COMMISSION],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.TICKET_CLINIC}.${permission_entity_1.PermissionId.TICKET_CLINIC_USER_UPDATE_COMMISSION}`,
                name: 'Chỉnh sửa tiền hoa hồng',
                parentId: permission_entity_1.PermissionId.TICKET_CLINIC,
                rootId: permission_entity_1.PermissionId.TICKET_CLINIC,
            },
        ];
        const permissionFile = [
            {
                id: permission_entity_1.PermissionId.FILE,
                level: 1,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}`,
                name: 'Quản lý File Excel',
                parentId: 0,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_PRODUCT_DOWNLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_PRODUCT_DOWNLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_PRODUCT_DOWNLOAD_EXCEL}`,
                name: 'Tải file Excel danh sách sản phẩm',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_CUSTOMER_DOWNLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_CUSTOMER_DOWNLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_CUSTOMER_DOWNLOAD_EXCEL}`,
                name: 'Tải file Excel danh sách khách hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_RECEIPT_DOWNLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_RECEIPT_DOWNLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_RECEIPT_DOWNLOAD_EXCEL}`,
                name: 'Tải file Excel danh sách phiếu nhập hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_TICKET_ORDER_DOWNLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_TICKET_ORDER_DOWNLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_TICKET_ORDER_DOWNLOAD_EXCEL}`,
                name: 'Tải file Excel danh sách bán hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_TICKET_CLINIC_DOWNLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_TICKET_CLINIC_DOWNLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_TICKET_CLINIC_DOWNLOAD_EXCEL}`,
                name: 'Tải file Excel danh sách phiếu khám',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_PRODUCT_UPLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_PRODUCT_UPLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_PRODUCT_UPLOAD_EXCEL}`,
                name: 'Upload file Excel danh sách sản phẩm',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_CUSTOMER_UPLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_CUSTOMER_UPLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_CUSTOMER_UPLOAD_EXCEL}`,
                name: 'Upload file Excel danh sách khách hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_RECEIPT_UPLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_RECEIPT_UPLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_RECEIPT_UPLOAD_EXCEL}`,
                name: 'Upload file Excel danh sách phiếu nhập hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_TICKET_ORDER_UPLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_TICKET_ORDER_UPLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_TICKET_ORDER_UPLOAD_EXCEL}`,
                name: 'Upload file Excel danh sách bán hàng',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
            {
                id: permission_entity_1.PermissionId.FILE_TICKET_CLINIC_UPLOAD_EXCEL,
                level: 2,
                code: permission_entity_1.PermissionId[permission_entity_1.PermissionId.FILE_TICKET_CLINIC_UPLOAD_EXCEL],
                isActive: 1,
                pathId: `${permission_entity_1.PermissionId.FILE}.${permission_entity_1.PermissionId.FILE_TICKET_CLINIC_UPLOAD_EXCEL}`,
                name: 'Upload file Excel danh sách phiếu khám',
                parentId: permission_entity_1.PermissionId.FILE,
                rootId: permission_entity_1.PermissionId.FILE,
            },
        ];
        await this.permissionRepository.delete({});
        const { idsEffect } = await this.permissionRepository.upsert([
            ...permissionOrganization,
            ...permissionUser,
            ...permissionStatistic,
            ...permissionMasterData,
            ...permissionProduct,
            ...permissionDistributor,
            ...permissionCustomer,
            ...permissionReceipt,
            ...permissionAppointment,
            ...permissionStockCheck,
            ...permissionPayment,
            ...permissionTicketProcedureResult,
            ...permissionTicketLaboratoryResult,
            ...permissionTicketRadiologyResult,
            ...permissionTicketOrder,
            ...permissionTicketClinic,
            ...permissionFile,
        ]);
        this.cacheDataService.reloadPermissionAll();
        return { data: { idsEffect } };
    }
};
exports.ApiPermissionService = ApiPermissionService;
exports.ApiPermissionService = ApiPermissionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof permission_repository_1.PermissionRepository !== "undefined" && permission_repository_1.PermissionRepository) === "function" ? _b : Object])
], ApiPermissionService);


/***/ }),
/* 418 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(419), exports);
__exportStar(__webpack_require__(420), exports);


/***/ }),
/* 419 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionGetOneQuery = exports.PermissionGetManyQuery = exports.PermissionPaginationQuery = exports.PermissionGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const permission_options_request_1 = __webpack_require__(420);
class PermissionGetQuery {
}
exports.PermissionGetQuery = PermissionGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof permission_options_request_1.PermissionRelationQuery !== "undefined" && permission_options_request_1.PermissionRelationQuery) === "function" ? _a : Object)
], PermissionGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            level: { EQUAL: 1 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof permission_options_request_1.PermissionFilterQuery !== "undefined" && permission_options_request_1.PermissionFilterQuery) === "function" ? _b : Object)
], PermissionGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof permission_options_request_1.PermissionSortQuery !== "undefined" && permission_options_request_1.PermissionSortQuery) === "function" ? _c : Object)
], PermissionGetQuery.prototype, "sort", void 0);
class PermissionPaginationQuery extends (0, swagger_1.IntersectionType)(PermissionGetQuery, query_1.PaginationQuery) {
}
exports.PermissionPaginationQuery = PermissionPaginationQuery;
class PermissionGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PermissionGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PermissionGetManyQuery = PermissionGetManyQuery;
class PermissionGetOneQuery extends (0, swagger_1.PickType)(PermissionGetQuery, ['relation']) {
}
exports.PermissionGetOneQuery = PermissionGetOneQuery;


/***/ }),
/* 420 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionSortQuery = exports.PermissionFilterQuery = exports.PermissionRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class PermissionRelationQuery {
}
exports.PermissionRelationQuery = PermissionRelationQuery;
class PermissionFilterQuery {
}
exports.PermissionFilterQuery = PermissionFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _a : Object)
], PermissionFilterQuery.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _b : Object)
], PermissionFilterQuery.prototype, "rootId", void 0);
class PermissionSortQuery extends query_1.SortQuery {
}
exports.PermissionSortQuery = PermissionSortQuery;


/***/ }),
/* 421 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleModule = void 0;
const common_1 = __webpack_require__(3);
const api_prescription_sample_controller_1 = __webpack_require__(422);
const api_prescription_sample_service_1 = __webpack_require__(423);
let ApiPrescriptionSampleModule = class ApiPrescriptionSampleModule {
};
exports.ApiPrescriptionSampleModule = ApiPrescriptionSampleModule;
exports.ApiPrescriptionSampleModule = ApiPrescriptionSampleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_prescription_sample_controller_1.ApiPrescriptionSampleController],
        providers: [api_prescription_sample_service_1.ApiPrescriptionSampleService],
    })
], ApiPrescriptionSampleModule);


/***/ }),
/* 422 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_prescription_sample_service_1 = __webpack_require__(423);
const request_1 = __webpack_require__(424);
let ApiPrescriptionSampleController = class ApiPrescriptionSampleController {
    constructor(apiPrescriptionSampleService) {
        this.apiPrescriptionSampleService = apiPrescriptionSampleService;
    }
    pagination({ oid }, query) {
        return this.apiPrescriptionSampleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiPrescriptionSampleService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiPrescriptionSampleService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiPrescriptionSampleService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiPrescriptionSampleService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiPrescriptionSampleService.destroyOne(oid, id);
    }
};
exports.ApiPrescriptionSampleController = ApiPrescriptionSampleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PrescriptionSamplePaginationQuery !== "undefined" && request_1.PrescriptionSamplePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PrescriptionSampleGetManyQuery !== "undefined" && request_1.PrescriptionSampleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.PrescriptionSampleCreateBody !== "undefined" && request_1.PrescriptionSampleCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.PrescriptionSampleUpdateBody !== "undefined" && request_1.PrescriptionSampleUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "destroyOne", null);
exports.ApiPrescriptionSampleController = ApiPrescriptionSampleController = __decorate([
    (0, swagger_1.ApiTags)('PrescriptionSample'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('prescription-sample'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_prescription_sample_service_1.ApiPrescriptionSampleService !== "undefined" && api_prescription_sample_service_1.ApiPrescriptionSampleService) === "function" ? _a : Object])
], ApiPrescriptionSampleController);


/***/ }),
/* 423 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const prescription_sample_repository_1 = __webpack_require__(183);
const product_repository_1 = __webpack_require__(189);
let ApiPrescriptionSampleService = class ApiPrescriptionSampleService {
    constructor(prescriptionSampleRepository, productRepository) {
        this.prescriptionSampleRepository = prescriptionSampleRepository;
        this.productRepository = productRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.prescriptionSampleRepository.pagination({
            page,
            limit,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.prescriptionSampleRepository.findMany({
            condition: {
                oid,
            },
            limit,
            sort,
        });
        if (relation === null || relation === void 0 ? void 0 : relation.medicineList) {
            const productIdList = data
                .map((i) => {
                try {
                    i.medicineList = JSON.parse(i.medicines || '[]');
                }
                catch (error) {
                    i.medicineList = [];
                }
                return i.medicineList;
            })
                .flat()
                .map((i) => i.productId);
            const productList = await this.productRepository.findManyBy({
                oid,
                id: { IN: productIdList },
            });
            const productMap = (0, object_helper_1.arrayToKeyValue)(productList, 'id');
            data.forEach((i) => {
                i.medicineList.forEach((j) => {
                    j.product = productMap[j.productId] || null;
                });
            });
        }
        return { data };
    }
    async getOne(oid, id) {
        const prescriptionSample = await this.prescriptionSampleRepository.findOneBy({ oid, id });
        if (!prescriptionSample)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { prescriptionSample } };
    }
    async createOne(oid, body) {
        const prescriptionSample = await this.prescriptionSampleRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { prescriptionSample } };
    }
    async updateOne(oid, id, body) {
        const prescriptionSampleList = await this.prescriptionSampleRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { prescriptionSample: prescriptionSampleList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.prescriptionSampleRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiPrescriptionSampleService = ApiPrescriptionSampleService;
exports.ApiPrescriptionSampleService = ApiPrescriptionSampleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prescription_sample_repository_1.PrescriptionSampleRepository !== "undefined" && prescription_sample_repository_1.PrescriptionSampleRepository) === "function" ? _a : Object, typeof (_b = typeof product_repository_1.ProductRepository !== "undefined" && product_repository_1.ProductRepository) === "function" ? _b : Object])
], ApiPrescriptionSampleService);


/***/ }),
/* 424 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(425), exports);
__exportStar(__webpack_require__(426), exports);
__exportStar(__webpack_require__(427), exports);


/***/ }),
/* 425 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleSortQuery = exports.PrescriptionSampleFilterQuery = exports.PrescriptionSampleRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class PrescriptionSampleRelationQuery {
}
exports.PrescriptionSampleRelationQuery = PrescriptionSampleRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PrescriptionSampleRelationQuery.prototype, "medicineList", void 0);
class PrescriptionSampleFilterQuery {
}
exports.PrescriptionSampleFilterQuery = PrescriptionSampleFilterQuery;
class PrescriptionSampleSortQuery extends query_1.SortQuery {
}
exports.PrescriptionSampleSortQuery = PrescriptionSampleSortQuery;


/***/ }),
/* 426 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleUpdateBody = exports.PrescriptionSampleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class PrescriptionSampleCreateBody {
}
exports.PrescriptionSampleCreateBody = PrescriptionSampleCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PrescriptionSampleCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], PrescriptionSampleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrescriptionSampleCreateBody.prototype, "medicines", void 0);
class PrescriptionSampleUpdateBody extends (0, swagger_1.PartialType)(PrescriptionSampleCreateBody) {
}
exports.PrescriptionSampleUpdateBody = PrescriptionSampleUpdateBody;


/***/ }),
/* 427 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleGetOneQuery = exports.PrescriptionSampleGetManyQuery = exports.PrescriptionSamplePaginationQuery = exports.PrescriptionSampleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const prescription_sample_options_request_1 = __webpack_require__(425);
class PrescriptionSampleGetQuery {
}
exports.PrescriptionSampleGetQuery = PrescriptionSampleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof prescription_sample_options_request_1.PrescriptionSampleRelationQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleRelationQuery) === "function" ? _a : Object)
], PrescriptionSampleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof prescription_sample_options_request_1.PrescriptionSampleFilterQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleFilterQuery) === "function" ? _b : Object)
], PrescriptionSampleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof prescription_sample_options_request_1.PrescriptionSampleSortQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleSortQuery) === "function" ? _c : Object)
], PrescriptionSampleGetQuery.prototype, "sort", void 0);
class PrescriptionSamplePaginationQuery extends (0, swagger_1.IntersectionType)(PrescriptionSampleGetQuery, query_1.PaginationQuery) {
}
exports.PrescriptionSamplePaginationQuery = PrescriptionSamplePaginationQuery;
class PrescriptionSampleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PrescriptionSampleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PrescriptionSampleGetManyQuery = PrescriptionSampleGetManyQuery;
class PrescriptionSampleGetOneQuery extends (0, swagger_1.PickType)(PrescriptionSampleGetQuery, [
    'relation',
]) {
}
exports.PrescriptionSampleGetOneQuery = PrescriptionSampleGetOneQuery;


/***/ }),
/* 428 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlModule = void 0;
const common_1 = __webpack_require__(3);
const api_print_html_controller_1 = __webpack_require__(429);
const api_print_html_service_1 = __webpack_require__(430);
let ApiPrintHtmlModule = class ApiPrintHtmlModule {
};
exports.ApiPrintHtmlModule = ApiPrintHtmlModule;
exports.ApiPrintHtmlModule = ApiPrintHtmlModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_print_html_controller_1.ApiPrintHtmlController],
        providers: [api_print_html_service_1.ApiPrintHtmlService],
    })
], ApiPrintHtmlModule);


/***/ }),
/* 429 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_print_html_service_1 = __webpack_require__(430);
const request_1 = __webpack_require__(431);
let ApiPrintHtmlController = class ApiPrintHtmlController {
    constructor(apiPrintHtmlService) {
        this.apiPrintHtmlService = apiPrintHtmlService;
    }
    pagination({ oid }, query) {
        return this.apiPrintHtmlService.pagination(oid, query);
    }
    getList({ oid }, query) {
        return this.apiPrintHtmlService.getList(oid, query);
    }
    getOne({ oid }, query) {
        return this.apiPrintHtmlService.getOne(oid, query);
    }
    findOne({ oid }, { id }, query) {
        return this.apiPrintHtmlService.detail(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiPrintHtmlService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiPrintHtmlService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiPrintHtmlService.destroyOne(oid, id);
    }
    async systemList() {
        return await this.apiPrintHtmlService.systemList();
    }
};
exports.ApiPrintHtmlController = ApiPrintHtmlController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PrintHtmlPaginationQuery !== "undefined" && request_1.PrintHtmlPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPrintHtmlController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('get-list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PrintHtmlGetManyQuery !== "undefined" && request_1.PrintHtmlGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiPrintHtmlController.prototype, "getList", null);
__decorate([
    (0, common_1.Get)('get-one'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.PrintHtmlGetOneQuery !== "undefined" && request_1.PrintHtmlGetOneQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiPrintHtmlController.prototype, "getOne", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.PrintHtmlGetOneQuery !== "undefined" && request_1.PrintHtmlGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", void 0)
], ApiPrintHtmlController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof request_1.PrintHtmlCreateBody !== "undefined" && request_1.PrintHtmlCreateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiPrintHtmlController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object, typeof (_q = typeof request_1.PrintHtmlUpdateBody !== "undefined" && request_1.PrintHtmlUpdateBody) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiPrintHtmlController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PRINT_HTML),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiPrintHtmlController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiPrintHtmlController.prototype, "systemList", null);
exports.ApiPrintHtmlController = ApiPrintHtmlController = __decorate([
    (0, swagger_1.ApiTags)('PrintHtml'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('print-html'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_print_html_service_1.ApiPrintHtmlService !== "undefined" && api_print_html_service_1.ApiPrintHtmlService) === "function" ? _a : Object])
], ApiPrintHtmlController);


/***/ }),
/* 430 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const print_html_repository_1 = __webpack_require__(184);
let ApiPrintHtmlService = class ApiPrintHtmlService {
    constructor(printHtmlRepository) {
        this.printHtmlRepository = printHtmlRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.printHtmlRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getList(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.printHtmlRepository.findMany({
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, query) {
        const { filter, relation } = query;
        const printHtml = await this.printHtmlRepository.findOne({
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
        });
        return { data: { printHtml } };
    }
    async detail(oid, id, query) {
        const printHtml = await this.printHtmlRepository.findOne({
            condition: {
                oid: { IN: [1, oid] },
                id,
            },
            relation: query.relation,
        });
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { printHtml } };
    }
    async createOne(oid, body) {
        const printHtml = await this.printHtmlRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, body));
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.InsertFailed');
        return { data: { printHtml } };
    }
    async updateOne(oid, id, body) {
        const [printHtml] = await this.printHtmlRepository.updateAndReturnEntity({ id, oid }, body);
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        return { data: { printHtml } };
    }
    async destroyOne(oid, id) {
        const affected = await this.printHtmlRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
    async systemList() {
        const data = await this.printHtmlRepository.findMany({
            condition: { oid: 1 },
            sort: { id: 'ASC' },
        });
        return { data };
    }
};
exports.ApiPrintHtmlService = ApiPrintHtmlService;
exports.ApiPrintHtmlService = ApiPrintHtmlService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof print_html_repository_1.PrintHtmlRepository !== "undefined" && print_html_repository_1.PrintHtmlRepository) === "function" ? _a : Object])
], ApiPrintHtmlService);


/***/ }),
/* 431 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(432), exports);
__exportStar(__webpack_require__(433), exports);
__exportStar(__webpack_require__(434), exports);


/***/ }),
/* 432 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlGetOneQuery = exports.PrintHtmlGetManyQuery = exports.PrintHtmlPaginationQuery = exports.PrintHtmlGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const print_html_options_request_1 = __webpack_require__(433);
class PrintHtmlGetQuery {
}
exports.PrintHtmlGetQuery = PrintHtmlGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof print_html_options_request_1.PrintHtmlRelationQuery !== "undefined" && print_html_options_request_1.PrintHtmlRelationQuery) === "function" ? _a : Object)
], PrintHtmlGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof print_html_options_request_1.PrintHtmlFilterQuery !== "undefined" && print_html_options_request_1.PrintHtmlFilterQuery) === "function" ? _b : Object)
], PrintHtmlGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof print_html_options_request_1.PrintHtmlSortQuery !== "undefined" && print_html_options_request_1.PrintHtmlSortQuery) === "function" ? _c : Object)
], PrintHtmlGetQuery.prototype, "sort", void 0);
class PrintHtmlPaginationQuery extends (0, swagger_1.IntersectionType)(PrintHtmlGetQuery, query_1.PaginationQuery) {
}
exports.PrintHtmlPaginationQuery = PrintHtmlPaginationQuery;
class PrintHtmlGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PrintHtmlGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PrintHtmlGetManyQuery = PrintHtmlGetManyQuery;
class PrintHtmlGetOneQuery extends (0, swagger_1.PickType)(PrintHtmlGetQuery, ['filter', 'relation']) {
}
exports.PrintHtmlGetOneQuery = PrintHtmlGetOneQuery;


/***/ }),
/* 433 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSortQuery = exports.PrintHtmlFilterQuery = exports.PrintHtmlRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class PrintHtmlRelationQuery {
}
exports.PrintHtmlRelationQuery = PrintHtmlRelationQuery;
class PrintHtmlFilterQuery {
}
exports.PrintHtmlFilterQuery = PrintHtmlFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], PrintHtmlFilterQuery.prototype, "updatedAt", void 0);
class PrintHtmlSortQuery extends query_1.SortQuery {
}
exports.PrintHtmlSortQuery = PrintHtmlSortQuery;


/***/ }),
/* 434 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlUpdateBody = exports.PrintHtmlCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class PrintHtmlCreateBody {
}
exports.PrintHtmlCreateBody = PrintHtmlCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Đơn thuốc' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<div>ĐƠN THUỐC</div>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "html", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<div>ĐƠN THUỐC</div>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "css", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "initVariable", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "dataExample", void 0);
class PrintHtmlUpdateBody extends PrintHtmlCreateBody {
}
exports.PrintHtmlUpdateBody = PrintHtmlUpdateBody;


/***/ }),
/* 435 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_procedure_group_controller_1 = __webpack_require__(436);
const api_procedure_group_service_1 = __webpack_require__(437);
let ApiProcedureGroupModule = class ApiProcedureGroupModule {
};
exports.ApiProcedureGroupModule = ApiProcedureGroupModule;
exports.ApiProcedureGroupModule = ApiProcedureGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_procedure_group_controller_1.ApiProcedureGroupController],
        providers: [api_procedure_group_service_1.ApiProcedureGroupService],
    })
], ApiProcedureGroupModule);


/***/ }),
/* 436 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_procedure_group_service_1 = __webpack_require__(437);
const request_1 = __webpack_require__(438);
let ApiProcedureGroupController = class ApiProcedureGroupController {
    constructor(apiProcedureGroupService) {
        this.apiProcedureGroupService = apiProcedureGroupService;
    }
    pagination({ oid }, query) {
        return this.apiProcedureGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiProcedureGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiProcedureGroupService.getOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiProcedureGroupService.replaceAll(oid, body);
    }
    async createOne({ oid }, body) {
        return await this.apiProcedureGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiProcedureGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiProcedureGroupService.destroyOne(oid, id);
    }
};
exports.ApiProcedureGroupController = ApiProcedureGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProcedureGroupPaginationQuery !== "undefined" && request_1.ProcedureGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProcedureGroupGetManyQuery !== "undefined" && request_1.ProcedureGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.ProcedureGroupReplaceAllBody !== "undefined" && request_1.ProcedureGroupReplaceAllBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ProcedureGroupCreateBody !== "undefined" && request_1.ProcedureGroupCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.ProcedureGroupUpdateBody !== "undefined" && request_1.ProcedureGroupUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "destroyOne", null);
exports.ApiProcedureGroupController = ApiProcedureGroupController = __decorate([
    (0, swagger_1.ApiTags)('ProcedureGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('procedure-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_procedure_group_service_1.ApiProcedureGroupService !== "undefined" && api_procedure_group_service_1.ApiProcedureGroupService) === "function" ? _a : Object])
], ApiProcedureGroupController);


/***/ }),
/* 437 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const procedure_group_repository_1 = __webpack_require__(185);
let ApiProcedureGroupService = class ApiProcedureGroupService {
    constructor(procedureGroupRepository) {
        this.procedureGroupRepository = procedureGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.procedureGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.procedureGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.procedureGroupRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async replaceAll(oid, body) {
        await this.procedureGroupRepository.replaceAll(oid, body.procedureGroupReplaceAll);
        return { data: true };
    }
    async createOne(oid, body) {
        const id = await this.procedureGroupRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.procedureGroupRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.procedureGroupRepository.update({ id, oid }, body);
        const data = await this.procedureGroupRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.procedureGroupRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiProcedureGroupService = ApiProcedureGroupService;
exports.ApiProcedureGroupService = ApiProcedureGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof procedure_group_repository_1.ProcedureGroupRepository !== "undefined" && procedure_group_repository_1.ProcedureGroupRepository) === "function" ? _a : Object])
], ApiProcedureGroupService);


/***/ }),
/* 438 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(439), exports);
__exportStar(__webpack_require__(440), exports);
__exportStar(__webpack_require__(441), exports);


/***/ }),
/* 439 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupGetOneQuery = exports.ProcedureGroupGetManyQuery = exports.ProcedureGroupPaginationQuery = exports.ProcedureGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const procedure_group_options_request_1 = __webpack_require__(440);
class ProcedureGroupGetQuery {
}
exports.ProcedureGroupGetQuery = ProcedureGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof procedure_group_options_request_1.ProcedureGroupRelationQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupRelationQuery) === "function" ? _a : Object)
], ProcedureGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof procedure_group_options_request_1.ProcedureGroupFilterQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupFilterQuery) === "function" ? _b : Object)
], ProcedureGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof procedure_group_options_request_1.ProcedureGroupSortQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupSortQuery) === "function" ? _c : Object)
], ProcedureGroupGetQuery.prototype, "sort", void 0);
class ProcedureGroupPaginationQuery extends (0, swagger_1.IntersectionType)(ProcedureGroupGetQuery, query_1.PaginationQuery) {
}
exports.ProcedureGroupPaginationQuery = ProcedureGroupPaginationQuery;
class ProcedureGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProcedureGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProcedureGroupGetManyQuery = ProcedureGroupGetManyQuery;
class ProcedureGroupGetOneQuery extends (0, swagger_1.PickType)(ProcedureGroupGetQuery, ['relation']) {
}
exports.ProcedureGroupGetOneQuery = ProcedureGroupGetOneQuery;


/***/ }),
/* 440 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupSortQuery = exports.ProcedureGroupFilterQuery = exports.ProcedureGroupRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class ProcedureGroupRelationQuery {
}
exports.ProcedureGroupRelationQuery = ProcedureGroupRelationQuery;
class ProcedureGroupFilterQuery {
}
exports.ProcedureGroupFilterQuery = ProcedureGroupFilterQuery;
class ProcedureGroupSortQuery extends query_1.SortQuery {
}
exports.ProcedureGroupSortQuery = ProcedureGroupSortQuery;


/***/ }),
/* 441 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupReplaceAllBody = exports.ProcedureGroupReplaceBody = exports.ProcedureGroupUpdateBody = exports.ProcedureGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ProcedureGroupCreateBody {
}
exports.ProcedureGroupCreateBody = ProcedureGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProcedureGroupCreateBody.prototype, "name", void 0);
class ProcedureGroupUpdateBody extends (0, swagger_1.PartialType)(ProcedureGroupCreateBody) {
}
exports.ProcedureGroupUpdateBody = ProcedureGroupUpdateBody;
class ProcedureGroupReplaceBody {
}
exports.ProcedureGroupReplaceBody = ProcedureGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProcedureGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], ProcedureGroupReplaceBody.prototype, "id", void 0);
class ProcedureGroupReplaceAllBody {
}
exports.ProcedureGroupReplaceAllBody = ProcedureGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProcedureGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProcedureGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProcedureGroupReplaceAllBody.prototype, "procedureGroupReplaceAll", void 0);


/***/ }),
/* 442 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_procedure_controller_1 = __webpack_require__(443);
const api_procedure_service_1 = __webpack_require__(444);
let ApiProcedureModule = class ApiProcedureModule {
};
exports.ApiProcedureModule = ApiProcedureModule;
exports.ApiProcedureModule = ApiProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_procedure_controller_1.ApiProcedureController],
        providers: [api_procedure_service_1.ApiProcedureService],
    })
], ApiProcedureModule);


/***/ }),
/* 443 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_procedure_service_1 = __webpack_require__(444);
const request_1 = __webpack_require__(445);
let ApiProcedureController = class ApiProcedureController {
    constructor(apiProcedureService) {
        this.apiProcedureService = apiProcedureService;
    }
    pagination({ oid }, query) {
        return this.apiProcedureService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiProcedureService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiProcedureService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiProcedureService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiProcedureService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiProcedureService.destroyOne(oid, id);
    }
};
exports.ApiProcedureController = ApiProcedureController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProcedurePaginationQuery !== "undefined" && request_1.ProcedurePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProcedureGetManyQuery !== "undefined" && request_1.ProcedureGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.ProcedureGetOneQuery !== "undefined" && request_1.ProcedureGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.ProcedureCreateBody !== "undefined" && request_1.ProcedureCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.ProcedureUpdateBody !== "undefined" && request_1.ProcedureUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_PROCEDURE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureController.prototype, "destroyOne", null);
exports.ApiProcedureController = ApiProcedureController = __decorate([
    (0, swagger_1.ApiTags)('Procedure'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_procedure_service_1.ApiProcedureService !== "undefined" && api_procedure_service_1.ApiProcedureService) === "function" ? _a : Object])
], ApiProcedureController);


/***/ }),
/* 444 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const commission_entity_1 = __webpack_require__(75);
const repositories_1 = __webpack_require__(170);
const procedure_repository_1 = __webpack_require__(186);
const ticket_procedure_repository_1 = __webpack_require__(202);
let ApiProcedureService = class ApiProcedureService {
    constructor(procedureRepository, commissionRepository, ticketProcedureRepository) {
        this.procedureRepository = procedureRepository;
        this.commissionRepository = commissionRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.procedureRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                name: (filter === null || filter === void 0 ? void 0 : filter.searchText) ? { LIKE: filter.searchText } : undefined,
                procedureGroupId: filter === null || filter === void 0 ? void 0 : filter.procedureGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.procedureRepository.findMany({
            relation,
            condition: {
                oid,
                name: (filter === null || filter === void 0 ? void 0 : filter.searchText) ? { LIKE: filter.searchText } : undefined,
                procedureGroupId: filter === null || filter === void 0 ? void 0 : filter.procedureGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort: { id: 'ASC' },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        var _a, _b;
        const procedure = await this.procedureRepository.findOne({
            relation: { procedureGroup: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.procedureGroup },
            condition: { oid, id },
        });
        if (!procedure)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if ((_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.commissionList) {
            procedure.commissionList = await this.commissionRepository.findManyBy({
                oid,
                interactType: commission_entity_1.InteractType.Procedure,
                interactId: procedure.id,
            });
        }
        return { data: { procedure } };
    }
    async createOne(oid, body) {
        const { commissionList } = body, procedureBody = __rest(body, ["commissionList"]);
        commissionList.forEach((i) => {
            if (i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected
                || i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual) {
                if (i.commissionValue >= 1000) {
                    throw new exception_filter_1.BusinessException('error.ValidateFailed');
                }
            }
        });
        const procedure = await this.procedureRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, procedureBody));
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: procedure.id,
                interactType: commission_entity_1.InteractType.Procedure,
            };
            return dto;
        });
        procedure.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        return { data: { procedure } };
    }
    async updateOne(oid, id, body) {
        const { commissionList } = body, procedureBody = __rest(body, ["commissionList"]);
        commissionList.forEach((i) => {
            if (i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected
                || i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual) {
                if (i.commissionValue >= 1000) {
                    throw new exception_filter_1.BusinessException('error.ValidateFailed');
                }
            }
        });
        const [procedure] = await this.procedureRepository.updateAndReturnEntity({ oid, id }, procedureBody);
        if (!procedure)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        await this.commissionRepository.delete({
            oid,
            interactId: procedure.id,
            interactType: commission_entity_1.InteractType.Procedure,
        });
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: procedure.id,
                interactType: commission_entity_1.InteractType.Procedure,
            };
            return dto;
        });
        procedure.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        return { data: { procedure } };
    }
    async destroyOne(oid, procedureId) {
        const ticketProcedureList = await this.ticketProcedureRepository.findMany({
            condition: { oid, procedureId },
            limit: 10,
        });
        if (ticketProcedureList.length > 0) {
            return {
                data: { ticketProcedureList },
                success: false,
            };
        }
        await this.commissionRepository.delete({
            oid,
            interactId: procedureId,
            interactType: commission_entity_1.InteractType.Radiology,
        });
        const affected = await this.procedureRepository.delete({ oid, id: procedureId });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: { ticketProcedureList: [], procedureId } };
    }
};
exports.ApiProcedureService = ApiProcedureService;
exports.ApiProcedureService = ApiProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof procedure_repository_1.ProcedureRepository !== "undefined" && procedure_repository_1.ProcedureRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CommissionRepository !== "undefined" && repositories_1.CommissionRepository) === "function" ? _b : Object, typeof (_c = typeof ticket_procedure_repository_1.TicketProcedureRepository !== "undefined" && ticket_procedure_repository_1.TicketProcedureRepository) === "function" ? _c : Object])
], ApiProcedureService);


/***/ }),
/* 445 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(446), exports);
__exportStar(__webpack_require__(447), exports);
__exportStar(__webpack_require__(448), exports);


/***/ }),
/* 446 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGetOneQuery = exports.ProcedureGetManyQuery = exports.ProcedurePaginationQuery = exports.ProcedureGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const procedure_options_request_1 = __webpack_require__(447);
class ProcedureGetQuery {
}
exports.ProcedureGetQuery = ProcedureGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof procedure_options_request_1.ProcedureRelationQuery !== "undefined" && procedure_options_request_1.ProcedureRelationQuery) === "function" ? _a : Object)
], ProcedureGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof procedure_options_request_1.ProcedureFilterQuery !== "undefined" && procedure_options_request_1.ProcedureFilterQuery) === "function" ? _b : Object)
], ProcedureGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'ASC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof procedure_options_request_1.ProcedureSortQuery !== "undefined" && procedure_options_request_1.ProcedureSortQuery) === "function" ? _c : Object)
], ProcedureGetQuery.prototype, "sort", void 0);
class ProcedurePaginationQuery extends (0, swagger_1.IntersectionType)(ProcedureGetQuery, query_1.PaginationQuery) {
}
exports.ProcedurePaginationQuery = ProcedurePaginationQuery;
class ProcedureGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProcedureGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProcedureGetManyQuery = ProcedureGetManyQuery;
class ProcedureGetOneQuery extends (0, swagger_1.PickType)(ProcedureGetQuery, ['relation']) {
}
exports.ProcedureGetOneQuery = ProcedureGetOneQuery;


/***/ }),
/* 447 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureSortQuery = exports.ProcedureFilterQuery = exports.ProcedureRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class ProcedureRelationQuery {
}
exports.ProcedureRelationQuery = ProcedureRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProcedureRelationQuery.prototype, "procedureGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProcedureRelationQuery.prototype, "commissionList", void 0);
class ProcedureFilterQuery {
}
exports.ProcedureFilterQuery = ProcedureFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProcedureFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProcedureFilterQuery.prototype, "procedureGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProcedureFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], ProcedureFilterQuery.prototype, "updatedAt", void 0);
class ProcedureSortQuery extends query_1.SortQuery {
}
exports.ProcedureSortQuery = ProcedureSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProcedureSortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProcedureSortQuery.prototype, "price", void 0);


/***/ }),
/* 448 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureUpdateBody = exports.ProcedureCreateBody = exports.ProcedureCommission = exports.ConsumableConversion = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const commission_entity_1 = __webpack_require__(75);
const procedure_entity_1 = __webpack_require__(67);
class ConsumableConversion {
}
exports.ConsumableConversion = ConsumableConversion;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], ConsumableConversion.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], ConsumableConversion.prototype, "quantity", void 0);
class ProcedureCommission {
}
exports.ProcedureCommission = ProcedureCommission;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], ProcedureCommission.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProcedureCommission.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: commission_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _a : Object)
], ProcedureCommission.prototype, "commissionCalculatorType", void 0);
class ProcedureCreateBody {
}
exports.ProcedureCreateBody = ProcedureCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Truyền dịch 500ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProcedureCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreateBody.prototype, "procedureGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: procedure_entity_1.ProcedureType.Basic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(procedure_entity_1.ProcedureType),
    __metadata("design:type", typeof (_b = typeof procedure_entity_1.ProcedureType !== "undefined" && procedure_entity_1.ProcedureType) === "function" ? _b : Object)
], ProcedureCreateBody.prototype, "procedureType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProcedureCreateBody.prototype, "quantityDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProcedureCreateBody.prototype, "gapHours", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreateBody.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ productId: 20, quantity: 1 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new ConsumableConversion(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length)
                    err.push(...validate);
                return instance;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({
        message: `Validate consumablesHint failed: Example: `
            + `${JSON.stringify([{ productId: 30, quantity: 4 }])}`,
    }),
    __metadata("design:type", String)
], ProcedureCreateBody.prototype, "consumablesHint", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProcedureCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProcedureCommission, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProcedureCommission),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProcedureCreateBody.prototype, "commissionList", void 0);
class ProcedureUpdateBody extends (0, swagger_1.PartialType)(ProcedureCreateBody) {
}
exports.ProcedureUpdateBody = ProcedureUpdateBody;


/***/ }),
/* 449 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_group_controller_1 = __webpack_require__(450);
const api_product_group_service_1 = __webpack_require__(451);
let ApiProductGroupModule = class ApiProductGroupModule {
};
exports.ApiProductGroupModule = ApiProductGroupModule;
exports.ApiProductGroupModule = ApiProductGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_group_controller_1.ApiProductGroupController],
        providers: [api_product_group_service_1.ApiProductGroupService],
    })
], ApiProductGroupModule);


/***/ }),
/* 450 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_product_group_service_1 = __webpack_require__(451);
const request_1 = __webpack_require__(452);
let ApiProductGroupController = class ApiProductGroupController {
    constructor(apiProductGroupService) {
        this.apiProductGroupService = apiProductGroupService;
    }
    pagination({ oid }, query) {
        return this.apiProductGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiProductGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiProductGroupService.getOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiProductGroupService.replaceAll(oid, body);
    }
    async createOne({ oid }, body) {
        return await this.apiProductGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiProductGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiProductGroupService.destroyOne(oid, id);
    }
};
exports.ApiProductGroupController = ApiProductGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductGroupPaginationQuery !== "undefined" && request_1.ProductGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProductGroupGetManyQuery !== "undefined" && request_1.ProductGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.ProductGroupReplaceAllBody !== "undefined" && request_1.ProductGroupReplaceAllBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ProductGroupCreateBody !== "undefined" && request_1.ProductGroupCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.ProductGroupUpdateBody !== "undefined" && request_1.ProductGroupUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "destroyOne", null);
exports.ApiProductGroupController = ApiProductGroupController = __decorate([
    (0, swagger_1.ApiTags)('ProductGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_group_service_1.ApiProductGroupService !== "undefined" && api_product_group_service_1.ApiProductGroupService) === "function" ? _a : Object])
], ApiProductGroupController);


/***/ }),
/* 451 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const product_group_repository_1 = __webpack_require__(187);
let ApiProductGroupService = class ApiProductGroupService {
    constructor(productGroupRepository) {
        this.productGroupRepository = productGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.productGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.productGroupRepository.findMany({
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.productGroupRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async replaceAll(oid, body) {
        await this.productGroupRepository.replaceAll(oid, body.productGroupReplaceAll);
        return { data: true };
    }
    async createOne(oid, body) {
        const id = await this.productGroupRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.productGroupRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.productGroupRepository.update({ id, oid }, body);
        const data = await this.productGroupRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.productGroupRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiProductGroupService = ApiProductGroupService;
exports.ApiProductGroupService = ApiProductGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof product_group_repository_1.ProductGroupRepository !== "undefined" && product_group_repository_1.ProductGroupRepository) === "function" ? _a : Object])
], ApiProductGroupService);


/***/ }),
/* 452 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(453), exports);
__exportStar(__webpack_require__(454), exports);
__exportStar(__webpack_require__(455), exports);


/***/ }),
/* 453 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupGetOneQuery = exports.ProductGroupGetManyQuery = exports.ProductGroupPaginationQuery = exports.ProductGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const product_group_options_request_1 = __webpack_require__(454);
class ProductGroupGetQuery {
}
exports.ProductGroupGetQuery = ProductGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_group_options_request_1.ProductGroupRelationQuery !== "undefined" && product_group_options_request_1.ProductGroupRelationQuery) === "function" ? _a : Object)
], ProductGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_group_options_request_1.ProductGroupFilterQuery !== "undefined" && product_group_options_request_1.ProductGroupFilterQuery) === "function" ? _b : Object)
], ProductGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_group_options_request_1.ProductGroupSortQuery !== "undefined" && product_group_options_request_1.ProductGroupSortQuery) === "function" ? _c : Object)
], ProductGroupGetQuery.prototype, "sort", void 0);
class ProductGroupPaginationQuery extends (0, swagger_1.IntersectionType)(ProductGroupGetQuery, query_1.PaginationQuery) {
}
exports.ProductGroupPaginationQuery = ProductGroupPaginationQuery;
class ProductGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductGroupGetManyQuery = ProductGroupGetManyQuery;
class ProductGroupGetOneQuery extends (0, swagger_1.PickType)(ProductGroupGetQuery, ['relation']) {
}
exports.ProductGroupGetOneQuery = ProductGroupGetOneQuery;


/***/ }),
/* 454 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupSortQuery = exports.ProductGroupFilterQuery = exports.ProductGroupRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class ProductGroupRelationQuery {
}
exports.ProductGroupRelationQuery = ProductGroupRelationQuery;
class ProductGroupFilterQuery {
}
exports.ProductGroupFilterQuery = ProductGroupFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], ProductGroupFilterQuery.prototype, "updatedAt", void 0);
class ProductGroupSortQuery extends query_1.SortQuery {
}
exports.ProductGroupSortQuery = ProductGroupSortQuery;


/***/ }),
/* 455 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupReplaceAllBody = exports.ProductGroupReplaceBody = exports.ProductGroupUpdateBody = exports.ProductGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ProductGroupCreateBody {
}
exports.ProductGroupCreateBody = ProductGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProductGroupCreateBody.prototype, "name", void 0);
class ProductGroupUpdateBody extends (0, swagger_1.PartialType)(ProductGroupCreateBody) {
}
exports.ProductGroupUpdateBody = ProductGroupUpdateBody;
class ProductGroupReplaceBody {
}
exports.ProductGroupReplaceBody = ProductGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProductGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], ProductGroupReplaceBody.prototype, "id", void 0);
class ProductGroupReplaceAllBody {
}
exports.ProductGroupReplaceAllBody = ProductGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProductGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductGroupReplaceAllBody.prototype, "productGroupReplaceAll", void 0);


/***/ }),
/* 456 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_movement_controller_1 = __webpack_require__(457);
const api_product_movement_service_1 = __webpack_require__(458);
let ApiProductMovementModule = class ApiProductMovementModule {
};
exports.ApiProductMovementModule = ApiProductMovementModule;
exports.ApiProductMovementModule = ApiProductMovementModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_movement_controller_1.ApiProductMovementController],
        providers: [api_product_movement_service_1.ApiProductMovementService],
    })
], ApiProductMovementModule);


/***/ }),
/* 457 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_product_movement_service_1 = __webpack_require__(458);
const request_1 = __webpack_require__(459);
let ApiProductMovementController = class ApiProductMovementController {
    constructor(apiProductMovementService) {
        this.apiProductMovementService = apiProductMovementService;
    }
    paginationProductMovement({ oid }, query) {
        return this.apiProductMovementService.pagination(oid, query);
    }
};
exports.ApiProductMovementController = ApiProductMovementController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.READ_MOVEMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductMovementPaginationQuery !== "undefined" && request_1.ProductMovementPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProductMovementController.prototype, "paginationProductMovement", null);
exports.ApiProductMovementController = ApiProductMovementController = __decorate([
    (0, swagger_1.ApiTags)('Product Movement'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product-movement'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_movement_service_1.ApiProductMovementService !== "undefined" && api_product_movement_service_1.ApiProductMovementService) === "function" ? _a : Object])
], ApiProductMovementController);


/***/ }),
/* 458 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementService = void 0;
const common_1 = __webpack_require__(3);
const object_helper_1 = __webpack_require__(91);
const variable_1 = __webpack_require__(21);
const repositories_1 = __webpack_require__(170);
let ApiProductMovementService = class ApiProductMovementService {
    constructor(productMovementRepository, receiptRepository, stockCheckRepository, ticketRepository, customerRepository, distributorRepository, userRepository) {
        this.productMovementRepository = productMovementRepository;
        this.receiptRepository = receiptRepository;
        this.stockCheckRepository = stockCheckRepository;
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
        this.distributorRepository = distributorRepository;
        this.userRepository = userRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { total, data } = await this.productMovementRepository.pagination({
            relation: { product: relation === null || relation === void 0 ? void 0 : relation.product },
            page,
            limit,
            condition: {
                oid,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                contactId: filter === null || filter === void 0 ? void 0 : filter.contactId,
                movementType: filter === null || filter === void 0 ? void 0 : filter.movementType,
            },
            sort,
        });
        const receiptIds = data
            .filter((i) => i.movementType === variable_1.MovementType.Receipt)
            .map((i) => i.voucherId);
        const ticketIds = data
            .filter((i) => i.movementType === variable_1.MovementType.Ticket)
            .map((i) => i.voucherId);
        const stockCheckIds = data
            .filter((i) => i.movementType === variable_1.MovementType.StockCheck)
            .map((i) => i.voucherId);
        const distributorIds = data
            .filter((i) => i.movementType === variable_1.MovementType.Receipt)
            .map((i) => i.contactId);
        const customerIds = data
            .filter((i) => i.movementType === variable_1.MovementType.Ticket)
            .map((i) => i.contactId);
        const userIds = data
            .filter((i) => [variable_1.MovementType.UserChange, variable_1.MovementType.StockCheck].includes(i.movementType))
            .map((i) => i.contactId);
        const [receiptList, ticketList, stockCheckList, distributorList, customerList, userList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.receipt) && receiptIds.length
                ? this.receiptRepository.findMany({ condition: { id: { IN: (0, object_helper_1.uniqueArray)(receiptIds) } } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIds.length
                ? this.ticketRepository.findMany({ condition: { id: { IN: (0, object_helper_1.uniqueArray)(ticketIds) } } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.stockCheck) && stockCheckIds.length
                ? this.stockCheckRepository.findMany({
                    condition: { id: { IN: (0, object_helper_1.uniqueArray)(stockCheckIds) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.distributor) && distributorIds.length
                ? this.distributorRepository.findManyBy({ id: { IN: (0, object_helper_1.uniqueArray)(distributorIds) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIds.length
                ? this.customerRepository.findManyBy({ id: { IN: (0, object_helper_1.uniqueArray)(customerIds) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.user) && userIds.length
                ? this.userRepository.findMany({ condition: { id: { IN: (0, object_helper_1.uniqueArray)(userIds) } } })
                : [],
        ]);
        data.forEach((mov) => {
            if (mov.movementType === variable_1.MovementType.Receipt) {
                mov.receipt = receiptList.find((v) => v.id === mov.voucherId);
                mov.distributor = distributorList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.Ticket) {
                mov.ticket = ticketList.find((v) => v.id === mov.voucherId);
                mov.customer = customerList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.UserChange) {
                mov.user = userList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.StockCheck) {
                mov.stockCheck = stockCheckList.find((v) => v.id === mov.voucherId);
                mov.user = userList.find((c) => c.id === mov.contactId);
            }
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
};
exports.ApiProductMovementService = ApiProductMovementService;
exports.ApiProductMovementService = ApiProductMovementService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductMovementRepository !== "undefined" && repositories_1.ProductMovementRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ReceiptRepository !== "undefined" && repositories_1.ReceiptRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.StockCheckRepository !== "undefined" && repositories_1.StockCheckRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.DistributorRepository !== "undefined" && repositories_1.DistributorRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _g : Object])
], ApiProductMovementService);


/***/ }),
/* 459 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(460), exports);
__exportStar(__webpack_require__(461), exports);


/***/ }),
/* 460 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementGetOneQuery = exports.ProductMovementGetManyQuery = exports.ProductMovementPaginationQuery = exports.ProductMovementGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
const product_movement_options_request_1 = __webpack_require__(461);
class ProductMovementGetQuery {
}
exports.ProductMovementGetQuery = ProductMovementGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            ticket: true,
            product: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_movement_options_request_1.ProductMovementRelationQuery !== "undefined" && product_movement_options_request_1.ProductMovementRelationQuery) === "function" ? _a : Object)
], ProductMovementGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            voucherId: 3,
            movementType: variable_1.MovementType.Receipt,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_movement_options_request_1.ProductMovementFilterQuery !== "undefined" && product_movement_options_request_1.ProductMovementFilterQuery) === "function" ? _b : Object)
], ProductMovementGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_movement_options_request_1.ProductMovementSortQuery !== "undefined" && product_movement_options_request_1.ProductMovementSortQuery) === "function" ? _c : Object)
], ProductMovementGetQuery.prototype, "sort", void 0);
class ProductMovementPaginationQuery extends (0, swagger_1.IntersectionType)(ProductMovementGetQuery, query_1.PaginationQuery) {
}
exports.ProductMovementPaginationQuery = ProductMovementPaginationQuery;
class ProductMovementGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductMovementGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductMovementGetManyQuery = ProductMovementGetManyQuery;
class ProductMovementGetOneQuery extends (0, swagger_1.PickType)(ProductMovementGetQuery, ['relation']) {
}
exports.ProductMovementGetOneQuery = ProductMovementGetOneQuery;


/***/ }),
/* 461 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementSortQuery = exports.ProductMovementFilterQuery = exports.ProductMovementRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const variable_1 = __webpack_require__(21);
const ConditionEnumMovementType = (0, dto_1.createConditionEnum)(variable_1.MovementType);
class ProductMovementRelationQuery {
}
exports.ProductMovementRelationQuery = ProductMovementRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "user", void 0);
class ProductMovementFilterQuery {
}
exports.ProductMovementFilterQuery = ProductMovementFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductMovementFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "voucherId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "contactId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.MovementType)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "movementType", void 0);
class ProductMovementSortQuery extends dto_1.SortQuery {
}
exports.ProductMovementSortQuery = ProductMovementSortQuery;


/***/ }),
/* 462 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_controller_1 = __webpack_require__(463);
const api_product_service_1 = __webpack_require__(464);
let ApiProductModule = class ApiProductModule {
};
exports.ApiProductModule = ApiProductModule;
exports.ApiProductModule = ApiProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_controller_1.ApiProductController],
        providers: [api_product_service_1.ApiProductService],
    })
], ApiProductModule);


/***/ }),
/* 463 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_product_service_1 = __webpack_require__(464);
const request_1 = __webpack_require__(465);
let ApiProductController = class ApiProductController {
    constructor(apiProductService) {
        this.apiProductService = apiProductService;
    }
    pagination({ oid }, query) {
        return this.apiProductService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiProductService.getList(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiProductService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiProductService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiProductService.updateOne(oid, id, body);
    }
    async deleteOne({ oid, organization }, { id }) {
        return await this.apiProductService.destroyOne({ organization, oid, productId: id });
    }
    async mergeProduct({ oid, uid, organization }, body) {
        return await this.apiProductService.mergeProduct({ oid, body, userId: uid });
    }
};
exports.ApiProductController = ApiProductController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductPaginationQuery !== "undefined" && request_1.ProductPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProductController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProductGetManyQuery !== "undefined" && request_1.ProductGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.ProductGetOneQuery !== "undefined" && request_1.ProductGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.ProductCreateBody !== "undefined" && request_1.ProductCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.ProductUpdateBody !== "undefined" && request_1.ProductUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Patch)('merge-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_MERGE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.ProductMergeBody !== "undefined" && request_1.ProductMergeBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiProductController.prototype, "mergeProduct", null);
exports.ApiProductController = ApiProductController = __decorate([
    (0, swagger_1.ApiTags)('Product'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_service_1.ApiProductService !== "undefined" && api_product_service_1.ApiProductService) === "function" ? _a : Object])
], ApiProductController);


/***/ }),
/* 464 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const commission_entity_1 = __webpack_require__(75);
const repositories_1 = __webpack_require__(170);
const organization_repository_1 = __webpack_require__(41);
const product_movement_repository_1 = __webpack_require__(188);
const receipt_item_repository_1 = __webpack_require__(192);
const ticket_product_repository_1 = __webpack_require__(203);
const socket_emit_service_1 = __webpack_require__(306);
let ApiProductService = class ApiProductService {
    constructor(socketEmitService, cacheDataService, organizationRepository, ticketProductRepository, receiptItemRepository, productRepository, batchRepository, productMovementRepository, commissionRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.receiptItemRepository = receiptItemRepository;
        this.productRepository = productRepository;
        this.batchRepository = batchRepository;
        this.productMovementRepository = productMovementRepository;
        this.commissionRepository = commissionRepository;
    }
    async pagination(oid, query) {
        var _a, _b;
        const { page, limit, filter, sort, relation } = query;
        const { total, data } = await this.productRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                productGroupId: filter === null || filter === void 0 ? void 0 : filter.productGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        const productHasBatchesIds = (0, object_helper_1.uniqueArray)(data.map((item) => item.id));
        if ((relation === null || relation === void 0 ? void 0 : relation.batchList) && productHasBatchesIds.length) {
            const batchList = await this.batchRepository.findManyBy({
                productId: { IN: productHasBatchesIds },
                quantity: (_a = filter === null || filter === void 0 ? void 0 : filter.batchList) === null || _a === void 0 ? void 0 : _a.quantity,
                expiryDate: (_b = filter === null || filter === void 0 ? void 0 : filter.batchList) === null || _b === void 0 ? void 0 : _b.expiryDate,
            });
            const batchListMapProductId = (0, object_helper_1.arrayToKeyArray)(batchList, 'productId');
            data.forEach((item) => {
                item.batchList = batchListMapProductId[item.id] || [];
            });
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getList(oid, query) {
        var _a, _b;
        const { filter, limit, relation } = query;
        const data = await this.productRepository.findMany({
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                productGroupId: filter === null || filter === void 0 ? void 0 : filter.productGroupId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        const productHasBatchesIds = (0, object_helper_1.uniqueArray)(data.map((item) => item.id));
        if ((relation === null || relation === void 0 ? void 0 : relation.batchList) && productHasBatchesIds.length) {
            const batchList = await this.batchRepository.findManyBy({
                id: { IN: productHasBatchesIds },
                quantity: (_a = filter === null || filter === void 0 ? void 0 : filter.batchList) === null || _a === void 0 ? void 0 : _a.quantity,
                expiryDate: (_b = filter === null || filter === void 0 ? void 0 : filter.batchList) === null || _b === void 0 ? void 0 : _b.expiryDate,
            });
            const batchListMapProductId = (0, object_helper_1.arrayToKeyArray)(batchList, 'productId');
            data.forEach((item) => {
                item.batchList = batchListMapProductId[item.id] || [];
            });
        }
        return { data };
    }
    async getOne(oid, id, query) {
        var _a;
        const { relation, filter } = query;
        const product = await this.productRepository.findOne({
            relation: { productGroup: relation === null || relation === void 0 ? void 0 : relation.productGroup },
            condition: { oid, id },
        });
        if (!product)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (relation === null || relation === void 0 ? void 0 : relation.batchList) {
            product.batchList = await this.batchRepository.findMany({
                condition: {
                    oid,
                    productId: product.id,
                    quantity: (_a = filter === null || filter === void 0 ? void 0 : filter.batchList) === null || _a === void 0 ? void 0 : _a.quantity,
                    expiryDate: filter === null || filter === void 0 ? void 0 : filter.batchList.expiryDate,
                },
                sort: { expiryDate: 'ASC' },
            });
        }
        if (relation === null || relation === void 0 ? void 0 : relation.commissionList) {
            product.commissionList = await this.commissionRepository.findManyBy({
                oid,
                interactType: commission_entity_1.InteractType.Product,
                interactId: product.id,
            });
        }
        return { data: { product } };
    }
    async createOne(oid, body) {
        const { commissionList } = body, productBody = __rest(body, ["commissionList"]);
        let productCode = body.productCode;
        if (!productCode) {
            const count = await this.productRepository.countBy({ oid });
            productCode = (count + 1).toString();
        }
        const existProduct = await this.productRepository.findOneBy({
            oid,
            productCode,
        });
        if (existProduct) {
            throw new exception_filter_1.BusinessException(`Trùng mã sản phẩm với ${existProduct.brandName}`);
        }
        const product = await this.productRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, productBody), { oid,
            productCode }));
        if (body.quantity) {
            await this.batchRepository.insertOne({
                oid,
                productId: product.id,
                costPrice: body.costPrice,
                quantity: body.quantity,
                costAmount: body.costPrice * body.quantity,
                distributorId: 0,
                expiryDate: null,
                batchCode: '',
                registeredAt: Date.now(),
                warehouseId: 0,
            });
        }
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: product.id,
                interactType: commission_entity_1.InteractType.Product,
            };
            return dto;
        });
        product.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        this.socketEmitService.productUpsert(oid, { product });
        return { data: { product } };
    }
    async updateOne(oid, productId, body) {
        const { commissionList } = body, productBody = __rest(body, ["commissionList"]);
        const productOrigin = await this.productRepository.findOneBy({ oid, id: productId });
        if (productOrigin.warehouseIds !== body.warehouseIds) {
            let bodyWarehouseIdList = [];
            try {
                bodyWarehouseIdList = JSON.parse(body.warehouseIds);
            }
            catch (error) { }
            if (bodyWarehouseIdList.includes(0)) {
            }
            else {
                const batchList = await this.batchRepository.findMany({
                    condition: {
                        oid,
                        productId,
                        quantity: { NOT: 0 },
                    },
                });
                const batchError = [];
                batchList.forEach((i) => {
                    if (i.warehouseId === 0)
                        return;
                    if (!bodyWarehouseIdList.includes(i.warehouseId)) {
                        batchError.push(i);
                    }
                });
                if (batchError.length) {
                    return {
                        success: false,
                        data: { batchError },
                        message: 'error.Conflict',
                    };
                }
            }
        }
        const existProduct = await this.productRepository.findOneBy({
            oid,
            productCode: body.productCode,
            id: { NOT: productId },
        });
        if (existProduct) {
            throw new exception_filter_1.BusinessException(`Trùng mã sản phẩm với ${existProduct.brandName}`);
        }
        const product = await this.productRepository.updateOneAndReturnEntity({ oid, id: productId }, productBody);
        await this.commissionRepository.delete({
            oid,
            interactId: product.id,
            interactType: commission_entity_1.InteractType.Product,
        });
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: product.id,
                interactType: commission_entity_1.InteractType.Product,
            };
            return dto;
        });
        product.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        this.socketEmitService.productUpsert(oid, { product });
        return { data: { product } };
    }
    async destroyOne(options) {
        const { oid, productId, organization } = options;
        const [receiptItemList, ticketProductList] = await Promise.all([
            this.receiptItemRepository.findMany({
                condition: { oid, productId },
                limit: 10,
            }),
            this.ticketProductRepository.findMany({
                condition: { oid, productId },
                limit: 10,
            }),
        ]);
        if (receiptItemList.length > 0 || ticketProductList.length > 0) {
            return {
                data: { receiptItemList, ticketProductList },
                success: false,
            };
        }
        await Promise.allSettled([
            this.productRepository.delete({ oid, id: productId }),
            this.batchRepository.delete({ oid, id: productId }),
            this.productMovementRepository.delete({ oid, productId }),
        ]);
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        return { data: { receiptItemList: [], ticketProductList: [], productId } };
    }
    async mergeProduct(options) {
        const { oid, userId, body } = options;
        const { productIdSourceList, productIdTarget } = body;
        productIdSourceList.forEach((i) => {
            if (isNaN(i) || i <= 0) {
                throw new exception_filter_1.BusinessException('error.ValidateFailed');
            }
        });
        await this.productRepository.mergeProduct({
            oid,
            userId,
            productIdTarget,
            productIdSourceList,
        });
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        return { data: true };
    }
};
exports.ApiProductService = ApiProductService;
exports.ApiProductService = ApiProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof ticket_product_repository_1.TicketProductRepository !== "undefined" && ticket_product_repository_1.TicketProductRepository) === "function" ? _d : Object, typeof (_e = typeof receipt_item_repository_1.ReceiptItemRepository !== "undefined" && receipt_item_repository_1.ReceiptItemRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _g : Object, typeof (_h = typeof product_movement_repository_1.ProductMovementRepository !== "undefined" && product_movement_repository_1.ProductMovementRepository) === "function" ? _h : Object, typeof (_j = typeof repositories_1.CommissionRepository !== "undefined" && repositories_1.CommissionRepository) === "function" ? _j : Object])
], ApiProductService);


/***/ }),
/* 465 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(466), exports);
__exportStar(__webpack_require__(468), exports);
__exportStar(__webpack_require__(467), exports);
__exportStar(__webpack_require__(469), exports);


/***/ }),
/* 466 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGetOneQuery = exports.ProductGetManyQuery = exports.ProductPaginationQuery = exports.ProductGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const product_options_request_1 = __webpack_require__(467);
class ProductGetQuery {
}
exports.ProductGetQuery = ProductGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ batchList: true }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_options_request_1.ProductRelationQuery !== "undefined" && product_options_request_1.ProductRelationQuery) === "function" ? _a : Object)
], ProductGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1, quantity: { GT: 10 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductFilterQueryFull, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_options_request_1.ProductFilterQueryFull !== "undefined" && product_options_request_1.ProductFilterQueryFull) === "function" ? _b : Object)
], ProductGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'DESC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_options_request_1.ProductSortQuery !== "undefined" && product_options_request_1.ProductSortQuery) === "function" ? _c : Object)
], ProductGetQuery.prototype, "sort", void 0);
class ProductPaginationQuery extends (0, swagger_1.IntersectionType)(ProductGetQuery, query_1.PaginationQuery) {
}
exports.ProductPaginationQuery = ProductPaginationQuery;
class ProductGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductGetManyQuery = ProductGetManyQuery;
class ProductGetOneQuery extends (0, swagger_1.PickType)(ProductGetQuery, ['relation', 'filter']) {
}
exports.ProductGetOneQuery = ProductGetOneQuery;


/***/ }),
/* 467 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductSortQuery = exports.ProductFilterQueryFull = exports.ProductFilterQuery = exports.BatchFilterQuery = exports.ProductRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const condition_number_1 = __webpack_require__(289);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class ProductRelationQuery {
}
exports.ProductRelationQuery = ProductRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "batchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "productGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "commissionList", void 0);
class BatchFilterQuery {
}
exports.BatchFilterQuery = BatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], BatchFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], BatchFilterQuery.prototype, "expiryDate", void 0);
class ProductFilterQuery {
}
exports.ProductFilterQuery = ProductFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductFilterQuery.prototype, "productGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionString),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionString !== "undefined" && dto_1.ConditionString) === "function" ? _c : Object)
], ProductFilterQuery.prototype, "brandName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionString),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof dto_1.ConditionString !== "undefined" && dto_1.ConditionString) === "function" ? _d : Object)
], ProductFilterQuery.prototype, "substance", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProductFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _e : Object)
], ProductFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _f : Object)
], ProductFilterQuery.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductFilterQuery.prototype, "$OR", void 0);
class ProductFilterQueryFull extends ProductFilterQuery {
}
exports.ProductFilterQueryFull = ProductFilterQueryFull;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => BatchFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", BatchFilterQuery)
], ProductFilterQueryFull.prototype, "batchList", void 0);
class ProductSortQuery extends query_1.SortQuery {
}
exports.ProductSortQuery = ProductSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProductSortQuery.prototype, "productCode", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProductSortQuery.prototype, "brandName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProductSortQuery.prototype, "quantity", void 0);


/***/ }),
/* 468 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMergeBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ProductMergeBody {
}
exports.ProductMergeBody = ProductMergeBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ProductMergeBody.prototype, "productIdSourceList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ProductMergeBody.prototype, "productIdTarget", void 0);


/***/ }),
/* 469 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductUpdateBody = exports.ProductCreateBody = exports.ProductCommission = exports.UnitConversionBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const commission_entity_1 = __webpack_require__(75);
const product_entity_1 = __webpack_require__(54);
class UnitConversionBody {
}
exports.UnitConversionBody = UnitConversionBody;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UnitConversionBody.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UnitConversionBody.prototype, "rate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], UnitConversionBody.prototype, "default", void 0);
class ProductCommission {
}
exports.ProductCommission = ProductCommission;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], ProductCommission.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCommission.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: commission_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _a : Object)
], ProductCommission.prototype, "commissionCalculatorType", void 0);
class ProductCreateBody {
}
exports.ProductCreateBody = ProductCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Klacid 125mg/5ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "brandName", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "productCode", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Clarythromycin 125mg/5ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "substance", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 59000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 45000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 45000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "wholesalePrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 59000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "retailPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "productGroupId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        name: 'unit',
        type: 'string',
        example: JSON.stringify([{ name: 'Viên', rate: 1 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new UnitConversionBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length)
                    err.push(...validate);
                return instance;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({
        message: `Validate unit failed: Example: ${JSON.stringify([{ name: 'Viên', rate: 1 }])}`,
    }),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "unit", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "route", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Ấn Độ' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "source", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        example: 'https://cdn.medigoapp.com/product/Klacid_125mg_5ml_4724e139c8.jpg',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "image", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 1 viên/ngày, 9h sáng, sau ăn no' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "hintUsage", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProductCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.PickupStrategy, example: variable_1.PickupStrategy.AutoWithExpiryDate }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PickupStrategy),
    __metadata("design:type", typeof (_b = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _b : Object)
], ProductCreateBody.prototype, "pickupStrategy", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByWarehouse, example: product_entity_1.SplitBatchByWarehouse.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByWarehouse),
    __metadata("design:type", typeof (_c = typeof product_entity_1.SplitBatchByWarehouse !== "undefined" && product_entity_1.SplitBatchByWarehouse) === "function" ? _c : Object)
], ProductCreateBody.prototype, "splitBatchByWarehouse", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        enum: product_entity_1.SplitBatchByDistributor,
        example: product_entity_1.SplitBatchByDistributor.Inherit,
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByDistributor),
    __metadata("design:type", typeof (_d = typeof product_entity_1.SplitBatchByDistributor !== "undefined" && product_entity_1.SplitBatchByDistributor) === "function" ? _d : Object)
], ProductCreateBody.prototype, "splitBatchByDistributor", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByExpiryDate, example: product_entity_1.SplitBatchByExpiryDate.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByExpiryDate),
    __metadata("design:type", typeof (_e = typeof product_entity_1.SplitBatchByExpiryDate !== "undefined" && product_entity_1.SplitBatchByExpiryDate) === "function" ? _e : Object)
], ProductCreateBody.prototype, "splitBatchByExpiryDate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByCostPrice, example: product_entity_1.SplitBatchByCostPrice.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByCostPrice),
    __metadata("design:type", typeof (_f = typeof product_entity_1.SplitBatchByCostPrice !== "undefined" && product_entity_1.SplitBatchByCostPrice) === "function" ? _f : Object)
], ProductCreateBody.prototype, "splitBatchByCostPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], ProductCreateBody.prototype, "warehouseIds", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProductCommission, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductCommission),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductCreateBody.prototype, "commissionList", void 0);
class ProductUpdateBody extends (0, swagger_1.OmitType)(ProductCreateBody, ['quantity']) {
}
exports.ProductUpdateBody = ProductUpdateBody;


/***/ }),
/* 470 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_group_controller_1 = __webpack_require__(471);
const api_radiology_group_service_1 = __webpack_require__(472);
let ApiRadiologyGroupModule = class ApiRadiologyGroupModule {
};
exports.ApiRadiologyGroupModule = ApiRadiologyGroupModule;
exports.ApiRadiologyGroupModule = ApiRadiologyGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_radiology_group_controller_1.ApiRadiologyGroupController],
        providers: [api_radiology_group_service_1.ApiRadiologyGroupService],
    })
], ApiRadiologyGroupModule);


/***/ }),
/* 471 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_radiology_group_service_1 = __webpack_require__(472);
const request_1 = __webpack_require__(473);
let ApiRadiologyGroupController = class ApiRadiologyGroupController {
    constructor(apiRadiologyGroupService) {
        this.apiRadiologyGroupService = apiRadiologyGroupService;
    }
    pagination({ oid }, query) {
        return this.apiRadiologyGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiRadiologyGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiRadiologyGroupService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiRadiologyGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiRadiologyGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRadiologyGroupService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiRadiologyGroupService.replaceAll(oid, body);
    }
    async systemList() {
        return await this.apiRadiologyGroupService.systemList();
    }
};
exports.ApiRadiologyGroupController = ApiRadiologyGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RadiologyGroupPaginationQuery !== "undefined" && request_1.RadiologyGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RadiologyGroupGetManyQuery !== "undefined" && request_1.RadiologyGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.RadiologyGroupCreateBody !== "undefined" && request_1.RadiologyGroupCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.RadiologyGroupUpdateBody !== "undefined" && request_1.RadiologyGroupUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.RadiologyGroupReplaceAllBody !== "undefined" && request_1.RadiologyGroupReplaceAllBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "systemList", null);
exports.ApiRadiologyGroupController = ApiRadiologyGroupController = __decorate([
    (0, swagger_1.ApiTags)('RadiologyGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('radiology-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_radiology_group_service_1.ApiRadiologyGroupService !== "undefined" && api_radiology_group_service_1.ApiRadiologyGroupService) === "function" ? _a : Object])
], ApiRadiologyGroupController);


/***/ }),
/* 472 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(170);
let ApiRadiologyGroupService = class ApiRadiologyGroupService {
    constructor(radiologyGroupRepository) {
        this.radiologyGroupRepository = radiologyGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.radiologyGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.radiologyGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const radiologyGroup = await this.radiologyGroupRepository.findOneBy({ oid, id });
        if (!radiologyGroup)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { radiologyGroup } };
    }
    async createOne(oid, body) {
        const radiologyGroup = await this.radiologyGroupRepository.insertOneAndReturnEntity(Object.assign({ oid }, body));
        return { data: { radiologyGroup } };
    }
    async updateOne(oid, id, body) {
        const radiologyGroupList = await this.radiologyGroupRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { radiologyGroup: radiologyGroupList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.radiologyGroupRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceAll(oid, body) {
        await this.radiologyGroupRepository.replaceAll(oid, body.radiologyGroupReplaceAll);
        return { data: true };
    }
    async systemList() {
        const data = await this.radiologyGroupRepository.findMany({
            condition: { oid: 1 },
        });
        return { data };
    }
};
exports.ApiRadiologyGroupService = ApiRadiologyGroupService;
exports.ApiRadiologyGroupService = ApiRadiologyGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RadiologyGroupRepository !== "undefined" && repositories_1.RadiologyGroupRepository) === "function" ? _a : Object])
], ApiRadiologyGroupService);


/***/ }),
/* 473 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(474), exports);
__exportStar(__webpack_require__(475), exports);
__exportStar(__webpack_require__(476), exports);


/***/ }),
/* 474 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupGetOneQuery = exports.RadiologyGroupGetManyQuery = exports.RadiologyGroupPaginationQuery = exports.RadiologyGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const radiology_group_options_request_1 = __webpack_require__(475);
class RadiologyGroupGetQuery {
}
exports.RadiologyGroupGetQuery = RadiologyGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof radiology_group_options_request_1.RadiologyGroupRelationQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupRelationQuery) === "function" ? _a : Object)
], RadiologyGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof radiology_group_options_request_1.RadiologyGroupFilterQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupFilterQuery) === "function" ? _b : Object)
], RadiologyGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof radiology_group_options_request_1.RadiologyGroupSortQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupSortQuery) === "function" ? _c : Object)
], RadiologyGroupGetQuery.prototype, "sort", void 0);
class RadiologyGroupPaginationQuery extends (0, swagger_1.IntersectionType)(RadiologyGroupGetQuery, query_1.PaginationQuery) {
}
exports.RadiologyGroupPaginationQuery = RadiologyGroupPaginationQuery;
class RadiologyGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RadiologyGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RadiologyGroupGetManyQuery = RadiologyGroupGetManyQuery;
class RadiologyGroupGetOneQuery extends (0, swagger_1.PickType)(RadiologyGroupGetQuery, ['relation']) {
}
exports.RadiologyGroupGetOneQuery = RadiologyGroupGetOneQuery;


/***/ }),
/* 475 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupSortQuery = exports.RadiologyGroupFilterQuery = exports.RadiologyGroupRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class RadiologyGroupRelationQuery {
}
exports.RadiologyGroupRelationQuery = RadiologyGroupRelationQuery;
class RadiologyGroupFilterQuery {
}
exports.RadiologyGroupFilterQuery = RadiologyGroupFilterQuery;
class RadiologyGroupSortQuery extends query_1.SortQuery {
}
exports.RadiologyGroupSortQuery = RadiologyGroupSortQuery;


/***/ }),
/* 476 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupReplaceAllBody = exports.RadiologyGroupReplaceBody = exports.RadiologyGroupUpdateBody = exports.RadiologyGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RadiologyGroupCreateBody {
}
exports.RadiologyGroupCreateBody = RadiologyGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RadiologyGroupCreateBody.prototype, "name", void 0);
class RadiologyGroupUpdateBody extends (0, swagger_1.PartialType)(RadiologyGroupCreateBody) {
}
exports.RadiologyGroupUpdateBody = RadiologyGroupUpdateBody;
class RadiologyGroupReplaceBody {
}
exports.RadiologyGroupReplaceBody = RadiologyGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RadiologyGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], RadiologyGroupReplaceBody.prototype, "id", void 0);
class RadiologyGroupReplaceAllBody {
}
exports.RadiologyGroupReplaceAllBody = RadiologyGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: RadiologyGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RadiologyGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], RadiologyGroupReplaceAllBody.prototype, "radiologyGroupReplaceAll", void 0);


/***/ }),
/* 477 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_controller_1 = __webpack_require__(478);
const api_radiology_service_1 = __webpack_require__(479);
let ApiRadiologyModule = class ApiRadiologyModule {
};
exports.ApiRadiologyModule = ApiRadiologyModule;
exports.ApiRadiologyModule = ApiRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_radiology_controller_1.ApiRadiologyController],
        providers: [api_radiology_service_1.ApiRadiologyService],
    })
], ApiRadiologyModule);


/***/ }),
/* 478 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_radiology_service_1 = __webpack_require__(479);
const request_1 = __webpack_require__(480);
let ApiRadiologyController = class ApiRadiologyController {
    constructor(apiRadiologyService) {
        this.apiRadiologyService = apiRadiologyService;
    }
    pagination({ oid }, query) {
        return this.apiRadiologyService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiRadiologyService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiRadiologyService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiRadiologyService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiRadiologyService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRadiologyService.destroyOne(oid, id);
    }
    async systemList() {
        return await this.apiRadiologyService.systemList();
    }
    async systemCopy({ oid }, body) {
        return await this.apiRadiologyService.systemCopy(oid, body);
    }
};
exports.ApiRadiologyController = ApiRadiologyController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RadiologyPaginationQuery !== "undefined" && request_1.RadiologyPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RadiologyGetManyQuery !== "undefined" && request_1.RadiologyGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.RadiologyGetOneQuery !== "undefined" && request_1.RadiologyGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RadiologyUpsertBody !== "undefined" && request_1.RadiologyUpsertBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.RadiologyUpsertBody !== "undefined" && request_1.RadiologyUpsertBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "systemList", null);
__decorate([
    (0, common_1.Post)('system-copy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.RadiologySystemCopyBody !== "undefined" && request_1.RadiologySystemCopyBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "systemCopy", null);
exports.ApiRadiologyController = ApiRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('Radiology'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_radiology_service_1.ApiRadiologyService !== "undefined" && api_radiology_service_1.ApiRadiologyService) === "function" ? _a : Object])
], ApiRadiologyController);


/***/ }),
/* 479 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const commission_entity_1 = __webpack_require__(75);
const repositories_1 = __webpack_require__(170);
let ApiRadiologyService = class ApiRadiologyService {
    constructor(radiologyRepository, commissionRepository, ticketRadiologyRepository) {
        this.radiologyRepository = radiologyRepository;
        this.commissionRepository = commissionRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
    }
    async pagination(oid, query) {
        var _a, _b;
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.radiologyRepository.pagination({
            relation: {
                printHtml: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.printHtml,
                radiologyGroup: (_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.radiologyGroup,
            },
            page,
            limit,
            condition: {
                oid,
                radiologyGroupId: filter === null || filter === void 0 ? void 0 : filter.radiologyGroupId,
                printHtmlId: filter === null || filter === void 0 ? void 0 : filter.printHtmlId,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        var _a, _b;
        const { limit, filter, relation, sort } = query;
        const data = await this.radiologyRepository.findMany({
            relation: {
                printHtml: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.printHtml,
                radiologyGroup: (_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.radiologyGroup,
            },
            condition: {
                oid,
                radiologyGroupId: filter === null || filter === void 0 ? void 0 : filter.radiologyGroupId,
                printHtmlId: filter === null || filter === void 0 ? void 0 : filter.printHtmlId,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        var _a, _b, _c;
        const radiology = await this.radiologyRepository.findOne({
            relation: {
                printHtml: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.printHtml,
                radiologyGroup: (_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.radiologyGroup,
            },
            condition: { oid, id },
        });
        if (!radiology)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if ((_c = query === null || query === void 0 ? void 0 : query.relation) === null || _c === void 0 ? void 0 : _c.commissionList) {
            radiology.commissionList = await this.commissionRepository.findManyBy({
                oid,
                interactType: commission_entity_1.InteractType.Radiology,
                interactId: radiology.id,
            });
        }
        return { data: { radiology } };
    }
    async createOne(oid, body) {
        const { commissionList } = body, radiologyBody = __rest(body, ["commissionList"]);
        commissionList.forEach((i) => {
            if (i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected
                || i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual) {
                if (i.commissionValue >= 1000) {
                    throw new exception_filter_1.BusinessException('error.ValidateFailed');
                }
            }
        });
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: radiology.id,
                interactType: commission_entity_1.InteractType.Radiology,
            };
            return dto;
        });
        const radiology = await this.radiologyRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, radiologyBody));
        radiology.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        return { data: { radiology } };
    }
    async updateOne(oid, id, body) {
        const { commissionList } = body, radiologyBody = __rest(body, ["commissionList"]);
        commissionList.forEach((i) => {
            if (i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected
                || i.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual) {
                if (i.commissionValue >= 1000) {
                    throw new exception_filter_1.BusinessException('error.ValidateFailed');
                }
            }
        });
        const [radiology] = await this.radiologyRepository.updateAndReturnEntity({ oid, id }, radiologyBody);
        if (!radiology)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        await this.commissionRepository.delete({
            oid,
            interactId: radiology.id,
            interactType: commission_entity_1.InteractType.Radiology,
        });
        const commissionDtoList = commissionList.map((i) => {
            const dto = {
                oid,
                roleId: i.roleId,
                commissionCalculatorType: i.commissionCalculatorType,
                commissionValue: i.commissionValue,
                interactId: radiology.id,
                interactType: commission_entity_1.InteractType.Radiology,
            };
            return dto;
        });
        radiology.commissionList =
            await this.commissionRepository.insertManyFullFieldAndReturnEntity(commissionDtoList);
        return { data: { radiology } };
    }
    async destroyOne(oid, radiologyId) {
        const ticketRadiologyList = await this.ticketRadiologyRepository.findMany({
            condition: { oid, radiologyId },
            limit: 10,
        });
        if (ticketRadiologyList.length > 0) {
            return {
                data: { ticketRadiologyList },
                success: false,
            };
        }
        await this.commissionRepository.delete({
            oid,
            interactId: radiologyId,
            interactType: commission_entity_1.InteractType.Radiology,
        });
        const affected = await this.radiologyRepository.delete({ oid, id: radiologyId });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: { ticketRadiologyList: [], radiologyId } };
    }
    async systemList() {
        const data = await this.radiologyRepository.findMany({
            relation: { printHtml: true },
            condition: { oid: 1 },
            sort: { priority: 'ASC' },
        });
        return { data };
    }
    async systemCopy(oid, body) {
        const radiologySystemList = await this.radiologyRepository.findMany({
            condition: { oid: 1, id: { IN: body.radiologyIdList } },
        });
        const radiologyInsertList = radiologySystemList.map((i) => {
            const dto = {
                oid,
                name: i.name,
                costPrice: i.costPrice,
                price: i.price,
                printHtmlId: i.printHtmlId,
                radiologyGroupId: 0,
                descriptionDefault: i.descriptionDefault,
                requestNoteDefault: i.requestNoteDefault,
                resultDefault: i.resultDefault,
                customVariables: i.customVariables,
                customStyles: i.customStyles,
                priority: 0,
            };
            return dto;
        });
        const insertIds = await this.radiologyRepository.insertMany(radiologyInsertList);
        await this.radiologyRepository.update({ id: { IN: insertIds } }, { priority: () => `"id"` });
        return { data: true };
    }
};
exports.ApiRadiologyService = ApiRadiologyService;
exports.ApiRadiologyService = ApiRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CommissionRepository !== "undefined" && repositories_1.CommissionRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _c : Object])
], ApiRadiologyService);


/***/ }),
/* 480 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(481), exports);
__exportStar(__webpack_require__(482), exports);
__exportStar(__webpack_require__(483), exports);
__exportStar(__webpack_require__(484), exports);


/***/ }),
/* 481 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGetOneQuery = exports.RadiologyGetManyQuery = exports.RadiologyPaginationQuery = exports.RadiologyGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const radiology_options_request_1 = __webpack_require__(482);
class RadiologyGetQuery {
}
exports.RadiologyGetQuery = RadiologyGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologyRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof radiology_options_request_1.RadiologyRelationQuery !== "undefined" && radiology_options_request_1.RadiologyRelationQuery) === "function" ? _a : Object)
], RadiologyGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologyFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof radiology_options_request_1.RadiologyFilterQuery !== "undefined" && radiology_options_request_1.RadiologyFilterQuery) === "function" ? _b : Object)
], RadiologyGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof radiology_options_request_1.RadiologySortQuery !== "undefined" && radiology_options_request_1.RadiologySortQuery) === "function" ? _c : Object)
], RadiologyGetQuery.prototype, "sort", void 0);
class RadiologyPaginationQuery extends (0, swagger_1.IntersectionType)(RadiologyGetQuery, query_1.PaginationQuery) {
}
exports.RadiologyPaginationQuery = RadiologyPaginationQuery;
class RadiologyGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RadiologyGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RadiologyGetManyQuery = RadiologyGetManyQuery;
class RadiologyGetOneQuery extends (0, swagger_1.PickType)(RadiologyGetQuery, ['relation']) {
}
exports.RadiologyGetOneQuery = RadiologyGetOneQuery;


/***/ }),
/* 482 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySortQuery = exports.RadiologyFilterQuery = exports.RadiologyRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class RadiologyRelationQuery {
}
exports.RadiologyRelationQuery = RadiologyRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "radiologyGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "printHtml", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "commissionList", void 0);
class RadiologyFilterQuery {
}
exports.RadiologyFilterQuery = RadiologyFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologyFilterQuery.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologyFilterQuery.prototype, "printHtmlId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], RadiologyFilterQuery.prototype, "updatedAt", void 0);
class RadiologySortQuery extends query_1.SortQuery {
}
exports.RadiologySortQuery = RadiologySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySortQuery.prototype, "priority", void 0);


/***/ }),
/* 483 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySystemCopyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RadiologySystemCopyBody {
}
exports.RadiologySystemCopyBody = RadiologySystemCopyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], RadiologySystemCopyBody.prototype, "radiologyIdList", void 0);


/***/ }),
/* 484 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyUpsertBody = exports.RadiologyCommission = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const DOMPurify = __webpack_require__(485);
const class_validator_custom_1 = __webpack_require__(247);
const commission_entity_1 = __webpack_require__(75);
class RadiologyCommission {
}
exports.RadiologyCommission = RadiologyCommission;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], RadiologyCommission.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologyCommission.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: commission_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _a : Object)
], RadiologyCommission.prototype, "commissionCalculatorType", void 0);
class RadiologyUpsertBody {
}
exports.RadiologyUpsertBody = RadiologyUpsertBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyUpsertBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Siêu âm tuyến giáp' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyUpsertBody.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyUpsertBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyUpsertBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyUpsertBody.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Siêu âm thai, rau, ối' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "requestNoteDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<h1>Âm tính</h1>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => DOMPurify.sanitize(value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "descriptionDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Chưa có dấu hiệu bất thường' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "resultDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "customVariables", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyUpsertBody.prototype, "customStyles", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: RadiologyCommission, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RadiologyCommission),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], RadiologyUpsertBody.prototype, "commissionList", void 0);


/***/ }),
/* 485 */
/***/ ((module) => {

module.exports = require("isomorphic-dompurify");

/***/ }),
/* 486 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptItemModule = void 0;
const common_1 = __webpack_require__(3);
const api_receipt_item_controller_1 = __webpack_require__(487);
const api_receipt_item_service_1 = __webpack_require__(489);
let ApiReceiptItemModule = class ApiReceiptItemModule {
};
exports.ApiReceiptItemModule = ApiReceiptItemModule;
exports.ApiReceiptItemModule = ApiReceiptItemModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_receipt_item_controller_1.ApiReceiptItemController],
        providers: [api_receipt_item_service_1.ApiReceiptItemService],
    })
], ApiReceiptItemModule);


/***/ }),
/* 487 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptItemController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(488);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_receipt_item_service_1 = __webpack_require__(489);
const request_1 = __webpack_require__(490);
let ApiReceiptItemController = class ApiReceiptItemController {
    constructor(apiReceiptItemService) {
        this.apiReceiptItemService = apiReceiptItemService;
    }
    async pagination({ oid }, query) {
        return await this.apiReceiptItemService.pagination(oid, query);
    }
};
exports.ApiReceiptItemController = ApiReceiptItemController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ReceiptItemPaginationQuery !== "undefined" && request_1.ReceiptItemPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptItemController.prototype, "pagination", null);
exports.ApiReceiptItemController = ApiReceiptItemController = __decorate([
    (0, swagger_1.ApiTags)('ReceiptItem'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('receipt-item'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_receipt_item_service_1.ApiReceiptItemService !== "undefined" && api_receipt_item_service_1.ApiReceiptItemService) === "function" ? _a : Object])
], ApiReceiptItemController);


/***/ }),
/* 488 */
/***/ ((module) => {

module.exports = require("@nestjs/common/decorators/http/route-params.decorator");

/***/ }),
/* 489 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptItemService = void 0;
const common_1 = __webpack_require__(3);
const receipt_item_repository_1 = __webpack_require__(192);
let ApiReceiptItemService = class ApiReceiptItemService {
    constructor(receiptItemRepository) {
        this.receiptItemRepository = receiptItemRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data } = await this.receiptItemRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                receiptId: filter === null || filter === void 0 ? void 0 : filter.receiptId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                batchId: filter === null || filter === void 0 ? void 0 : filter.batchId,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
};
exports.ApiReceiptItemService = ApiReceiptItemService;
exports.ApiReceiptItemService = ApiReceiptItemService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof receipt_item_repository_1.ReceiptItemRepository !== "undefined" && receipt_item_repository_1.ReceiptItemRepository) === "function" ? _a : Object])
], ApiReceiptItemService);


/***/ }),
/* 490 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(491), exports);
__exportStar(__webpack_require__(492), exports);


/***/ }),
/* 491 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptItemGetOneQuery = exports.ReceiptItemGetManyQuery = exports.ReceiptItemPaginationQuery = exports.ReceiptItemGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const receipt_item_options_request_1 = __webpack_require__(492);
class ReceiptItemGetQuery {
}
exports.ReceiptItemGetQuery = ReceiptItemGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_item_options_request_1.ReceiptItemRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof receipt_item_options_request_1.ReceiptItemRelationQuery !== "undefined" && receipt_item_options_request_1.ReceiptItemRelationQuery) === "function" ? _a : Object)
], ReceiptItemGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            receiptId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_item_options_request_1.ReceiptItemFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof receipt_item_options_request_1.ReceiptItemFilterQuery !== "undefined" && receipt_item_options_request_1.ReceiptItemFilterQuery) === "function" ? _b : Object)
], ReceiptItemGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_item_options_request_1.ReceiptItemSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof receipt_item_options_request_1.ReceiptItemSortQuery !== "undefined" && receipt_item_options_request_1.ReceiptItemSortQuery) === "function" ? _c : Object)
], ReceiptItemGetQuery.prototype, "sort", void 0);
class ReceiptItemPaginationQuery extends (0, swagger_1.IntersectionType)(ReceiptItemGetQuery, query_1.PaginationQuery) {
}
exports.ReceiptItemPaginationQuery = ReceiptItemPaginationQuery;
class ReceiptItemGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ReceiptItemGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ReceiptItemGetManyQuery = ReceiptItemGetManyQuery;
class ReceiptItemGetOneQuery extends (0, swagger_1.PickType)(ReceiptItemGetQuery, ['relation']) {
}
exports.ReceiptItemGetOneQuery = ReceiptItemGetOneQuery;


/***/ }),
/* 492 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptItemSortQuery = exports.ReceiptItemFilterQuery = exports.ReceiptItemRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class ReceiptItemRelationQuery {
}
exports.ReceiptItemRelationQuery = ReceiptItemRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsObject)(),
    __metadata("design:type", Object)
], ReceiptItemRelationQuery.prototype, "receipt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ReceiptItemRelationQuery.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ReceiptItemRelationQuery.prototype, "product", void 0);
class ReceiptItemFilterQuery {
}
exports.ReceiptItemFilterQuery = ReceiptItemFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemFilterQuery.prototype, "receiptId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemFilterQuery.prototype, "batchId", void 0);
class ReceiptItemSortQuery extends query_1.SortQuery {
}
exports.ReceiptItemSortQuery = ReceiptItemSortQuery;


/***/ }),
/* 493 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptModule = void 0;
const common_1 = __webpack_require__(3);
const api_receipt_action_1 = __webpack_require__(494);
const api_receipt_controller_1 = __webpack_require__(495);
const api_receipt_service_1 = __webpack_require__(278);
let ApiReceiptModule = class ApiReceiptModule {
};
exports.ApiReceiptModule = ApiReceiptModule;
exports.ApiReceiptModule = ApiReceiptModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_receipt_controller_1.ApiReceiptController],
        providers: [api_receipt_service_1.ApiReceiptService, api_receipt_action_1.ApiReceiptAction],
    })
], ApiReceiptModule);


/***/ }),
/* 494 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptAction = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(48);
const receipt_entity_1 = __webpack_require__(51);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const receipt_repository_1 = __webpack_require__(193);
const socket_emit_service_1 = __webpack_require__(306);
let ApiReceiptAction = class ApiReceiptAction {
    constructor(socketEmitService, receiptRepository, receiptRefundOverpaidOperation, receiptPayDebtOperation, paymentRepository, receiptSendProductOperation, receiptPaymentAndCloseOperation, receiptPrepaymentOperation, receiptReturnProductOperation, receiptReopenOperation) {
        this.socketEmitService = socketEmitService;
        this.receiptRepository = receiptRepository;
        this.receiptRefundOverpaidOperation = receiptRefundOverpaidOperation;
        this.receiptPayDebtOperation = receiptPayDebtOperation;
        this.paymentRepository = paymentRepository;
        this.receiptSendProductOperation = receiptSendProductOperation;
        this.receiptPaymentAndCloseOperation = receiptPaymentAndCloseOperation;
        this.receiptPrepaymentOperation = receiptPrepaymentOperation;
        this.receiptReturnProductOperation = receiptReturnProductOperation;
        this.receiptReopenOperation = receiptReopenOperation;
    }
    async destroy(params) {
        const { oid, receiptId } = params;
        await this.receiptRepository.destroy({ oid, receiptId });
        return { data: { receiptId } };
    }
    async sendProductAndPaymentAndClose(params) {
        const { oid, userId, receiptId, body } = params;
        try {
            const sendProductResult = await this.receiptSendProductOperation.sendProduct({
                oid,
                userId,
                receiptId,
                time: Date.now(),
            });
            const { receipt, payment } = await this.receiptPaymentAndCloseOperation.paymentAndClose({
                oid,
                cashierId: userId,
                receiptId,
                time: Date.now(),
                paymentMethodId: body.paymentMethodId,
                money: body.money,
                note: '',
                description: '',
            });
            return { data: { receipt, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async prepayment(params) {
        const { oid, userId, receiptId, body } = params;
        try {
            const { receipt, payment } = await this.receiptPrepaymentOperation.prepayment({
                oid,
                cashierId: userId,
                receiptId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
            });
            return { data: { receipt, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async sendProduct(params) {
        const { oid, userId, receiptId } = params;
        try {
            const { receipt } = await this.receiptSendProductOperation.sendProduct({
                oid,
                userId,
                receiptId,
                time: Date.now(),
            });
            return { data: { receipt } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async refundOverpaid(params) {
        const { oid, userId, receiptId, body } = params;
        const { receipt, payment } = await this.receiptRefundOverpaidOperation.refundOverpaid({
            oid,
            cashierId: userId,
            receiptId,
            time: Date.now(),
            money: body.money,
            paymentMethodId: body.paymentMethodId,
            note: '',
            description: '',
        });
        return { data: { receipt, payment } };
    }
    async close(params) {
        const { oid, userId, receiptId } = params;
        const { receipt, payment } = await this.receiptPaymentAndCloseOperation.paymentAndClose({
            oid,
            cashierId: userId,
            receiptId,
            time: Date.now(),
            paymentMethodId: 0,
            money: 0,
            note: '',
            description: '',
        });
        return { data: { receipt, payment } };
    }
    async payDebt(params) {
        const { oid, userId, receiptId, body } = params;
        try {
            const { distributor, receipt, payment } = await this.receiptPayDebtOperation.payDebt({
                oid,
                cashierId: userId,
                receiptId,
                time: Date.now(),
                paymentMethodId: body.paymentMethodId,
                money: body.money,
            });
            if (distributor) {
                this.socketEmitService.distributorUpsert(oid, { distributor });
            }
            return { data: { receipt, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async terminate(params) {
        const { oid, userId, receiptId } = params;
        const time = Date.now();
        const receiptOrigin = await this.receiptRepository.findOneBy({ oid, id: receiptId });
        if ([receipt_entity_1.ReceiptStatus.Completed, receipt_entity_1.ReceiptStatus.Debt].includes(receiptOrigin.status)) {
            await this.receiptReopenOperation.reopen({
                oid,
                cashierId: userId,
                time,
                receiptId,
                paymentMethodId: 0,
                newPaid: 0,
                description: 'Hủy phiếu',
                note: '',
            });
        }
        if ([receipt_entity_1.ReceiptStatus.Deposited, receipt_entity_1.ReceiptStatus.Executing].includes(receiptOrigin.status)) {
            if (receiptOrigin.paid > 0) {
                await this.receiptRefundOverpaidOperation.refundOverpaid({
                    oid,
                    cashierId: userId,
                    time,
                    receiptId,
                    paymentMethodId: 0,
                    money: receiptOrigin.paid,
                    description: 'Hủy phiếu',
                    note: '',
                });
            }
        }
        if (receiptOrigin.deliveryStatus === variable_1.DeliveryStatus.Delivered) {
            await this.receiptReturnProductOperation.returnAllProduct({
                oid,
                receiptId,
                time: Date.now(),
            });
        }
        const receipt = await this.receiptRepository.updateOneAndReturnEntity({ oid, id: receiptId, deliveryStatus: variable_1.DeliveryStatus.Pending, paid: 0 }, { status: receipt_entity_1.ReceiptStatus.Cancelled });
        const paymentList = await this.paymentRepository.findMany({
            condition: {
                oid,
                voucherType: payment_entity_1.VoucherType.Receipt,
                voucherId: receiptId,
            },
            sort: { id: 'ASC' },
        });
        return { data: { receipt, paymentList } };
    }
};
exports.ApiReceiptAction = ApiReceiptAction;
exports.ApiReceiptAction = ApiReceiptAction = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof receipt_repository_1.ReceiptRepository !== "undefined" && receipt_repository_1.ReceiptRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.ReceiptRefundOverpaidOperation !== "undefined" && operations_1.ReceiptRefundOverpaidOperation) === "function" ? _c : Object, typeof (_d = typeof operations_1.ReceiptPayDebtOperation !== "undefined" && operations_1.ReceiptPayDebtOperation) === "function" ? _d : Object, typeof (_e = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _e : Object, typeof (_f = typeof operations_1.ReceiptSendProductOperation !== "undefined" && operations_1.ReceiptSendProductOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.ReceiptPaymentAndCloseOperation !== "undefined" && operations_1.ReceiptPaymentAndCloseOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.ReceiptPrepaymentOperation !== "undefined" && operations_1.ReceiptPrepaymentOperation) === "function" ? _h : Object, typeof (_j = typeof operations_1.ReceiptReturnProductOperation !== "undefined" && operations_1.ReceiptReturnProductOperation) === "function" ? _j : Object, typeof (_k = typeof operations_1.ReceiptReopenOperation !== "undefined" && operations_1.ReceiptReopenOperation) === "function" ? _k : Object])
], ApiReceiptAction);


/***/ }),
/* 495 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiReceiptController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(488);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_receipt_action_1 = __webpack_require__(494);
const api_receipt_service_1 = __webpack_require__(278);
const request_1 = __webpack_require__(496);
let ApiReceiptController = class ApiReceiptController {
    constructor(apiReceiptService, apiReceiptAction) {
        this.apiReceiptService = apiReceiptService;
        this.apiReceiptAction = apiReceiptAction;
    }
    async pagination({ oid }, query) {
        return await this.apiReceiptService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiReceiptService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiReceiptService.getOne(oid, id, query);
    }
    async createDraft({ oid }, body) {
        return await this.apiReceiptService.createDraft({ oid, body });
    }
    async updateDraft({ oid }, { id }, body) {
        return await this.apiReceiptService.updateDraft({
            oid,
            receiptId: id,
            body,
        });
    }
    async depositedUpdate({ oid }, { id }, body) {
        return await this.apiReceiptService.depositedUpdate({
            oid,
            receiptId: id,
            body,
        });
    }
    async draftDestroy({ oid }, { id }) {
        return await this.apiReceiptAction.destroy({
            oid,
            receiptId: id,
        });
    }
    async depositedDestroy({ oid }, { id }) {
        return await this.apiReceiptAction.destroy({
            oid,
            receiptId: id,
        });
    }
    async cancelledDestroy({ oid }, { id }) {
        return await this.apiReceiptAction.destroy({
            oid,
            receiptId: id,
        });
    }
    async sendProductAndPaymentAndClose({ oid, uid }, { id }, body) {
        return await this.apiReceiptAction.sendProductAndPaymentAndClose({
            oid,
            userId: uid,
            receiptId: id,
            body,
        });
    }
    async prepayment({ oid, uid }, { id }, body) {
        return await this.apiReceiptAction.prepayment({
            userId: uid,
            oid,
            receiptId: id,
            body,
        });
    }
    async sendProduct({ oid, uid }, { id }) {
        return await this.apiReceiptAction.sendProduct({
            oid,
            userId: uid,
            receiptId: id,
        });
    }
    async close({ oid, uid }, { id }) {
        return await this.apiReceiptAction.close({
            oid,
            userId: uid,
            receiptId: id,
        });
    }
    async refundOverpaid({ oid, uid }, { id }, body) {
        return await this.apiReceiptAction.refundOverpaid({
            oid,
            userId: uid,
            receiptId: id,
            body,
        });
    }
    async payDebt({ oid, uid }, { id }, body) {
        return await this.apiReceiptAction.payDebt({
            oid,
            userId: uid,
            receiptId: id,
            body,
        });
    }
    async terminate({ oid, uid }, { id }) {
        return await this.apiReceiptAction.terminate({
            oid,
            userId: uid,
            receiptId: id,
        });
    }
};
exports.ApiReceiptController = ApiReceiptController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, typeof (_d = typeof request_1.ReceiptPaginationQuery !== "undefined" && request_1.ReceiptPaginationQuery) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.ReceiptGetManyQuery !== "undefined" && request_1.ReceiptGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('/:id/detail'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _h : Object, typeof (_j = typeof request_1.ReceiptGetOneQuery !== "undefined" && request_1.ReceiptGetOneQuery) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create-draft'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ReceiptUpsertDraftBody !== "undefined" && request_1.ReceiptUpsertDraftBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "createDraft", null);
__decorate([
    (0, common_1.Patch)('/:id/update-draft'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.ReceiptUpsertDraftBody !== "undefined" && request_1.ReceiptUpsertDraftBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "updateDraft", null);
__decorate([
    (0, common_1.Patch)('/:id/deposited-update'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_DEPOSITED_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.ReceiptUpdateDepositedBody !== "undefined" && request_1.ReceiptUpdateDepositedBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "depositedUpdate", null);
__decorate([
    (0, common_1.Delete)('/:id/draft-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _u : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/deposited-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_DEPOSITED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_v = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _v : Object, typeof (_w = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _w : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "depositedDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/cancelled-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_CANCELLED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _y : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "cancelledDestroy", null);
__decorate([
    (0, common_1.Post)('/:id/send-product-and-payment-and-close'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_SEND_PRODUCT, permission_entity_1.PermissionId.RECEIPT_PAYMENT, permission_entity_1.PermissionId.RECEIPT_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_z = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _z : Object, typeof (_0 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _0 : Object, typeof (_1 = typeof request_1.ReceiptPaymentMoneyBody !== "undefined" && request_1.ReceiptPaymentMoneyBody) === "function" ? _1 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "sendProductAndPaymentAndClose", null);
__decorate([
    (0, common_1.Post)('/:id/prepayment'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_2 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _2 : Object, typeof (_3 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _3 : Object, typeof (_4 = typeof request_1.ReceiptPaymentMoneyBody !== "undefined" && request_1.ReceiptPaymentMoneyBody) === "function" ? _4 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "prepayment", null);
__decorate([
    (0, common_1.Post)('/:id/send-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_5 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _5 : Object, typeof (_6 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _6 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "sendProduct", null);
__decorate([
    (0, common_1.Post)('/:id/close'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_7 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _7 : Object, typeof (_8 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _8 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "close", null);
__decorate([
    (0, common_1.Post)('/:id/refund-overpaid'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_REFUND_OVERPAID),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_9 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _9 : Object, typeof (_10 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _10 : Object, typeof (_11 = typeof request_1.ReceiptPaymentMoneyBody !== "undefined" && request_1.ReceiptPaymentMoneyBody) === "function" ? _11 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "refundOverpaid", null);
__decorate([
    (0, common_1.Post)('/:id/pay-debt'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_12 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _12 : Object, typeof (_13 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _13 : Object, typeof (_14 = typeof request_1.ReceiptPaymentMoneyBody !== "undefined" && request_1.ReceiptPaymentMoneyBody) === "function" ? _14 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "payDebt", null);
__decorate([
    (0, common_1.Post)('/:id/terminate'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.RECEIPT_TERMINATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_15 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _15 : Object, typeof (_16 = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _16 : Object]),
    __metadata("design:returntype", Promise)
], ApiReceiptController.prototype, "terminate", null);
exports.ApiReceiptController = ApiReceiptController = __decorate([
    (0, swagger_1.ApiTags)('Receipt'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('receipt'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_receipt_service_1.ApiReceiptService !== "undefined" && api_receipt_service_1.ApiReceiptService) === "function" ? _a : Object, typeof (_b = typeof api_receipt_action_1.ApiReceiptAction !== "undefined" && api_receipt_action_1.ApiReceiptAction) === "function" ? _b : Object])
], ApiReceiptController);


/***/ }),
/* 496 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(497), exports);
__exportStar(__webpack_require__(499), exports);
__exportStar(__webpack_require__(498), exports);
__exportStar(__webpack_require__(500), exports);
__exportStar(__webpack_require__(501), exports);


/***/ }),
/* 497 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptGetOneQuery = exports.ReceiptGetManyQuery = exports.ReceiptPaginationQuery = exports.ReceiptGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const receipt_options_request_1 = __webpack_require__(498);
class ReceiptGetQuery {
}
exports.ReceiptGetQuery = ReceiptGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            distributor: true,
            receiptItemList: { product: true, batch: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_options_request_1.ReceiptRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof receipt_options_request_1.ReceiptRelationQuery !== "undefined" && receipt_options_request_1.ReceiptRelationQuery) === "function" ? _a : Object)
], ReceiptGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ distributorId: 33 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_options_request_1.ReceiptFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof receipt_options_request_1.ReceiptFilterQuery !== "undefined" && receipt_options_request_1.ReceiptFilterQuery) === "function" ? _b : Object)
], ReceiptGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'ASC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(receipt_options_request_1.ReceiptSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof receipt_options_request_1.ReceiptSortQuery !== "undefined" && receipt_options_request_1.ReceiptSortQuery) === "function" ? _c : Object)
], ReceiptGetQuery.prototype, "sort", void 0);
class ReceiptPaginationQuery extends (0, swagger_1.IntersectionType)(ReceiptGetQuery, query_1.PaginationQuery) {
}
exports.ReceiptPaginationQuery = ReceiptPaginationQuery;
class ReceiptGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ReceiptGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ReceiptGetManyQuery = ReceiptGetManyQuery;
class ReceiptGetOneQuery extends (0, swagger_1.PickType)(ReceiptGetQuery, ['relation']) {
}
exports.ReceiptGetOneQuery = ReceiptGetOneQuery;


/***/ }),
/* 498 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptSortQuery = exports.ReceiptFilterQuery = exports.ReceiptRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const receipt_entity_1 = __webpack_require__(51);
class ReceiptRelationQuery {
}
exports.ReceiptRelationQuery = ReceiptRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ReceiptRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ReceiptRelationQuery.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ReceiptRelationQuery.prototype, "receiptItemList", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(receipt_entity_1.ReceiptStatus);
class ReceiptFilterQuery {
}
exports.ReceiptFilterQuery = ReceiptFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, receipt_entity_1.ReceiptStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ReceiptFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _c : Object)
], ReceiptFilterQuery.prototype, "startedAt", void 0);
class ReceiptSortQuery extends query_1.SortQuery {
}
exports.ReceiptSortQuery = ReceiptSortQuery;


/***/ }),
/* 499 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptItemBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class ReceiptItemBody {
}
exports.ReceiptItemBody = ReceiptItemBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ReceiptItemBody.prototype, "batchCode", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "expiryDate", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptItemBody.prototype, "listPrice", void 0);


/***/ }),
/* 500 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptPaymentMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class ReceiptPaymentMoneyBody {
}
exports.ReceiptPaymentMoneyBody = ReceiptPaymentMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptPaymentMoneyBody.prototype, "money", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ReceiptPaymentMoneyBody.prototype, "paymentMethodId", void 0);


/***/ }),
/* 501 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReceiptUpdateDepositedBody = exports.ReceiptUpsertDraftBody = exports.ReceiptUpsert = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const receipt_item_body_1 = __webpack_require__(499);
class ReceiptUpsert {
}
exports.ReceiptUpsert = ReceiptUpsert;
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "startedAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 80000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.DiscountType, example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], ReceiptUpsert.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "surcharge", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ReceiptUpsert.prototype, "totalMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ReceiptUpsert.prototype, "note", void 0);
class ReceiptUpsertDraftBody {
}
exports.ReceiptUpsertDraftBody = ReceiptUpsertDraftBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReceiptUpsertDraftBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ReceiptUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ReceiptUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", ReceiptUpsert)
], ReceiptUpsertDraftBody.prototype, "receipt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: receipt_item_body_1.ReceiptItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => receipt_item_body_1.ReceiptItemBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ReceiptUpsertDraftBody.prototype, "receiptItemList", void 0);
class ReceiptUpdateDepositedBody extends ReceiptUpsertDraftBody {
}
exports.ReceiptUpdateDepositedBody = ReceiptUpdateDepositedBody;


/***/ }),
/* 502 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleModule = void 0;
const common_1 = __webpack_require__(3);
const api_role_controller_1 = __webpack_require__(503);
const api_role_service_1 = __webpack_require__(504);
let ApiRoleModule = class ApiRoleModule {
};
exports.ApiRoleModule = ApiRoleModule;
exports.ApiRoleModule = ApiRoleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_role_controller_1.ApiRoleController],
        providers: [api_role_service_1.ApiRoleService],
    })
], ApiRoleModule);


/***/ }),
/* 503 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_role_service_1 = __webpack_require__(504);
const request_1 = __webpack_require__(505);
let ApiRoleController = class ApiRoleController {
    constructor(apiRoleService) {
        this.apiRoleService = apiRoleService;
    }
    pagination({ oid }, query) {
        return this.apiRoleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiRoleService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiRoleService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiRoleService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiRoleService.updateOne(oid, +id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRoleService.destroyOne(oid, id);
    }
};
exports.ApiRoleController = ApiRoleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RolePaginationQuery !== "undefined" && request_1.RolePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRoleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RoleGetManyQuery !== "undefined" && request_1.RoleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiRoleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.RoleGetOneQuery !== "undefined" && request_1.RoleGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ROLE_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RoleCreateBody !== "undefined" && request_1.RoleCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ROLE_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.RoleUpdateBody !== "undefined" && request_1.RoleUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ROLE_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "destroyOne", null);
exports.ApiRoleController = ApiRoleController = __decorate([
    (0, swagger_1.ApiTags)('Role'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('role'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_role_service_1.ApiRoleService !== "undefined" && api_role_service_1.ApiRoleService) === "function" ? _a : Object])
], ApiRoleController);


/***/ }),
/* 504 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(170);
let ApiRoleService = class ApiRoleService {
    constructor(roleRepository, userRepository, userRoleRepository, cacheDataService) {
        this.roleRepository = roleRepository;
        this.userRepository = userRepository;
        this.userRoleRepository = userRoleRepository;
        this.cacheDataService = cacheDataService;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.roleRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.roleRepository.findMany({
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const role = await this.roleRepository.findOne({
            relation: query.relation,
            condition: { oid, id },
        });
        if (!role)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { role } };
    }
    async createOne(oid, body) {
        const { userIdList } = body, other = __rest(body, ["userIdList"]);
        const role = await this.roleRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, other), { oid }));
        if (userIdList.length) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            role.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(userIdList.map((i) => ({
                oid,
                roleId: role.id,
                userId: i,
            })));
        }
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { role } };
    }
    async updateOne(oid, roleId, body) {
        const { userIdList } = body, other = __rest(body, ["userIdList"]);
        const [role] = await this.roleRepository.updateAndReturnEntity({ oid, id: roleId }, other);
        if (!role) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        await this.userRoleRepository.delete({ oid, roleId });
        if (userIdList.length) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            role.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(userIdList.map((i) => ({
                oid,
                roleId: role.id,
                userId: i,
            })));
        }
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { role } };
    }
    async destroyOne(oid, roleId) {
        const affected = await this.roleRepository.delete({ oid, id: roleId });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        await this.userRoleRepository.delete({ oid, roleId });
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { roleId } };
    }
};
exports.ApiRoleService = ApiRoleService;
exports.ApiRoleService = ApiRoleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RoleRepository !== "undefined" && repositories_1.RoleRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _c : Object, typeof (_d = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _d : Object])
], ApiRoleService);


/***/ }),
/* 505 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(506), exports);
__exportStar(__webpack_require__(507), exports);
__exportStar(__webpack_require__(508), exports);


/***/ }),
/* 506 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleGetOneQuery = exports.RoleGetManyQuery = exports.RolePaginationQuery = exports.RoleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const role_options_request_1 = __webpack_require__(507);
class RoleGetQuery {
}
exports.RoleGetQuery = RoleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof role_options_request_1.RoleRelationQuery !== "undefined" && role_options_request_1.RoleRelationQuery) === "function" ? _a : Object)
], RoleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            isActive: 1,
            updatedAt: { GT: Date.now() },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof role_options_request_1.RoleFilterQuery !== "undefined" && role_options_request_1.RoleFilterQuery) === "function" ? _b : Object)
], RoleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            code: 'DESC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof role_options_request_1.RoleSortQuery !== "undefined" && role_options_request_1.RoleSortQuery) === "function" ? _c : Object)
], RoleGetQuery.prototype, "sort", void 0);
class RolePaginationQuery extends (0, swagger_1.IntersectionType)(RoleGetQuery, query_1.PaginationQuery) {
}
exports.RolePaginationQuery = RolePaginationQuery;
class RoleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RoleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RoleGetManyQuery = RoleGetManyQuery;
class RoleGetOneQuery extends (0, swagger_1.PickType)(RoleGetQuery, ['relation']) {
}
exports.RoleGetOneQuery = RoleGetOneQuery;


/***/ }),
/* 507 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleSortQuery = exports.RoleFilterQuery = exports.RoleRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class RoleRelationQuery {
}
exports.RoleRelationQuery = RoleRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], RoleRelationQuery.prototype, "userRoleList", void 0);
class RoleFilterQuery {
}
exports.RoleFilterQuery = RoleFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RoleFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], RoleFilterQuery.prototype, "updatedAt", void 0);
class RoleSortQuery extends query_1.SortQuery {
}
exports.RoleSortQuery = RoleSortQuery;


/***/ }),
/* 508 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleUpdateBody = exports.RoleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class RoleCreateBody {
}
exports.RoleCreateBody = RoleCreateBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'DOCTOR' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "roleCode", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Bác sĩ' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: '[{"name":"Viên","rate":1}]' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (typeof i !== 'number' || i <= 0) {
                    err.push(i + ' is not number');
                }
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: 'Validate permissions failed: Example: ' + JSON.stringify([4, 5, 6]) }),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "permissionIds", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RoleCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RoleCreateBody.prototype, "userIdList", void 0);
class RoleUpdateBody extends RoleCreateBody {
}
exports.RoleUpdateBody = RoleUpdateBody;


/***/ }),
/* 509 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingModule = void 0;
const common_1 = __webpack_require__(3);
const google_driver_module_1 = __webpack_require__(230);
const api_setting_google_driver_service_1 = __webpack_require__(510);
const api_setting_controller_1 = __webpack_require__(511);
const api_setting_service_1 = __webpack_require__(512);
let ApiSettingModule = class ApiSettingModule {
};
exports.ApiSettingModule = ApiSettingModule;
exports.ApiSettingModule = ApiSettingModule = __decorate([
    (0, common_1.Module)({
        imports: [google_driver_module_1.GoogleDriverModule],
        controllers: [api_setting_controller_1.ApiSettingController],
        providers: [api_setting_service_1.ApiSettingService, api_setting_google_driver_service_1.ApiSettingGoogleDriverService],
    })
], ApiSettingModule);


/***/ }),
/* 510 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingGoogleDriverService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const setting_entity_1 = __webpack_require__(40);
const setting_repository_1 = __webpack_require__(88);
const google_driver_service_1 = __webpack_require__(232);
const socket_emit_service_1 = __webpack_require__(306);
let ApiSettingGoogleDriverService = class ApiSettingGoogleDriverService {
    constructor(googleDriverService, cacheDataService, socketEmitService, settingRepository) {
        this.googleDriverService = googleDriverService;
        this.cacheDataService = cacheDataService;
        this.socketEmitService = socketEmitService;
        this.settingRepository = settingRepository;
    }
    async getAuthUrl(options) {
        const { url } = await this.googleDriverService.getAuthUrl({ state: options.state });
        return { data: { url } };
    }
    async logout(oid) {
        const setting = await this.settingRepository.findOneBy({
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
            oid,
        });
        if (!setting)
            return;
        const { email } = JSON.parse(setting.data);
        await this.googleDriverService.logout(email);
        await this.settingRepository.delete({ id: setting.id });
        await this.cacheDataService.reloadSettingMap(oid);
        return { data: true };
    }
    async loginCallback(query) {
        const { oid, email, refreshToken } = await this.googleDriverService.loginCallback(query);
        await this.settingRepository.upsertSetting({
            oid,
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
            data: JSON.stringify({ oid, email, refreshToken }),
        });
        await this.cacheDataService.reloadSettingMap(oid);
        this.socketEmitService.settingReload(oid);
    }
    async getAllAccounts() {
        const data = await this.settingRepository.findManyBy({
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
        });
        return { data: data.map((i) => JSON.parse(i.data)) };
    }
    async getAllFolders(email) {
        const data = await this.googleDriverService.getAllFolders(email);
        return { data };
    }
};
exports.ApiSettingGoogleDriverService = ApiSettingGoogleDriverService;
exports.ApiSettingGoogleDriverService = ApiSettingGoogleDriverService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _c : Object, typeof (_d = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _d : Object])
], ApiSettingGoogleDriverService);


/***/ }),
/* 511 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const fastify_1 = __webpack_require__(390);
const permission_guard_1 = __webpack_require__(93);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_setting_google_driver_service_1 = __webpack_require__(510);
const api_setting_service_1 = __webpack_require__(512);
const setting_upsert_request_1 = __webpack_require__(513);
let ApiSettingController = class ApiSettingController {
    constructor(apiSettingService, apiSettingGoogleDriverService) {
        this.apiSettingService = apiSettingService;
        this.apiSettingGoogleDriverService = apiSettingGoogleDriverService;
    }
    async getMap({ oid }) {
        return await this.apiSettingService.getMap(oid);
    }
    async upsert({ oid }, { type }, body) {
        await this.apiSettingService.upsert(oid, type, body);
        return { success: true };
    }
    async getAuthUrl({ oid }) {
        return this.apiSettingGoogleDriverService.getAuthUrl({ state: `${oid}` });
    }
    async authLogout({ oid }) {
        return this.apiSettingGoogleDriverService.logout(oid);
    }
    async authCallback(query, reply) {
        await this.apiSettingGoogleDriverService.loginCallback(query);
        return reply.type('text/html').send(`<script>window.close();</script>`);
    }
    async getAllFolders() {
        return await this.apiSettingGoogleDriverService.getAllFolders('');
    }
    async getAllAccounts() {
        return await this.apiSettingGoogleDriverService.getAllAccounts();
    }
};
exports.ApiSettingController = ApiSettingController;
__decorate([
    (0, common_1.Get)('get-map'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getMap", null);
__decorate([
    (0, common_1.Post)('upsert/:type'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof setting_upsert_request_1.SettingUpsertParams !== "undefined" && setting_upsert_request_1.SettingUpsertParams) === "function" ? _e : Object, typeof (_f = typeof setting_upsert_request_1.SettingUpsertBody !== "undefined" && setting_upsert_request_1.SettingUpsertBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "upsert", null);
__decorate([
    (0, common_1.Get)('google-driver/get-auth-url'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAuthUrl", null);
__decorate([
    (0, common_1.Post)('google-driver/logout'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "authLogout", null);
__decorate([
    (0, common_1.Get)('google-driver/login-callback'),
    __param(0, (0, common_1.Query)()),
    __param(1, (0, common_1.Res)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_j = typeof fastify_1.FastifyReply !== "undefined" && fastify_1.FastifyReply) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "authCallback", null);
__decorate([
    (0, common_1.Get)('google-driver/get-all-folders'),
    (0, user_guard_1.IsUser)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAllFolders", null);
__decorate([
    (0, common_1.Get)('google-driver/get-all-accounts'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAllAccounts", null);
exports.ApiSettingController = ApiSettingController = __decorate([
    (0, swagger_1.ApiTags)('Setting'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('setting'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_setting_service_1.ApiSettingService !== "undefined" && api_setting_service_1.ApiSettingService) === "function" ? _a : Object, typeof (_b = typeof api_setting_google_driver_service_1.ApiSettingGoogleDriverService !== "undefined" && api_setting_google_driver_service_1.ApiSettingGoogleDriverService) === "function" ? _b : Object])
], ApiSettingController);


/***/ }),
/* 512 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const setting_repository_1 = __webpack_require__(88);
const socket_emit_service_1 = __webpack_require__(306);
let ApiSettingService = class ApiSettingService {
    constructor(cacheDataService, socketEmitService, settingRepository) {
        this.cacheDataService = cacheDataService;
        this.socketEmitService = socketEmitService;
        this.settingRepository = settingRepository;
    }
    async getMap(oid) {
        const settingMap = await this.cacheDataService.getSettingMap(oid);
        return { data: { settingMap } };
    }
    async upsert(oid, key, body) {
        const data = await this.settingRepository.upsertSetting({
            oid,
            key,
            data: body.data,
        });
        await this.cacheDataService.reloadSettingMap(oid);
        this.socketEmitService.settingReload(oid);
        return { data };
    }
};
exports.ApiSettingService = ApiSettingService;
exports.ApiSettingService = ApiSettingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _b : Object, typeof (_c = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _c : Object])
], ApiSettingService);


/***/ }),
/* 513 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingUpsertBody = exports.SettingUpsertParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const setting_entity_1 = __webpack_require__(40);
class SettingUpsertParams {
}
exports.SettingUpsertParams = SettingUpsertParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: setting_entity_1.SettingKey.GOOGLE_DRIVER }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", typeof (_a = typeof setting_entity_1.SettingKey !== "undefined" && setting_entity_1.SettingKey) === "function" ? _a : Object)
], SettingUpsertParams.prototype, "type", void 0);
class SettingUpsertBody {
}
exports.SettingUpsertBody = SettingUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], SettingUpsertBody.prototype, "data", void 0);


/***/ }),
/* 514 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticModule = void 0;
const common_1 = __webpack_require__(3);
const api_statistic_laboratory_service_1 = __webpack_require__(515);
const api_statistic_radiology_service_1 = __webpack_require__(516);
const api_statistic_receipt_service_1 = __webpack_require__(517);
const api_statistic_ticket_service_1 = __webpack_require__(518);
const api_statistic_controller_1 = __webpack_require__(519);
const api_statistic_service_1 = __webpack_require__(520);
let ApiStatisticModule = class ApiStatisticModule {
};
exports.ApiStatisticModule = ApiStatisticModule;
exports.ApiStatisticModule = ApiStatisticModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_statistic_controller_1.ApiStatisticController],
        providers: [
            api_statistic_service_1.ApiStatisticService,
            api_statistic_receipt_service_1.ApiStatisticReceiptService,
            api_statistic_ticket_service_1.ApiStatisticTicketService,
            api_statistic_laboratory_service_1.ApiStatisticLaboratoryService,
            api_statistic_radiology_service_1.ApiStatisticRadiologyService,
        ],
    })
], ApiStatisticModule);


/***/ }),
/* 515 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(170);
let ApiStatisticLaboratoryService = class ApiStatisticLaboratoryService {
    constructor(ticketLaboratoryRepository) {
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
    }
    async sumMoney(oid, query) {
        const { fromTime, toTime } = query;
        const data = await this.ticketLaboratoryRepository.sumMoney({
            oid,
            fromTime,
            toTime,
        });
        return { data };
    }
};
exports.ApiStatisticLaboratoryService = ApiStatisticLaboratoryService;
exports.ApiStatisticLaboratoryService = ApiStatisticLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _a : Object])
], ApiStatisticLaboratoryService);


/***/ }),
/* 516 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(170);
let ApiStatisticRadiologyService = class ApiStatisticRadiologyService {
    constructor(ticketRadiologyRepository) {
        this.ticketRadiologyRepository = ticketRadiologyRepository;
    }
    async sumMoney(oid, query) {
        const { fromTime, toTime } = query;
        const data = await this.ticketRadiologyRepository.sumMoney({
            oid,
            fromTime,
            toTime,
        });
        return { data };
    }
};
exports.ApiStatisticRadiologyService = ApiStatisticRadiologyService;
exports.ApiStatisticRadiologyService = ApiStatisticRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _a : Object])
], ApiStatisticRadiologyService);


/***/ }),
/* 517 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticReceiptService = void 0;
const common_1 = __webpack_require__(3);
const time_helper_1 = __webpack_require__(146);
const statistic_receipt_operation_1 = __webpack_require__(158);
let ApiStatisticReceiptService = class ApiStatisticReceiptService {
    constructor(statisticReceiptOperation) {
        this.statisticReceiptOperation = statisticReceiptOperation;
    }
    async statisticReceipt(oid, query) {
        const { fromTime, toTime, timeType } = query;
        const data = await this.statisticReceiptOperation.statisticReceipt({
            oid,
            fromTime,
            toTime,
            timeType,
        });
        const dataMap = {};
        const date = new Date(fromTime.getTime());
        do {
            const currentTime = time_helper_1.ESTimer.info(date, 7);
            let time = '';
            if (timeType === 'date') {
                time = time_helper_1.ESTimer.timeToText(date, 'DD/MM/YYYY', 7);
                date.setDate(date.getDate() + 1);
            }
            if (timeType === 'month') {
                time = time_helper_1.ESTimer.timeToText(date, 'MM/YYYY', 7);
                date.setMonth(date.getMonth() + 1);
            }
            dataMap[time] = {
                oid,
                year: currentTime.year,
                month: currentTime.month + 1,
                date: currentTime.date,
                sumDiscountMoney: 0,
                sumTotalMoney: 0,
                sumDebt: 0,
                countReceipt: 0,
            };
        } while (date.getTime() <= toTime.getTime());
        data.forEach((i) => {
            const year = i.year;
            const month = `0${i.month}`.slice(-2);
            const date = `0${i.date}`.slice(-2);
            let time = '';
            if (timeType === 'date')
                time = `${date}/${month}/${year}`;
            if (timeType === 'month')
                time = `${month}/${year}`;
            dataMap[time] = i;
        });
        return { data: dataMap };
    }
};
exports.ApiStatisticReceiptService = ApiStatisticReceiptService;
exports.ApiStatisticReceiptService = ApiStatisticReceiptService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_receipt_operation_1.StatisticReceiptOperation !== "undefined" && statistic_receipt_operation_1.StatisticReceiptOperation) === "function" ? _a : Object])
], ApiStatisticReceiptService);


/***/ }),
/* 518 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticTicketService = void 0;
const common_1 = __webpack_require__(3);
const time_helper_1 = __webpack_require__(146);
const ticket_statistic_operation_1 = __webpack_require__(169);
let ApiStatisticTicketService = class ApiStatisticTicketService {
    constructor(ticketStatisticOperation) {
        this.ticketStatisticOperation = ticketStatisticOperation;
    }
    async statisticTicket(oid, query) {
        const { filter, groupTimeType, fromTime, toTime } = query;
        const data = await this.ticketStatisticOperation.statistic({
            condition: {
                oid,
                registeredAt: {
                    GTE: fromTime.getTime(),
                    LTE: toTime.getTime(),
                },
                ticketType: filter.ticketType,
                status: filter.status,
            },
            groupTimeType,
        });
        const dataMap = {};
        const date = new Date(fromTime.getTime());
        do {
            const currentTime = time_helper_1.ESTimer.info(date, 7);
            let time = '';
            if (groupTimeType === 'date') {
                time = time_helper_1.ESTimer.timeToText(date, 'DD/MM/YYYY', 7);
                date.setDate(date.getDate() + 1);
            }
            if (groupTimeType === 'month') {
                time = time_helper_1.ESTimer.timeToText(date, 'MM/YYYY', 7);
                date.setMonth(date.getMonth() + 1);
            }
            dataMap[time] = {
                oid,
                year: currentTime.year,
                month: currentTime.month + 1,
                date: currentTime.date,
                sumItemsCostAmount: 0,
                sumProcedureMoney: 0,
                sumProductMoney: 0,
                sumRadiologyMoney: 0,
                sumLaboratoryMoney: 0,
                sumSurcharge: 0,
                sumExpense: 0,
                sumDiscountMoney: 0,
                sumTotalMoney: 0,
                sumProfit: 0,
                sumDebt: 0,
                countTicket: 0,
            };
        } while (date.getTime() <= toTime.getTime());
        data.forEach((i) => {
            const year = i.year;
            const month = `0${i.month}`.slice(-2);
            const date = `0${i.date}`.slice(-2);
            let time = '';
            if (groupTimeType === 'date')
                time = `${date}/${month}/${year}`;
            if (groupTimeType === 'month')
                time = `${month}/${year}`;
            dataMap[time] = Object.assign(Object.assign({}, i), { oid });
        });
        return { data: dataMap };
    }
};
exports.ApiStatisticTicketService = ApiStatisticTicketService;
exports.ApiStatisticTicketService = ApiStatisticTicketService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_statistic_operation_1.TicketStatisticOperation !== "undefined" && ticket_statistic_operation_1.TicketStatisticOperation) === "function" ? _a : Object])
], ApiStatisticTicketService);


/***/ }),
/* 519 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_statistic_laboratory_service_1 = __webpack_require__(515);
const api_statistic_radiology_service_1 = __webpack_require__(516);
const api_statistic_ticket_service_1 = __webpack_require__(518);
const api_statistic_service_1 = __webpack_require__(520);
const request_1 = __webpack_require__(521);
let ApiStatisticController = class ApiStatisticController {
    constructor(apiStatisticService, apiStatisticTicketService, apiStatisticLaboratoryService, apiStatisticRadiologyService) {
        this.apiStatisticService = apiStatisticService;
        this.apiStatisticTicketService = apiStatisticTicketService;
        this.apiStatisticLaboratoryService = apiStatisticLaboratoryService;
        this.apiStatisticRadiologyService = apiStatisticRadiologyService;
    }
    async sumWarehouse({ oid }) {
        return await this.apiStatisticService.sumWarehouse(oid);
    }
    async topProductBestSelling({ oid }, query) {
        return await this.apiStatisticService.topProductBestSelling(oid, query);
    }
    async topProductHighSumRetailMoney({ oid }, query) {
        return await this.apiStatisticService.topProductHighMoney(oid, query);
    }
    async topProcedureBestSelling({ oid }, query) {
        return await this.apiStatisticService.topProcedureBestSelling(oid, query);
    }
    async topCustomerBestTicket({ oid }, query) {
        return await this.apiStatisticService.topCustomerBestTicket(oid, query);
    }
    sumCustomerDebt({ oid }) {
        return this.apiStatisticService.sumCustomerDebt(oid);
    }
    async statisticTicket({ oid }, query) {
        return await this.apiStatisticTicketService.statisticTicket(oid, query);
    }
    async sumMoneyTicketLaboratory({ oid }, query) {
        return await this.apiStatisticLaboratoryService.sumMoney(oid, query);
    }
    async sumMoneyTicketRadiology({ oid }, query) {
        return await this.apiStatisticRadiologyService.sumMoney(oid, query);
    }
};
exports.ApiStatisticController = ApiStatisticController;
__decorate([
    (0, common_1.Get)('sum-warehouse'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "sumWarehouse", null);
__decorate([
    (0, common_1.Get)('top-product-best-selling'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.StatisticTopBestSellingQuery !== "undefined" && request_1.StatisticTopBestSellingQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "topProductBestSelling", null);
__decorate([
    (0, common_1.Get)('top-product-high-money'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.StatisticProductHighMoneyQuery !== "undefined" && request_1.StatisticProductHighMoneyQuery) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "topProductHighSumRetailMoney", null);
__decorate([
    (0, common_1.Get)('top-procedure-best-selling'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.StatisticTopBestSellingQuery !== "undefined" && request_1.StatisticTopBestSellingQuery) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "topProcedureBestSelling", null);
__decorate([
    (0, common_1.Get)('top-customer-best-ticket'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.StatisticTopCustomerBestTicketQuery !== "undefined" && request_1.StatisticTopCustomerBestTicketQuery) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "topCustomerBestTicket", null);
__decorate([
    (0, common_1.Get)('sum-customer-debt'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object]),
    __metadata("design:returntype", void 0)
], ApiStatisticController.prototype, "sumCustomerDebt", null);
__decorate([
    (0, common_1.Get)('statistic-ticket'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_TICKET),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.StatisticTicketQuery !== "undefined" && request_1.StatisticTicketQuery) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "statisticTicket", null);
__decorate([
    (0, common_1.Get)('ticket-laboratory/sum-money'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_1.StatisticTimeQuery !== "undefined" && request_1.StatisticTimeQuery) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "sumMoneyTicketLaboratory", null);
__decorate([
    (0, common_1.Get)('ticket-radiology/sum-money'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STATISTIC_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof request_1.StatisticTimeQuery !== "undefined" && request_1.StatisticTimeQuery) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiStatisticController.prototype, "sumMoneyTicketRadiology", null);
exports.ApiStatisticController = ApiStatisticController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_statistic_service_1.ApiStatisticService !== "undefined" && api_statistic_service_1.ApiStatisticService) === "function" ? _a : Object, typeof (_b = typeof api_statistic_ticket_service_1.ApiStatisticTicketService !== "undefined" && api_statistic_ticket_service_1.ApiStatisticTicketService) === "function" ? _b : Object, typeof (_c = typeof api_statistic_laboratory_service_1.ApiStatisticLaboratoryService !== "undefined" && api_statistic_laboratory_service_1.ApiStatisticLaboratoryService) === "function" ? _c : Object, typeof (_d = typeof api_statistic_radiology_service_1.ApiStatisticRadiologyService !== "undefined" && api_statistic_radiology_service_1.ApiStatisticRadiologyService) === "function" ? _d : Object])
], ApiStatisticController);


/***/ }),
/* 520 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStatisticService = void 0;
const common_1 = __webpack_require__(3);
const statistic_operation_1 = __webpack_require__(159);
const customer_repository_1 = __webpack_require__(175);
const procedure_repository_1 = __webpack_require__(186);
const product_repository_1 = __webpack_require__(189);
const ticket_procedure_repository_1 = __webpack_require__(202);
let ApiStatisticService = class ApiStatisticService {
    constructor(statisticRepository, productRepository, procedureRepository, customerRepository, ticketProcedureRepository) {
        this.statisticRepository = statisticRepository;
        this.productRepository = productRepository;
        this.procedureRepository = procedureRepository;
        this.customerRepository = customerRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async sumWarehouse(oid) {
        const data = await this.statisticRepository.sumWarehouse(oid);
        return {
            data,
        };
    }
    async topProductBestSelling(oid, query) {
        const { fromTime, toTime, orderBy, limit } = query;
        const data = await this.statisticRepository.topProductBestSelling({
            oid,
            fromTime: fromTime.getTime(),
            toTime: toTime.getTime(),
            limit,
            orderBy,
        });
        const productIds = data.map((i) => i.productId);
        const productList = await this.productRepository.findManyBy({
            oid,
            id: { IN: productIds },
        });
        const productMap = {};
        productList.forEach((i) => (productMap[i.id] = i));
        const topData = data.map((i) => ({
            productId: i.productId,
            sumQuantity: i.sumQuantity,
            sumCostAmount: i.sumCostAmount,
            sumActualAmount: i.sumActualAmount,
            sumProfitAmount: i.sumProfitAmount,
            product: productMap[i.productId],
        }));
        return { data: topData };
    }
    async topProductHighMoney(oid, query) {
        const { orderBy, limit } = query;
        const data = await this.statisticRepository.topProductHighMoney({
            oid,
            limit,
            orderBy,
        });
        return { data };
    }
    async topProcedureBestSelling(oid, query) {
        const { fromTime, toTime, orderBy, limit } = query;
        const data = await this.ticketProcedureRepository.topProcedureBestSelling({
            condition: {
                oid,
                startedAt: { GTE: fromTime.getTime(), LTE: toTime.getTime() },
            },
            orderBy,
            limit,
        });
        const procedureIds = data.map((i) => i.procedureId);
        const procedureList = await this.procedureRepository.findManyBy({
            oid,
            id: { IN: procedureIds },
        });
        const procedureMap = {};
        procedureList.forEach((i) => (procedureMap[i.id] = i));
        const topData = data.map((i) => ({
            procedureId: i.procedureId,
            sumQuantity: i.sumQuantity,
            sumActualAmount: i.sumActualAmount,
            procedure: procedureMap[i.procedureId],
        }));
        return { data: topData };
    }
    async topCustomerBestTicket(oid, query) {
        const { fromTime, toTime, orderBy, limit } = query;
        const data = await this.statisticRepository.topCustomerBestTicket({
            oid,
            fromTime,
            toTime,
            orderBy,
            limit,
        });
        const customerIds = data.map((i) => i.customerId);
        const customerList = await this.customerRepository.findManyBy({
            oid,
            id: { IN: customerIds },
        });
        const customerMap = {};
        customerList.forEach((i) => (customerMap[i.id] = i));
        const topData = data.map((i) => ({
            customerId: i.customerId,
            sumItemsCostAmount: i.sumItemsCostAmount,
            sumExpense: i.sumExpense,
            sumSurcharge: i.sumSurcharge,
            sumTotalMoney: i.sumTotalMoney,
            sumProfit: i.sumProfit,
            sumDebt: i.sumDebt,
            countTicket: i.countTicket,
            customer: customerMap[i.customerId],
        }));
        return { data: topData };
    }
    async sumCustomerDebt(oid) {
        const customerSumDebt = await this.customerRepository.sumDebt(oid);
        return { data: { customerSumDebt } };
    }
};
exports.ApiStatisticService = ApiStatisticService;
exports.ApiStatisticService = ApiStatisticService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_operation_1.StatisticOperation !== "undefined" && statistic_operation_1.StatisticOperation) === "function" ? _a : Object, typeof (_b = typeof product_repository_1.ProductRepository !== "undefined" && product_repository_1.ProductRepository) === "function" ? _b : Object, typeof (_c = typeof procedure_repository_1.ProcedureRepository !== "undefined" && procedure_repository_1.ProcedureRepository) === "function" ? _c : Object, typeof (_d = typeof customer_repository_1.CustomerRepository !== "undefined" && customer_repository_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof ticket_procedure_repository_1.TicketProcedureRepository !== "undefined" && ticket_procedure_repository_1.TicketProcedureRepository) === "function" ? _e : Object])
], ApiStatisticService);


/***/ }),
/* 521 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(522), exports);
__exportStar(__webpack_require__(523), exports);
__exportStar(__webpack_require__(524), exports);
__exportStar(__webpack_require__(525), exports);
__exportStar(__webpack_require__(526), exports);
__exportStar(__webpack_require__(527), exports);


/***/ }),
/* 522 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticMonthQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class StatisticMonthQuery {
}
exports.StatisticMonthQuery = StatisticMonthQuery;
__decorate([
    (0, swagger_1.ApiProperty)({}),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StatisticMonthQuery.prototype, "year", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({}),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Min)(1),
    (0, class_validator_1.Max)(12),
    __metadata("design:type", Number)
], StatisticMonthQuery.prototype, "month", void 0);


/***/ }),
/* 523 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const request_1 = __webpack_require__(283);
class StatisticTicketQuery extends (0, swagger_1.PickType)(request_1.TicketGetQuery, ['filter']) {
}
exports.StatisticTicketQuery = StatisticTicketQuery;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['date', 'month']),
    __metadata("design:type", String)
], StatisticTicketQuery.prototype, "groupTimeType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], StatisticTicketQuery.prototype, "fromTime", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], StatisticTicketQuery.prototype, "toTime", void 0);


/***/ }),
/* 524 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTimeQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class StatisticTimeQuery extends query_1.LimitQuery {
}
exports.StatisticTimeQuery = StatisticTimeQuery;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], StatisticTimeQuery.prototype, "fromTime", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], StatisticTimeQuery.prototype, "toTime", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['date', 'month']),
    __metadata("design:type", String)
], StatisticTimeQuery.prototype, "timeType", void 0);


/***/ }),
/* 525 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTopBestSellingQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const statistic_time_query_1 = __webpack_require__(524);
class StatisticTopBestSellingQuery extends statistic_time_query_1.StatisticTimeQuery {
}
exports.StatisticTopBestSellingQuery = StatisticTopBestSellingQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        enum: ['sumActualAmount', 'sumProfitAmount', 'sumQuantity'],
        example: 'sumQuantity',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['sumActualAmount', 'sumQuantity', 'sumProfitAmount']),
    __metadata("design:type", String)
], StatisticTopBestSellingQuery.prototype, "orderBy", void 0);


/***/ }),
/* 526 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTopCustomerBestTicketQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const statistic_time_query_1 = __webpack_require__(524);
class StatisticTopCustomerBestTicketQuery extends statistic_time_query_1.StatisticTimeQuery {
}
exports.StatisticTopCustomerBestTicketQuery = StatisticTopCustomerBestTicketQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        enum: ['sumTotalMoney', 'sumProfit', 'countTicket'],
        example: 'sumTotalMoney',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['sumTotalMoney', 'sumProfit', 'countTicket']),
    __metadata("design:type", String)
], StatisticTopCustomerBestTicketQuery.prototype, "orderBy", void 0);


/***/ }),
/* 527 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductHighMoneyQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
class StatisticProductHighMoneyQuery extends dto_1.LimitQuery {
}
exports.StatisticProductHighMoneyQuery = StatisticProductHighMoneyQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        enum: ['quantity', 'costAmount', 'retailAmount'],
        example: 'costAmount',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['quantity', 'costAmount', 'retailAmount']),
    __metadata("design:type", String)
], StatisticProductHighMoneyQuery.prototype, "orderBy", void 0);


/***/ }),
/* 528 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckModule = void 0;
const common_1 = __webpack_require__(3);
const api_stock_check_controller_1 = __webpack_require__(529);
const api_stock_check_service_1 = __webpack_require__(530);
let ApiStockCheckModule = class ApiStockCheckModule {
};
exports.ApiStockCheckModule = ApiStockCheckModule;
exports.ApiStockCheckModule = ApiStockCheckModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_stock_check_controller_1.ApiStockCheckController],
        providers: [api_stock_check_service_1.ApiStockCheckService],
    })
], ApiStockCheckModule);


/***/ }),
/* 529 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(488);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_stock_check_service_1 = __webpack_require__(530);
const request_1 = __webpack_require__(531);
let ApiStockCheckController = class ApiStockCheckController {
    constructor(apiStockCheckService) {
        this.apiStockCheckService = apiStockCheckService;
    }
    async pagination({ oid }, query) {
        return await this.apiStockCheckService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiStockCheckService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiStockCheckService.getOne({ oid, id, query });
    }
    async upsertDraft({ oid, uid }, body) {
        return await this.apiStockCheckService.upsertDraft({
            oid,
            userId: uid,
            body,
        });
    }
    async draftDestroy({ oid }, { id }) {
        return await this.apiStockCheckService.destroy({
            oid,
            stockCheckId: id,
        });
    }
    async draftSubmit({ oid, uid }, { id }) {
        return await this.apiStockCheckService.draftSubmit({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async pendingApprove({ oid, uid }, { id }) {
        return await this.apiStockCheckService.pendingApprove({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async confirmReconcile({ oid, uid }, { id }) {
        return await this.apiStockCheckService.confirmReconcile({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async void({ oid, uid }, { id }) {
        return await this.apiStockCheckService.void({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async cancelledDestroy({ oid }, { id }) {
        return await this.apiStockCheckService.destroy({
            oid,
            stockCheckId: id,
        });
    }
};
exports.ApiStockCheckController = ApiStockCheckController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StockCheckPaginationQuery !== "undefined" && request_1.StockCheckPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.StockCheckGetManyQuery !== "undefined" && request_1.StockCheckGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.StockCheckGetOneQuery !== "undefined" && request_1.StockCheckGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('upsert-draft'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.StockCheckUpsertDraftBody !== "undefined" && request_1.StockCheckUpsertDraftBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "upsertDraft", null);
__decorate([
    (0, common_1.Delete)('draft-destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Post)('draft-submit/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "draftSubmit", null);
__decorate([
    (0, common_1.Post)('pending-approve/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "pendingApprove", null);
__decorate([
    (0, common_1.Post)('confirm-reconcile/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "confirmReconcile", null);
__decorate([
    (0, common_1.Post)('void/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "void", null);
__decorate([
    (0, common_1.Delete)('cancelled-destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _x : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "cancelledDestroy", null);
exports.ApiStockCheckController = ApiStockCheckController = __decorate([
    (0, swagger_1.ApiTags)('StockCheck'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('stock-check'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_stock_check_service_1.ApiStockCheckService !== "undefined" && api_stock_check_service_1.ApiStockCheckService) === "function" ? _a : Object])
], ApiStockCheckController);


/***/ }),
/* 530 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const stock_check_entity_1 = __webpack_require__(80);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
let ApiStockCheckService = class ApiStockCheckService {
    constructor(stockCheckRepository, stockCheckItemRepository, stockCheckReconcileOperation) {
        this.stockCheckRepository = stockCheckRepository;
        this.stockCheckItemRepository = stockCheckItemRepository;
        this.stockCheckReconcileOperation = stockCheckReconcileOperation;
    }
    async pagination(oid, query) {
        const { page, limit, relation } = query;
        const { createdByUserId, updatedByUserId, createdAt, status } = query.filter || {};
        const { total, data } = await this.stockCheckRepository.pagination({
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
            page: query.page,
            limit: query.limit,
            condition: {
                oid,
                status,
                createdAt,
                updatedByUserId,
                createdByUserId,
            },
            sort: query.sort || { id: 'DESC' },
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { relation, limit } = query;
        const { createdByUserId, updatedByUserId, createdAt, status } = query.filter || {};
        const stockCheckList = await this.stockCheckRepository.findMany({
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
            limit,
            condition: {
                oid,
                status,
                createdAt,
                updatedByUserId,
                createdByUserId,
            },
            sort: query.sort || { id: 'DESC' },
        });
        return { data: { stockCheckList } };
    }
    async getOne(options) {
        const { oid, id, query } = options;
        const { relation } = query;
        const stockCheck = await this.stockCheckRepository.findOne({
            condition: { oid, id },
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        return { data: { stockCheck } };
    }
    async upsertDraft(params) {
        const { oid, body, userId } = params;
        const { stockCheckBody, stockCheckId, stockCheckItemBodyList } = body;
        const duplicateBatchId = object_helper_1.ESArray.checkDuplicate(stockCheckItemBodyList, 'batchId');
        if (duplicateBatchId.length) {
            throw new exception_filter_1.BusinessException(`Tạo phiếu không thành công, xuất hiện 2 sản phẩm trùng nhau`);
        }
        let stockCheck;
        if (!stockCheckId) {
            stockCheck = await this.stockCheckRepository.insertOneFullFieldAndReturnEntity({
                oid,
                createdAt: stockCheckBody.createdAt,
                createdByUserId: stockCheckBody.createdByUserId,
                note: stockCheckBody.note,
                status: stock_check_entity_1.StockCheckStatus.Draft,
                updatedAt: Date.now(),
                updatedByUserId: 0,
            });
        }
        else {
            stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Draft }, {
                createdAt: stockCheckBody.createdAt,
                createdByUserId: stockCheckBody.createdByUserId,
                note: stockCheckBody.note,
            });
            await this.stockCheckItemRepository.delete({ oid, stockCheckId });
        }
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        const stockCheckItemInsertList = stockCheckItemBodyList.map((i) => {
            const insertDto = {
                oid,
                stockCheckId: stockCheck.id,
                productId: i.productId,
                batchId: i.batchId,
                systemQuantity: i.systemQuantity,
                actualQuantity: i.actualQuantity,
                systemCostAmount: i.systemCostAmount,
                actualCostAmount: i.actualCostAmount,
                note: i.note,
            };
            return insertDto;
        });
        await this.stockCheckItemRepository.insertManyFullField(stockCheckItemInsertList);
        return { data: { stockCheck } };
    }
    async draftSubmit(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Draft }, {
            status: stock_check_entity_1.StockCheckStatus.Pending,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async pendingApprove(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Pending }, {
            status: stock_check_entity_1.StockCheckStatus.Confirmed,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async confirmReconcile(params) {
        const { oid, stockCheckId, userId } = params;
        const { stockCheck } = await this.stockCheckReconcileOperation.startReconcile({
            oid,
            stockCheckId,
            userId,
            time: Date.now(),
        });
        return { data: { stockCheck } };
    }
    async void(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({
            oid,
            id: stockCheckId,
            status: { IN: [stock_check_entity_1.StockCheckStatus.Pending, stock_check_entity_1.StockCheckStatus.Confirmed] },
        }, {
            status: stock_check_entity_1.StockCheckStatus.Cancelled,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async destroy(params) {
        const { oid, stockCheckId } = params;
        const stockCheckOrigin = await this.stockCheckRepository.findOneBy({ oid, id: stockCheckId });
        if (![stock_check_entity_1.StockCheckStatus.Draft, stock_check_entity_1.StockCheckStatus.Cancelled].includes(stockCheckOrigin.status)) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        await this.stockCheckItemRepository.delete({ oid, stockCheckId });
        await this.stockCheckRepository.delete({ oid, id: stockCheckId });
        return { data: { stockCheckId } };
    }
};
exports.ApiStockCheckService = ApiStockCheckService;
exports.ApiStockCheckService = ApiStockCheckService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.StockCheckRepository !== "undefined" && repositories_1.StockCheckRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.StockCheckItemRepository !== "undefined" && repositories_1.StockCheckItemRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.StockCheckReconcileOperation !== "undefined" && operations_1.StockCheckReconcileOperation) === "function" ? _c : Object])
], ApiStockCheckService);


/***/ }),
/* 531 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(532), exports);
__exportStar(__webpack_require__(533), exports);
__exportStar(__webpack_require__(534), exports);


/***/ }),
/* 532 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckGetOneQuery = exports.StockCheckGetManyQuery = exports.StockCheckPaginationQuery = exports.StockCheckGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const stock_check_options_request_1 = __webpack_require__(533);
class StockCheckGetQuery {
}
exports.StockCheckGetQuery = StockCheckGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            createdByUser: true,
            stockCheckItemList: { product: true, batch: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof stock_check_options_request_1.StockCheckRelationQuery !== "undefined" && stock_check_options_request_1.StockCheckRelationQuery) === "function" ? _a : Object)
], StockCheckGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ createdByUserId: 33 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof stock_check_options_request_1.StockCheckFilterQuery !== "undefined" && stock_check_options_request_1.StockCheckFilterQuery) === "function" ? _b : Object)
], StockCheckGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof stock_check_options_request_1.StockCheckSortQuery !== "undefined" && stock_check_options_request_1.StockCheckSortQuery) === "function" ? _c : Object)
], StockCheckGetQuery.prototype, "sort", void 0);
class StockCheckPaginationQuery extends (0, swagger_1.IntersectionType)(StockCheckGetQuery, query_1.PaginationQuery) {
}
exports.StockCheckPaginationQuery = StockCheckPaginationQuery;
class StockCheckGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(StockCheckGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.StockCheckGetManyQuery = StockCheckGetManyQuery;
class StockCheckGetOneQuery extends (0, swagger_1.PickType)(StockCheckGetQuery, ['relation']) {
}
exports.StockCheckGetOneQuery = StockCheckGetOneQuery;


/***/ }),
/* 533 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckSortQuery = exports.StockCheckFilterQuery = exports.StockCheckRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const stock_check_entity_1 = __webpack_require__(80);
class StockCheckRelationQuery {
}
exports.StockCheckRelationQuery = StockCheckRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], StockCheckRelationQuery.prototype, "stockCheckItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "updatedByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "createdByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "reconciledByUser", void 0);
const ConditionEnumStockCheckStatus = (0, dto_1.createConditionEnum)(stock_check_entity_1.StockCheckStatus);
class StockCheckFilterQuery {
}
exports.StockCheckFilterQuery = StockCheckFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckFilterQuery.prototype, "createdByUserId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckFilterQuery.prototype, "updatedByUserId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, stock_check_entity_1.StockCheckStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], StockCheckFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _c : Object)
], StockCheckFilterQuery.prototype, "createdAt", void 0);
class StockCheckSortQuery extends query_1.SortQuery {
}
exports.StockCheckSortQuery = StockCheckSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StockCheckSortQuery.prototype, "createdAt", void 0);


/***/ }),
/* 534 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckUpsertDraftBody = exports.StockCheckBody = exports.StockCheckItemBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class StockCheckItemBody {
}
exports.StockCheckItemBody = StockCheckItemBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "systemQuantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "actualQuantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "systemCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "actualCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], StockCheckItemBody.prototype, "note", void 0);
class StockCheckBody {
}
exports.StockCheckBody = StockCheckBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], StockCheckBody.prototype, "createdByUserId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], StockCheckBody.prototype, "note", void 0);
class StockCheckUpsertDraftBody {
}
exports.StockCheckUpsertDraftBody = StockCheckUpsertDraftBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckUpsertDraftBody.prototype, "stockCheckId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: StockCheckItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => StockCheckItemBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], StockCheckUpsertDraftBody.prototype, "stockCheckItemBodyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: StockCheckBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => StockCheckBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StockCheckBody)
], StockCheckUpsertDraftBody.prototype, "stockCheckBody", void 0);


/***/ }),
/* 535 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_batch_controller_1 = __webpack_require__(536);
const api_ticket_batch_service_1 = __webpack_require__(537);
let ApiTicketBatchModule = class ApiTicketBatchModule {
};
exports.ApiTicketBatchModule = ApiTicketBatchModule;
exports.ApiTicketBatchModule = ApiTicketBatchModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_batch_controller_1.ApiTicketBatchController],
        providers: [api_ticket_batch_service_1.ApiTicketBatchService],
    })
], ApiTicketBatchModule);


/***/ }),
/* 536 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_batch_service_1 = __webpack_require__(537);
const request_1 = __webpack_require__(538);
let ApiTicketBatchController = class ApiTicketBatchController {
    constructor(apiTicketBatchService) {
        this.apiTicketBatchService = apiTicketBatchService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketBatchService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiTicketBatchService.getList(oid, query);
    }
};
exports.ApiTicketBatchController = ApiTicketBatchController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketBatchPaginationQuery !== "undefined" && request_1.TicketBatchPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketBatchController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.TicketBatchGetManyQuery !== "undefined" && request_1.TicketBatchGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketBatchController.prototype, "list", null);
exports.ApiTicketBatchController = ApiTicketBatchController = __decorate([
    (0, swagger_1.ApiTags)('TicketBatch'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-batch'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_batch_service_1.ApiTicketBatchService !== "undefined" && api_ticket_batch_service_1.ApiTicketBatchService) === "function" ? _a : Object])
], ApiTicketBatchController);


/***/ }),
/* 537 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchService = void 0;
const common_1 = __webpack_require__(3);
const ticket_batch_repository_1 = __webpack_require__(197);
let ApiTicketBatchService = class ApiTicketBatchService {
    constructor(ticketBatchRepository) {
        this.ticketBatchRepository = ticketBatchRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data } = await this.ticketBatchRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getList(oid, query) {
        const { filter, limit, relation, sort } = query;
        const ticketBatchList = await this.ticketBatchRepository.findMany({
            relation,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
            },
            relationLoadStrategy: 'query',
            sort,
        });
        return { data: { ticketBatchList } };
    }
};
exports.ApiTicketBatchService = ApiTicketBatchService;
exports.ApiTicketBatchService = ApiTicketBatchService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_batch_repository_1.TicketBatchRepository !== "undefined" && ticket_batch_repository_1.TicketBatchRepository) === "function" ? _a : Object])
], ApiTicketBatchService);


/***/ }),
/* 538 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(539), exports);
__exportStar(__webpack_require__(540), exports);


/***/ }),
/* 539 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchGetOneQuery = exports.TicketBatchGetManyQuery = exports.TicketBatchPaginationQuery = exports.TicketBatchGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const ticket_batch_options_request_1 = __webpack_require__(540);
class TicketBatchGetQuery {
}
exports.TicketBatchGetQuery = TicketBatchGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_batch_options_request_1.TicketBatchRelationQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchRelationQuery) === "function" ? _a : Object)
], TicketBatchGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_batch_options_request_1.TicketBatchFilterQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchFilterQuery) === "function" ? _b : Object)
], TicketBatchGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_batch_options_request_1.TicketBatchSortQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchSortQuery) === "function" ? _c : Object)
], TicketBatchGetQuery.prototype, "sort", void 0);
class TicketBatchPaginationQuery extends (0, swagger_1.IntersectionType)(TicketBatchGetQuery, query_1.PaginationQuery) {
}
exports.TicketBatchPaginationQuery = TicketBatchPaginationQuery;
class TicketBatchGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketBatchGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketBatchGetManyQuery = TicketBatchGetManyQuery;
class TicketBatchGetOneQuery extends (0, swagger_1.PickType)(TicketBatchGetQuery, ['relation']) {
}
exports.TicketBatchGetOneQuery = TicketBatchGetOneQuery;


/***/ }),
/* 540 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchSortQuery = exports.TicketBatchFilterQuery = exports.TicketBatchRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketBatchRelationQuery {
}
exports.TicketBatchRelationQuery = TicketBatchRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "customer", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(variable_1.DeliveryStatus);
class TicketBatchFilterQuery {
}
exports.TicketBatchFilterQuery = TicketBatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.DeliveryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketBatchFilterQuery.prototype, "deliveryStatus", void 0);
class TicketBatchSortQuery extends query_1.SortQuery {
}
exports.TicketBatchSortQuery = TicketBatchSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketBatchSortQuery.prototype, "ticketProductId", void 0);


/***/ }),
/* 541 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_attribute_module_1 = __webpack_require__(542);
const api_ticket_clinic_laboratory_module_1 = __webpack_require__(547);
const api_ticket_clinic_procedure_module_1 = __webpack_require__(563);
const api_ticket_clinic_product_module_1 = __webpack_require__(571);
const api_ticket_clinic_radiology_module_1 = __webpack_require__(580);
const api_ticket_clinic_user_module_1 = __webpack_require__(548);
const api_ticket_clinic_controller_1 = __webpack_require__(589);
const api_ticket_clinic_service_1 = __webpack_require__(590);
let ApiTicketClinicModule = class ApiTicketClinicModule {
};
exports.ApiTicketClinicModule = ApiTicketClinicModule;
exports.ApiTicketClinicModule = ApiTicketClinicModule = __decorate([
    (0, common_1.Module)({
        imports: [
            api_ticket_clinic_attribute_module_1.ApiTicketClinicAttributeModule,
            api_ticket_clinic_procedure_module_1.ApiTicketClinicProcedureModule,
            api_ticket_clinic_radiology_module_1.ApiTicketClinicRadiologyModule,
            api_ticket_clinic_laboratory_module_1.ApiTicketClinicLaboratoryModule,
            api_ticket_clinic_product_module_1.ApiTicketClinicProductModule,
            api_ticket_clinic_user_module_1.ApiTicketClinicUserModule,
        ],
        controllers: [api_ticket_clinic_controller_1.ApiTicketClinicController],
        providers: [api_ticket_clinic_service_1.ApiTicketClinicService],
    })
], ApiTicketClinicModule);


/***/ }),
/* 542 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicAttributeModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_attribute_controller_1 = __webpack_require__(543);
const api_ticket_clinic_attribute_service_1 = __webpack_require__(544);
let ApiTicketClinicAttributeModule = class ApiTicketClinicAttributeModule {
};
exports.ApiTicketClinicAttributeModule = ApiTicketClinicAttributeModule;
exports.ApiTicketClinicAttributeModule = ApiTicketClinicAttributeModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_clinic_attribute_controller_1.ApiTicketClinicAttributeController],
        providers: [api_ticket_clinic_attribute_service_1.ApiTicketClinicAttributeService],
    })
], ApiTicketClinicAttributeModule);


/***/ }),
/* 543 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicAttributeController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_clinic_attribute_service_1 = __webpack_require__(544);
const request_1 = __webpack_require__(545);
let ApiTicketClinicAttributeController = class ApiTicketClinicAttributeController {
    constructor(apiTicketClinicAttributeService) {
        this.apiTicketClinicAttributeService = apiTicketClinicAttributeService;
    }
    async updateTicketAttributeList({ oid }, { id }, body) {
        return await this.apiTicketClinicAttributeService.updateTicketAttributeList({
            oid,
            ticketId: id,
            body,
        });
    }
};
exports.ApiTicketClinicAttributeController = ApiTicketClinicAttributeController;
__decorate([
    (0, common_1.Post)(':id/update-ticket-attribute-list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _c : Object, typeof (_d = typeof request_1.TicketClinicUpdateTicketAttributeListBody !== "undefined" && request_1.TicketClinicUpdateTicketAttributeListBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicAttributeController.prototype, "updateTicketAttributeList", null);
exports.ApiTicketClinicAttributeController = ApiTicketClinicAttributeController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_attribute_service_1.ApiTicketClinicAttributeService !== "undefined" && api_ticket_clinic_attribute_service_1.ApiTicketClinicAttributeService) === "function" ? _a : Object])
], ApiTicketClinicAttributeController);


/***/ }),
/* 544 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicAttributeService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiTicketClinicAttributeService = class ApiTicketClinicAttributeService {
    constructor(socketEmitService, ticketAttributeRepository) {
        this.socketEmitService = socketEmitService;
        this.ticketAttributeRepository = ticketAttributeRepository;
    }
    async updateTicketAttributeList(options) {
        const { oid, ticketId, body } = options;
        const ticketAttributeKeyList = body.ticketAttributeList.map((i) => i.key);
        await this.ticketAttributeRepository.delete({
            oid,
            ticketId,
            key: { IN: ticketAttributeKeyList },
        });
        const ticketAttributeInsertList = body.ticketAttributeList
            .filter((i) => !!i.value)
            .map((i) => {
            const dto = {
                oid,
                ticketId,
                key: i.key,
                value: i.value,
            };
            return dto;
        });
        const ticketAttributeList = await this.ticketAttributeRepository.insertManyAndReturnEntity(ticketAttributeInsertList);
        this.socketEmitService.ticketClinicUpdateTicketAttributeList(oid, {
            ticketId,
            ticketAttributeList,
        });
        return { data: true };
    }
};
exports.ApiTicketClinicAttributeService = ApiTicketClinicAttributeService;
exports.ApiTicketClinicAttributeService = ApiTicketClinicAttributeService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _b : Object])
], ApiTicketClinicAttributeService);


/***/ }),
/* 545 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(546), exports);


/***/ }),
/* 546 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketAttributeListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketAttributeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketClinicUpdateTicketAttributeListBody {
}
exports.TicketClinicUpdateTicketAttributeListBody = TicketClinicUpdateTicketAttributeListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketAttributeListBody.prototype, "ticketAttributeList", void 0);


/***/ }),
/* 547 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_user_module_1 = __webpack_require__(548);
const api_ticket_clinic_laboratory_controller_1 = __webpack_require__(555);
const api_ticket_clinic_laboratory_service_1 = __webpack_require__(556);
let ApiTicketClinicLaboratoryModule = class ApiTicketClinicLaboratoryModule {
};
exports.ApiTicketClinicLaboratoryModule = ApiTicketClinicLaboratoryModule;
exports.ApiTicketClinicLaboratoryModule = ApiTicketClinicLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [api_ticket_clinic_user_module_1.ApiTicketClinicUserModule],
        controllers: [api_ticket_clinic_laboratory_controller_1.ApiTicketClinicLaboratoryController],
        providers: [api_ticket_clinic_laboratory_service_1.ApiTicketClinicLaboratoryService],
    })
], ApiTicketClinicLaboratoryModule);


/***/ }),
/* 548 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicUserModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_user_controller_1 = __webpack_require__(549);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicUserModule = class ApiTicketClinicUserModule {
};
exports.ApiTicketClinicUserModule = ApiTicketClinicUserModule;
exports.ApiTicketClinicUserModule = ApiTicketClinicUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_clinic_user_controller_1.ApiTicketClinicUserController],
        providers: [api_ticket_clinic_user_service_1.ApiTicketClinicUserService],
        exports: [api_ticket_clinic_user_service_1.ApiTicketClinicUserService],
    })
], ApiTicketClinicUserModule);


/***/ }),
/* 549 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const ticket_params_1 = __webpack_require__(296);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
const request_1 = __webpack_require__(551);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
let ApiTicketClinicUserController = class ApiTicketClinicUserController {
    constructor(apiTicketClinicUserService) {
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async destroyTicketUser({ oid }, { ticketId, ticketUserId }) {
        return await this.apiTicketClinicUserService.destroyTicketUser({
            oid,
            ticketId,
            ticketUserId,
        });
    }
    async updateTicketUser({ oid }, { ticketId, ticketUserId }, body) {
        return await this.apiTicketClinicUserService.updateTicketUser({
            oid,
            ticketId,
            ticketUserId,
            body,
        });
    }
    async chooseUserId({ oid }, { ticketId }, body) {
        return await this.apiTicketClinicUserService.changeTicketUserList({
            oid,
            ticketId,
            body,
        });
    }
};
exports.ApiTicketClinicUserController = ApiTicketClinicUserController;
__decorate([
    (0, common_1.Delete)(':ticketId/ticket-user/destroy/:ticketUserId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_USER_UPDATE_COMMISSION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketClinicUserParams !== "undefined" && request_1.TicketClinicUserParams) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicUserController.prototype, "destroyTicketUser", null);
__decorate([
    (0, common_1.Post)(':ticketId/ticket-user/update/:ticketUserId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_USER_UPDATE_COMMISSION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.TicketClinicUserParams !== "undefined" && request_1.TicketClinicUserParams) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketClinicUpdateTicketUserBody !== "undefined" && request_1.TicketClinicUpdateTicketUserBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicUserController.prototype, "updateTicketUser", null);
__decorate([
    (0, common_1.Post)(':ticketId/ticket-user/choose-user-id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_USER_CHOOSE_USERID),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _h : Object, typeof (_j = typeof ticket_clinic_update_user_list_body_1.TicketClinicUpdateTicketUserListBody !== "undefined" && ticket_clinic_update_user_list_body_1.TicketClinicUpdateTicketUserListBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicUserController.prototype, "chooseUserId", null);
exports.ApiTicketClinicUserController = ApiTicketClinicUserController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _a : Object])
], ApiTicketClinicUserController);


/***/ }),
/* 550 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicUserService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const commission_entity_1 = __webpack_require__(75);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiTicketClinicUserService = class ApiTicketClinicUserService {
    constructor(socketEmitService, commissionRepository, ticketUserRepository) {
        this.socketEmitService = socketEmitService;
        this.commissionRepository = commissionRepository;
        this.ticketUserRepository = ticketUserRepository;
    }
    async destroyTicketUser(options) {
        const { oid, ticketId, ticketUserId } = options;
        const ticketUserDestroyList = await this.ticketUserRepository.deleteAndReturnEntity({
            oid,
            ticketId,
            id: ticketUserId,
        });
        this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
            ticketId,
            ticketUserDestroyList,
        });
        return { data: true };
    }
    async updateTicketUser(options) {
        const { oid, ticketId, ticketUserId, body } = options;
        const ticketUserUpdateList = await this.ticketUserRepository.updateAndReturnEntity({ oid, ticketId, id: ticketUserId }, {
            commissionCalculatorType: body.commissionCalculatorType,
            commissionMoney: body.commissionMoney,
            commissionPercentActual: body.commissionPercentActual,
            commissionPercentExpected: body.commissionPercentExpected,
        });
        this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
            ticketId,
            ticketUserUpsertList: ticketUserUpdateList,
        });
        return { data: true };
    }
    async changeTicketUserList(options) {
        const { oid, ticketId, body } = options;
        const tuDestroyBodyList = body.ticketUserList.filter((i) => i.id !== 0 && i.userId === 0);
        let ticketUserDestroyList = [];
        if (tuDestroyBodyList.length) {
            ticketUserDestroyList = await this.ticketUserRepository.deleteAndReturnEntity({
                oid,
                id: { IN: tuDestroyBodyList.map((i) => i.id) },
            });
        }
        const tuInsertBodyList = body.ticketUserList.filter((i) => i.id === 0 && i.userId !== 0);
        let ticketUserCreatedList = [];
        if (tuInsertBodyList.length) {
            const commissionList = await this.commissionRepository.findManyBy({
                oid,
                interactType: body.interactType,
                interactId: body.interactId,
            });
            const ticketUserInsertList = tuInsertBodyList.map((i) => {
                const commission = commissionList.find((c) => c.roleId === i.roleId);
                if (!commission) {
                    throw new exception_filter_1.BusinessException('error.Conflict');
                }
                const insertDto = {
                    oid,
                    ticketId,
                    roleId: i.roleId,
                    userId: i.userId,
                    interactType: body.interactType,
                    interactId: body.interactId,
                    ticketItemId: body.ticketItemId,
                    ticketItemExpectedPrice: 0,
                    ticketItemActualPrice: 0,
                    quantity: body.quantity,
                    createdAt: Date.now(),
                    commissionCalculatorType: commission.commissionCalculatorType,
                    commissionMoney: commission.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.VND
                        ? commission.commissionValue
                        : 0,
                    commissionPercentActual: commission.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentActual
                        ? commission.commissionValue
                        : 0,
                    commissionPercentExpected: commission.commissionCalculatorType === commission_entity_1.CommissionCalculatorType.PercentExpected
                        ? commission.commissionValue
                        : 0,
                };
                return insertDto;
            });
            ticketUserCreatedList =
                await this.ticketUserRepository.insertManyAndReturnEntity(ticketUserInsertList);
        }
        const tuUpdateBodyList = body.ticketUserList.filter((i) => i.id !== 0 && i.userId !== 0);
        let ticketUserModifiedList = [];
        if (tuUpdateBodyList) {
            const ticketUserUpdateList = tuUpdateBodyList.map((i) => {
                const updateDto = {
                    oid,
                    id: i.id,
                    ticketId,
                    roleId: i.roleId,
                    userId: i.userId,
                    quantity: body.quantity,
                };
                return updateDto;
            });
            ticketUserModifiedList = await this.ticketUserRepository.updateListAndReturnEntity({
                updateList: ticketUserUpdateList,
                conditionFields: ['oid', 'id', 'ticketId'],
                updateFields: ['userId', 'quantity'],
            });
        }
        this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
            ticketId,
            ticketUserDestroyList,
            ticketUserUpsertList: [...ticketUserCreatedList, ...ticketUserModifiedList],
        });
        return { data: true };
    }
};
exports.ApiTicketClinicUserService = ApiTicketClinicUserService;
exports.ApiTicketClinicUserService = ApiTicketClinicUserService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CommissionRepository !== "undefined" && repositories_1.CommissionRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _c : Object])
], ApiTicketClinicUserService);


/***/ }),
/* 551 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(552), exports);
__exportStar(__webpack_require__(553), exports);


/***/ }),
/* 552 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketUserBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const commission_entity_1 = __webpack_require__(75);
class TicketClinicUpdateTicketUserBody {
}
exports.TicketClinicUpdateTicketUserBody = TicketClinicUpdateTicketUserBody;
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(commission_entity_1.CommissionCalculatorType), example: commission_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.CommissionCalculatorType !== "undefined" && commission_entity_1.CommissionCalculatorType) === "function" ? _a : Object)
], TicketClinicUpdateTicketUserBody.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserBody.prototype, "commissionMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserBody.prototype, "commissionPercentActual", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserBody.prototype, "commissionPercentExpected", void 0);


/***/ }),
/* 553 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUserParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const ticket_params_1 = __webpack_require__(296);
class TicketClinicUserParams extends ticket_params_1.TicketParams {
}
exports.TicketClinicUserParams = TicketClinicUserParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicUserParams.prototype, "ticketUserId", void 0);


/***/ }),
/* 554 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketUserListBody = exports.TicketUserBasicBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const commission_entity_1 = __webpack_require__(75);
class TicketUserBasicBody {
}
exports.TicketUserBasicBody = TicketUserBasicBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "roleId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "userId", void 0);
class TicketClinicUpdateTicketUserListBody {
}
exports.TicketClinicUpdateTicketUserListBody = TicketClinicUpdateTicketUserListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: commission_entity_1.InteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(commission_entity_1.InteractType),
    __metadata("design:type", typeof (_a = typeof commission_entity_1.InteractType !== "undefined" && commission_entity_1.InteractType) === "function" ? _a : Object)
], TicketClinicUpdateTicketUserListBody.prototype, "interactType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserListBody.prototype, "interactId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserListBody.prototype, "ticketItemId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketUserListBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketUserListBody.prototype, "ticketUserList", void 0);


/***/ }),
/* 555 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const ticket_params_1 = __webpack_require__(296);
const api_ticket_clinic_laboratory_service_1 = __webpack_require__(556);
const request_1 = __webpack_require__(557);
let ApiTicketClinicLaboratoryController = class ApiTicketClinicLaboratoryController {
    constructor(apiTicketClinicLaboratoryService) {
        this.apiTicketClinicLaboratoryService = apiTicketClinicLaboratoryService;
    }
    async upsertLaboratory({ oid }, { ticketId }, body) {
        return await this.apiTicketClinicLaboratoryService.upsertLaboratory({
            oid,
            ticketId,
            body,
        });
    }
    async destroyTicketLaboratory({ oid }, { ticketId, ticketLaboratoryId }) {
        return await this.apiTicketClinicLaboratoryService.destroyTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
        });
    }
    async destroyTicketLaboratoryGroup({ oid }, { ticketId, ticketLaboratoryGroupId }) {
        return await this.apiTicketClinicLaboratoryService.destroyTicketLaboratoryGroup({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
    }
    async updateTicketLaboratory({ oid }, { ticketId, ticketLaboratoryId }, body) {
        return await this.apiTicketClinicLaboratoryService.updateTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
            body,
        });
    }
    async updateTicketLaboratoryResult({ oid }, { id }, body) {
        return await this.apiTicketClinicLaboratoryService.updateTicketLaboratoryResult({
            oid,
            ticketId: id,
            body,
        });
    }
    async updatePriorityTicketLaboratory({ oid }, { id }, body) {
        return await this.apiTicketClinicLaboratoryService.updatePriorityTicketLaboratory({
            oid,
            ticketId: id,
            body,
        });
    }
};
exports.ApiTicketClinicLaboratoryController = ApiTicketClinicLaboratoryController;
__decorate([
    (0, common_1.Post)(':ticketId/upsert-laboratory'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_1.TicketClinicUpsertLaboratoryBody !== "undefined" && request_1.TicketClinicUpsertLaboratoryBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "upsertLaboratory", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-laboratory/:ticketLaboratoryId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketClinicLaboratoryParams !== "undefined" && request_1.TicketClinicLaboratoryParams) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "destroyTicketLaboratory", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-laboratory-group/:ticketLaboratoryGroupId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof request_1.TicketClinicLaboratoryGroupParams !== "undefined" && request_1.TicketClinicLaboratoryGroupParams) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "destroyTicketLaboratoryGroup", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-ticket-laboratory/:ticketLaboratoryId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.TicketClinicLaboratoryParams !== "undefined" && request_1.TicketClinicLaboratoryParams) === "function" ? _k : Object, typeof (_l = typeof request_1.TicketClinicUpdateTicketLaboratoryBody !== "undefined" && request_1.TicketClinicUpdateTicketLaboratoryBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "updateTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':id/update-ticket-laboratory-result'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.TicketLaboratoryResultUpdateBody !== "undefined" && request_1.TicketLaboratoryResultUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "updateTicketLaboratoryResult", null);
__decorate([
    (0, common_1.Post)(':id/update-priority-ticket-laboratory'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_LABORATORY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.TicketClinicUpdatePriorityTicketLaboratoryBody !== "undefined" && request_1.TicketClinicUpdatePriorityTicketLaboratoryBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicLaboratoryController.prototype, "updatePriorityTicketLaboratory", null);
exports.ApiTicketClinicLaboratoryController = ApiTicketClinicLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_laboratory_service_1.ApiTicketClinicLaboratoryService !== "undefined" && api_ticket_clinic_laboratory_service_1.ApiTicketClinicLaboratoryService) === "function" ? _a : Object])
], ApiTicketClinicLaboratoryController);


/***/ }),
/* 556 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
const commission_entity_1 = __webpack_require__(75);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicLaboratoryService = class ApiTicketClinicLaboratoryService {
    constructor(socketEmitService, ticketLaboratoryRepository, ticketLaboratoryGroupRepository, ticketLaboratoryResultRepository, ticketClinicAddSelectLaboratoryOperation, ticketClinicChangeSelectLaboratoryOperation, ticketClinicUpdateTicketLaboratoryOperation, ticketClinicDestroyTicketLaboratoryOperation, ticketClinicDestroyTlgOperation, apiTicketClinicUserService) {
        this.socketEmitService = socketEmitService;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
        this.ticketClinicAddSelectLaboratoryOperation = ticketClinicAddSelectLaboratoryOperation;
        this.ticketClinicChangeSelectLaboratoryOperation = ticketClinicChangeSelectLaboratoryOperation;
        this.ticketClinicUpdateTicketLaboratoryOperation = ticketClinicUpdateTicketLaboratoryOperation;
        this.ticketClinicDestroyTicketLaboratoryOperation = ticketClinicDestroyTicketLaboratoryOperation;
        this.ticketClinicDestroyTlgOperation = ticketClinicDestroyTlgOperation;
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async upsertLaboratory(options) {
        const { oid, ticketId, body } = options;
        if (body.ticketLaboratoryGroupAddList.length) {
            const result = await this.ticketClinicAddSelectLaboratoryOperation.addSelectLaboratoryList({
                oid,
                ticketId,
                tlgDtoList: body.ticketLaboratoryGroupAddList,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: result.ticket });
            this.socketEmitService.ticketClinicChangeLaboratory(oid, {
                ticketId,
                ticketLaboratoryInsertList: result.ticketLaboratoryInsertList,
                ticketLaboratoryGroupInsertList: result.ticketLaboratoryGroupInsertList,
            });
        }
        if (body.ticketLaboratoryGroupUpdate) {
            const result = await this.ticketClinicChangeSelectLaboratoryOperation.changeSelectLaboratoryList({
                oid,
                ticketId,
                tlgDto: body.ticketLaboratoryGroupUpdate,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: result.ticket });
            this.socketEmitService.ticketClinicChangeLaboratory(oid, {
                ticketId,
                ticketLaboratoryInsertList: result.ticketLaboratoryInsertList,
                ticketLaboratoryDestroyList: result.ticketLaboratoryDestroyList,
                ticketLaboratoryGroupUpdate: result.ticketLaboratoryGroupUpdate,
            });
        }
        return { data: true };
    }
    async destroyTicketLaboratory(options) {
        const { oid, ticketId, ticketLaboratoryId } = options;
        const result = await this.ticketClinicDestroyTicketLaboratoryOperation.destroyTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
        });
        const { ticket } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeLaboratory(oid, {
            ticketId,
            ticketLaboratoryDestroyList: [result.ticketLaboratoryDestroy],
            ticketLaboratoryGroupDestroy: result.ticketLaboratoryGroupDestroy,
        });
        return { data: true };
    }
    async destroyTicketLaboratoryGroup(options) {
        const { oid, ticketId, ticketLaboratoryGroupId } = options;
        const result = await this.ticketClinicDestroyTlgOperation.destroyTicketLaboratoryGroup({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
        const { ticket } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeLaboratory(oid, {
            ticketId,
            ticketLaboratoryGroupDestroy: result.ticketLaboratoryGroupDestroy,
            ticketLaboratoryDestroyList: result.ticketLaboratoryDestroyList,
            ticketLaboratoryResultDestroyList: result.ticketLaboratoryResultDestroyList,
        });
        return { data: true };
    }
    async updateTicketLaboratory(options) {
        const { oid, ticketId, ticketLaboratoryId, body } = options;
        const result = await this.ticketClinicUpdateTicketLaboratoryOperation.updateTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
            ticketLaboratoryUpdateDto: body.ticketLaboratory,
        });
        const { ticket, ticketLaboratory } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeLaboratory(oid, {
            ticketId,
            ticketLaboratoryUpdateList: [ticketLaboratory],
        });
        if (body.ticketUserList) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Laboratory,
                    interactId: ticketLaboratory.laboratoryId,
                    ticketItemId: ticketLaboratory.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async updateTicketLaboratoryResult(options) {
        const { oid, ticketId, body } = options;
        const [ticketLaboratoryGroupUpdate] = await this.ticketLaboratoryGroupRepository.updateAndReturnEntity({ oid, ticketId, id: body.ticketLaboratoryGroupId }, {
            startedAt: body.startedAt,
            status: variable_1.TicketLaboratoryStatus.Completed,
        });
        const ticketLaboratoryUpdateList = await this.ticketLaboratoryRepository.updateAndReturnEntity({
            oid,
            ticketId,
            ticketLaboratoryGroupId: body.ticketLaboratoryGroupId,
        }, {
            startedAt: body.startedAt,
            status: variable_1.TicketLaboratoryStatus.Completed,
        });
        const tlrBodyInsertList = body.ticketLaboratoryResultUpdateList.filter((i) => {
            return !i.id;
        });
        const tlrBodyUpdateList = body.ticketLaboratoryResultUpdateList.filter((i) => {
            return !!i.id;
        });
        let tlrInsertList = [];
        let tlrUpdateList = [];
        if (tlrBodyInsertList.length) {
            const tlrDtoInsertList = tlrBodyInsertList.map((i) => {
                const dtoInsert = Object.assign(Object.assign({}, i), { oid,
                    ticketId, ticketLaboratoryGroupId: body.ticketLaboratoryGroupId, customerId: (ticketLaboratoryGroupUpdate === null || ticketLaboratoryGroupUpdate === void 0 ? void 0 : ticketLaboratoryGroupUpdate.customerId) || 0 });
                return dtoInsert;
            });
            tlrInsertList =
                await this.ticketLaboratoryResultRepository.insertManyAndReturnEntity(tlrDtoInsertList);
        }
        if (tlrBodyUpdateList.length) {
            tlrUpdateList = await this.ticketLaboratoryResultRepository.updateResultList({
                oid,
                ticketId,
                ticketLaboratoryResultDtoList: body.ticketLaboratoryResultUpdateList,
            });
        }
        this.socketEmitService.ticketClinicChangeLaboratory(oid, {
            ticketId,
            ticketLaboratoryGroupUpdate,
            ticketLaboratoryUpdateList,
            ticketLaboratoryResultInsertList: tlrInsertList,
            ticketLaboratoryResultUpdateList: tlrUpdateList,
        });
        return { data: true };
    }
    async updatePriorityTicketLaboratory(options) {
        const { oid, ticketId, body } = options;
        return { data: true };
    }
};
exports.ApiTicketClinicLaboratoryService = ApiTicketClinicLaboratoryService;
exports.ApiTicketClinicLaboratoryService = ApiTicketClinicLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryGroupRepository !== "undefined" && repositories_1.TicketLaboratoryGroupRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryResultRepository !== "undefined" && repositories_1.TicketLaboratoryResultRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketClinicAddSelectLaboratoryOperation !== "undefined" && operations_1.TicketClinicAddSelectLaboratoryOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketClinicChangeSelectLaboratoryOperation !== "undefined" && operations_1.TicketClinicChangeSelectLaboratoryOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketClinicUpdateTicketLaboratoryOperation !== "undefined" && operations_1.TicketClinicUpdateTicketLaboratoryOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketClinicDestroyTicketLaboratoryOperation !== "undefined" && operations_1.TicketClinicDestroyTicketLaboratoryOperation) === "function" ? _h : Object, typeof (_j = typeof operations_1.TicketClinicDestroyTicketLaboratoryGroupOperation !== "undefined" && operations_1.TicketClinicDestroyTicketLaboratoryGroupOperation) === "function" ? _j : Object, typeof (_k = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _k : Object])
], ApiTicketClinicLaboratoryService);


/***/ }),
/* 557 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(558), exports);
__exportStar(__webpack_require__(559), exports);
__exportStar(__webpack_require__(560), exports);
__exportStar(__webpack_require__(561), exports);
__exportStar(__webpack_require__(562), exports);


/***/ }),
/* 558 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicLaboratoryGroupParams = exports.TicketClinicLaboratoryParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketClinicLaboratoryParams {
}
exports.TicketClinicLaboratoryParams = TicketClinicLaboratoryParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicLaboratoryParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicLaboratoryParams.prototype, "ticketLaboratoryId", void 0);
class TicketClinicLaboratoryGroupParams {
}
exports.TicketClinicLaboratoryGroupParams = TicketClinicLaboratoryGroupParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicLaboratoryGroupParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicLaboratoryGroupParams.prototype, "ticketLaboratoryGroupId", void 0);


/***/ }),
/* 559 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdatePriorityTicketLaboratoryBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "priority", void 0);
class TicketClinicUpdatePriorityTicketLaboratoryBody {
}
exports.TicketClinicUpdatePriorityTicketLaboratoryBody = TicketClinicUpdatePriorityTicketLaboratoryBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePriorityTicketLaboratoryBody.prototype, "ticketLaboratoryList", void 0);


/***/ }),
/* 560 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryResultUpdateBody = exports.TicketLaboratoryResultUpdate = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketLaboratoryResultUpdate {
}
exports.TicketLaboratoryResultUpdate = TicketLaboratoryResultUpdate;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdate.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdate.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdate.prototype, "ticketLaboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Âm tính' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketLaboratoryResultUpdate.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdate.prototype, "attention", void 0);
class TicketLaboratoryResultUpdateBody {
}
exports.TicketLaboratoryResultUpdateBody = TicketLaboratoryResultUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryResultUpdate, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryResultUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketLaboratoryResultUpdateBody.prototype, "ticketLaboratoryResultUpdateList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdateBody.prototype, "ticketLaboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryResultUpdateBody.prototype, "startedAt", void 0);


/***/ }),
/* 561 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketLaboratoryBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateTicketLaboratoryBody {
}
exports.TicketClinicUpdateTicketLaboratoryBody = TicketClinicUpdateTicketLaboratoryBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketLaboratoryBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketLaboratoryBody)
], TicketClinicUpdateTicketLaboratoryBody.prototype, "ticketLaboratory", void 0);


/***/ }),
/* 562 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpsertLaboratoryBody = exports.TicketLaboratoryGroupUpdateBody = exports.TicketLaboratoryGroupAddBody = exports.TicketLaboratoryAddBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryAddBody {
}
exports.TicketLaboratoryAddBody = TicketLaboratoryAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryAddBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "actualPrice", void 0);
class TicketLaboratoryGroupAddBody {
}
exports.TicketLaboratoryGroupAddBody = TicketLaboratoryGroupAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupAddBody.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupAddBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketLaboratoryGroupAddBody.prototype, "ticketLaboratoryList", void 0);
class TicketLaboratoryGroupUpdateBody extends TicketLaboratoryGroupAddBody {
}
exports.TicketLaboratoryGroupUpdateBody = TicketLaboratoryGroupUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupUpdateBody.prototype, "id", void 0);
class TicketClinicUpsertLaboratoryBody {
}
exports.TicketClinicUpsertLaboratoryBody = TicketClinicUpsertLaboratoryBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryGroupAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryGroupAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpsertLaboratoryBody.prototype, "ticketLaboratoryGroupAddList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryGroupUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryGroupUpdateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketLaboratoryGroupUpdateBody)
], TicketClinicUpsertLaboratoryBody.prototype, "ticketLaboratoryGroupUpdate", void 0);


/***/ }),
/* 563 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_user_module_1 = __webpack_require__(548);
const api_ticket_clinic_procedure_controller_1 = __webpack_require__(564);
const api_ticket_clinic_procedure_service_1 = __webpack_require__(565);
let ApiTicketClinicProcedureModule = class ApiTicketClinicProcedureModule {
};
exports.ApiTicketClinicProcedureModule = ApiTicketClinicProcedureModule;
exports.ApiTicketClinicProcedureModule = ApiTicketClinicProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [api_ticket_clinic_user_module_1.ApiTicketClinicUserModule],
        controllers: [api_ticket_clinic_procedure_controller_1.ApiTicketClinicProcedureController],
        providers: [api_ticket_clinic_procedure_service_1.ApiTicketClinicProcedureService],
    })
], ApiTicketClinicProcedureModule);


/***/ }),
/* 564 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_clinic_procedure_service_1 = __webpack_require__(565);
const request_1 = __webpack_require__(566);
let ApiTicketClinicProcedureController = class ApiTicketClinicProcedureController {
    constructor(apiTicketClinicProcedureService) {
        this.apiTicketClinicProcedureService = apiTicketClinicProcedureService;
    }
    async addTicketProcedure({ oid }, { id }, body) {
        return await this.apiTicketClinicProcedureService.addTicketProcedure({
            oid,
            ticketId: id,
            body,
        });
    }
    async destroyTicketProcedure({ oid }, { ticketId, ticketProcedureId }) {
        return await this.apiTicketClinicProcedureService.destroyTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
        });
    }
    async updateTicketProcedure({ oid }, { ticketId, ticketProcedureId }, body) {
        return await this.apiTicketClinicProcedureService.updateTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
            body,
        });
    }
    async updatePriorityTicketProcedure({ oid }, { id }, body) {
        return await this.apiTicketClinicProcedureService.updatePriorityTicketProcedure({
            oid,
            ticketId: id,
            body,
        });
    }
};
exports.ApiTicketClinicProcedureController = ApiTicketClinicProcedureController;
__decorate([
    (0, common_1.Post)(':id/add-ticket-procedure'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _c : Object, typeof (_d = typeof request_1.TicketClinicAddTicketProcedureBody !== "undefined" && request_1.TicketClinicAddTicketProcedureBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProcedureController.prototype, "addTicketProcedure", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-procedure/:ticketProcedureId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketClinicProcedureParams !== "undefined" && request_1.TicketClinicProcedureParams) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProcedureController.prototype, "destroyTicketProcedure", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-ticket-procedure/:ticketProcedureId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof request_1.TicketClinicProcedureParams !== "undefined" && request_1.TicketClinicProcedureParams) === "function" ? _h : Object, typeof (_j = typeof request_1.TicketClinicUpdateTicketProcedureBody !== "undefined" && request_1.TicketClinicUpdateTicketProcedureBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProcedureController.prototype, "updateTicketProcedure", null);
__decorate([
    (0, common_1.Post)(':id/update-priority-ticket-procedure'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PROCEDURE_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.TicketClinicUpdatePriorityTicketProcedureBody !== "undefined" && request_1.TicketClinicUpdatePriorityTicketProcedureBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProcedureController.prototype, "updatePriorityTicketProcedure", null);
exports.ApiTicketClinicProcedureController = ApiTicketClinicProcedureController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_procedure_service_1.ApiTicketClinicProcedureService !== "undefined" && api_ticket_clinic_procedure_service_1.ApiTicketClinicProcedureService) === "function" ? _a : Object])
], ApiTicketClinicProcedureController);


/***/ }),
/* 565 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProcedureService = void 0;
const common_1 = __webpack_require__(3);
const commission_entity_1 = __webpack_require__(75);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicProcedureService = class ApiTicketClinicProcedureService {
    constructor(socketEmitService, ticketProcedureRepository, ticketClinicAddTicketProcedureOperation, ticketClinicDestroyTicketProcedureOperation, ticketClinicUpdateTicketProcedureOperation, apiTicketClinicUserService) {
        this.socketEmitService = socketEmitService;
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketClinicAddTicketProcedureOperation = ticketClinicAddTicketProcedureOperation;
        this.ticketClinicDestroyTicketProcedureOperation = ticketClinicDestroyTicketProcedureOperation;
        this.ticketClinicUpdateTicketProcedureOperation = ticketClinicUpdateTicketProcedureOperation;
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async addTicketProcedure(options) {
        var _a;
        const { oid, ticketId, body } = options;
        const result = await this.ticketClinicAddTicketProcedureOperation.addTicketProcedure({
            oid,
            ticketId,
            ticketProcedureDto: body.ticketProcedure,
        });
        const { ticket, ticketProcedure } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeTicketProcedureList(oid, {
            ticketId,
            ticketProcedureInsert: ticketProcedure,
        });
        if ((_a = body.ticketUserList) === null || _a === void 0 ? void 0 : _a.length) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Procedure,
                    interactId: ticketProcedure.procedureId,
                    ticketItemId: ticketProcedure.id,
                    quantity: ticketProcedure.quantity,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async destroyTicketProcedure(options) {
        const { oid, ticketId, ticketProcedureId } = options;
        const result = await this.ticketClinicDestroyTicketProcedureOperation.destroyTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
        });
        const { ticket } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeTicketProcedureList(oid, {
            ticketId,
            ticketProcedureDestroy: result.ticketProcedureDestroy,
        });
        if (result.ticketUserDestroyList) {
            this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return { data: true };
    }
    async updateTicketProcedure(options) {
        const { oid, ticketId, ticketProcedureId, body } = options;
        const result = await this.ticketClinicUpdateTicketProcedureOperation.updateTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
            ticketProcedureUpdateDto: body.ticketProcedure,
        });
        const { ticket, ticketProcedure } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeTicketProcedureList(oid, {
            ticketId,
            ticketProcedureUpdate: ticketProcedure,
        });
        if (body.ticketUserList) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Procedure,
                    interactId: ticketProcedure.procedureId,
                    ticketItemId: ticketProcedure.id,
                    quantity: ticketProcedure.quantity,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async updatePriorityTicketProcedure(options) {
        const { oid, ticketId, body } = options;
        const ticketProcedureList = await this.ticketProcedureRepository.updatePriorityList({
            oid,
            ticketId,
            updateData: body.ticketProcedureList,
        });
        ticketProcedureList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        this.socketEmitService.ticketClinicChangeTicketProcedureList(oid, {
            ticketId,
            ticketProcedureList,
        });
        return { data: true };
    }
};
exports.ApiTicketClinicProcedureService = ApiTicketClinicProcedureService;
exports.ApiTicketClinicProcedureService = ApiTicketClinicProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.TicketClinicAddTicketProcedureOperation !== "undefined" && operations_1.TicketClinicAddTicketProcedureOperation) === "function" ? _c : Object, typeof (_d = typeof operations_1.TicketClinicDestroyTicketProcedureOperation !== "undefined" && operations_1.TicketClinicDestroyTicketProcedureOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketClinicUpdateTicketProcedureOperation !== "undefined" && operations_1.TicketClinicUpdateTicketProcedureOperation) === "function" ? _e : Object, typeof (_f = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _f : Object])
], ApiTicketClinicProcedureService);


/***/ }),
/* 566 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(567), exports);
__exportStar(__webpack_require__(568), exports);
__exportStar(__webpack_require__(569), exports);
__exportStar(__webpack_require__(570), exports);


/***/ }),
/* 567 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "procedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedureBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "actualPrice", void 0);
class TicketClinicAddTicketProcedureBody {
}
exports.TicketClinicAddTicketProcedureBody = TicketClinicAddTicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicAddTicketProcedureBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProcedureBody)
], TicketClinicAddTicketProcedureBody.prototype, "ticketProcedure", void 0);


/***/ }),
/* 568 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicProcedureParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketClinicProcedureParams {
}
exports.TicketClinicProcedureParams = TicketClinicProcedureParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicProcedureParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicProcedureParams.prototype, "ticketProcedureId", void 0);


/***/ }),
/* 569 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdatePriorityTicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "priority", void 0);
class TicketClinicUpdatePriorityTicketProcedureBody {
}
exports.TicketClinicUpdatePriorityTicketProcedureBody = TicketClinicUpdatePriorityTicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePriorityTicketProcedureBody.prototype, "ticketProcedureList", void 0);


/***/ }),
/* 570 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedureBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateTicketProcedureBody {
}
exports.TicketClinicUpdateTicketProcedureBody = TicketClinicUpdateTicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketProcedureBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProcedureBody)
], TicketClinicUpdateTicketProcedureBody.prototype, "ticketProcedure", void 0);


/***/ }),
/* 571 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_user_module_1 = __webpack_require__(548);
const api_ticket_clinic_product_controller_1 = __webpack_require__(572);
const api_ticket_clinic_product_service_1 = __webpack_require__(573);
let ApiTicketClinicProductModule = class ApiTicketClinicProductModule {
};
exports.ApiTicketClinicProductModule = ApiTicketClinicProductModule;
exports.ApiTicketClinicProductModule = ApiTicketClinicProductModule = __decorate([
    (0, common_1.Module)({
        imports: [api_ticket_clinic_user_module_1.ApiTicketClinicUserModule],
        controllers: [api_ticket_clinic_product_controller_1.ApiTicketClinicProductController],
        providers: [api_ticket_clinic_product_service_1.ApiTicketClinicProductService],
    })
], ApiTicketClinicProductModule);


/***/ }),
/* 572 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const ticket_product_entity_1 = __webpack_require__(69);
const request_1 = __webpack_require__(283);
const ticket_params_1 = __webpack_require__(296);
const api_ticket_clinic_product_service_1 = __webpack_require__(573);
const request_2 = __webpack_require__(574);
let ApiTicketClinicProductController = class ApiTicketClinicProductController {
    constructor(apiTicketClinicProductService) {
        this.apiTicketClinicProductService = apiTicketClinicProductService;
    }
    async addTicketProductConsumable({ oid }, { id }, body) {
        return await this.apiTicketClinicProductService.addTicketProductList({
            oid,
            ticketId: id,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
    }
    async addTicketProductPrescription({ oid }, { id }, body) {
        return await this.apiTicketClinicProductService.addTicketProductList({
            oid,
            ticketId: id,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
    }
    async destroyTicketProductConsumable({ oid }, { ticketId, ticketProductId }) {
        return await this.apiTicketClinicProductService.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
        });
    }
    async destroyTicketProductPrescription({ oid }, { ticketId, ticketProductId }) {
        return await this.apiTicketClinicProductService.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
        });
    }
    async updatePriorityTicketProductConsumable({ oid }, { id }, body) {
        return await this.apiTicketClinicProductService.updatePriorityTicketProduct({
            oid,
            ticketId: id,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
    }
    async updatePriorityTicketProductPrescription({ oid }, { id }, body) {
        return await this.apiTicketClinicProductService.updatePriorityTicketProduct({
            oid,
            ticketId: id,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
    }
    async updateTicketProductConsumable({ oid }, { ticketId, ticketProductId }, body) {
        return await this.apiTicketClinicProductService.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
    }
    async updateTicketProductPrescription({ oid }, { ticketId, ticketProductId }, body) {
        return await this.apiTicketClinicProductService.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
    }
    async sendProduct({ oid }, { ticketId }) {
        return await this.apiTicketClinicProductService.sendProduct({ oid, ticketId });
    }
    async returnProduct({ oid }, { ticketId }, body) {
        return await this.apiTicketClinicProductService.returnProduct({ oid, ticketId, body });
    }
};
exports.ApiTicketClinicProductController = ApiTicketClinicProductController;
__decorate([
    (0, common_1.Post)(':id/add-ticket-product-consumable-list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _c : Object, typeof (_d = typeof request_2.TicketClinicAddTicketProductListBody !== "undefined" && request_2.TicketClinicAddTicketProductListBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "addTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':id/add-ticket-product-prescription-list'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketClinicAddTicketProductListBody !== "undefined" && request_2.TicketClinicAddTicketProductListBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "addTicketProductPrescription", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-product-consumable/:ticketProductId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_2.TicketClinicProductParams !== "undefined" && request_2.TicketClinicProductParams) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "destroyTicketProductConsumable", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-product-prescription/:ticketProductId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_2.TicketClinicProductParams !== "undefined" && request_2.TicketClinicProductParams) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "destroyTicketProductPrescription", null);
__decorate([
    (0, common_1.Post)(':id/update-priority-ticket-product-consumable'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_2.TicketClinicUpdatePriorityTicketProductBody !== "undefined" && request_2.TicketClinicUpdatePriorityTicketProductBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "updatePriorityTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':id/update-priority-ticket-product-prescription'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_2.TicketClinicUpdatePriorityTicketProductBody !== "undefined" && request_2.TicketClinicUpdatePriorityTicketProductBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "updatePriorityTicketProductPrescription", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-ticket-product-consumable/:ticketProductId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof request_2.TicketClinicProductParams !== "undefined" && request_2.TicketClinicProductParams) === "function" ? _u : Object, typeof (_v = typeof request_2.TicketClinicUpdateTicketProductBody !== "undefined" && request_2.TicketClinicUpdateTicketProductBody) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "updateTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-ticket-product-prescription/:ticketProductId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof request_2.TicketClinicProductParams !== "undefined" && request_2.TicketClinicProductParams) === "function" ? _x : Object, typeof (_y = typeof request_2.TicketClinicUpdateTicketProductBody !== "undefined" && request_2.TicketClinicUpdateTicketProductBody) === "function" ? _y : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "updateTicketProductPrescription", null);
__decorate([
    (0, common_1.Post)(':ticketId/send-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_SEND_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_z = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _z : Object, typeof (_0 = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _0 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "sendProduct", null);
__decorate([
    (0, common_1.Post)(':ticketId/return-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_RETURN_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_1 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _1 : Object, typeof (_2 = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _2 : Object, typeof (_3 = typeof request_1.TicketReturnProductListBody !== "undefined" && request_1.TicketReturnProductListBody) === "function" ? _3 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicProductController.prototype, "returnProduct", null);
exports.ApiTicketClinicProductController = ApiTicketClinicProductController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_product_service_1.ApiTicketClinicProductService !== "undefined" && api_ticket_clinic_product_service_1.ApiTicketClinicProductService) === "function" ? _a : Object])
], ApiTicketClinicProductController);


/***/ }),
/* 573 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicProductService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const commission_entity_1 = __webpack_require__(75);
const ticket_product_entity_1 = __webpack_require__(69);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicProductService = class ApiTicketClinicProductService {
    constructor(socketEmitService, cacheDataService, ticketProductRepository, ticketClinicAddTicketProductOperation, ticketClinicDestroyTicketProductOperation, ticketClinicUpdateTicketProductOperation, ticketSendProductOperation, ticketReturnProductOperation, apiTicketClinicUserService) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.ticketProductRepository = ticketProductRepository;
        this.ticketClinicAddTicketProductOperation = ticketClinicAddTicketProductOperation;
        this.ticketClinicDestroyTicketProductOperation = ticketClinicDestroyTicketProductOperation;
        this.ticketClinicUpdateTicketProductOperation = ticketClinicUpdateTicketProductOperation;
        this.ticketSendProductOperation = ticketSendProductOperation;
        this.ticketReturnProductOperation = ticketReturnProductOperation;
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async addTicketProductList(options) {
        const { oid, ticketId, ticketProductType, body } = options;
        const result = await this.ticketClinicAddTicketProductOperation.addTicketProductList({
            oid,
            ticketId,
            ticketProductType,
            ticketProductDtoList: body.ticketProductList,
        });
        const { ticket } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductUpsertList: result.ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductUpsertList: result.ticketProductList,
            });
        }
        return { data: true };
    }
    async destroyTicketProduct(options) {
        const { oid, ticketId, ticketProductId, ticketProductType } = options;
        const result = await this.ticketClinicDestroyTicketProductOperation.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType,
        });
        const { ticket, ticketProductDestroy } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        if (ticketProductDestroy.type === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductDestroyList: [ticketProductDestroy],
            });
        }
        if (ticketProductDestroy.type === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductDestroyList: [ticketProductDestroy],
            });
        }
        if (result.ticketUserDestroyList) {
            this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return { data: true };
    }
    async updatePriorityTicketProduct(options) {
        const { oid, ticketId, body, ticketProductType } = options;
        const ticketProductList = await this.ticketProductRepository.updatePriorityList({
            oid,
            ticketId,
            updateData: body.ticketProductList,
        });
        ticketProductList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList,
            });
        }
        return { data: true };
    }
    async updateTicketProduct(options) {
        const { oid, ticketId, ticketProductId, ticketProductType, body } = options;
        const result = await this.ticketClinicUpdateTicketProductOperation.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType,
            ticketProductUpdateDto: body.ticketProduct,
        });
        const { ticket, ticketProduct } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        if (ticketProduct.type === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductUpsertList: [ticketProduct],
            });
        }
        if (ticketProduct.type === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductUpsertList: [ticketProduct],
            });
        }
        if (body.ticketUserList) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Product,
                    interactId: ticketProduct.productId,
                    ticketItemId: ticketProduct.id,
                    quantity: ticketProduct.quantity,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async sendProduct(params) {
        const { oid, ticketId } = params;
        const time = Date.now();
        const allowNegativeQuantity = await this.cacheDataService.getSettingAllowNegativeQuantity(oid);
        const sendProductResult = await this.ticketSendProductOperation.sendAllProduct({
            oid,
            ticketId,
            time,
            allowNegativeQuantity,
        });
        this.socketEmitService.ticketClinicChange(oid, {
            type: 'UPDATE',
            ticket: sendProductResult.ticket,
        });
        if (sendProductResult.productModifiedList) {
            this.socketEmitService.productListUpdate(oid, {
                productList: sendProductResult.productModifiedList,
            });
        }
        if (sendProductResult.ticketProductModifiedList) {
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductUpsertList: sendProductResult.ticketProductModifiedList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Consumable;
                }),
            });
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductUpsertList: sendProductResult.ticketProductModifiedList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Prescription;
                }),
            });
        }
        return { data: true };
    }
    async returnProduct(params) {
        const { oid, ticketId, body } = params;
        try {
            const result = await this.ticketReturnProductOperation.returnProduct({
                oid,
                ticketId,
                time: Date.now(),
                returnList: body.returnList,
            });
            this.socketEmitService.productListUpdate(oid, { productList: result.productModifiedList });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: result.ticket });
            if (result.ticketUserModifiedList) {
                this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
                    ticketId,
                    ticketUserDestroyList: result.ticketUserDestroyedList,
                    ticketUserUpsertList: result.ticketUserModifiedList,
                });
            }
            const [ticketProductList] = await Promise.all([
                this.ticketProductRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { id: 'ASC' },
                }),
            ]);
            this.socketEmitService.ticketClinicChangeConsumable(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Consumable;
                }),
            });
            this.socketEmitService.ticketClinicChangePrescription(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Prescription;
                }),
            });
            return { data: { ticket: result.ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
};
exports.ApiTicketClinicProductService = ApiTicketClinicProductService;
exports.ApiTicketClinicProductService = ApiTicketClinicProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _c : Object, typeof (_d = typeof operations_1.TicketClinicAddTicketProductOperation !== "undefined" && operations_1.TicketClinicAddTicketProductOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketClinicDestroyTicketProductOperation !== "undefined" && operations_1.TicketClinicDestroyTicketProductOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketClinicUpdateTicketProductOperation !== "undefined" && operations_1.TicketClinicUpdateTicketProductOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketSendProductOperation !== "undefined" && operations_1.TicketSendProductOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketReturnProductOperation !== "undefined" && operations_1.TicketReturnProductOperation) === "function" ? _h : Object, typeof (_j = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _j : Object])
], ApiTicketClinicProductService);


/***/ }),
/* 574 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(575), exports);
__exportStar(__webpack_require__(576), exports);
__exportStar(__webpack_require__(577), exports);
__exportStar(__webpack_require__(578), exports);
__exportStar(__webpack_require__(579), exports);


/***/ }),
/* 575 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketProductListBody = exports.TicketProductAddBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketProductAddBody {
}
exports.TicketProductAddBody = TicketProductAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.PickupStrategy, example: variable_1.PickupStrategy.AutoWithExpiryDate }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PickupStrategy),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketProductAddBody.prototype, "pickupStrategy", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], TicketProductAddBody.prototype, "warehouseIds", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketProductAddBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductAddBody.prototype, "hintUsage", void 0);
class TicketClinicAddTicketProductListBody {
}
exports.TicketClinicAddTicketProductListBody = TicketClinicAddTicketProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicAddTicketProductListBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 576 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicProductParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketClinicProductParams {
}
exports.TicketClinicProductParams = TicketClinicProductParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicProductParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicProductParams.prototype, "ticketProductId", void 0);


/***/ }),
/* 577 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdatePriorityTicketProductBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "priority", void 0);
class TicketClinicUpdatePriorityTicketProductBody {
}
exports.TicketClinicUpdatePriorityTicketProductBody = TicketClinicUpdatePriorityTicketProductBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePriorityTicketProductBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 578 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketProductListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductBody.prototype, "hintUsage", void 0);
class TicketClinicUpdateTicketProductListBody {
}
exports.TicketClinicUpdateTicketProductListBody = TicketClinicUpdateTicketProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketProductListBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 579 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketProductBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductBody.prototype, "hintUsage", void 0);
class TicketClinicUpdateTicketProductBody {
}
exports.TicketClinicUpdateTicketProductBody = TicketClinicUpdateTicketProductBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketProductBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProductBody)
], TicketClinicUpdateTicketProductBody.prototype, "ticketProduct", void 0);


/***/ }),
/* 580 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_clinic_user_module_1 = __webpack_require__(548);
const api_ticket_clinic_radiology_controller_1 = __webpack_require__(581);
const api_ticket_clinic_radiology_service_1 = __webpack_require__(582);
let ApiTicketClinicRadiologyModule = class ApiTicketClinicRadiologyModule {
};
exports.ApiTicketClinicRadiologyModule = ApiTicketClinicRadiologyModule;
exports.ApiTicketClinicRadiologyModule = ApiTicketClinicRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [api_ticket_clinic_user_module_1.ApiTicketClinicUserModule],
        controllers: [api_ticket_clinic_radiology_controller_1.ApiTicketClinicRadiologyController],
        providers: [api_ticket_clinic_radiology_service_1.ApiTicketClinicRadiologyService],
    })
], ApiTicketClinicRadiologyModule);


/***/ }),
/* 581 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const interceptor_1 = __webpack_require__(271);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_clinic_radiology_service_1 = __webpack_require__(582);
const request_1 = __webpack_require__(583);
let ApiTicketClinicRadiologyController = class ApiTicketClinicRadiologyController {
    constructor(apiTicketClinicRadiologyService) {
        this.apiTicketClinicRadiologyService = apiTicketClinicRadiologyService;
    }
    async addTicketRadiology({ oid }, { id }, body) {
        return await this.apiTicketClinicRadiologyService.addTicketRadiology({
            oid,
            ticketId: id,
            body,
        });
    }
    async destroyTicketRadiology({ oid }, { ticketId, ticketRadiologyId }) {
        return await this.apiTicketClinicRadiologyService.destroyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
        });
    }
    async updateTicketLaboratory({ oid }, { ticketId, ticketRadiologyId }, body) {
        return await this.apiTicketClinicRadiologyService.updateMoneyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
            body,
        });
    }
    async updateTicketRadiology({ oid }, { ticketId, ticketRadiologyId }, body, files) {
        return await this.apiTicketClinicRadiologyService.updateResultTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
            body,
            files,
        });
    }
    async updatePriorityTicketRadiology({ oid }, { id }, body) {
        return await this.apiTicketClinicRadiologyService.updatePriorityTicketRadiology({
            oid,
            ticketId: id,
            body,
        });
    }
};
exports.ApiTicketClinicRadiologyController = ApiTicketClinicRadiologyController;
__decorate([
    (0, common_1.Post)(':id/add-ticket-radiology'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _c : Object, typeof (_d = typeof request_1.TicketClinicAddTicketRadiologyBody !== "undefined" && request_1.TicketClinicAddTicketRadiologyBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicRadiologyController.prototype, "addTicketRadiology", null);
__decorate([
    (0, common_1.Delete)(':ticketId/destroy-ticket-radiology/:ticketRadiologyId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketClinicRadiologyParams !== "undefined" && request_1.TicketClinicRadiologyParams) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicRadiologyController.prototype, "destroyTicketRadiology", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-money-ticket-radiology/:ticketRadiologyId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof request_1.TicketClinicRadiologyParams !== "undefined" && request_1.TicketClinicRadiologyParams) === "function" ? _h : Object, typeof (_j = typeof request_1.TicketClinicUpdateMoneyTicketRadiologyBody !== "undefined" && request_1.TicketClinicUpdateMoneyTicketRadiologyBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicRadiologyController.prototype, "updateTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':ticketId/update-result-ticket-radiology/:ticketRadiologyId'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __param(3, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.TicketClinicRadiologyParams !== "undefined" && request_1.TicketClinicRadiologyParams) === "function" ? _l : Object, typeof (_m = typeof request_1.TicketClinicUpdateResultTicketRadiologyBody !== "undefined" && request_1.TicketClinicUpdateResultTicketRadiologyBody) === "function" ? _m : Object, Array]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicRadiologyController.prototype, "updateTicketRadiology", null);
__decorate([
    (0, common_1.Post)(':id/update-priority-ticket-radiology'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_RADIOLOGY_LIST),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _p : Object, typeof (_q = typeof request_1.TicketClinicUpdatePriorityTicketRadiologyBody !== "undefined" && request_1.TicketClinicUpdatePriorityTicketRadiologyBody) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicRadiologyController.prototype, "updatePriorityTicketRadiology", null);
exports.ApiTicketClinicRadiologyController = ApiTicketClinicRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_radiology_service_1.ApiTicketClinicRadiologyService !== "undefined" && api_ticket_clinic_radiology_service_1.ApiTicketClinicRadiologyService) === "function" ? _a : Object])
], ApiTicketClinicRadiologyController);


/***/ }),
/* 582 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const commission_entity_1 = __webpack_require__(75);
const ticket_radiology_entity_1 = __webpack_require__(70);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const image_manager_service_1 = __webpack_require__(392);
const socket_emit_service_1 = __webpack_require__(306);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicRadiologyService = class ApiTicketClinicRadiologyService {
    constructor(socketEmitService, imageManagerService, imageRepository, ticketRadiologyRepository, ticketClinicAddTicketRadiologyOperation, ticketClinicDestroyTicketRadiologyOperation, ticketClinicUpdateTicketRadiologyOperation, apiTicketClinicUserService) {
        this.socketEmitService = socketEmitService;
        this.imageManagerService = imageManagerService;
        this.imageRepository = imageRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.ticketClinicAddTicketRadiologyOperation = ticketClinicAddTicketRadiologyOperation;
        this.ticketClinicDestroyTicketRadiologyOperation = ticketClinicDestroyTicketRadiologyOperation;
        this.ticketClinicUpdateTicketRadiologyOperation = ticketClinicUpdateTicketRadiologyOperation;
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async addTicketRadiology(options) {
        const { oid, ticketId, body } = options;
        const result = await this.ticketClinicAddTicketRadiologyOperation.addTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyInsertDto: Object.assign(Object.assign({}, body), { oid,
                ticketId, imageIds: JSON.stringify([]), description: '', result: '', startedAt: null, status: ticket_radiology_entity_1.TicketRadiologyStatus.Pending }),
        });
        const { ticket, ticketRadiology } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeTicketRadiologyList(oid, {
            ticketId,
            ticketRadiologyInsert: ticketRadiology,
        });
        return { data: true };
    }
    async destroyTicketRadiology(options) {
        const { oid, ticketId, ticketRadiologyId } = options;
        const ticketRadiologyOrigin = await this.ticketRadiologyRepository.findOneBy({
            oid,
            id: ticketRadiologyId,
        });
        const imageIdsUpdate = await this.imageManagerService.changeImageList({
            oid,
            customerId: ticketRadiologyOrigin.customerId,
            files: [],
            filesPosition: [],
            imageIdsKeep: [],
            imageIdsOld: JSON.parse(ticketRadiologyOrigin.imageIds),
        });
        const result = await this.ticketClinicDestroyTicketRadiologyOperation.destroyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
        });
        const { ticket } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.ticketClinicChangeTicketRadiologyList(oid, {
            ticketId,
            ticketRadiologyDestroy: result.ticketRadiologyDestroy,
        });
        if (result.ticketUserDestroyList.length) {
            this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return { data: true };
    }
    async updateMoneyTicketRadiology(options) {
        var _a;
        const { oid, ticketId, ticketRadiologyId, body } = options;
        const result = await this.ticketClinicUpdateTicketRadiologyOperation.updateTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
            ticketRadiologyUpdateDto: body.ticketRadiology,
        });
        const { ticket, ticketRadiology } = result;
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: result.ticket });
        this.socketEmitService.ticketClinicChangeTicketRadiologyList(oid, {
            ticketId,
            ticketRadiologyUpdate: result.ticketRadiology,
        });
        if ((_a = body.ticketUserList) === null || _a === void 0 ? void 0 : _a.length) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Radiology,
                    interactId: ticketRadiology.radiologyId,
                    ticketItemId: ticketRadiology.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async updateResultTicketRadiology(options) {
        var _a;
        const { oid, ticketId, ticketRadiologyId, body, files } = options;
        const ticketRadiologyOrigin = await this.ticketRadiologyRepository.findOneBy({
            oid,
            id: ticketRadiologyId,
        });
        const imageIdsUpdate = await this.imageManagerService.changeImageList({
            oid,
            customerId: ticketRadiologyOrigin.customerId,
            files,
            filesPosition: body.filesPosition,
            imageIdsKeep: body.imageIdsKeep,
            imageIdsOld: JSON.parse(ticketRadiologyOrigin.imageIds),
        });
        const ticketRadiologyModified = await this.ticketRadiologyRepository.updateOneAndReturnEntity({
            oid,
            ticketId,
            id: ticketRadiologyId,
        }, {
            description: body.ticketRadiology.description,
            result: body.ticketRadiology.result,
            startedAt: body.ticketRadiology.startedAt,
            imageIds: JSON.stringify(imageIdsUpdate),
            status: ticket_radiology_entity_1.TicketRadiologyStatus.Completed,
        });
        ticketRadiologyModified.imageList = [];
        const imageIds = JSON.parse(ticketRadiologyModified.imageIds);
        if (imageIds.length) {
            ticketRadiologyModified.imageList = await this.imageRepository.findManyByIds(imageIds);
        }
        this.socketEmitService.ticketClinicChangeTicketRadiologyList(oid, {
            ticketId,
            ticketRadiologyUpdate: ticketRadiologyModified,
        });
        if ((_a = body.ticketUserList) === null || _a === void 0 ? void 0 : _a.length) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Radiology,
                    interactId: ticketRadiologyModified.radiologyId,
                    ticketItemId: ticketRadiologyModified.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async updatePriorityTicketRadiology(options) {
        const { oid, ticketId, body } = options;
        const ticketRadiologyList = await this.ticketRadiologyRepository.updatePriorityList({
            oid,
            ticketId,
            updateData: body.ticketRadiologyList,
        });
        ticketRadiologyList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        this.socketEmitService.ticketClinicChangeTicketRadiologyList(oid, {
            ticketId,
            ticketRadiologyList,
        });
        return { data: true };
    }
};
exports.ApiTicketClinicRadiologyService = ApiTicketClinicRadiologyService;
exports.ApiTicketClinicRadiologyService = ApiTicketClinicRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ImageRepository !== "undefined" && repositories_1.ImageRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketClinicAddTicketRadiologyOperation !== "undefined" && operations_1.TicketClinicAddTicketRadiologyOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketClinicDestroyTicketRadiologyOperation !== "undefined" && operations_1.TicketClinicDestroyTicketRadiologyOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketClinicUpdateTicketRadiologyOperation !== "undefined" && operations_1.TicketClinicUpdateTicketRadiologyOperation) === "function" ? _g : Object, typeof (_h = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _h : Object])
], ApiTicketClinicRadiologyService);


/***/ }),
/* 583 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(584), exports);
__exportStar(__webpack_require__(585), exports);
__exportStar(__webpack_require__(586), exports);
__exportStar(__webpack_require__(587), exports);
__exportStar(__webpack_require__(588), exports);


/***/ }),
/* 584 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicAddTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketClinicAddTicketRadiologyBody {
}
exports.TicketClinicAddTicketRadiologyBody = TicketClinicAddTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "radiologyId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketClinicAddTicketRadiologyBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicAddTicketRadiologyBody.prototype, "actualPrice", void 0);


/***/ }),
/* 585 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicRadiologyParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketClinicRadiologyParams {
}
exports.TicketClinicRadiologyParams = TicketClinicRadiologyParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicRadiologyParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicRadiologyParams.prototype, "ticketRadiologyId", void 0);


/***/ }),
/* 586 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateMoneyTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketRadiologyBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketRadiologyBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateMoneyTicketRadiologyBody {
}
exports.TicketClinicUpdateMoneyTicketRadiologyBody = TicketClinicUpdateMoneyTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateMoneyTicketRadiologyBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketRadiologyBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketRadiologyBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketRadiologyBody)
], TicketClinicUpdateMoneyTicketRadiologyBody.prototype, "ticketRadiology", void 0);


/***/ }),
/* 587 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdatePriorityTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class TicketRadiologyBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "priority", void 0);
class TicketClinicUpdatePriorityTicketRadiologyBody {
}
exports.TicketClinicUpdatePriorityTicketRadiologyBody = TicketClinicUpdatePriorityTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketRadiologyBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketRadiologyBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePriorityTicketRadiologyBody.prototype, "ticketRadiologyList", void 0);


/***/ }),
/* 588 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateResultTicketRadiologyBody = exports.TicketRadiologyUpdateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const DOMPurify = __webpack_require__(485);
const file_1 = __webpack_require__(270);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketRadiologyUpdateBody extends file_1.MultipleFileUpload {
}
exports.TicketRadiologyUpdateBody = TicketRadiologyUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Mổ viêm ruột thừa 2002' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => DOMPurify.sanitize(value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "description", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Trước khi vào khám 5 ngày, bla...bla...' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? Number(value) : value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyUpdateBody.prototype, "startedAt", void 0);
class TicketClinicUpdateResultTicketRadiologyBody extends file_1.MultipleFileUpload {
}
exports.TicketClinicUpdateResultTicketRadiologyBody = TicketClinicUpdateResultTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: String, example: JSON.stringify([3, 4]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? JSON.parse(value) : value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateResultTicketRadiologyBody.prototype, "imageIdsKeep", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: String, example: JSON.stringify([3, 4]) }),
    __metadata("design:type", Object)
], TicketClinicUpdateResultTicketRadiologyBody.prototype, "G", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? JSON.parse(value) : value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateResultTicketRadiologyBody.prototype, "filesPosition", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ userId: 1, roleId: 2 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new ticket_clinic_update_user_list_body_1.TicketUserBasicBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length)
                    err.push(...validate);
                return instance;
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)({
        message: ({ value }) => `Validate TicketUserBasicBody failed. Value = ${JSON.stringify(value)}. Example: `
            + JSON.stringify([{ userId: 1, roleId: 2 }]),
    }),
    __metadata("design:type", Array)
], TicketClinicUpdateResultTicketRadiologyBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new TicketRadiologyUpdateBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length)
                return JSON.stringify(validate);
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${JSON.stringify(value)}. Example: `
            + JSON.stringify({
                description: '',
                startedAt: Date.now(),
                result: '',
            }),
    }),
    __metadata("design:type", TicketRadiologyUpdateBody)
], TicketClinicUpdateResultTicketRadiologyBody.prototype, "ticketRadiology", void 0);


/***/ }),
/* 589 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const interceptor_1 = __webpack_require__(271);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const request_1 = __webpack_require__(283);
const api_ticket_clinic_service_1 = __webpack_require__(590);
const request_2 = __webpack_require__(591);
const ticket_clinic_update_diagnosis_body_1 = __webpack_require__(594);
let ApiTicketClinicController = class ApiTicketClinicController {
    constructor(apiTicketClinicService) {
        this.apiTicketClinicService = apiTicketClinicService;
    }
    async create({ oid }, body) {
        return await this.apiTicketClinicService.create({
            oid,
            body,
        });
    }
    async update({ oid }, { id }, body) {
        return await this.apiTicketClinicService.update({
            oid,
            ticketId: id,
            body,
        });
    }
    async startCheckup({ oid }, { id }) {
        return await this.apiTicketClinicService.startCheckup({ oid, ticketId: id });
    }
    async updateDiagnosisBasic({ oid }, files, { id }, body) {
        return await this.apiTicketClinicService.updateDiagnosis({
            oid,
            ticketId: id,
            body,
            files,
        });
    }
    async changeDiscount({ oid }, { id }, body) {
        return await this.apiTicketClinicService.changeDiscount({ oid, ticketId: id, body });
    }
    async prepayment({ oid, uid }, { id }, body) {
        return await this.apiTicketClinicService.prepayment({ oid, userId: uid, ticketId: id, body });
    }
    async refundOverpaid({ oid, uid }, { id }, body) {
        return await this.apiTicketClinicService.refundOverpaid({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
    }
    async payDebt({ oid, uid }, { id }, body) {
        return await this.apiTicketClinicService.payDebt({ oid, userId: uid, ticketId: id, body });
    }
    async close({ oid, uid }, { id }) {
        return await this.apiTicketClinicService.close({ oid, userId: uid, ticketId: id });
    }
    async reopen({ oid, uid }, { id }) {
        return await this.apiTicketClinicService.reopen({ oid, userId: uid, ticketId: id });
    }
    async destroy({ oid }, { id }) {
        return await this.apiTicketClinicService.destroy({
            oid,
            ticketId: id,
        });
    }
};
exports.ApiTicketClinicController = ApiTicketClinicController;
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_2.TicketClinicCreateBody !== "undefined" && request_2.TicketClinicCreateBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "create", null);
__decorate([
    (0, common_1.Post)(':id/update'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_2.TicketClinicUpdateBody !== "undefined" && request_2.TicketClinicUpdateBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "update", null);
__decorate([
    (0, common_1.Post)(':id/start-checkup'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_START_CHECKUP),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "startCheckup", null);
__decorate([
    (0, common_1.Post)(':id/update-diagnosis'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_UPDATE_TICKET_ATTRIBUTE),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFiles)()),
    __param(2, (0, common_1.Param)()),
    __param(3, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, Array, typeof (_k = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof ticket_clinic_update_diagnosis_body_1.TicketClinicUpdateDiagnosisBody !== "undefined" && ticket_clinic_update_diagnosis_body_1.TicketClinicUpdateDiagnosisBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "updateDiagnosisBasic", null);
__decorate([
    (0, common_1.Post)(':id/change-discount'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_CHANGE_DISCOUNT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_2.TicketClinicChangeDiscountBody !== "undefined" && request_2.TicketClinicChangeDiscountBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "changeDiscount", null);
__decorate([
    (0, common_1.Post)(':id/prepayment'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "prepayment", null);
__decorate([
    (0, common_1.Post)(':id/refund-overpaid'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_REFUND_OVERPAID),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _u : Object, typeof (_v = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "refundOverpaid", null);
__decorate([
    (0, common_1.Post)(':id/pay-debt'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _x : Object, typeof (_y = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _y : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "payDebt", null);
__decorate([
    (0, common_1.Post)(':id/close'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_z = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _z : Object, typeof (_0 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _0 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "close", null);
__decorate([
    (0, common_1.Post)(':id/reopen'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_REOPEN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_1 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _1 : Object, typeof (_2 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _2 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "reopen", null);
__decorate([
    (0, common_1.Delete)(':id/destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_CLINIC_DESTROY_DRAFT_SCHEDULE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_3 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _3 : Object, typeof (_4 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _4 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketClinicController.prototype, "destroy", null);
exports.ApiTicketClinicController = ApiTicketClinicController = __decorate([
    (0, swagger_1.ApiTags)('TicketClinic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-clinic'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_clinic_service_1.ApiTicketClinicService !== "undefined" && api_ticket_clinic_service_1.ApiTicketClinicService) === "function" ? _a : Object])
], ApiTicketClinicController);


/***/ }),
/* 590 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketClinicService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const time_helper_1 = __webpack_require__(146);
const variable_1 = __webpack_require__(21);
const appointment_entity_1 = __webpack_require__(44);
const commission_entity_1 = __webpack_require__(75);
const ticket_radiology_entity_1 = __webpack_require__(70);
const ticket_entity_1 = __webpack_require__(56);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const image_repository_1 = __webpack_require__(177);
const image_manager_service_1 = __webpack_require__(392);
const socket_emit_service_1 = __webpack_require__(306);
const api_ticket_clinic_user_service_1 = __webpack_require__(550);
let ApiTicketClinicService = class ApiTicketClinicService {
    constructor(socketEmitService, imageManagerService, imageRepository, customerRepository, appointmentRepository, ticketRepository, ticketAttributeRepository, ticketChangeDiscountOperation, ticketRefundMoneyOperation, ticketPrepaymentOperation, ticketPaymentAndCloseOperation, ticketPayDebtOperation, ticketReopenOperation, apiTicketClinicUserService) {
        this.socketEmitService = socketEmitService;
        this.imageManagerService = imageManagerService;
        this.imageRepository = imageRepository;
        this.customerRepository = customerRepository;
        this.appointmentRepository = appointmentRepository;
        this.ticketRepository = ticketRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.ticketChangeDiscountOperation = ticketChangeDiscountOperation;
        this.ticketRefundMoneyOperation = ticketRefundMoneyOperation;
        this.ticketPrepaymentOperation = ticketPrepaymentOperation;
        this.ticketPaymentAndCloseOperation = ticketPaymentAndCloseOperation;
        this.ticketPayDebtOperation = ticketPayDebtOperation;
        this.ticketReopenOperation = ticketReopenOperation;
        this.apiTicketClinicUserService = apiTicketClinicUserService;
    }
    async create(options) {
        const { oid, body } = options;
        const { registeredAt, status } = body.ticketInformation;
        let customer;
        if (!body.ticketInformation.customerId) {
            customer = await this.customerRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body.customer), { debt: 0, oid }));
            this.socketEmitService.customerUpsert(oid, { customer });
        }
        else {
            customer = await this.customerRepository.findOneBy({
                oid,
                id: body.ticketInformation.customerId,
            });
        }
        if (!customer)
            throw new exception_filter_1.BusinessException('error.SystemError');
        const countToday = await this.ticketRepository.countToday(oid);
        const ticket = await this.ticketRepository.insertOneAndReturnEntity({
            oid,
            customerId: customer.id,
            ticketType: body.ticketInformation.ticketType,
            status,
            registeredAt,
            startedAt: status === ticket_entity_1.TicketStatus.Executing ? registeredAt : null,
            customerSourceId: body.ticketInformation.customerSourceId,
            customType: body.ticketInformation.customType,
            dailyIndex: countToday + 1,
            year: time_helper_1.ESTimer.info(registeredAt, 7).year,
            month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1,
            date: time_helper_1.ESTimer.info(registeredAt, 7).date,
        });
        ticket.customer = customer;
        if (body.ticketInformation.fromAppointmentId) {
            await this.appointmentRepository.update({ oid, id: body.ticketInformation.fromAppointmentId }, {
                toTicketId: ticket.id,
                appointmentStatus: appointment_entity_1.AppointmentStatus.Completed,
            });
        }
        if (body.ticketAttributeList) {
            const ticketAttributeInsertList = body.ticketAttributeList
                .filter((i) => !!i.value)
                .map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                return dto;
            });
            ticket.ticketAttributeList =
                await this.ticketAttributeRepository.insertManyAndReturnEntity(ticketAttributeInsertList);
        }
        if (body.ticketUserList) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId: ticket.id,
                body: {
                    interactType: commission_entity_1.InteractType.Ticket,
                    interactId: 0,
                    ticketItemId: 0,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        this.socketEmitService.ticketClinicChange(oid, { type: 'CREATE', ticket });
        return { data: true };
    }
    async update(options) {
        const { oid, body, ticketId } = options;
        const { registeredAt, customerSourceId, customType } = body.ticketInformation;
        const registeredTime = time_helper_1.ESTimer.info(registeredAt, 7);
        const ticketModified = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, {
            registeredAt,
            customerSourceId,
            customType,
            year: registeredTime.year,
            month: registeredTime.month + 1,
            date: registeredTime.date,
            updatedAt: Date.now(),
        });
        if (body.ticketAttributeList) {
            const attributeKeyRemove = body.ticketAttributeList.map((i) => i.key);
            if (attributeKeyRemove.length) {
                await this.ticketAttributeRepository.delete({
                    oid,
                    ticketId,
                    key: { IN: body.ticketAttributeList.map((i) => i.key) },
                });
            }
            const ticketAttributeInsertList = body.ticketAttributeList
                .filter((i) => !!i.value)
                .map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid,
                    ticketId });
                return dto;
            });
            await this.ticketAttributeRepository.insertMany(ticketAttributeInsertList);
            ticketModified.ticketAttributeList = await this.ticketAttributeRepository.findManyBy({
                oid,
                ticketId,
            });
        }
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: ticketModified });
        if (body.ticketUserList) {
            this.apiTicketClinicUserService.changeTicketUserList({
                oid,
                ticketId,
                body: {
                    interactType: commission_entity_1.InteractType.Ticket,
                    interactId: 0,
                    ticketItemId: 0,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return { data: true };
    }
    async startCheckup(options) {
        const { oid, ticketId } = options;
        const [ticket] = await this.ticketRepository.updateAndReturnEntity({
            oid,
            id: ticketId,
            status: { IN: [ticket_entity_1.TicketStatus.Schedule, ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited] },
        }, {
            status: ticket_entity_1.TicketStatus.Executing,
            startedAt: Date.now(),
        });
        if (!ticket)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        return { data: true };
    }
    async updateDiagnosis(options) {
        const { oid, ticketId, body, files } = options;
        const { imagesChange, ticketAttributeChangeList, ticketAttributeKeyList } = body;
        let ticket = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, { note: body.note });
        if (imagesChange) {
            const imageIdsUpdate = await this.imageManagerService.changeImageList({
                oid,
                customerId: ticket.customerId,
                files,
                filesPosition: imagesChange.filesPosition,
                imageIdsKeep: imagesChange.imageIdsKeep,
                imageIdsOld: JSON.parse(ticket.imageIds || '[]'),
            });
            if (ticket.imageIds !== JSON.stringify(imageIdsUpdate)) {
                const ticketUpdateList = await this.ticketRepository.updateAndReturnEntity({ oid, id: ticketId }, { imageIds: JSON.stringify(imageIdsUpdate) });
                ticket = ticketUpdateList[0];
                ticket.imageList = [];
                const imageIds = JSON.parse(ticket.imageIds);
                const imageList = await this.imageRepository.findManyByIds(imageIds);
                const imageMap = (0, object_helper_1.arrayToKeyValue)(imageList, 'id');
                imageIds.forEach((i) => {
                    ticket.imageList.push(imageMap[i]);
                });
            }
        }
        if (ticketAttributeChangeList) {
            await this.ticketAttributeRepository.delete({
                oid,
                ticketId,
                key: { IN: ticketAttributeKeyList },
            });
            const ticketAttributeInsertList = ticketAttributeChangeList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid,
                    ticketId });
                return dto;
            });
            await this.ticketAttributeRepository.insertMany(ticketAttributeInsertList);
            const ticketAttributeList = await this.ticketAttributeRepository.findManyBy({
                oid,
                ticketId,
            });
            this.socketEmitService.ticketClinicUpdateTicketAttributeList(oid, {
                ticketId,
                ticketAttributeList,
            });
        }
        this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
        return { data: true };
    }
    async prepayment(params) {
        const { oid, userId, ticketId, body } = params;
        try {
            const { ticket, payment } = await this.ticketPrepaymentOperation.prepayment({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
            return { data: { ticket, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async refundOverpaid(params) {
        const { oid, userId, ticketId, body } = params;
        try {
            const { ticket, payment } = await this.ticketRefundMoneyOperation.refundOverpaid({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
                description: '',
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
            return { data: { ticket, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async payDebt(params) {
        const { oid, userId, ticketId, body } = params;
        try {
            const { ticket, customer } = await this.ticketPayDebtOperation.payDebt({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
            if (customer) {
                this.socketEmitService.customerUpsert(oid, { customer });
            }
            return { data: { ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async changeDiscount(params) {
        const { oid, ticketId, body } = params;
        try {
            const { ticket } = await this.ticketChangeDiscountOperation.changeDiscount({
                oid,
                ticketId,
                discountType: body.discountType,
                discountMoney: body.discountMoney,
                discountPercent: body.discountPercent,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
            return { data: true };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async close(params) {
        const { oid, userId, ticketId } = params;
        try {
            const result = await this.ticketPaymentAndCloseOperation.paymentAndClose({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                money: 0,
                paymentMethodId: 0,
                note: '',
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket: result.ticket });
            if (result.customer) {
                this.socketEmitService.customerUpsert(oid, { customer: result.customer });
            }
            if (result.ticketUserDeletedList || result.ticketUserModifiedList) {
                this.socketEmitService.ticketClinicChangeTicketUserList(oid, {
                    ticketId,
                    ticketUserDestroyList: result.ticketUserDeletedList,
                    ticketUserUpsertList: [...result.ticketUserModifiedList],
                });
            }
            return { data: { ticket: result.ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async reopen(params) {
        const { oid, userId, ticketId } = params;
        try {
            const { ticket, customer } = await this.ticketReopenOperation.reopen({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                description: '',
                paymentMethodId: 0,
                note: '',
                newPaid: null,
            });
            this.socketEmitService.ticketClinicChange(oid, { type: 'UPDATE', ticket });
            if (customer) {
                this.socketEmitService.customerUpsert(oid, { customer });
            }
            return { data: { ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async destroy(params) {
        const { oid, ticketId } = params;
        const ticket = await this.ticketRepository.findOne({
            condition: { id: ticketId, oid },
            relation: { ticketProductList: {}, ticketRadiologyList: {} },
        });
        if (ticket.ticketProductList.find((i) => i.deliveryStatus === variable_1.DeliveryStatus.Delivered)) {
            throw new exception_filter_1.BusinessException('error.ValidateFailed', common_1.HttpStatus.BAD_REQUEST);
        }
        if (ticket.ticketRadiologyList.find((i) => i.status === ticket_radiology_entity_1.TicketRadiologyStatus.Completed)) {
            throw new exception_filter_1.BusinessException('error.ValidateFailed', common_1.HttpStatus.BAD_REQUEST);
        }
        await this.imageManagerService.changeImageList({
            oid,
            customerId: ticket.customerId,
            files: [],
            filesPosition: [],
            imageIdsKeep: [],
            imageIdsOld: JSON.parse(ticket.imageIds || '[]'),
        });
        await this.ticketRepository.update({ oid, id: ticketId }, { status: ticket_entity_1.TicketStatus.Cancelled });
        await this.ticketRepository.destroy({ oid, ticketId });
        this.socketEmitService.ticketClinicChange(oid, { type: 'DESTROY', ticket });
        return { data: { ticketId } };
    }
};
exports.ApiTicketClinicService = ApiTicketClinicService;
exports.ApiTicketClinicService = ApiTicketClinicService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _b : Object, typeof (_c = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketChangeDiscountOperation !== "undefined" && operations_1.TicketChangeDiscountOperation) === "function" ? _h : Object, typeof (_j = typeof operations_1.TicketRefundOverpaidOperation !== "undefined" && operations_1.TicketRefundOverpaidOperation) === "function" ? _j : Object, typeof (_k = typeof operations_1.TicketPrepaymentOperation !== "undefined" && operations_1.TicketPrepaymentOperation) === "function" ? _k : Object, typeof (_l = typeof operations_1.TicketPaymentAndCloseOperation !== "undefined" && operations_1.TicketPaymentAndCloseOperation) === "function" ? _l : Object, typeof (_m = typeof operations_1.TicketPayDebtOperation !== "undefined" && operations_1.TicketPayDebtOperation) === "function" ? _m : Object, typeof (_o = typeof operations_1.TicketReopenOperation !== "undefined" && operations_1.TicketReopenOperation) === "function" ? _o : Object, typeof (_p = typeof api_ticket_clinic_user_service_1.ApiTicketClinicUserService !== "undefined" && api_ticket_clinic_user_service_1.ApiTicketClinicUserService) === "function" ? _p : Object])
], ApiTicketClinicService);


/***/ }),
/* 591 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(592), exports);
__exportStar(__webpack_require__(593), exports);
__exportStar(__webpack_require__(594), exports);
__exportStar(__webpack_require__(595), exports);
__exportStar(__webpack_require__(596), exports);
__exportStar(__webpack_require__(597), exports);
__exportStar(__webpack_require__(598), exports);


/***/ }),
/* 592 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicChangeDiscountBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketClinicChangeDiscountBody {
}
exports.TicketClinicChangeDiscountBody = TicketClinicChangeDiscountBody;
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketClinicChangeDiscountBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketClinicChangeDiscountBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketClinicChangeDiscountBody.prototype, "discountPercent", void 0);


/***/ }),
/* 593 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateConsumableBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketProductConsumableBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductConsumableBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateConsumableBody {
}
exports.TicketClinicUpdateConsumableBody = TicketClinicUpdateConsumableBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductConsumableBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductConsumableBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateConsumableBody.prototype, "ticketProductConsumableList", void 0);


/***/ }),
/* 594 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateDiagnosisBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const file_1 = __webpack_require__(270);
class TicketAttributeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsKeep", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "filesPosition", void 0);
class TicketClinicUpdateDiagnosisBody extends file_1.MultipleFileUpload {
}
exports.TicketClinicUpdateDiagnosisBody = TicketClinicUpdateDiagnosisBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketClinicUpdateDiagnosisBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ key: 'REASON', value: 'Đau bụng' }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new TicketAttributeBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length)
                    err.push(...validate);
                return instance;
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)({
        message: ({ value }) => `Validate ticketAttributeList failed. Value = ${JSON.stringify(value)}. Example: `
            + JSON.stringify([{ key: 'REASON', value: 'Đau bụng' }]),
    }),
    __metadata("design:type", Array)
], TicketClinicUpdateDiagnosisBody.prototype, "ticketAttributeChangeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value);
            result.forEach((i) => {
                if (!i || typeof i !== 'string')
                    err.push(i);
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], TicketClinicUpdateDiagnosisBody.prototype, "ticketAttributeKeyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length)
                return JSON.stringify(validate);
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${JSON.stringify(value)}. Example: `
            + JSON.stringify({ imageIdsKeep: [102, 103, 104], filesPosition: [2, 3] }),
    }),
    __metadata("design:type", ImagesChangeBody)
], TicketClinicUpdateDiagnosisBody.prototype, "imagesChange", void 0);


/***/ }),
/* 595 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateTicketLaboratoryListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateTicketLaboratoryListBody {
}
exports.TicketClinicUpdateTicketLaboratoryListBody = TicketClinicUpdateTicketLaboratoryListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketClinicUpdateTicketLaboratoryListBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketLaboratoryListBody.prototype, "ticketLaboratoryList", void 0);


/***/ }),
/* 596 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdatePrescriptionBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketProductPrescriptionBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductPrescriptionBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductPrescriptionBody.prototype, "hintUsage", void 0);
class TicketAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'advice' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketClinicUpdatePrescriptionBody {
}
exports.TicketClinicUpdatePrescriptionBody = TicketClinicUpdatePrescriptionBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductPrescriptionBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductPrescriptionBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePrescriptionBody.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], TicketClinicUpdatePrescriptionBody.prototype, "ticketAttributeKeyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdatePrescriptionBody.prototype, "ticketAttributeChangeList", void 0);


/***/ }),
/* 597 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicDestroyTicketProcedureParams = exports.TicketClinicAddTicketProcedure = exports.TicketClinicUpdateTicketProcedureListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "procedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedureBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "actualPrice", void 0);
class TicketClinicUpdateTicketProcedureListBody {
}
exports.TicketClinicUpdateTicketProcedureListBody = TicketClinicUpdateTicketProcedureListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateTicketProcedureListBody.prototype, "ticketProcedureList", void 0);
class TicketClinicAddTicketProcedure {
}
exports.TicketClinicAddTicketProcedure = TicketClinicAddTicketProcedure;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicAddTicketProcedure.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProcedureBody)
], TicketClinicAddTicketProcedure.prototype, "ticketProcedure", void 0);
class TicketClinicDestroyTicketProcedureParams {
}
exports.TicketClinicDestroyTicketProcedureParams = TicketClinicDestroyTicketProcedureParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicDestroyTicketProcedureParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketClinicDestroyTicketProcedureParams.prototype, "ticketProcedureId", void 0);


/***/ }),
/* 598 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicUpdateBody = exports.TicketClinicCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const ticket_entity_1 = __webpack_require__(56);
const request_1 = __webpack_require__(330);
const ticket_clinic_update_user_list_body_1 = __webpack_require__(554);
class TicketAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Diagnosis' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketInformationCreateBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketInformationCreateBody.prototype, "customerSourceId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketInformationCreateBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketInformationCreateBody.prototype, "fromAppointmentId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: ticket_entity_1.TicketType.Clinic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(ticket_entity_1.TicketType),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.TicketType !== "undefined" && ticket_entity_1.TicketType) === "function" ? _a : Object)
], TicketInformationCreateBody.prototype, "ticketType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: ticket_entity_1.TicketType.Clinic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Executing]),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.TicketStatus !== "undefined" && ticket_entity_1.TicketStatus) === "function" ? _b : Object)
], TicketInformationCreateBody.prototype, "status", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketInformationCreateBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketInformationCreateBody.prototype, "customType", void 0);
class TicketInformationUpdateBody extends (0, swagger_1.PickType)(TicketInformationCreateBody, [
    'customerSourceId',
    'registeredAt',
    'customType',
]) {
}
class TicketClinicCreateBody {
}
exports.TicketClinicCreateBody = TicketClinicCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicCreateBody.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicCreateBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.CustomerCreateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.CustomerCreateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _c : Object)
], TicketClinicCreateBody.prototype, "customer", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketInformationCreateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketInformationCreateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketInformationCreateBody)
], TicketClinicCreateBody.prototype, "ticketInformation", void 0);
class TicketClinicUpdateBody {
}
exports.TicketClinicUpdateBody = TicketClinicUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateBody.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_clinic_update_user_list_body_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_clinic_update_user_list_body_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketClinicUpdateBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketInformationUpdateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketInformationUpdateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketInformationUpdateBody)
], TicketClinicUpdateBody.prototype, "ticketInformation", void 0);


/***/ }),
/* 599 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_laboratory_controller_1 = __webpack_require__(600);
const api_ticket_laboratory_service_1 = __webpack_require__(601);
let ApiTicketLaboratoryModule = class ApiTicketLaboratoryModule {
};
exports.ApiTicketLaboratoryModule = ApiTicketLaboratoryModule;
exports.ApiTicketLaboratoryModule = ApiTicketLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_laboratory_controller_1.ApiTicketLaboratoryController],
        providers: [api_ticket_laboratory_service_1.ApiTicketLaboratoryService],
    })
], ApiTicketLaboratoryModule);


/***/ }),
/* 600 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const api_ticket_laboratory_service_1 = __webpack_require__(601);
const request_1 = __webpack_require__(602);
let ApiTicketLaboratoryController = class ApiTicketLaboratoryController {
    constructor(apiTicketLaboratoryService) {
        this.apiTicketLaboratoryService = apiTicketLaboratoryService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketLaboratoryService.pagination(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiTicketLaboratoryService.getOne(oid, id, query);
    }
};
exports.ApiTicketLaboratoryController = ApiTicketLaboratoryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketLaboratoryPaginationQuery !== "undefined" && request_1.TicketLaboratoryPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketLaboratoryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketLaboratoryGetOneQuery !== "undefined" && request_1.TicketLaboratoryGetOneQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketLaboratoryController.prototype, "detail", null);
exports.ApiTicketLaboratoryController = ApiTicketLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('TicketLaboratory'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_laboratory_service_1.ApiTicketLaboratoryService !== "undefined" && api_ticket_laboratory_service_1.ApiTicketLaboratoryService) === "function" ? _a : Object])
], ApiTicketLaboratoryController);


/***/ }),
/* 601 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(170);
const laboratory_repository_1 = __webpack_require__(180);
const ticket_laboratory_repository_1 = __webpack_require__(201);
const user_repository_1 = __webpack_require__(90);
const socket_emit_service_1 = __webpack_require__(306);
let ApiTicketLaboratoryService = class ApiTicketLaboratoryService {
    constructor(socketEmitService, ticketLaboratoryRepository, laboratoryRepository, userRepository, ticketRepository) {
        this.socketEmitService = socketEmitService;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.laboratoryRepository = laboratoryRepository;
        this.userRepository = userRepository;
        this.ticketRepository = ticketRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data } = await this.ticketLaboratoryRepository.pagination({
            relation: {
                customer: relation === null || relation === void 0 ? void 0 : relation.customer,
                ticket: relation === null || relation === void 0 ? void 0 : relation.ticket,
                laboratoryList: relation === null || relation === void 0 ? void 0 : relation.laboratoryList,
            },
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                laboratoryId: filter === null || filter === void 0 ? void 0 : filter.laboratoryId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getOne(oid, id, query) {
        const { relation } = query;
        const ticketLaboratory = await this.ticketLaboratoryRepository.findOne({
            relation: {
                customer: relation === null || relation === void 0 ? void 0 : relation.customer,
                ticket: relation === null || relation === void 0 ? void 0 : relation.ticket,
                laboratoryList: relation === null || relation === void 0 ? void 0 : relation.laboratoryList,
            },
            condition: { oid, id },
        });
        if (!ticketLaboratory) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        return { data: { ticketLaboratory } };
    }
};
exports.ApiTicketLaboratoryService = ApiTicketLaboratoryService;
exports.ApiTicketLaboratoryService = ApiTicketLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof ticket_laboratory_repository_1.TicketLaboratoryRepository !== "undefined" && ticket_laboratory_repository_1.TicketLaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof laboratory_repository_1.LaboratoryRepository !== "undefined" && laboratory_repository_1.LaboratoryRepository) === "function" ? _c : Object, typeof (_d = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _e : Object])
], ApiTicketLaboratoryService);


/***/ }),
/* 602 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(603), exports);
__exportStar(__webpack_require__(604), exports);


/***/ }),
/* 603 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGetOneQuery = exports.TicketLaboratoryGetManyQuery = exports.TicketLaboratoryPaginationQuery = exports.TicketLaboratoryGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const ticket_laboratory_options_request_1 = __webpack_require__(604);
class TicketLaboratoryGetQuery {
}
exports.TicketLaboratoryGetQuery = TicketLaboratoryGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery) === "function" ? _a : Object)
], TicketLaboratoryGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery) === "function" ? _b : Object)
], TicketLaboratoryGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratorySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_laboratory_options_request_1.TicketLaboratorySortQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratorySortQuery) === "function" ? _c : Object)
], TicketLaboratoryGetQuery.prototype, "sort", void 0);
class TicketLaboratoryPaginationQuery extends (0, swagger_1.IntersectionType)(TicketLaboratoryGetQuery, query_1.PaginationQuery) {
}
exports.TicketLaboratoryPaginationQuery = TicketLaboratoryPaginationQuery;
class TicketLaboratoryGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketLaboratoryGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketLaboratoryGetManyQuery = TicketLaboratoryGetManyQuery;
class TicketLaboratoryGetOneQuery extends (0, swagger_1.PickType)(TicketLaboratoryGetQuery, ['relation']) {
}
exports.TicketLaboratoryGetOneQuery = TicketLaboratoryGetOneQuery;


/***/ }),
/* 604 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratorySortQuery = exports.TicketLaboratoryFilterQuery = exports.TicketLaboratoryRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class TicketLaboratoryRelationQuery {
}
exports.TicketLaboratoryRelationQuery = TicketLaboratoryRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "laboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "ticket", void 0);
class TicketLaboratoryFilterQuery {
}
exports.TicketLaboratoryFilterQuery = TicketLaboratoryFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "laboratoryId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], TicketLaboratoryFilterQuery.prototype, "startedAt", void 0);
class TicketLaboratorySortQuery extends query_1.SortQuery {
}
exports.TicketLaboratorySortQuery = TicketLaboratorySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketLaboratorySortQuery.prototype, "startedAt", void 0);


/***/ }),
/* 605 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketOrderModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_order_controller_1 = __webpack_require__(606);
const api_ticket_order_service_1 = __webpack_require__(607);
let ApiTicketOrderModule = class ApiTicketOrderModule {
};
exports.ApiTicketOrderModule = ApiTicketOrderModule;
exports.ApiTicketOrderModule = ApiTicketOrderModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_order_controller_1.ApiTicketOrderController],
        providers: [api_ticket_order_service_1.ApiTicketOrderService],
    })
], ApiTicketOrderModule);


/***/ }),
/* 606 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketOrderController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const request_1 = __webpack_require__(283);
const api_ticket_order_service_1 = __webpack_require__(607);
const request_2 = __webpack_require__(608);
let ApiTicketOrderController = class ApiTicketOrderController {
    constructor(apiTicketOrderService) {
        this.apiTicketOrderService = apiTicketOrderService;
    }
    async draftUpsert({ oid, uid }, body) {
        return await this.apiTicketOrderService.draftUpsert({
            oid,
            userId: uid,
            body,
        });
    }
    async depositedUpdate({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.depositedUpdate({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
    }
    async debtSuccessCreate({ oid, uid }, body) {
        return await this.apiTicketOrderService.debtSuccessCreate({
            oid,
            userId: uid,
            body,
        });
    }
    async debtSuccessUpdate({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.debtSuccessUpdate({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
    }
    async draftDestroy({ oid }, { id }) {
        return await this.apiTicketOrderService.destroy({
            oid,
            ticketId: id,
        });
    }
    async depositedDestroy({ oid }, { id }) {
        return await this.apiTicketOrderService.destroy({
            oid,
            ticketId: id,
        });
    }
    async destroy({ oid }, { id }) {
        return await this.apiTicketOrderService.destroy({
            oid,
            ticketId: id,
        });
    }
    async sendProductAndPaymentAndClose({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.sendProductAndPaymentAndClose({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
    }
    async prepayment({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.prepayment({ oid, ticketId: id, body, userId: uid });
    }
    async sendProduct({ oid }, { id }) {
        return await this.apiTicketOrderService.sendProduct({
            oid,
            ticketId: id,
        });
    }
    async paymentAndClose({ oid, uid }, { id }) {
        return await this.apiTicketOrderService.close({
            oid,
            userId: uid,
            ticketId: id,
        });
    }
    async refundOverpaid({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.refundOverpaid({ oid, userId: uid, ticketId: id, body });
    }
    async payDebt({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.payDebt({ oid, userId: uid, ticketId: id, body });
    }
    async returnProduct({ oid, uid }, { id }, body) {
        return await this.apiTicketOrderService.returnProduct({ oid, userId: uid, ticketId: id, body });
    }
    async terminate({ oid, uid }, { id }) {
        return await this.apiTicketOrderService.terminate({ oid, userId: uid, ticketId: id });
    }
};
exports.ApiTicketOrderController = ApiTicketOrderController;
__decorate([
    (0, common_1.Post)('draft-upsert'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_2.TicketOrderDraftUpsertBody !== "undefined" && request_2.TicketOrderDraftUpsertBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "draftUpsert", null);
__decorate([
    (0, common_1.Patch)('/:id/deposited-update'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_2.TicketOrderDepositedUpdateBody !== "undefined" && request_2.TicketOrderDepositedUpdateBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "depositedUpdate", null);
__decorate([
    (0, common_1.Post)('debt-success-create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DEBT_SUCCESS_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof request_2.TicketOrderDebtSuccessInsertBody !== "undefined" && request_2.TicketOrderDebtSuccessInsertBody) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "debtSuccessCreate", null);
__decorate([
    (0, common_1.Patch)('/:id/debt-success-update'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DEBT_SUCCESS_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_2.TicketOrderDebtSuccessUpdateBody !== "undefined" && request_2.TicketOrderDebtSuccessUpdateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "debtSuccessUpdate", null);
__decorate([
    (0, common_1.Delete)('/:id/draft-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/deposited-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_DEPOSITED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "depositedDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/cancelled-destroy'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_CANCELLED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "destroy", null);
__decorate([
    (0, common_1.Post)('/:id/send-product-and-payment-and-close'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT, permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT, permission_entity_1.PermissionId.TICKET_ORDER_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _u : Object, typeof (_v = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "sendProductAndPaymentAndClose", null);
__decorate([
    (0, common_1.Post)('/:id/prepayment'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _x : Object, typeof (_y = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _y : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "prepayment", null);
__decorate([
    (0, common_1.Post)('/:id/send-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_SEND_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_z = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _z : Object, typeof (_0 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _0 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "sendProduct", null);
__decorate([
    (0, common_1.Post)('/:id/close'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_1 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _1 : Object, typeof (_2 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _2 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "paymentAndClose", null);
__decorate([
    (0, common_1.Post)('/:id/refund-overpaid'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_REFUND_OVERPAID),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_3 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _3 : Object, typeof (_4 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _4 : Object, typeof (_5 = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _5 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "refundOverpaid", null);
__decorate([
    (0, common_1.Post)('/:id/pay-debt'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_PAYMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_6 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _6 : Object, typeof (_7 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _7 : Object, typeof (_8 = typeof request_1.TicketPaymentMoneyBody !== "undefined" && request_1.TicketPaymentMoneyBody) === "function" ? _8 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "payDebt", null);
__decorate([
    (0, common_1.Post)('/:id/return-product'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_RETURN_PRODUCT, permission_entity_1.PermissionId.TICKET_ORDER_REOPEN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_9 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _9 : Object, typeof (_10 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _10 : Object, typeof (_11 = typeof request_1.TicketReturnProductListBody !== "undefined" && request_1.TicketReturnProductListBody) === "function" ? _11 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "returnProduct", null);
__decorate([
    (0, common_1.Post)('/:id/terminate'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.TICKET_ORDER_TERMINATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_12 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _12 : Object, typeof (_13 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _13 : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketOrderController.prototype, "terminate", null);
exports.ApiTicketOrderController = ApiTicketOrderController = __decorate([
    (0, swagger_1.ApiTags)('TicketOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_order_service_1.ApiTicketOrderService !== "undefined" && api_ticket_order_service_1.ApiTicketOrderService) === "function" ? _a : Object])
], ApiTicketOrderController);


/***/ }),
/* 607 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketOrderService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(39);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(48);
const ticket_entity_1 = __webpack_require__(56);
const operations_1 = __webpack_require__(144);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiTicketOrderService = class ApiTicketOrderService {
    constructor(socketEmitService, cacheDataService, ticketProductRepository, ticketBatchRepository, ticketOrderDraftOperation, ticketOrderDepositedOperation, ticketPaymentAndCloseOperation, ticketSendProductOperation, ticketRepository, ticketPrepaymentOperation, ticketPayDebtOperation, ticketRefundOverpaidOperation, ticketReopenOperation, ticketReturnProductOperation, paymentRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.ticketProductRepository = ticketProductRepository;
        this.ticketBatchRepository = ticketBatchRepository;
        this.ticketOrderDraftOperation = ticketOrderDraftOperation;
        this.ticketOrderDepositedOperation = ticketOrderDepositedOperation;
        this.ticketPaymentAndCloseOperation = ticketPaymentAndCloseOperation;
        this.ticketSendProductOperation = ticketSendProductOperation;
        this.ticketRepository = ticketRepository;
        this.ticketPrepaymentOperation = ticketPrepaymentOperation;
        this.ticketPayDebtOperation = ticketPayDebtOperation;
        this.ticketRefundOverpaidOperation = ticketRefundOverpaidOperation;
        this.ticketReopenOperation = ticketReopenOperation;
        this.ticketReturnProductOperation = ticketReturnProductOperation;
        this.paymentRepository = paymentRepository;
    }
    async draftUpsert(params) {
        const { oid, body, userId } = params;
        try {
            const { ticket } = await this.ticketOrderDraftOperation.upsert({
                oid,
                ticketId: body.ticketId,
                ticketOrderDraftUpsertDto: Object.assign(Object.assign({}, body.ticketOrderDraftUpsert), { customType: 0, customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, dailyIndex: 0, commissionMoney: 0, imageIds: JSON.stringify([]) }),
                ticketOrderProductDraftListDto: body.ticketOrderProductDraftList,
                ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList,
                ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
                ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
            });
            return { data: { ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async depositedUpdate(params) {
        const { oid, userId, ticketId, body } = params;
        try {
            const { ticket } = await this.ticketOrderDepositedOperation.update({
                oid,
                ticketId,
                ticketOrderDepositedUpdateDto: Object.assign(Object.assign({}, body.ticketOrderDepositedUpdate), { customType: 0, customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, dailyIndex: 0, commissionMoney: 0, imageIds: JSON.stringify([]) }),
                ticketOrderProductDraftListDto: body.ticketOrderProductDraftList,
                ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList,
                ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
                ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
            });
            return { data: { ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async debtSuccessCreate(params) {
        const { oid, body, userId } = params;
        const _a = body.ticketOrderDebtSuccessInsert, { paid } = _a, ticketOrderDraftInsertBody = __rest(_a, ["paid"]);
        const time = ticketOrderDraftInsertBody.registeredAt;
        const createDraftResponse = await this.ticketOrderDraftOperation.upsert({
            oid,
            ticketId: 0,
            ticketOrderDraftUpsertDto: Object.assign(Object.assign({}, ticketOrderDraftInsertBody), { customType: 0, customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, dailyIndex: 0, commissionMoney: 0, imageIds: JSON.stringify([]) }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList,
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList,
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        const ticketId = createDraftResponse.ticket.id;
        if (body.ticketOrderProductDraftList.length) {
            await this.sendAllProduct({ oid, ticketId });
        }
        const { ticket, customer } = await this.ticketPaymentAndCloseOperation.paymentAndClose({
            oid,
            ticketId,
            cashierId: userId,
            money: paid,
            time,
            paymentMethodId: 0,
            note: '',
        });
        if (customer) {
            this.socketEmitService.customerUpsert(oid, { customer });
        }
        return { data: { ticket } };
    }
    async debtSuccessUpdate(params) {
        const { oid, userId, ticketId, body } = params;
        const time = Date.now();
        const promiseData = await Promise.all([
            this.ticketRepository.findOneBy({ oid, id: ticketId }),
            this.ticketProductRepository.findManyBy({ oid, ticketId }),
        ]);
        let ticket = promiseData[0];
        const ticketProductList = promiseData[1];
        if ([ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Schedule].includes(ticket.status)) {
            return { data: { ticketId } };
        }
        if ([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed].includes(ticket.status)) {
            const responseReopen = await this.ticketReopenOperation.reopen({
                oid,
                ticketId,
                cashierId: userId,
                time,
                description: 'Sửa đơn',
                paymentMethodId: 0,
                note: '',
                newPaid: 0,
            });
            ticket = responseReopen.ticket;
        }
        const responseReturnAllProduct = await this.returnAllProduct({ oid, ticketId });
        ticket = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, {
            status: ticket_entity_1.TicketStatus.Deposited,
        });
        const _a = body.ticketOrderDebtSuccessUpdate, { paid: paidBody } = _a, ticketBodyUpdate = __rest(_a, ["paid"]);
        const responseUpdate = await this.ticketOrderDepositedOperation.update({
            oid,
            ticketId,
            ticketOrderDepositedUpdateDto: Object.assign(Object.assign({}, ticketBodyUpdate), { customType: 0, customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, dailyIndex: 0, commissionMoney: 0, imageIds: JSON.stringify([]) }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList,
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList,
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        ticket = responseUpdate.ticket;
        const responseSendAllProduct = await this.sendAllProduct({ ticketId, oid });
        if (responseSendAllProduct.ticket) {
            ticket = responseSendAllProduct.ticket;
        }
        await this.ticketPaymentAndCloseOperation.paymentAndClose({
            oid,
            ticketId,
            cashierId: userId,
            time,
            money: paidBody - ticket.paid,
            paymentMethodId: 0,
            note: 'Sửa đơn',
        });
        return { data: { ticketId } };
    }
    async destroy(params) {
        const { oid, ticketId } = params;
        await this.ticketRepository.destroy({ oid, ticketId });
        return { data: { ticketId } };
    }
    async sendProductAndPaymentAndClose(params) {
        const { oid, ticketId, body, userId } = params;
        const time = Date.now();
        await this.sendAllProduct({ oid, ticketId });
        const { ticket, payment } = await this.ticketPaymentAndCloseOperation.paymentAndClose({
            oid,
            cashierId: userId,
            ticketId,
            time,
            money: body.money,
            paymentMethodId: body.paymentMethodId,
            note: body.note,
        });
        const ticketProductList = await this.ticketProductRepository.findMany({
            relation: { product: true },
            condition: {
                oid,
                ticketId,
            },
            sort: { id: 'ASC' },
        });
        return { data: { ticket, ticketProductList, payment } };
    }
    async prepayment(options) {
        const { oid, ticketId, body, userId } = options;
        try {
            const { ticket, payment } = await this.ticketPrepaymentOperation.prepayment({
                oid,
                ticketId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
                cashierId: userId,
            });
            return { data: { ticket, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async sendProduct(params) {
        const { oid, ticketId } = params;
        const time = Date.now();
        const { ticket } = await this.sendAllProduct({ oid, ticketId });
        const ticketProductList = await this.ticketProductRepository.findMany({
            relation: { product: true },
            condition: { oid, ticketId },
            sort: { id: 'ASC' },
        });
        return { data: { ticket, ticketProductList } };
    }
    async close(params) {
        const { oid, ticketId, userId } = params;
        const time = Date.now();
        try {
            const { ticket, customer, payment } = await this.ticketPaymentAndCloseOperation.paymentAndClose({
                oid,
                cashierId: userId,
                ticketId,
                time,
                money: 0,
                paymentMethodId: 0,
                note: '',
            });
            return { data: { ticket, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async refundOverpaid(options) {
        const { oid, ticketId, body, userId } = options;
        const { ticket, payment } = await this.ticketRefundOverpaidOperation.refundOverpaid({
            oid,
            ticketId,
            cashierId: userId,
            time: Date.now(),
            money: body.money,
            paymentMethodId: body.paymentMethodId,
            note: body.note,
            description: '',
        });
        return { data: { ticket, payment } };
    }
    async returnProduct(params) {
        const { oid, userId, ticketId, body } = params;
        try {
            const time = Date.now();
            let ticket = await this.ticketRepository.findOneBy({ oid, id: ticketId });
            if ([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed].includes(ticket.status)) {
                const result = await this.ticketReopenOperation.reopen({
                    oid,
                    cashierId: userId,
                    ticketId,
                    time,
                    description: 'Hoàn trả',
                    note: '',
                    paymentMethodId: 0,
                    newPaid: ticket.paid,
                });
                ticket = result.ticket;
            }
            const result = await this.ticketReturnProductOperation.returnProduct({
                oid,
                ticketId,
                time: Date.now(),
                returnList: body.returnList,
            });
            this.socketEmitService.productListUpdate(oid, { productList: result.productModifiedList });
            ticket = result.ticket;
            return { data: { ticket } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async payDebt(options) {
        const { oid, userId, ticketId, body } = options;
        try {
            const { ticket, payment, customer } = await this.ticketPayDebtOperation.payDebt({
                oid,
                cashierId: userId,
                ticketId,
                time: Date.now(),
                money: body.money,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
            });
            if (customer) {
                this.socketEmitService.customerUpsert(oid, { customer });
            }
            return { data: { ticket, payment } };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async terminate(options) {
        const { oid, userId, ticketId } = options;
        const time = Date.now();
        const promiseData = await Promise.all([
            this.ticketRepository.findOneBy({ oid, id: ticketId }),
            this.ticketProductRepository.findManyBy({ oid, ticketId }),
        ]);
        const ticketOrigin = promiseData[0];
        if ([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed].includes(ticketOrigin.status)) {
            await this.ticketReopenOperation.reopen({
                oid,
                cashierId: userId,
                ticketId,
                time,
                paymentMethodId: 0,
                description: 'Hủy phiếu',
                note: '',
                newPaid: 0,
            });
        }
        if ([ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing].includes(ticketOrigin.status)) {
            if (ticketOrigin.paid > 0) {
                await this.ticketRefundOverpaidOperation.refundOverpaid({
                    oid,
                    cashierId: userId,
                    time,
                    ticketId,
                    paymentMethodId: 0,
                    money: ticketOrigin.paid,
                    description: 'Hủy phiếu',
                    note: '',
                });
            }
        }
        let ticketProductList = [];
        if (ticketOrigin.deliveryStatus === variable_1.DeliveryStatus.Delivered) {
            const returnProductResponse = await this.returnAllProduct({ oid, ticketId });
            ticketProductList = returnProductResponse.ticketProductModifiedList;
        }
        const ticket = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, { status: ticket_entity_1.TicketStatus.Cancelled });
        const paymentList = await this.paymentRepository.findMany({
            condition: {
                oid,
                voucherId: ticketId,
                voucherType: payment_entity_1.VoucherType.Ticket,
            },
            sort: { id: 'ASC' },
        });
        return { data: { ticket, paymentList, ticketProductList } };
    }
    async sendAllProduct(params) {
        const { oid, ticketId } = params;
        const time = Date.now();
        const allowNegativeQuantity = await this.cacheDataService.getSettingAllowNegativeQuantity(oid);
        const sendProductResponse = await this.ticketSendProductOperation.sendAllProduct({
            oid,
            ticketId,
            time,
            allowNegativeQuantity,
        });
        return {
            ticket: sendProductResponse.ticket,
            productList: sendProductResponse.productModifiedList,
            ticketProductList: sendProductResponse.ticketProductModifiedList,
        };
    }
    async returnAllProduct(params) {
        const { oid, ticketId } = params;
        const time = Date.now();
        const ticketBatchList = await this.ticketBatchRepository.findManyBy({
            oid,
            ticketId,
            deliveryStatus: variable_1.DeliveryStatus.Delivered,
        });
        const returnList = ticketBatchList.map((i) => ({
            ticketProductId: i.ticketProductId,
            ticketBatchId: i.id,
            quantityReturn: i.quantity,
        }));
        if (returnList.length) {
            const { ticket, ticketProductModifiedList } = await this.ticketReturnProductOperation.returnProduct({
                oid,
                ticketId,
                time,
                returnList,
                options: { changePendingIfNoStock: true },
            });
            return { ticket, ticketProductModifiedList };
        }
        else {
            return {};
        }
    }
};
exports.ApiTicketOrderService = ApiTicketOrderService;
exports.ApiTicketOrderService = ApiTicketOrderService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketBatchRepository !== "undefined" && repositories_1.TicketBatchRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketOrderDraftOperation !== "undefined" && operations_1.TicketOrderDraftOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketOrderDepositedOperation !== "undefined" && operations_1.TicketOrderDepositedOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketPaymentAndCloseOperation !== "undefined" && operations_1.TicketPaymentAndCloseOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketSendProductOperation !== "undefined" && operations_1.TicketSendProductOperation) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _j : Object, typeof (_k = typeof operations_1.TicketPrepaymentOperation !== "undefined" && operations_1.TicketPrepaymentOperation) === "function" ? _k : Object, typeof (_l = typeof operations_1.TicketPayDebtOperation !== "undefined" && operations_1.TicketPayDebtOperation) === "function" ? _l : Object, typeof (_m = typeof operations_1.TicketRefundOverpaidOperation !== "undefined" && operations_1.TicketRefundOverpaidOperation) === "function" ? _m : Object, typeof (_o = typeof operations_1.TicketReopenOperation !== "undefined" && operations_1.TicketReopenOperation) === "function" ? _o : Object, typeof (_p = typeof operations_1.TicketReturnProductOperation !== "undefined" && operations_1.TicketReturnProductOperation) === "function" ? _p : Object, typeof (_q = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _q : Object])
], ApiTicketOrderService);


/***/ }),
/* 608 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(609), exports);
__exportStar(__webpack_require__(610), exports);
__exportStar(__webpack_require__(611), exports);
__exportStar(__webpack_require__(612), exports);
__exportStar(__webpack_require__(613), exports);


/***/ }),
/* 609 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderExpenseDraft = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketOrderExpenseDraft {
}
exports.TicketOrderExpenseDraft = TicketOrderExpenseDraft;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderExpenseDraft.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderExpenseDraft.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderExpenseDraft.prototype, "money", void 0);


/***/ }),
/* 610 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderProcedureDraft = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketOrderProcedureDraft {
}
exports.TicketOrderProcedureDraft = TicketOrderProcedureDraft;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "procedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketOrderProcedureDraft.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "actualPrice", void 0);


/***/ }),
/* 611 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderProductDraft = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const typescript_helper_1 = __webpack_require__(248);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class TicketOrderProductDraft {
}
exports.TicketOrderProductDraft = TicketOrderProductDraft;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.PickupStrategy, example: variable_1.PickupStrategy.AutoWithExpiryDate }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PickupStrategy),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketOrderProductDraft.prototype, "pickupStrategy", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], TicketOrderProductDraft.prototype, "warehouseIds", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketOrderProductDraft.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderProductDraft.prototype, "hintUsage", void 0);


/***/ }),
/* 612 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderSurchargeDraft = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
class TicketOrderSurchargeDraft {
}
exports.TicketOrderSurchargeDraft = TicketOrderSurchargeDraft;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderSurchargeDraft.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderSurchargeDraft.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderSurchargeDraft.prototype, "money", void 0);


/***/ }),
/* 613 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDebtSuccessUpdateBody = exports.TicketOrderDebtSuccessInsertBody = exports.TicketOrderDepositedUpdateBody = exports.TicketOrderDraftUpsertBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
const ticket_order_expense_draft_1 = __webpack_require__(609);
const ticket_order_procedure_draft_1 = __webpack_require__(610);
const ticket_order_product_draft_1 = __webpack_require__(611);
const ticket_order_surcharge_draft_1 = __webpack_require__(612);
class TicketOrderBasic {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "procedureMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "productMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsDiscount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.DiscountType, example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketOrderBasic.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "surcharge", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "totalMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "paid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "debt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "expense", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "profit", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderBasic.prototype, "note", void 0);
class TicketOrderBasicDraftUpsert extends (0, swagger_1.OmitType)(TicketOrderBasic, ['paid', 'debt']) {
}
class TicketOrderBasicDepositedUpdate extends (0, swagger_1.OmitType)(TicketOrderBasic, [
    'customerId',
    'paid',
    'debt',
]) {
}
class TicketOrderBasicDebtSuccessInsert extends (0, swagger_1.OmitType)(TicketOrderBasic, ['debt']) {
}
class TicketOrderBasicDebtSuccessUpdate extends (0, swagger_1.OmitType)(TicketOrderBasic, [
    'customerId',
    'debt',
]) {
}
class TicketOrderAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Diagnosis' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketOrderAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketOrderAttributeBody.prototype, "value", void 0);
class TicketOrderRelation {
}
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_order_product_draft_1.TicketOrderProductDraft, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_order_product_draft_1.TicketOrderProductDraft),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderProductDraftList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_order_procedure_draft_1.TicketOrderProcedureDraft, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_order_procedure_draft_1.TicketOrderProcedureDraft),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderProcedureDraftList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: ticket_order_surcharge_draft_1.TicketOrderSurchargeDraft,
        isArray: true,
        example: [
            { key: 'xx', name: 'Hoa hồng', money: 10000 },
            { key: 'xxe', name: 'Ship', money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => ticket_order_surcharge_draft_1.TicketOrderSurchargeDraft),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderSurchargeDraftList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: ticket_order_expense_draft_1.TicketOrderExpenseDraft,
        isArray: true,
        example: [
            { key: 'xx', name: 'Vật tư', money: 10000 },
            { key: 'xxe', name: 'Ship', money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => ticket_order_expense_draft_1.TicketOrderExpenseDraft),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderExpenseDraftList", void 0);
class TicketOrderDraftUpsertBody extends TicketOrderRelation {
}
exports.TicketOrderDraftUpsertBody = TicketOrderDraftUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderDraftUpsertBody.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDraftUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDraftUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDraftUpsert)
], TicketOrderDraftUpsertBody.prototype, "ticketOrderDraftUpsert", void 0);
class TicketOrderDepositedUpdateBody extends TicketOrderRelation {
}
exports.TicketOrderDepositedUpdateBody = TicketOrderDepositedUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDepositedUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDepositedUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDepositedUpdate)
], TicketOrderDepositedUpdateBody.prototype, "ticketOrderDepositedUpdate", void 0);
class TicketOrderDebtSuccessInsertBody extends TicketOrderRelation {
}
exports.TicketOrderDebtSuccessInsertBody = TicketOrderDebtSuccessInsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDebtSuccessInsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDebtSuccessInsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDebtSuccessInsert)
], TicketOrderDebtSuccessInsertBody.prototype, "ticketOrderDebtSuccessInsert", void 0);
class TicketOrderDebtSuccessUpdateBody extends TicketOrderRelation {
}
exports.TicketOrderDebtSuccessUpdateBody = TicketOrderDebtSuccessUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDebtSuccessUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDebtSuccessUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDebtSuccessUpdate)
], TicketOrderDebtSuccessUpdateBody.prototype, "ticketOrderDebtSuccessUpdate", void 0);


/***/ }),
/* 614 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_procedure_controller_1 = __webpack_require__(615);
const api_ticket_procedure_service_1 = __webpack_require__(616);
let ApiTicketProcedureModule = class ApiTicketProcedureModule {
};
exports.ApiTicketProcedureModule = ApiTicketProcedureModule;
exports.ApiTicketProcedureModule = ApiTicketProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_procedure_controller_1.ApiTicketProcedureController],
        providers: [api_ticket_procedure_service_1.ApiTicketProcedureService],
    })
], ApiTicketProcedureModule);


/***/ }),
/* 615 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(488);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const api_ticket_procedure_service_1 = __webpack_require__(616);
const request_1 = __webpack_require__(617);
let ApiTicketProcedureController = class ApiTicketProcedureController {
    constructor(apiTicketProcedureService) {
        this.apiTicketProcedureService = apiTicketProcedureService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketProcedureService.pagination(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiTicketProcedureService.getOne(oid, id, query);
    }
};
exports.ApiTicketProcedureController = ApiTicketProcedureController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketProcedurePaginationQuery !== "undefined" && request_1.TicketProcedurePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketProcedureController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketProcedureGetOneQuery !== "undefined" && request_1.TicketProcedureGetOneQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketProcedureController.prototype, "detail", null);
exports.ApiTicketProcedureController = ApiTicketProcedureController = __decorate([
    (0, swagger_1.ApiTags)('TicketProcedure'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_procedure_service_1.ApiTicketProcedureService !== "undefined" && api_ticket_procedure_service_1.ApiTicketProcedureService) === "function" ? _a : Object])
], ApiTicketProcedureController);


/***/ }),
/* 616 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const commission_entity_1 = __webpack_require__(75);
const image_repository_1 = __webpack_require__(177);
const ticket_procedure_repository_1 = __webpack_require__(202);
const ticket_user_repository_1 = __webpack_require__(206);
let ApiTicketProcedureService = class ApiTicketProcedureService {
    constructor(ticketProcedureRepository, ticketUserRepository, imageRepository) {
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.imageRepository = imageRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { imageList, ticketUser } = relation, relationEntity = __rest(relation, ["imageList", "ticketUser"]);
        const { total, data } = await this.ticketProcedureRepository.pagination({
            relation: relationEntity,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                procedureId: filter === null || filter === void 0 ? void 0 : filter.procedureId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getOne(oid, id, query) {
        const _a = query.relation, { imageList, ticketUser } = _a, relationEntity = __rest(_a, ["imageList", "ticketUser"]);
        const ticketProcedure = await this.ticketProcedureRepository.findOne({
            relation: relationEntity,
            condition: { oid, id },
        });
        if (!ticketProcedure) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (imageList) {
            ticketProcedure.imageList = [];
            const imageIds = JSON.parse(ticketProcedure.imageIds);
            let imageMap = {};
            if (imageIds.length > 0) {
                const imageList = await this.imageRepository.findManyByIds(imageIds);
                imageMap = (0, object_helper_1.arrayToKeyValue)(imageList, 'id');
            }
            imageIds.forEach((i) => {
                ticketProcedure.imageList.push(imageMap[i]);
            });
        }
        if (ticketUser) {
            ticketProcedure.ticketUserList = await this.ticketUserRepository.findManyBy({
                oid,
                ticketId: ticketProcedure.ticketId,
                interactType: commission_entity_1.InteractType.Procedure,
                interactId: ticketProcedure.id,
            });
        }
        return { data: { ticketProcedure } };
    }
};
exports.ApiTicketProcedureService = ApiTicketProcedureService;
exports.ApiTicketProcedureService = ApiTicketProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_procedure_repository_1.TicketProcedureRepository !== "undefined" && ticket_procedure_repository_1.TicketProcedureRepository) === "function" ? _a : Object, typeof (_b = typeof ticket_user_repository_1.TicketUserRepository !== "undefined" && ticket_user_repository_1.TicketUserRepository) === "function" ? _b : Object, typeof (_c = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _c : Object])
], ApiTicketProcedureService);


/***/ }),
/* 617 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(618), exports);
__exportStar(__webpack_require__(619), exports);


/***/ }),
/* 618 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureGetOneQuery = exports.TicketProcedureGetManyQuery = exports.TicketProcedurePaginationQuery = exports.TicketProcedureGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const ticket_procedure_options_request_1 = __webpack_require__(619);
class TicketProcedureGetQuery {
}
exports.TicketProcedureGetQuery = TicketProcedureGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_procedure_options_request_1.TicketProcedureRelationQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureRelationQuery) === "function" ? _a : Object)
], TicketProcedureGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_procedure_options_request_1.TicketProcedureFilterQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureFilterQuery) === "function" ? _b : Object)
], TicketProcedureGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_procedure_options_request_1.TicketProcedureSortQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureSortQuery) === "function" ? _c : Object)
], TicketProcedureGetQuery.prototype, "sort", void 0);
class TicketProcedurePaginationQuery extends (0, swagger_1.IntersectionType)(TicketProcedureGetQuery, query_1.PaginationQuery) {
}
exports.TicketProcedurePaginationQuery = TicketProcedurePaginationQuery;
class TicketProcedureGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketProcedureGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketProcedureGetManyQuery = TicketProcedureGetManyQuery;
class TicketProcedureGetOneQuery extends (0, swagger_1.PickType)(TicketProcedureGetQuery, ['relation']) {
}
exports.TicketProcedureGetOneQuery = TicketProcedureGetOneQuery;


/***/ }),
/* 619 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureSortQuery = exports.TicketProcedureFilterQuery = exports.TicketProcedureRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
class TicketProcedureRelationQuery {
}
exports.TicketProcedureRelationQuery = TicketProcedureRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "imageList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "ticketUser", void 0);
class TicketProcedureFilterQuery {
}
exports.TicketProcedureFilterQuery = TicketProcedureFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "procedureId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "ticketId", void 0);
class TicketProcedureSortQuery extends query_1.SortQuery {
}
exports.TicketProcedureSortQuery = TicketProcedureSortQuery;


/***/ }),
/* 620 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_product_controller_1 = __webpack_require__(621);
const api_ticket_product_service_1 = __webpack_require__(622);
let ApiTicketProductModule = class ApiTicketProductModule {
};
exports.ApiTicketProductModule = ApiTicketProductModule;
exports.ApiTicketProductModule = ApiTicketProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_product_controller_1.ApiTicketProductController],
        providers: [api_ticket_product_service_1.ApiTicketProductService],
    })
], ApiTicketProductModule);


/***/ }),
/* 621 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_product_service_1 = __webpack_require__(622);
const request_1 = __webpack_require__(623);
let ApiTicketProductController = class ApiTicketProductController {
    constructor(apiTicketProductService) {
        this.apiTicketProductService = apiTicketProductService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketProductService.pagination(oid, query);
    }
    async destroyZero({ oid }, { id }) {
        return await this.apiTicketProductService.destroyZero(oid, id);
    }
};
exports.ApiTicketProductController = ApiTicketProductController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.PRODUCT_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketProductPaginationQuery !== "undefined" && request_1.TicketProductPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketProductController.prototype, "pagination", null);
__decorate([
    (0, common_1.Delete)('destroy-zero/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketProductController.prototype, "destroyZero", null);
exports.ApiTicketProductController = ApiTicketProductController = __decorate([
    (0, swagger_1.ApiTags)('TicketProduct'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_product_service_1.ApiTicketProductService !== "undefined" && api_ticket_product_service_1.ApiTicketProductService) === "function" ? _a : Object])
], ApiTicketProductController);


/***/ }),
/* 622 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductService = void 0;
const common_1 = __webpack_require__(3);
const ticket_product_repository_1 = __webpack_require__(203);
let ApiTicketProductService = class ApiTicketProductService {
    constructor(ticketProductRepository) {
        this.ticketProductRepository = ticketProductRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data } = await this.ticketProductRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async destroyZero(oid, ticketProductId) {
        await this.ticketProductRepository.delete({
            oid,
            id: ticketProductId,
            quantity: 0,
        });
        return { data: { ticketProductId } };
    }
};
exports.ApiTicketProductService = ApiTicketProductService;
exports.ApiTicketProductService = ApiTicketProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_product_repository_1.TicketProductRepository !== "undefined" && ticket_product_repository_1.TicketProductRepository) === "function" ? _a : Object])
], ApiTicketProductService);


/***/ }),
/* 623 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(624), exports);
__exportStar(__webpack_require__(625), exports);


/***/ }),
/* 624 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductGetOneQuery = exports.TicketProductGetManyQuery = exports.TicketProductPaginationQuery = exports.TicketProductGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const ticket_product_options_request_1 = __webpack_require__(625);
class TicketProductGetQuery {
}
exports.TicketProductGetQuery = TicketProductGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_product_options_request_1.TicketProductRelationQuery !== "undefined" && ticket_product_options_request_1.TicketProductRelationQuery) === "function" ? _a : Object)
], TicketProductGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_product_options_request_1.TicketProductFilterQuery !== "undefined" && ticket_product_options_request_1.TicketProductFilterQuery) === "function" ? _b : Object)
], TicketProductGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_product_options_request_1.TicketProductSortQuery !== "undefined" && ticket_product_options_request_1.TicketProductSortQuery) === "function" ? _c : Object)
], TicketProductGetQuery.prototype, "sort", void 0);
class TicketProductPaginationQuery extends (0, swagger_1.IntersectionType)(TicketProductGetQuery, query_1.PaginationQuery) {
}
exports.TicketProductPaginationQuery = TicketProductPaginationQuery;
class TicketProductGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketProductGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketProductGetManyQuery = TicketProductGetManyQuery;
class TicketProductGetOneQuery extends (0, swagger_1.PickType)(TicketProductGetQuery, ['relation']) {
}
exports.TicketProductGetOneQuery = TicketProductGetOneQuery;


/***/ }),
/* 625 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductSortQuery = exports.TicketProductFilterQuery = exports.TicketProductRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketProductRelationQuery {
}
exports.TicketProductRelationQuery = TicketProductRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "customer", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(variable_1.DeliveryStatus);
class TicketProductFilterQuery {
}
exports.TicketProductFilterQuery = TicketProductFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.DeliveryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProductFilterQuery.prototype, "deliveryStatus", void 0);
class TicketProductSortQuery extends query_1.SortQuery {
}
exports.TicketProductSortQuery = TicketProductSortQuery;


/***/ }),
/* 626 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_radiology_controller_1 = __webpack_require__(627);
const api_ticket_radiology_service_1 = __webpack_require__(628);
let ApiTicketRadiologyModule = class ApiTicketRadiologyModule {
};
exports.ApiTicketRadiologyModule = ApiTicketRadiologyModule;
exports.ApiTicketRadiologyModule = ApiTicketRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_radiology_controller_1.ApiTicketRadiologyController],
        providers: [api_ticket_radiology_service_1.ApiTicketRadiologyService],
    })
], ApiTicketRadiologyModule);


/***/ }),
/* 627 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const api_ticket_radiology_service_1 = __webpack_require__(628);
const request_1 = __webpack_require__(629);
let ApiTicketRadiologyController = class ApiTicketRadiologyController {
    constructor(apiTicketRadiologyService) {
        this.apiTicketRadiologyService = apiTicketRadiologyService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketRadiologyService.pagination(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiTicketRadiologyService.getOne(oid, id, query);
    }
};
exports.ApiTicketRadiologyController = ApiTicketRadiologyController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketRadiologyPaginationQuery !== "undefined" && request_1.TicketRadiologyPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketRadiologyController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketRadiologyGetOneQuery !== "undefined" && request_1.TicketRadiologyGetOneQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketRadiologyController.prototype, "detail", null);
exports.ApiTicketRadiologyController = ApiTicketRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('TicketRadiology'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_radiology_service_1.ApiTicketRadiologyService !== "undefined" && api_ticket_radiology_service_1.ApiTicketRadiologyService) === "function" ? _a : Object])
], ApiTicketRadiologyController);


/***/ }),
/* 628 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const image_repository_1 = __webpack_require__(177);
const ticket_radiology_repository_1 = __webpack_require__(204);
let ApiTicketRadiologyService = class ApiTicketRadiologyService {
    constructor(ticketRadiologyRepository, imageRepository) {
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.imageRepository = imageRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { imageList } = relation, relationEntity = __rest(relation, ["imageList"]);
        const { total, data } = await this.ticketRadiologyRepository.pagination({
            relation: relationEntity,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                radiologyId: filter === null || filter === void 0 ? void 0 : filter.radiologyId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getOne(oid, id, query) {
        const _a = query.relation, { imageList } = _a, relationEntity = __rest(_a, ["imageList"]);
        const ticketRadiology = await this.ticketRadiologyRepository.findOne({
            relation: relationEntity,
            condition: { oid, id },
        });
        if (!ticketRadiology) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (imageList) {
            ticketRadiology.imageList = [];
            const imageIds = JSON.parse(ticketRadiology.imageIds);
            let imageMap = {};
            if (imageIds.length > 0) {
                const imageList = await this.imageRepository.findManyByIds(imageIds);
                imageMap = (0, object_helper_1.arrayToKeyValue)(imageList, 'id');
            }
            imageIds.forEach((i) => {
                ticketRadiology.imageList.push(imageMap[i]);
            });
        }
        return { data: { ticketRadiology } };
    }
};
exports.ApiTicketRadiologyService = ApiTicketRadiologyService;
exports.ApiTicketRadiologyService = ApiTicketRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_radiology_repository_1.TicketRadiologyRepository !== "undefined" && ticket_radiology_repository_1.TicketRadiologyRepository) === "function" ? _a : Object, typeof (_b = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _b : Object])
], ApiTicketRadiologyService);


/***/ }),
/* 629 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(630), exports);
__exportStar(__webpack_require__(631), exports);


/***/ }),
/* 630 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyGetOneQuery = exports.TicketRadiologyGetManyQuery = exports.TicketRadiologyPaginationQuery = exports.TicketRadiologyGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const ticket_radiology_options_request_1 = __webpack_require__(631);
class TicketRadiologyGetQuery {
}
exports.TicketRadiologyGetQuery = TicketRadiologyGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologyRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_radiology_options_request_1.TicketRadiologyRelationQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologyRelationQuery) === "function" ? _a : Object)
], TicketRadiologyGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologyFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_radiology_options_request_1.TicketRadiologyFilterQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologyFilterQuery) === "function" ? _b : Object)
], TicketRadiologyGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_radiology_options_request_1.TicketRadiologySortQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologySortQuery) === "function" ? _c : Object)
], TicketRadiologyGetQuery.prototype, "sort", void 0);
class TicketRadiologyPaginationQuery extends (0, swagger_1.IntersectionType)(TicketRadiologyGetQuery, query_1.PaginationQuery) {
}
exports.TicketRadiologyPaginationQuery = TicketRadiologyPaginationQuery;
class TicketRadiologyGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketRadiologyGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketRadiologyGetManyQuery = TicketRadiologyGetManyQuery;
class TicketRadiologyGetOneQuery extends (0, swagger_1.PickType)(TicketRadiologyGetQuery, ['relation']) {
}
exports.TicketRadiologyGetOneQuery = TicketRadiologyGetOneQuery;


/***/ }),
/* 631 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologySortQuery = exports.TicketRadiologyFilterQuery = exports.TicketRadiologyRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const dto_1 = __webpack_require__(285);
const query_1 = __webpack_require__(259);
class TicketRadiologyRelationQuery {
}
exports.TicketRadiologyRelationQuery = TicketRadiologyRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRadiologyRelationQuery.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "imageList", void 0);
class TicketRadiologyFilterQuery {
}
exports.TicketRadiologyFilterQuery = TicketRadiologyFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], TicketRadiologyFilterQuery.prototype, "startedAt", void 0);
class TicketRadiologySortQuery extends query_1.SortQuery {
}
exports.TicketRadiologySortQuery = TicketRadiologySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketRadiologySortQuery.prototype, "startedAt", void 0);


/***/ }),
/* 632 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_controller_1 = __webpack_require__(633);
const api_ticket_service_1 = __webpack_require__(634);
let ApiTicketModule = class ApiTicketModule {
};
exports.ApiTicketModule = ApiTicketModule;
exports.ApiTicketModule = ApiTicketModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_controller_1.ApiTicketController],
        providers: [api_ticket_service_1.ApiTicketService],
    })
], ApiTicketModule);


/***/ }),
/* 633 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(285);
const permission_guard_1 = __webpack_require__(93);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_ticket_service_1 = __webpack_require__(634);
const request_1 = __webpack_require__(283);
let ApiTicketController = class ApiTicketController {
    constructor(apiTicketService) {
        this.apiTicketService = apiTicketService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiTicketService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiTicketService.getOne(oid, id, query);
    }
};
exports.ApiTicketController = ApiTicketController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, permission_guard_1.HasPermissionOr)(permission_entity_1.PermissionId.TICKET_ORDER_READ, permission_entity_1.PermissionId.TICKET_CLINIC_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketPaginationQuery !== "undefined" && request_1.TicketPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, permission_guard_1.HasPermissionOr)(permission_entity_1.PermissionId.TICKET_ORDER_READ, permission_entity_1.PermissionId.TICKET_CLINIC_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.TicketGetManyQuery !== "undefined" && request_1.TicketGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, permission_guard_1.HasPermissionOr)(permission_entity_1.PermissionId.TICKET_ORDER_READ, permission_entity_1.PermissionId.TICKET_CLINIC_READ),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.TicketGetOneQuery !== "undefined" && request_1.TicketGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketController.prototype, "detail", null);
exports.ApiTicketController = ApiTicketController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_service_1.ApiTicketService !== "undefined" && api_ticket_service_1.ApiTicketService) === "function" ? _a : Object])
], ApiTicketController);


/***/ }),
/* 634 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const object_helper_1 = __webpack_require__(91);
const payment_entity_1 = __webpack_require__(48);
const ticket_product_entity_1 = __webpack_require__(69);
const repositories_1 = __webpack_require__(170);
const image_repository_1 = __webpack_require__(177);
const ticket_repository_1 = __webpack_require__(207);
let ApiTicketService = class ApiTicketService {
    constructor(ticketRepository, appointmentRepository, ticketAttributeRepository, ticketProductRepository, ticketBatchRepository, ticketProcedureRepository, ticketRadiologyRepository, ticketLaboratoryRepository, ticketLaboratoryGroupRepository, ticketLaboratoryResultRepository, ticketUserRepository, paymentRepository, ticketExpenseRepository, ticketSurchargeRepository, imageRepository) {
        this.ticketRepository = ticketRepository;
        this.appointmentRepository = appointmentRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.ticketBatchRepository = ticketBatchRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.paymentRepository = paymentRepository;
        this.ticketExpenseRepository = ticketExpenseRepository;
        this.ticketSurchargeRepository = ticketSurchargeRepository;
        this.imageRepository = imageRepository;
    }
    async pagination(oid, query) {
        const { page, limit, sort, relation, filter } = query;
        const { data, total } = await this.ticketRepository.pagination({
            page,
            limit,
            relation: {
                customer: relation === null || relation === void 0 ? void 0 : relation.customer,
                ticketUserList: relation === null || relation === void 0 ? void 0 : relation.ticketUserList,
                ticketAttributeList: relation === null || relation === void 0 ? void 0 : relation.ticketAttributeList,
                ticketProductList: relation === null || relation === void 0 ? void 0 : relation.ticketProductList,
                ticketProcedureList: relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList,
            },
            condition: {
                oid,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                ticketType: filter === null || filter === void 0 ? void 0 : filter.ticketType,
                customType: filter === null || filter === void 0 ? void 0 : filter.customType,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { relation, limit, sort, filter } = query;
        const data = await this.ticketRepository.findMany({
            condition: {
                oid,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                ticketType: filter === null || filter === void 0 ? void 0 : filter.ticketType,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            relation: { customer: relation === null || relation === void 0 ? void 0 : relation.customer },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, ticketId, { relation }) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
        const ticket = await this.ticketRepository.findOne({
            condition: { oid, id: ticketId },
            relation: {
                customer: !!(relation === null || relation === void 0 ? void 0 : relation.customer),
                ticketSurchargeList: !!(relation === null || relation === void 0 ? void 0 : relation.ticketSurchargeList),
                ticketExpenseList: !!(relation === null || relation === void 0 ? void 0 : relation.ticketExpenseList),
            },
            relationLoadStrategy: 'query',
        });
        if (!ticket) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        const dataPromise = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.paymentList)
                ? this.paymentRepository.findMany({
                    condition: { oid, voucherType: payment_entity_1.VoucherType.Ticket, voucherId: ticketId },
                    sort: { id: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductList)
                ? this.ticketProductRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { priority: 'ASC' },
                    relation: {
                        product: (_a = relation === null || relation === void 0 ? void 0 : relation.ticketProductList) === null || _a === void 0 ? void 0 : _a.product,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList)
                ? this.ticketProductRepository.findMany({
                    condition: { oid, ticketId, type: ticket_product_entity_1.TicketProductType.Prescription },
                    sort: { priority: 'ASC' },
                    relation: {
                        product: (_b = relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList) === null || _b === void 0 ? void 0 : _b.product,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList)
                ? this.ticketProductRepository.findMany({
                    condition: { oid, ticketId, type: ticket_product_entity_1.TicketProductType.Consumable },
                    sort: { priority: 'ASC' },
                    relation: {
                        product: (_c = relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList) === null || _c === void 0 ? void 0 : _c.product,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketBatchList)
                ? this.ticketBatchRepository.findMany({
                    condition: { oid, ticketId },
                    relation: {
                        batch: (_d = relation === null || relation === void 0 ? void 0 : relation.ticketBatchList) === null || _d === void 0 ? void 0 : _d.batch,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList)
                ? this.ticketProcedureRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { priority: 'ASC' },
                    relation: {
                        procedure: (_e = relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList) === null || _e === void 0 ? void 0 : _e.procedure,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList)
                ? this.ticketLaboratoryRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { priority: 'ASC' },
                    relation: {
                        laboratory: (_f = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) === null || _f === void 0 ? void 0 : _f.laboratory,
                        laboratoryList: (_g = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) === null || _g === void 0 ? void 0 : _g.laboratoryList,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList)
                ? this.ticketLaboratoryGroupRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { registeredAt: 'ASC' },
                    relation: {
                        laboratoryGroup: (_h = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList) === null || _h === void 0 ? void 0 : _h.laboratoryGroup,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryResultList)
                ? this.ticketLaboratoryResultRepository.findMany({
                    condition: { oid, ticketId },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList)
                ? this.ticketRadiologyRepository.findMany({
                    condition: { oid, ticketId },
                    sort: { priority: 'ASC' },
                    relation: {
                        radiology: (_j = relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList) === null || _j === void 0 ? void 0 : _j.radiology,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketUserList)
                ? this.ticketUserRepository.findMany({
                    condition: { oid, ticketId },
                    relation: {
                        user: (_k = relation === null || relation === void 0 ? void 0 : relation.ticketUserList) === null || _k === void 0 ? void 0 : _k.user,
                    },
                    sort: { interactType: 'ASC', roleId: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketAttributeList)
                ? this.ticketAttributeRepository.findMany({
                    condition: { oid, ticketId },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.toAppointment)
                ? this.appointmentRepository.findOne({
                    condition: { oid, fromTicketId: ticketId },
                })
                : undefined,
        ]);
        ticket.paymentList = dataPromise[0];
        ticket.ticketProductList = dataPromise[1];
        ticket.ticketProductPrescriptionList = dataPromise[2];
        ticket.ticketProductConsumableList = dataPromise[3];
        ticket.ticketBatchList = dataPromise[4];
        ticket.ticketProcedureList = dataPromise[5];
        ticket.ticketLaboratoryList = dataPromise[6];
        ticket.ticketLaboratoryGroupList = dataPromise[7];
        ticket.ticketLaboratoryResultList = dataPromise[8];
        ticket.ticketRadiologyList = dataPromise[9];
        ticket.ticketUserList = dataPromise[10];
        ticket.ticketAttributeList = dataPromise[11];
        ticket.toAppointment = dataPromise[12];
        if (ticket.ticketRadiologyList || ticket.imageList) {
            ticket.ticketRadiologyList = ticket.ticketRadiologyList || [];
            ticket.imageList = [];
            const ticketImageIds = JSON.parse(ticket.imageIds || '[]');
            const ticketRadiologyImageIds = ticket.ticketRadiologyList
                .map((i) => JSON.parse(i.imageIds))
                .flat();
            const imageIds = [...ticketImageIds, ...ticketRadiologyImageIds];
            let imageMap = {};
            if (imageIds.length > 0) {
                const imageList = await this.imageRepository.findMany({
                    condition: { id: { IN: imageIds } },
                    sort: { id: 'ASC' },
                });
                imageMap = (0, object_helper_1.arrayToKeyValue)(imageList, 'id');
            }
            ticketImageIds.forEach((i) => ticket.imageList.push(imageMap[i]));
            ticket.ticketRadiologyList.forEach((ticketRadiology) => {
                const ticketDiagnosisImageIds = JSON.parse(ticketRadiology.imageIds);
                ticketRadiology.imageList = [];
                ticketDiagnosisImageIds.forEach((i) => {
                    ticketRadiology.imageList.push(imageMap[i]);
                });
            });
        }
        return { data: { ticket } };
    }
};
exports.ApiTicketService = ApiTicketService;
exports.ApiTicketService = ApiTicketService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_repository_1.TicketRepository !== "undefined" && ticket_repository_1.TicketRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketBatchRepository !== "undefined" && repositories_1.TicketBatchRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketLaboratoryGroupRepository !== "undefined" && repositories_1.TicketLaboratoryGroupRepository) === "function" ? _j : Object, typeof (_k = typeof repositories_1.TicketLaboratoryResultRepository !== "undefined" && repositories_1.TicketLaboratoryResultRepository) === "function" ? _k : Object, typeof (_l = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _l : Object, typeof (_m = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _m : Object, typeof (_o = typeof repositories_1.TicketExpenseRepository !== "undefined" && repositories_1.TicketExpenseRepository) === "function" ? _o : Object, typeof (_p = typeof repositories_1.TicketSurchargeRepository !== "undefined" && repositories_1.TicketSurchargeRepository) === "function" ? _p : Object, typeof (_q = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _q : Object])
], ApiTicketService);


/***/ }),
/* 635 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleModule = void 0;
const common_1 = __webpack_require__(3);
const api_user_role_controller_1 = __webpack_require__(636);
const api_user_role_service_1 = __webpack_require__(637);
let ApiUserRoleModule = class ApiUserRoleModule {
};
exports.ApiUserRoleModule = ApiUserRoleModule;
exports.ApiUserRoleModule = ApiUserRoleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_user_role_controller_1.ApiUserRoleController],
        providers: [api_user_role_service_1.ApiUserRoleService],
    })
], ApiUserRoleModule);


/***/ }),
/* 636 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const api_user_role_service_1 = __webpack_require__(637);
const request_1 = __webpack_require__(638);
let ApiUserRoleController = class ApiUserRoleController {
    constructor(apiUserRoleService) {
        this.apiUserRoleService = apiUserRoleService;
    }
    list({ oid }, query) {
        return this.apiUserRoleService.getMany(oid, query);
    }
};
exports.ApiUserRoleController = ApiUserRoleController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.UserRoleGetManyQuery !== "undefined" && request_1.UserRoleGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiUserRoleController.prototype, "list", null);
exports.ApiUserRoleController = ApiUserRoleController = __decorate([
    (0, swagger_1.ApiTags)('UserRole'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('user-role'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_user_role_service_1.ApiUserRoleService !== "undefined" && api_user_role_service_1.ApiUserRoleService) === "function" ? _a : Object])
], ApiUserRoleController);


/***/ }),
/* 637 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(170);
let ApiUserRoleService = class ApiUserRoleService {
    constructor(userRoleRepository) {
        this.userRoleRepository = userRoleRepository;
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.userRoleRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
};
exports.ApiUserRoleService = ApiUserRoleService;
exports.ApiUserRoleService = ApiUserRoleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _a : Object])
], ApiUserRoleService);


/***/ }),
/* 638 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(639), exports);
__exportStar(__webpack_require__(640), exports);


/***/ }),
/* 639 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleGetOneQuery = exports.UserRoleGetManyQuery = exports.UserRolePaginationQuery = exports.UserRoleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const user_role_options_request_1 = __webpack_require__(640);
class UserRoleGetQuery {
}
exports.UserRoleGetQuery = UserRoleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_role_options_request_1.UserRoleRelationQuery !== "undefined" && user_role_options_request_1.UserRoleRelationQuery) === "function" ? _a : Object)
], UserRoleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_role_options_request_1.UserRoleFilterQuery !== "undefined" && user_role_options_request_1.UserRoleFilterQuery) === "function" ? _b : Object)
], UserRoleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_role_options_request_1.UserRoleSortQuery !== "undefined" && user_role_options_request_1.UserRoleSortQuery) === "function" ? _c : Object)
], UserRoleGetQuery.prototype, "sort", void 0);
class UserRolePaginationQuery extends (0, swagger_1.IntersectionType)(UserRoleGetQuery, query_1.PaginationQuery) {
}
exports.UserRolePaginationQuery = UserRolePaginationQuery;
class UserRoleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(UserRoleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.UserRoleGetManyQuery = UserRoleGetManyQuery;
class UserRoleGetOneQuery extends (0, swagger_1.PickType)(UserRoleGetQuery, ['relation']) {
}
exports.UserRoleGetOneQuery = UserRoleGetOneQuery;


/***/ }),
/* 640 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleSortQuery = exports.UserRoleFilterQuery = exports.UserRoleRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class UserRoleRelationQuery {
}
exports.UserRoleRelationQuery = UserRoleRelationQuery;
class UserRoleFilterQuery {
}
exports.UserRoleFilterQuery = UserRoleFilterQuery;
class UserRoleSortQuery extends query_1.SortQuery {
}
exports.UserRoleSortQuery = UserRoleSortQuery;


/***/ }),
/* 641 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserModule = void 0;
const common_1 = __webpack_require__(3);
const api_user_controller_1 = __webpack_require__(642);
const api_user_service_1 = __webpack_require__(643);
let ApiUserModule = class ApiUserModule {
};
exports.ApiUserModule = ApiUserModule;
exports.ApiUserModule = ApiUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_user_controller_1.ApiUserController],
        providers: [api_user_service_1.ApiUserService],
    })
], ApiUserModule);


/***/ }),
/* 642 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_user_service_1 = __webpack_require__(643);
const request_1 = __webpack_require__(644);
const device_logout_query_1 = __webpack_require__(648);
const new_password_body_1 = __webpack_require__(649);
let ApiUserController = class ApiUserController {
    constructor(apiUserService) {
        this.apiUserService = apiUserService;
    }
    pagination({ oid }, query) {
        return this.apiUserService.pagination({ oid, query });
    }
    list({ oid }, query) {
        return this.apiUserService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiUserService.getOne(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiUserService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiUserService.updateOne(oid, +id, body);
    }
    async newPassword({ oid }, { id }, { password }) {
        return await this.apiUserService.newPassword(oid, +id, password);
    }
    async deleteOne({ oid }, { id }) {
        return await this.apiUserService.deleteOne(oid, id);
    }
    deviceLogout({ oid }, { id }, body) {
        return this.apiUserService.deviceLogout({
            oid,
            userId: +id,
            refreshExp: body.refreshExp,
        });
    }
};
exports.ApiUserController = ApiUserController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.UserPaginationQuery !== "undefined" && request_1.UserPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.UserGetManyQuery !== "undefined" && request_1.UserGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.UserGetOneQuery !== "undefined" && request_1.UserGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ACCOUNT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.UserCreateBody !== "undefined" && request_1.UserCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ACCOUNT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.UserUpdateBody !== "undefined" && request_1.UserUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Patch)('new-password/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ACCOUNT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object, typeof (_r = typeof new_password_body_1.NewPasswordBody !== "undefined" && new_password_body_1.NewPasswordBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "newPassword", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ACCOUNT_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Post)('device-logout/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.ACCOUNT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object, typeof (_w = typeof device_logout_query_1.DeviceLogoutBody !== "undefined" && device_logout_query_1.DeviceLogoutBody) === "function" ? _w : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "deviceLogout", null);
exports.ApiUserController = ApiUserController = __decorate([
    (0, swagger_1.ApiTags)('User'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('user'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_user_service_1.ApiUserService !== "undefined" && api_user_service_1.ApiUserService) === "function" ? _a : Object])
], ApiUserController);


/***/ }),
/* 643 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(243);
const cache_data_service_1 = __webpack_require__(39);
const cache_token_service_1 = __webpack_require__(92);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(226);
const device_1 = __webpack_require__(316);
const repositories_1 = __webpack_require__(170);
const socket_emit_service_1 = __webpack_require__(306);
let ApiUserService = class ApiUserService {
    constructor(socketEmitService, userRepository, userRoleRepository, roleRepository, cacheTokenService, cacheDataService) {
        this.socketEmitService = socketEmitService;
        this.userRepository = userRepository;
        this.userRoleRepository = userRoleRepository;
        this.roleRepository = roleRepository;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
    }
    async pagination(options) {
        const { oid, query } = options;
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.userRepository.pagination({
            page,
            limit,
            relation: {
                organization: !!relation.organization,
                userRoleList: relation.userRoleList ? { role: true } : false,
            },
            condition: {
                oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ username: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        for (let i = 0; i < data.length; i++) {
            const user = data[i];
            const tokenData = await this.cacheTokenService.getTokenList({
                oid,
                uid: user.id,
            });
            user.devices = tokenData.map((j) => {
                const device = new device_1.default();
                device.refreshExp = j.refreshExp;
                device.ip = j.ip;
                device.os = j.os;
                device.browser = j.browser;
                device.mobile = j.mobile;
                device.online =
                    (this.socketEmitService.connections[user.id] || []).some((k) => {
                        return k.refreshExp === j.refreshExp;
                    }) || j.online;
                return device;
            });
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.userRepository.findMany({
            relation,
            condition: {
                oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const user = await this.userRepository.findOne({
            relation: query.relation,
            condition: { id, oid },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { user } };
    }
    async createOne(oid, body) {
        const { username, password, roleIdList } = body, other = __rest(body, ["username", "password", "roleIdList"]);
        const existUser = await this.userRepository.findOneBy({
            oid,
            username,
        });
        if (existUser) {
            throw new exception_filter_1.BusinessException('error.Register.ExistUsername');
        }
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, username);
        const user = await this.userRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, other), { oid,
            username, isAdmin: 0, secret,
            hashPassword }));
        if (roleIdList.length) {
            const roleList = await this.roleRepository.findManyBy({
                oid,
                id: { IN: roleIdList },
            });
            if (roleList.length !== roleIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            user.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(roleIdList.map((i) => ({
                oid,
                roleId: i,
                userId: user.id,
            })));
        }
        this.cacheDataService.clearUserAndRole(user.oid);
        return { data: { user } };
    }
    async updateOne(oid, userId, body) {
        const { roleIdList, password } = body, other = __rest(body, ["roleIdList", "password"]);
        let user;
        if (password) {
            const hashPassword = await bcrypt.hash(password, 5);
            const secret = (0, string_helper_1.encrypt)(password, other.username);
            user = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, Object.assign(Object.assign({}, other), { hashPassword,
                secret }));
        }
        else {
            user = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, other);
        }
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        await this.userRoleRepository.delete({ oid, userId });
        if (roleIdList.length) {
            const roleList = await this.roleRepository.findManyBy({
                oid,
                id: { IN: roleIdList },
            });
            if (roleList.length !== roleIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            user.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(roleIdList.map((i) => ({
                oid,
                roleId: i,
                userId: user.id,
            })));
        }
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { user } };
    }
    async newPassword(oid, id, password) {
        const user = await this.userRepository.findOneBy({ oid, id });
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, user.username);
        const affected = await this.userRepository.update({ oid, id }, { hashPassword, secret });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        return { data: true };
    }
    async deleteOne(oid, userId) {
        const affected = await this.userRepository.delete({ oid, id: userId });
        if (!affected) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        await this.userRoleRepository.delete({ oid, userId });
        this.cacheDataService.clearUserAndRole(oid);
        return { data: { userId } };
    }
    async deviceLogout(options) {
        const { oid, userId, refreshExp } = options;
        const result = this.cacheTokenService.removeRefreshToken({
            oid,
            uid: userId,
            refreshExp,
        });
        return { data: true };
    }
};
exports.ApiUserService = ApiUserService;
exports.ApiUserService = ApiUserService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.RoleRepository !== "undefined" && repositories_1.RoleRepository) === "function" ? _d : Object, typeof (_e = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _e : Object, typeof (_f = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _f : Object])
], ApiUserService);


/***/ }),
/* 644 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(645), exports);
__exportStar(__webpack_require__(646), exports);
__exportStar(__webpack_require__(647), exports);


/***/ }),
/* 645 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGetOneQuery = exports.UserGetManyQuery = exports.UserPaginationQuery = exports.UserGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const user_options_request_1 = __webpack_require__(646);
class UserGetQuery {
}
exports.UserGetQuery = UserGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ userRoleList: {} }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _a : Object)
], UserGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            searchText: 'a',
            isActive: 1,
            isAdmin: 1,
            updatedAt: { LT: 1000 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _b : Object)
], UserGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            phone: 'ASC',
            id: 'DESC',
            username: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_options_request_1.UserSortQuery !== "undefined" && user_options_request_1.UserSortQuery) === "function" ? _c : Object)
], UserGetQuery.prototype, "sort", void 0);
class UserPaginationQuery extends (0, swagger_1.IntersectionType)(UserGetQuery, query_1.PaginationQuery) {
}
exports.UserPaginationQuery = UserPaginationQuery;
class UserGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(UserGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.UserGetManyQuery = UserGetManyQuery;
class UserGetOneQuery extends (0, swagger_1.PickType)(UserGetQuery, ['relation']) {
}
exports.UserGetOneQuery = UserGetOneQuery;


/***/ }),
/* 646 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserSortQuery = exports.UserFilterQuery = exports.UserRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class UserRelationQuery {
}
exports.UserRelationQuery = UserRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], UserRelationQuery.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], UserRelationQuery.prototype, "userRoleList", void 0);
class UserFilterQuery {
}
exports.UserFilterQuery = UserFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], UserFilterQuery.prototype, "updatedAt", void 0);
class UserSortQuery extends query_1.SortQuery {
}
exports.UserSortQuery = UserSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "username", void 0);


/***/ }),
/* 647 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserUpdateBody = exports.UserCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const class_validator_custom_1 = __webpack_require__(247);
const variable_1 = __webpack_require__(21);
class UserCreateBody {
}
exports.UserCreateBody = UserCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], UserCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], UserCreateBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], UserCreateBody.prototype, "password", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], UserCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UserCreateBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], UserCreateBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], UserCreateBody.prototype, "roleIdList", void 0);
class UserUpdateBody extends UserCreateBody {
}
exports.UserUpdateBody = UserUpdateBody;


/***/ }),
/* 648 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DeviceLogoutBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class DeviceLogoutBody {
}
exports.DeviceLogoutBody = DeviceLogoutBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "refreshExp", void 0);


/***/ }),
/* 649 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.NewPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class NewPasswordBody {
}
exports.NewPasswordBody = NewPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], NewPasswordBody.prototype, "password", void 0);


/***/ }),
/* 650 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseModule = void 0;
const common_1 = __webpack_require__(3);
const api_warehouse_controller_1 = __webpack_require__(651);
const api_warehouse_service_1 = __webpack_require__(652);
let ApiWarehouseModule = class ApiWarehouseModule {
};
exports.ApiWarehouseModule = ApiWarehouseModule;
exports.ApiWarehouseModule = ApiWarehouseModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_warehouse_controller_1.ApiWarehouseController],
        providers: [api_warehouse_service_1.ApiWarehouseService],
    })
], ApiWarehouseModule);


/***/ }),
/* 651 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(292);
const permission_guard_1 = __webpack_require__(93);
const user_guard_1 = __webpack_require__(24);
const external_request_1 = __webpack_require__(241);
const permission_entity_1 = __webpack_require__(77);
const api_warehouse_service_1 = __webpack_require__(652);
const request_1 = __webpack_require__(653);
let ApiWarehouseController = class ApiWarehouseController {
    constructor(apiWarehouseService) {
        this.apiWarehouseService = apiWarehouseService;
    }
    pagination({ oid }, query) {
        return this.apiWarehouseService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiWarehouseService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiWarehouseService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiWarehouseService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiWarehouseService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiWarehouseService.destroyOne({ oid, warehouseId: id });
    }
};
exports.ApiWarehouseController = ApiWarehouseController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.WarehousePaginationQuery !== "undefined" && request_1.WarehousePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.WarehouseGetManyQuery !== "undefined" && request_1.WarehouseGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.IsUser)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.WarehouseCreateBody !== "undefined" && request_1.WarehouseCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.WarehouseUpdateBody !== "undefined" && request_1.WarehouseUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, permission_guard_1.HasPermission)(permission_entity_1.PermissionId.MASTER_DATA_WAREHOUSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "destroyOne", null);
exports.ApiWarehouseController = ApiWarehouseController = __decorate([
    (0, swagger_1.ApiTags)('Warehouse'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('warehouse'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_warehouse_service_1.ApiWarehouseService !== "undefined" && api_warehouse_service_1.ApiWarehouseService) === "function" ? _a : Object])
], ApiWarehouseController);


/***/ }),
/* 652 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const batch_repository_1 = __webpack_require__(172);
const warehouse_repository_1 = __webpack_require__(208);
let ApiWarehouseService = class ApiWarehouseService {
    constructor(warehouseRepository, batchRepository) {
        this.warehouseRepository = warehouseRepository;
        this.batchRepository = batchRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.warehouseRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.warehouseRepository.findMany({
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const warehouse = await this.warehouseRepository.findOneBy({ oid, id });
        if (!warehouse)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { warehouse } };
    }
    async createOne(oid, body) {
        const warehouse = await this.warehouseRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, body));
        return { data: { warehouse } };
    }
    async updateOne(oid, id, body) {
        const [warehouse] = await this.warehouseRepository.updateAndReturnEntity({ id, oid }, body);
        if (!warehouse) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Warehouse',
            });
        }
        return { data: { warehouse } };
    }
    async destroyOne(options) {
        const { oid, warehouseId } = options;
        const countBatch = await this.batchRepository.countBy({ oid, warehouseId });
        if (countBatch > 0) {
            return {
                data: { countBatch },
                success: false,
            };
        }
        await this.warehouseRepository.delete({ oid, id: warehouseId });
        return { data: { countBatch: 0, warehouseId } };
    }
};
exports.ApiWarehouseService = ApiWarehouseService;
exports.ApiWarehouseService = ApiWarehouseService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof warehouse_repository_1.WarehouseRepository !== "undefined" && warehouse_repository_1.WarehouseRepository) === "function" ? _a : Object, typeof (_b = typeof batch_repository_1.BatchRepository !== "undefined" && batch_repository_1.BatchRepository) === "function" ? _b : Object])
], ApiWarehouseService);


/***/ }),
/* 653 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(654), exports);
__exportStar(__webpack_require__(655), exports);
__exportStar(__webpack_require__(656), exports);


/***/ }),
/* 654 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseGetOneQuery = exports.WarehouseGetManyQuery = exports.WarehousePaginationQuery = exports.WarehouseGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const query_1 = __webpack_require__(259);
const warehouse_options_request_1 = __webpack_require__(655);
class WarehouseGetQuery {
}
exports.WarehouseGetQuery = WarehouseGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof warehouse_options_request_1.WarehouseRelationQuery !== "undefined" && warehouse_options_request_1.WarehouseRelationQuery) === "function" ? _a : Object)
], WarehouseGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof warehouse_options_request_1.WarehouseFilterQuery !== "undefined" && warehouse_options_request_1.WarehouseFilterQuery) === "function" ? _b : Object)
], WarehouseGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof warehouse_options_request_1.WarehouseSortQuery !== "undefined" && warehouse_options_request_1.WarehouseSortQuery) === "function" ? _c : Object)
], WarehouseGetQuery.prototype, "sort", void 0);
class WarehousePaginationQuery extends (0, swagger_1.IntersectionType)(WarehouseGetQuery, query_1.PaginationQuery) {
}
exports.WarehousePaginationQuery = WarehousePaginationQuery;
class WarehouseGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(WarehouseGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.WarehouseGetManyQuery = WarehouseGetManyQuery;
class WarehouseGetOneQuery extends (0, swagger_1.PickType)(WarehouseGetQuery, ['relation']) {
}
exports.WarehouseGetOneQuery = WarehouseGetOneQuery;


/***/ }),
/* 655 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseSortQuery = exports.WarehouseFilterQuery = exports.WarehouseRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
const condition_timestamp_1 = __webpack_require__(291);
const query_1 = __webpack_require__(259);
class WarehouseRelationQuery {
}
exports.WarehouseRelationQuery = WarehouseRelationQuery;
class WarehouseFilterQuery {
}
exports.WarehouseFilterQuery = WarehouseFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], WarehouseFilterQuery.prototype, "updatedAt", void 0);
class WarehouseSortQuery extends query_1.SortQuery {
}
exports.WarehouseSortQuery = WarehouseSortQuery;


/***/ }),
/* 656 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseUpdateBody = exports.WarehouseCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(246);
class WarehouseCreateBody {
}
exports.WarehouseCreateBody = WarehouseCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], WarehouseCreateBody.prototype, "name", void 0);
class WarehouseUpdateBody extends (0, swagger_1.PartialType)(WarehouseCreateBody) {
}
exports.WarehouseUpdateBody = WarehouseUpdateBody;


/***/ }),
/* 657 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const app_service_1 = __webpack_require__(658);
let AppController = class AppController {
    constructor(appService) {
        this.appService = appService;
    }
    getHello(req) {
        return this.appService.getHello();
    }
};
exports.AppController = AppController;
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, common_1.Req)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", String)
], AppController.prototype, "getHello", null);
exports.AppController = AppController = __decorate([
    (0, swagger_1.ApiTags)('Home'),
    (0, common_1.Controller)(),
    __metadata("design:paramtypes", [typeof (_a = typeof app_service_1.AppService !== "undefined" && app_service_1.AppService) === "function" ? _a : Object])
], AppController);


/***/ }),
/* 658 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var AppService_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppService = void 0;
const common_1 = __webpack_require__(3);
let AppService = AppService_1 = class AppService {
    constructor() {
        this.logger = new common_1.Logger(AppService_1.name);
    }
    async onModuleInit() {
    }
    getHello() {
        return 'MEA-NestJS: Hello World!';
    }
};
exports.AppService = AppService;
exports.AppService = AppService = AppService_1 = __decorate([
    (0, common_1.Injectable)()
], AppService);


/***/ }),
/* 659 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HealthModule = void 0;
const axios_1 = __webpack_require__(660);
const common_1 = __webpack_require__(3);
const terminus_1 = __webpack_require__(661);
const health_controller_1 = __webpack_require__(662);
let HealthModule = class HealthModule {
};
exports.HealthModule = HealthModule;
exports.HealthModule = HealthModule = __decorate([
    (0, common_1.Module)({
        imports: [terminus_1.TerminusModule.forRoot(), axios_1.HttpModule],
        controllers: [health_controller_1.HealthController],
    })
], HealthModule);


/***/ }),
/* 660 */
/***/ ((module) => {

module.exports = require("@nestjs/axios");

/***/ }),
/* 661 */
/***/ ((module) => {

module.exports = require("@nestjs/terminus");

/***/ }),
/* 662 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HealthController = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(663);
const swagger_1 = __webpack_require__(6);
const terminus_1 = __webpack_require__(661);
let HealthController = class HealthController {
    constructor(health, http, db, disk, memory) {
        this.health = health;
        this.http = http;
        this.db = db;
        this.disk = disk;
        this.memory = memory;
    }
    check() {
        const pathStorage = process.platform === 'win32' ? 'C:\\' : '/';
        const thresholdPercent = process.platform === 'win32' ? 0.99 : 0.5;
        return this.health.check([
            () => this.db.pingCheck('database'),
        ]);
    }
};
exports.HealthController = HealthController;
__decorate([
    (0, common_1.Get)(),
    (0, terminus_1.HealthCheck)(),
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_MINUTE),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], HealthController.prototype, "check", null);
exports.HealthController = HealthController = __decorate([
    (0, swagger_1.ApiTags)('Health'),
    (0, common_1.Controller)('health'),
    __metadata("design:paramtypes", [typeof (_a = typeof terminus_1.HealthCheckService !== "undefined" && terminus_1.HealthCheckService) === "function" ? _a : Object, typeof (_b = typeof terminus_1.HttpHealthIndicator !== "undefined" && terminus_1.HttpHealthIndicator) === "function" ? _b : Object, typeof (_c = typeof terminus_1.TypeOrmHealthIndicator !== "undefined" && terminus_1.TypeOrmHealthIndicator) === "function" ? _c : Object, typeof (_d = typeof terminus_1.DiskHealthIndicator !== "undefined" && terminus_1.DiskHealthIndicator) === "function" ? _d : Object, typeof (_e = typeof terminus_1.MemoryHealthIndicator !== "undefined" && terminus_1.MemoryHealthIndicator) === "function" ? _e : Object])
], HealthController);


/***/ }),
/* 663 */
/***/ ((module) => {

module.exports = require("@nestjs/schedule");

/***/ }),
/* 664 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageManagerModule = void 0;
const common_1 = __webpack_require__(3);
const google_driver_module_1 = __webpack_require__(230);
const image_manager_service_1 = __webpack_require__(392);
let ImageManagerModule = class ImageManagerModule {
};
exports.ImageManagerModule = ImageManagerModule;
exports.ImageManagerModule = ImageManagerModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [google_driver_module_1.GoogleDriverModule],
        providers: [image_manager_service_1.ImageManagerService],
        exports: [image_manager_service_1.ImageManagerService],
    })
], ImageManagerModule);


/***/ }),
/* 665 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CronJobModule = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(663);
const google_driver_module_1 = __webpack_require__(230);
const cron_job_controller_1 = __webpack_require__(666);
const postgresql_job_1 = __webpack_require__(667);
let CronJobModule = class CronJobModule {
};
exports.CronJobModule = CronJobModule;
exports.CronJobModule = CronJobModule = __decorate([
    (0, common_1.Module)({
        imports: [schedule_1.ScheduleModule.forRoot(), google_driver_module_1.GoogleDriverModule],
        controllers: [cron_job_controller_1.CronJobController],
        providers: [postgresql_job_1.PostgresqlJob],
    })
], CronJobModule);


/***/ }),
/* 666 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CronJobController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const postgresql_job_1 = __webpack_require__(667);
let CronJobController = class CronJobController {
    constructor(postgresqlJob) {
        this.postgresqlJob = postgresqlJob;
    }
    async startJobBackupPostgres() {
        await this.postgresqlJob.startBackupPostgres();
        return await this.postgresqlJob.startJobUploadPostgres();
    }
};
exports.CronJobController = CronJobController;
__decorate([
    (0, common_1.Post)('job-backup-postgres'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], CronJobController.prototype, "startJobBackupPostgres", null);
exports.CronJobController = CronJobController = __decorate([
    (0, common_1.Controller)('cron-job'),
    (0, swagger_1.ApiTags)('Cron-Job'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    __metadata("design:paramtypes", [typeof (_a = typeof postgresql_job_1.PostgresqlJob !== "undefined" && postgresql_job_1.PostgresqlJob) === "function" ? _a : Object])
], CronJobController);


/***/ }),
/* 667 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PostgresqlJob_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlJob = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(663);
const fs_1 = __webpack_require__(668);
const mime_types_1 = __webpack_require__(669);
const path_1 = __webpack_require__(32);
const cache_data_service_1 = __webpack_require__(39);
const google_driver_service_1 = __webpack_require__(232);
let PostgresqlJob = PostgresqlJob_1 = class PostgresqlJob {
    constructor(cacheDataService, googleDriverService) {
        this.cacheDataService = cacheDataService;
        this.googleDriverService = googleDriverService;
        this.logger = new common_1.Logger(PostgresqlJob_1.name);
    }
    async startBackupPostgres() {
        this.logger.debug('===== Start Backup Database Postgres =====');
    }
    async startJobUploadPostgres() {
        this.logger.debug('===== Start Upload Database to GoogleDriver =====');
        const oid = 1;
        const appDir = process.cwd();
        const backupDir = (0, path_1.join)(appDir, 'data', 'backup');
        const sqlFiles = (0, fs_1.readdirSync)(backupDir)
            .filter((fileName) => fileName.endsWith('.sql'))
            .map((fileName) => {
            const fullPath = (0, path_1.join)(backupDir, fileName);
            const stats = (0, fs_1.statSync)(fullPath);
            return { fileName, fullPath, mtime: stats.mtime };
        });
        if (sqlFiles.length === 0) {
            throw new Error('Không tìm thấy file .sql nào trong thư mục ./data/backup');
        }
        const latestFile = sqlFiles.reduce((a, b) => (a.mtime > b.mtime ? a : b));
        const mimetype = (0, mime_types_1.lookup)(latestFile.fullPath) || 'application/sql';
        const fileStream = (0, fs_1.createReadStream)(latestFile.fullPath);
        const email = await this.cacheDataService.getEmailGoogleDriver(oid);
        const file = await this.googleDriverService.uploadFileStream({
            oid,
            fileStream,
            fileName: latestFile.fileName,
            mimetype,
            email,
        });
        return { data: { file } };
    }
};
exports.PostgresqlJob = PostgresqlJob;
__decorate([
    (0, schedule_1.Cron)('0 0 20 * * *'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], PostgresqlJob.prototype, "startBackupPostgres", null);
__decorate([
    (0, schedule_1.Cron)('0 30 20 * * *'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], PostgresqlJob.prototype, "startJobUploadPostgres", null);
exports.PostgresqlJob = PostgresqlJob = PostgresqlJob_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _b : Object])
], PostgresqlJob);


/***/ }),
/* 668 */
/***/ ((module) => {

module.exports = require("fs");

/***/ }),
/* 669 */
/***/ ((module) => {

module.exports = require("mime-types");

/***/ }),
/* 670 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EventListenerModule = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(671);
const visit_event_emit_1 = __webpack_require__(672);
const visit_event_listener_1 = __webpack_require__(674);
let EventListenerModule = class EventListenerModule {
};
exports.EventListenerModule = EventListenerModule;
exports.EventListenerModule = EventListenerModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [event_emitter_1.EventEmitterModule.forRoot()],
        controllers: [],
        providers: [visit_event_emit_1.VisitEventEmit, visit_event_listener_1.VisitEventListener],
        exports: [visit_event_emit_1.VisitEventEmit],
    })
], EventListenerModule);


/***/ }),
/* 671 */
/***/ ((module) => {

module.exports = require("@nestjs/event-emitter");

/***/ }),
/* 672 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VisitEventEmit = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(671);
const visit_event_constants_1 = __webpack_require__(673);
let VisitEventEmit = class VisitEventEmit {
    constructor(eventEmitter) {
        this.eventEmitter = eventEmitter;
    }
    async emitSendProductList(payload) {
        this.eventEmitter.emit(visit_event_constants_1.VISIT_EVENT.SEND_VISIT_PRODUCT_LIST, payload);
    }
    async emitRefundProductList(payload) {
        this.eventEmitter.emit(visit_event_constants_1.VISIT_EVENT.REFUND_VISIT_PRODUCT_LIST, payload);
    }
};
exports.VisitEventEmit = VisitEventEmit;
exports.VisitEventEmit = VisitEventEmit = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof event_emitter_1.EventEmitter2 !== "undefined" && event_emitter_1.EventEmitter2) === "function" ? _a : Object])
], VisitEventEmit);


/***/ }),
/* 673 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VISIT_EVENT = void 0;
exports.VISIT_EVENT = {
    SEND_VISIT_PRODUCT_LIST: 'SEND_VISIT_PRODUCT_LIST',
    REFUND_VISIT_PRODUCT_LIST: 'REFUND_VISIT_PRODUCT_LIST',
};


/***/ }),
/* 674 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var VisitEventListener_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VisitEventListener = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(671);
const visit_event_constants_1 = __webpack_require__(673);
let VisitEventListener = VisitEventListener_1 = class VisitEventListener {
    constructor() {
        this.logger = new common_1.Logger(VisitEventListener_1.name);
    }
    async listenSendProductList(payload) {
    }
    async listenRefundProductList(payload) {
    }
};
exports.VisitEventListener = VisitEventListener;
__decorate([
    (0, event_emitter_1.OnEvent)(visit_event_constants_1.VISIT_EVENT.SEND_VISIT_PRODUCT_LIST),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], VisitEventListener.prototype, "listenSendProductList", null);
__decorate([
    (0, event_emitter_1.OnEvent)(visit_event_constants_1.VISIT_EVENT.REFUND_VISIT_PRODUCT_LIST),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], VisitEventListener.prototype, "listenRefundProductList", null);
exports.VisitEventListener = VisitEventListener = VisitEventListener_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], VisitEventListener);


/***/ }),
/* 675 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketModule = void 0;
const common_1 = __webpack_require__(3);
const jwt_extend_module_1 = __webpack_require__(94);
const socket_emit_service_1 = __webpack_require__(306);
const socket_controller_1 = __webpack_require__(676);
const socket_gateway_1 = __webpack_require__(677);
let SocketModule = class SocketModule {
};
exports.SocketModule = SocketModule;
exports.SocketModule = SocketModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [jwt_extend_module_1.JwtExtendModule],
        controllers: [socket_controller_1.SocketController],
        providers: [socket_gateway_1.SocketGateway, socket_emit_service_1.SocketEmitService],
        exports: [socket_emit_service_1.SocketEmitService],
    })
], SocketModule);


/***/ }),
/* 676 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const external_request_1 = __webpack_require__(241);
const socket_emit_service_1 = __webpack_require__(306);
let SocketController = class SocketController {
    constructor(socketEmitService) {
        this.socketEmitService = socketEmitService;
    }
    async serverEmitDemo({ oid }) {
        this.socketEmitService.demo(oid);
    }
};
exports.SocketController = SocketController;
__decorate([
    (0, common_1.Get)('server-emit-demo'),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], SocketController.prototype, "serverEmitDemo", null);
exports.SocketController = SocketController = __decorate([
    (0, common_1.Controller)('socket'),
    (0, swagger_1.ApiTags)('Socket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object])
], SocketController);


/***/ }),
/* 677 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var SocketGateway_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketGateway = void 0;
const common_1 = __webpack_require__(3);
const websockets_1 = __webpack_require__(678);
const request_ip_1 = __webpack_require__(8);
const socket_io_1 = __webpack_require__(679);
const cache_data_service_1 = __webpack_require__(39);
const jwt_extend_service_1 = __webpack_require__(96);
const socket_emit_service_1 = __webpack_require__(306);
const socket_variable_1 = __webpack_require__(307);
let SocketGateway = SocketGateway_1 = class SocketGateway {
    constructor(socketEmitService, jwtExtendService, cacheDataService) {
        this.socketEmitService = socketEmitService;
        this.jwtExtendService = jwtExtendService;
        this.cacheDataService = cacheDataService;
        this.logger = new common_1.Logger(SocketGateway_1.name);
        this.connections = {};
    }
    afterInit(io) {
        this.socketEmitService.io = io;
        this.socketEmitService.connections = this.connections;
        this.logger.debug('🚀 ===== [SOCKET] SocketGateway Init =====');
    }
    async handleConnection(socket, ...args) {
        var _a;
        const { token } = socket.handshake.auth;
        const ip = (0, request_ip_1.getClientIp)(socket.client.request);
        try {
            if (!token) {
                throw new Error('error.Token.Empty');
            }
            const jwtPayloadRefresh = this.jwtExtendService.verifyRefreshToken(token, ip);
            const { uid, oid } = jwtPayloadRefresh.data;
            socket.data.user = await this.cacheDataService.getUser(oid, uid);
            socket.join(oid.toString());
            (_a = this.connections)[uid] || (_a[uid] = []);
            this.connections[uid].push({
                socketId: socket.id,
                refreshExp: jwtPayloadRefresh.exp,
            });
            this.logger.debug(`[OID=${oid}] UserId ${uid} with IP ${ip}, `
                + `socketId ${socket.id} connected, join room ${oid}`);
        }
        catch (error) {
            this.logger.warn(`IP ${ip} with SocketId ${socket.id} has invalid token. ERROR: ${error.message}`);
            socket.disconnect();
        }
    }
    async handleDisconnect(socket) {
        var _a, _b, _c;
        const oid = (_a = socket.data.user) === null || _a === void 0 ? void 0 : _a.oid;
        const uid = (_b = socket.data.user) === null || _b === void 0 ? void 0 : _b.id;
        this.connections[uid] = (_c = this.connections[uid]) === null || _c === void 0 ? void 0 : _c.filter((i) => i.socketId !== socket.id);
        this.logger.debug(`[OID=${oid}] UserId ${uid} with socketId ${socket.id} disconnected`);
    }
    async clientEmitVisitCreate(socket, data) {
        this.io
            .in(socket.data.user.oid.toString())
            .emit(socket_variable_1.SOCKET_EVENT.SERVER_EMIT_TICKET_CREATE, `${data}, ${new Date().toISOString()}`);
        return new Date().toISOString();
    }
};
exports.SocketGateway = SocketGateway;
__decorate([
    (0, websockets_1.WebSocketServer)(),
    __metadata("design:type", typeof (_d = typeof socket_io_1.Server !== "undefined" && socket_io_1.Server) === "function" ? _d : Object)
], SocketGateway.prototype, "io", void 0);
__decorate([
    (0, websockets_1.SubscribeMessage)(socket_variable_1.SOCKET_EVENT.CLIENT_EMIT_TICKET_CREATE),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _e : Object, Object]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], SocketGateway.prototype, "clientEmitVisitCreate", null);
exports.SocketGateway = SocketGateway = SocketGateway_1 = __decorate([
    (0, websockets_1.WebSocketGateway)({ cors: { origin: '*' }, transports: ['websocket'] }),
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object])
], SocketGateway);


/***/ }),
/* 678 */
/***/ ((module) => {

module.exports = require("@nestjs/websockets");

/***/ }),
/* 679 */
/***/ ((module) => {

module.exports = require("socket.io");

/***/ })
/******/ 	]);
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
var exports = __webpack_exports__;

Object.defineProperty(exports, "__esModule", ({ value: true }));
const cors_1 = __webpack_require__(1);
const helmet_1 = __webpack_require__(2);
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const platform_fastify_1 = __webpack_require__(5);
const swagger_1 = __webpack_require__(6);
const fastify_multer_1 = __webpack_require__(7);
const requestIp = __webpack_require__(8);
const exception_filter_1 = __webpack_require__(9);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(24);
const access_log_interceptor_1 = __webpack_require__(25);
const timeout_interceptor_1 = __webpack_require__(27);
const transform_response_interceptor_1 = __webpack_require__(28);
const environments_1 = __webpack_require__(29);
const app_module_1 = __webpack_require__(31);
async function bootstrap() {
    const logger = new common_1.Logger('bootstrap');
    const fastifyAdapter = new platform_fastify_1.FastifyAdapter();
    const app = await core_1.NestFactory.create(app_module_1.AppModule, fastifyAdapter, {
        logger: ['error', 'warn', 'log', 'debug'],
    });
    app.register(cors_1.default, { origin: '*' });
    app.register(fastify_multer_1.contentParser);
    await app.register(helmet_1.default, {
        contentSecurityPolicy: false,
    });
    app.use(requestIp.mw());
    app.useGlobalInterceptors(new access_log_interceptor_1.AccessLogInterceptor(), new timeout_interceptor_1.TimeoutInterceptor(), new transform_response_interceptor_1.TransformResponseInterceptor(), new common_1.ClassSerializerInterceptor(app.get(core_1.Reflector), {
        excludeExtraneousValues: true,
        exposeUnsetFields: false,
    }));
    app.useGlobalFilters(new exception_filter_1.ServerExceptionFilter());
    app.useGlobalGuards(new user_guard_1.UserGuard(app.get(core_1.Reflector)), new root_guard_1.RootGuard(app.get(core_1.Reflector)));
    app.useGlobalPipes(new common_1.ValidationPipe({
        validationError: { target: false, value: false },
        skipMissingProperties: true,
        whitelist: true,
        forbidNonWhitelisted: true,
        transform: true,
        transformOptions: {
            excludeExtraneousValues: false,
            exposeUnsetFields: false,
        },
        exceptionFactory: (errors = []) => new exception_filter_1.ValidationException(errors),
    }));
    const { NODE_VERSION, NODE_ENV, API_PUBLIC_HOST, API_PUBLIC_PORT, SQL_TYPE, SQL_HOST, SQL_PORT, SQL_DATABASE, } = (0, environments_1.GlobalConfig)();
    if (NODE_ENV !== 'production') {
        const config = new swagger_1.DocumentBuilder()
            .setTitle('Simple API')
            .setDescription('MEA API use Swagger')
            .setVersion('1.0')
            .addBearerAuth({ type: 'http', description: 'Access token' }, 'access-token')
            .build();
        const document = swagger_1.SwaggerModule.createDocument(app, config);
        swagger_1.SwaggerModule.setup('documents', app, document, {
            swaggerOptions: { persistAuthorization: true },
        });
    }
    await app.listen(API_PUBLIC_PORT, '0.0.0.0', () => {
        logger.debug(`🚀 ===== [API] Server document: http://${API_PUBLIC_HOST}:${API_PUBLIC_PORT}/documents/ =====`);
        logger.debug(`🚀 ===== [SQL] Database: jdbc:${SQL_TYPE}://${SQL_HOST}:${SQL_PORT}/${SQL_DATABASE} =====`);
        logger.debug(`🚀 ===== [TIME] ${new Date().toLocaleString()}, TimezoneOffset ${new Date().getTimezoneOffset()} =====`);
        logger.debug(`🚀 ===== [NODE] NodeJS version: ${NODE_VERSION} =====`);
    });
}
bootstrap();

})();

/******/ })()
;