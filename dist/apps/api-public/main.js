/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ([
/* 0 */,
/* 1 */
/***/ ((module) => {

module.exports = require("@fastify/cors");

/***/ }),
/* 2 */
/***/ ((module) => {

module.exports = require("@fastify/helmet");

/***/ }),
/* 3 */
/***/ ((module) => {

module.exports = require("@nestjs/common");

/***/ }),
/* 4 */
/***/ ((module) => {

module.exports = require("@nestjs/core");

/***/ }),
/* 5 */
/***/ ((module) => {

module.exports = require("@nestjs/platform-fastify");

/***/ }),
/* 6 */
/***/ ((module) => {

module.exports = require("@nestjs/swagger");

/***/ }),
/* 7 */
/***/ ((module) => {

module.exports = require("fastify-multer");

/***/ }),
/* 8 */
/***/ ((module) => {

module.exports = require("request-ip");

/***/ }),
/* 9 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ServerExceptionFilter = exports.BusinessException = exports.ValidationException = void 0;
const common_1 = __webpack_require__(3);
const throttler_1 = __webpack_require__(10);
const nestjs_i18n_1 = __webpack_require__(11);
const rxjs_1 = __webpack_require__(12);
const url = __webpack_require__(13);
const error_1 = __webpack_require__(14);
class ValidationException extends Error {
    constructor(validationErrors = []) {
        const getMessageError = (validate) => {
            return validate
                .map((i) => {
                if (i.constraints)
                    return Object.values(i.constraints).join('. ');
                if (i.children)
                    return getMessageError(i.children);
                return '---------';
            })
                .join('. ');
        };
        const msg = getMessageError(validationErrors);
        super(msg);
        this.errors = validationErrors;
    }
}
exports.ValidationException = ValidationException;
class BusinessException extends Error {
    constructor(message, args = {}, statusCode = common_1.HttpStatus.BAD_REQUEST) {
        super(message);
        this.statusCode = statusCode;
        this.args = args;
    }
    static create(options) {
        const { message, args, statusCode, details } = options;
        const exception = new BusinessException(message, args, statusCode);
        exception.details = details;
        return exception;
    }
}
exports.BusinessException = BusinessException;
let ServerExceptionFilter = class ServerExceptionFilter {
    catch(exception, host) {
        var _a, _b, _c;
        let statusCode = common_1.HttpStatus.INTERNAL_SERVER_ERROR;
        let { message } = exception;
        const { stack } = exception;
        let details = undefined;
        common_1.Logger.error(stack);
        const errors = exception.errors || [];
        const i18n = nestjs_i18n_1.I18nContext.current(host);
        switch (exception['constructor'].name) {
            case error_1.BusinessError.name: {
                statusCode = common_1.HttpStatus.BAD_REQUEST;
                break;
            }
            case ValidationException.name: {
                statusCode = common_1.HttpStatus.UNPROCESSABLE_ENTITY;
                break;
            }
            case BusinessException.name: {
                const businessException = exception;
                message = i18n.translate(exception.message, {
                    args: businessException.args,
                });
                statusCode = businessException.statusCode;
                details = businessException.details;
                break;
            }
            case throttler_1.ThrottlerException.name: {
                statusCode = common_1.HttpStatus.TOO_MANY_REQUESTS;
                message = i18n.translate('common.TooManyRequests');
                break;
            }
            case common_1.NotFoundException.name: {
                statusCode = common_1.HttpStatus.NOT_FOUND;
                break;
            }
            case common_1.ForbiddenException.name: {
                statusCode = common_1.HttpStatus.FORBIDDEN;
                message = i18n.translate('common.Forbidden');
                break;
            }
            case common_1.HttpException.name: {
                statusCode = exception.status;
                message = i18n.translate(exception.message, {});
                break;
            }
        }
        const [req, res] = host.getArgs();
        if (host.getType() === 'http') {
            const ctx = host.switchToHttp();
            const response = ctx.getResponse();
            const request = ctx.getRequest();
            const { external } = request.raw;
            const { originalUrl, method, body } = request;
            const urlParse = url.parse(originalUrl, true);
            const basicExternal = {
                ip: external.ip,
                browser: external.browser,
                mobile: external.mobile,
                uid: external.uid,
                oid: external.oid,
                username: (_a = external.user) === null || _a === void 0 ? void 0 : _a.username,
                phone: (_b = external.organization) === null || _b === void 0 ? void 0 : _b.phone,
                email: (_c = external.organization) === null || _c === void 0 ? void 0 : _c.email,
            };
            const logMessage = JSON.stringify({
                statusCode,
                message,
                type: '[HTTP]',
                method,
                path: urlParse.pathname,
                query: urlParse.query,
                errors,
                body,
                external: basicExternal,
            });
            if (statusCode === common_1.HttpStatus.UNPROCESSABLE_ENTITY) {
                common_1.Logger.warn(logMessage, exception.name);
            }
            else if (statusCode === common_1.HttpStatus.NOT_FOUND) {
                common_1.Logger.debug(logMessage, exception.name);
            }
            else {
                common_1.Logger.error(logMessage, exception.name);
            }
            return response.code(statusCode).send({
                statusCode,
                errors,
                message,
                details,
                path: originalUrl,
                time: new Date().toISOString(),
            });
        }
        else if (host.getType() === 'rpc') {
            if (res.constructor.name === 'NatsContext') {
                const response = res;
                const info = {
                    statusCode,
                    message,
                    errors,
                    details: {
                        subject: response.getSubject(),
                        request: req,
                        stack,
                    },
                };
                return (0, rxjs_1.from)([info]);
            }
            else if (res.constructor.name === 'KafkaContext') {
                const response = res;
                const info = {
                    statusCode,
                    message,
                    errors,
                    details: {
                        topic: response.getTopic(),
                        partition: response.getPartition(),
                        offset: response.getMessage().offset,
                        request: req,
                    },
                };
                return (0, rxjs_1.from)([info]);
            }
        }
    }
};
exports.ServerExceptionFilter = ServerExceptionFilter;
exports.ServerExceptionFilter = ServerExceptionFilter = __decorate([
    (0, common_1.Catch)(Error)
], ServerExceptionFilter);


/***/ }),
/* 10 */
/***/ ((module) => {

module.exports = require("@nestjs/throttler");

/***/ }),
/* 11 */
/***/ ((module) => {

module.exports = require("nestjs-i18n");

/***/ }),
/* 12 */
/***/ ((module) => {

module.exports = require("rxjs");

/***/ }),
/* 13 */
/***/ ((module) => {

module.exports = require("url");

/***/ }),
/* 14 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BusinessError = void 0;
class BusinessError extends Error {
    constructor(...messages) {
        const messageConvert = messages.map((i) => {
            if (typeof i === 'object') {
                return JSON.stringify(i);
            }
            return i;
        });
        super(messageConvert.join(' '));
    }
}
exports.BusinessError = BusinessError;


/***/ }),
/* 15 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootGuard = exports.IsRoot = exports.ROOT_GUARD = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const exception_filter_1 = __webpack_require__(9);
exports.ROOT_GUARD = 'ROOT_GUARD';
const IsRoot = () => (0, common_1.SetMetadata)(exports.ROOT_GUARD, true);
exports.IsRoot = IsRoot;
let RootGuard = class RootGuard {
    constructor(reflector) {
        this.reflector = reflector;
    }
    async canActivate(context) {
        const requireRoot = this.reflector.getAllAndOverride(exports.ROOT_GUARD, [
            context.getHandler(),
            context.getClass(),
        ]);
        if (!requireRoot)
            return true;
        const request = context.switchToHttp().getRequest();
        const { external } = request.raw;
        if (!external.uid
            || !external.oid
            || !external.user
            || !external.organization
            || !!external.user.deletedAt
            || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        return external.oid === 1;
    }
};
exports.RootGuard = RootGuard;
exports.RootGuard = RootGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object])
], RootGuard);


/***/ }),
/* 16 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Organization_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const image_entity_1 = __webpack_require__(19);
const user_entity_1 = __webpack_require__(20);
var OrganizationStatus;
(function (OrganizationStatus) {
    OrganizationStatus[OrganizationStatus["Inactive"] = 0] = "Inactive";
    OrganizationStatus[OrganizationStatus["Active"] = 1] = "Active";
    OrganizationStatus[OrganizationStatus["Frequent"] = 2] = "Frequent";
})(OrganizationStatus || (exports.OrganizationStatus = OrganizationStatus = {}));
let Organization = Organization_1 = class Organization {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Organization_1();
        Object.assign(entity, raw);
        entity.createdAt = raw.createdAt == null ? raw.createdAt : Number(raw.createdAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Organization_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Organization.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Organization.prototype, "organizationCode", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: false }),
    __metadata("design:type", String)
], Organization.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "email", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Organization.prototype, "facebook", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "emailVerify", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', default: JSON.stringify({}) }),
    __metadata("design:type", String)
], Organization.prototype, "dataVersion", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    __metadata("design:type", Number)
], Organization.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Organization.prototype, "logoImageId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressProvince", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressWard", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], Organization.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '[]' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Organization.prototype, "permissionIds", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], Organization.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Organization.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Organization.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.OneToOne)(() => image_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'logoImageId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof image_entity_1.default !== "undefined" && image_entity_1.default) === "function" ? _a : Object)
], Organization.prototype, "logoImage", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => user_entity_1.default, (user) => user.organization),
    __metadata("design:type", Array)
], Organization.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Organization.prototype, "dataVersionParse", void 0);
Organization = Organization_1 = __decorate([
    (0, typeorm_1.Entity)('Organization'),
    (0, typeorm_1.Index)('IDX_Organization__organization_code', ['organizationCode'], { unique: true })
], Organization);
exports["default"] = Organization;


/***/ }),
/* 17 */
/***/ ((module) => {

module.exports = require("class-transformer");

/***/ }),
/* 18 */
/***/ ((module) => {

module.exports = require("typeorm");

/***/ }),
/* 19 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Image_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageHostType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
var ImageHostType;
(function (ImageHostType) {
    ImageHostType["GoogleDriver"] = "GoogleDriver";
    ImageHostType["Cloudinary"] = "Cloudinary";
})(ImageHostType || (exports.ImageHostType = ImageHostType = {}));
let Image = Image_1 = class Image {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Image_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Image_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Image.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Image.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "mimeType", void 0);
__decorate([
    (0, typeorm_1.Column)({}),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "size", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: ImageHostType.GoogleDriver }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "hostType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "hostAccount", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "externalId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Image.prototype, "externalUrl", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Image.prototype, "waitDelete", void 0);
Image = Image_1 = __decorate([
    (0, typeorm_1.Entity)('Image')
], Image);
exports["default"] = Image;


/***/ }),
/* 20 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var User_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGroup = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const organization_entity_1 = __webpack_require__(16);
const user_role_entity_1 = __webpack_require__(22);
const user_room_entity_1 = __webpack_require__(24);
var UserGroup;
(function (UserGroup) {
    UserGroup["ROOT"] = "ROOT";
})(UserGroup || (exports.UserGroup = UserGroup = {}));
let User = User_1 = class User {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new User_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => User_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], User.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], User.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], User.prototype, "username", void 0);
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)({ name: 'hashPassword', type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], User.prototype, "hashPassword", void 0);
__decorate([
    (0, class_transformer_1.Expose)({ groups: [UserGroup.ROOT] }),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "secret", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    __metadata("design:type", String)
], User.prototype, "fullName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "birthday", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], User.prototype, "gender", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    __metadata("design:type", Number)
], User.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    __metadata("design:type", Number)
], User.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], User.prototype, "imageIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], User.prototype, "deletedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => organization_entity_1.default, (organization) => organization.userList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'oid', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof organization_entity_1.default !== "undefined" && organization_entity_1.default) === "function" ? _b : Object)
], User.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)((type) => user_role_entity_1.default, (userRole) => userRole.user),
    __metadata("design:type", Array)
], User.prototype, "userRoleList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)((type) => user_room_entity_1.default, (userRoom) => userRoom.user),
    __metadata("design:type", Array)
], User.prototype, "userRoomList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], User.prototype, "devices", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], User.prototype, "imageList", void 0);
User = User_1 = __decorate([
    (0, typeorm_1.Entity)('User')
], User);
exports["default"] = User;


/***/ }),
/* 21 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMoneyStatus = exports.TicketLaboratoryStatus = exports.TicketProcedureStatus = exports.AttributeLayoutType = exports.AttributeInputType = exports.DeliveryStatus = exports.MovementType = exports.PickupStrategy = exports.PaymentType = exports.DiscountType = exports.EOrder = exports.ERole = exports.EGender = void 0;
var EGender;
(function (EGender) {
    EGender[EGender["Female"] = 0] = "Female";
    EGender[EGender["Male"] = 1] = "Male";
})(EGender || (exports.EGender = EGender = {}));
var ERole;
(function (ERole) {
    ERole[ERole["Root"] = 0] = "Root";
    ERole[ERole["Admin"] = 1] = "Admin";
    ERole[ERole["User"] = 2] = "User";
})(ERole || (exports.ERole = ERole = {}));
var EOrder;
(function (EOrder) {
    EOrder[EOrder["ASC"] = 0] = "ASC";
    EOrder[EOrder["DESC"] = 1] = "DESC";
})(EOrder || (exports.EOrder = EOrder = {}));
var DiscountType;
(function (DiscountType) {
    DiscountType["Percent"] = "%";
    DiscountType["VND"] = "VN\u0110";
})(DiscountType || (exports.DiscountType = DiscountType = {}));
var PaymentType;
(function (PaymentType) {
    PaymentType[PaymentType["Prepayment"] = 1] = "Prepayment";
    PaymentType[PaymentType["ReceiveRefund"] = 2] = "ReceiveRefund";
    PaymentType[PaymentType["Close"] = 3] = "Close";
    PaymentType[PaymentType["PayDebt"] = 4] = "PayDebt";
    PaymentType[PaymentType["Reopen"] = 5] = "Reopen";
})(PaymentType || (exports.PaymentType = PaymentType = {}));
var PickupStrategy;
(function (PickupStrategy) {
    PickupStrategy[PickupStrategy["Inherit"] = -1] = "Inherit";
    PickupStrategy[PickupStrategy["NoImpact"] = 0] = "NoImpact";
    PickupStrategy[PickupStrategy["RequireBatchSelection"] = 1] = "RequireBatchSelection";
    PickupStrategy[PickupStrategy["AutoWithFIFO"] = 2] = "AutoWithFIFO";
    PickupStrategy[PickupStrategy["AutoWithExpiryDate"] = 3] = "AutoWithExpiryDate";
})(PickupStrategy || (exports.PickupStrategy = PickupStrategy = {}));
var MovementType;
(function (MovementType) {
    MovementType[MovementType["PurchaseOrder"] = 1] = "PurchaseOrder";
    MovementType[MovementType["Ticket"] = 2] = "Ticket";
    MovementType[MovementType["UserChange"] = 3] = "UserChange";
    MovementType[MovementType["StockCheck"] = 4] = "StockCheck";
    MovementType[MovementType["Excel"] = 5] = "Excel";
})(MovementType || (exports.MovementType = MovementType = {}));
var DeliveryStatus;
(function (DeliveryStatus) {
    DeliveryStatus[DeliveryStatus["NoStock"] = 1] = "NoStock";
    DeliveryStatus[DeliveryStatus["Pending"] = 2] = "Pending";
    DeliveryStatus[DeliveryStatus["Delivered"] = 3] = "Delivered";
})(DeliveryStatus || (exports.DeliveryStatus = DeliveryStatus = {}));
var AttributeInputType;
(function (AttributeInputType) {
    AttributeInputType["InputText"] = "InputText";
    AttributeInputType["InputNumber"] = "InputNumber";
    AttributeInputType["InputDate"] = "InputDate";
    AttributeInputType["Select"] = "Select";
})(AttributeInputType || (exports.AttributeInputType = AttributeInputType = {}));
var AttributeLayoutType;
(function (AttributeLayoutType) {
    AttributeLayoutType["Table"] = "B\u1EA3ng";
    AttributeLayoutType["InputAndLabelTop"] = "Input v\u00E0 Nh\u00E3n b\u00EAn tr\u00EAn";
    AttributeLayoutType["InputAndLabelLeft"] = "Input v\u00E0 Nh\u00E3n b\u00EAn tr\u00E1i";
})(AttributeLayoutType || (exports.AttributeLayoutType = AttributeLayoutType = {}));
var TicketProcedureStatus;
(function (TicketProcedureStatus) {
    TicketProcedureStatus[TicketProcedureStatus["Empty"] = 1] = "Empty";
    TicketProcedureStatus[TicketProcedureStatus["Pending"] = 2] = "Pending";
    TicketProcedureStatus[TicketProcedureStatus["Executing"] = 3] = "Executing";
    TicketProcedureStatus[TicketProcedureStatus["Completed"] = 4] = "Completed";
})(TicketProcedureStatus || (exports.TicketProcedureStatus = TicketProcedureStatus = {}));
var TicketLaboratoryStatus;
(function (TicketLaboratoryStatus) {
    TicketLaboratoryStatus[TicketLaboratoryStatus["Empty"] = 1] = "Empty";
    TicketLaboratoryStatus[TicketLaboratoryStatus["Pending"] = 2] = "Pending";
    TicketLaboratoryStatus[TicketLaboratoryStatus["Completed"] = 3] = "Completed";
})(TicketLaboratoryStatus || (exports.TicketLaboratoryStatus = TicketLaboratoryStatus = {}));
var PaymentMoneyStatus;
(function (PaymentMoneyStatus) {
    PaymentMoneyStatus[PaymentMoneyStatus["NoEffect"] = 1] = "NoEffect";
    PaymentMoneyStatus[PaymentMoneyStatus["Pending"] = 2] = "Pending";
    PaymentMoneyStatus[PaymentMoneyStatus["Partial"] = 3] = "Partial";
    PaymentMoneyStatus[PaymentMoneyStatus["Paid"] = 4] = "Paid";
})(PaymentMoneyStatus || (exports.PaymentMoneyStatus = PaymentMoneyStatus = {}));


/***/ }),
/* 22 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var UserRole_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const role_entity_1 = __webpack_require__(23);
const user_entity_1 = __webpack_require__(20);
let UserRole = UserRole_1 = class UserRole {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new UserRole_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => UserRole_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], UserRole.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "userId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRole.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, (role) => role.userRoleList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _a : Object)
], UserRole.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, (user) => user.userRoleList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'userId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _b : Object)
], UserRole.prototype, "user", void 0);
UserRole = UserRole_1 = __decorate([
    (0, typeorm_1.Entity)('UserRole')
], UserRole);
exports["default"] = UserRole;


/***/ }),
/* 23 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Role_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const user_role_entity_1 = __webpack_require__(22);
let Role = Role_1 = class Role {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Role_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Role_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Role.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "roleCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '[]' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Role.prototype, "permissionIds", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Role.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => user_role_entity_1.default, (userRole) => userRole.role),
    __metadata("design:type", Array)
], Role.prototype, "userRoleList", void 0);
Role = Role_1 = __decorate([
    (0, typeorm_1.Entity)('Role')
], Role);
exports["default"] = Role;


/***/ }),
/* 24 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var UserRoom_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const room_entity_1 = __webpack_require__(25);
const user_entity_1 = __webpack_require__(20);
let UserRoom = UserRoom_1 = class UserRoom {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new UserRoom_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => UserRoom_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRoom.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], UserRoom.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRoom.prototype, "userId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], UserRoom.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => room_entity_1.default, (role) => role.userRoomList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roomId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof room_entity_1.default !== "undefined" && room_entity_1.default) === "function" ? _a : Object)
], UserRoom.prototype, "room", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, (user) => user.userRoomList, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'userId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _b : Object)
], UserRoom.prototype, "user", void 0);
UserRoom = UserRoom_1 = __decorate([
    (0, typeorm_1.Entity)('UserRoom')
], UserRoom);
exports["default"] = UserRoom;


/***/ }),
/* 25 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Room_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomTicketStyle = exports.RoomType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const user_room_entity_1 = __webpack_require__(24);
var RoomType;
(function (RoomType) {
    RoomType[RoomType["Ticket"] = 1] = "Ticket";
    RoomType[RoomType["Product"] = 2] = "Product";
    RoomType[RoomType["Procedure"] = 3] = "Procedure";
    RoomType[RoomType["Laboratory"] = 4] = "Laboratory";
    RoomType[RoomType["Radiology"] = 5] = "Radiology";
})(RoomType || (exports.RoomType = RoomType = {}));
var RoomTicketStyle;
(function (RoomTicketStyle) {
    RoomTicketStyle[RoomTicketStyle["TicketReception"] = 101] = "TicketReception";
    RoomTicketStyle[RoomTicketStyle["TicketOrder"] = 111] = "TicketOrder";
    RoomTicketStyle[RoomTicketStyle["TicketClinicGeneral"] = 121] = "TicketClinicGeneral";
    RoomTicketStyle[RoomTicketStyle["TicketClinicObstetric"] = 122] = "TicketClinicObstetric";
    RoomTicketStyle[RoomTicketStyle["TicketClinicEye"] = 123] = "TicketClinicEye";
    RoomTicketStyle[RoomTicketStyle["TicketSpa"] = 151] = "TicketSpa";
})(RoomTicketStyle || (exports.RoomTicketStyle = RoomTicketStyle = {}));
let Room = Room_1 = class Room {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Room_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Room_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Room.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Room.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Room.prototype, "code", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], Room.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: RoomType.Product }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Room.prototype, "roomType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Room.prototype, "roomStyle", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Room.prototype, "isCommon", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)((type) => user_room_entity_1.default, (userRoom) => userRoom.room),
    __metadata("design:type", Array)
], Room.prototype, "userRoomList", void 0);
Room = Room_1 = __decorate([
    (0, typeorm_1.Entity)('Room')
], Room);
exports["default"] = Room;


/***/ }),
/* 26 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AccessLogInterceptor = void 0;
const common_1 = __webpack_require__(3);
const rxjs_1 = __webpack_require__(12);
const operators_1 = __webpack_require__(27);
const url = __webpack_require__(13);
const exception_filter_1 = __webpack_require__(9);
let AccessLogInterceptor = class AccessLogInterceptor {
    constructor(logger = new common_1.Logger('ACCESS_LOG')) {
        this.logger = logger;
    }
    intercept(context, next) {
        var _a, _b, _c;
        const createTime = new Date();
        const className = context.getClass().name;
        const funcName = context.getHandler().name;
        const [req, res] = context.getArgs();
        const showData = true;
        const message = {};
        if (context.getType() === 'http') {
            const ctx = context.switchToHttp();
            const request = ctx.getRequest();
            const { external } = request.raw;
            const basicExternal = {
                ip: external.ip,
                browser: external.browser,
                mobile: external.mobile,
                uid: external.uid,
                oid: external.oid,
                username: (_a = external.user) === null || _a === void 0 ? void 0 : _a.username,
                phone: (_b = external.organization) === null || _b === void 0 ? void 0 : _b.phone,
                email: (_c = external.organization) === null || _c === void 0 ? void 0 : _c.email,
            };
            const urlParse = url.parse(request.originalUrl, true);
            if (basicExternal.oid) {
                message.OID = basicExternal.oid;
            }
            message.type = '[API]';
            message.method = request.method;
            message.url = `${request.protocol}://${request.raw.hostname}${urlParse.pathname}`;
            message.query = urlParse.query;
            message.className = className;
            message.funcName = funcName;
            message.external = basicExternal;
            if (showData) {
                message.body = request.body;
            }
        }
        else if (context.getType() === 'rpc') {
            if (res.constructor.name === 'NatsContext') {
                const response = res;
                message.type = '[NATS]';
                message.subject = response.getSubject();
                message.className = className;
                message.funcName = funcName;
                if (showData) {
                    message.request = req;
                }
            }
            if (res.constructor.name === 'KafkaContext') {
                const response = res;
                message.type = '[KAFKA]';
                message.topic = response.getTopic();
                message.partition = response.getPartition();
                message.offset = response.getMessage().offset;
                message.className = className;
                message.funcName = funcName;
                if (showData) {
                    message.request = req;
                }
                message.topicInfo = {
                    topic: response.getTopic(),
                    partition: response.getPartition(),
                    offset: response.getMessage().offset,
                };
            }
        }
        return next.handle().pipe((0, operators_1.catchError)((err) => {
            message.errorMessage = err.message;
            message.time = `${Date.now() - createTime.getTime()}ms`;
            if (err instanceof exception_filter_1.ValidationException) {
                message.errors = err.errors;
                this.logger.warn(JSON.stringify(message));
            }
            else {
                this.logger.error(JSON.stringify(message));
            }
            return (0, rxjs_1.throwError)(() => err);
        }), (0, operators_1.tap)((xx) => {
            message.time = `${Date.now() - createTime.getTime()}ms`;
            this.logger.log(JSON.stringify(message));
        }));
    }
};
exports.AccessLogInterceptor = AccessLogInterceptor;
exports.AccessLogInterceptor = AccessLogInterceptor = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Object])
], AccessLogInterceptor);


/***/ }),
/* 27 */
/***/ ((module) => {

module.exports = require("rxjs/operators");

/***/ }),
/* 28 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TimeoutInterceptor = void 0;
const common_1 = __webpack_require__(3);
const rxjs_1 = __webpack_require__(12);
const operators_1 = __webpack_require__(27);
let TimeoutInterceptor = class TimeoutInterceptor {
    intercept(context, next) {
        return next.handle().pipe((0, operators_1.timeout)(10000), (0, operators_1.catchError)((err) => {
            if (err instanceof rxjs_1.TimeoutError) {
                return (0, rxjs_1.throwError)(() => new common_1.RequestTimeoutException());
            }
            return (0, rxjs_1.throwError)(() => err);
        }));
    }
};
exports.TimeoutInterceptor = TimeoutInterceptor;
exports.TimeoutInterceptor = TimeoutInterceptor = __decorate([
    (0, common_1.Injectable)()
], TimeoutInterceptor);


/***/ }),
/* 29 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TransformResponseInterceptor = void 0;
const common_1 = __webpack_require__(3);
const nestjs_i18n_1 = __webpack_require__(11);
const operators_1 = __webpack_require__(27);
let TransformResponseInterceptor = class TransformResponseInterceptor {
    intercept(context, next) {
        const i18n = nestjs_i18n_1.I18nContext.current();
        return next.handle().pipe((0, operators_1.map)((response) => ({
            success: (response === null || response === void 0 ? void 0 : response.success) != null ? response === null || response === void 0 ? void 0 : response.success : true,
            message: i18n.translate((response === null || response === void 0 ? void 0 : response.message) || 'common.Success', {
                args: (response === null || response === void 0 ? void 0 : response.args) || {},
            }),
            time: new Date().toISOString(),
            meta: response === null || response === void 0 ? void 0 : response.meta,
            data: response === null || response === void 0 ? void 0 : response.data,
        })));
    }
};
exports.TransformResponseInterceptor = TransformResponseInterceptor;
exports.TransformResponseInterceptor = TransformResponseInterceptor = __decorate([
    (0, common_1.Injectable)()
], TransformResponseInterceptor);


/***/ }),
/* 30 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailConfig = exports.GlobalConfig = void 0;
const config_1 = __webpack_require__(31);
exports.GlobalConfig = (0, config_1.registerAs)('global', () => ({
    NODE_VERSION: process.versions.node,
    NODE_ENV: process.env.NODE_ENV,
    DOMAIN_FRONT_END: process.env.DOMAIN_FRONT_END,
    DOMAIN_BACK_END: process.env.DOMAIN_BACK_END,
    API_PUBLIC_HOST: process.env.API_PUBLIC_HOST || 'localhost',
    API_PUBLIC_PORT: Number(process.env.API_PUBLIC_PORT || 20000),
    FILE_SERVICE_HOST: process.env.FILE_SERVICE_HOST || 'localhost',
    FILE_SERVICE_PORT: Number(process.env.FILE_SERVICE_PORT || 20000),
    SQL_TYPE: process.env.SQL_TYPE,
    SQL_HOST: process.env.SQL_HOST,
    SQL_PORT: process.env.SQL_PORT,
    SQL_DATABASE: process.env.SQL_DATABASE,
}));
exports.EmailConfig = (0, config_1.registerAs)('email', () => ({
    name: process.env.EMAIL_NAME || 'medihome',
    host: process.env.EMAIL_HOST || 'smtp.gmail.com',
    port: +process.env.EMAIL_PORT || 465,
    user: process.env.EMAIL_USER || 'medihome.vn@gmail.com',
    password: process.env.EMAIL_PASSWORD,
    from: process.env.EMAIL_ADDRESS || 'medihome.vn@gmail.com',
    subject_prefix: process.env.EMAIL_SUBJECT_PREFIX || '【medihome】',
}));


/***/ }),
/* 31 */
/***/ ((module) => {

module.exports = require("@nestjs/config");

/***/ }),
/* 32 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const core_1 = __webpack_require__(4);
const throttler_1 = __webpack_require__(10);
const nestjs_i18n_1 = __webpack_require__(11);
const path = __webpack_require__(33);
const cache_data_module_1 = __webpack_require__(34);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const jwt_extend_module_1 = __webpack_require__(158);
const detect_client_middleware_1 = __webpack_require__(162);
const postgresql_module_1 = __webpack_require__(163);
const google_driver_module_1 = __webpack_require__(226);
const auth_module_1 = __webpack_require__(231);
const api_file_module_1 = __webpack_require__(263);
const api_root_module_1 = __webpack_require__(332);
const api_module_1 = __webpack_require__(355);
const app_controller_1 = __webpack_require__(810);
const app_service_1 = __webpack_require__(811);
const email_module_1 = __webpack_require__(233);
const health_module_1 = __webpack_require__(812);
const image_manager_module_1 = __webpack_require__(817);
const cron_job_module_1 = __webpack_require__(818);
const event_listener_module_1 = __webpack_require__(823);
const socket_module_1 = __webpack_require__(828);
let AppModule = class AppModule {
    configure(consumer) {
        consumer.apply(nestjs_i18n_1.I18nMiddleware).forRoutes('*');
        consumer.apply(detect_client_middleware_1.DetectClientMiddleware).forRoutes('*');
    }
};
exports.AppModule = AppModule;
exports.AppModule = AppModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forRoot({
                envFilePath: [`.env.${process.env.NODE_ENV || 'local'}`, '.env'],
                isGlobal: true,
            }),
            throttler_1.ThrottlerModule.forRoot([{ ttl: 5000, limit: 10 }]),
            nestjs_i18n_1.I18nModule.forRoot({
                fallbackLanguage: 'vi',
                loader: nestjs_i18n_1.I18nJsonLoader,
                loaderOptions: {
                    path: path.join(__dirname, '../../../assets/i18n/'),
                    watch: true,
                },
                resolvers: [new nestjs_i18n_1.QueryResolver(['lang', 'l']), new nestjs_i18n_1.HeaderResolver(['x-lang'])],
                typesOutputPath: path.join(__dirname, '../../../assets/generated/i18n.generated.ts'),
            }),
            postgresql_module_1.PostgresqlModule,
            jwt_extend_module_1.JwtExtendModule,
            google_driver_module_1.GoogleDriverModule,
            health_module_1.HealthModule,
            email_module_1.EmailModule,
            image_manager_module_1.ImageManagerModule,
            cron_job_module_1.CronJobModule,
            event_listener_module_1.EventListenerModule,
            socket_module_1.SocketModule,
            cache_data_module_1.CacheDataModule,
            auth_module_1.AuthModule,
            api_module_1.ApiModule,
            api_file_module_1.ApiFileModule,
            api_root_module_1.ApiRootModule,
        ],
        controllers: [app_controller_1.AppController],
        providers: [
            {
                provide: core_1.APP_GUARD,
                useClass: throttler_1.ThrottlerGuard,
            },
            {
                provide: core_1.APP_GUARD,
                useClass: user_guard_1.UserGuard,
            },
            {
                provide: core_1.APP_GUARD,
                useClass: organization_guard_1.OrganizationGuard,
            },
            app_service_1.AppService,
        ],
    })
], AppModule);


/***/ }),
/* 33 */
/***/ ((module) => {

module.exports = require("path");

/***/ }),
/* 34 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheDataModule = void 0;
const common_1 = __webpack_require__(3);
const redis_module_1 = __webpack_require__(35);
const cache_data_service_1 = __webpack_require__(40);
const cache_token_service_1 = __webpack_require__(155);
let CacheDataModule = class CacheDataModule {
};
exports.CacheDataModule = CacheDataModule;
exports.CacheDataModule = CacheDataModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [redis_module_1.RedisModule],
        providers: [cache_data_service_1.CacheDataService, cache_token_service_1.CacheTokenService],
        exports: [cache_data_service_1.CacheDataService, cache_token_service_1.CacheTokenService],
    })
], CacheDataModule);


/***/ }),
/* 35 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const redis_config_1 = __webpack_require__(36);
const redis_controller_1 = __webpack_require__(37);
const redis_service_1 = __webpack_require__(38);
let RedisModule = class RedisModule {
};
exports.RedisModule = RedisModule;
exports.RedisModule = RedisModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(redis_config_1.RedisConfig)],
        controllers: [redis_controller_1.RedisController],
        providers: [redis_service_1.RedisService],
        exports: [redis_service_1.RedisService],
    })
], RedisModule);


/***/ }),
/* 36 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisConfig = void 0;
const config_1 = __webpack_require__(31);
exports.RedisConfig = (0, config_1.registerAs)('redis', () => ({
    host: process.env.REDIS_HOST,
    port: Number(process.env.REDIS_PORT),
    password: process.env.REDIS_PASSWORD,
    db: process.env.REDIS_DB || '0',
}));


/***/ }),
/* 37 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const redis_service_1 = __webpack_require__(38);
let RedisController = class RedisController {
    constructor(redisService) {
        this.redisService = redisService;
    }
    async get({ key }) {
        const value = await this.redisService.get(key);
        return { data: { key, value } };
    }
    async getKeys({ pattern }) {
        const keys = await this.redisService.getKeys(pattern + '*');
        return { data: { keys } };
    }
    async set(body) {
        const { key, value, milliseconds } = body;
        await this.redisService.set(key, value, { datetime: new Date(Date.now() + milliseconds) });
        return { data: { key, value } };
    }
    async del(key) {
        await this.redisService.del(key);
        return { data: { key } };
    }
};
exports.RedisController = RedisController;
__decorate([
    (0, common_1.Get)('get/:key'),
    (0, swagger_1.ApiParam)({ name: 'key', example: 'demo', required: true }),
    __param(0, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "get", null);
__decorate([
    (0, common_1.Get)('get-keys'),
    (0, swagger_1.ApiQuery)({ name: 'pattern', example: 'TOKEN_', required: true }),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "getKeys", null);
__decorate([
    (0, common_1.Post)('set'),
    (0, swagger_1.ApiBody)({
        schema: {
            type: 'object',
            properties: {
                key: { type: 'string', example: 'demo' },
                value: { type: 'string', example: 'hah hah hah' },
                milliseconds: { type: 'number', example: 10000 },
            },
        },
    }),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "set", null);
__decorate([
    (0, common_1.Delete)('del/:key'),
    (0, swagger_1.ApiParam)({ name: 'key', example: 'demo', required: true }),
    __param(0, (0, common_1.Param)('key')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], RedisController.prototype, "del", null);
exports.RedisController = RedisController = __decorate([
    (0, swagger_1.ApiTags)('Redis'),
    (0, common_1.Controller)('redis'),
    __metadata("design:paramtypes", [typeof (_a = typeof redis_service_1.RedisService !== "undefined" && redis_service_1.RedisService) === "function" ? _a : Object])
], RedisController);


/***/ }),
/* 38 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var RedisService_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RedisService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const redis_1 = __webpack_require__(39);
const redis_config_1 = __webpack_require__(36);
let RedisService = RedisService_1 = class RedisService {
    constructor(redisConfig) {
        this.redisConfig = redisConfig;
        this.logger = new common_1.Logger(RedisService_1.name);
    }
    async onModuleInit() {
        try {
            this.redisClient = (0, redis_1.createClient)({
                url: `redis://${this.redisConfig.host}:${this.redisConfig.port}`,
                password: this.redisConfig.password,
            });
            await this.redisClient.connect();
            this.logger.log('Redis connection established');
        }
        catch (error) {
            this.logger.error('Redis connection error', error);
        }
    }
    async onModuleDestroy() {
        if (this.redisClient) {
            await this.redisClient.quit();
        }
    }
    async get(key) {
        try {
            return await this.redisClient.get(key);
        }
        catch (error) {
            this.logger.error(`Error getting key ${key}`, error);
            throw error;
        }
    }
    async getKeys(pattern) {
        const keys = [];
        let cursor = 0;
        do {
            const scanResult = await this.redisClient.scan(cursor, { MATCH: pattern, COUNT: 1 });
            cursor = scanResult.cursor;
            keys.push(...scanResult.keys);
        } while (cursor !== 0);
        return keys;
    }
    async set(key, value, TTL) {
        try {
            const a = new Date();
            if (TTL && TTL.milliseconds) {
                await this.redisClient.set(key, value, { PX: TTL.milliseconds });
            }
            else if (TTL && TTL.datetime) {
                await this.redisClient.set(key, value, { PXAT: TTL.datetime.getTime() });
            }
            else {
                await this.redisClient.set(key, value);
            }
        }
        catch (error) {
            this.logger.error(`Error setting key ${key}`, error);
            throw error;
        }
    }
    async del(key) {
        try {
            await this.redisClient.del(key);
        }
        catch (error) {
            this.logger.error(`Error deleting key ${key}`, error);
            throw error;
        }
    }
};
exports.RedisService = RedisService;
exports.RedisService = RedisService = RedisService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(redis_config_1.RedisConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object])
], RedisService);


/***/ }),
/* 39 */
/***/ ((module) => {

module.exports = require("redis");

/***/ }),
/* 40 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheDataService = void 0;
const common_1 = __webpack_require__(3);
const setting_entity_1 = __webpack_require__(41);
const repositories_1 = __webpack_require__(42);
const organization_repository_1 = __webpack_require__(111);
const permission_repository_1 = __webpack_require__(115);
const role_repository_1 = __webpack_require__(130);
const setting_repository_1 = __webpack_require__(132);
const user_role_repository_1 = __webpack_require__(150);
const user_repository_1 = __webpack_require__(152);
const array_helper_1 = __webpack_require__(154);
let CacheDataService = class CacheDataService {
    constructor(organizationRepository, settingRepository, userRepository, roleRepository, userRoleRepository, userRoomRepository, permissionRepository, imageRepository) {
        this.organizationRepository = organizationRepository;
        this.settingRepository = settingRepository;
        this.userRepository = userRepository;
        this.roleRepository = roleRepository;
        this.userRoleRepository = userRoleRepository;
        this.userRoomRepository = userRoomRepository;
        this.permissionRepository = permissionRepository;
        this.imageRepository = imageRepository;
        this.orgCache = {};
        this.permissionAllMap = null;
    }
    async getOrganization(oid) {
        var _a, _b, _c;
        if (!oid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].organization) {
            const organization = await this.organizationRepository.findOne({
                relation: { logoImage: true },
                condition: { id: oid },
            });
            try {
                organization.dataVersionParse = JSON.parse(organization.dataVersion);
                (_a = organization.dataVersionParse).product || (_a.product = 0);
                (_b = organization.dataVersionParse).batch || (_b.batch = 0);
                (_c = organization.dataVersionParse).customer || (_c.customer = 0);
            }
            catch (error) {
                organization.dataVersionParse = { product: 0, batch: 0, customer: 0 };
            }
            this.orgCache[oid].organization = organization;
        }
        return this.orgCache[oid].organization;
    }
    async getSettingMap(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].settingMapMap) {
            this.orgCache[oid].settingMapMap = {};
            const settingList = await this.settingRepository.findManyBy({ oid });
            settingList.forEach((i) => {
                const data = i.data ? JSON.parse(i.data) : i.data;
                if (i.key === setting_entity_1.SettingKey.GOOGLE_DRIVER && (data === null || data === void 0 ? void 0 : data.refreshToken)) {
                    data.refreshToken = data.refreshToken.slice(0, 20) + '...';
                }
                this.orgCache[oid].settingMapMap[i.key] = data;
            });
        }
        return this.orgCache[oid].settingMapMap;
    }
    async getEmailGoogleDriver(oid) {
        const settingMap = await this.getSettingMap(oid);
        const { email } = (settingMap === null || settingMap === void 0 ? void 0 : settingMap[setting_entity_1.SettingKey.GOOGLE_DRIVER]) || { email: '' };
        if (!email) {
            const settingMapROOT = await this.getSettingMap(1);
            const ggROOT = (settingMapROOT === null || settingMapROOT === void 0 ? void 0 : settingMapROOT[setting_entity_1.SettingKey.GOOGLE_DRIVER]) || { email: '' };
            return ggROOT.email;
        }
        return email;
    }
    async getSettingAllowNegativeQuantity(oid) {
        const settingMap = await this.getSettingMap(oid);
        const { allowNegativeQuantity } = (settingMap === null || settingMap === void 0 ? void 0 : settingMap[setting_entity_1.SettingKey.PRODUCT_SETTING]) || {};
        return !!allowNegativeQuantity;
    }
    async getUser(oid, uid) {
        if (!oid || !uid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].userMap)
            this.orgCache[oid].userMap = {};
        if (!this.orgCache[oid].userMap[uid]) {
            const user = await this.userRepository.findOneBy({ oid, id: uid });
            const imageIdList = JSON.parse(user.imageIds);
            const imageList = await this.imageRepository.findManyByIds(imageIdList);
            const imageMap = array_helper_1.ESArray.arrayToKeyValue(imageList, 'id');
            user.imageList = imageIdList.map((imageId) => imageMap[imageId]).filter((i) => !!i);
            this.orgCache[oid].userMap[uid] = user;
        }
        return this.orgCache[oid].userMap[uid];
    }
    async getRole(oid, rid) {
        if (!oid || !rid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        if (!this.orgCache[oid].roleMap)
            this.orgCache[oid].roleMap = {};
        if (!this.orgCache[oid].roleMap[rid]) {
            this.orgCache[oid].roleMap[rid] = await this.roleRepository.findOneBy({ oid, id: rid });
        }
        return this.orgCache[oid].roleMap[rid];
    }
    async getRoleList(oid, uid) {
        if (!this.orgCache[oid].userRoleList) {
            this.orgCache[oid].userRoleList = await this.userRoleRepository.findManyBy({ oid });
        }
        const roleIdList = this.orgCache[oid].userRoleList
            .filter((i) => i.userId === uid)
            .map((i) => i.roleId);
        const result = [];
        for (let i = 0; i < roleIdList.length; i++) {
            const role = await this.getRole(oid, roleIdList[i]);
            result.push(role);
        }
        return result;
    }
    async getRoomIdList(oid, uid) {
        if (!this.orgCache[oid].userRoomList) {
            this.orgCache[oid].userRoomList = await this.userRoomRepository.findManyBy({ oid });
        }
        const roomIdList = this.orgCache[oid].userRoomList
            .filter((i) => i.userId === uid)
            .map((i) => i.roomId);
        return roomIdList;
    }
    async getPermissionIdsByUserId(oid, uid) {
        if (!oid || !uid)
            return null;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        const user = await this.getUser(oid, uid);
        const organization = await this.getOrganization(oid);
        const organizationPermissionIds = JSON.parse(organization.permissionIds);
        let permissionIds = [];
        if (user.isAdmin) {
            permissionIds = organizationPermissionIds;
        }
        else {
            const roleList = await this.getRoleList(oid, uid);
            for (let i = 0; i < roleList.length; i++) {
                const currentPermissionIds = JSON.parse(roleList[i].permissionIds || '[]');
                permissionIds = permissionIds.concat(currentPermissionIds);
            }
            permissionIds = (0, array_helper_1.uniqueArray)(permissionIds);
        }
        return permissionIds;
    }
    async getPermissionAllMap() {
        if (!this.permissionAllMap) {
            const permissionAll = await this.permissionRepository.findManyBy({});
            this.permissionAllMap = (0, array_helper_1.arrayToKeyValue)(permissionAll, 'id');
        }
        return this.permissionAllMap;
    }
    async getPermissionAllList() {
        const map = await this.getPermissionAllMap();
        return Object.values(map);
    }
    updateOrganizationInfo(organization) {
        var _a, _b, _c;
        const oid = organization.id;
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        try {
            organization.dataVersionParse = JSON.parse(organization.dataVersion);
            (_a = organization.dataVersionParse).product || (_a.product = 0);
            (_b = organization.dataVersionParse).batch || (_b.batch = 0);
            (_c = organization.dataVersionParse).customer || (_c.customer = 0);
        }
        catch (error) {
            organization.dataVersionParse = { product: 0, batch: 0, customer: 0 };
        }
        this.orgCache[oid].organization = organization;
    }
    clearUserAndRoleAndRoom(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].userMap = {};
        this.orgCache[oid].roleMap = {};
        this.orgCache[oid].userRoleList = null;
        this.orgCache[oid].userRoomList = null;
    }
    clearOrganization(oid) {
        if (oid === undefined)
            return (this.orgCache = {});
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].organization = null;
    }
    clearSettingMap(oid) {
        if (!this.orgCache[oid])
            this.orgCache[oid] = {};
        this.orgCache[oid].settingMapMap = null;
    }
    async reloadPermissionAll() {
        this.permissionAllMap = null;
        await this.getPermissionAllMap();
    }
    async reloadSettingMap(oid) {
        this.clearSettingMap(oid);
        await this.getSettingMap(oid);
    }
};
exports.CacheDataService = CacheDataService;
exports.CacheDataService = CacheDataService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _a : Object, typeof (_b = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _b : Object, typeof (_c = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _c : Object, typeof (_d = typeof role_repository_1.RoleRepository !== "undefined" && role_repository_1.RoleRepository) === "function" ? _d : Object, typeof (_e = typeof user_role_repository_1.UserRoleRepository !== "undefined" && user_role_repository_1.UserRoleRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.UserRoomRepository !== "undefined" && repositories_1.UserRoomRepository) === "function" ? _f : Object, typeof (_g = typeof permission_repository_1.PermissionRepository !== "undefined" && permission_repository_1.PermissionRepository) === "function" ? _g : Object, typeof (_h = typeof repositories_1.ImageRepository !== "undefined" && repositories_1.ImageRepository) === "function" ? _h : Object])
], CacheDataService);


/***/ }),
/* 41 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Setting_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingKey = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
var SettingKey;
(function (SettingKey) {
    SettingKey["ROOT_SETTING"] = "ROOT_SETTING";
    SettingKey["SYSTEM_SETTING"] = "SYSTEM_SETTING";
    SettingKey["GOOGLE_DRIVER"] = "GOOGLE_DRIVER";
    SettingKey["PRODUCT_SETTING"] = "PRODUCT_SETTING";
})(SettingKey || (exports.SettingKey = SettingKey = {}));
let Setting = Setting_1 = class Setting {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Setting_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Setting_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Setting.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Setting.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Setting.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Setting.prototype, "data", void 0);
Setting = Setting_1 = __decorate([
    (0, typeorm_1.Entity)('Setting'),
    (0, typeorm_1.Index)('IDX_Setting__oid_key', ['oid', 'key'], { unique: true })
], Setting);
exports["default"] = Setting;


/***/ }),
/* 42 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(43), exports);
__exportStar(__webpack_require__(99), exports);
__exportStar(__webpack_require__(100), exports);
__exportStar(__webpack_require__(101), exports);
__exportStar(__webpack_require__(102), exports);
__exportStar(__webpack_require__(103), exports);
__exportStar(__webpack_require__(104), exports);
__exportStar(__webpack_require__(105), exports);
__exportStar(__webpack_require__(106), exports);
__exportStar(__webpack_require__(107), exports);
__exportStar(__webpack_require__(108), exports);
__exportStar(__webpack_require__(109), exports);
__exportStar(__webpack_require__(110), exports);
__exportStar(__webpack_require__(111), exports);
__exportStar(__webpack_require__(112), exports);
__exportStar(__webpack_require__(113), exports);
__exportStar(__webpack_require__(114), exports);
__exportStar(__webpack_require__(115), exports);
__exportStar(__webpack_require__(116), exports);
__exportStar(__webpack_require__(117), exports);
__exportStar(__webpack_require__(118), exports);
__exportStar(__webpack_require__(119), exports);
__exportStar(__webpack_require__(120), exports);
__exportStar(__webpack_require__(121), exports);
__exportStar(__webpack_require__(122), exports);
__exportStar(__webpack_require__(123), exports);
__exportStar(__webpack_require__(124), exports);
__exportStar(__webpack_require__(125), exports);
__exportStar(__webpack_require__(126), exports);
__exportStar(__webpack_require__(127), exports);
__exportStar(__webpack_require__(128), exports);
__exportStar(__webpack_require__(129), exports);
__exportStar(__webpack_require__(130), exports);
__exportStar(__webpack_require__(131), exports);
__exportStar(__webpack_require__(132), exports);
__exportStar(__webpack_require__(133), exports);
__exportStar(__webpack_require__(134), exports);
__exportStar(__webpack_require__(135), exports);
__exportStar(__webpack_require__(136), exports);
__exportStar(__webpack_require__(137), exports);
__exportStar(__webpack_require__(138), exports);
__exportStar(__webpack_require__(139), exports);
__exportStar(__webpack_require__(140), exports);
__exportStar(__webpack_require__(141), exports);
__exportStar(__webpack_require__(142), exports);
__exportStar(__webpack_require__(143), exports);
__exportStar(__webpack_require__(144), exports);
__exportStar(__webpack_require__(145), exports);
__exportStar(__webpack_require__(146), exports);
__exportStar(__webpack_require__(147), exports);
__exportStar(__webpack_require__(148), exports);
__exportStar(__webpack_require__(150), exports);
__exportStar(__webpack_require__(151), exports);
__exportStar(__webpack_require__(152), exports);
__exportStar(__webpack_require__(153), exports);


/***/ }),
/* 43 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AddressRepository = exports.AddressManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let AddressManager = class AddressManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Address);
    }
};
exports.AddressManager = AddressManager;
exports.AddressManager = AddressManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], AddressManager);
let AddressRepository = class AddressRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, addressRepository) {
        super(entities_1.Address, addressRepository);
        this.dataSource = dataSource;
        this.addressRepository = addressRepository;
    }
};
exports.AddressRepository = AddressRepository;
exports.AddressRepository = AddressRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Address)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], AddressRepository);


/***/ }),
/* 44 */
/***/ ((module) => {

module.exports = require("@nestjs/typeorm");

/***/ }),
/* 45 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUser = exports.TicketSurcharge = exports.TicketRadiology = exports.TicketProduct = exports.TicketProcedure = exports.TicketProcedureItem = exports.TicketLaboratory = exports.TicketLaboratoryResult = exports.TicketLaboratoryGroup = exports.TicketExpense = exports.TicketBatch = exports.TicketAttribute = exports.Surcharge = exports.StockCheck = exports.StockCheckItem = exports.Setting = exports.Room = exports.Role = exports.Radiology = exports.RadiologySample = exports.RadiologyGroup = exports.PurchaseOrder = exports.PurchaseOrderItem = exports.Product = exports.ProductMovement = exports.ProductGroup = exports.Procedure = exports.ProcedureGroup = exports.PrintHtml = exports.PrintHtmlSetting = exports.PrescriptionSample = exports.Position = exports.Permission = exports.Payment = exports.PaymentTicketItem = exports.PaymentMethod = exports.Organization = exports.Laboratory = exports.LaboratorySample = exports.LaboratoryGroup = exports.Image = exports.ICD = exports.Expense = exports.Distributor = exports.Discount = exports.Customer = exports.CustomerSource = exports.Batch = exports.Appointment = exports.Address = void 0;
exports.Warehouse = exports.User = exports.UserRoom = exports.UserRole = exports.Ticket = void 0;
var address_entity_1 = __webpack_require__(46);
Object.defineProperty(exports, "Address", ({ enumerable: true, get: function () { return address_entity_1.default; } }));
var appointment_entity_1 = __webpack_require__(47);
Object.defineProperty(exports, "Appointment", ({ enumerable: true, get: function () { return appointment_entity_1.default; } }));
var batch_entity_1 = __webpack_require__(56);
Object.defineProperty(exports, "Batch", ({ enumerable: true, get: function () { return batch_entity_1.default; } }));
var customer_source_entity_1 = __webpack_require__(49);
Object.defineProperty(exports, "CustomerSource", ({ enumerable: true, get: function () { return customer_source_entity_1.default; } }));
var customer_entity_1 = __webpack_require__(50);
Object.defineProperty(exports, "Customer", ({ enumerable: true, get: function () { return customer_entity_1.default; } }));
var discount_entity_1 = __webpack_require__(77);
Object.defineProperty(exports, "Discount", ({ enumerable: true, get: function () { return discount_entity_1.default; } }));
var distributor_entity_1 = __webpack_require__(52);
Object.defineProperty(exports, "Distributor", ({ enumerable: true, get: function () { return distributor_entity_1.default; } }));
var expense_entity_1 = __webpack_require__(78);
Object.defineProperty(exports, "Expense", ({ enumerable: true, get: function () { return expense_entity_1.default; } }));
var icd_entity_1 = __webpack_require__(79);
Object.defineProperty(exports, "ICD", ({ enumerable: true, get: function () { return icd_entity_1.default; } }));
var image_entity_1 = __webpack_require__(19);
Object.defineProperty(exports, "Image", ({ enumerable: true, get: function () { return image_entity_1.default; } }));
var laboratory_group_entity_1 = __webpack_require__(63);
Object.defineProperty(exports, "LaboratoryGroup", ({ enumerable: true, get: function () { return laboratory_group_entity_1.default; } }));
var laboratory_sample_entity_1 = __webpack_require__(80);
Object.defineProperty(exports, "LaboratorySample", ({ enumerable: true, get: function () { return laboratory_sample_entity_1.default; } }));
var laboratory_entity_1 = __webpack_require__(66);
Object.defineProperty(exports, "Laboratory", ({ enumerable: true, get: function () { return laboratory_entity_1.default; } }));
var organization_entity_1 = __webpack_require__(16);
Object.defineProperty(exports, "Organization", ({ enumerable: true, get: function () { return organization_entity_1.default; } }));
var payment_method_entity_1 = __webpack_require__(53);
Object.defineProperty(exports, "PaymentMethod", ({ enumerable: true, get: function () { return payment_method_entity_1.default; } }));
var payment_ticket_item_entity_1 = __webpack_require__(81);
Object.defineProperty(exports, "PaymentTicketItem", ({ enumerable: true, get: function () { return payment_ticket_item_entity_1.default; } }));
var payment_entity_1 = __webpack_require__(51);
Object.defineProperty(exports, "Payment", ({ enumerable: true, get: function () { return payment_entity_1.default; } }));
var permission_entity_1 = __webpack_require__(82);
Object.defineProperty(exports, "Permission", ({ enumerable: true, get: function () { return permission_entity_1.default; } }));
var position_entity_1 = __webpack_require__(76);
Object.defineProperty(exports, "Position", ({ enumerable: true, get: function () { return position_entity_1.default; } }));
var prescription_sample_entity_1 = __webpack_require__(84);
Object.defineProperty(exports, "PrescriptionSample", ({ enumerable: true, get: function () { return prescription_sample_entity_1.default; } }));
var print_html_setting_entity_1 = __webpack_require__(85);
Object.defineProperty(exports, "PrintHtmlSetting", ({ enumerable: true, get: function () { return print_html_setting_entity_1.default; } }));
var print_html_entity_1 = __webpack_require__(64);
Object.defineProperty(exports, "PrintHtml", ({ enumerable: true, get: function () { return print_html_entity_1.default; } }));
var procedure_group_entity_1 = __webpack_require__(70);
Object.defineProperty(exports, "ProcedureGroup", ({ enumerable: true, get: function () { return procedure_group_entity_1.default; } }));
var procedure_entity_1 = __webpack_require__(69);
Object.defineProperty(exports, "Procedure", ({ enumerable: true, get: function () { return procedure_entity_1.default; } }));
var product_group_entity_1 = __webpack_require__(58);
Object.defineProperty(exports, "ProductGroup", ({ enumerable: true, get: function () { return product_group_entity_1.default; } }));
var product_movement_entity_1 = __webpack_require__(86);
Object.defineProperty(exports, "ProductMovement", ({ enumerable: true, get: function () { return product_movement_entity_1.default; } }));
var product_entity_1 = __webpack_require__(57);
Object.defineProperty(exports, "Product", ({ enumerable: true, get: function () { return product_entity_1.default; } }));
var purchase_order_item_entity_1 = __webpack_require__(55);
Object.defineProperty(exports, "PurchaseOrderItem", ({ enumerable: true, get: function () { return purchase_order_item_entity_1.default; } }));
var purchase_order_entity_1 = __webpack_require__(54);
Object.defineProperty(exports, "PurchaseOrder", ({ enumerable: true, get: function () { return purchase_order_entity_1.default; } }));
var radiology_group_entity_1 = __webpack_require__(74);
Object.defineProperty(exports, "RadiologyGroup", ({ enumerable: true, get: function () { return radiology_group_entity_1.default; } }));
var radiology_sample_entity_1 = __webpack_require__(89);
Object.defineProperty(exports, "RadiologySample", ({ enumerable: true, get: function () { return radiology_sample_entity_1.default; } }));
var radiology_entity_1 = __webpack_require__(73);
Object.defineProperty(exports, "Radiology", ({ enumerable: true, get: function () { return radiology_entity_1.default; } }));
var role_entity_1 = __webpack_require__(23);
Object.defineProperty(exports, "Role", ({ enumerable: true, get: function () { return role_entity_1.default; } }));
var room_entity_1 = __webpack_require__(25);
Object.defineProperty(exports, "Room", ({ enumerable: true, get: function () { return room_entity_1.default; } }));
var setting_entity_1 = __webpack_require__(41);
Object.defineProperty(exports, "Setting", ({ enumerable: true, get: function () { return setting_entity_1.default; } }));
var stock_check_item_entity_1 = __webpack_require__(88);
Object.defineProperty(exports, "StockCheckItem", ({ enumerable: true, get: function () { return stock_check_item_entity_1.default; } }));
var stock_check_entity_1 = __webpack_require__(87);
Object.defineProperty(exports, "StockCheck", ({ enumerable: true, get: function () { return stock_check_entity_1.default; } }));
var surcharge_entity_1 = __webpack_require__(90);
Object.defineProperty(exports, "Surcharge", ({ enumerable: true, get: function () { return surcharge_entity_1.default; } }));
var ticket_attribute_entity_1 = __webpack_require__(60);
Object.defineProperty(exports, "TicketAttribute", ({ enumerable: true, get: function () { return ticket_attribute_entity_1.default; } }));
var ticket_batch_entity_1 = __webpack_require__(61);
Object.defineProperty(exports, "TicketBatch", ({ enumerable: true, get: function () { return ticket_batch_entity_1.default; } }));
var ticket_expense_entity_1 = __webpack_require__(91);
Object.defineProperty(exports, "TicketExpense", ({ enumerable: true, get: function () { return ticket_expense_entity_1.default; } }));
var ticket_laboratory_group_entity_1 = __webpack_require__(62);
Object.defineProperty(exports, "TicketLaboratoryGroup", ({ enumerable: true, get: function () { return ticket_laboratory_group_entity_1.default; } }));
var ticket_laboratory_result_entity_1 = __webpack_require__(65);
Object.defineProperty(exports, "TicketLaboratoryResult", ({ enumerable: true, get: function () { return ticket_laboratory_result_entity_1.default; } }));
var ticket_laboratory_entity_1 = __webpack_require__(67);
Object.defineProperty(exports, "TicketLaboratory", ({ enumerable: true, get: function () { return ticket_laboratory_entity_1.default; } }));
var ticket_procedure_item_entity_1 = __webpack_require__(92);
Object.defineProperty(exports, "TicketProcedureItem", ({ enumerable: true, get: function () { return ticket_procedure_item_entity_1.default; } }));
var ticket_procedure_entity_1 = __webpack_require__(68);
Object.defineProperty(exports, "TicketProcedure", ({ enumerable: true, get: function () { return ticket_procedure_entity_1.default; } }));
var ticket_product_entity_1 = __webpack_require__(71);
Object.defineProperty(exports, "TicketProduct", ({ enumerable: true, get: function () { return ticket_product_entity_1.default; } }));
var ticket_radiology_entity_1 = __webpack_require__(72);
Object.defineProperty(exports, "TicketRadiology", ({ enumerable: true, get: function () { return ticket_radiology_entity_1.default; } }));
var ticket_surcharge_entity_1 = __webpack_require__(93);
Object.defineProperty(exports, "TicketSurcharge", ({ enumerable: true, get: function () { return ticket_surcharge_entity_1.default; } }));
var ticket_user_entity_1 = __webpack_require__(75);
Object.defineProperty(exports, "TicketUser", ({ enumerable: true, get: function () { return ticket_user_entity_1.default; } }));
var ticket_entity_1 = __webpack_require__(59);
Object.defineProperty(exports, "Ticket", ({ enumerable: true, get: function () { return ticket_entity_1.default; } }));
var user_role_entity_1 = __webpack_require__(22);
Object.defineProperty(exports, "UserRole", ({ enumerable: true, get: function () { return user_role_entity_1.default; } }));
var user_room_entity_1 = __webpack_require__(24);
Object.defineProperty(exports, "UserRoom", ({ enumerable: true, get: function () { return user_room_entity_1.default; } }));
var user_entity_1 = __webpack_require__(20);
Object.defineProperty(exports, "User", ({ enumerable: true, get: function () { return user_entity_1.default; } }));
var warehouse_entity_1 = __webpack_require__(94);
Object.defineProperty(exports, "Warehouse", ({ enumerable: true, get: function () { return warehouse_entity_1.default; } }));


/***/ }),
/* 46 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Address_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let Address = Address_1 = class Address {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Address_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Address_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Address.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ length: 100, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Address.prototype, "province", void 0);
__decorate([
    (0, typeorm_1.Column)({ length: 100, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Address.prototype, "ward", void 0);
Address = Address_1 = __decorate([
    (0, typeorm_1.Entity)('Address')
], Address);
exports["default"] = Address;


/***/ }),
/* 47 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Appointment_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const customer_source_entity_1 = __webpack_require__(49);
const customer_entity_1 = __webpack_require__(50);
var AppointmentStatus;
(function (AppointmentStatus) {
    AppointmentStatus[AppointmentStatus["Waiting"] = 1] = "Waiting";
    AppointmentStatus[AppointmentStatus["Confirm"] = 2] = "Confirm";
    AppointmentStatus[AppointmentStatus["Completed"] = 3] = "Completed";
    AppointmentStatus[AppointmentStatus["Cancelled"] = 4] = "Cancelled";
})(AppointmentStatus || (exports.AppointmentStatus = AppointmentStatus = {}));
let Appointment = Appointment_1 = class Appointment extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Appointment_1();
        Object.assign(entity, raw);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Appointment_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Appointment.prototype, "reason", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "fromTicketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "toTicketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Appointment.prototype, "cancelReason", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: AppointmentStatus.Waiting }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Appointment.prototype, "appointmentStatus", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _a : Object)
], Appointment.prototype, "customer", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_source_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerSourceId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof customer_source_entity_1.default !== "undefined" && customer_source_entity_1.default) === "function" ? _b : Object)
], Appointment.prototype, "customerSource", void 0);
Appointment = Appointment_1 = __decorate([
    (0, typeorm_1.Entity)('Appointment'),
    (0, typeorm_1.Index)('IDX_Appointment__fromTicketId', ['fromTicketId'])
], Appointment);
exports["default"] = Appointment;


/***/ }),
/* 48 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BaseEntity = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
class BaseEntity {
}
exports.BaseEntity = BaseEntity;
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], BaseEntity.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], BaseEntity.prototype, "id", void 0);


/***/ }),
/* 49 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var CustomerSource_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let CustomerSource = CustomerSource_1 = class CustomerSource {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new CustomerSource_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => CustomerSource_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], CustomerSource.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], CustomerSource.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], CustomerSource.prototype, "name", void 0);
CustomerSource = CustomerSource_1 = __decorate([
    (0, typeorm_1.Entity)('CustomerSource')
], CustomerSource);
exports["default"] = CustomerSource;


/***/ }),
/* 50 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Customer_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(51);
let Customer = Customer_1 = class Customer extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Customer_1();
        Object.assign(entity, raw);
        entity.birthday = raw.birthday == null ? raw.birthday : Number(raw.birthday);
        entity.debt = Number(raw.debt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Customer_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "customerCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "fullName", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Customer.prototype, "facebook", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], Customer.prototype, "zalo", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "birthday", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "yearOfBirth", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], Customer.prototype, "gender", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressProvince", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressWard", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "relative", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "healthHistory", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Customer.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Customer.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.customer),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Customer.prototype, "paymentList", void 0);
Customer = Customer_1 = __decorate([
    (0, typeorm_1.Entity)('Customer'),
    (0, typeorm_1.Unique)('UNIQUE_Customer__oid_customerCode', ['oid', 'customerCode'])
], Customer);
exports["default"] = Customer;


/***/ }),
/* 51 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Payment_1;
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.MoneyDirection = exports.PaymentActionType = exports.PaymentVoucherType = exports.PaymentPersonType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const customer_entity_1 = __webpack_require__(50);
const distributor_entity_1 = __webpack_require__(52);
const payment_method_entity_1 = __webpack_require__(53);
const purchase_order_entity_1 = __webpack_require__(54);
const ticket_entity_1 = __webpack_require__(59);
const user_entity_1 = __webpack_require__(20);
var PaymentPersonType;
(function (PaymentPersonType) {
    PaymentPersonType[PaymentPersonType["Other"] = 0] = "Other";
    PaymentPersonType[PaymentPersonType["Distributor"] = 1] = "Distributor";
    PaymentPersonType[PaymentPersonType["Customer"] = 2] = "Customer";
    PaymentPersonType[PaymentPersonType["Employee"] = 3] = "Employee";
})(PaymentPersonType || (exports.PaymentPersonType = PaymentPersonType = {}));
var PaymentVoucherType;
(function (PaymentVoucherType) {
    PaymentVoucherType[PaymentVoucherType["Other"] = 0] = "Other";
    PaymentVoucherType[PaymentVoucherType["PurchaseOrder"] = 1] = "PurchaseOrder";
    PaymentVoucherType[PaymentVoucherType["Ticket"] = 2] = "Ticket";
})(PaymentVoucherType || (exports.PaymentVoucherType = PaymentVoucherType = {}));
var PaymentActionType;
(function (PaymentActionType) {
    PaymentActionType[PaymentActionType["Other"] = 0] = "Other";
    PaymentActionType[PaymentActionType["PrepaymentMoney"] = 1] = "PrepaymentMoney";
    PaymentActionType[PaymentActionType["RefundMoney"] = 2] = "RefundMoney";
    PaymentActionType[PaymentActionType["PayDebt"] = 3] = "PayDebt";
    PaymentActionType[PaymentActionType["Close"] = 4] = "Close";
    PaymentActionType[PaymentActionType["Reopen"] = 5] = "Reopen";
    PaymentActionType[PaymentActionType["PrepaymentForTicketItemList"] = 6] = "PrepaymentForTicketItemList";
    PaymentActionType[PaymentActionType["RefundForTicketItemList"] = 7] = "RefundForTicketItemList";
    PaymentActionType[PaymentActionType["FixByExcel"] = 8] = "FixByExcel";
})(PaymentActionType || (exports.PaymentActionType = PaymentActionType = {}));
var MoneyDirection;
(function (MoneyDirection) {
    MoneyDirection[MoneyDirection["Other"] = 0] = "Other";
    MoneyDirection[MoneyDirection["In"] = 1] = "In";
    MoneyDirection[MoneyDirection["Out"] = 2] = "Out";
})(MoneyDirection || (exports.MoneyDirection = MoneyDirection = {}));
let Payment = Payment_1 = class Payment {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Payment_1();
        Object.assign(entity, raw);
        entity.createdAt = Number(raw.createdAt);
        entity.paidAmount = Number(raw.paidAmount);
        entity.debtAmount = Number(raw.debtAmount);
        entity.openDebt = Number(raw.openDebt);
        entity.closeDebt = Number(raw.closeDebt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Payment_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Payment.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: PaymentVoucherType.Other }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "voucherType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "voucherId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: PaymentPersonType.Other }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "personType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "personId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paymentMethodId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "moneyDirection", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paymentActionType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "cashierId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Payment.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "paidAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "debtAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "openDebt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Payment.prototype, "closeDebt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], Payment.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof purchase_order_entity_1.default !== "undefined" && purchase_order_entity_1.default) === "function" ? _b : Object)
], Payment.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], Payment.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _d : Object)
], Payment.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _e : Object)
], Payment.prototype, "employee", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_f = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _f : Object)
], Payment.prototype, "cashier", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Payment.prototype, "paymentTicketItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => payment_method_entity_1.default, (paymentMethod) => paymentMethod.paymentList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'paymentMethodId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof payment_method_entity_1.default !== "undefined" && payment_method_entity_1.default) === "function" ? _g : Object)
], Payment.prototype, "paymentMethod", void 0);
Payment = Payment_1 = __decorate([
    (0, typeorm_1.Entity)('Payment'),
    (0, typeorm_1.Index)('IDX_Payment__oid_createdAt', ['oid', 'createdAt']),
    (0, typeorm_1.Index)('IDX_Payment__oid_personId', ['oid', 'personId']),
    (0, typeorm_1.Index)('IDX_Payment__oid_moneyDirection', ['oid', 'moneyDirection']),
    (0, typeorm_1.Index)('IDX_Payment__oid_paymentMethodId', ['oid', 'paymentMethodId'])
], Payment);
exports["default"] = Payment;


/***/ }),
/* 52 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Distributor_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const payment_entity_1 = __webpack_require__(51);
let Distributor = Distributor_1 = class Distributor extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Distributor_1();
        Object.assign(entity, raw);
        entity.debt = Number(raw.debt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Distributor_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "fullName", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'char', length: 10, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "phone", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressProvince", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressWard", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "addressStreet", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Distributor.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Distributor.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.distributor),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Distributor.prototype, "paymentList", void 0);
Distributor = Distributor_1 = __decorate([
    (0, typeorm_1.Entity)('Distributor')
], Distributor);
exports["default"] = Distributor;


/***/ }),
/* 53 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PaymentMethod_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
let PaymentMethod = PaymentMethod_1 = class PaymentMethod {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PaymentMethod_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PaymentMethod_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PaymentMethod.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PaymentMethod.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentMethod.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.paymentMethod),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], PaymentMethod.prototype, "paymentList", void 0);
PaymentMethod = PaymentMethod_1 = __decorate([
    (0, typeorm_1.Entity)('PaymentMethod'),
    (0, typeorm_1.Unique)('UNIQUE_PaymentMethod__oid_code', ['oid', 'code'])
], PaymentMethod);
exports["default"] = PaymentMethod;


/***/ }),
/* 54 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PurchaseOrder_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const distributor_entity_1 = __webpack_require__(52);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_item_entity_1 = __webpack_require__(55);
var PurchaseOrderStatus;
(function (PurchaseOrderStatus) {
    PurchaseOrderStatus[PurchaseOrderStatus["Schedule"] = 1] = "Schedule";
    PurchaseOrderStatus[PurchaseOrderStatus["Draft"] = 2] = "Draft";
    PurchaseOrderStatus[PurchaseOrderStatus["Deposited"] = 3] = "Deposited";
    PurchaseOrderStatus[PurchaseOrderStatus["Executing"] = 4] = "Executing";
    PurchaseOrderStatus[PurchaseOrderStatus["Debt"] = 5] = "Debt";
    PurchaseOrderStatus[PurchaseOrderStatus["Completed"] = 6] = "Completed";
    PurchaseOrderStatus[PurchaseOrderStatus["Cancelled"] = 7] = "Cancelled";
})(PurchaseOrderStatus || (exports.PurchaseOrderStatus = PurchaseOrderStatus = {}));
let PurchaseOrder = PurchaseOrder_1 = class PurchaseOrder extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PurchaseOrder_1();
        Object.assign(entity, raw);
        entity.itemsActualMoney = Number(raw.itemsActualMoney);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.surcharge = Number(raw.surcharge);
        entity.totalMoney = Number(raw.totalMoney);
        entity.paid = Number(raw.paid);
        entity.debt = Number(raw.debt);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        entity.endedAt = raw.endedAt == null ? raw.endedAt : Number(raw.endedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PurchaseOrder_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], PurchaseOrder.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "year", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "month", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "date", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], PurchaseOrder.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'surcharge',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "surcharge", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "totalMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'paid',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "paid", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'debt',
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PurchaseOrder.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrder.prototype, "endedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => purchase_order_item_entity_1.default, (purchaseOrderItem) => purchaseOrderItem.purchaseOrder),
    __metadata("design:type", Array)
], PurchaseOrder.prototype, "purchaseOrderItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => distributor_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'distributorId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _c : Object)
], PurchaseOrder.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => payment_entity_1.default, (payment) => payment.purchaseOrder),
    __metadata("design:type", Array)
], PurchaseOrder.prototype, "paymentList", void 0);
PurchaseOrder = PurchaseOrder_1 = __decorate([
    (0, typeorm_1.Entity)('PurchaseOrder'),
    (0, typeorm_1.Index)('IDX_PurchaseOrder__oid_distributorId', ['oid', 'distributorId']),
    (0, typeorm_1.Index)('IDX_PurchaseOrder__oid_startedAt', ['oid', 'startedAt'])
], PurchaseOrder);
exports["default"] = PurchaseOrder;


/***/ }),
/* 55 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PurchaseOrderItem_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const batch_entity_1 = __webpack_require__(56);
const product_entity_1 = __webpack_require__(57);
const purchase_order_entity_1 = __webpack_require__(54);
let PurchaseOrderItem = PurchaseOrderItem_1 = class PurchaseOrderItem extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PurchaseOrderItem_1();
        Object.assign(entity, raw);
        entity.expiryDate = raw.expiryDate == null ? raw.expiryDate : Number(raw.expiryDate);
        entity.costPrice = Number(raw.costPrice);
        entity.quantity = Number(raw.quantity);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PurchaseOrderItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "purchaseOrderId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PurchaseOrderItem.prototype, "lotNumber", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "expiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "listPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PurchaseOrderItem.prototype, "unitRate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => purchase_order_entity_1.default, (purchaseOrder) => purchaseOrder.purchaseOrderItemList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'purchaseOrderId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof purchase_order_entity_1.default !== "undefined" && purchase_order_entity_1.default) === "function" ? _a : Object)
], PurchaseOrderItem.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _b : Object)
], PurchaseOrderItem.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _c : Object)
], PurchaseOrderItem.prototype, "product", void 0);
PurchaseOrderItem = PurchaseOrderItem_1 = __decorate([
    (0, typeorm_1.Entity)('PurchaseOrderItem'),
    (0, typeorm_1.Index)('IDX_PurchaseOrderItem__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_PurchaseOrderItem__oid_purchaseOrderId', ['oid', 'purchaseOrderId'])
], PurchaseOrderItem);
exports["default"] = PurchaseOrderItem;


/***/ }),
/* 56 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Batch_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const product_entity_1 = __webpack_require__(57);
let Batch = Batch_1 = class Batch {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Batch_1();
        Object.assign(entity, raw);
        entity.expiryDate = raw.expiryDate == null ? raw.expiryDate : Number(raw.expiryDate);
        entity.quantity = Number(raw.quantity);
        entity.costPrice = Number(raw.costPrice);
        entity.costAmount = Number(raw.costAmount);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Batch_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Batch.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Batch.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "distributorId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Batch.prototype, "lotNumber", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "expiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Batch.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, (product) => product.batchList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _a : Object)
], Batch.prototype, "product", void 0);
Batch = Batch_1 = __decorate([
    (0, typeorm_1.Entity)('Batch'),
    (0, typeorm_1.Index)('IDX_Batch__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_Batch__oid_updatedAt', ['oid', 'updatedAt'])
], Batch);
exports["default"] = Batch;


/***/ }),
/* 57 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Product_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SplitBatchByCostPrice = exports.SplitBatchByExpiryDate = exports.SplitBatchByDistributor = exports.SplitBatchByWarehouse = exports.ProductType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const batch_entity_1 = __webpack_require__(56);
const product_group_entity_1 = __webpack_require__(58);
var ProductType;
(function (ProductType) {
    ProductType[ProductType["Basic"] = 1] = "Basic";
    ProductType[ProductType["SplitBatch"] = 2] = "SplitBatch";
})(ProductType || (exports.ProductType = ProductType = {}));
var SplitBatchByWarehouse;
(function (SplitBatchByWarehouse) {
    SplitBatchByWarehouse[SplitBatchByWarehouse["Inherit"] = 0] = "Inherit";
    SplitBatchByWarehouse[SplitBatchByWarehouse["Override"] = 1] = "Override";
    SplitBatchByWarehouse[SplitBatchByWarehouse["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByWarehouse || (exports.SplitBatchByWarehouse = SplitBatchByWarehouse = {}));
var SplitBatchByDistributor;
(function (SplitBatchByDistributor) {
    SplitBatchByDistributor[SplitBatchByDistributor["Inherit"] = 0] = "Inherit";
    SplitBatchByDistributor[SplitBatchByDistributor["Override"] = 1] = "Override";
    SplitBatchByDistributor[SplitBatchByDistributor["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByDistributor || (exports.SplitBatchByDistributor = SplitBatchByDistributor = {}));
var SplitBatchByExpiryDate;
(function (SplitBatchByExpiryDate) {
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["Inherit"] = 0] = "Inherit";
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["Override"] = 1] = "Override";
    SplitBatchByExpiryDate[SplitBatchByExpiryDate["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByExpiryDate || (exports.SplitBatchByExpiryDate = SplitBatchByExpiryDate = {}));
var SplitBatchByCostPrice;
(function (SplitBatchByCostPrice) {
    SplitBatchByCostPrice[SplitBatchByCostPrice["Inherit"] = 0] = "Inherit";
    SplitBatchByCostPrice[SplitBatchByCostPrice["OverrideAndMAC"] = 1] = "OverrideAndMAC";
    SplitBatchByCostPrice[SplitBatchByCostPrice["SplitOnDifferent"] = 2] = "SplitOnDifferent";
})(SplitBatchByCostPrice || (exports.SplitBatchByCostPrice = SplitBatchByCostPrice = {}));
let Product = Product_1 = class Product {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Product_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costPrice = Number(raw.costPrice);
        entity.wholesalePrice = Number(raw.wholesalePrice);
        entity.retailPrice = Number(raw.retailPrice);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Product_1.fromRaw(i));
    }
    static getProductSettingRule(product, productSettingCommon, productSettingRoot) {
        const splitRule = {
            allowNegativeQuantity: false,
            splitBatchByWarehouse: product.splitBatchByWarehouse,
            splitBatchByDistributor: product.splitBatchByDistributor,
            splitBatchByExpiryDate: product.splitBatchByExpiryDate,
            splitBatchByCostPrice: product.splitBatchByCostPrice,
        };
        if (splitRule.splitBatchByWarehouse == null
            || splitRule.splitBatchByWarehouse === SplitBatchByWarehouse.Inherit) {
            splitRule.splitBatchByWarehouse = productSettingCommon.splitBatchByWarehouse;
            if (splitRule.splitBatchByWarehouse == null
                || splitRule.splitBatchByWarehouse === SplitBatchByWarehouse.Inherit) {
                splitRule.splitBatchByWarehouse = productSettingRoot.splitBatchByWarehouse;
            }
        }
        if (splitRule.splitBatchByDistributor == null
            || splitRule.splitBatchByDistributor === SplitBatchByDistributor.Inherit) {
            splitRule.splitBatchByDistributor = productSettingCommon.splitBatchByDistributor;
            if (splitRule.splitBatchByDistributor == null
                || splitRule.splitBatchByDistributor === SplitBatchByDistributor.Inherit) {
                splitRule.splitBatchByDistributor = productSettingRoot.splitBatchByDistributor;
            }
        }
        if (splitRule.splitBatchByExpiryDate == null
            || splitRule.splitBatchByExpiryDate === SplitBatchByExpiryDate.Inherit) {
            splitRule.splitBatchByExpiryDate = productSettingCommon.splitBatchByExpiryDate;
            if (splitRule.splitBatchByExpiryDate == null
                || splitRule.splitBatchByExpiryDate === SplitBatchByExpiryDate.Inherit) {
                splitRule.splitBatchByExpiryDate = productSettingRoot.splitBatchByExpiryDate;
            }
        }
        if (splitRule.splitBatchByCostPrice == null
            || splitRule.splitBatchByCostPrice === SplitBatchByCostPrice.Inherit) {
            splitRule.splitBatchByCostPrice = productSettingCommon.splitBatchByCostPrice;
            if (splitRule.splitBatchByCostPrice == null
                || splitRule.splitBatchByCostPrice === SplitBatchByCostPrice.Inherit) {
                splitRule.splitBatchByCostPrice = productSettingRoot.splitBatchByCostPrice;
            }
        }
        return splitRule;
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Product.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Product.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "productCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "brandName", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: ProductType.Basic, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "productType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "substance", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByWarehouse.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByWarehouse", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByDistributor.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByDistributor", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByExpiryDate.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByExpiryDate", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: SplitBatchByCostPrice.Inherit, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "splitBatchByCostPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "wholesalePrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "retailPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Product.prototype, "productGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "unit", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "route", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "source", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "image", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "hintUsage", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([0]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Product.prototype, "warehouseIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "warehouseIdList", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Product.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => product_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof product_group_entity_1.default !== "undefined" && product_group_entity_1.default) === "function" ? _a : Object)
], Product.prototype, "productGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => batch_entity_1.default, (batch) => batch.product),
    __metadata("design:type", Array)
], Product.prototype, "batchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "discountList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Product.prototype, "discountListExtra", void 0);
Product = Product_1 = __decorate([
    (0, typeorm_1.Entity)('Product'),
    (0, typeorm_1.Index)('IDX_Product__oid_brandName', ['oid', 'brandName']),
    (0, typeorm_1.Index)('IDX_Product__oid_substance', ['oid', 'substance']),
    (0, typeorm_1.Unique)('UNIQUE_Product__oid_productCode', ['oid', 'productCode'])
], Product);
exports["default"] = Product;


/***/ }),
/* 58 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProductGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let ProductGroup = ProductGroup_1 = class ProductGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProductGroup_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProductGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], ProductGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], ProductGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], ProductGroup.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], ProductGroup.prototype, "updatedAt", void 0);
ProductGroup = ProductGroup_1 = __decorate([
    (0, typeorm_1.Entity)('ProductGroup')
], ProductGroup);
exports["default"] = ProductGroup;


/***/ }),
/* 59 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Ticket_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketStatusText = exports.TicketStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const appointment_entity_1 = __webpack_require__(47);
const customer_source_entity_1 = __webpack_require__(49);
const customer_entity_1 = __webpack_require__(50);
const ticket_attribute_entity_1 = __webpack_require__(60);
const ticket_batch_entity_1 = __webpack_require__(61);
const ticket_laboratory_group_entity_1 = __webpack_require__(62);
const ticket_laboratory_result_entity_1 = __webpack_require__(65);
const ticket_laboratory_entity_1 = __webpack_require__(67);
const ticket_procedure_entity_1 = __webpack_require__(68);
const ticket_product_entity_1 = __webpack_require__(71);
const ticket_radiology_entity_1 = __webpack_require__(72);
const ticket_user_entity_1 = __webpack_require__(75);
var TicketStatus;
(function (TicketStatus) {
    TicketStatus[TicketStatus["Schedule"] = 1] = "Schedule";
    TicketStatus[TicketStatus["Draft"] = 2] = "Draft";
    TicketStatus[TicketStatus["Deposited"] = 3] = "Deposited";
    TicketStatus[TicketStatus["Executing"] = 4] = "Executing";
    TicketStatus[TicketStatus["Debt"] = 5] = "Debt";
    TicketStatus[TicketStatus["Completed"] = 6] = "Completed";
    TicketStatus[TicketStatus["Cancelled"] = 7] = "Cancelled";
})(TicketStatus || (exports.TicketStatus = TicketStatus = {}));
exports.TicketStatusText = {
    [TicketStatus.Schedule]: 'Hẹn trước',
    [TicketStatus.Draft]: 'Nháp',
    [TicketStatus.Deposited]: 'Đặt chỗ',
    [TicketStatus.Executing]: 'Đang xử lý',
    [TicketStatus.Debt]: 'Đang nợ',
    [TicketStatus.Completed]: 'Hoàn thành',
    [TicketStatus.Cancelled]: 'Đã hủy',
};
let Ticket = Ticket_1 = class Ticket {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Ticket_1();
        Object.assign(entity, raw);
        entity.itemsCostAmount = Number(raw.itemsCostAmount);
        entity.procedureMoney = Number(raw.procedureMoney);
        entity.productMoney = Number(raw.productMoney);
        entity.radiologyMoney = Number(raw.radiologyMoney);
        entity.laboratoryMoney = Number(raw.laboratoryMoney);
        entity.itemsActualMoney = Number(raw.itemsActualMoney);
        entity.itemsDiscount = Number(raw.itemsDiscount);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.totalMoney = Number(raw.totalMoney);
        entity.profit = Number(raw.profit);
        entity.paid = Number(raw.paid);
        entity.debt = Number(raw.debt);
        entity.surcharge = Number(raw.surcharge);
        entity.expense = Number(raw.expense);
        entity.commissionMoney = Number(raw.commissionMoney);
        entity.registeredAt = raw.registeredAt == null ? raw.registeredAt : Number(raw.registeredAt);
        entity.startedAt = raw.startedAt == null ? raw.startedAt : Number(raw.startedAt);
        entity.endedAt = raw.endedAt == null ? raw.endedAt : Number(raw.endedAt);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Ticket_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Ticket.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Ticket.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "customerSourceId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "roomId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketStatus.Draft }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.NoStock }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], Ticket.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "year", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "month", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "date", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "dailyIndex", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "procedureMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "productMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "radiologyMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "laboratoryMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsDiscount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], Ticket.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "surcharge", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "totalMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "expense", void 0);
__decorate([
    (0, typeorm_1.Column)({
        default: 0,
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "commissionMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "profit", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "paid", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "debt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Ticket.prototype, "imageIds", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "registeredAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "startedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "endedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Ticket.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Ticket.prototype, "note", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_source_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerSourceId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof customer_source_entity_1.default !== "undefined" && customer_source_entity_1.default) === "function" ? _c : Object)
], Ticket.prototype, "customerSource", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _d : Object)
], Ticket.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof appointment_entity_1.default !== "undefined" && appointment_entity_1.default) === "function" ? _e : Object)
], Ticket.prototype, "toAppointment", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_attribute_entity_1.default, (ticketAttribute) => ticketAttribute.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProduct) => ticketProduct.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProductConsumable) => ticketProductConsumable.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductConsumableList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_product_entity_1.default, (ticketProductPrescription) => ticketProductPrescription.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_batch_entity_1.default, (ticketBatch) => ticketBatch.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketBatchList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_procedure_entity_1.default, (ticketProcedure) => ticketProcedure.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_entity_1.default, (ticketLaboratory) => ticketLaboratory.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_group_entity_1.default, (ticketLaboratoryGroup) => ticketLaboratoryGroup.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryGroupList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_laboratory_result_entity_1.default, (ticketLaboratoryResult) => ticketLaboratoryResult.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketLaboratoryResultList", void 0);
__decorate([
    (0, typeorm_1.OneToMany)(() => ticket_radiology_entity_1.default, (ticketRadiology) => ticketRadiology.ticket),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketRadiologyList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketExpenseList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketSurchargeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => ticket_user_entity_1.default, (ticketUser) => ticketUser.ticket),
    __metadata("design:type", Array)
], Ticket.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Ticket.prototype, "imageList", void 0);
Ticket = Ticket_1 = __decorate([
    (0, typeorm_1.Entity)('Ticket'),
    (0, typeorm_1.Index)('IDX_Ticket__oid_registeredAt', ['oid', 'registeredAt']),
    (0, typeorm_1.Index)('IDX_Ticket__oid_roomId', ['oid', 'roomId']),
    (0, typeorm_1.Index)('IDX_Ticket__oid_customerId', ['oid', 'customerId']),
    (0, typeorm_1.Index)('IDX_Ticket__oid_status', ['oid', 'status'])
], Ticket);
exports["default"] = Ticket;


/***/ }),
/* 60 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketAttribute_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(59);
let TicketAttribute = TicketAttribute_1 = class TicketAttribute {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketAttribute_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketAttribute_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", Number)
], TicketAttribute.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: false, type: 'varchar', length: 100 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketAttribute.prototype, "key", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketAttribute.prototype, "value", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketAttributeList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketAttribute.prototype, "ticket", void 0);
TicketAttribute = TicketAttribute_1 = __decorate([
    (0, typeorm_1.Entity)('TicketAttribute'),
    (0, typeorm_1.Index)('IDX_TicketAttribute__oid_ticketId', ['oid', 'ticketId'])
], TicketAttribute);
exports["default"] = TicketAttribute;


/***/ }),
/* 61 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketBatch_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const batch_entity_1 = __webpack_require__(56);
const customer_entity_1 = __webpack_require__(50);
const product_entity_1 = __webpack_require__(57);
const ticket_entity_1 = __webpack_require__(59);
let TicketBatch = TicketBatch_1 = class TicketBatch extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketBatch_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costAmount = Number(raw.costAmount);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.actualPrice = Number(raw.actualPrice);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketBatch_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketBatch.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "ticketProductId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _a : Object)
], TicketBatch.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "unitRate", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketBatch.prototype, "actualPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProductList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _b : Object)
], TicketBatch.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _c : Object)
], TicketBatch.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _d : Object)
], TicketBatch.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _e : Object)
], TicketBatch.prototype, "batch", void 0);
TicketBatch = TicketBatch_1 = __decorate([
    (0, typeorm_1.Entity)('TicketBatch'),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_productId', ['oid', 'productId']),
    (0, typeorm_1.Index)('IDX_TicketBatch__oid_customerId', ['oid', 'customerId'])
], TicketBatch);
exports["default"] = TicketBatch;


/***/ }),
/* 62 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratoryGroup_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(50);
const laboratory_group_entity_1 = __webpack_require__(63);
const ticket_entity_1 = __webpack_require__(59);
let TicketLaboratoryGroup = TicketLaboratoryGroup_1 = class TicketLaboratoryGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratoryGroup_1();
        Object.assign(entity, raw);
        entity.createdAt = Number(raw.createdAt);
        entity.completedAt = raw.completedAt == null ? raw.completedAt : Number(raw.completedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratoryGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "roomId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketLaboratoryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.TicketLaboratoryStatus !== "undefined" && variable_1.TicketLaboratoryStatus) === "function" ? _a : Object)
], TicketLaboratoryGroup.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketLaboratoryGroup.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroup.prototype, "completedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketLaboratoryGroup.prototype, "result", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], TicketLaboratoryGroup.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _d : Object)
], TicketLaboratoryGroup.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryGroupId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof laboratory_group_entity_1.default !== "undefined" && laboratory_group_entity_1.default) === "function" ? _e : Object)
], TicketLaboratoryGroup.prototype, "laboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketLaboratoryGroup.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketLaboratoryGroup.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_f = typeof Record !== "undefined" && Record) === "function" ? _f : Object)
], TicketLaboratoryGroup.prototype, "ticketLaboratoryResultMap", void 0);
TicketLaboratoryGroup = TicketLaboratoryGroup_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratoryGroup'),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryGroup__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryGroup__oid_createdAt', ['oid', 'createdAt'])
], TicketLaboratoryGroup);
exports["default"] = TicketLaboratoryGroup;


/***/ }),
/* 63 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var LaboratoryGroup_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const print_html_entity_1 = __webpack_require__(64);
let LaboratoryGroup = LaboratoryGroup_1 = class LaboratoryGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new LaboratoryGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => LaboratoryGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], LaboratoryGroup.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], LaboratoryGroup.prototype, "printHtmlId", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => print_html_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'printHtmlId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof print_html_entity_1.default !== "undefined" && print_html_entity_1.default) === "function" ? _a : Object)
], LaboratoryGroup.prototype, "printHtml", void 0);
LaboratoryGroup = LaboratoryGroup_1 = __decorate([
    (0, typeorm_1.Entity)('LaboratoryGroup')
], LaboratoryGroup);
exports["default"] = LaboratoryGroup;


/***/ }),
/* 64 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PrintHtml_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let PrintHtml = PrintHtml_1 = class PrintHtml {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PrintHtml_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PrintHtml_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], PrintHtml.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], PrintHtml.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], PrintHtml.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], PrintHtml.prototype, "printHtmlType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "initVariable", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "dataExample", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "html", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], PrintHtml.prototype, "css", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], PrintHtml.prototype, "updatedAt", void 0);
PrintHtml = PrintHtml_1 = __decorate([
    (0, typeorm_1.Entity)('PrintHtml')
], PrintHtml);
exports["default"] = PrintHtml;


/***/ }),
/* 65 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratoryResult_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const customer_entity_1 = __webpack_require__(50);
const laboratory_entity_1 = __webpack_require__(66);
const ticket_entity_1 = __webpack_require__(59);
let TicketLaboratoryResult = TicketLaboratoryResult_1 = class TicketLaboratoryResult extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratoryResult_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratoryResult_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "laboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketLaboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "ticketLaboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketLaboratoryResult.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", Number)
], TicketLaboratoryResult.prototype, "attention", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _a : Object)
], TicketLaboratoryResult.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _b : Object)
], TicketLaboratoryResult.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _c : Object)
], TicketLaboratoryResult.prototype, "laboratory", void 0);
TicketLaboratoryResult = TicketLaboratoryResult_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratoryResult'),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryResult__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratoryResult__oid_laboratoryId', ['oid', 'laboratoryId'])
], TicketLaboratoryResult);
exports["default"] = TicketLaboratoryResult;


/***/ }),
/* 66 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Laboratory_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryValueType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const laboratory_group_entity_1 = __webpack_require__(63);
const ticket_laboratory_entity_1 = __webpack_require__(67);
var LaboratoryValueType;
(function (LaboratoryValueType) {
    LaboratoryValueType[LaboratoryValueType["Number"] = 1] = "Number";
    LaboratoryValueType[LaboratoryValueType["String"] = 2] = "String";
    LaboratoryValueType[LaboratoryValueType["Options"] = 3] = "Options";
    LaboratoryValueType[LaboratoryValueType["Children"] = 4] = "Children";
})(LaboratoryValueType || (exports.LaboratoryValueType = LaboratoryValueType = {}));
let Laboratory = Laboratory_1 = class Laboratory {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Laboratory_1();
        entity.costPrice = Number(raw.costPrice);
        entity.price = Number(raw.price);
        entity.lowValue = Number(raw.lowValue);
        entity.highValue = Number(raw.highValue);
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Laboratory_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "laboratoryCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Laboratory.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "level", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "parentId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'smallint', default: LaboratoryValueType.Number }),
    __metadata("design:type", Number)
], Laboratory.prototype, "valueType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "unit", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        nullable: true,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "lowValue", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        nullable: true,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Laboratory.prototype, "highValue", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Laboratory.prototype, "options", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => laboratory_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof laboratory_group_entity_1.default !== "undefined" && laboratory_group_entity_1.default) === "function" ? _a : Object)
], Laboratory.prototype, "laboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_laboratory_entity_1.default, (ticketLaboratory) => ticketLaboratory.laboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'parentId', referencedColumnName: 'laboratoryId' }),
    __metadata("design:type", typeof (_b = typeof ticket_laboratory_entity_1.default !== "undefined" && ticket_laboratory_entity_1.default) === "function" ? _b : Object)
], Laboratory.prototype, "ticketLaboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Laboratory.prototype, "children", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Laboratory.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Laboratory.prototype, "discountList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Laboratory.prototype, "discountListExtra", void 0);
Laboratory = Laboratory_1 = __decorate([
    (0, typeorm_1.Entity)('Laboratory'),
    (0, typeorm_1.Index)('IDX_Laboratory__oid_parentId', ['oid', 'parentId']),
    (0, typeorm_1.Unique)('UNIQUE_Laboratory__oid_laboratoryCode', ['oid', 'laboratoryCode'])
], Laboratory);
exports["default"] = Laboratory;


/***/ }),
/* 67 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketLaboratory_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(50);
const laboratory_entity_1 = __webpack_require__(66);
const ticket_entity_1 = __webpack_require__(59);
let TicketLaboratory = TicketLaboratory_1 = class TicketLaboratory extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketLaboratory_1();
        Object.assign(entity, raw);
        entity.costPrice = Number(raw.costPrice);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.createdAt = Number(raw.createdAt);
        entity.completedAt = raw.completedAt == null ? raw.completedAt : Number(raw.completedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketLaboratory_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "roomId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "laboratoryId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "ticketLaboratoryGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketLaboratoryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.TicketLaboratoryStatus !== "undefined" && variable_1.TicketLaboratoryStatus) === "function" ? _a : Object)
], TicketLaboratory.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketLaboratory.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _c : Object)
], TicketLaboratory.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketLaboratory.prototype, "completedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketLaboratoryList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _d : Object)
], TicketLaboratory.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _e : Object)
], TicketLaboratory.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => laboratory_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'laboratoryId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _f : Object)
], TicketLaboratory.prototype, "laboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => laboratory_entity_1.default, (laboratory) => laboratory.ticketLaboratory),
    __metadata("design:type", Array)
], TicketLaboratory.prototype, "laboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketLaboratory.prototype, "ticketUserList", void 0);
TicketLaboratory = TicketLaboratory_1 = __decorate([
    (0, typeorm_1.Entity)('TicketLaboratory'),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_laboratoryId', ['oid', 'laboratoryId']),
    (0, typeorm_1.Index)('IDX_TicketLaboratory__oid_createdAt', ['oid', 'createdAt'])
], TicketLaboratory);
exports["default"] = TicketLaboratory;


/***/ }),
/* 68 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketProcedure_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(50);
const procedure_entity_1 = __webpack_require__(69);
const ticket_entity_1 = __webpack_require__(59);
let TicketProcedure = TicketProcedure_1 = class TicketProcedure extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketProcedure_1();
        Object.assign(entity, raw);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.createdAt = Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketProcedure_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "procedureId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "totalSessions", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "completedSessions", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedure.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketProcedure.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketProcedureStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof variable_1.TicketProcedureStatus !== "undefined" && variable_1.TicketProcedureStatus) === "function" ? _c : Object)
], TicketProcedure.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedure.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProcedureList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _d : Object)
], TicketProcedure.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _e : Object)
], TicketProcedure.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => procedure_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'procedureId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof procedure_entity_1.default !== "undefined" && procedure_entity_1.default) === "function" ? _f : Object)
], TicketProcedure.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketProcedure.prototype, "ticketProcedureItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketProcedure.prototype, "ticketUserList", void 0);
TicketProcedure = TicketProcedure_1 = __decorate([
    (0, typeorm_1.Entity)('TicketProcedure'),
    (0, typeorm_1.Index)('IDX_TicketProcedure__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketProcedure__oid_procedureId', ['oid', 'procedureId']),
    (0, typeorm_1.Index)('IDX_TicketProcedure__oid_createdAt', ['oid', 'createdAt'])
], TicketProcedure);
exports["default"] = TicketProcedure;


/***/ }),
/* 69 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Procedure_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const procedure_group_entity_1 = __webpack_require__(70);
var ProcedureType;
(function (ProcedureType) {
    ProcedureType[ProcedureType["Basic"] = 1] = "Basic";
    ProcedureType[ProcedureType["SingleProcess"] = 2] = "SingleProcess";
    ProcedureType[ProcedureType["Regimen"] = 3] = "Regimen";
})(ProcedureType || (exports.ProcedureType = ProcedureType = {}));
let Procedure = Procedure_1 = class Procedure {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Procedure_1();
        Object.assign(entity, raw);
        entity.price = Number(raw.price);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Procedure_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Procedure.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Procedure.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Procedure.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Procedure.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Procedure.prototype, "procedureGroupId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: ProcedureType.Basic }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "procedureType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "totalSessions", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "gapHours", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 24 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "gapHoursType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Procedure.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => procedure_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'procedureGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof procedure_group_entity_1.default !== "undefined" && procedure_group_entity_1.default) === "function" ? _a : Object)
], Procedure.prototype, "procedureGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Procedure.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Procedure.prototype, "discountList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Procedure.prototype, "discountListExtra", void 0);
Procedure = Procedure_1 = __decorate([
    (0, typeorm_1.Entity)('Procedure'),
    (0, typeorm_1.Unique)('UNIQUE_Procedure__oid_code', ['oid', 'code'])
], Procedure);
exports["default"] = Procedure;


/***/ }),
/* 70 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProcedureGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let ProcedureGroup = ProcedureGroup_1 = class ProcedureGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProcedureGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProcedureGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], ProcedureGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], ProcedureGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], ProcedureGroup.prototype, "name", void 0);
ProcedureGroup = ProcedureGroup_1 = __decorate([
    (0, typeorm_1.Entity)('ProcedureGroup')
], ProcedureGroup);
exports["default"] = ProcedureGroup;


/***/ }),
/* 71 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketProduct_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const batch_entity_1 = __webpack_require__(56);
const customer_entity_1 = __webpack_require__(50);
const product_entity_1 = __webpack_require__(57);
const ticket_entity_1 = __webpack_require__(59);
var TicketProductType;
(function (TicketProductType) {
    TicketProductType[TicketProductType["Product"] = 0] = "Product";
    TicketProductType[TicketProductType["Prescription"] = 1] = "Prescription";
    TicketProductType[TicketProductType["Consumable"] = 2] = "Consumable";
})(TicketProductType || (exports.TicketProductType = TicketProductType = {}));
let TicketProduct = TicketProduct_1 = class TicketProduct extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketProduct_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.quantityPrescription = Number(raw.quantityPrescription);
        entity.costAmount = Number(raw.costAmount);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketProduct_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: variable_1.PickupStrategy.AutoWithFIFO, type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketProduct.prototype, "pickupStrategy", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketProduct.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50, default: JSON.stringify([0]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProduct.prototype, "warehouseIds", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketProductType.Prescription }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "type", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.DeliveryStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof variable_1.DeliveryStatus !== "undefined" && variable_1.DeliveryStatus) === "function" ? _c : Object)
], TicketProduct.prototype, "deliveryStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "unitRate", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "quantityPrescription", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "printPrescription", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _d : Object)
], TicketProduct.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProduct.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProduct.prototype, "hintUsage", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketProductList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _e : Object)
], TicketProduct.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _f : Object)
], TicketProduct.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _g : Object)
], TicketProduct.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_h = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _h : Object)
], TicketProduct.prototype, "batch", void 0);
TicketProduct = TicketProduct_1 = __decorate([
    (0, typeorm_1.Entity)('TicketProduct'),
    (0, typeorm_1.Index)('IDX_TicketProduct__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketProduct__oid_customerId', ['oid', 'customerId'])
], TicketProduct);
exports["default"] = TicketProduct;


/***/ }),
/* 72 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketRadiology_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(50);
const radiology_entity_1 = __webpack_require__(73);
const ticket_entity_1 = __webpack_require__(59);
var TicketRadiologyStatus;
(function (TicketRadiologyStatus) {
    TicketRadiologyStatus[TicketRadiologyStatus["Empty"] = 1] = "Empty";
    TicketRadiologyStatus[TicketRadiologyStatus["Pending"] = 2] = "Pending";
    TicketRadiologyStatus[TicketRadiologyStatus["Completed"] = 3] = "Completed";
})(TicketRadiologyStatus || (exports.TicketRadiologyStatus = TicketRadiologyStatus = {}));
let TicketRadiology = TicketRadiology_1 = class TicketRadiology extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketRadiology_1();
        Object.assign(entity, raw);
        entity.costPrice = Number(raw.costPrice);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        entity.createdAt = Number(raw.createdAt);
        entity.completedAt = raw.completedAt == null ? raw.completedAt : Number(raw.completedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketRadiology_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "customerId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "radiologyId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "printHtmlId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketRadiology.prototype, "customStyles", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketRadiology.prototype, "customVariables", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "roomId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketRadiologyStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _a : Object)
], TicketRadiology.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketRadiology.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketRadiology.prototype, "completedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketRadiology.prototype, "description", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketRadiology.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketRadiology.prototype, "imageIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketRadiologyList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], TicketRadiology.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => customer_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'customerId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _d : Object)
], TicketRadiology.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => radiology_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'radiologyId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof radiology_entity_1.default !== "undefined" && radiology_entity_1.default) === "function" ? _e : Object)
], TicketRadiology.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketRadiology.prototype, "imageList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketRadiology.prototype, "ticketUserList", void 0);
TicketRadiology = TicketRadiology_1 = __decorate([
    (0, typeorm_1.Entity)('TicketRadiology'),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_radiologyId', ['oid', 'radiologyId']),
    (0, typeorm_1.Index)('IDX_TicketRadiology__oid_createdAt', ['oid', 'createdAt'])
], TicketRadiology);
exports["default"] = TicketRadiology;


/***/ }),
/* 73 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Radiology_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const print_html_entity_1 = __webpack_require__(64);
const radiology_group_entity_1 = __webpack_require__(74);
let Radiology = Radiology_1 = class Radiology {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Radiology_1();
        entity.price = Number(raw.price);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Radiology_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Exclude)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Radiology.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Radiology.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "radiologyCode", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Radiology.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], Radiology.prototype, "printHtmlId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "costPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "price", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "requestNoteDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "descriptionDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "resultDefault", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "customVariables", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Radiology.prototype, "customStyles", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Radiology.prototype, "deletedAt", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => radiology_group_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'radiologyGroupId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof radiology_group_entity_1.default !== "undefined" && radiology_group_entity_1.default) === "function" ? _a : Object)
], Radiology.prototype, "radiologyGroup", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)((type) => print_html_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'printHtmlId', referencedColumnName: 'id' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof print_html_entity_1.default !== "undefined" && print_html_entity_1.default) === "function" ? _b : Object)
], Radiology.prototype, "printHtml", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Radiology.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Radiology.prototype, "discountList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], Radiology.prototype, "discountListExtra", void 0);
Radiology = Radiology_1 = __decorate([
    (0, typeorm_1.Entity)('Radiology'),
    (0, typeorm_1.Unique)('UNIQUE_Radiology__oid_radiologyCode', ['oid', 'radiologyCode'])
], Radiology);
exports["default"] = Radiology;


/***/ }),
/* 74 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var RadiologyGroup_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let RadiologyGroup = RadiologyGroup_1 = class RadiologyGroup {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new RadiologyGroup_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => RadiologyGroup_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], RadiologyGroup.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], RadiologyGroup.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], RadiologyGroup.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], RadiologyGroup.prototype, "name", void 0);
RadiologyGroup = RadiologyGroup_1 = __decorate([
    (0, typeorm_1.Entity)('RadiologyGroup')
], RadiologyGroup);
exports["default"] = RadiologyGroup;


/***/ }),
/* 75 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketUser_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const position_entity_1 = __webpack_require__(76);
const role_entity_1 = __webpack_require__(23);
const ticket_entity_1 = __webpack_require__(59);
const user_entity_1 = __webpack_require__(20);
let TicketUser = TicketUser_1 = class TicketUser {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketUser_1();
        Object.assign(entity, raw);
        entity.commissionMoney = Number(raw.commissionMoney);
        entity.commissionPercentActual = Number(raw.commissionPercentActual);
        entity.commissionPercentExpected = Number(raw.commissionPercentExpected);
        entity.ticketItemExpectedPrice = Number(raw.ticketItemExpectedPrice);
        entity.ticketItemActualPrice = Number(raw.ticketItemActualPrice);
        entity.createdAt = Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketUser_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketUser.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "roleId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "userId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof position_entity_1.PositionInteractType !== "undefined" && position_entity_1.PositionInteractType) === "function" ? _a : Object)
], TicketUser.prototype, "positionType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "positionInteractId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemExpectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "ticketItemActualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof position_entity_1.CommissionCalculatorType !== "undefined" && position_entity_1.CommissionCalculatorType) === "function" ? _b : Object)
], TicketUser.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 5,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionPercentActual", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 5,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "commissionPercentExpected", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketUser.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, (ticket) => ticket.ticketUserList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'ticketId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], TicketUser.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'userId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _d : Object)
], TicketUser.prototype, "user", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _e : Object)
], TicketUser.prototype, "role", void 0);
TicketUser = TicketUser_1 = __decorate([
    (0, typeorm_1.Entity)('TicketUser'),
    (0, typeorm_1.Index)('IDX_TicketUser__oid_ticketId', ['oid', 'ticketId']),
    (0, typeorm_1.Index)('IDX_TicketUser__oid_createdAt', ['oid', 'createdAt'])
], TicketUser);
exports["default"] = TicketUser;


/***/ }),
/* 76 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Position_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CommissionCalculatorType = exports.PositionInteractType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const laboratory_entity_1 = __webpack_require__(66);
const procedure_entity_1 = __webpack_require__(69);
const product_entity_1 = __webpack_require__(57);
const radiology_entity_1 = __webpack_require__(73);
const role_entity_1 = __webpack_require__(23);
var PositionInteractType;
(function (PositionInteractType) {
    PositionInteractType[PositionInteractType["Ticket"] = 1] = "Ticket";
    PositionInteractType[PositionInteractType["Product"] = 2] = "Product";
    PositionInteractType[PositionInteractType["Procedure"] = 3] = "Procedure";
    PositionInteractType[PositionInteractType["Radiology"] = 4] = "Radiology";
    PositionInteractType[PositionInteractType["Laboratory"] = 5] = "Laboratory";
    PositionInteractType[PositionInteractType["Regimen"] = 6] = "Regimen";
    PositionInteractType[PositionInteractType["ConsumableList"] = 7] = "ConsumableList";
    PositionInteractType[PositionInteractType["PrescriptionList"] = 8] = "PrescriptionList";
    PositionInteractType[PositionInteractType["LaboratoryGroup"] = 9] = "LaboratoryGroup";
})(PositionInteractType || (exports.PositionInteractType = PositionInteractType = {}));
var CommissionCalculatorType;
(function (CommissionCalculatorType) {
    CommissionCalculatorType[CommissionCalculatorType["VND"] = 1] = "VND";
    CommissionCalculatorType[CommissionCalculatorType["PercentExpected"] = 2] = "PercentExpected";
    CommissionCalculatorType[CommissionCalculatorType["PercentActual"] = 3] = "PercentActual";
})(CommissionCalculatorType || (exports.CommissionCalculatorType = CommissionCalculatorType = {}));
let Position = Position_1 = class Position {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Position_1();
        Object.assign(entity, raw);
        entity.commissionValue = Number(raw.commissionValue);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Position_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Position.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "roleId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "positionInteractId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: PositionInteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "positionType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "commissionValue", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Position.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => role_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'roleId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof role_entity_1.default !== "undefined" && role_entity_1.default) === "function" ? _a : Object)
], Position.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], Position.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof procedure_entity_1.default !== "undefined" && procedure_entity_1.default) === "function" ? _c : Object)
], Position.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof radiology_entity_1.default !== "undefined" && radiology_entity_1.default) === "function" ? _d : Object)
], Position.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _e : Object)
], Position.prototype, "laboratory", void 0);
Position = Position_1 = __decorate([
    (0, typeorm_1.Entity)('Position'),
    (0, typeorm_1.Index)('IDX_Position__oid_roleId_positionType_positionInteractId', ['oid', 'roleId', 'positionType', 'positionInteractId'], { unique: true })
], Position);
exports["default"] = Position;


/***/ }),
/* 77 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Discount_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DiscountRepeatType = exports.DiscountInteractType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const laboratory_entity_1 = __webpack_require__(66);
const procedure_entity_1 = __webpack_require__(69);
const product_entity_1 = __webpack_require__(57);
const radiology_entity_1 = __webpack_require__(73);
var DiscountInteractType;
(function (DiscountInteractType) {
    DiscountInteractType[DiscountInteractType["Product"] = 1] = "Product";
    DiscountInteractType[DiscountInteractType["Procedure"] = 2] = "Procedure";
    DiscountInteractType[DiscountInteractType["Laboratory"] = 3] = "Laboratory";
    DiscountInteractType[DiscountInteractType["Radiology"] = 4] = "Radiology";
    DiscountInteractType[DiscountInteractType["Regimen"] = 5] = "Regimen";
})(DiscountInteractType || (exports.DiscountInteractType = DiscountInteractType = {}));
var DiscountRepeatType;
(function (DiscountRepeatType) {
    DiscountRepeatType[DiscountRepeatType["Once"] = 1] = "Once";
    DiscountRepeatType[DiscountRepeatType["Weekly"] = 2] = "Weekly";
})(DiscountRepeatType || (exports.DiscountRepeatType = DiscountRepeatType = {}));
let Discount = Discount_1 = class Discount {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Discount_1();
        Object.assign(entity, raw);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Discount_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Discount.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "isActive", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "priority", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: DiscountInteractType.Product }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "discountInteractType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "discountInteractId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.Percent }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], Discount.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: DiscountRepeatType.Weekly }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Discount.prototype, "discountRepeatType", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Discount.prototype, "periodsDay", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Discount.prototype, "periodsTime", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], Discount.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof procedure_entity_1.default !== "undefined" && procedure_entity_1.default) === "function" ? _c : Object)
], Discount.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof radiology_entity_1.default !== "undefined" && radiology_entity_1.default) === "function" ? _d : Object)
], Discount.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof laboratory_entity_1.default !== "undefined" && laboratory_entity_1.default) === "function" ? _e : Object)
], Discount.prototype, "laboratory", void 0);
Discount = Discount_1 = __decorate([
    (0, typeorm_1.Entity)('Discount'),
    (0, typeorm_1.Index)('IDX_Discount__oid_discountInteractType_discountInteractId', [
        'oid',
        'discountInteractType',
        'discountInteractId',
    ])
], Discount);
exports["default"] = Discount;


/***/ }),
/* 78 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Expense_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let Expense = Expense_1 = class Expense {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Expense_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Expense_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Expense.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Expense.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Expense.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Expense.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Expense.prototype, "isActive", void 0);
Expense = Expense_1 = __decorate([
    (0, typeorm_1.Entity)('Expense'),
    (0, typeorm_1.Unique)('UNIQUE_Expense__oid_code', ['oid', 'code'])
], Expense);
exports["default"] = Expense;


/***/ }),
/* 79 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ICD_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let ICD = ICD_1 = class ICD {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ICD_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ICD_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], ICD.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ length: 25, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], ICD.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], ICD.prototype, "name", void 0);
ICD = ICD_1 = __decorate([
    (0, typeorm_1.Entity)('ICD')
], ICD);
exports["default"] = ICD;


/***/ }),
/* 80 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var LaboratorySample_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let LaboratorySample = LaboratorySample_1 = class LaboratorySample {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new LaboratorySample_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => LaboratorySample_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], LaboratorySample.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], LaboratorySample.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], LaboratorySample.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], LaboratorySample.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    __metadata("design:type", String)
], LaboratorySample.prototype, "laboratoryIds", void 0);
LaboratorySample = LaboratorySample_1 = __decorate([
    (0, typeorm_1.Entity)('LaboratorySample')
], LaboratorySample);
exports["default"] = LaboratorySample;


/***/ }),
/* 81 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PaymentTicketItem_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketItemType = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(51);
const ticket_laboratory_group_entity_1 = __webpack_require__(62);
const ticket_procedure_entity_1 = __webpack_require__(68);
const ticket_product_entity_1 = __webpack_require__(71);
const ticket_radiology_entity_1 = __webpack_require__(72);
const ticket_entity_1 = __webpack_require__(59);
var TicketItemType;
(function (TicketItemType) {
    TicketItemType[TicketItemType["Other"] = 0] = "Other";
    TicketItemType[TicketItemType["TicketProcedure"] = 1] = "TicketProcedure";
    TicketItemType[TicketItemType["TicketProductConsumable"] = 2] = "TicketProductConsumable";
    TicketItemType[TicketItemType["TicketProductPrescription"] = 3] = "TicketProductPrescription";
    TicketItemType[TicketItemType["TicketLaboratory"] = 4] = "TicketLaboratory";
    TicketItemType[TicketItemType["TicketRadiology"] = 5] = "TicketRadiology";
})(TicketItemType || (exports.TicketItemType = TicketItemType = {}));
let PaymentTicketItem = PaymentTicketItem_1 = class PaymentTicketItem {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PaymentTicketItem_1();
        Object.assign(entity, raw);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.discountMoney = Number(raw.discountMoney);
        entity.discountPercent = Number(raw.discountPercent);
        entity.actualPrice = Number(raw.actualPrice);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PaymentTicketItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "paymentId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: TicketItemType.Other }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "ticketItemType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "ticketItemId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'integer', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "interactId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "discountMoney", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 7,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "discountPercent", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 25, default: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], PaymentTicketItem.prototype, "discountType", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PaymentTicketItem.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_b = typeof payment_entity_1.default !== "undefined" && payment_entity_1.default) === "function" ? _b : Object)
], PaymentTicketItem.prototype, "payment", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_c = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _c : Object)
], PaymentTicketItem.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_d = typeof ticket_procedure_entity_1.default !== "undefined" && ticket_procedure_entity_1.default) === "function" ? _d : Object)
], PaymentTicketItem.prototype, "ticketProcedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_e = typeof ticket_product_entity_1.default !== "undefined" && ticket_product_entity_1.default) === "function" ? _e : Object)
], PaymentTicketItem.prototype, "ticketProductConsumable", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_f = typeof ticket_product_entity_1.default !== "undefined" && ticket_product_entity_1.default) === "function" ? _f : Object)
], PaymentTicketItem.prototype, "ticketProductPrescription", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_g = typeof ticket_laboratory_group_entity_1.default !== "undefined" && ticket_laboratory_group_entity_1.default) === "function" ? _g : Object)
], PaymentTicketItem.prototype, "ticketLaboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_h = typeof ticket_radiology_entity_1.default !== "undefined" && ticket_radiology_entity_1.default) === "function" ? _h : Object)
], PaymentTicketItem.prototype, "ticketRadiology", void 0);
PaymentTicketItem = PaymentTicketItem_1 = __decorate([
    (0, typeorm_1.Entity)('PaymentTicketItem'),
    (0, typeorm_1.Index)('IDX_PaymentTicketItem__oid_paymentId', ['oid', 'paymentId'])
], PaymentTicketItem);
exports["default"] = PaymentTicketItem;


/***/ }),
/* 82 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Permission_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const permission_enum_1 = __webpack_require__(83);
let Permission = Permission_1 = class Permission {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Permission_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Permission_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('identity', { name: 'id', generatedIdentity: 'BY DEFAULT' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof permission_enum_1.PermissionId !== "undefined" && permission_enum_1.PermissionId) === "function" ? _a : Object)
], Permission.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "level", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Permission.prototype, "parentId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Permission.prototype, "rootId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Permission.prototype, "pathId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Permission.prototype, "isActive", void 0);
Permission = Permission_1 = __decorate([
    (0, typeorm_1.Entity)('Permission')
], Permission);
exports["default"] = Permission;


/***/ }),
/* 83 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionId = void 0;
var PermissionId;
(function (PermissionId) {
    PermissionId[PermissionId["ORGANIZATION"] = 1] = "ORGANIZATION";
    PermissionId[PermissionId["ORGANIZATION_UPDATE_INFO"] = 100] = "ORGANIZATION_UPDATE_INFO";
    PermissionId[PermissionId["ORGANIZATION_SETTING_UPSERT"] = 101] = "ORGANIZATION_SETTING_UPSERT";
    PermissionId[PermissionId["ORGANIZATION_VERIFY_EMAIL"] = 102] = "ORGANIZATION_VERIFY_EMAIL";
    PermissionId[PermissionId["USER"] = 2] = "USER";
    PermissionId[PermissionId["USER_ACCOUNT_MENU"] = 200] = "USER_ACCOUNT_MENU";
    PermissionId[PermissionId["USER_ACCOUNT_CREATE"] = 201] = "USER_ACCOUNT_CREATE";
    PermissionId[PermissionId["USER_ACCOUNT_UPDATE"] = 202] = "USER_ACCOUNT_UPDATE";
    PermissionId[PermissionId["USER_ACCOUNT_DELETE"] = 203] = "USER_ACCOUNT_DELETE";
    PermissionId[PermissionId["USER_ACCOUNT_CHANGE_PASSWORD"] = 204] = "USER_ACCOUNT_CHANGE_PASSWORD";
    PermissionId[PermissionId["USER_ACCOUNT_LOGOUT"] = 205] = "USER_ACCOUNT_LOGOUT";
    PermissionId[PermissionId["USER_ROLE_MENU"] = 210] = "USER_ROLE_MENU";
    PermissionId[PermissionId["USER_ROLE_CREATE"] = 211] = "USER_ROLE_CREATE";
    PermissionId[PermissionId["USER_ROLE_UPDATE"] = 212] = "USER_ROLE_UPDATE";
    PermissionId[PermissionId["USER_ROLE_DELETE"] = 213] = "USER_ROLE_DELETE";
    PermissionId[PermissionId["STATISTIC"] = 4] = "STATISTIC";
    PermissionId[PermissionId["STATISTIC_TICKET"] = 401] = "STATISTIC_TICKET";
    PermissionId[PermissionId["STATISTIC_PURCHASE_ORDER"] = 402] = "STATISTIC_PURCHASE_ORDER";
    PermissionId[PermissionId["STATISTIC_PRODUCT"] = 403] = "STATISTIC_PRODUCT";
    PermissionId[PermissionId["STATISTIC_CUSTOMER"] = 404] = "STATISTIC_CUSTOMER";
    PermissionId[PermissionId["STATISTIC_PROCEDURE"] = 405] = "STATISTIC_PROCEDURE";
    PermissionId[PermissionId["STATISTIC_LABORATORY"] = 406] = "STATISTIC_LABORATORY";
    PermissionId[PermissionId["STATISTIC_RADIOLOGY"] = 407] = "STATISTIC_RADIOLOGY";
    PermissionId[PermissionId["MASTER_DATA"] = 5] = "MASTER_DATA";
    PermissionId[PermissionId["MASTER_DATA_ROOM"] = 501] = "MASTER_DATA_ROOM";
    PermissionId[PermissionId["MASTER_DATA_WAREHOUSE"] = 502] = "MASTER_DATA_WAREHOUSE";
    PermissionId[PermissionId["MASTER_DATA_DISCOUNT"] = 503] = "MASTER_DATA_DISCOUNT";
    PermissionId[PermissionId["MASTER_DATA_POSITION"] = 504] = "MASTER_DATA_POSITION";
    PermissionId[PermissionId["MASTER_DATA_PRINT_HTML"] = 505] = "MASTER_DATA_PRINT_HTML";
    PermissionId[PermissionId["MASTER_DATA_PAYMENT_METHOD"] = 506] = "MASTER_DATA_PAYMENT_METHOD";
    PermissionId[PermissionId["MASTER_DATA_CUSTOMER_SOURCE"] = 507] = "MASTER_DATA_CUSTOMER_SOURCE";
    PermissionId[PermissionId["MASTER_DATA_SURCHARGE"] = 508] = "MASTER_DATA_SURCHARGE";
    PermissionId[PermissionId["MASTER_DATA_EXPENSE"] = 509] = "MASTER_DATA_EXPENSE";
    PermissionId[PermissionId["MASTER_DATA_PRESCRIPTION_SAMPLE"] = 551] = "MASTER_DATA_PRESCRIPTION_SAMPLE";
    PermissionId[PermissionId["MASTER_DATA_RADIOLOGY_CONTENT_SAMPLE"] = 552] = "MASTER_DATA_RADIOLOGY_CONTENT_SAMPLE";
    PermissionId[PermissionId["PRODUCT"] = 6] = "PRODUCT";
    PermissionId[PermissionId["PRODUCT_MENU"] = 600] = "PRODUCT_MENU";
    PermissionId[PermissionId["PRODUCT_CREATE"] = 601] = "PRODUCT_CREATE";
    PermissionId[PermissionId["PRODUCT_UPDATE"] = 602] = "PRODUCT_UPDATE";
    PermissionId[PermissionId["PRODUCT_DELETE"] = 603] = "PRODUCT_DELETE";
    PermissionId[PermissionId["PRODUCT_UPDATE_BATCH"] = 604] = "PRODUCT_UPDATE_BATCH";
    PermissionId[PermissionId["PRODUCT_DELETE_BATCH"] = 605] = "PRODUCT_DELETE_BATCH";
    PermissionId[PermissionId["PRODUCT_GROUP_CRUD"] = 611] = "PRODUCT_GROUP_CRUD";
    PermissionId[PermissionId["PRODUCT_READ_COST_PRICE"] = 621] = "PRODUCT_READ_COST_PRICE";
    PermissionId[PermissionId["PRODUCT_READ_MOVEMENT"] = 622] = "PRODUCT_READ_MOVEMENT";
    PermissionId[PermissionId["PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE"] = 631] = "PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE";
    PermissionId[PermissionId["PRODUCT_MERGE"] = 641] = "PRODUCT_MERGE";
    PermissionId[PermissionId["PRODUCT_MERGE_BATCH"] = 642] = "PRODUCT_MERGE_BATCH";
    PermissionId[PermissionId["DISTRIBUTOR"] = 7] = "DISTRIBUTOR";
    PermissionId[PermissionId["DISTRIBUTOR_MENU"] = 700] = "DISTRIBUTOR_MENU";
    PermissionId[PermissionId["DISTRIBUTOR_CREATE"] = 701] = "DISTRIBUTOR_CREATE";
    PermissionId[PermissionId["DISTRIBUTOR_UPDATE"] = 702] = "DISTRIBUTOR_UPDATE";
    PermissionId[PermissionId["DISTRIBUTOR_DELETE"] = 703] = "DISTRIBUTOR_DELETE";
    PermissionId[PermissionId["CUSTOMER"] = 8] = "CUSTOMER";
    PermissionId[PermissionId["CUSTOMER_MENU"] = 800] = "CUSTOMER_MENU";
    PermissionId[PermissionId["CUSTOMER_CREATE"] = 801] = "CUSTOMER_CREATE";
    PermissionId[PermissionId["CUSTOMER_UPDATE"] = 802] = "CUSTOMER_UPDATE";
    PermissionId[PermissionId["CUSTOMER_DELETE"] = 803] = "CUSTOMER_DELETE";
    PermissionId[PermissionId["PURCHASE_ORDER"] = 9] = "PURCHASE_ORDER";
    PermissionId[PermissionId["PURCHASE_ORDER_MENU"] = 900] = "PURCHASE_ORDER_MENU";
    PermissionId[PermissionId["PURCHASE_ORDER_DRAFT_CRUD"] = 901] = "PURCHASE_ORDER_DRAFT_CRUD";
    PermissionId[PermissionId["PURCHASE_ORDER_DEPOSITED_UPDATE"] = 902] = "PURCHASE_ORDER_DEPOSITED_UPDATE";
    PermissionId[PermissionId["PURCHASE_ORDER_DEPOSITED_DESTROY"] = 903] = "PURCHASE_ORDER_DEPOSITED_DESTROY";
    PermissionId[PermissionId["PURCHASE_ORDER_PAYMENT_MONEY"] = 911] = "PURCHASE_ORDER_PAYMENT_MONEY";
    PermissionId[PermissionId["PURCHASE_ORDER_REFUND_MONEY"] = 912] = "PURCHASE_ORDER_REFUND_MONEY";
    PermissionId[PermissionId["PURCHASE_ORDER_SEND_PRODUCT"] = 921] = "PURCHASE_ORDER_SEND_PRODUCT";
    PermissionId[PermissionId["PURCHASE_ORDER_RETURN_PRODUCT"] = 922] = "PURCHASE_ORDER_RETURN_PRODUCT";
    PermissionId[PermissionId["PURCHASE_ORDER_CLOSE"] = 970] = "PURCHASE_ORDER_CLOSE";
    PermissionId[PermissionId["PURCHASE_ORDER_TERMINATE"] = 972] = "PURCHASE_ORDER_TERMINATE";
    PermissionId[PermissionId["PURCHASE_ORDER_CANCELLED_DESTROY"] = 973] = "PURCHASE_ORDER_CANCELLED_DESTROY";
    PermissionId[PermissionId["APPOINTMENT"] = 10] = "APPOINTMENT";
    PermissionId[PermissionId["APPOINTMENT_MENU"] = 1000] = "APPOINTMENT_MENU";
    PermissionId[PermissionId["APPOINTMENT_CREATE"] = 1001] = "APPOINTMENT_CREATE";
    PermissionId[PermissionId["APPOINTMENT_UPDATE"] = 1002] = "APPOINTMENT_UPDATE";
    PermissionId[PermissionId["APPOINTMENT_DELETE"] = 1003] = "APPOINTMENT_DELETE";
    PermissionId[PermissionId["APPOINTMENT_REGISTER_TICKET"] = 1021] = "APPOINTMENT_REGISTER_TICKET";
    PermissionId[PermissionId["STOCK_CHECK"] = 11] = "STOCK_CHECK";
    PermissionId[PermissionId["STOCK_CHECK_MENU"] = 1100] = "STOCK_CHECK_MENU";
    PermissionId[PermissionId["STOCK_CHECK_DRAFT_CRUD"] = 1101] = "STOCK_CHECK_DRAFT_CRUD";
    PermissionId[PermissionId["STOCK_CHECK_DRAFT_SUBMIT"] = 1121] = "STOCK_CHECK_DRAFT_SUBMIT";
    PermissionId[PermissionId["STOCK_CHECK_PENDING_APPROVE"] = 1122] = "STOCK_CHECK_PENDING_APPROVE";
    PermissionId[PermissionId["STOCK_CHECK_CONFIRMED_RECONCILE"] = 1170] = "STOCK_CHECK_CONFIRMED_RECONCILE";
    PermissionId[PermissionId["STOCK_CHECK_TERMINATE"] = 1172] = "STOCK_CHECK_TERMINATE";
    PermissionId[PermissionId["STOCK_CHECK_CANCELLED_DESTROY"] = 1173] = "STOCK_CHECK_CANCELLED_DESTROY";
    PermissionId[PermissionId["PAYMENT"] = 12] = "PAYMENT";
    PermissionId[PermissionId["PAYMENT_MENU"] = 1200] = "PAYMENT_MENU";
    PermissionId[PermissionId["PAYMENT_UPDATE_INFO"] = 1202] = "PAYMENT_UPDATE_INFO";
    PermissionId[PermissionId["PAYMENT_OTHER_CREATE_MONEY_OUT"] = 1231] = "PAYMENT_OTHER_CREATE_MONEY_OUT";
    PermissionId[PermissionId["PAYMENT_OTHER_CREATE_MONEY_IN"] = 1232] = "PAYMENT_OTHER_CREATE_MONEY_IN";
    PermissionId[PermissionId["PAYMENT_OTHER_DESTROY_MONEY_OUT"] = 1233] = "PAYMENT_OTHER_DESTROY_MONEY_OUT";
    PermissionId[PermissionId["PAYMENT_OTHER_DESTROY_MONEY_IN"] = 1234] = "PAYMENT_OTHER_DESTROY_MONEY_IN";
    PermissionId[PermissionId["PROCEDURE"] = 14] = "PROCEDURE";
    PermissionId[PermissionId["PROCEDURE_MENU"] = 1400] = "PROCEDURE_MENU";
    PermissionId[PermissionId["PROCEDURE_CREATE"] = 1401] = "PROCEDURE_CREATE";
    PermissionId[PermissionId["PROCEDURE_UPDATE"] = 1402] = "PROCEDURE_UPDATE";
    PermissionId[PermissionId["PROCEDURE_DELETE"] = 1403] = "PROCEDURE_DELETE";
    PermissionId[PermissionId["PROCEDURE_GROUP_CRUD"] = 1411] = "PROCEDURE_GROUP_CRUD";
    PermissionId[PermissionId["LABORATORY"] = 15] = "LABORATORY";
    PermissionId[PermissionId["LABORATORY_MENU"] = 1500] = "LABORATORY_MENU";
    PermissionId[PermissionId["LABORATORY_CREATE"] = 1501] = "LABORATORY_CREATE";
    PermissionId[PermissionId["LABORATORY_UPDATE"] = 1502] = "LABORATORY_UPDATE";
    PermissionId[PermissionId["LABORATORY_DELETE"] = 1503] = "LABORATORY_DELETE";
    PermissionId[PermissionId["LABORATORY_GROUP_CRUD"] = 1511] = "LABORATORY_GROUP_CRUD";
    PermissionId[PermissionId["LABORATORY_SAMPLE_CRUD"] = 1512] = "LABORATORY_SAMPLE_CRUD";
    PermissionId[PermissionId["RADIOLOGY"] = 16] = "RADIOLOGY";
    PermissionId[PermissionId["RADIOLOGY_MENU"] = 1600] = "RADIOLOGY_MENU";
    PermissionId[PermissionId["RADIOLOGY_CREATE"] = 1601] = "RADIOLOGY_CREATE";
    PermissionId[PermissionId["RADIOLOGY_UPDATE"] = 1602] = "RADIOLOGY_UPDATE";
    PermissionId[PermissionId["RADIOLOGY_DELETE"] = 1603] = "RADIOLOGY_DELETE";
    PermissionId[PermissionId["RADIOLOGY_GROUP_CRUD"] = 1611] = "RADIOLOGY_GROUP_CRUD";
    PermissionId[PermissionId["RADIOLOGY_SAMPLE_CRUD"] = 1612] = "RADIOLOGY_SAMPLE_CRUD";
    PermissionId[PermissionId["FILE"] = 20] = "FILE";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_PRODUCT"] = 2011] = "FILE_EXCEL_DOWNLOAD_PRODUCT";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_PROCEDURE"] = 2012] = "FILE_EXCEL_DOWNLOAD_PROCEDURE";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_LABORATORY"] = 2013] = "FILE_EXCEL_DOWNLOAD_LABORATORY";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_RADIOLOGY"] = 2014] = "FILE_EXCEL_DOWNLOAD_RADIOLOGY";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_CUSTOMER"] = 2015] = "FILE_EXCEL_DOWNLOAD_CUSTOMER";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_PURCHASE_ORDER"] = 2016] = "FILE_EXCEL_DOWNLOAD_PURCHASE_ORDER";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_TICKET_ORDER"] = 2017] = "FILE_EXCEL_DOWNLOAD_TICKET_ORDER";
    PermissionId[PermissionId["FILE_EXCEL_DOWNLOAD_TICKET_CLINIC"] = 2018] = "FILE_EXCEL_DOWNLOAD_TICKET_CLINIC";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_PRODUCT"] = 2061] = "FILE_EXCEL_UPLOAD_PRODUCT";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_PROCEDURE"] = 2062] = "FILE_EXCEL_UPLOAD_PROCEDURE";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_LABORATORY"] = 2063] = "FILE_EXCEL_UPLOAD_LABORATORY";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_RADIOLOGY"] = 2064] = "FILE_EXCEL_UPLOAD_RADIOLOGY";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_CUSTOMER"] = 2065] = "FILE_EXCEL_UPLOAD_CUSTOMER";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_PURCHASE_ORDER"] = 2066] = "FILE_EXCEL_UPLOAD_PURCHASE_ORDER";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_TICKET_ORDER"] = 2067] = "FILE_EXCEL_UPLOAD_TICKET_ORDER";
    PermissionId[PermissionId["FILE_EXCEL_UPLOAD_TICKET_CLINIC"] = 2068] = "FILE_EXCEL_UPLOAD_TICKET_CLINIC";
    PermissionId[PermissionId["TICKET"] = 50] = "TICKET";
    PermissionId[PermissionId["TICKET_DRAFT_CRUD"] = 5001] = "TICKET_DRAFT_CRUD";
    PermissionId[PermissionId["TICKET_START_EXECUTING"] = 5002] = "TICKET_START_EXECUTING";
    PermissionId[PermissionId["TICKET_CHANGE_ATTRIBUTE"] = 5011] = "TICKET_CHANGE_ATTRIBUTE";
    PermissionId[PermissionId["TICKET_CHANGE_USER_POSITION"] = 5021] = "TICKET_CHANGE_USER_POSITION";
    PermissionId[PermissionId["TICKET_CHANGE_USER_COMMISSION"] = 5022] = "TICKET_CHANGE_USER_COMMISSION";
    PermissionId[PermissionId["TICKET_CHANGE_PROCEDURE"] = 5031] = "TICKET_CHANGE_PROCEDURE";
    PermissionId[PermissionId["TICKET_CHANGE_PROCEDURE_RESULT"] = 5032] = "TICKET_CHANGE_PROCEDURE_RESULT";
    PermissionId[PermissionId["TICKET_CHANGE_PRODUCT"] = 5041] = "TICKET_CHANGE_PRODUCT";
    PermissionId[PermissionId["TICKET_CHANGE_PRODUCT_CONSUMABLE"] = 5042] = "TICKET_CHANGE_PRODUCT_CONSUMABLE";
    PermissionId[PermissionId["TICKET_CHANGE_PRODUCT_PRESCRIPTION"] = 5043] = "TICKET_CHANGE_PRODUCT_PRESCRIPTION";
    PermissionId[PermissionId["TICKET_CHANGE_PRODUCT_SEND_PRODUCT"] = 5044] = "TICKET_CHANGE_PRODUCT_SEND_PRODUCT";
    PermissionId[PermissionId["TICKET_CHANGE_PRODUCT_RETURN_PRODUCT"] = 5045] = "TICKET_CHANGE_PRODUCT_RETURN_PRODUCT";
    PermissionId[PermissionId["TICKET_CHANGE_LABORATORY"] = 5051] = "TICKET_CHANGE_LABORATORY";
    PermissionId[PermissionId["TICKET_CHANGE_LABORATORY_RESULT"] = 5052] = "TICKET_CHANGE_LABORATORY_RESULT";
    PermissionId[PermissionId["TICKET_CHANGE_RADIOLOGY"] = 5061] = "TICKET_CHANGE_RADIOLOGY";
    PermissionId[PermissionId["TICKET_CHANGE_RADIOLOGY_RESULT"] = 5062] = "TICKET_CHANGE_RADIOLOGY_RESULT";
    PermissionId[PermissionId["TICKET_PAYMENT_MONEY"] = 5083] = "TICKET_PAYMENT_MONEY";
    PermissionId[PermissionId["TICKET_REFUND_MONEY"] = 5084] = "TICKET_REFUND_MONEY";
    PermissionId[PermissionId["TICKET_CHANGE_DISCOUNT"] = 5085] = "TICKET_CHANGE_DISCOUNT";
    PermissionId[PermissionId["TICKET_CLOSE"] = 5091] = "TICKET_CLOSE";
    PermissionId[PermissionId["TICKET_REOPEN"] = 5092] = "TICKET_REOPEN";
    PermissionId[PermissionId["TICKET_TERMINATE"] = 5093] = "TICKET_TERMINATE";
    PermissionId[PermissionId["TICKET_DESTROY"] = 5094] = "TICKET_DESTROY";
})(PermissionId || (exports.PermissionId = PermissionId = {}));


/***/ }),
/* 84 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PrescriptionSample_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let PrescriptionSample = PrescriptionSample_1 = class PrescriptionSample {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PrescriptionSample_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PrescriptionSample_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "userId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], PrescriptionSample.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], PrescriptionSample.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'text', default: JSON.stringify([]) }),
    __metadata("design:type", String)
], PrescriptionSample.prototype, "medicines", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], PrescriptionSample.prototype, "medicineList", void 0);
PrescriptionSample = PrescriptionSample_1 = __decorate([
    (0, typeorm_1.Entity)('PrescriptionSample')
], PrescriptionSample);
exports["default"] = PrescriptionSample;


/***/ }),
/* 85 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PrintHtmlSetting_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let PrintHtmlSetting = PrintHtmlSetting_1 = class PrintHtmlSetting {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new PrintHtmlSetting_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => PrintHtmlSetting_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], PrintHtmlSetting.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], PrintHtmlSetting.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], PrintHtmlSetting.prototype, "printHtmlType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], PrintHtmlSetting.prototype, "printHtmlId", void 0);
PrintHtmlSetting = PrintHtmlSetting_1 = __decorate([
    (0, typeorm_1.Entity)('PrintHtmlSetting')
], PrintHtmlSetting);
exports["default"] = PrintHtmlSetting;


/***/ }),
/* 86 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ProductMovement_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const variable_1 = __webpack_require__(21);
const customer_entity_1 = __webpack_require__(50);
const distributor_entity_1 = __webpack_require__(52);
const product_entity_1 = __webpack_require__(57);
const purchase_order_entity_1 = __webpack_require__(54);
const stock_check_entity_1 = __webpack_require__(87);
const ticket_entity_1 = __webpack_require__(59);
const user_entity_1 = __webpack_require__(20);
let ProductMovement = ProductMovement_1 = class ProductMovement extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new ProductMovement_1();
        Object.assign(entity, raw);
        entity.quantity = Number(raw.quantity);
        entity.costAmount = Number(raw.costAmount);
        entity.openQuantityProduct = Number(raw.openQuantityProduct);
        entity.closeQuantityProduct = Number(raw.closeQuantityProduct);
        entity.openQuantityBatch = Number(raw.openQuantityBatch);
        entity.closeQuantityBatch = Number(raw.closeQuantityBatch);
        entity.openCostAmountBatch = Number(raw.openCostAmountBatch);
        entity.closeCostAmountBatch = Number(raw.closeCostAmountBatch);
        entity.expectedPrice = Number(raw.expectedPrice);
        entity.actualPrice = Number(raw.actualPrice);
        entity.createdAt = raw.createdAt == null ? raw.createdAt : Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => ProductMovement_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.MovementType !== "undefined" && variable_1.MovementType) === "function" ? _a : Object)
], ProductMovement.prototype, "movementType", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "contactId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "voucherId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "voucherProductId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "warehouseId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "isRefund", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "quantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "costAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openQuantityProduct", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeQuantityProduct", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openQuantityBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeQuantityBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "openCostAmountBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "closeCostAmountBatch", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "expectedPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "actualPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], ProductMovement.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], ProductMovement.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof distributor_entity_1.default !== "undefined" && distributor_entity_1.default) === "function" ? _c : Object)
], ProductMovement.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => purchase_order_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_d = typeof purchase_order_entity_1.default !== "undefined" && purchase_order_entity_1.default) === "function" ? _d : Object)
], ProductMovement.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_e = typeof customer_entity_1.default !== "undefined" && customer_entity_1.default) === "function" ? _e : Object)
], ProductMovement.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => ticket_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_f = typeof ticket_entity_1.default !== "undefined" && ticket_entity_1.default) === "function" ? _f : Object)
], ProductMovement.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => stock_check_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'voucherId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_g = typeof stock_check_entity_1.default !== "undefined" && stock_check_entity_1.default) === "function" ? _g : Object)
], ProductMovement.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'contactId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_h = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _h : Object)
], ProductMovement.prototype, "user", void 0);
ProductMovement = ProductMovement_1 = __decorate([
    (0, typeorm_1.Entity)('ProductMovement'),
    (0, typeorm_1.Index)('IDX_ProductMovement__oid_productId_id', ['oid', 'productId', 'id']),
    (0, typeorm_1.Index)('IDX_ProductMovement__oid_contactId_movementType_id', [
        'oid',
        'contactId',
        'movementType',
        'id',
    ])
], ProductMovement);
exports["default"] = ProductMovement;


/***/ }),
/* 87 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var StockCheck_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckStatus = void 0;
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const stock_check_item_entity_1 = __webpack_require__(88);
const user_entity_1 = __webpack_require__(20);
var StockCheckStatus;
(function (StockCheckStatus) {
    StockCheckStatus[StockCheckStatus["Draft"] = 0] = "Draft";
    StockCheckStatus[StockCheckStatus["Pending"] = 1] = "Pending";
    StockCheckStatus[StockCheckStatus["Confirmed"] = 2] = "Confirmed";
    StockCheckStatus[StockCheckStatus["Balanced"] = 4] = "Balanced";
    StockCheckStatus[StockCheckStatus["Cancelled"] = 5] = "Cancelled";
})(StockCheckStatus || (exports.StockCheckStatus = StockCheckStatus = {}));
let StockCheck = StockCheck_1 = class StockCheck {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new StockCheck_1();
        Object.assign(entity, raw);
        entity.updatedAt = Number(raw.updatedAt);
        entity.createdAt = Number(raw.createdAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => StockCheck_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "createdByUserId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "updatedByUserId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheck.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], StockCheck.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.OneToMany)(() => stock_check_item_entity_1.default, (stockCheckItem) => stockCheckItem.stockCheck),
    __metadata("design:type", Array)
], StockCheck.prototype, "stockCheckItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'createdByUserId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _a : Object)
], StockCheck.prototype, "createdByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => user_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'updatedByUserId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof user_entity_1.default !== "undefined" && user_entity_1.default) === "function" ? _b : Object)
], StockCheck.prototype, "updatedByUser", void 0);
StockCheck = StockCheck_1 = __decorate([
    (0, typeorm_1.Entity)('StockCheck'),
    (0, typeorm_1.Index)('IDX_StockCheck__oid_createdAt', ['oid', 'createdAt'])
], StockCheck);
exports["default"] = StockCheck;


/***/ }),
/* 88 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var StockCheckItem_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const batch_entity_1 = __webpack_require__(56);
const product_entity_1 = __webpack_require__(57);
const stock_check_entity_1 = __webpack_require__(87);
let StockCheckItem = StockCheckItem_1 = class StockCheckItem {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new StockCheckItem_1();
        Object.assign(entity, raw);
        entity.systemQuantity = Number(raw.systemQuantity);
        entity.actualQuantity = Number(raw.actualQuantity);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => StockCheckItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "stockCheckId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "productId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "batchId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "systemQuantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'decimal',
        default: 0,
        precision: 10,
        scale: 3,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "actualQuantity", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "systemCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], StockCheckItem.prototype, "actualCostAmount", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, nullable: true }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], StockCheckItem.prototype, "note", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)(() => stock_check_entity_1.default, (stockCheck) => stockCheck.stockCheckItemList, {
        createForeignKeyConstraints: false,
    }),
    (0, typeorm_1.JoinColumn)({ name: 'stockCheckId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_a = typeof stock_check_entity_1.default !== "undefined" && stock_check_entity_1.default) === "function" ? _a : Object)
], StockCheckItem.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => product_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'productId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_b = typeof product_entity_1.default !== "undefined" && product_entity_1.default) === "function" ? _b : Object)
], StockCheckItem.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.ManyToOne)((type) => batch_entity_1.default, { createForeignKeyConstraints: false }),
    (0, typeorm_1.JoinColumn)({ name: 'batchId', referencedColumnName: 'id' }),
    __metadata("design:type", typeof (_c = typeof batch_entity_1.default !== "undefined" && batch_entity_1.default) === "function" ? _c : Object)
], StockCheckItem.prototype, "batch", void 0);
StockCheckItem = StockCheckItem_1 = __decorate([
    (0, typeorm_1.Entity)('StockCheckItem'),
    (0, typeorm_1.Index)('IDX_StockCheckItem__oid_stockCheckId', ['oid', 'stockCheckId'])
], StockCheckItem);
exports["default"] = StockCheckItem;


/***/ }),
/* 89 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var RadiologySample_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let RadiologySample = RadiologySample_1 = class RadiologySample {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new RadiologySample_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => RadiologySample_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], RadiologySample.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], RadiologySample.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], RadiologySample.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], RadiologySample.prototype, "userId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], RadiologySample.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ default: 0 }),
    __metadata("design:type", Number)
], RadiologySample.prototype, "printHtmlId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    __metadata("design:type", String)
], RadiologySample.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], RadiologySample.prototype, "description", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], RadiologySample.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], RadiologySample.prototype, "customStyles", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], RadiologySample.prototype, "customVariables", void 0);
RadiologySample = RadiologySample_1 = __decorate([
    (0, typeorm_1.Entity)('RadiologySample')
], RadiologySample);
exports["default"] = RadiologySample;


/***/ }),
/* 90 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Surcharge_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let Surcharge = Surcharge_1 = class Surcharge {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Surcharge_1();
        Object.assign(entity, raw);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Surcharge_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], Surcharge.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], Surcharge.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 50 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Surcharge.prototype, "code", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Surcharge.prototype, "name", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: 1 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Surcharge.prototype, "isActive", void 0);
Surcharge = Surcharge_1 = __decorate([
    (0, typeorm_1.Entity)('Surcharge'),
    (0, typeorm_1.Unique)('UNIQUE_Surcharge__oid_code', ['oid', 'code'])
], Surcharge);
exports["default"] = Surcharge;


/***/ }),
/* 91 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketExpense_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const expense_entity_1 = __webpack_require__(78);
let TicketExpense = TicketExpense_1 = class TicketExpense extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketExpense_1();
        Object.assign(entity, raw);
        entity.money = Number(raw.money);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketExpense_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketExpense.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketExpense.prototype, "expenseId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketExpense.prototype, "money", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof expense_entity_1.default !== "undefined" && expense_entity_1.default) === "function" ? _a : Object)
], TicketExpense.prototype, "expense", void 0);
TicketExpense = TicketExpense_1 = __decorate([
    (0, typeorm_1.Entity)('TicketExpense'),
    (0, typeorm_1.Index)('IDX_TicketExpense__ticketId', ['oid', 'ticketId'])
], TicketExpense);
exports["default"] = TicketExpense;


/***/ }),
/* 92 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketProcedureItem_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
let TicketProcedureItem = TicketProcedureItem_1 = class TicketProcedureItem {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketProcedureItem_1();
        Object.assign(entity, raw);
        entity.completedAt = raw.completedAt == null ? raw.completedAt : Number(raw.completedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketProcedureItem_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)({ name: 'oid' }),
    (0, class_transformer_1.Exclude)(),
    __metadata("design:type", Number)
], TicketProcedureItem.prototype, "oid", void 0);
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)({ name: 'id' }),
    (0, class_transformer_1.Expose)({ name: 'id' }),
    __metadata("design:type", Number)
], TicketProcedureItem.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedureItem.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedureItem.prototype, "ticketProcedureId", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'smallint', default: variable_1.TicketProcedureStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof variable_1.TicketProcedureStatus !== "undefined" && variable_1.TicketProcedureStatus) === "function" ? _a : Object)
], TicketProcedureItem.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'text', default: '' }),
    (0, class_transformer_1.Expose)({}),
    __metadata("design:type", String)
], TicketProcedureItem.prototype, "result", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'varchar', length: 100, default: JSON.stringify([]) }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], TicketProcedureItem.prototype, "imageIds", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Array)
], TicketProcedureItem.prototype, "imageList", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketProcedureItem.prototype, "completedAt", void 0);
TicketProcedureItem = TicketProcedureItem_1 = __decorate([
    (0, typeorm_1.Entity)('TicketProcedureItem'),
    (0, typeorm_1.Index)('IDX_TicketProcedureItem__oid_ticketId', ['oid', 'ticketId'])
], TicketProcedureItem);
exports["default"] = TicketProcedureItem;


/***/ }),
/* 93 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TicketSurcharge_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
const base_entity_1 = __webpack_require__(48);
const surcharge_entity_1 = __webpack_require__(90);
let TicketSurcharge = TicketSurcharge_1 = class TicketSurcharge extends base_entity_1.BaseEntity {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new TicketSurcharge_1();
        Object.assign(entity, raw);
        entity.money = Number(raw.money);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => TicketSurcharge_1.fromRaw(i));
    }
};
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketSurcharge.prototype, "ticketId", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: 0 }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketSurcharge.prototype, "surchargeId", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: 0,
        transformer: { to: (value) => value, from: (value) => Number(value) },
    }),
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], TicketSurcharge.prototype, "money", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", typeof (_a = typeof surcharge_entity_1.default !== "undefined" && surcharge_entity_1.default) === "function" ? _a : Object)
], TicketSurcharge.prototype, "surcharge", void 0);
TicketSurcharge = TicketSurcharge_1 = __decorate([
    (0, typeorm_1.Entity)('TicketSurcharge'),
    (0, typeorm_1.Index)('IDX_TicketSurcharge__ticketId', ['oid', 'ticketId'])
], TicketSurcharge);
exports["default"] = TicketSurcharge;


/***/ }),
/* 94 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var Warehouse_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
const typeorm_1 = __webpack_require__(18);
let Warehouse = Warehouse_1 = class Warehouse {
    static fromRaw(raw) {
        if (!raw)
            return null;
        const entity = new Warehouse_1();
        Object.assign(entity, raw);
        entity.updatedAt = raw.updatedAt == null ? raw.updatedAt : Number(raw.updatedAt);
        entity.deletedAt = raw.deletedAt == null ? raw.deletedAt : Number(raw.deletedAt);
        return entity;
    }
    static fromRaws(raws) {
        return raws.map((i) => Warehouse_1.fromRaw(i));
    }
};
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)(),
    __metadata("design:type", Number)
], Warehouse.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.PrimaryGeneratedColumn)(),
    __metadata("design:type", Number)
], Warehouse.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255 }),
    __metadata("design:type", String)
], Warehouse.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        default: () => '(EXTRACT(epoch FROM now()) * (1000))',
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Warehouse.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, typeorm_1.Column)({
        type: 'bigint',
        nullable: true,
        transformer: {
            to: (value) => value,
            from: (value) => (value == null ? value : Number(value)),
        },
    }),
    __metadata("design:type", Number)
], Warehouse.prototype, "deletedAt", void 0);
Warehouse = Warehouse_1 = __decorate([
    (0, typeorm_1.Entity)('Warehouse')
], Warehouse);
exports["default"] = Warehouse;


/***/ }),
/* 95 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports._PostgreSqlManager = void 0;
const postgresql_raw_1 = __webpack_require__(96);
class _PostgreSqlManager extends postgresql_raw_1.PostgreSqlRaw {
    constructor(entity) {
        super();
        this.entity = entity;
    }
    async findMany(manager, options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await manager.find(this.entity, {
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            take: options.limit,
            order,
        });
    }
    async findManyBy(manager, condition) {
        const where = this.getWhereOptions(condition);
        return await manager.findBy(this.entity, where);
    }
    async findOne(manager, options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await manager.findOne(this.entity, {
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'join',
            where,
            order,
        });
    }
    async findOneBy(manager, condition) {
        const where = this.getWhereOptions(condition);
        return await manager.findOneBy(this.entity, where);
    }
    async insertMany(manager, data) {
        if (!data.length)
            return [];
        const insertResult = await manager.insert(this.entity, data);
        const idList = insertResult.identifiers.map((i) => i.id);
        return idList;
    }
    async insertManyFullField(manager, data) {
        if (!data.length)
            return [];
        return this.insertMany(manager, data);
    }
    async insertManyAndReturnRaws(manager, data) {
        if (!data.length)
            return [];
        const insertResult = await manager
            .createQueryBuilder()
            .insert()
            .into(this.entity)
            .values(data)
            .returning('*')
            .execute();
        const raws = insertResult.raw;
        return raws;
    }
    async insertManyAndReturnEntity(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return this.entity.fromRaws(raws);
    }
    async insertManyFullFieldAndReturnRaws(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return raws;
    }
    async insertManyFullFieldAndReturnEntity(manager, data) {
        const raws = await this.insertManyAndReturnRaws(manager, data);
        return this.entity.fromRaws(raws);
    }
    async insertOne(manager, data) {
        const insertResult = await manager.insert(this.entity, data);
        const id = insertResult.identifiers[0].id;
        if (!id) {
            console.log(`Insert ${this.entity['name']} failed, insertResult: `, insertResult);
            console.log(`Insert ${this.entity['name']} failed, data: `, data);
            throw new Error(`Insert ${this.entity['name']} failed: insertResult.identifiers[0] = ${insertResult.identifiers[0]}`);
        }
        return id;
    }
    async insertOneFullField(manager, data) {
        const id = this.insertOne(manager, data);
        return id;
    }
    async insertOneAndReturnRaw(manager, data) {
        var _a;
        const insertResult = await manager
            .createQueryBuilder()
            .insert()
            .into(this.entity)
            .values(data)
            .returning('*')
            .execute();
        if (((_a = insertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== 1) {
            console.log(`Insert ${this.entity['name']} failed, insertResult.raw: `, insertResult.raw);
            console.log(`Insert ${this.entity['name']} failed, data: `, data);
            throw new Error(`Insert ${this.entity['name']} failed: raws.length = ${insertResult.raw.length}`);
        }
        return insertResult.raw[0];
    }
    async insertOneAndReturnEntity(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return this.entity.fromRaw(raw);
    }
    async insertOneFullFieldAndReturnRaw(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return raw;
    }
    async insertOneFullFieldAndReturnEntity(manager, data) {
        const raw = await this.insertOneAndReturnRaw(manager, data);
        return this.entity.fromRaw(raw);
    }
    async update(manager, condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await manager.update(this.entity, where, data);
        return updateResult.affected;
    }
    async updateAndReturnRaw(manager, condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await manager
            .createQueryBuilder()
            .update(this.entity)
            .where(where)
            .set(data)
            .returning('*')
            .execute();
        const raws = updateResult.raw;
        return raws;
    }
    async updateAndReturnEntity(manager, condition, data) {
        const raws = await this.updateAndReturnRaw(manager, condition, data);
        return this.entity.fromRaws(raws);
    }
    async updateOneAndReturnEntity(manager, condition, data) {
        const raws = await this.updateAndReturnRaw(manager, condition, data);
        if (raws.length !== 1) {
            console.log(`Update ${this.entity['name']} failed, raws: `, raws);
            throw new Error(`Update ${this.entity['name']} failed: raws.length = ${raws.length}`);
        }
        return this.entity.fromRaw(raws[0]);
    }
    async upsertByConflictUnique(options) {
        var _a, _b;
        const { manager, upsertList, updateFields, conflictFields } = options;
        const upsertResult = await manager
            .createQueryBuilder()
            .insert()
            .values(upsertList)
            .orUpdate(updateFields, conflictFields)
            .execute();
        if (((_a = upsertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== upsertList.length) {
            console.log(`Insert ${this.entity['name']} failed, upsertResult: `, upsertResult);
            console.log(`Insert ${this.entity['name']} failed, upsertList: `, upsertList);
            throw new Error(`Insert ${this.entity['name']} failed: `
                + `upsertResult.raw?.length = ${(_b = upsertResult.raw) === null || _b === void 0 ? void 0 : _b.length}`
                + `upsertList.length = ${upsertList.length}`);
        }
        return this.entity.fromRaws(upsertResult.raw);
    }
    async delete(manager, condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await manager.delete(this.entity, where);
        const affected = deleteResult.affected;
        return affected;
    }
    async deleteAndReturnRaw(manager, condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await manager
            .createQueryBuilder()
            .delete()
            .from(this.entity)
            .where(where)
            .returning('*')
            .execute();
        const raws = deleteResult.raw;
        return raws;
    }
    async deleteAndReturnEntity(manager, condition) {
        const raws = await this.deleteAndReturnRaw(manager, condition);
        return this.entity.fromRaws(raws);
    }
    async deleteOneAndReturnEntity(manager, condition) {
        const raws = await this.deleteAndReturnRaw(manager, condition);
        if (raws.length !== 1) {
            console.log(`Delete ${this.entity['name']} failed, raws: `, raws);
            throw new Error(`Delete ${this.entity['name']} failed: raws.length = ${raws.length}`);
        }
        return this.entity.fromRaw(raws[0]);
    }
    async bulkUpdate(options) {
        var _a;
        const { manager } = options;
        const tableName = this.entity['name'];
        const tempList = options.tempList || [];
        if (!tempList.length)
            return [];
        let compareName = [];
        let compareObject = {};
        let conditionRaw = '';
        if (options.condition) {
            conditionRaw = this.getRawConditions(tableName, options.condition);
        }
        if (Array.isArray(options.compare)) {
            compareName = [...options.compare];
            options.compare.forEach((field) => {
                compareObject[field] = true;
            });
        }
        else {
            compareName = Object.keys(options.compare);
            compareObject = Object.assign({}, options.compare);
        }
        let updateName = [];
        let updateObject = {};
        if (Array.isArray(options.update)) {
            updateName = [...options.update];
            options.update.forEach((field) => {
                updateObject[field] = true;
            });
        }
        else {
            updateName = Object.keys(options.update);
            updateObject = Object.assign({}, options.update);
        }
        if (!updateName.length)
            return [];
        const tempColumns = Object.keys(tempList[0]);
        const modifiedRaw = await manager.query(`
      UPDATE  "${tableName}"
      SET     ${updateName.map((field) => {
            if (typeof updateObject[field] === 'function') {
                return `"${field}" = ${updateObject[field]('temp', tableName)}`;
            }
            else if (typeof updateObject[field] === 'object') {
                return `"${field}" = "temp"."${field}"::${updateObject[field].cast}`;
            }
            else {
                return `"${field}" = "temp"."${field}"`;
            }
        }).join(`,
              `)}
      FROM (VALUES `
            + tempList
                .map((record) => {
                return `(${tempColumns
                    .map((field) => {
                    if (record[field] === null) {
                        return `NULL`;
                    }
                    else if (typeof record[field] === 'number') {
                        return `${record[field]}`;
                    }
                    else if (typeof record[field] === 'string') {
                        return `'${record[field]}'`;
                    }
                    else {
                        return `${record[field]}`;
                    }
                })
                    .join(', ')})`;
            })
                .join(', ')
            + `) 
          AS temp(${tempColumns.map((field) => `"${field}"`).join(', ')})
      WHERE   ${conditionRaw
                ? conditionRaw
                    + ` 
          AND `
                : ''}${compareName.map((field) => {
                if (typeof compareObject[field] !== 'function') {
                    return `"${tableName}"."${field}" = "temp"."${field}"`;
                }
                else {
                    return `"${tableName}"."${field}" = ${compareObject[field]('temp', tableName)}`;
                }
            }).join(` 
          AND `)}
      RETURNING "${tableName}".*;
      `);
        if ((_a = options.options) === null || _a === void 0 ? void 0 : _a.requireEqualLength) {
            if (modifiedRaw[0].length !== tempList.length) {
                console.log(`Update ${tableName} failed, modifiedRaw: `, modifiedRaw);
                console.log(`Update ${tableName} failed, tempList: `, tempList);
                throw new Error(`Update ${tableName} failed: `
                    + `modifiedRaw[0].length = ${modifiedRaw[0].length}`
                    + `tempList.length = ${tempList.length}`);
            }
        }
        return this.entity.fromRaws(modifiedRaw[0]);
    }
}
exports._PostgreSqlManager = _PostgreSqlManager;


/***/ }),
/* 96 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgreSqlRaw = void 0;
const typeorm_1 = __webpack_require__(18);
const base_condition_1 = __webpack_require__(97);
const _CONVERT = (value) => {
    if (typeof value === 'boolean' && value)
        return `TRUE`;
    if (typeof value === 'boolean' && !value)
        return `FALSE`;
    if (typeof value === 'number')
        return `${value}`;
    if (typeof value === 'string')
        return `'${value}'`;
    return '';
};
class PostgreSqlRaw {
    getRawConditions(tableName, conditions = {}) {
        const conditionArray = Object.entries(conditions).map(([column, target]) => {
            if (column === '$OR') {
                const conditionOr = target.map((i) => this.getRawConditions(i));
                return `(${conditionOr.join(' OR ')})`;
            }
            if (target === undefined)
                return;
            if (target == null)
                return `"${tableName}"."${column}" IS NULL`;
            if (['number', 'string', 'boolean'].includes(typeof target)) {
                return `"${tableName}"."${column}" = ${_CONVERT(target)}`;
            }
            if (typeof target === 'object') {
                if (Object.keys(target).length === 0)
                    return;
                const ruleArray = Object.entries(target).map(([rule, value]) => {
                    if (value == null)
                        return;
                    if (rule === '>' || rule === 'GT') {
                        return `"${tableName}"."${column}" > ${_CONVERT(value)}`;
                    }
                    if (rule === '>=' || rule === 'GTE') {
                        return `"${tableName}"."${column}" >= ${_CONVERT(value)}`;
                    }
                    if (rule === '<' || rule === 'LT') {
                        return `"${tableName}"."${column}" < ${_CONVERT(value)}`;
                    }
                    if (rule === '<=' || rule === 'LTE') {
                        return `"${tableName}"."${column}" <= ${_CONVERT(value)}`;
                    }
                    if (rule === '==' || rule === 'EQUAL') {
                        return `"${tableName}"."${column}" = ${_CONVERT(value)}`;
                    }
                    if (rule === '!=' || rule === 'NOT') {
                        return `"${tableName}"."${column}" != ${_CONVERT(value)}`;
                    }
                    if (rule === 'IS_NULL') {
                        if (value === true)
                            return `"${tableName}"."${column}" IS NULL`;
                        if (value === false)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                    }
                    if (rule === 'NOT_NULL') {
                        if (value === true)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                        if (value === false)
                            return `"${tableName}"."${column}" IS NULL`;
                    }
                    if (rule === 'BETWEEN') {
                        return `"${tableName}"."${column}" BETWEEN ${_CONVERT(value[0])} AND ${_CONVERT(value[1])}`;
                    }
                    if (rule === 'IN') {
                        if (value.length === 0)
                            return `"${tableName}"."${column}" IS NULL`;
                        const temp = value.map((i) => _CONVERT(i)).join(',');
                        return `"${tableName}"."${column}" IN (${temp})`;
                    }
                    if (rule === 'NOT_IN') {
                        if (value.length === 0)
                            return `"${tableName}"."${column}" IS NOT NULL`;
                        const temp = value.map((i) => _CONVERT(i)).join(',');
                        return `"${tableName}"."${column}" NOT IN (${temp})`;
                    }
                    if (rule === 'LIKE') {
                        return `"${tableName}"."${column}" LIKE %${(0, base_condition_1.escapeSearch)(value)}%`;
                    }
                    if (rule === 'RAW_QUERY') {
                        return value;
                    }
                });
                return `(${ruleArray.join(' AND ')})`;
            }
        });
        return conditionArray.join(' AND ');
    }
    getConditions(conditions = {}) {
        const where = {};
        Object.entries(conditions).forEach(([column, target]) => {
            if (target === undefined)
                return;
            if (target == null)
                return (where[column] = (0, typeorm_1.IsNull)());
            if (['number', 'string', 'boolean'].includes(typeof target)) {
                return (where[column] = target);
            }
            if (typeof target === 'object') {
                if (Object.keys(target).length === 0)
                    return;
                const operators = [];
                Object.entries(target).forEach(([rule, value]) => {
                    if (value == null)
                        return;
                    if (rule === '>' || rule === 'GT') {
                        return operators.push((0, typeorm_1.MoreThan)(value));
                    }
                    if (rule === '>=' || rule === 'GTE') {
                        return operators.push((0, typeorm_1.MoreThanOrEqual)(value));
                    }
                    if (rule === '<' || rule === 'LT') {
                        return operators.push((0, typeorm_1.LessThan)(value));
                    }
                    if (rule === '<=' || rule === 'LTE') {
                        return operators.push((0, typeorm_1.LessThanOrEqual)(value));
                    }
                    if (rule === '==' || rule === 'EQUAL') {
                        return operators.push((0, typeorm_1.Equal)(value));
                    }
                    if (rule === '!=' || rule === 'NOT') {
                        return operators.push((0, typeorm_1.Not)(value));
                    }
                    if (rule === 'IS_NULL') {
                        if (value === true)
                            return operators.push((0, typeorm_1.IsNull)());
                        if (value === false)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                    }
                    if (rule === 'NOT_NULL') {
                        if (value === true)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                        if (value === false)
                            return operators.push((0, typeorm_1.IsNull)());
                    }
                    if (rule === 'BETWEEN') {
                        return operators.push((0, typeorm_1.Between)(value[0], value[1]));
                    }
                    if (rule === 'IN') {
                        if (value.length === 0)
                            return operators.push((0, typeorm_1.IsNull)());
                        return operators.push((0, typeorm_1.In)(value));
                    }
                    if (rule === 'NOT_IN') {
                        if (value.length === 0)
                            return operators.push((0, typeorm_1.Not)((0, typeorm_1.IsNull)()));
                        return operators.push((0, typeorm_1.Not)((0, typeorm_1.In)(value)));
                    }
                    if (rule === 'LIKE') {
                        const textLike = `%${(0, base_condition_1.escapeSearch)(value)}%`;
                        return operators.push((0, typeorm_1.Like)(textLike));
                    }
                    if (rule === 'RAW_QUERY') {
                        return operators.push((0, typeorm_1.Raw)((alias) => `(${value})`));
                    }
                });
                if (operators.length === 1) {
                    where[column] = operators[0];
                }
                else if (operators.length > 1) {
                    where[column] = (0, typeorm_1.And)(...operators);
                }
            }
        });
        return where;
    }
    getWhereOptions(condition = {}) {
        if (Object.keys(condition).length === 0)
            return {};
        const { $OR } = condition, otherCondition = __rest(condition, ["$OR"]);
        if ($OR && $OR.length) {
            const conditionOr = [];
            $OR.forEach((i) => {
                if (!Object.keys(i).length)
                    return;
                conditionOr.push(this.getWhereOptions(Object.assign(Object.assign({}, otherCondition), i)));
            });
            conditionOr.flat().filter((i) => Object.keys(i).length);
            if (conditionOr.length === 0) {
                return this.getConditions(otherCondition);
            }
            else if (conditionOr.length === 1) {
                return conditionOr[0];
            }
            else {
                return conditionOr;
            }
        }
        else {
            return this.getConditions(otherCondition);
        }
    }
    getOperatorRaw(operator) {
        if (operator.ADD) {
            const str = operator.ADD.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('+');
            return `(${str})`;
        }
        if (operator.SUB) {
            const str = operator.SUB.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('-');
            return `(${str})`;
        }
        if (operator.MUL) {
            const str = operator.MUL.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('*');
            return `(${str})`;
        }
        if (operator.DIV) {
            const str = operator.DIV.map((i) => {
                if (typeof i === 'string')
                    return `"${i}"`;
                if (typeof i === 'number')
                    return `${i}`;
                if (typeof i === 'object') {
                    return this.getOperatorRaw(i);
                }
            }).join('/');
            return `(${str})`;
        }
    }
}
exports.PostgreSqlRaw = PostgreSqlRaw;


/***/ }),
/* 97 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.escapeSearch = void 0;
const escapeSearch = (str = '') => {
    return str.replace(/[?%\\_]/gi, (x) => '\\' + x);
};
exports.escapeSearch = escapeSearch;


/***/ }),
/* 98 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports._PostgreSqlRepository = void 0;
const postgresql_raw_1 = __webpack_require__(96);
class _PostgreSqlRepository extends postgresql_raw_1.PostgreSqlRaw {
    constructor(entity, repository) {
        super();
        this.entity = entity;
        this.repository = repository;
    }
    getManager() {
        return this.repository.manager;
    }
    async getMaxId() {
        const queryResult = await this.repository.query(`SELECT last_value FROM "${this.entity['name']}_id_seq"`);
        return Number(queryResult[0].last_value);
    }
    async pagination(options) {
        const { limit, page, condition } = options;
        const where = this.getWhereOptions(condition);
        const order = options.sort;
        const relations = options.relation;
        const [data, total] = await this.repository.findAndCount({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            order,
            take: limit,
            skip: (page - 1) * limit,
        });
        return { total, page, limit, data };
    }
    async findMany(options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await this.repository.find({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'query',
            where,
            take: options.limit,
            order,
        });
    }
    async findManyBy(condition) {
        const where = this.getWhereOptions(condition);
        return await this.repository.findBy(where);
    }
    async findManyByIds(ids) {
        if (!ids.length)
            return [];
        return await this.findManyBy({ id: { IN: ids } });
    }
    async findOne(options) {
        const where = this.getWhereOptions(options.condition);
        const order = options.sort;
        const relations = options.relation;
        return await this.repository.findOne({
            relations,
            relationLoadStrategy: options.relationLoadStrategy || 'join',
            where,
            order,
        });
    }
    async findOneBy(condition) {
        const where = this.getWhereOptions(condition);
        return await this.repository.findOneBy(where);
    }
    async findOneById(id) {
        return await this.findOneBy({ id });
    }
    async countBy(condition) {
        const where = this.getWhereOptions(condition);
        const number = await this.repository.countBy(where);
        return number;
    }
    async insertMany(data) {
        if (!data.length)
            return [];
        const insertResult = await this.repository.insert(data);
        const idList = insertResult.identifiers.map((i) => i.id);
        return idList;
    }
    async insertManyFullField(data) {
        if (!data.length)
            return [];
        return this.insertMany(data);
    }
    async insertManyAndReturnRaws(data) {
        if (!data.length)
            return [];
        const insertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(data)
            .returning('*')
            .execute();
        const raws = insertResult.raw;
        return raws;
    }
    async insertManyAndReturnEntity(data) {
        const raws = await this.insertManyAndReturnRaws(data);
        return this.entity.fromRaws(raws);
    }
    async insertManyFullFieldAndReturnRaws(data) {
        if (!data.length)
            return [];
        const raws = this.insertManyAndReturnRaws(data);
        return raws;
    }
    async insertManyFullFieldAndReturnEntity(data) {
        if (!data.length)
            return [];
        const raws = await this.insertManyAndReturnRaws(data);
        return this.entity.fromRaws(raws);
    }
    async insertOne(data) {
        const insertResult = await this.repository.insert(data);
        const id = insertResult.identifiers[0].id;
        if (!id) {
            console.log(`Insert ${this.entity['name']} failed, insertResult: `, insertResult);
            console.log(`Insert ${this.entity['name']} failed, data: `, data);
            throw new Error(`Insert ${this.entity['name']} failed: insertResult.identifiers[0] = ${insertResult.identifiers[0]}`);
        }
        return id;
    }
    async insertOneFullField(data) {
        const id = this.insertOne(data);
        return id;
    }
    async insertOneAndReturnRaw(data) {
        var _a;
        const insertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(data)
            .returning('*')
            .execute();
        if (((_a = insertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== 1) {
            console.log(`Insert ${this.entity['name']} failed, insertResult.raw: `, insertResult.raw);
            console.log(`Insert ${this.entity['name']} failed, data: `, data);
            throw new Error(`Insert ${this.entity['name']} failed: raws.length = ${insertResult.raw.length}`);
        }
        return insertResult.raw[0];
    }
    async insertOneAndReturnEntity(data) {
        const raw = await this.insertOneAndReturnRaw(data);
        return this.entity.fromRaw(raw);
    }
    async insertOneFullFieldAndReturnRaw(data) {
        const raw = this.insertOneAndReturnRaw(data);
        return raw;
    }
    async insertOneFullFieldAndReturnEntity(data) {
        const raw = await this.insertOneAndReturnRaw(data);
        return this.entity.fromRaw(raw);
    }
    async update(condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await this.repository.update(where, data);
        return updateResult.affected;
    }
    async updateAndReturnRaw(condition, data) {
        const where = this.getWhereOptions(condition);
        const updateResult = await this.repository
            .createQueryBuilder()
            .update()
            .where(where)
            .set(data)
            .returning('*')
            .execute();
        const raw = updateResult.raw;
        return raw;
    }
    async updateAndReturnEntity(condition, data) {
        const raws = await this.updateAndReturnRaw(condition, data);
        return this.entity.fromRaws(raws);
    }
    async updateOneAndReturnEntity(condition, data) {
        const raws = await this.updateAndReturnRaw(condition, data);
        if (raws.length !== 1) {
            console.log(`Update ${this.entity['name']} failed, raws: `, raws);
            throw new Error(`Update ${this.entity['name']} failed: raws.length = ${raws.length}`);
        }
        return this.entity.fromRaw(raws[0]);
    }
    async upsertByConflictUnique(options) {
        var _a, _b;
        const { upsertList, updateFields, conflictFields } = options;
        const upsertResult = await this.repository
            .createQueryBuilder()
            .insert()
            .values(upsertList)
            .orUpdate(updateFields, conflictFields)
            .returning('*')
            .execute();
        if (((_a = upsertResult.raw) === null || _a === void 0 ? void 0 : _a.length) !== upsertList.length) {
            console.log(`Insert ${this.entity['name']} failed, upsertResult: `, upsertResult);
            console.log(`Insert ${this.entity['name']} failed, upsertList: `, upsertList);
            throw new Error(`Insert ${this.entity['name']} failed: `
                + `upsertResult.raw?.length = ${(_b = upsertResult.raw) === null || _b === void 0 ? void 0 : _b.length}`
                + `upsertList.length = ${upsertList.length}`);
        }
        return this.entity.fromRaws(upsertResult.raw);
    }
    async delete(condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await this.repository.delete(where);
        return deleteResult.affected;
    }
    async deleteAndReturnRaw(condition) {
        const where = this.getWhereOptions(condition);
        const deleteResult = await this.repository
            .createQueryBuilder()
            .delete()
            .from(this.entity)
            .where(where)
            .returning('*')
            .execute();
        const raws = deleteResult.raw;
        return raws;
    }
    async deleteAndReturnEntity(condition) {
        const raws = await this.deleteAndReturnRaw(condition);
        return this.entity.fromRaws(raws);
    }
    async deleteOneAndReturnEntity(condition) {
        const raws = await this.deleteAndReturnRaw(condition);
        if (raws.length !== 1) {
            console.log(`Delete ${this.entity['name']} failed, raws: `, raws);
            throw new Error(`Delete ${this.entity['name']} failed: raws.length = ${raws.length}`);
        }
        return this.entity.fromRaw(raws[0]);
    }
    async countGroup(options) {
        const { condition, groupBy } = options;
        const where = this.getWhereOptions(condition);
        const groupString = groupBy.map((field) => `"${field}"`).join(', ');
        const query = this.getManager()
            .createQueryBuilder()
            .select('COUNT(*)', 'total')
            .from((qb) => {
            return qb
                .subQuery()
                .select(groupString)
                .from(this.entity, 'h')
                .where(where)
                .groupBy(groupString);
        }, 'temp');
        const totalResponse = await query.getRawOne();
        return Number(totalResponse.total);
    }
    async findAndSelect(options) {
        const { condition, select, aggregate, groupBy, orderBy, page, limit } = options;
        const where = this.getWhereOptions(condition);
        const selectList = [];
        if (select) {
            if (Array.isArray(select)) {
                select.forEach((column) => {
                    selectList.push(`"${column}"`);
                });
            }
            else {
                Object.keys(select).map((column) => {
                    if (select[column]) {
                        selectList.push(`"${column}"`);
                    }
                });
            }
        }
        if (aggregate) {
            Object.keys(aggregate).forEach((customField) => {
                if (aggregate[customField].COUNT) {
                    const column = aggregate[customField].COUNT;
                    if (column === '*') {
                        selectList.push(`COUNT(${column}) AS "${customField}"`);
                    }
                    else {
                        selectList.push(`COUNT("${column}") AS "${customField}"`);
                    }
                }
                else if (aggregate[customField].SUM) {
                    const sumString = aggregate[customField].SUM.map((operator) => {
                        if (typeof operator === 'number') {
                            const column = operator;
                            return `${column}`;
                        }
                        if (typeof operator === 'string') {
                            const column = operator;
                            return `"${column}"`;
                        }
                        if (typeof operator === 'object') {
                            return this.getOperatorRaw(operator);
                        }
                    }).join('+');
                    selectList.push(`SUM(${sumString}) AS "${customField}"`);
                }
            });
        }
        let query = this.repository.createQueryBuilder().select(selectList).where(where);
        if (groupBy && groupBy.length) {
            const groupString = groupBy.map((field) => `"${field}"`).join(', ');
            query = query.groupBy(groupString);
        }
        if (orderBy) {
            Object.keys(orderBy).forEach((column, index) => {
                if (index == 0) {
                    query = query.orderBy(`"${column}"`, orderBy[column]);
                }
                else {
                    query = query.addOrderBy(`"${column}"`, orderBy[column]);
                }
            });
        }
        if (limit) {
            query = query.take(limit);
            if (page) {
                query = query.skip((page - 1) * limit);
            }
        }
        const dataRaws = await query.getRawMany();
        return { dataRaws };
    }
}
exports._PostgreSqlRepository = _PostgreSqlRepository;


/***/ }),
/* 99 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentRepository = exports.AppointmentManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let AppointmentManager = class AppointmentManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Appointment);
    }
};
exports.AppointmentManager = AppointmentManager;
exports.AppointmentManager = AppointmentManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], AppointmentManager);
let AppointmentRepository = class AppointmentRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, appointmentRepository) {
        super(entities_1.Appointment, appointmentRepository);
        this.dataSource = dataSource;
        this.appointmentRepository = appointmentRepository;
    }
};
exports.AppointmentRepository = AppointmentRepository;
exports.AppointmentRepository = AppointmentRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Appointment)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], AppointmentRepository);


/***/ }),
/* 100 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchRepository = exports.BatchManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let BatchManager = class BatchManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Batch);
    }
};
exports.BatchManager = BatchManager;
exports.BatchManager = BatchManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], BatchManager);
let BatchRepository = class BatchRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(batchRepository) {
        super(entities_1.Batch, batchRepository);
        this.batchRepository = batchRepository;
    }
};
exports.BatchRepository = BatchRepository;
exports.BatchRepository = BatchRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Batch)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], BatchRepository);


/***/ }),
/* 101 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceRepository = exports.CustomerSourceManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let CustomerSourceManager = class CustomerSourceManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.CustomerSource);
    }
};
exports.CustomerSourceManager = CustomerSourceManager;
exports.CustomerSourceManager = CustomerSourceManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CustomerSourceManager);
let CustomerSourceRepository = class CustomerSourceRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, customerSourceRepository) {
        super(entities_1.CustomerSource, customerSourceRepository);
        this.dataSource = dataSource;
        this.customerSourceRepository = customerSourceRepository;
    }
};
exports.CustomerSourceRepository = CustomerSourceRepository;
exports.CustomerSourceRepository = CustomerSourceRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.CustomerSource)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], CustomerSourceRepository);


/***/ }),
/* 102 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRepository = exports.CustomerManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let CustomerManager = class CustomerManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Customer);
    }
};
exports.CustomerManager = CustomerManager;
exports.CustomerManager = CustomerManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CustomerManager);
let CustomerRepository = class CustomerRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, customerRepository) {
        super(entities_1.Customer, customerRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.customerRepository = customerRepository;
    }
};
exports.CustomerRepository = CustomerRepository;
exports.CustomerRepository = CustomerRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Customer)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], CustomerRepository);


/***/ }),
/* 103 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DiscountRepository = exports.DiscountManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let DiscountManager = class DiscountManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Discount);
    }
};
exports.DiscountManager = DiscountManager;
exports.DiscountManager = DiscountManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], DiscountManager);
let DiscountRepository = class DiscountRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, discountRepository) {
        super(entities_1.Discount, discountRepository);
        this.dataSource = dataSource;
        this.discountRepository = discountRepository;
    }
};
exports.DiscountRepository = DiscountRepository;
exports.DiscountRepository = DiscountRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Discount)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], DiscountRepository);


/***/ }),
/* 104 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorRepository = exports.DistributorManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let DistributorManager = class DistributorManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Distributor);
    }
};
exports.DistributorManager = DistributorManager;
exports.DistributorManager = DistributorManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], DistributorManager);
let DistributorRepository = class DistributorRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, distributorRepository) {
        super(entities_1.Distributor, distributorRepository);
        this.dataSource = dataSource;
        this.distributorRepository = distributorRepository;
    }
};
exports.DistributorRepository = DistributorRepository;
exports.DistributorRepository = DistributorRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Distributor)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], DistributorRepository);


/***/ }),
/* 105 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ExpenseRepository = exports.ExpenseManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ExpenseManager = class ExpenseManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Expense);
    }
};
exports.ExpenseManager = ExpenseManager;
exports.ExpenseManager = ExpenseManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ExpenseManager);
let ExpenseRepository = class ExpenseRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, expenseRepository) {
        super(entities_1.Expense, expenseRepository);
        this.manager = manager;
        this.expenseRepository = expenseRepository;
    }
};
exports.ExpenseRepository = ExpenseRepository;
exports.ExpenseRepository = ExpenseRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Expense)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ExpenseRepository);


/***/ }),
/* 106 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ICDRepository = exports.ICDManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ICDManager = class ICDManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ICD);
    }
};
exports.ICDManager = ICDManager;
exports.ICDManager = ICDManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ICDManager);
let ICDRepository = class ICDRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, icdRepository) {
        super(entities_1.ICD, icdRepository);
        this.dataSource = dataSource;
        this.icdRepository = icdRepository;
    }
};
exports.ICDRepository = ICDRepository;
exports.ICDRepository = ICDRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ICD)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ICDRepository);


/***/ }),
/* 107 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageRepository = exports.ImageManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ImageManager = class ImageManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Image);
    }
};
exports.ImageManager = ImageManager;
exports.ImageManager = ImageManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ImageManager);
let ImageRepository = class ImageRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, imageRepository) {
        super(entities_1.Image, imageRepository);
        this.dataSource = dataSource;
        this.imageRepository = imageRepository;
    }
};
exports.ImageRepository = ImageRepository;
exports.ImageRepository = ImageRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Image)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ImageRepository);


/***/ }),
/* 108 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupRepository = exports.LaboratoryGroupManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let LaboratoryGroupManager = class LaboratoryGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.LaboratoryGroup);
    }
};
exports.LaboratoryGroupManager = LaboratoryGroupManager;
exports.LaboratoryGroupManager = LaboratoryGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratoryGroupManager);
let LaboratoryGroupRepository = class LaboratoryGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratoryGroupRepository) {
        super(entities_1.LaboratoryGroup, laboratoryGroupRepository);
        this.dataSource = dataSource;
        this.laboratoryGroupRepository = laboratoryGroupRepository;
    }
};
exports.LaboratoryGroupRepository = LaboratoryGroupRepository;
exports.LaboratoryGroupRepository = LaboratoryGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.LaboratoryGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratoryGroupRepository);


/***/ }),
/* 109 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySampleRepository = exports.LaboratorySampleManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let LaboratorySampleManager = class LaboratorySampleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.LaboratorySample);
    }
};
exports.LaboratorySampleManager = LaboratorySampleManager;
exports.LaboratorySampleManager = LaboratorySampleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratorySampleManager);
let LaboratorySampleRepository = class LaboratorySampleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratorySampleRepository) {
        super(entities_1.LaboratorySample, laboratorySampleRepository);
        this.dataSource = dataSource;
        this.laboratorySampleRepository = laboratorySampleRepository;
    }
};
exports.LaboratorySampleRepository = LaboratorySampleRepository;
exports.LaboratorySampleRepository = LaboratorySampleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.LaboratorySample)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratorySampleRepository);


/***/ }),
/* 110 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryRepository = exports.LaboratoryManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let LaboratoryManager = class LaboratoryManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Laboratory);
    }
};
exports.LaboratoryManager = LaboratoryManager;
exports.LaboratoryManager = LaboratoryManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], LaboratoryManager);
let LaboratoryRepository = class LaboratoryRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, laboratoryRepository) {
        super(entities_1.Laboratory, laboratoryRepository);
        this.dataSource = dataSource;
        this.laboratoryRepository = laboratoryRepository;
    }
    async updateChildren(payload) {
        const { oid, laboratoryParent, laboratoryChildrenDtoList } = payload;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const whereTicketDelete = {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(laboratoryChildrenDtoList.map((i) => i.id))),
                parentId: laboratoryParent.id,
                level: 2,
            };
            await manager.delete(entities_1.Laboratory, whereTicketDelete);
            const laboratoryInsertList = laboratoryChildrenDtoList
                .filter((i) => i.id === 0)
                .map((i) => {
                const laboratoryInsert = Object.assign(Object.assign({}, i), { oid, parentId: laboratoryParent.id, laboratoryGroupId: laboratoryParent.laboratoryGroupId, level: 2 });
                return laboratoryInsert;
            });
            if (laboratoryInsertList.length) {
                await manager.insert(entities_1.Laboratory, laboratoryInsertList);
            }
            const laboratoryUpdateList = laboratoryChildrenDtoList
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = Object.assign({}, i);
                return updateDto;
            });
            if (laboratoryUpdateList.length) {
                const laboratoryUpdateResult = await manager.query(`
          UPDATE  "Laboratory" AS "laboratory"
          SET     "priority" = temp.priority,
                  "name" = temp.name,
                  "laboratoryGroupId" = ${laboratoryParent.laboratoryGroupId},
                  "price" = temp.price,
                  "valueType" = temp."valueType",
                  "unit" = temp.unit,
                  "lowValue" = temp."lowValue",
                  "highValue" = temp."highValue",
                  "options" = temp.options
          FROM (VALUES `
                    + laboratoryUpdateList.map((i) => {
                        return `(${i.id}, ${i.priority}, '${i.name}', ${i.price}, 
                    ${i.valueType}, '${i.unit}', ${i.lowValue}, 
                    ${i.highValue}, '${i.options}'
                    )`;
                    }).join(', ')
                    + `   ) AS temp("id", "priority", "name", "price", 
                          "valueType", "unit", "lowValue", 
                          "highValue", "options"
                          )
          WHERE   "laboratory"."id" = temp."id" 
              AND "laboratory"."oid" = ${oid} 
              AND "laboratory"."parentId" = ${laboratoryParent.id} 
              AND "laboratory"."level" = 2
          `);
                if (laboratoryUpdateResult[1] != laboratoryUpdateList.length) {
                    throw new Error(`Update Laboratory children failed, 
            affected = ${laboratoryUpdateResult[1]}`);
                }
            }
            return;
        });
    }
};
exports.LaboratoryRepository = LaboratoryRepository;
exports.LaboratoryRepository = LaboratoryRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Laboratory)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], LaboratoryRepository);


/***/ }),
/* 111 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationRepository = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_repository_1 = __webpack_require__(98);
let OrganizationRepository = class OrganizationRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(organizationRepository) {
        super(entities_1.Organization, organizationRepository);
        this.organizationRepository = organizationRepository;
    }
    async updateDataVersion(oid) {
        const randomNumber = Math.floor(Math.random() * 1000);
        const organization = await this.updateAndReturnEntity({ id: oid }, {
            dataVersion: JSON.stringify({
                product: randomNumber,
                batch: randomNumber,
                customer: randomNumber,
            }),
        });
        return organization;
    }
};
exports.OrganizationRepository = OrganizationRepository;
exports.OrganizationRepository = OrganizationRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Organization)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], OrganizationRepository);


/***/ }),
/* 112 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodRepository = exports.PaymentMethodManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PaymentMethodManager = class PaymentMethodManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PaymentMethod);
    }
};
exports.PaymentMethodManager = PaymentMethodManager;
exports.PaymentMethodManager = PaymentMethodManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PaymentMethodManager);
let PaymentMethodRepository = class PaymentMethodRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, paymentMethodRepository) {
        super(entities_1.PaymentMethod, paymentMethodRepository);
        this.dataSource = dataSource;
        this.paymentMethodRepository = paymentMethodRepository;
    }
};
exports.PaymentMethodRepository = PaymentMethodRepository;
exports.PaymentMethodRepository = PaymentMethodRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PaymentMethod)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PaymentMethodRepository);


/***/ }),
/* 113 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentTicketItemRepository = exports.PaymentTicketItemManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PaymentTicketItemManager = class PaymentTicketItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PaymentTicketItem);
    }
};
exports.PaymentTicketItemManager = PaymentTicketItemManager;
exports.PaymentTicketItemManager = PaymentTicketItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PaymentTicketItemManager);
let PaymentTicketItemRepository = class PaymentTicketItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, paymentTicketItemRepository) {
        super(entities_1.PaymentTicketItem, paymentTicketItemRepository);
        this.dataSource = dataSource;
        this.paymentTicketItemRepository = paymentTicketItemRepository;
    }
};
exports.PaymentTicketItemRepository = PaymentTicketItemRepository;
exports.PaymentTicketItemRepository = PaymentTicketItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PaymentTicketItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PaymentTicketItemRepository);


/***/ }),
/* 114 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentRepository = exports.PaymentManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PaymentManager = class PaymentManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Payment);
    }
};
exports.PaymentManager = PaymentManager;
exports.PaymentManager = PaymentManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PaymentManager);
let PaymentRepository = class PaymentRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, paymentRepository) {
        super(entities_1.Payment, paymentRepository);
        this.dataSource = dataSource;
        this.paymentRepository = paymentRepository;
    }
};
exports.PaymentRepository = PaymentRepository;
exports.PaymentRepository = PaymentRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Payment)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PaymentRepository);


/***/ }),
/* 115 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionRepository = exports.PermissionManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const permission_entity_1 = __webpack_require__(82);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PermissionManager = class PermissionManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(permission_entity_1.default);
    }
};
exports.PermissionManager = PermissionManager;
exports.PermissionManager = PermissionManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PermissionManager);
let PermissionRepository = class PermissionRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(permissionRepository) {
        super(permission_entity_1.default, permissionRepository);
        this.permissionRepository = permissionRepository;
    }
    async upsert(data) {
        const insertResult = await this.permissionRepository
            .createQueryBuilder()
            .insert()
            .into(permission_entity_1.default)
            .values(data)
            .orUpdate(['level', 'code', 'name', 'parentId', 'rootId', 'pathId', 'isActive'], ['id'])
            .execute();
        return { idsEffect: insertResult.identifiers.map((i) => i.id) };
    }
};
exports.PermissionRepository = PermissionRepository;
exports.PermissionRepository = PermissionRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(permission_entity_1.default)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], PermissionRepository);


/***/ }),
/* 116 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PositionRepository = exports.PositionManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PositionManager = class PositionManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Position);
    }
};
exports.PositionManager = PositionManager;
exports.PositionManager = PositionManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PositionManager);
let PositionRepository = class PositionRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, positionRepository) {
        super(entities_1.Position, positionRepository);
        this.dataSource = dataSource;
        this.positionRepository = positionRepository;
    }
};
exports.PositionRepository = PositionRepository;
exports.PositionRepository = PositionRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Position)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PositionRepository);


/***/ }),
/* 117 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleRepository = exports.PrescriptionSampleManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PrescriptionSampleManager = class PrescriptionSampleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PrescriptionSample);
    }
};
exports.PrescriptionSampleManager = PrescriptionSampleManager;
exports.PrescriptionSampleManager = PrescriptionSampleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrescriptionSampleManager);
let PrescriptionSampleRepository = class PrescriptionSampleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, prescriptionSampleRepository) {
        super(entities_1.PrescriptionSample, prescriptionSampleRepository);
        this.dataSource = dataSource;
        this.prescriptionSampleRepository = prescriptionSampleRepository;
    }
};
exports.PrescriptionSampleRepository = PrescriptionSampleRepository;
exports.PrescriptionSampleRepository = PrescriptionSampleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PrescriptionSample)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PrescriptionSampleRepository);


/***/ }),
/* 118 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSettingRepository = exports.PrintHtmlSettingManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PrintHtmlSettingManager = class PrintHtmlSettingManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PrintHtmlSetting);
    }
};
exports.PrintHtmlSettingManager = PrintHtmlSettingManager;
exports.PrintHtmlSettingManager = PrintHtmlSettingManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrintHtmlSettingManager);
let PrintHtmlSettingRepository = class PrintHtmlSettingRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(printHtmlSettingRepository) {
        super(entities_1.PrintHtmlSetting, printHtmlSettingRepository);
        this.printHtmlSettingRepository = printHtmlSettingRepository;
    }
};
exports.PrintHtmlSettingRepository = PrintHtmlSettingRepository;
exports.PrintHtmlSettingRepository = PrintHtmlSettingRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.PrintHtmlSetting)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], PrintHtmlSettingRepository);


/***/ }),
/* 119 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlRepository = exports.PrintHtmlManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PrintHtmlManager = class PrintHtmlManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PrintHtml);
    }
};
exports.PrintHtmlManager = PrintHtmlManager;
exports.PrintHtmlManager = PrintHtmlManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrintHtmlManager);
let PrintHtmlRepository = class PrintHtmlRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(printHtmlRepository) {
        super(entities_1.PrintHtml, printHtmlRepository);
        this.printHtmlRepository = printHtmlRepository;
    }
};
exports.PrintHtmlRepository = PrintHtmlRepository;
exports.PrintHtmlRepository = PrintHtmlRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.PrintHtml)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], PrintHtmlRepository);


/***/ }),
/* 120 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupRepository = exports.ProcedureGroupManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ProcedureGroupManager = class ProcedureGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ProcedureGroup);
    }
};
exports.ProcedureGroupManager = ProcedureGroupManager;
exports.ProcedureGroupManager = ProcedureGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProcedureGroupManager);
let ProcedureGroupRepository = class ProcedureGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, procedureGroupRepository) {
        super(entities_1.ProcedureGroup, procedureGroupRepository);
        this.dataSource = dataSource;
        this.procedureGroupRepository = procedureGroupRepository;
    }
    async replaceAll(oid, data) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.ProcedureGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(data.map((i) => i.id))),
            });
            const procedureGroupInsertDto = data
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = { oid, name: i.name };
                return insertDto;
            });
            if (procedureGroupInsertDto.length) {
                await manager.insert(entities_1.ProcedureGroup, procedureGroupInsertDto);
            }
            const procedureGroupUpdateDto = data
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = { id: i.id, name: i.name };
                return updateDto;
            });
            if (procedureGroupUpdateDto.length) {
                await manager.query(`
          UPDATE "ProcedureGroup" AS "group"
          SET "name" = temp.name
          FROM (VALUES `
                    + procedureGroupUpdateDto.map(({ id, name }) => `(${id}, '${name}')`).join(', ')
                    + `   ) AS temp("id", "name")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.ProcedureGroupRepository = ProcedureGroupRepository;
exports.ProcedureGroupRepository = ProcedureGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProcedureGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProcedureGroupRepository);


/***/ }),
/* 121 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureRepository = exports.ProcedureManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ProcedureManager = class ProcedureManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Procedure);
    }
};
exports.ProcedureManager = ProcedureManager;
exports.ProcedureManager = ProcedureManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProcedureManager);
let ProcedureRepository = class ProcedureRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, procedureRepository) {
        super(entities_1.Procedure, procedureRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.procedureRepository = procedureRepository;
    }
};
exports.ProcedureRepository = ProcedureRepository;
exports.ProcedureRepository = ProcedureRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Procedure)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], ProcedureRepository);


/***/ }),
/* 122 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupRepository = exports.ProductGroupManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ProductGroupManager = class ProductGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ProductGroup);
    }
};
exports.ProductGroupManager = ProductGroupManager;
exports.ProductGroupManager = ProductGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductGroupManager);
let ProductGroupRepository = class ProductGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, productGroupRepository) {
        super(entities_1.ProductGroup, productGroupRepository);
        this.dataSource = dataSource;
        this.productGroupRepository = productGroupRepository;
    }
    async replaceAll(oid, data) {
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            await manager.delete(entities_1.ProductGroup, {
                oid,
                id: (0, typeorm_2.Not)((0, typeorm_2.In)(data.map((i) => i.id))),
            });
            const productGroupInsertDto = data
                .filter((i) => i.id === 0)
                .map((i) => {
                const insertDto = { oid, name: i.name };
                return insertDto;
            });
            if (productGroupInsertDto.length) {
                await manager.insert(entities_1.ProductGroup, productGroupInsertDto);
            }
            const productGroupUpdateDto = data
                .filter((i) => i.id !== 0)
                .map((i) => {
                const updateDto = { id: i.id, name: i.name };
                return updateDto;
            });
            if (productGroupUpdateDto.length) {
                await manager.query(`
          UPDATE "ProductGroup" AS "group"
          SET "name" = temp.name
          FROM (VALUES `
                    + productGroupUpdateDto.map(({ id, name }) => `(${id}, '${name}')`).join(', ')
                    + `   ) AS temp("id", "name")
          WHERE   "group"."id" = temp."id" 
              AND "group"."oid" = ${oid} 
          `);
            }
            return;
        });
    }
};
exports.ProductGroupRepository = ProductGroupRepository;
exports.ProductGroupRepository = ProductGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProductGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProductGroupRepository);


/***/ }),
/* 123 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementRepository = exports.ProductMovementManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ProductMovementManager = class ProductMovementManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.ProductMovement);
    }
};
exports.ProductMovementManager = ProductMovementManager;
exports.ProductMovementManager = ProductMovementManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductMovementManager);
let ProductMovementRepository = class ProductMovementRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, productMovementRepository) {
        super(entities_1.ProductMovement, productMovementRepository);
        this.manager = manager;
        this.productMovementRepository = productMovementRepository;
    }
};
exports.ProductMovementRepository = ProductMovementRepository;
exports.ProductMovementRepository = ProductMovementRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.ProductMovement)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], ProductMovementRepository);


/***/ }),
/* 124 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductRepository = exports.ProductManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let ProductManager = class ProductManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Product);
    }
    async reCalculateQuantityBySumBatchList(options) {
        const { manager, oid, productIdList } = options;
        const resultQuery = await manager.query(`
        UPDATE  "Product" "product" 
        SET     "quantity" = "sbq"."sumQuantity"
        FROM    ( 
                SELECT "productId", SUM("quantity") as "sumQuantity" 
                    FROM "Batch" 
                    WHERE "Batch"."productId" IN (${productIdList.toString()})
                        AND "Batch"."oid" = ${oid}
                    GROUP BY "productId" 
                ) AS "sbq" 
        WHERE   "product"."id" = "sbq"."productId" 
            AND "product"."id" IN (${productIdList.toString()})
            AND "product"."oid" = ${oid}
        RETURNING "product".*
    `);
        return entities_1.Product.fromRaws(resultQuery[0]);
    }
};
exports.ProductManager = ProductManager;
exports.ProductManager = ProductManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], ProductManager);
let ProductRepository = class ProductRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(productRepository) {
        super(entities_1.Product, productRepository);
        this.productRepository = productRepository;
    }
};
exports.ProductRepository = ProductRepository;
exports.ProductRepository = ProductRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Product)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], ProductRepository);


/***/ }),
/* 125 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderItemRepository = exports.PurchaseOrderItemManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PurchaseOrderItemManager = class PurchaseOrderItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PurchaseOrderItem);
    }
};
exports.PurchaseOrderItemManager = PurchaseOrderItemManager;
exports.PurchaseOrderItemManager = PurchaseOrderItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PurchaseOrderItemManager);
let PurchaseOrderItemRepository = class PurchaseOrderItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, purchaseOrderItemRepository) {
        super(entities_1.PurchaseOrderItem, purchaseOrderItemRepository);
        this.manager = manager;
        this.purchaseOrderItemRepository = purchaseOrderItemRepository;
    }
};
exports.PurchaseOrderItemRepository = PurchaseOrderItemRepository;
exports.PurchaseOrderItemRepository = PurchaseOrderItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.PurchaseOrderItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], PurchaseOrderItemRepository);


/***/ }),
/* 126 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderRepository = exports.PurchaseOrderManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const purchase_order_entity_1 = __webpack_require__(54);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let PurchaseOrderManager = class PurchaseOrderManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.PurchaseOrder);
    }
};
exports.PurchaseOrderManager = PurchaseOrderManager;
exports.PurchaseOrderManager = PurchaseOrderManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PurchaseOrderManager);
let PurchaseOrderRepository = class PurchaseOrderRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, purchaseOrderRepository) {
        super(entities_1.PurchaseOrder, purchaseOrderRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.purchaseOrderRepository = purchaseOrderRepository;
    }
    async destroy(params) {
        const { oid, purchaseOrderId } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderDeleteResult = await manager.delete(entities_1.PurchaseOrder, {
                oid,
                id: purchaseOrderId,
                paid: 0,
                status: (0, typeorm_2.In)([purchase_order_entity_1.PurchaseOrderStatus.Draft, purchase_order_entity_1.PurchaseOrderStatus.Cancelled]),
            });
            if (purchaseOrderDeleteResult.affected !== 1) {
                throw new Error(`Delete PurchaseOrder ${purchaseOrderId} failed: Status invalid`);
            }
            await manager.delete(entities_1.PurchaseOrderItem, { oid, purchaseOrderId });
        });
    }
};
exports.PurchaseOrderRepository = PurchaseOrderRepository;
exports.PurchaseOrderRepository = PurchaseOrderRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.PurchaseOrder)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], PurchaseOrderRepository);


/***/ }),
/* 127 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupRepository = exports.RadiologyGroupManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let RadiologyGroupManager = class RadiologyGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.RadiologyGroup);
    }
};
exports.RadiologyGroupManager = RadiologyGroupManager;
exports.RadiologyGroupManager = RadiologyGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RadiologyGroupManager);
let RadiologyGroupRepository = class RadiologyGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, radiologyGroupRepository) {
        super(entities_1.RadiologyGroup, radiologyGroupRepository);
        this.dataSource = dataSource;
        this.radiologyGroupRepository = radiologyGroupRepository;
    }
};
exports.RadiologyGroupRepository = RadiologyGroupRepository;
exports.RadiologyGroupRepository = RadiologyGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.RadiologyGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RadiologyGroupRepository);


/***/ }),
/* 128 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySampleRepository = exports.RadiologySampleManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let RadiologySampleManager = class RadiologySampleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.RadiologySample);
    }
};
exports.RadiologySampleManager = RadiologySampleManager;
exports.RadiologySampleManager = RadiologySampleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RadiologySampleManager);
let RadiologySampleRepository = class RadiologySampleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, radiologySampleRepository) {
        super(entities_1.RadiologySample, radiologySampleRepository);
        this.dataSource = dataSource;
        this.radiologySampleRepository = radiologySampleRepository;
    }
};
exports.RadiologySampleRepository = RadiologySampleRepository;
exports.RadiologySampleRepository = RadiologySampleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.RadiologySample)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RadiologySampleRepository);


/***/ }),
/* 129 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyRepository = exports.RadiologyManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let RadiologyManager = class RadiologyManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Radiology);
    }
};
exports.RadiologyManager = RadiologyManager;
exports.RadiologyManager = RadiologyManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RadiologyManager);
let RadiologyRepository = class RadiologyRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, radiologyRepository) {
        super(entities_1.Radiology, radiologyRepository);
        this.dataSource = dataSource;
        this.radiologyRepository = radiologyRepository;
    }
};
exports.RadiologyRepository = RadiologyRepository;
exports.RadiologyRepository = RadiologyRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Radiology)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RadiologyRepository);


/***/ }),
/* 130 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleRepository = exports.RoleManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let RoleManager = class RoleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Role);
    }
};
exports.RoleManager = RoleManager;
exports.RoleManager = RoleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RoleManager);
let RoleRepository = class RoleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(roleRepository) {
        super(entities_1.Role, roleRepository);
        this.roleRepository = roleRepository;
    }
};
exports.RoleRepository = RoleRepository;
exports.RoleRepository = RoleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Role)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], RoleRepository);


/***/ }),
/* 131 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomRepository = exports.RoomManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let RoomManager = class RoomManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Room);
    }
};
exports.RoomManager = RoomManager;
exports.RoomManager = RoomManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], RoomManager);
let RoomRepository = class RoomRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, roomRepository) {
        super(entities_1.Room, roomRepository);
        this.dataSource = dataSource;
        this.roomRepository = roomRepository;
    }
};
exports.RoomRepository = RoomRepository;
exports.RoomRepository = RoomRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Room)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], RoomRepository);


/***/ }),
/* 132 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingRepository = exports.SettingManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let SettingManager = class SettingManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Setting);
    }
};
exports.SettingManager = SettingManager;
exports.SettingManager = SettingManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], SettingManager);
let SettingRepository = class SettingRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(settingRepository) {
        super(entities_1.Setting, settingRepository);
        this.settingRepository = settingRepository;
    }
    async upsertSetting(options) {
        const { oid, key, data } = options;
        const dto = this.settingRepository.create({ oid, key, data });
        return await this.settingRepository
            .createQueryBuilder()
            .insert()
            .into(entities_1.Setting)
            .values(dto)
            .orUpdate(['data'], ['oid', 'key'])
            .execute();
    }
};
exports.SettingRepository = SettingRepository;
exports.SettingRepository = SettingRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.Setting)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], SettingRepository);


/***/ }),
/* 133 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckItemRepository = exports.StockCheckItemManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let StockCheckItemManager = class StockCheckItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.StockCheckItem);
    }
};
exports.StockCheckItemManager = StockCheckItemManager;
exports.StockCheckItemManager = StockCheckItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], StockCheckItemManager);
let StockCheckItemRepository = class StockCheckItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, stockCheckItemRepository) {
        super(entities_1.StockCheckItem, stockCheckItemRepository);
        this.manager = manager;
        this.stockCheckItemRepository = stockCheckItemRepository;
    }
};
exports.StockCheckItemRepository = StockCheckItemRepository;
exports.StockCheckItemRepository = StockCheckItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.StockCheckItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], StockCheckItemRepository);


/***/ }),
/* 134 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckRepository = exports.StockCheckManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let StockCheckManager = class StockCheckManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.StockCheck);
    }
};
exports.StockCheckManager = StockCheckManager;
exports.StockCheckManager = StockCheckManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], StockCheckManager);
let StockCheckRepository = class StockCheckRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, stockCheckRepository) {
        super(entities_1.StockCheck, stockCheckRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.stockCheckRepository = stockCheckRepository;
    }
};
exports.StockCheckRepository = StockCheckRepository;
exports.StockCheckRepository = StockCheckRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.StockCheck)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], StockCheckRepository);


/***/ }),
/* 135 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SurchargeRepository = exports.SurchargeManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let SurchargeManager = class SurchargeManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Surcharge);
    }
};
exports.SurchargeManager = SurchargeManager;
exports.SurchargeManager = SurchargeManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], SurchargeManager);
let SurchargeRepository = class SurchargeRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, SurchargeRepository) {
        super(entities_1.Surcharge, SurchargeRepository);
        this.manager = manager;
        this.SurchargeRepository = SurchargeRepository;
    }
};
exports.SurchargeRepository = SurchargeRepository;
exports.SurchargeRepository = SurchargeRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Surcharge)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], SurchargeRepository);


/***/ }),
/* 136 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAttributeRepository = exports.TicketAttributeManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketAttributeManager = class TicketAttributeManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketAttribute);
    }
};
exports.TicketAttributeManager = TicketAttributeManager;
exports.TicketAttributeManager = TicketAttributeManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketAttributeManager);
let TicketAttributeRepository = class TicketAttributeRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketAttributeRepository) {
        super(entities_1.TicketAttribute, ticketAttributeRepository);
        this.manager = manager;
        this.ticketAttributeRepository = ticketAttributeRepository;
    }
};
exports.TicketAttributeRepository = TicketAttributeRepository;
exports.TicketAttributeRepository = TicketAttributeRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketAttribute)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketAttributeRepository);


/***/ }),
/* 137 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchRepository = exports.TicketBatchManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketBatchManager = class TicketBatchManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketBatch);
    }
};
exports.TicketBatchManager = TicketBatchManager;
exports.TicketBatchManager = TicketBatchManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketBatchManager);
let TicketBatchRepository = class TicketBatchRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketBatchRepository) {
        super(entities_1.TicketBatch, ticketBatchRepository);
        this.manager = manager;
        this.ticketBatchRepository = ticketBatchRepository;
    }
};
exports.TicketBatchRepository = TicketBatchRepository;
exports.TicketBatchRepository = TicketBatchRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketBatch)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketBatchRepository);


/***/ }),
/* 138 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketExpenseRepository = exports.TicketExpenseManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketExpenseManager = class TicketExpenseManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketExpense);
    }
};
exports.TicketExpenseManager = TicketExpenseManager;
exports.TicketExpenseManager = TicketExpenseManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketExpenseManager);
let TicketExpenseRepository = class TicketExpenseRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketExpenseRepository) {
        super(entities_1.TicketExpense, ticketExpenseRepository);
        this.manager = manager;
        this.ticketExpenseRepository = ticketExpenseRepository;
    }
};
exports.TicketExpenseRepository = TicketExpenseRepository;
exports.TicketExpenseRepository = TicketExpenseRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketExpense)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketExpenseRepository);


/***/ }),
/* 139 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGroupRepository = exports.TicketLaboratoryGroupManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketLaboratoryGroupManager = class TicketLaboratoryGroupManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratoryGroup);
    }
    calculatorPaymentMoneyStatus(options) {
        const { ticketLaboratoryList } = options;
        let paymentMoneyStatus = variable_1.PaymentMoneyStatus.NoEffect;
        if (ticketLaboratoryList.every((i) => i.paymentMoneyStatus === variable_1.PaymentMoneyStatus.NoEffect)) {
            paymentMoneyStatus = variable_1.PaymentMoneyStatus.NoEffect;
        }
        const hasPaid = ticketLaboratoryList.some((i) => i.paymentMoneyStatus === variable_1.PaymentMoneyStatus.Paid);
        const hasPending = ticketLaboratoryList.some((i) => i.paymentMoneyStatus === variable_1.PaymentMoneyStatus.Pending);
        if (hasPaid && !hasPending)
            paymentMoneyStatus = variable_1.PaymentMoneyStatus.Paid;
        if (!hasPaid && hasPending)
            paymentMoneyStatus = variable_1.PaymentMoneyStatus.Pending;
        if (hasPaid && hasPending)
            paymentMoneyStatus = variable_1.PaymentMoneyStatus.Partial;
        return { paymentMoneyStatus };
    }
};
exports.TicketLaboratoryGroupManager = TicketLaboratoryGroupManager;
exports.TicketLaboratoryGroupManager = TicketLaboratoryGroupManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryGroupManager);
let TicketLaboratoryGroupRepository = class TicketLaboratoryGroupRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryGroupRepository) {
        super(entities_1.TicketLaboratoryGroup, ticketLaboratoryGroupRepository);
        this.manager = manager;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
    }
};
exports.TicketLaboratoryGroupRepository = TicketLaboratoryGroupRepository;
exports.TicketLaboratoryGroupRepository = TicketLaboratoryGroupRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratoryGroup)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryGroupRepository);


/***/ }),
/* 140 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryResultRepository = exports.TicketLaboratoryResultManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketLaboratoryResultManager = class TicketLaboratoryResultManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratoryResult);
    }
};
exports.TicketLaboratoryResultManager = TicketLaboratoryResultManager;
exports.TicketLaboratoryResultManager = TicketLaboratoryResultManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryResultManager);
let TicketLaboratoryResultRepository = class TicketLaboratoryResultRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryResultRepository) {
        super(entities_1.TicketLaboratoryResult, ticketLaboratoryResultRepository);
        this.manager = manager;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
    }
    async updateResultList(options) {
        const { oid, ticketId, ticketLaboratoryResultDtoList } = options;
        if (!ticketLaboratoryResultDtoList.length)
            return;
        const updateResult = await this.manager.query(`
        UPDATE  "TicketLaboratoryResult"
        SET     "attention" = temp.attention,
                "result" = temp.result
        FROM (VALUES `
            + ticketLaboratoryResultDtoList
                .map((i) => {
                return `(${i.id}, ${i.attention}, '${i.result}')`;
            })
                .join(', ')
            + `   ) AS temp("id", "attention", "result")
        WHERE   "TicketLaboratoryResult"."id"       = temp."id" 
            AND "TicketLaboratoryResult"."oid"      = ${oid} 
            AND "TicketLaboratoryResult"."ticketId" = ${ticketId} 
        RETURNING "TicketLaboratoryResult".*
        `);
        return entities_1.TicketLaboratoryResult.fromRaws(updateResult[0]);
    }
};
exports.TicketLaboratoryResultRepository = TicketLaboratoryResultRepository;
exports.TicketLaboratoryResultRepository = TicketLaboratoryResultRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratoryResult)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryResultRepository);


/***/ }),
/* 141 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryRepository = exports.TicketLaboratoryManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketLaboratoryManager = class TicketLaboratoryManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketLaboratory);
    }
};
exports.TicketLaboratoryManager = TicketLaboratoryManager;
exports.TicketLaboratoryManager = TicketLaboratoryManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketLaboratoryManager);
let TicketLaboratoryRepository = class TicketLaboratoryRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketLaboratoryRepository) {
        super(entities_1.TicketLaboratory, ticketLaboratoryRepository);
        this.manager = manager;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
    }
};
exports.TicketLaboratoryRepository = TicketLaboratoryRepository;
exports.TicketLaboratoryRepository = TicketLaboratoryRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketLaboratory)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketLaboratoryRepository);


/***/ }),
/* 142 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureItemRepository = exports.TicketProcedureItemManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketProcedureItemManager = class TicketProcedureItemManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketProcedureItem);
    }
};
exports.TicketProcedureItemManager = TicketProcedureItemManager;
exports.TicketProcedureItemManager = TicketProcedureItemManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketProcedureItemManager);
let TicketProcedureItemRepository = class TicketProcedureItemRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketProcedureItemRepository) {
        super(entities_1.TicketProcedureItem, ticketProcedureItemRepository);
        this.manager = manager;
        this.ticketProcedureItemRepository = ticketProcedureItemRepository;
    }
};
exports.TicketProcedureItemRepository = TicketProcedureItemRepository;
exports.TicketProcedureItemRepository = TicketProcedureItemRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketProcedureItem)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketProcedureItemRepository);


/***/ }),
/* 143 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureRepository = exports.TicketProcedureManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketProcedureManager = class TicketProcedureManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketProcedure);
    }
};
exports.TicketProcedureManager = TicketProcedureManager;
exports.TicketProcedureManager = TicketProcedureManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketProcedureManager);
let TicketProcedureRepository = class TicketProcedureRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketProcedureRepository) {
        super(entities_1.TicketProcedure, ticketProcedureRepository);
        this.manager = manager;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async updatePriorityList(params) {
        if (!params.updateData.length)
            return;
        const queryUpdateResult = await this.manager.query(`
      UPDATE "TicketProcedure"
      SET "priority" = temp.priority
      FROM (VALUES `
            + params.updateData
                .map(({ id, priority }) => {
                return `(${id}, ${priority})`;
            })
                .join(', ')
            + `   ) AS temp("id", "priority")
      WHERE   "TicketProcedure"."id"  = temp."id" 
          AND "TicketProcedure"."ticketId" = ${params.ticketId} 
          AND "TicketProcedure"."oid" = ${params.oid} 
      RETURNING "TicketProcedure".*; 
      `);
        const ticketProcedureList = entities_1.TicketProcedure.fromRaws(queryUpdateResult[0]);
        return ticketProcedureList;
    }
    async updateQuantityAndDiscount(params) {
        const { oid, ticketId, ticketProcedureList } = params;
        await this.manager.query(`
      UPDATE "TicketProcedure" vp
      SET "discountMoney" = v."discountMoney",
          "discountPercent" = v."discountPercent",
          "discountType" = v."discountType",
          "actualPrice" = v."actualPrice"
      FROM (VALUES `
            + ticketProcedureList
                .map((i) => {
                return (`(${i.id}, ${ticketId}, ${i.procedureId},`
                    + ` ${i.discountMoney}, ${i.discountPercent}, '${i.discountType}', ${i.actualPrice})`);
            })
                .join(', ')
            + `   ) AS v("id", "ticketId", "procedureId", 
                   "discountMoney", "discountPercent", "discountType", "actualPrice"
                  )
      WHERE vp."id" = v."id" AND vp."ticketId" = v."ticketId"
          AND vp."procedureId" = v."procedureId" AND vp."oid" = ${oid};    
      `);
    }
    async topProcedureBestSelling(options) {
        const { condition, orderBy, limit } = options;
        const where = this.getWhereOptions(condition);
        let query = this.manager
            .createQueryBuilder(entities_1.TicketProcedure, 'ticketProcedure')
            .where(where)
            .groupBy('"ticketProcedure"."procedureId"')
            .select('"ticketProcedure"."procedureId"', 'procedureId')
            .addSelect('SUM("ticketProcedure".quantity)', 'sumQuantity')
            .addSelect('SUM("ticketProcedure".quantity * "ticketProcedure"."actualPrice")', 'sumActualAmount')
            .limit(limit);
        if (orderBy === 'sumActualAmount') {
            query = query.orderBy('"sumActualAmount"', 'DESC');
        }
        else if (orderBy === 'sumQuantity') {
            query = query.orderBy('"sumQuantity"', 'DESC');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            procedureId: i.procedureId,
            sumQuantity: Number(i.sumQuantity),
            sumActualAmount: Number(i.sumActualAmount),
        }));
    }
};
exports.TicketProcedureRepository = TicketProcedureRepository;
exports.TicketProcedureRepository = TicketProcedureRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketProcedure)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketProcedureRepository);


/***/ }),
/* 144 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductRepository = exports.TicketProductManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketProductManager = class TicketProductManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketProduct);
    }
    async calculatorDeliveryStatus(options) {
        const { manager, oid, ticketId } = options;
        let { ticketProductList } = options;
        if (!ticketProductList) {
            ticketProductList = await this.findManyBy(manager, { oid, ticketId });
        }
        let deliveryStatus = variable_1.DeliveryStatus.Delivered;
        if (ticketProductList.every((i) => i.deliveryStatus === variable_1.DeliveryStatus.NoStock)) {
            deliveryStatus = variable_1.DeliveryStatus.NoStock;
        }
        if (ticketProductList.some((i) => i.deliveryStatus === variable_1.DeliveryStatus.Pending)) {
            deliveryStatus = variable_1.DeliveryStatus.Pending;
        }
        return { deliveryStatus, ticketProductList };
    }
};
exports.TicketProductManager = TicketProductManager;
exports.TicketProductManager = TicketProductManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketProductManager);
let TicketProductRepository = class TicketProductRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketProductRepository) {
        super(entities_1.TicketProduct, ticketProductRepository);
        this.manager = manager;
        this.ticketProductRepository = ticketProductRepository;
    }
};
exports.TicketProductRepository = TicketProductRepository;
exports.TicketProductRepository = TicketProductRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketProduct)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketProductRepository);


/***/ }),
/* 145 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyRepository = exports.TicketRadiologyManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketRadiologyManager = class TicketRadiologyManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketRadiology);
    }
};
exports.TicketRadiologyManager = TicketRadiologyManager;
exports.TicketRadiologyManager = TicketRadiologyManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketRadiologyManager);
let TicketRadiologyRepository = class TicketRadiologyRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketRadiologyRepository) {
        super(entities_1.TicketRadiology, ticketRadiologyRepository);
        this.manager = manager;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
    }
};
exports.TicketRadiologyRepository = TicketRadiologyRepository;
exports.TicketRadiologyRepository = TicketRadiologyRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketRadiology)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketRadiologyRepository);


/***/ }),
/* 146 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSurchargeRepository = exports.TicketSurchargeManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketSurchargeManager = class TicketSurchargeManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketSurcharge);
    }
};
exports.TicketSurchargeManager = TicketSurchargeManager;
exports.TicketSurchargeManager = TicketSurchargeManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketSurchargeManager);
let TicketSurchargeRepository = class TicketSurchargeRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketSurchargeRepository) {
        super(entities_1.TicketSurcharge, ticketSurchargeRepository);
        this.manager = manager;
        this.ticketSurchargeRepository = ticketSurchargeRepository;
    }
};
exports.TicketSurchargeRepository = TicketSurchargeRepository;
exports.TicketSurchargeRepository = TicketSurchargeRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketSurcharge)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketSurchargeRepository);


/***/ }),
/* 147 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUserRepository = exports.TicketUserManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketUserManager = class TicketUserManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.TicketUser);
    }
};
exports.TicketUserManager = TicketUserManager;
exports.TicketUserManager = TicketUserManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketUserManager);
let TicketUserRepository = class TicketUserRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(manager, ticketUserRepository) {
        super(entities_1.TicketUser, ticketUserRepository);
        this.manager = manager;
        this.ticketUserRepository = ticketUserRepository;
    }
};
exports.TicketUserRepository = TicketUserRepository;
exports.TicketUserRepository = TicketUserRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.TicketUser)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], TicketUserRepository);


/***/ }),
/* 148 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRepository = exports.TicketManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(149);
const entities_1 = __webpack_require__(45);
const ticket_entity_1 = __webpack_require__(59);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let TicketManager = class TicketManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Ticket);
    }
};
exports.TicketManager = TicketManager;
exports.TicketManager = TicketManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketManager);
let TicketRepository = class TicketRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, manager, ticketRepository) {
        super(entities_1.Ticket, ticketRepository);
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketRepository = ticketRepository;
    }
    async countToday(oid) {
        const now = new Date();
        const number = await this.countBy({
            oid,
            registeredAt: {
                GTE: time_helper_1.ESTimer.startOfDate(now, 7).getTime(),
                LTE: time_helper_1.ESTimer.endOfDate(now, 7).getTime(),
            },
        });
        return number;
    }
    async destroy(options) {
        const { oid, ticketId } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const whereTicket = {
                id: ticketId,
                oid,
                status: (0, typeorm_2.In)([ticket_entity_1.TicketStatus.Schedule, ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Cancelled]),
            };
            const ticketDeleteResult = await manager.delete(entities_1.Ticket, whereTicket);
            if (ticketDeleteResult.affected !== 1) {
                throw new Error(`Destroy Ticket ${ticketId} failed: Status invalid`);
            }
            await manager.delete(entities_1.TicketAttribute, { oid, ticketId });
            await manager.delete(entities_1.TicketBatch, { oid, ticketId });
            await manager.delete(entities_1.TicketExpense, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratory, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratoryGroup, { oid, ticketId });
            await manager.delete(entities_1.TicketLaboratoryResult, { oid, ticketId });
            await manager.delete(entities_1.TicketProcedure, { oid, ticketId });
            await manager.delete(entities_1.TicketProduct, { oid, ticketId });
            await manager.delete(entities_1.TicketRadiology, { oid, ticketId });
            await manager.delete(entities_1.TicketSurcharge, { oid, ticketId });
            await manager.delete(entities_1.TicketUser, { oid, ticketId });
        });
    }
    async refreshLaboratoryMoney(options) {
        const { oid, ticketId } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "laboratoryMoney"   = "temp"."sumLaboratoryActualPrice",
                "itemsActualMoney"  = "ticket"."itemsActualMoney" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "totalMoney"        = "ticket"."totalMoney" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "debt"              = "ticket"."debt" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice",
                "profit"            = "ticket"."profit" - "ticket"."laboratoryMoney" 
                                        + temp."sumLaboratoryActualPrice"
        FROM    ( 
                SELECT "ticketId", SUM("actualPrice") as "sumLaboratoryActualPrice"
                    FROM "TicketLaboratory" 
                    WHERE "ticketId" = (${ticketId}) AND "oid" = ${oid}
                    GROUP BY "ticketId" 
                ) AS "temp" 
        WHERE   "ticket"."id" = "temp"."ticketId" 
                    AND "ticket"."oid" = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
    async refreshRadiologyMoney(options) {
        const { oid, ticketId } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "radiologyMoney"    = "temp"."sumRadiologyActualPrice",
                "itemsActualMoney"  = "ticket"."itemsActualMoney" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "totalMoney"        = "ticket"."totalMoney" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "debt"              = "ticket"."debt" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice",
                "profit"            = "ticket"."profit" - "ticket"."radiologyMoney" 
                                        + temp."sumRadiologyActualPrice"
        FROM    ( 
                SELECT "ticketId", SUM("actualPrice") as "sumRadiologyActualPrice"
                    FROM "TicketRadiology" 
                    WHERE "ticketId" = (${ticketId}) AND "oid" = ${oid}
                    GROUP BY "ticketId" 
                ) AS "temp" 
        WHERE   "ticket"."id" = "temp"."ticketId" 
                    AND "ticket"."oid" = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
    async changeLaboratoryMoney(options) {
        const { oid, ticketId, laboratoryMoney } = options;
        const updateResult = await this.manager.query(`
        UPDATE  "Ticket" "ticket" 
        SET     "laboratoryMoney"   = ${laboratoryMoney},
                "itemsActualMoney"  = "itemsActualMoney" - "laboratoryMoney" + ${laboratoryMoney},
                "totalMoney"        = "totalMoney" - "laboratoryMoney" + ${laboratoryMoney},
                "debt"              = "debt" - "laboratoryMoney"  + ${laboratoryMoney},
                "profit"            = "profit" - "laboratoryMoney" + ${laboratoryMoney}
        WHERE   "ticket"."id"       = ${ticketId}
            AND "ticket"."oid"      = ${oid}
        RETURNING ticket.*
    `);
        return entities_1.Ticket.fromRaws(updateResult[0]);
    }
};
exports.TicketRepository = TicketRepository;
exports.TicketRepository = TicketRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __param(2, (0, typeorm_1.InjectRepository)(entities_1.Ticket)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], TicketRepository);


/***/ }),
/* 149 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ESTimer = void 0;
class ESTimer {
}
exports.ESTimer = ESTimer;
ESTimer.startOfDate = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfDate = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.startOfMonth = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCDate(1);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfMonth = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(timeMove.getUTCMonth() + 1, 0);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.startOfYear = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(0, 1);
    timeMove.setUTCHours(0, 0, 0, 0);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.endOfYear = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    timeMove.setUTCMonth(11, 31);
    timeMove.setUTCHours(23, 59, 59, 999);
    const result = new Date(timeMove.getTime() - utcOffset * 60 * 60 * 1000);
    return result;
};
ESTimer.info = (time, utcOffset) => {
    if (typeof time !== 'object')
        time = new Date(time);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    return {
        year: timeMove.getUTCFullYear(),
        month: timeMove.getUTCMonth(),
        date: timeMove.getUTCDate(),
        hour: timeMove.getUTCHours(),
        minute: timeMove.getUTCMinutes(),
        second: timeMove.getUTCSeconds(),
    };
};
ESTimer.textToTime = (text, pattern, utcOffset) => {
    const iFullYear = pattern.indexOf('YYYY');
    const iMonth = pattern.indexOf('MM');
    const iDay = pattern.indexOf('DD');
    const iHour = pattern.indexOf('hh');
    const iMinute = pattern.indexOf('mm');
    const iSecond = pattern.indexOf('ss');
    const iMs = pattern.indexOf('xxx');
    const year = iFullYear !== -1 ? Number(text.slice(iFullYear, iFullYear + 4)) : 0;
    const month = iMonth !== -1 ? Number(text.slice(iMonth, iMonth + 2)) : 0;
    const date = iDay !== -1 ? Number(text.slice(iDay, iDay + 2)) : 0;
    const hour = iHour !== -1 ? Number(text.slice(iHour, iHour + 2)) : 0;
    const minute = iMinute !== -1 ? Number(text.slice(iMinute, iMinute + 2)) : 0;
    const second = iSecond !== -1 ? Number(text.slice(iSecond, iSecond + 2)) : 0;
    const millisecond = iMs !== -1 ? Number(text.slice(iMs, iMs + 3)) : 0;
    const time = new Date();
    time.setUTCFullYear(year);
    time.setUTCMonth(month - 1);
    time.setUTCDate(date);
    time.setUTCHours(hour);
    time.setUTCMinutes(minute);
    time.setUTCSeconds(second);
    time.setMilliseconds(millisecond);
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const timeMove = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    return timeMove;
};
ESTimer.timeToText = (time, pattern = 'DD/MM/YYYY', utcOffset) => {
    if (time == null || time === '')
        return '';
    if (typeof time !== 'object')
        time = new Date(time);
    if (time.toString() === 'Invalid Date')
        return 'Invalid Date';
    if (utcOffset == null)
        utcOffset = time.getTimezoneOffset() / -60;
    const date = new Date(time.getTime() + utcOffset * 60 * 60 * 1000);
    const rules = {
        YYYY: `${date.getUTCFullYear()}`,
        YY: `${date.getUTCFullYear()}`.slice(-2),
        MM: `0${date.getUTCMonth() + 1}`.slice(-2),
        DD: `0${date.getUTCDate()}`.slice(-2),
        hh: `0${date.getUTCHours()}`.slice(-2),
        mm: `0${date.getUTCMinutes()}`.slice(-2),
        ss: `0${date.getUTCSeconds()}`.slice(-2),
        xxx: `00${date.getUTCMilliseconds()}`.slice(-3),
    };
    let text = pattern;
    Object.entries(rules).forEach(([key, value]) => {
        const re = new RegExp(key, 'g');
        text = text.replace(re, value);
    });
    return text;
};


/***/ }),
/* 150 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleRepository = exports.UserRoleManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const user_role_entity_1 = __webpack_require__(22);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let UserRoleManager = class UserRoleManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(user_role_entity_1.default);
    }
};
exports.UserRoleManager = UserRoleManager;
exports.UserRoleManager = UserRoleManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], UserRoleManager);
let UserRoleRepository = class UserRoleRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(userRoleRepository) {
        super(user_role_entity_1.default, userRoleRepository);
        this.userRoleRepository = userRoleRepository;
    }
};
exports.UserRoleRepository = UserRoleRepository;
exports.UserRoleRepository = UserRoleRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(user_role_entity_1.default)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], UserRoleRepository);


/***/ }),
/* 151 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoomRepository = exports.UserRoomManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const user_room_entity_1 = __webpack_require__(24);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let UserRoomManager = class UserRoomManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(user_room_entity_1.default);
    }
};
exports.UserRoomManager = UserRoomManager;
exports.UserRoomManager = UserRoomManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], UserRoomManager);
let UserRoomRepository = class UserRoomRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(userRoomRepository) {
        super(user_room_entity_1.default, userRoomRepository);
        this.userRoomRepository = userRoomRepository;
    }
};
exports.UserRoomRepository = UserRoomRepository;
exports.UserRoomRepository = UserRoomRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(user_room_entity_1.default)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], UserRoomRepository);


/***/ }),
/* 152 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRepository = exports.UserManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let UserManager = class UserManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.User);
    }
};
exports.UserManager = UserManager;
exports.UserManager = UserManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], UserManager);
let UserRepository = class UserRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(userRepository) {
        super(entities_1.User, userRepository);
        this.userRepository = userRepository;
    }
};
exports.UserRepository = UserRepository;
exports.UserRepository = UserRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(entities_1.User)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], UserRepository);


/***/ }),
/* 153 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseRepository = exports.WarehouseManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const _postgresql_manager_1 = __webpack_require__(95);
const _postgresql_repository_1 = __webpack_require__(98);
let WarehouseManager = class WarehouseManager extends _postgresql_manager_1._PostgreSqlManager {
    constructor() {
        super(entities_1.Warehouse);
    }
};
exports.WarehouseManager = WarehouseManager;
exports.WarehouseManager = WarehouseManager = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], WarehouseManager);
let WarehouseRepository = class WarehouseRepository extends _postgresql_repository_1._PostgreSqlRepository {
    constructor(dataSource, warehouseRepository) {
        super(entities_1.Warehouse, warehouseRepository);
        this.dataSource = dataSource;
        this.warehouseRepository = warehouseRepository;
    }
};
exports.WarehouseRepository = WarehouseRepository;
exports.WarehouseRepository = WarehouseRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(entities_1.Warehouse)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], WarehouseRepository);


/***/ }),
/* 154 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.arrayToKeyValue = exports.uniqueArray = exports.ESArray = void 0;
class ESArray {
}
exports.ESArray = ESArray;
ESArray.arrayToKeyValue = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};
ESArray.arrayToKeyArray = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        if (!object[key])
            object[key] = [];
        object[key].push(item);
    });
    return object;
};
ESArray.checkDuplicate = (array, property) => {
    const map = new Map();
    array.forEach((item, index) => {
        const value = item[property];
        if (!map.has(value))
            map.set(value, []);
        map.get(value).push(index);
    });
    const result = [];
    for (const [value, indices] of map.entries()) {
        if (indices.length > 1) {
            result.push({ value, indices });
        }
    }
    return result;
};
ESArray.uniqueArray = (array) => {
    return Array.from(new Set(array));
};
const uniqueArray = (array) => {
    return Array.from(new Set(array));
};
exports.uniqueArray = uniqueArray;
const arrayToKeyValue = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};
exports.arrayToKeyValue = arrayToKeyValue;


/***/ }),
/* 155 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CacheTokenService = void 0;
const common_1 = __webpack_require__(3);
const redis_service_1 = __webpack_require__(38);
let CacheTokenService = class CacheTokenService {
    constructor(redisService) {
        this.redisService = redisService;
    }
    getKey(data) {
        return `TOKEN_${data.oid}_${data.uid}`;
    }
    async getTokenListByKey(key) {
        const value = await this.redisService.get(key);
        const object = JSON.parse(value || '[]');
        return object;
    }
    async setTokenList(key, tokenList) {
        const tokenListRemoveExpires = tokenList.filter((i) => i.refreshExp > Date.now());
        const value = JSON.stringify(tokenListRemoveExpires);
        await this.redisService.set(key, value);
    }
    async addAccessToken(data) {
        const key = this.getKey(data);
        const tokenList = await this.getTokenListByKey(key);
        const tokenListFix = tokenList.filter((i) => i.refreshExp !== data.refreshExp);
        tokenListFix.push(Object.assign(Object.assign({}, data), { online: Date.now() }));
        await this.setTokenList(key, tokenListFix);
    }
    async updateAccessToken(data) {
        const key = this.getKey(data);
        const tokenList = await this.getTokenListByKey(key);
        const currentToken = tokenList.find((i) => i.refreshExp === data.refreshExp);
        if (currentToken) {
            Object.assign(currentToken, Object.assign(Object.assign({}, data), { online: Date.now() }));
        }
        else {
            tokenList.push(Object.assign(Object.assign({}, data), { online: Date.now() }));
        }
        await this.setTokenList(key, tokenList);
    }
    async removeRefreshToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        const tokenListFix = tokenList.filter((i) => i.refreshExp !== options.refreshExp);
        await this.setTokenList(key, tokenListFix);
    }
    async removeAllRefreshToken(options) {
        const key = this.getKey(options);
        await this.setTokenList(key, []);
    }
    async checkAccessToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        const token = tokenList.find((i) => i.accessExp === options.accessExp);
        if (!token)
            return false;
        token.online = Date.now();
        await this.setTokenList(key, tokenList);
        return true;
    }
    async checkRefreshToken(options) {
        const key = this.getKey(options);
        const tokenList = await this.getTokenListByKey(key);
        return tokenList.some((i) => i.refreshExp === options.refreshExp);
    }
    async getTokenList(options) {
        const key = this.getKey(options);
        return this.getTokenListByKey(key);
    }
    async removeAllExcludeRoot() {
        const keys = await this.redisService.getKeys('TOKEN_*');
        const keyRoot = this.getKey({ oid: 1, uid: 1 });
        for (let i = 0; i < keys.length; i++) {
            if (keys[i] === keyRoot)
                continue;
            await this.redisService.del(keys[i]);
        }
    }
};
exports.CacheTokenService = CacheTokenService;
exports.CacheTokenService = CacheTokenService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof redis_service_1.RedisService !== "undefined" && redis_service_1.RedisService) === "function" ? _a : Object])
], CacheTokenService);


/***/ }),
/* 156 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationGuard = exports.OrganizationPermission = exports.ORGANIZATION_GUARD = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
exports.ORGANIZATION_GUARD = 'ORGANIZATION_GUARD';
const OrganizationPermission = (...permissionIds) => {
    return (0, common_1.SetMetadata)(exports.ORGANIZATION_GUARD, permissionIds);
};
exports.OrganizationPermission = OrganizationPermission;
let OrganizationGuard = class OrganizationGuard {
    constructor(reflector, cacheDataService) {
        this.reflector = reflector;
        this.cacheDataService = cacheDataService;
    }
    async canActivate(context) {
        const requireOrganizationPermission = this.reflector.getAllAndOverride(exports.ORGANIZATION_GUARD, [context.getHandler(), context.getClass()]);
        if (requireOrganizationPermission === undefined)
            return true;
        const request = context.switchToHttp().getRequest();
        const requestExternal = request.raw;
        const { external } = requestExternal;
        if (external.error) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!external.uid || !external.oid || !external.user || !external.organization) {
            throw new exception_filter_1.BusinessException('common.AccountRequired', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!!external.user.deletedAt || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (external.oid === 1)
            return true;
        const permissionMap = await this.cacheDataService.getPermissionAllMap();
        const checkPermissionId = (permissionId) => {
            const permission = permissionMap[permissionId];
            const pathIdArr = permission.pathId.split('.').map((i) => Number(i));
            for (let i = 0; i < pathIdArr.length; i++) {
                const id = pathIdArr[i];
                const curPermission = permissionMap[id];
                if (!curPermission.isActive) {
                    return false;
                }
            }
            const organizationPermissionIds = JSON.parse(external.organization.permissionIds || '[]');
            if (!organizationPermissionIds.includes(permission.rootId)) {
                return false;
            }
            if (external.user.isAdmin)
                return true;
            return true;
        };
        if (requireOrganizationPermission.length) {
            const checkEvery = requireOrganizationPermission.every(checkPermissionId);
            if (!checkEvery) {
                const permissionNameArr = requireOrganizationPermission
                    .map((i) => permissionMap[i].name)
                    .join(', ');
                throw new exception_filter_1.BusinessException('common.ForbiddenOrganizationPermission', { permission: permissionNameArr }, common_1.HttpStatus.FORBIDDEN);
            }
        }
        return true;
    }
};
exports.OrganizationGuard = OrganizationGuard;
exports.OrganizationGuard = OrganizationGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object])
], OrganizationGuard);


/***/ }),
/* 157 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGuard = exports.UserPermissionOr = exports.UserPermission = exports.USER_GUARD_OR = exports.USER_GUARD = void 0;
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const organization_entity_1 = __webpack_require__(16);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
exports.USER_GUARD = 'USER_GUARD';
exports.USER_GUARD_OR = 'USER_GUARD_OR';
const UserPermission = (...permissionIds) => {
    return (0, common_1.SetMetadata)(exports.USER_GUARD, permissionIds);
};
exports.UserPermission = UserPermission;
const UserPermissionOr = (...permissionIds) => {
    return (0, common_1.SetMetadata)(exports.USER_GUARD_OR, permissionIds);
};
exports.UserPermissionOr = UserPermissionOr;
let UserGuard = class UserGuard {
    constructor(reflector, cacheDataService) {
        this.reflector = reflector;
        this.cacheDataService = cacheDataService;
    }
    async canActivate(context) {
        const requireUserPermission = this.reflector.getAllAndOverride(exports.USER_GUARD, [
            context.getHandler(),
            context.getClass(),
        ]);
        const requireUserPermissionOr = this.reflector.getAllAndOverride(exports.USER_GUARD, [
            context.getHandler(),
            context.getClass(),
        ]);
        if (requireUserPermission === undefined && requireUserPermission === undefined) {
            return true;
        }
        const request = context.switchToHttp().getRequest();
        const requestExternal = request.raw;
        const { external } = requestExternal;
        if (external.error) {
            throw new exception_filter_1.BusinessException(external.error, {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!external.uid || !external.oid || !external.user || !external.organization) {
            throw new exception_filter_1.BusinessException('common.AccountRequired', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (!!external.user.deletedAt || external.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        if (external.oid === 1)
            return true;
        const permissionMap = await this.cacheDataService.getPermissionAllMap();
        const checkPermissionId = (permissionId) => {
            const permission = permissionMap[permissionId];
            const pathIdArr = permission.pathId.split('.').map((i) => Number(i));
            for (let i = 0; i < pathIdArr.length; i++) {
                const id = pathIdArr[i];
                const curPermission = permissionMap[id];
                if (!curPermission.isActive) {
                    return false;
                }
            }
            const organizationPermissionIds = JSON.parse(external.organization.permissionIds || '[]');
            if (!organizationPermissionIds.includes(permission.rootId)) {
                return false;
            }
            if (external.user.isAdmin)
                return true;
            const userPermissionIds = pathIdArr.some((pid) => external.permissionIds.includes(pid));
            if (!userPermissionIds)
                return false;
            return true;
        };
        if (requireUserPermission.length) {
            const checkEvery = requireUserPermission.every(checkPermissionId);
            if (!checkEvery) {
                const permissionNameArr = requireUserPermission.map((i) => permissionMap[i].name).join(', ');
                throw new exception_filter_1.BusinessException('common.ForbiddenUserPermission', { permission: permissionNameArr }, common_1.HttpStatus.FORBIDDEN);
            }
        }
        if (requireUserPermissionOr.length) {
            const checkOr = requireUserPermissionOr.some(checkPermissionId);
            if (!checkOr) {
                const permissionNameArr = requireUserPermissionOr
                    .map((i) => permissionMap[i].name)
                    .join(', ');
                throw new exception_filter_1.BusinessException('common.ForbiddenUserPermission', { permission: permissionNameArr }, common_1.HttpStatus.FORBIDDEN);
            }
        }
        return true;
    }
};
exports.UserGuard = UserGuard;
exports.UserGuard = UserGuard = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof core_1.Reflector !== "undefined" && core_1.Reflector) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object])
], UserGuard);


/***/ }),
/* 158 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtExtendModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const jwt_1 = __webpack_require__(159);
const jwt_extend_service_1 = __webpack_require__(160);
const jwt_config_1 = __webpack_require__(161);
let JwtExtendModule = class JwtExtendModule {
};
exports.JwtExtendModule = JwtExtendModule;
exports.JwtExtendModule = JwtExtendModule = __decorate([
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig), jwt_1.JwtModule],
        providers: [jwt_extend_service_1.JwtExtendService],
        exports: [jwt_extend_service_1.JwtExtendService],
    })
], JwtExtendModule);


/***/ }),
/* 159 */
/***/ ((module) => {

module.exports = require("@nestjs/jwt");

/***/ }),
/* 160 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtExtendService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const jwt_1 = __webpack_require__(159);
const exception_filter_1 = __webpack_require__(9);
const jwt_config_1 = __webpack_require__(161);
let JwtExtendService = class JwtExtendService {
    constructor(jwtConfig, jwtService) {
        this.jwtConfig = jwtConfig;
        this.jwtService = jwtService;
    }
    createAccessToken(user, ip) {
        const userPayload = {
            oid: user.organization.id,
            uid: user.id,
        };
        const exp = Math.floor((Date.now() + this.jwtConfig.accessTime) / 1000);
        const accessToken = this.jwtService.sign({ exp, data: userPayload }, { secret: this.jwtConfig.accessKey });
        return { accessToken, accessExp: exp * 1000 };
    }
    createRefreshToken(user, ip) {
        const userPayload = {
            oid: user.organization.id,
            uid: user.id,
        };
        const exp = Math.floor((Date.now() + this.jwtConfig.refreshTime) / 1000);
        const refreshToken = this.jwtService.sign({ exp, data: userPayload }, { secret: this.jwtConfig.refreshKey });
        return { refreshToken, refreshExp: exp * 1000 };
    }
    createTokenFromUser(user, ip) {
        const { accessToken, accessExp } = this.createAccessToken(user, ip);
        const { refreshToken, refreshExp } = this.createRefreshToken(user, ip);
        return { accessToken, refreshToken, accessExp, refreshExp };
    }
    verifyAccessToken(accessToken, ip) {
        try {
            const jwtPayload = this.jwtService.verify(accessToken, {
                secret: this.jwtConfig.accessKey,
            });
            const data = jwtPayload.data;
            return {
                data: jwtPayload.data,
                exp: jwtPayload.exp * 1000,
                iat: jwtPayload.iat * 1000,
            };
        }
        catch (error) {
            if (error.name === 'TokenExpiredError') {
                throw new exception_filter_1.BusinessException('error.Token.AccessTokenExpired', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            else if (error.name === 'JsonWebTokenError') {
                throw new exception_filter_1.BusinessException('error.Token.Invalid', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            throw error;
        }
    }
    verifyRefreshToken(refreshToken, ip) {
        try {
            const jwtPayload = this.jwtService.verify(refreshToken, {
                secret: this.jwtConfig.refreshKey,
            });
            const data = jwtPayload.data;
            return {
                data: jwtPayload.data,
                exp: jwtPayload.exp * 1000,
                iat: jwtPayload.iat * 1000,
            };
        }
        catch (error) {
            if (error.name === 'TokenExpiredError') {
                throw new exception_filter_1.BusinessException('error.Token.RefreshTokenExpired', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            else if (error.name === 'JsonWebTokenError') {
                throw new exception_filter_1.BusinessException('error.Token.Invalid', {}, common_1.HttpStatus.UNAUTHORIZED);
            }
            throw error;
        }
    }
    decodeRefreshToken(refreshToken) {
        const jwtPayload = this.jwtService.decode(refreshToken);
        return {
            data: jwtPayload.data,
            exp: jwtPayload.exp * 1000,
            iat: jwtPayload.iat * 1000,
        };
    }
};
exports.JwtExtendService = JwtExtendService;
exports.JwtExtendService = JwtExtendService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _b : Object])
], JwtExtendService);


/***/ }),
/* 161 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.JwtConfig = void 0;
const config_1 = __webpack_require__(31);
exports.JwtConfig = (0, config_1.registerAs)('jwt', () => ({
    accessKey: process.env.JWT_ACCESS_KEY,
    refreshKey: process.env.JWT_REFRESH_KEY,
    accessTime: Number(process.env.JWT_ACCESS_TIME),
    refreshTime: Number(process.env.JWT_REFRESH_TIME),
}));


/***/ }),
/* 162 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DetectClientMiddleware = void 0;
const common_1 = __webpack_require__(3);
const request_ip_1 = __webpack_require__(8);
const cache_data_service_1 = __webpack_require__(40);
const cache_token_service_1 = __webpack_require__(155);
const jwt_extend_service_1 = __webpack_require__(160);
let DetectClientMiddleware = class DetectClientMiddleware {
    constructor(jwtExtendService, cacheTokenService, cacheDataService) {
        this.jwtExtendService = jwtExtendService;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
    }
    async use(request, response, next) {
        if (request.method === 'OPTIONS')
            return next();
        const os = request.headers['x-os'];
        const browser = request.headers['x-browser'];
        const mobile = request.headers['x-mobile'];
        const clientId = request.headers['x-client-id'];
        const authorization = request.headers.authorization || '';
        const ip = (0, request_ip_1.getClientIp)(request);
        const dataExternal = {
            clientId,
            ip,
            os,
            browser,
            mobile: mobile === '1' ? 1 : 0,
            uid: null,
            oid: null,
            user: null,
            organization: null,
            permissionIds: [],
            roomIds: [],
            error: null,
        };
        const [, accessToken] = authorization.split(' ');
        if (accessToken) {
            try {
                const decode = this.jwtExtendService.verifyAccessToken(accessToken, ip);
                const { oid, uid } = decode.data;
                dataExternal.oid = oid;
                dataExternal.uid = uid;
                const checkTokenCache = await this.cacheTokenService.checkAccessToken({
                    oid,
                    uid,
                    accessExp: decode.exp,
                });
                if (checkTokenCache) {
                    dataExternal.user = await this.cacheDataService.getUser(oid, uid);
                    dataExternal.organization = await this.cacheDataService.getOrganization(oid);
                    dataExternal.permissionIds = await this.cacheDataService.getPermissionIdsByUserId(oid, uid);
                    dataExternal.roomIds = await this.cacheDataService.getRoomIdList(oid, uid);
                }
                else {
                    dataExternal.error = 'error.Token.AccessTokenNoCache';
                    if (process.env.NODE_ENV !== 'production') {
                    }
                }
            }
            catch (error) {
                dataExternal.error = error.message;
            }
        }
        const requestExternal = request;
        requestExternal.external = dataExternal;
        return next();
    }
};
exports.DetectClientMiddleware = DetectClientMiddleware;
exports.DetectClientMiddleware = DetectClientMiddleware = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _a : Object, typeof (_b = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object])
], DetectClientMiddleware);


/***/ }),
/* 163 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const typeorm_1 = __webpack_require__(44);
const EntityList = __webpack_require__(45);
const OperationList = __webpack_require__(164);
const postgresql_config_1 = __webpack_require__(222);
const RepositoryList = __webpack_require__(42);
let PostgresqlModule = class PostgresqlModule {
};
exports.PostgresqlModule = PostgresqlModule;
exports.PostgresqlModule = PostgresqlModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [
            typeorm_1.TypeOrmModule.forRootAsync({
                imports: [config_1.ConfigModule.forFeature(postgresql_config_1.PostgresqlConfig)],
                inject: [postgresql_config_1.PostgresqlConfig.KEY],
                useFactory: (sqlConfig) => sqlConfig,
            }),
            typeorm_1.TypeOrmModule.forFeature(Object.values(EntityList)),
        ],
        providers: [
            ...Object.values(RepositoryList),
            ...Object.values(OperationList),
        ],
        exports: [
            ...Object.values(RepositoryList),
            ...Object.values(OperationList),
        ],
    })
], PostgresqlModule);


/***/ }),
/* 164 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(165), exports);
__exportStar(__webpack_require__(166), exports);
__exportStar(__webpack_require__(167), exports);
__exportStar(__webpack_require__(168), exports);
__exportStar(__webpack_require__(169), exports);
__exportStar(__webpack_require__(170), exports);
__exportStar(__webpack_require__(171), exports);
__exportStar(__webpack_require__(172), exports);
__exportStar(__webpack_require__(173), exports);
__exportStar(__webpack_require__(174), exports);
__exportStar(__webpack_require__(175), exports);
__exportStar(__webpack_require__(176), exports);
__exportStar(__webpack_require__(177), exports);
__exportStar(__webpack_require__(178), exports);
__exportStar(__webpack_require__(179), exports);
__exportStar(__webpack_require__(180), exports);
__exportStar(__webpack_require__(191), exports);
__exportStar(__webpack_require__(192), exports);
__exportStar(__webpack_require__(193), exports);
__exportStar(__webpack_require__(194), exports);
__exportStar(__webpack_require__(195), exports);
__exportStar(__webpack_require__(196), exports);
__exportStar(__webpack_require__(181), exports);
__exportStar(__webpack_require__(197), exports);
__exportStar(__webpack_require__(198), exports);
__exportStar(__webpack_require__(199), exports);
__exportStar(__webpack_require__(200), exports);
__exportStar(__webpack_require__(201), exports);
__exportStar(__webpack_require__(202), exports);
__exportStar(__webpack_require__(203), exports);
__exportStar(__webpack_require__(204), exports);
__exportStar(__webpack_require__(205), exports);
__exportStar(__webpack_require__(206), exports);
__exportStar(__webpack_require__(207), exports);
__exportStar(__webpack_require__(208), exports);
__exportStar(__webpack_require__(209), exports);
__exportStar(__webpack_require__(210), exports);
__exportStar(__webpack_require__(211), exports);
__exportStar(__webpack_require__(212), exports);
__exportStar(__webpack_require__(213), exports);
__exportStar(__webpack_require__(214), exports);
__exportStar(__webpack_require__(215), exports);
__exportStar(__webpack_require__(216), exports);
__exportStar(__webpack_require__(217), exports);
__exportStar(__webpack_require__(218), exports);
__exportStar(__webpack_require__(219), exports);
__exportStar(__webpack_require__(220), exports);
__exportStar(__webpack_require__(221), exports);


/***/ }),
/* 165 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchOperator = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const repositories_1 = __webpack_require__(42);
let BatchOperator = class BatchOperator {
    constructor(dataSource, productManager, batchManager, productMovementManager, purchaseOrderItemManager, ticketProductManager, ticketBatchManager, stockCheckItemManager) {
        this.dataSource = dataSource;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.stockCheckItemManager = stockCheckItemManager;
    }
    async mergeBatch(options) {
        const { oid, productId, batchIdSourceList, batchIdTarget } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const batchSourceList = await this.batchManager.deleteAndReturnEntity(manager, {
                oid,
                productId,
                id: { IN: batchIdSourceList },
            });
            const quantitySourceAdd = batchSourceList.reduce((acc, item) => acc + item.quantity, 0);
            const costAmountSourceAdd = batchSourceList.reduce((acc, item) => acc + item.costAmount, 0);
            const batchTargetModified = await this.batchManager.updateOneAndReturnEntity(manager, { oid, id: batchIdTarget, productId }, {
                quantity: () => `quantity + ${quantitySourceAdd}`,
                costAmount: () => `"costAmount" + ${costAmountSourceAdd}`,
            });
            await this.purchaseOrderItemManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.ticketProductManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.ticketBatchManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.stockCheckItemManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            await this.productMovementManager.update(manager, { oid, productId, batchId: { IN: batchIdSourceList } }, { batchId: batchIdTarget });
            return {
                batchDestroyedList: batchSourceList,
                batchModified: batchTargetModified,
            };
        });
    }
};
exports.BatchOperator = BatchOperator;
exports.BatchOperator = BatchOperator = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketBatchManager !== "undefined" && repositories_1.TicketBatchManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.StockCheckItemManager !== "undefined" && repositories_1.StockCheckItemManager) === "function" ? _h : Object])
], BatchOperator);


/***/ }),
/* 166 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductPickingOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const time_helper_1 = __webpack_require__(149);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
let ProductPickingOperation = class ProductPickingOperation {
    constructor(dataSource) {
        this.dataSource = dataSource;
    }
    generatePickingPlan(data) {
        const { productOriginList, batchOriginList, voucherBatchList, allowNegativeQuantity } = data;
        const productOriginMap = array_helper_1.ESArray.arrayToKeyValue(productOriginList, 'id');
        const batchOriginMap = array_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
        const productCalcMap = {};
        productOriginList.forEach((i) => {
            if (!productCalcMap[i.id]) {
                productCalcMap[i.id] = { productId: i.id, openQuantity: i.quantity, product: i };
            }
        });
        const batchCalcListMap = {};
        batchOriginList.forEach((b) => {
            var _a;
            batchCalcListMap[_a = b.productId] || (batchCalcListMap[_a] = []);
            batchCalcListMap[b.productId].push({
                productId: b.productId,
                openQuantity: b.quantity,
                openCostAmount: b.costAmount,
                batch: b,
            });
        });
        Object.keys(batchCalcListMap).forEach((productId) => {
            batchCalcListMap[productId].sort((a, b) => (a.batch.id < b.batch.id ? -1 : 1));
        });
        const pickingMovementList = [];
        voucherBatchList.forEach((voucherProduct) => {
            var _a;
            const { voucherProductId, voucherBatchId, productId, pickupStrategy } = voucherProduct;
            const productOrigin = productOriginMap[productId];
            if (!productOrigin) {
                throw new error_1.BusinessError(`Không tìm thấy Product với productId=${productId}`);
            }
            const productCalc = productCalcMap[productId];
            if (!batchCalcListMap[productId]
                || !batchCalcListMap[productId].length
                || pickupStrategy === variable_1.PickupStrategy.NoImpact) {
                const pickingQuantity = voucherProduct.quantity;
                const pickingCostAmount = voucherProduct.quantity * productOrigin.costPrice;
                const pickingMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId: 0,
                    pickingQuantity,
                    pickingCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity - 0,
                    openQuantityBatch: 0,
                    closeQuantityBatch: 0,
                    openCostAmountBatch: 0,
                    closeCostAmountBatch: 0,
                };
                pickingMovementList.push(pickingMovement);
            }
            else if (voucherProduct.batchId !== 0) {
                const batchCalc = (_a = batchCalcListMap[productId]) === null || _a === void 0 ? void 0 : _a.find((i) => {
                    return i.batch.id === voucherProduct.batchId;
                });
                if (!batchCalc || !batchCalc.batch) {
                    throw new error_1.BusinessError(`${productOrigin.brandName} không có lô hàng phù hợp`);
                }
                if (!allowNegativeQuantity && voucherProduct.quantity > batchCalc.openQuantity) {
                    const expiryDateString = time_helper_1.ESTimer.timeToText(batchCalc.batch.expiryDate, 'DD/MM/YYYY', 7);
                    throw new error_1.BusinessError(`${productOrigin.brandName} không đủ số lượng trong kho.`, ` Lô hàng ${batchCalc.batch.lotNumber} ${expiryDateString}:`, ` còn ${batchCalc.openQuantity}, lấy ${voucherProduct.quantity}`);
                }
                let pickingQuantityPositive = Math.min(batchCalc.openQuantity, voucherProduct.quantity);
                if (pickingQuantityPositive < 0)
                    pickingQuantityPositive = 0;
                const pickingQuantityNegative = voucherProduct.quantity - pickingQuantityPositive;
                if (pickingQuantityPositive > 0) {
                    const pickingQuantity = pickingQuantityPositive;
                    let pickingCostAmount = 0;
                    if (voucherProduct.costAmount == null) {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    else {
                        pickingCostAmount = Math.round((voucherProduct.costAmount * pickingQuantity) / voucherProduct.quantity);
                        if (pickingCostAmount > batchCalc.openCostAmount) {
                            pickingCostAmount = batchCalc.openCostAmount;
                        }
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
                if (pickingQuantityNegative > 0) {
                    const pickingQuantity = pickingQuantityNegative;
                    let pickingCostAmount = 0;
                    if (batchCalc.openQuantity === 0) {
                        pickingCostAmount = productOrigin.costPrice * pickingQuantity;
                    }
                    else {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
            }
            else {
                let quantityCalculator = voucherProduct.quantity;
                const batchCalcList = batchCalcListMap[productId].filter((i) => {
                    let warehouseIdList = [];
                    try {
                        warehouseIdList = JSON.parse(voucherProduct.warehouseIds);
                    }
                    catch (error) {
                        warehouseIdList = [];
                    }
                    if (!warehouseIdList.length || warehouseIdList.includes(0))
                        return true;
                    if (i.batch.warehouseId === 0)
                        return true;
                    if (warehouseIdList.includes(i.batch.warehouseId))
                        return true;
                    return false;
                });
                if (!batchCalcList.length) {
                    throw new error_1.BusinessError(`${productOrigin.brandName} không có danh sách tồn kho phù hợp`);
                }
                for (let i = 0; i < batchCalcList.length; i++) {
                    if (quantityCalculator <= 0)
                        break;
                    const batchCalc = batchCalcList[i];
                    const pickingQuantity = Math.min(quantityCalculator, batchCalc.openQuantity);
                    if (pickingQuantity <= 0)
                        continue;
                    const pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                    quantityCalculator -= pickingQuantity;
                }
                if (quantityCalculator > 0) {
                    if (!allowNegativeQuantity) {
                        throw new error_1.BusinessError(`${productOrigin.brandName} không đủ số lượng trong kho`);
                    }
                    const batchCalc = batchCalcList[batchCalcList.length - 1];
                    const pickingQuantity = quantityCalculator;
                    let pickingCostAmount = 0;
                    if (batchCalc.openQuantity === 0) {
                        pickingCostAmount = pickingQuantity * productOrigin.costPrice;
                    }
                    else {
                        pickingCostAmount = Math.round((batchCalc.openCostAmount * pickingQuantity) / batchCalc.openQuantity);
                    }
                    const pickingMovement = {
                        voucherProductId,
                        voucherBatchId,
                        productId,
                        batchId: batchCalc.batch.id,
                        pickingQuantity,
                        pickingCostAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity - pickingQuantity,
                        openQuantityBatch: batchCalc.openQuantity,
                        closeQuantityBatch: batchCalc.openQuantity - pickingQuantity,
                        openCostAmountBatch: batchCalc.openCostAmount,
                        closeCostAmountBatch: batchCalc.openCostAmount - pickingCostAmount,
                    };
                    pickingMovementList.push(pickingMovement);
                    productCalc.openQuantity = pickingMovement.closeQuantityProduct;
                    batchCalc.openQuantity = pickingMovement.closeQuantityBatch;
                    batchCalc.openCostAmount = pickingMovement.closeCostAmountBatch;
                }
            }
        });
        const pickingProductMap = {};
        const pickingBatchMap = {};
        const pickingVoucherProductMap = {};
        const pickingVoucherBatchMap = {};
        pickingMovementList.forEach((mov) => {
            const { productId, batchId, voucherProductId, voucherBatchId } = mov;
            pickingProductMap[productId] || (pickingProductMap[productId] = {
                productId,
                pickingQuantity: 0,
                openQuantity: productOriginMap[productId].quantity,
                closeQuantity: 0,
            });
            pickingProductMap[productId].pickingQuantity += mov.pickingQuantity;
            pickingProductMap[productId].closeQuantity = mov.closeQuantityProduct;
            if (batchId != 0) {
                pickingBatchMap[batchId] || (pickingBatchMap[batchId] = {
                    productId,
                    batchId,
                    pickingQuantity: 0,
                    pickingCostAmount: 0,
                    openQuantity: batchOriginMap[batchId].quantity,
                    closeQuantity: 0,
                    openCostAmount: batchOriginMap[batchId].costAmount,
                    closeCostAmount: 0,
                });
                pickingBatchMap[batchId].pickingQuantity += mov.pickingQuantity;
                pickingBatchMap[batchId].pickingCostAmount += mov.pickingCostAmount;
                pickingBatchMap[batchId].closeQuantity = mov.closeQuantityBatch;
                pickingBatchMap[batchId].closeCostAmount = mov.closeQuantityBatch;
            }
            pickingVoucherProductMap[voucherProductId] || (pickingVoucherProductMap[voucherProductId] = {
                voucherProductId,
                productId,
                pickingQuantity: 0,
                pickingCostAmount: 0,
            });
            pickingVoucherProductMap[voucherProductId].pickingQuantity += mov.pickingQuantity;
            pickingVoucherProductMap[voucherProductId].pickingCostAmount += mov.pickingCostAmount;
            const keyVoucherBatch = `${voucherProductId}-${voucherBatchId}-${batchId}`;
            pickingVoucherBatchMap[keyVoucherBatch] || (pickingVoucherBatchMap[keyVoucherBatch] = {
                voucherProductId,
                productId,
                batchId,
                pickingCostAmount: 0,
                pickingQuantity: 0,
            });
            pickingVoucherBatchMap[keyVoucherBatch].pickingQuantity += mov.pickingQuantity;
            pickingVoucherBatchMap[keyVoucherBatch].pickingCostAmount += mov.pickingCostAmount;
        });
        const pickingContainer = {
            pickingMovementList,
            pickingProductList: Object.values(pickingProductMap),
            pickingBatchList: Object.values(pickingBatchMap),
            pickingVoucherProductList: Object.values(pickingVoucherProductMap),
            pickingVoucherBatchList: Object.values(pickingVoucherBatchMap),
        };
        return pickingContainer;
    }
};
exports.ProductPickingOperation = ProductPickingOperation;
exports.ProductPickingOperation = ProductPickingOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], ProductPickingOperation);


/***/ }),
/* 167 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductPutawayOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
let ProductPutawayOperation = class ProductPutawayOperation {
    constructor(dataSource) {
        this.dataSource = dataSource;
    }
    generatePutawayPlan(options) {
        const { productOriginList, batchOriginList, voucherBatchList } = options;
        const productOriginMap = array_helper_1.ESArray.arrayToKeyValue(productOriginList, 'id');
        const batchOriginMap = array_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
        const productCalcMap = {};
        productOriginList.forEach((i) => {
            if (!productCalcMap[i.id]) {
                productCalcMap[i.id] = { productId: i.id, openQuantity: i.quantity, product: i };
            }
        });
        const batchCalcMap = {};
        batchOriginList.forEach((i) => {
            if (!batchCalcMap[i.id]) {
                batchCalcMap[i.id] = {
                    batchId: i.id,
                    openQuantity: i.quantity,
                    openCostAmount: i.costAmount,
                    batch: i,
                };
            }
        });
        const putawayMovementList = [];
        voucherBatchList.forEach((voucherProduct) => {
            const { productId, batchId, voucherProductId, voucherBatchId, warehouseId } = voucherProduct;
            if (!productOriginMap[productId]) {
                throw new Error('Không tìm thấy Product với productId=' + productId);
            }
            if (batchId !== 0 && !batchOriginMap[batchId]) {
                throw new Error('Không tìm thấy Batch với batchId=' + batchId);
            }
            const productCalc = productCalcMap[productId];
            const batchCalc = batchCalcMap[batchId];
            if (batchId === 0) {
                const putawayQuantity = voucherProduct.quantity;
                const pcAmount = voucherProduct.costAmount;
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    batchId,
                    productId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount: pcAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + 0,
                    openQuantityBatch: 0,
                    closeQuantityBatch: 0,
                    openCostAmountBatch: 0,
                    closeCostAmountBatch: 0,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                return;
            }
            const expectedQuantity = batchCalc.openQuantity + voucherProduct.quantity;
            let putawayQuantityPositive = Math.min(expectedQuantity, voucherProduct.quantity);
            if (putawayQuantityPositive < 0)
                putawayQuantityPositive = 0;
            const putawayQuantityNegative = voucherProduct.quantity - putawayQuantityPositive;
            if (putawayQuantityNegative > 0) {
                const putawayQuantity = putawayQuantityNegative;
                const putawayCostAmount = Math.round((batchCalc.openCostAmount * putawayQuantity) / batchCalc.openQuantity);
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + putawayQuantity,
                    openQuantityBatch: batchCalc.openQuantity,
                    closeQuantityBatch: batchCalc.openQuantity + putawayQuantity,
                    openCostAmountBatch: batchCalc.openCostAmount,
                    closeCostAmountBatch: batchCalc.openCostAmount + putawayCostAmount,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                batchCalc.openQuantity = putawayMovement.closeQuantityBatch;
                batchCalc.openCostAmount = putawayMovement.closeCostAmountBatch;
            }
            if (putawayQuantityPositive > 0) {
                const putawayQuantity = putawayQuantityPositive;
                const putawayCostAmount = Math.round((voucherProduct.costAmount * putawayQuantityPositive) / voucherProduct.quantity);
                const putawayMovement = {
                    voucherProductId,
                    voucherBatchId,
                    productId,
                    batchId,
                    warehouseId,
                    putawayQuantity,
                    putawayCostAmount,
                    openQuantityProduct: productCalc.openQuantity,
                    closeQuantityProduct: productCalc.openQuantity + putawayQuantity,
                    openQuantityBatch: batchCalc.openQuantity,
                    closeQuantityBatch: batchCalc.openQuantity + putawayQuantity,
                    openCostAmountBatch: batchCalc.openCostAmount,
                    closeCostAmountBatch: batchCalc.openCostAmount + putawayCostAmount,
                };
                putawayMovementList.push(putawayMovement);
                productCalc.openQuantity = putawayMovement.closeQuantityProduct;
                batchCalc.openQuantity = putawayMovement.closeQuantityBatch;
                batchCalc.openCostAmount = putawayMovement.closeCostAmountBatch;
            }
        });
        const putawayProductMap = {};
        const putawayBatchMap = {};
        const putawayVoucherProductMap = {};
        const putawayVoucherBatchMap = {};
        putawayMovementList.forEach((mov) => {
            const { productId, batchId, voucherProductId, voucherBatchId } = mov;
            putawayProductMap[productId] || (putawayProductMap[productId] = {
                productId,
                putawayQuantity: 0,
                openQuantity: productOriginMap[productId].quantity,
                closeQuantity: 0,
            });
            putawayProductMap[productId].putawayQuantity += mov.putawayQuantity;
            putawayProductMap[productId].closeQuantity = mov.closeQuantityProduct;
            if (batchId != 0) {
                putawayBatchMap[batchId] || (putawayBatchMap[batchId] = {
                    productId,
                    batchId,
                    putawayQuantity: 0,
                    putawayCostAmount: 0,
                    openQuantity: batchOriginMap[batchId].quantity,
                    closeQuantity: 0,
                    openCostAmount: batchOriginMap[batchId].costAmount,
                    closeCostAmount: 0,
                });
                putawayBatchMap[batchId].putawayQuantity += mov.putawayQuantity;
                putawayBatchMap[batchId].putawayCostAmount += mov.putawayCostAmount;
                putawayBatchMap[batchId].closeQuantity = mov.closeQuantityBatch;
                putawayBatchMap[batchId].closeCostAmount = mov.closeQuantityBatch;
            }
            putawayVoucherProductMap[voucherProductId] || (putawayVoucherProductMap[voucherProductId] = {
                voucherProductId,
                productId,
                putawayQuantity: 0,
                putawayCostAmount: 0,
            });
            putawayVoucherProductMap[voucherProductId].putawayQuantity += mov.putawayQuantity;
            putawayVoucherProductMap[voucherProductId].putawayCostAmount += mov.putawayCostAmount;
            const keyVoucherBatch = `${voucherProductId}-${voucherBatchId}-${batchId}`;
            putawayVoucherBatchMap[keyVoucherBatch] || (putawayVoucherBatchMap[keyVoucherBatch] = {
                voucherBatchId,
                voucherProductId,
                productId,
                batchId,
                putawayQuantity: 0,
                putawayCostAmount: 0,
            });
            putawayVoucherBatchMap[keyVoucherBatch].putawayQuantity += mov.putawayQuantity;
            putawayVoucherBatchMap[keyVoucherBatch].putawayCostAmount += mov.putawayCostAmount;
        });
        const putawayContainer = {
            putawayMovementList,
            putawayProductList: Object.values(putawayProductMap),
            putawayBatchList: Object.values(putawayBatchMap),
            putawayVoucherProductList: Object.values(putawayVoucherProductMap),
            putawayVoucherBatchList: Object.values(putawayVoucherBatchMap),
        };
        return putawayContainer;
    }
};
exports.ProductPutawayOperation = ProductPutawayOperation;
exports.ProductPutawayOperation = ProductPutawayOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], ProductPutawayOperation);


/***/ }),
/* 168 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const entities_1 = __webpack_require__(45);
const repositories_1 = __webpack_require__(42);
let ProductOperation = class ProductOperation {
    constructor(dataSource, productManager, batchManager, purchaseOrderItemManager, ticketProductManager, ticketBatchManager, stockCheckItemManager, productMovementManager, manager) {
        this.dataSource = dataSource;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.stockCheckItemManager = stockCheckItemManager;
        this.productMovementManager = productMovementManager;
        this.manager = manager;
    }
    async reCalculateQuantityBySumBatch(options) {
        const { oid, productId } = options;
        const resultQuery = await this.manager.query(`
        UPDATE  "Product"
        SET     "quantity" = ( 
                    SELECT COALESCE(SUM("quantity"), 0)
                    FROM "Batch" WHERE "productId" = ${productId}
                )
        WHERE   "id" = ${productId} AND "oid" = ${oid}
        RETURNING *
    `);
        if (resultQuery[0].length !== 1) {
            throw new Error(`Update Product failed`);
        }
        return entities_1.Product.fromRaw(resultQuery[0][0]);
    }
    async reCalculateQuantityBySumBatchList(options) {
        const { oid, productIdList } = options;
        const resultQuery = await this.manager.query(`
        UPDATE  "Product" "product" 
        SET     "quantity" = "sbq"."sumQuantity"
        FROM    ( 
                SELECT "productId", SUM("quantity") as "sumQuantity" 
                    FROM "Batch" 
                    WHERE "Batch"."productId" IN (${productIdList.toString()})
                        AND "Batch"."oid" = ${oid}
                    GROUP BY "productId" 
                ) AS "sbq" 
        WHERE   "product"."id" = "sbq"."productId" 
            AND "product"."id" IN (${productIdList.toString()})
            AND "product"."oid" = ${oid}
        RETURNING "Product".*
    `);
        return entities_1.Product.fromRaws(resultQuery[0]);
    }
    async mergeProduct(options) {
        const { oid, userId, productIdSourceList, productIdTarget } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const productSourceList = await this.productManager.deleteAndReturnEntity(manager, {
                oid,
                id: { IN: productIdSourceList },
            });
            const quantitySourceAdd = productSourceList.reduce((acc, item) => acc + item.quantity, 0);
            const productTargetModified = await this.productManager.updateOneAndReturnEntity(manager, { oid, id: productIdTarget }, { quantity: () => `quantity + ${quantitySourceAdd}` });
            const batchModifiedList = await this.batchManager.updateAndReturnEntity(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.purchaseOrderItemManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.ticketProductManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.ticketBatchManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.stockCheckItemManager.update(manager, { oid, productId: { IN: productIdSourceList } }, { productId: productIdTarget });
            await this.productMovementManager.delete(manager, {
                oid,
                productId: { IN: productIdSourceList },
            });
            const productMovement = {
                oid,
                movementType: variable_1.MovementType.UserChange,
                contactId: userId,
                voucherId: 0,
                voucherProductId: 0,
                warehouseId: 0,
                productId: productIdTarget,
                batchId: 0,
                isRefund: 0,
                quantity: quantitySourceAdd,
                costAmount: 0,
                openQuantityProduct: productTargetModified.quantity - quantitySourceAdd,
                closeQuantityProduct: productTargetModified.quantity,
                openQuantityBatch: 0,
                closeQuantityBatch: 0,
                openCostAmountBatch: 0,
                closeCostAmountBatch: 0,
                actualPrice: productTargetModified.costPrice,
                expectedPrice: productTargetModified.costPrice,
                createdAt: Date.now(),
            };
            await this.productMovementManager.insertOneFullField(manager, productMovement);
            return {
                productDestroyedList: productSourceList,
                productModified: productTargetModified,
                batchModifiedList,
            };
        });
    }
};
exports.ProductOperation = ProductOperation;
exports.ProductOperation = ProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(8, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketBatchManager !== "undefined" && repositories_1.TicketBatchManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.StockCheckItemManager !== "undefined" && repositories_1.StockCheckItemManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _h : Object, typeof (_j = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _j : Object])
], ProductOperation);


/***/ }),
/* 169 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const repositories_1 = __webpack_require__(42);
let RoomOperation = class RoomOperation {
    constructor(dataSource, roomManager, ticketManager, manager) {
        this.dataSource = dataSource;
        this.roomManager = roomManager;
        this.ticketManager = ticketManager;
        this.manager = manager;
    }
    async mergeRoom(options) {
        const { oid, userId, roomIdSourceList, roomIdTarget } = options;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const roomSourceList = await this.roomManager.deleteAndReturnEntity(manager, {
                oid,
                id: { IN: roomIdSourceList },
            });
            await this.ticketManager.update(manager, { oid, roomId: { IN: roomIdSourceList } }, { roomId: roomIdTarget });
            return { roomDestroyedList: roomSourceList };
        });
    }
};
exports.RoomOperation = RoomOperation;
exports.RoomOperation = RoomOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(3, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RoomManager !== "undefined" && repositories_1.RoomManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _d : Object])
], RoomOperation);


/***/ }),
/* 170 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderCloseOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let PurchaseOrderCloseOperation = class PurchaseOrderCloseOperation {
    constructor(dataSource, purchaseOrderManager, distributorManager, paymentManager) {
        this.dataSource = dataSource;
        this.purchaseOrderManager = purchaseOrderManager;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
    }
    async startClose(params) {
        const { oid, userId, purchaseOrderId, time, note } = params;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderUpdated = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                oid,
                id: purchaseOrderId,
                deliveryStatus: { IN: [variable_1.DeliveryStatus.NoStock, variable_1.DeliveryStatus.Delivered] },
                status: { IN: [purchase_order_entity_1.PurchaseOrderStatus.Draft, purchase_order_entity_1.PurchaseOrderStatus.Deposited, purchase_order_entity_1.PurchaseOrderStatus.Executing] },
            }, {
                status: () => `CASE 
                            WHEN(paid > "totalMoney") THEN ${purchase_order_entity_1.PurchaseOrderStatus.Executing} 
                            WHEN(paid < "totalMoney") THEN ${purchase_order_entity_1.PurchaseOrderStatus.Debt} 
                            ELSE ${purchase_order_entity_1.PurchaseOrderStatus.Completed}
                        END
                        `,
                endedAt: time,
            });
            let newDebtPurchaseOrder = purchaseOrderUpdated.debt;
            let distributorModified;
            const paymentCreatedList = [];
            if (purchaseOrderUpdated.debt > 0) {
                let paidByTopUp = 0;
                const distributorOrigin = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: purchaseOrderUpdated.distributorId, isActive: 1 }, { isActive: 1 });
                if (distributorOrigin.debt < 0) {
                    const topUpMoney = -distributorOrigin.debt;
                    paidByTopUp = Math.min(purchaseOrderUpdated.debt, topUpMoney);
                }
                newDebtPurchaseOrder = purchaseOrderUpdated.debt - paidByTopUp;
                const newDebtCustomer = distributorOrigin.debt + paidByTopUp + newDebtPurchaseOrder;
                distributorModified = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: purchaseOrderUpdated.distributorId }, { debt: newDebtCustomer });
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                    voucherId: purchaseOrderId,
                    personType: payment_entity_1.PaymentPersonType.Distributor,
                    personId: purchaseOrderUpdated.distributorId,
                    cashierId: userId,
                    paymentMethodId: 0,
                    createdAt: time,
                    paymentActionType: payment_entity_1.PaymentActionType.Close,
                    moneyDirection: payment_entity_1.MoneyDirection.Other,
                    note: note || '',
                    paidAmount: 0,
                    debtAmount: paidByTopUp + newDebtPurchaseOrder,
                    openDebt: distributorOrigin.debt,
                    closeDebt: distributorModified.debt,
                };
                const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                paymentCreatedList.push(paymentCreated);
            }
            let purchaseOrderModified = purchaseOrderUpdated;
            if (purchaseOrderUpdated.debt !== newDebtPurchaseOrder) {
                purchaseOrderModified = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, { oid, id: purchaseOrderId }, { debt: newDebtPurchaseOrder, paid: purchaseOrderUpdated.totalMoney - newDebtPurchaseOrder });
            }
            return { purchaseOrderModified, paymentCreatedList, distributorModified };
        });
        return transaction;
    }
};
exports.PurchaseOrderCloseOperation = PurchaseOrderCloseOperation;
exports.PurchaseOrderCloseOperation = PurchaseOrderCloseOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.DistributorManager !== "undefined" && repositories_1.DistributorManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _d : Object])
], PurchaseOrderCloseOperation);


/***/ }),
/* 171 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderDepositedOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(149);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let PurchaseOrderDepositedOperation = class PurchaseOrderDepositedOperation {
    constructor(dataSource, purchaseOrderManager, purchaseOrderItemManager) {
        this.dataSource = dataSource;
        this.purchaseOrderManager = purchaseOrderManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
    }
    async update(params) {
        const { oid, purchaseOrderId, purchaseOrderUpdateDto, purchaseOrderItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderUpdate = Object.assign(Object.assign({}, purchaseOrderUpdateDto), { oid, status: purchase_order_entity_1.PurchaseOrderStatus.Deposited, debt: () => `${purchaseOrderUpdateDto.totalMoney} - paid`, year: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).date, endedAt: null });
            const purchaseOrder = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                id: purchaseOrderId,
                oid,
                status: purchase_order_entity_1.PurchaseOrderStatus.Deposited,
            }, purchaseOrderUpdate);
            await this.purchaseOrderItemManager.delete(manager, { oid, purchaseOrderId });
            const purchaseOrderItemListInsert = purchaseOrderItemListDto.map((i) => {
                const purchaseOrderItem = Object.assign(Object.assign({}, i), { oid,
                    purchaseOrderId, distributorId: purchaseOrder.distributorId });
                return purchaseOrderItem;
            });
            await this.purchaseOrderItemManager.insertMany(manager, purchaseOrderItemListInsert);
            return { purchaseOrder };
        });
    }
};
exports.PurchaseOrderDepositedOperation = PurchaseOrderDepositedOperation;
exports.PurchaseOrderDepositedOperation = PurchaseOrderDepositedOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _c : Object])
], PurchaseOrderDepositedOperation);


/***/ }),
/* 172 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderDraftOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(149);
const variable_1 = __webpack_require__(21);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let PurchaseOrderDraftOperation = class PurchaseOrderDraftOperation {
    constructor(dataSource, manager, purchaseOrderManager, purchaseOrderItemManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.purchaseOrderManager = purchaseOrderManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
    }
    async createDraft(params) {
        const { oid, purchaseOrderInsertDto, purchaseOrderItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderInsert = Object.assign(Object.assign({}, purchaseOrderInsertDto), { oid, status: purchase_order_entity_1.PurchaseOrderStatus.Draft, deliveryStatus: variable_1.DeliveryStatus.Pending, distributorId: purchaseOrderInsertDto.distributorId, paid: 0, debt: purchaseOrderInsertDto.totalMoney, year: time_helper_1.ESTimer.info(purchaseOrderInsertDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(purchaseOrderInsertDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(purchaseOrderInsertDto.startedAt, 7).date, endedAt: null });
            const purchaseOrder = await this.purchaseOrderManager.insertOneAndReturnEntity(manager, purchaseOrderInsert);
            const purchaseOrderItemListInsert = purchaseOrderItemListDto.map((i) => {
                const purchaseOrderItem = Object.assign(Object.assign({}, i), { oid, purchaseOrderId: purchaseOrder.id, distributorId: purchaseOrderInsert.distributorId });
                return purchaseOrderItem;
            });
            await this.purchaseOrderItemManager.insertMany(manager, purchaseOrderItemListInsert);
            return { purchaseOrder };
        });
    }
    async updateDraft(params) {
        const { oid, purchaseOrderId, purchaseOrderUpdateDto, purchaseOrderItemListDto } = params;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderUpdate = Object.assign(Object.assign({}, purchaseOrderUpdateDto), { oid, distributorId: purchaseOrderUpdateDto.distributorId, status: purchase_order_entity_1.PurchaseOrderStatus.Draft, paid: 0, debt: purchaseOrderUpdateDto.totalMoney, year: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).year, month: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).month + 1, date: time_helper_1.ESTimer.info(purchaseOrderUpdateDto.startedAt, 7).date, endedAt: null });
            const purchaseOrder = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                id: purchaseOrderId,
                oid,
                status: purchase_order_entity_1.PurchaseOrderStatus.Draft,
            }, purchaseOrderUpdate);
            await this.purchaseOrderItemManager.delete(manager, { oid, purchaseOrderId });
            const purchaseOrderItemListInsert = purchaseOrderItemListDto.map((i) => {
                const purchaseOrderItem = Object.assign(Object.assign({}, i), { oid,
                    purchaseOrderId, distributorId: purchaseOrder.distributorId });
                return purchaseOrderItem;
            });
            await this.purchaseOrderItemManager.insertMany(manager, purchaseOrderItemListInsert);
            return { purchaseOrder };
        });
    }
};
exports.PurchaseOrderDraftOperation = PurchaseOrderDraftOperation;
exports.PurchaseOrderDraftOperation = PurchaseOrderDraftOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _d : Object])
], PurchaseOrderDraftOperation);


/***/ }),
/* 173 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderReopenOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let PurchaseOrderReopenOperation = class PurchaseOrderReopenOperation {
    constructor(dataSource, purchaseOrderManager, paymentManager, distributorManager) {
        this.dataSource = dataSource;
        this.purchaseOrderManager = purchaseOrderManager;
        this.paymentManager = paymentManager;
        this.distributorManager = distributorManager;
    }
    async reopen(params) {
        const { oid, userId, purchaseOrderId, time, note } = params;
        const transaction = await this.dataSource.transaction('REPEATABLE READ', async (manager) => {
            const purchaseOrderModified = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, { oid, id: purchaseOrderId }, { endedAt: null, status: purchase_order_entity_1.PurchaseOrderStatus.Executing });
            const paymentCreatedList = [];
            let distributorModified;
            if (purchaseOrderModified.debt > 0) {
                const distributorModified = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: purchaseOrderModified.distributorId }, { debt: () => `debt - ${purchaseOrderModified.debt}` });
                const distributorCloseDebt = distributorModified.debt;
                const distributorOpenDebt = distributorCloseDebt + purchaseOrderModified.debt;
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                    voucherId: purchaseOrderId,
                    personType: payment_entity_1.PaymentPersonType.Distributor,
                    personId: purchaseOrderModified.distributorId,
                    cashierId: userId,
                    paymentMethodId: 0,
                    createdAt: time,
                    paymentActionType: payment_entity_1.PaymentActionType.Reopen,
                    moneyDirection: payment_entity_1.MoneyDirection.Other,
                    note: note || '',
                    paidAmount: 0,
                    debtAmount: -purchaseOrderModified.debt,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                };
                const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                paymentCreatedList.push(paymentCreated);
            }
            return { purchaseOrderModified, paymentCreatedList, distributorModified };
        });
        return transaction;
    }
};
exports.PurchaseOrderReopenOperation = PurchaseOrderReopenOperation;
exports.PurchaseOrderReopenOperation = PurchaseOrderReopenOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.DistributorManager !== "undefined" && repositories_1.DistributorManager) === "function" ? _d : Object])
], PurchaseOrderReopenOperation);


/***/ }),
/* 174 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderReturnProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const variable_1 = __webpack_require__(21);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
const product_picking_operation_1 = __webpack_require__(166);
let PurchaseOrderReturnProductOperation = class PurchaseOrderReturnProductOperation {
    constructor(dataSource, purchaseOrderManager, purchaseOrderItemManager, productManager, batchManager, productMovementManager, productPickingOperation) {
        this.dataSource = dataSource;
        this.purchaseOrderManager = purchaseOrderManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.productPickingOperation = productPickingOperation;
    }
    async returnAllProduct(params) {
        const { oid, purchaseOrderId, time } = params;
        const PREFIX = `PurchaseOrderId=${purchaseOrderId} refund failed`;
        const transaction = await this.dataSource.transaction('REPEATABLE READ', async (manager) => {
            const purchaseOrder = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                oid,
                id: purchaseOrderId,
                status: purchase_order_entity_1.PurchaseOrderStatus.Executing,
                deliveryStatus: variable_1.DeliveryStatus.Delivered,
            }, { deliveryStatus: variable_1.DeliveryStatus.Pending });
            const purchaseOrderItemOriginList = await this.purchaseOrderItemManager.findManyBy(manager, {
                oid,
                purchaseOrderId,
            });
            const purchaseOrderItemOriginMap = array_helper_1.ESArray.arrayToKeyValue(purchaseOrderItemOriginList, 'id');
            if (purchaseOrderItemOriginList.length === 0)
                return { purchaseOrder };
            const productIdList = purchaseOrderItemOriginList.map((i) => i.productId);
            const batchIdList = purchaseOrderItemOriginList.map((i) => i.batchId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(productIdList) }, isActive: 1 }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(batchIdList) }, isActive: 1 }, { updatedAt: time });
            const pickingContainer = this.productPickingOperation.generatePickingPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: purchaseOrderItemOriginList.map((i) => {
                    return Object.assign(Object.assign({}, i), { voucherProductId: i.id, voucherBatchId: 0, warehouseIds: JSON.stringify([i.warehouseId]), costAmount: i.costPrice * i.quantity, pickupStrategy: i.batchId
                            ? variable_1.PickupStrategy.RequireBatchSelection
                            : variable_1.PickupStrategy.NoImpact });
                }),
                allowNegativeQuantity: true,
            });
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: pickingContainer.pickingProductList.map((i) => {
                    return {
                        id: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        quantity: i.closeQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = array_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: pickingContainer.pickingBatchList.map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        pickingCostAmount: i.pickingCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "pickingQuantity"`,
                    costAmount: () => `"costAmount" - "pickingCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchModifiedMap = array_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = pickingContainer.pickingMovementList.map((paMovement) => {
                const riOrigin = purchaseOrderItemOriginMap[paMovement.voucherProductId];
                const batch = batchModifiedMap[paMovement.batchId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.PurchaseOrder,
                    contactId: purchaseOrder.distributorId,
                    voucherId: purchaseOrderId,
                    voucherProductId: riOrigin.id,
                    warehouseId: riOrigin.warehouseId,
                    productId: riOrigin.productId,
                    batchId: riOrigin.batchId,
                    createdAt: time,
                    isRefund: 1,
                    expectedPrice: riOrigin.costPrice,
                    actualPrice: riOrigin.costPrice,
                    quantity: -paMovement.pickingQuantity,
                    costAmount: -paMovement.pickingCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            return {
                purchaseOrder,
                purchaseOrderItemList: purchaseOrderItemOriginMap,
                productList: productModifiedList,
                batchList: batchModifiedList,
            };
        });
        return transaction;
    }
};
exports.PurchaseOrderReturnProductOperation = PurchaseOrderReturnProductOperation;
exports.PurchaseOrderReturnProductOperation = PurchaseOrderReturnProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _f : Object, typeof (_g = typeof product_picking_operation_1.ProductPickingOperation !== "undefined" && product_picking_operation_1.ProductPickingOperation) === "function" ? _g : Object])
], PurchaseOrderReturnProductOperation);


/***/ }),
/* 175 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderSendProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const variable_1 = __webpack_require__(21);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
const product_putaway_operation_1 = __webpack_require__(167);
let PurchaseOrderSendProductOperation = class PurchaseOrderSendProductOperation {
    constructor(dataSource, purchaseOrderManager, purchaseOrderItemManager, productManager, batchManager, productMovementManager, productPutawayOperation) {
        this.dataSource = dataSource;
        this.purchaseOrderManager = purchaseOrderManager;
        this.purchaseOrderItemManager = purchaseOrderItemManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.productPutawayOperation = productPutawayOperation;
    }
    async sendProduct(params) {
        const { oid, userId, purchaseOrderId, time } = params;
        const PREFIX = `PurchaseOrderId=${purchaseOrderId} ship and payment failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrder = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                oid,
                id: purchaseOrderId,
                status: { IN: [purchase_order_entity_1.PurchaseOrderStatus.Draft, purchase_order_entity_1.PurchaseOrderStatus.Deposited, purchase_order_entity_1.PurchaseOrderStatus.Executing] },
            }, { status: purchase_order_entity_1.PurchaseOrderStatus.Executing, deliveryStatus: variable_1.DeliveryStatus.Delivered });
            const purchaseOrderItemOriginList = await this.purchaseOrderItemManager.findManyBy(manager, {
                oid,
                purchaseOrderId,
            });
            if (purchaseOrderItemOriginList.length === 0)
                return { purchaseOrder };
            const purchaseOrderItemOriginMap = array_helper_1.ESArray.arrayToKeyValue(purchaseOrderItemOriginList, 'id');
            const productIdList = purchaseOrderItemOriginList.map((i) => i.productId);
            const batchIdList = purchaseOrderItemOriginList.map((i) => i.batchId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(productIdList) }, isActive: 1 }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(batchIdList) }, isActive: 1 }, { updatedAt: time });
            const putawayContainer = this.productPutawayOperation.generatePutawayPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: purchaseOrderItemOriginList.map((i) => {
                    return Object.assign(Object.assign({}, i), { voucherProductId: i.id, warehouseId: i.warehouseId, voucherBatchId: 0, costAmount: i.costPrice * i.quantity });
                }),
            });
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: putawayContainer.putawayProductList.map((i) => {
                    let purchaseOrderItem;
                    purchaseOrderItemOriginList.forEach((ri) => {
                        if (ri.productId === i.productId)
                            purchaseOrderItem = ri;
                    });
                    return {
                        id: i.productId,
                        quantity: i.closeQuantity,
                        putawayQuantity: i.putawayQuantity,
                        costPrice: purchaseOrderItem.costPrice,
                        retailPrice: purchaseOrderItem.listPrice,
                    };
                }),
                update: ['quantity', 'costPrice', 'retailPrice'],
                options: { requireEqualLength: true },
            });
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: putawayContainer.putawayBatchList
                    .filter((i) => !!i.batchId)
                    .map((i) => {
                    let purchaseOrderItem;
                    purchaseOrderItemOriginList.forEach((ri) => {
                        if (ri.batchId === i.batchId)
                            purchaseOrderItem = ri;
                    });
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        warehouseId: purchaseOrderItem.warehouseId,
                        distributorId: purchaseOrderItem.distributorId,
                        lotNumber: purchaseOrderItem.lotNumber,
                        expiryDate: purchaseOrderItem.expiryDate,
                        costPrice: purchaseOrderItem.costPrice,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: {
                    warehouseId: true,
                    distributorId: true,
                    lotNumber: true,
                    expiryDate: { cast: 'bigint' },
                    costPrice: true,
                    quantity: () => `"quantity" + "putawayQuantity"`,
                    costAmount: () => `"costAmount" + "putawayCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const productMovementInsertList = putawayContainer.putawayMovementList.map((paMovement) => {
                const purchaseOrderItem = purchaseOrderItemOriginMap[paMovement.voucherProductId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.PurchaseOrder,
                    contactId: purchaseOrder.distributorId,
                    voucherId: purchaseOrder.id,
                    voucherProductId: purchaseOrderItem.id,
                    warehouseId: paMovement.warehouseId,
                    productId: paMovement.productId,
                    batchId: paMovement.batchId,
                    createdAt: time,
                    isRefund: 0,
                    expectedPrice: purchaseOrderItem.costPrice,
                    actualPrice: purchaseOrderItem.costPrice,
                    quantity: paMovement.putawayQuantity,
                    costAmount: paMovement.putawayCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            return {
                purchaseOrder,
                purchaseOrderItemList: purchaseOrderItemOriginList,
                productList: productModifiedList,
                batchList: batchModifiedList,
            };
        });
        return transaction;
    }
};
exports.PurchaseOrderSendProductOperation = PurchaseOrderSendProductOperation;
exports.PurchaseOrderSendProductOperation = PurchaseOrderSendProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PurchaseOrderItemManager !== "undefined" && repositories_1.PurchaseOrderItemManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _f : Object, typeof (_g = typeof product_putaway_operation_1.ProductPutawayOperation !== "undefined" && product_putaway_operation_1.ProductPutawayOperation) === "function" ? _g : Object])
], PurchaseOrderSendProductOperation);


/***/ }),
/* 176 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
let StatisticProductOperation = class StatisticProductOperation {
    constructor(dataSource, manager) {
        this.dataSource = dataSource;
        this.manager = manager;
    }
    async sumWarehouse(oid) {
        const data = await this.manager.query(`
        SELECT 
            "Batch"."warehouseId",
            SUM("Batch"."costPrice" * "Batch"."quantity") AS "sumCostAmount",
            SUM("Batch"."quantity" * "Product"."retailPrice") AS "sumRetailAmount"
        FROM "Batch"
        JOIN "Product" ON "Batch"."productId" = "Product"."id"
        WHERE "Batch"."oid" = ${oid}
        GROUP BY "Batch"."warehouseId";
    `);
        return data.map((i) => ({
            warehouseId: i.warehouseId,
            sumCostAmount: Number(i.sumCostAmount),
            sumRetailAmount: Number(i.sumRetailAmount),
        }));
    }
    async topProductHighMoney(options) {
        const { oid, limit, orderBy } = options;
        const data = await this.manager.query(`
        SELECT 
            "Product".*,
            ("Product"."retailPrice" * "Product"."quantity") AS "retailAmount",
            SUM("Batch"."quantity" * "Batch"."costPrice") AS "costAmount"
        FROM "Product"
        JOIN "Batch" ON "Product"."id" = "Batch"."productId"
        WHERE "Product"."oid" = ${oid}
        GROUP BY "Product"."id"
        ORDER BY "${orderBy}" DESC
        LIMIT ${limit};
    `);
        return data.map((i) => (Object.assign(Object.assign({}, i), { retailAmount: Number(i.retailAmount), costAmount: Number(i.costAmount) })));
    }
};
exports.StatisticProductOperation = StatisticProductOperation;
exports.StatisticProductOperation = StatisticProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object])
], StatisticProductOperation);


/***/ }),
/* 177 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticPurchaseOrderOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const purchase_order_entity_1 = __webpack_require__(54);
let StatisticPurchaseOrderOperation = class StatisticPurchaseOrderOperation {
    constructor(manager) {
        this.manager = manager;
    }
    async statisticPurchaseOrder(options) {
        const { oid, timeType } = options;
        const fromTime = options.fromTime.getTime();
        const toTime = options.toTime.getTime();
        const wherePurchaseOrder = {
            oid,
            status: (0, typeorm_2.In)([purchase_order_entity_1.PurchaseOrderStatus.Debt, purchase_order_entity_1.PurchaseOrderStatus.Completed]),
            startedAt: (0, typeorm_2.Between)(fromTime, toTime),
        };
        let query = this.manager
            .createQueryBuilder(entities_1.PurchaseOrder, '"purchaseOrder"')
            .where(wherePurchaseOrder)
            .select([
            'SUM("discountMoney") AS "sumDiscountMoney"',
            'SUM("totalMoney") AS "sumTotalMoney"',
            'SUM("debt") AS "sumDebt"',
            'COUNT(*) AS "countPurchaseOrder"',
        ]);
        if (timeType === 'month') {
            query = query.addSelect(['"year"', '"month"']).groupBy('"year"').addGroupBy('"month"');
        }
        if (timeType === 'date') {
            query = query
                .addSelect(['"year"', '"month"', '"date"'])
                .groupBy('"year"')
                .addGroupBy('"month"')
                .addGroupBy('"date"');
        }
        const dataList = await query.getRawMany();
        return dataList.map((i) => ({
            oid,
            year: i.year,
            month: i.month,
            date: i.date,
            sumDiscountMoney: Number(i.sumDiscountMoney),
            sumTotalMoney: Number(i.sumTotalMoney),
            sumDebt: Number(i.sumDebt),
            countPurchaseOrder: Number(i.countPurchaseOrder),
        }));
    }
};
exports.StatisticPurchaseOrderOperation = StatisticPurchaseOrderOperation;
exports.StatisticPurchaseOrderOperation = StatisticPurchaseOrderOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _a : Object])
], StatisticPurchaseOrderOperation);


/***/ }),
/* 178 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const entities_1 = __webpack_require__(45);
const repositories_1 = __webpack_require__(42);
let StatisticTicketOperation = class StatisticTicketOperation {
    constructor(dataSource, manager, ticketRepository) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketRepository = ticketRepository;
    }
    async statistic(options) {
        const { groupTimeType, condition } = options;
        const where = this.ticketRepository.getWhereOptions(condition);
        let query = this.manager
            .createQueryBuilder(entities_1.Ticket, 'ticket')
            .where(where)
            .select([
            'COUNT(*) AS "countTicket"',
            'SUM("totalMoney") AS "sumTotalMoney"',
            'SUM("itemsCostAmount") AS "sumItemsCostAmount"',
            'SUM("procedureMoney") AS "sumProcedureMoney"',
            'SUM("productMoney") AS "sumProductMoney"',
            'SUM("radiologyMoney") AS "sumRadiologyMoney"',
            'SUM("laboratoryMoney") AS "sumLaboratoryMoney"',
            'SUM("surcharge") AS "sumSurcharge"',
            'SUM("expense") AS "sumExpense"',
            'SUM("discountMoney" + "itemsDiscount") AS "sumDiscountMoney"',
            'SUM("profit") AS "sumProfit"',
            'SUM("debt") AS "sumDebt"',
        ]);
        if (groupTimeType === 'month') {
            query = query.addSelect(['"year"', '"month"']).groupBy('"year"').addGroupBy('"month"');
        }
        if (groupTimeType === 'date') {
            query = query
                .addSelect(['"year"', '"month"', '"date"'])
                .groupBy('"year"')
                .addGroupBy('"month"')
                .addGroupBy('"date"');
        }
        const data = await query.getRawMany();
        return data.map((i) => ({
            year: i.year,
            month: i.month,
            date: i.date,
            countTicket: Number(i.countTicket),
            sumTotalMoney: Number(i.sumTotalMoney),
            sumItemsCostAmount: Number(i.sumItemsCostAmount),
            sumProcedureMoney: Number(i.sumProcedureMoney),
            sumProductMoney: Number(i.sumProductMoney),
            sumRadiologyMoney: Number(i.sumRadiologyMoney),
            sumLaboratoryMoney: Number(i.sumLaboratoryMoney),
            sumSurcharge: Number(i.sumSurcharge),
            sumExpense: Number(i.sumExpense),
            sumDiscountMoney: Number(i.sumDiscountMoney),
            sumProfit: Number(i.sumProfit),
            sumDebt: Number(i.sumDebt),
        }));
    }
};
exports.StatisticTicketOperation = StatisticTicketOperation;
exports.StatisticTicketOperation = StatisticTicketOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _c : Object])
], StatisticTicketOperation);


/***/ }),
/* 179 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketCalculatorMoney = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
let TicketCalculatorMoney = class TicketCalculatorMoney {
    constructor() { }
    reCalculatorMoney(options) {
        const { oid, ticketOrigin, ticketLaboratoryList, ticketProcedureList, ticketProductList, ticketRadiologyList, ticketUserList, } = options;
        const productMoney = ticketProductList.reduce((acc, item) => {
            return acc + item.quantity * item.actualPrice;
        }, 0);
        const procedureMoney = ticketProcedureList.reduce((acc, item) => {
            return acc + item.quantity * item.actualPrice;
        }, 0);
        const laboratoryMoney = ticketLaboratoryList.reduce((acc, item) => {
            return acc + item.actualPrice;
        }, 0);
        const radiologyMoney = ticketRadiologyList.reduce((acc, item) => {
            return acc + item.actualPrice;
        }, 0);
        const productDiscount = ticketProductList.reduce((acc, item) => {
            return acc + item.quantity * item.discountMoney;
        }, 0);
        const procedureDiscount = ticketProcedureList.reduce((acc, item) => {
            return acc + item.quantity * item.discountMoney;
        }, 0);
        const laboratoryDiscount = ticketLaboratoryList.reduce((acc, item) => {
            return acc + item.discountMoney;
        }, 0);
        const radiologyDiscount = ticketRadiologyList.reduce((acc, item) => {
            return acc + item.discountMoney;
        }, 0);
        const productCostAmount = ticketProductList.reduce((acc, item) => {
            return acc + item.costAmount;
        }, 0);
        const procedureCostAmount = ticketProcedureList.reduce((acc, item) => {
            return acc + 0;
        }, 0);
        const laboratoryCostAmount = ticketLaboratoryList.reduce((acc, item) => {
            return acc + item.costPrice;
        }, 0);
        const radiologyCostAmount = ticketRadiologyList.reduce((acc, item) => {
            return acc + item.costPrice;
        }, 0);
        const commissionMoney = ticketUserList.reduce((acc, item) => {
            return acc + item.commissionMoney;
        }, 0);
        const itemsActualMoney = productMoney + procedureMoney + laboratoryMoney + radiologyMoney;
        const itemsDiscount = productDiscount + procedureDiscount + laboratoryDiscount + radiologyDiscount;
        const itemsCostAmount = productCostAmount + procedureCostAmount + laboratoryCostAmount + radiologyCostAmount;
        const discountType = ticketOrigin.discountType;
        let discountPercent = ticketOrigin.discountPercent;
        let discountMoney = ticketOrigin.discountMoney;
        if (discountType === variable_1.DiscountType.VND) {
            discountPercent =
                itemsActualMoney == 0 ? 0 : Math.floor((discountMoney * 100) / itemsActualMoney);
        }
        if (discountType === variable_1.DiscountType.Percent) {
            discountMoney = Math.floor((discountPercent * itemsActualMoney) / 100);
        }
        const totalMoney = itemsActualMoney - discountMoney + ticketOrigin.surcharge;
        const debt = totalMoney - ticketOrigin.paid;
        const profit = totalMoney - itemsCostAmount - ticketOrigin.expense - commissionMoney;
        const ticketMoneyUpdate = {
            productMoney,
            procedureMoney,
            laboratoryMoney,
            radiologyMoney,
            itemsActualMoney,
            itemsDiscount,
            itemsCostAmount,
            commissionMoney,
            discountType,
            discountPercent,
            discountMoney,
            totalMoney,
            debt,
            profit,
        };
        return ticketMoneyUpdate;
    }
};
exports.TicketCalculatorMoney = TicketCalculatorMoney;
exports.TicketCalculatorMoney = TicketCalculatorMoney = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], TicketCalculatorMoney);


/***/ }),
/* 180 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeAllMoneyOperator = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_calculator_money_operator_1 = __webpack_require__(179);
const ticket_update_commission_ticket_user_operator_1 = __webpack_require__(181);
let TicketChangeAllMoneyOperator = class TicketChangeAllMoneyOperator {
    constructor(dataSource, manager, ticketManager, ticketProcedureManager, ticketProductManager, ticketLaboratoryManager, ticketRadiologyManager, ticketCalculatorMoney, ticketUpdateCommissionTicketUserOperator) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketCalculatorMoney = ticketCalculatorMoney;
        this.ticketUpdateCommissionTicketUserOperator = ticketUpdateCommissionTicketUserOperator;
    }
    async changeItemMoney(options) {
        const { oid } = options;
        const ticketId = options.ticketUpdate.id;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProductModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: {
                    oid,
                    ticketId,
                    deliveryStatus: variable_1.DeliveryStatus.Pending,
                    paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
                },
                compare: ['id'],
                tempList: options.ticketProductUpdate,
                update: ['quantity', 'discountMoney', 'discountPercent', 'discountType', 'actualPrice'],
                options: { requireEqualLength: true },
            });
            const ticketProcedureModifiedList = await this.ticketProcedureManager.bulkUpdate({
                manager,
                condition: {
                    oid,
                    ticketId,
                    paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
                },
                compare: ['id'],
                tempList: options.ticketProcedureUpdate,
                update: ['quantity', 'discountMoney', 'discountPercent', 'discountType', 'actualPrice'],
                options: { requireEqualLength: true },
            });
            const ticketLaboratoryModifiedList = await this.ticketLaboratoryManager.bulkUpdate({
                manager,
                condition: {
                    oid,
                    ticketId,
                    paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
                },
                compare: ['id'],
                tempList: options.ticketLaboratoryUpdate,
                update: ['discountMoney', 'discountPercent', 'discountType', 'actualPrice'],
                options: { requireEqualLength: true },
            });
            const ticketRadiologyModifiedList = await this.ticketRadiologyManager.bulkUpdate({
                manager,
                condition: {
                    oid,
                    ticketId,
                    paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
                },
                compare: ['id'],
                tempList: options.ticketRadiologyUpdate,
                update: ['discountMoney', 'discountPercent', 'discountType', 'actualPrice'],
                options: { requireEqualLength: true },
            });
            const ticketProductList = await this.ticketProductManager.findManyBy(manager, {
                oid,
                ticketId,
            });
            const ticketProcedureList = await this.ticketProcedureManager.findManyBy(manager, {
                oid,
                ticketId,
            });
            const ticketLaboratoryList = await this.ticketLaboratoryManager.findManyBy(manager, {
                oid,
                ticketId,
            });
            const ticketRadiologyList = await this.ticketRadiologyManager.findManyBy(manager, {
                oid,
                ticketId,
            });
            const { ticketUserModifiedList } = await this.ticketUpdateCommissionTicketUserOperator.updateCommissionTicketUser({
                manager,
                oid,
                ticketId,
                ticketOrigin,
                ticketLaboratoryList,
                ticketProcedureList,
                ticketRadiologyList,
                ticketProductList,
            });
            const ticketMoneyBody = this.ticketCalculatorMoney.reCalculatorMoney({
                oid,
                ticketOrigin,
                ticketProcedureList,
                ticketProductList,
                ticketLaboratoryList,
                ticketRadiologyList,
                ticketUserList: ticketUserModifiedList,
            });
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketOrigin.id }, ticketMoneyBody);
            return { ticket };
        });
        return transaction;
    }
};
exports.TicketChangeAllMoneyOperator = TicketChangeAllMoneyOperator;
exports.TicketChangeAllMoneyOperator = TicketChangeAllMoneyOperator = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _g : Object, typeof (_h = typeof ticket_calculator_money_operator_1.TicketCalculatorMoney !== "undefined" && ticket_calculator_money_operator_1.TicketCalculatorMoney) === "function" ? _h : Object, typeof (_j = typeof ticket_update_commission_ticket_user_operator_1.TicketUpdateCommissionTicketUserOperator !== "undefined" && ticket_update_commission_ticket_user_operator_1.TicketUpdateCommissionTicketUserOperator) === "function" ? _j : Object])
], TicketChangeAllMoneyOperator);


/***/ }),
/* 181 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateCommissionTicketUserOperator = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const entities_1 = __webpack_require__(45);
const position_entity_1 = __webpack_require__(76);
const ticket_product_entity_1 = __webpack_require__(71);
const repositories_1 = __webpack_require__(42);
let TicketUpdateCommissionTicketUserOperator = class TicketUpdateCommissionTicketUserOperator {
    constructor(dataSource, manager, ticketUserManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketUserManager = ticketUserManager;
    }
    async updateCommissionTicketUser(options) {
        const { manager, oid, ticketId, ticketOrigin, ticketLaboratoryList, ticketProcedureList, ticketProductList, ticketRadiologyList, } = options;
        let ticketUserOriginList = options.ticketUserOriginList;
        if (!ticketUserOriginList) {
            ticketUserOriginList = await this.ticketUserManager.findManyBy(manager, {
                oid,
                ticketId,
            });
        }
        const ticketProcedureMap = helpers_1.ESArray.arrayToKeyValue(ticketProcedureList, 'id');
        const ticketProductMap = helpers_1.ESArray.arrayToKeyValue(ticketProductList, 'id');
        const ticketLaboratoryMap = helpers_1.ESArray.arrayToKeyValue(ticketLaboratoryList, 'id');
        const ticketRadiologyMap = helpers_1.ESArray.arrayToKeyValue(ticketRadiologyList, 'id');
        const ticketUserRemoveList = [];
        const ticketUserListUpdate = ticketUserOriginList.map((tu) => {
            let actualPrice = 0;
            let expectedPrice = 0;
            let quantity = 0;
            if (tu.positionType === position_entity_1.PositionInteractType.Procedure) {
                const ticketItem = ticketProcedureMap[tu.ticketItemId];
                if (!ticketItem)
                    ticketUserRemoveList.push(tu);
                actualPrice = ticketItem.actualPrice;
                expectedPrice = ticketItem.expectedPrice;
                quantity = ticketItem.quantity;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.Product) {
                const ticketItem = ticketProductMap[tu.ticketItemId];
                if (!ticketItem)
                    ticketUserRemoveList.push(tu);
                actualPrice = ticketItem.actualPrice;
                expectedPrice = ticketItem.expectedPrice;
                quantity = ticketItem.quantity;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.Laboratory) {
                const ticketItem = ticketLaboratoryMap[tu.ticketItemId];
                if (!ticketItem)
                    ticketUserRemoveList.push(tu);
                actualPrice = ticketItem.actualPrice;
                expectedPrice = ticketItem.expectedPrice;
                quantity = 1;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.Radiology) {
                const ticketItem = ticketRadiologyMap[tu.ticketItemId];
                if (!ticketItem)
                    ticketUserRemoveList.push(tu);
                actualPrice = ticketItem.actualPrice;
                expectedPrice = ticketItem.expectedPrice;
                quantity = 1;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.Ticket) {
                expectedPrice = ticketOrigin.totalMoney + ticketOrigin.discountMoney;
                actualPrice = ticketOrigin.totalMoney;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.ConsumableList) {
                const ticketProductConsumableList = ticketProductList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Consumable;
                });
                expectedPrice = ticketProductConsumableList.reduce((acc, cur) => {
                    return acc + cur.expectedPrice * cur.quantity;
                }, 0);
                actualPrice = ticketProductConsumableList.reduce((acc, cur) => {
                    return acc + cur.actualPrice * cur.quantity;
                }, 0);
                quantity = 1;
            }
            if (tu.positionType === position_entity_1.PositionInteractType.PrescriptionList) {
                const ticketProductPrescriptionList = ticketProductList.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Prescription;
                });
                expectedPrice = ticketProductPrescriptionList.reduce((acc, cur) => {
                    return acc + cur.expectedPrice * cur.quantity;
                }, 0);
                actualPrice = ticketProductPrescriptionList.reduce((acc, cur) => {
                    return acc + cur.actualPrice * cur.quantity;
                }, 0);
                quantity = 1;
            }
            const ticketUserDto = this.reCalculatorCommission(tu, {
                actualPrice: actualPrice || 0,
                expectedPrice: expectedPrice || 0,
                quantity: quantity || 0,
            });
            return ticketUserDto;
        });
        const ticketUserModifiedList = await this.ticketUserManager.bulkUpdate({
            manager,
            tempList: ticketUserListUpdate,
            compare: ['id'],
            condition: { oid },
            update: [
                'ticketItemExpectedPrice',
                'ticketItemActualPrice',
                'quantity',
                'commissionCalculatorType',
                'commissionMoney',
                'commissionPercentActual',
                'commissionPercentExpected',
            ],
        });
        let ticketUserDestroyedList = [];
        if (ticketUserRemoveList.length) {
            ticketUserDestroyedList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                id: { IN: ticketUserRemoveList.map((i) => i.id) },
            });
        }
        return { ticketUserModifiedList, ticketUserDestroyedList };
    }
    reCalculatorCommission(ticketUserOrigin, ticketItem) {
        const quantity = ticketItem.quantity;
        const ticketItemExpectedPrice = ticketItem.expectedPrice;
        const ticketItemActualPrice = ticketItem.actualPrice;
        let commissionMoney = 0;
        let commissionPercentActual = 0;
        let commissionPercentExpected = 0;
        if (ticketUserOrigin.commissionCalculatorType === position_entity_1.CommissionCalculatorType.VND) {
            commissionMoney = ticketUserOrigin.commissionMoney;
            commissionPercentExpected =
                ticketItemExpectedPrice === 0
                    ? 0
                    : Math.floor((commissionMoney * 100) / ticketItemExpectedPrice);
            commissionPercentActual =
                ticketItemActualPrice === 0
                    ? 0
                    : Math.floor((commissionMoney * 100) / ticketItemActualPrice);
        }
        if (ticketUserOrigin.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentExpected) {
            commissionPercentExpected = ticketUserOrigin.commissionPercentExpected || 0;
            commissionMoney = Math.floor((ticketItemExpectedPrice * commissionPercentExpected) / 100);
            commissionPercentActual =
                ticketItemActualPrice === 0
                    ? 0
                    : Math.floor((commissionMoney * 100) / ticketItemActualPrice);
        }
        if (ticketUserOrigin.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentActual) {
            commissionPercentActual = ticketUserOrigin.commissionPercentActual || 0;
            commissionMoney = Math.floor((ticketItem.actualPrice * commissionPercentActual) / 100);
            commissionPercentExpected =
                ticketItemExpectedPrice === 0
                    ? 0
                    : Math.floor((commissionMoney * 100) / ticketItemExpectedPrice);
        }
        const ticketUserFix = entities_1.TicketUser.fromRaw(ticketUserOrigin);
        ticketUserFix.quantity = quantity;
        ticketUserFix.ticketItemExpectedPrice = ticketItemExpectedPrice;
        ticketUserFix.ticketItemActualPrice = ticketItemActualPrice;
        ticketUserFix.commissionMoney = commissionMoney;
        ticketUserFix.commissionPercentActual = commissionPercentActual;
        ticketUserFix.commissionPercentExpected = commissionPercentExpected;
        const ticketUserDto = {
            id: ticketUserOrigin.id,
            oid: ticketUserOrigin.oid,
            ticketId: ticketUserOrigin.ticketId,
            roleId: ticketUserOrigin.roleId,
            userId: ticketUserOrigin.userId,
            positionInteractId: ticketUserOrigin.positionInteractId,
            positionType: ticketUserOrigin.positionType,
            ticketItemId: ticketUserOrigin.ticketItemId,
            createdAt: ticketUserOrigin.createdAt,
            commissionCalculatorType: ticketUserOrigin.commissionCalculatorType,
            ticketItemExpectedPrice,
            ticketItemActualPrice,
            quantity,
            commissionMoney,
            commissionPercentActual,
            commissionPercentExpected,
        };
        return ticketUserDto;
    }
};
exports.TicketUpdateCommissionTicketUserOperator = TicketUpdateCommissionTicketUserOperator;
exports.TicketUpdateCommissionTicketUserOperator = TicketUpdateCommissionTicketUserOperator = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _c : Object])
], TicketUpdateCommissionTicketUserOperator);


/***/ }),
/* 182 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(154), exports);
__exportStar(__webpack_require__(183), exports);
__exportStar(__webpack_require__(184), exports);
__exportStar(__webpack_require__(185), exports);
__exportStar(__webpack_require__(186), exports);
__exportStar(__webpack_require__(188), exports);
__exportStar(__webpack_require__(187), exports);
__exportStar(__webpack_require__(149), exports);
__exportStar(__webpack_require__(190), exports);


/***/ }),
/* 183 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.sleep = exports.throttle = exports.debounceAsync = exports.debounce = void 0;
const debounce = (func, delay) => {
    let timeout;
    return (...args) => {
        if (timeout)
            clearTimeout(timeout);
        timeout = setTimeout(() => {
            func(...args);
            timeout = null;
        }, delay);
    };
};
exports.debounce = debounce;
const debounceAsync = (func, delay) => {
    let state = 0;
    return async (...args) => {
        state++;
        const current = state;
        await new Promise((resolve) => setTimeout(resolve, delay));
        if (current !== state)
            return null;
        return await func(...args);
    };
};
exports.debounceAsync = debounceAsync;
const throttle = (func, delay) => {
    let lastCall = 0;
    return function (...args) {
        const now = new Date().getTime();
        if (now - lastCall >= delay) {
            lastCall = now;
            return func(...args);
        }
    };
};
exports.throttle = throttle;
const sleep = async (time) => {
    await new Promise((resolve) => setTimeout(resolve, time));
};
exports.sleep = sleep;


/***/ }),
/* 184 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ESObject = void 0;
class ESObject {
    static getNestedValue(obj, keyPath) {
        return keyPath.split('.').reduce((acc, key) => {
            if (acc && typeof acc === 'object') {
                return acc[key];
            }
            return undefined;
        }, obj);
    }
    static mergeObject(...params) {
        const mergeTwoObject = (source, target) => {
            for (const key in target) {
                if (target[key] === undefined)
                    continue;
                if (typeof target[key] !== 'object'
                    || Array.isArray(target[key])
                    || target[key] instanceof Date) {
                    source[key] = target[key];
                }
                else {
                    if (typeof source[key] !== 'object') {
                        source[key] = {};
                    }
                    mergeTwoObject(source[key], target[key]);
                }
            }
        };
        for (let i = 1; i < params.length; i++) {
            mergeTwoObject(params[0], params[i]);
        }
    }
}
exports.ESObject = ESObject;
ESObject.keyBy = (array, property) => {
    const object = {};
    array.forEach((item) => {
        const key = item[property].toString();
        object[key] = item;
    });
    return object;
};


/***/ }),
/* 185 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getAllControllers = getAllControllers;
function getAllControllers(app) {
    const container = app.container;
    const modules = container.getModules();
    const result = [];
    modules.forEach((module) => {
        const { controllers } = module;
        controllers.forEach((controller, type) => {
            result.push(type);
        });
    });
    return result;
}


/***/ }),
/* 186 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.randomBloodPressure = exports.randomUsername = exports.randomDate = exports.randomFullName = exports.randomPhoneNumber = exports.randomEnum = exports.randomNumber = exports.randomItemsInArray = exports.shuffleArray = void 0;
const variable_1 = __webpack_require__(21);
const string_helper_1 = __webpack_require__(187);
const time_helper_1 = __webpack_require__(149);
const shuffleArray = (origin) => [...origin].sort(() => 0.5 - Math.random());
exports.shuffleArray = shuffleArray;
const randomItemsInArray = (items) => items[Math.floor(Math.random() * items.length)];
exports.randomItemsInArray = randomItemsInArray;
const randomNumber = (min, max, step = 1) => {
    const count = (max - min) / step + 1;
    return Math.floor(Math.random() * count) * step + min;
};
exports.randomNumber = randomNumber;
const randomEnum = (e) => {
    const keys = Object.keys(e).filter((key) => isNaN(parseInt(key)));
    const randomKey = keys[Math.floor(Math.random() * keys.length)];
    return e[randomKey];
};
exports.randomEnum = randomEnum;
const randomPhoneNumber = () => {
    const headNumber = (0, exports.randomItemsInArray)(['03', '05', '07', '08', '09']);
    const tailNumber = ('00000000' + (0, exports.randomNumber)(0, 99999999)).slice(-8);
    return headNumber + tailNumber;
};
exports.randomPhoneNumber = randomPhoneNumber;
const randomFullName = (gender, hasMiddle = true) => {
    const surname = (0, exports.randomItemsInArray)([
        'Nguyễn',
        'Lê',
        'Phạm',
        'Vũ',
        'Phan',
        'Trương',
        'Trần',
        'Bùi',
        'Đặng',
        'Đỗ',
        'Ngô',
        'Dương',
    ]);
    let middleName = '', lastName = '';
    if (gender == null)
        gender = (0, exports.randomEnum)(variable_1.EGender);
    if (gender === variable_1.EGender.Female) {
        middleName = (0, exports.randomItemsInArray)([
            'Hồng',
            'Lệ',
            'Thị',
            'Thu',
            'Thanh',
            'Tuyết',
            'Thảo',
            'Trúc',
            'Quỳnh',
        ]);
        lastName = (0, exports.randomItemsInArray)([
            'Bích',
            'Chi',
            'Diệp',
            'Diệu',
            'Duyên',
            'Hoa',
            'Huyền',
            'Hương',
            'Linh',
            'Mai',
            'Nga',
            'Ngọc',
            'Thảo',
            'Trang',
            'Quỳnh',
        ]);
    }
    else {
        middleName = (0, exports.randomItemsInArray)([
            'Anh',
            'Đình',
            'Huy',
            'Mạnh',
            'Minh',
            'Nam',
            'Ngọc',
            'Nhật',
            'Thái',
            'Thanh',
            'Văn',
            'Việt',
        ]);
        lastName = (0, exports.randomItemsInArray)([
            'Đạt',
            'Khánh',
            'Khôi',
            'Kiên',
            'Lâm',
            'Huy',
            'Hùng',
            'Hoàng',
            'Minh',
            'Nghĩa',
            'Sơn',
            'Tùng',
            'Trung',
            'Trường',
            'Thắng',
            'Quang',
            'Quân',
        ]);
    }
    if (!hasMiddle)
        return `${surname} ${lastName}`;
    return `${surname} ${middleName} ${lastName}`;
};
exports.randomFullName = randomFullName;
const randomDate = (minDate, maxDate) => {
    if (!minDate)
        minDate = new Date('1950-12-25');
    if (!maxDate)
        maxDate = new Date('2050-12-25');
    if (typeof minDate !== 'object')
        minDate = new Date(minDate);
    if (typeof maxDate !== 'object')
        maxDate = new Date(maxDate);
    const timeRandom = (0, exports.randomNumber)(minDate.getTime(), maxDate.getTime());
    return new Date(timeRandom);
};
exports.randomDate = randomDate;
const randomUsername = (fullName, birthday) => {
    if (!fullName)
        fullName = (0, exports.randomFullName)();
    if (!birthday)
        birthday = (0, exports.randomDate)('1960-01-29', '2000-12-25');
    const nameEng = (0, string_helper_1.convertViToEn)(fullName).toLowerCase();
    const text = nameEng.split(' ').slice(-2).join('');
    const number = time_helper_1.ESTimer.timeToText(birthday, 'DDMMYY');
    return text + number;
};
exports.randomUsername = randomUsername;
const randomBloodPressure = () => {
    const diastolic = (0, exports.randomNumber)(60, 120);
    const systolic = diastolic + (0, exports.randomNumber)(25, 70);
    return `${systolic}/${diastolic}`;
};
exports.randomBloodPressure = randomBloodPressure;


/***/ }),
/* 187 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.formatUrlEncode = exports.camelCaseToSnakeCase = exports.snakeCaseToCamelCase = exports.formatNumber = exports.convertViToEn = exports.decrypt = exports.encrypt = exports.randomId = exports.randomString = void 0;
const _CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789' + '!@#$%^&*()_-[]{};\':",./<>?';
const randomString = (length = 10, characters = _CHARSET) => {
    let result = '';
    for (let i = 0; i < length; i += 1) {
        result += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return result;
};
exports.randomString = randomString;
const randomId = () => Date.now().toString(36) + (0, exports.randomString)();
exports.randomId = randomId;
const generateCharset = (privateKey, charset = _CHARSET) => {
    let tempString = charset;
    let result = '';
    for (let i = 0; i < _CHARSET.length; i += 1) {
        const kIndex = i % privateKey.length;
        const charCode = privateKey.charCodeAt(kIndex);
        const tIndex = charCode % tempString.length;
        result = tempString[tIndex] + result;
        tempString = tempString.substring(tIndex + 1) + tempString.substring(0, tIndex);
    }
    return result;
};
const encrypt = (rootString, privateKey, expiryTime) => {
    if (!privateKey)
        privateKey = 'ABC123';
    const rootObject = { r: rootString, e: expiryTime != null ? Date.now() + expiryTime : null };
    const rootObjectJson = JSON.stringify(rootObject);
    let hash = generateCharset(privateKey);
    let result = '';
    for (let i = 0; i < rootObjectJson.length; i += 1) {
        hash = generateCharset(privateKey, hash);
        const index = _CHARSET.indexOf(rootObjectJson[i]);
        if (index === -1) {
            result += rootObjectJson[i];
        }
        else {
            result += hash[index];
        }
    }
    return result;
};
exports.encrypt = encrypt;
const decrypt = (cipherText, privateKey) => {
    if (!privateKey)
        privateKey = 'ABC123';
    let hash = generateCharset(privateKey);
    let rootObjectJson = '';
    for (let i = 0; i < cipherText.length; i += 1) {
        hash = generateCharset(privateKey, hash);
        const index = hash.indexOf(cipherText[i]);
        if (index === -1) {
            rootObjectJson += cipherText[i];
        }
        else {
            rootObjectJson += _CHARSET[index];
        }
    }
    let r, e;
    try {
        const parse = JSON.parse(rootObjectJson);
        r = parse.r;
        e = parse.e;
    }
    catch (error) {
        throw new Error('invalid privateKey');
    }
    if (e != null && e < Date.now()) {
        throw new Error('String invalid expiry time');
    }
    return r;
};
exports.decrypt = decrypt;
const convertViToEn = (root) => root
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/đ/g, 'd')
    .replace(/Đ/g, 'D');
exports.convertViToEn = convertViToEn;
const formatNumber = (number, part = 3, sec = ',', dec = '.') => {
    const numberStr = (number || 0).toString();
    const regex = '\\d(?=(\\d{' + part + '})+' + (numberStr.includes('.') ? '\\D' : '$') + ')';
    return numberStr.replace('.', dec).replace(new RegExp(regex, 'g'), '$&' + sec);
};
exports.formatNumber = formatNumber;
const snakeCaseToCamelCase = (input) => input.replace(/(_\w)/g, (k) => k[1].toUpperCase());
exports.snakeCaseToCamelCase = snakeCaseToCamelCase;
const camelCaseToSnakeCase = (input) => input.replace(/[A-Z]/g, (k) => `_${k.toLowerCase()}`);
exports.camelCaseToSnakeCase = camelCaseToSnakeCase;
const formatUrlEncode = (text) => {
    return text.replace(/[^a-zA-Z0-9_\-.*]+/g, '');
};
exports.formatUrlEncode = formatUrlEncode;


/***/ }),
/* 188 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HttpsGet = void 0;
const https = __webpack_require__(189);
const HttpsGet = (url) => new Promise((resolve, reject) => {
    const request = https.get(url, (res) => {
        let data = '';
        res.on('data', (chunk) => (data += chunk));
        res.on('end', () => resolve(data));
    });
    request.on('error', (err) => reject(err));
    request.end();
});
exports.HttpsGet = HttpsGet;


/***/ }),
/* 189 */
/***/ ((module) => {

module.exports = require("https");

/***/ }),
/* 190 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.stringEnum = exports.objectEnum = exports.valuesEnum = exports.keysEnum = void 0;
const keysEnum = (e) => {
    return Object.keys(e).filter((key) => isNaN(parseInt(key)));
};
exports.keysEnum = keysEnum;
const valuesEnum = (e) => {
    return (0, exports.keysEnum)(e).map((key) => e[key]);
};
exports.valuesEnum = valuesEnum;
const objectEnum = (e) => {
    return (0, exports.keysEnum)(e).reduce((acc, key) => {
        acc[key] = e[key];
        return acc;
    }, {});
};
exports.objectEnum = objectEnum;
const stringEnum = (e) => {
    const str = (0, exports.keysEnum)(e)
        .map((key) => `${key}:${e[key]}`)
        .join(', ');
    return `{ ${str} }`;
};
exports.stringEnum = stringEnum;


/***/ }),
/* 191 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeDiscountOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let TicketChangeDiscountOperation = class TicketChangeDiscountOperation {
    constructor(dataSource, ticketManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
    }
    async changeDiscount(params) {
        const { oid, ticketId, discountType, discountMoney, discountPercent } = params;
        const PREFIX = `ticketId=${ticketId} pay debt failed`;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing] },
            }, { updatedAt: Date.now() });
            const totalMoneyUpdate = ticketOrigin.itemsActualMoney - discountMoney;
            const debtUpdate = totalMoneyUpdate - ticketOrigin.paid;
            const profitUpdate = totalMoneyUpdate
                - ticketOrigin.itemsCostAmount
                - ticketOrigin.expense
                - ticketOrigin.commissionMoney;
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId }, {
                discountType,
                discountMoney,
                discountPercent,
                totalMoney: totalMoneyUpdate,
                debt: debtUpdate,
                profit: profitUpdate,
            });
            return { ticket };
        });
    }
};
exports.TicketChangeDiscountOperation = TicketChangeDiscountOperation;
exports.TicketChangeDiscountOperation = TicketChangeDiscountOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object])
], TicketChangeDiscountOperation);


/***/ }),
/* 192 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeItemMoneyManager = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const repositories_1 = __webpack_require__(42);
let TicketChangeItemMoneyManager = class TicketChangeItemMoneyManager {
    constructor(dataSource, manager, ticketManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
    }
    async changeItemMoney(options) {
        const { manager, oid, ticketOrigin, itemMoney, other } = options;
        const productMoneyUpdate = ticketOrigin.productMoney + (itemMoney.productMoneyAdd || 0);
        const procedureMoneyUpdate = ticketOrigin.procedureMoney + (itemMoney.procedureMoneyAdd || 0);
        const laboratoryMoneyUpdate = ticketOrigin.laboratoryMoney + (itemMoney.laboratoryMoneyAdd || 0);
        const radiologyMoneyUpdate = ticketOrigin.radiologyMoney + (itemMoney.radiologyMoneyAdd || 0);
        const itemsCostAmountUpdate = ticketOrigin.itemsCostAmount + (itemMoney.itemsCostAmountAdd || 0);
        const itemsDiscountUpdate = ticketOrigin.itemsDiscount + (itemMoney.itemsDiscountAdd || 0);
        const itemsActualMoneyUpdate = productMoneyUpdate + procedureMoneyUpdate + laboratoryMoneyUpdate + radiologyMoneyUpdate;
        const commissionMoneyUpdate = ticketOrigin.commissionMoney + (itemMoney.commissionMoneyAdd || 0);
        const discountType = ticketOrigin.discountType;
        let discountPercent = ticketOrigin.discountPercent;
        let discountMoney = ticketOrigin.discountMoney;
        if (discountType === variable_1.DiscountType.VND) {
            discountPercent =
                itemsActualMoneyUpdate == 0 ? 0 : Math.floor((discountMoney * 100) / itemsActualMoneyUpdate);
        }
        if (discountType === variable_1.DiscountType.Percent) {
            discountMoney = Math.floor((discountPercent * itemsActualMoneyUpdate) / 100);
        }
        const totalMoneyUpdate = itemsActualMoneyUpdate - discountMoney + ticketOrigin.surcharge;
        const debtUpdate = totalMoneyUpdate - ticketOrigin.paid;
        const profitUpdate = totalMoneyUpdate - itemsCostAmountUpdate - ticketOrigin.expense - commissionMoneyUpdate;
        const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketOrigin.id }, {
            productMoney: productMoneyUpdate != ticketOrigin.productMoney ? productMoneyUpdate : undefined,
            procedureMoney: procedureMoneyUpdate != ticketOrigin.procedureMoney ? procedureMoneyUpdate : undefined,
            laboratoryMoney: laboratoryMoneyUpdate != ticketOrigin.laboratoryMoney ? laboratoryMoneyUpdate : undefined,
            radiologyMoney: radiologyMoneyUpdate != ticketOrigin.radiologyMoney ? radiologyMoneyUpdate : undefined,
            commissionMoney: commissionMoneyUpdate != ticketOrigin.commissionMoney ? commissionMoneyUpdate : undefined,
            itemsCostAmount: itemsCostAmountUpdate != ticketOrigin.itemsCostAmount ? itemsCostAmountUpdate : undefined,
            itemsActualMoney: itemsActualMoneyUpdate,
            itemsDiscount: itemsDiscountUpdate,
            discountPercent,
            discountMoney,
            totalMoney: totalMoneyUpdate,
            debt: debtUpdate,
            profit: profitUpdate,
            deliveryStatus: (other === null || other === void 0 ? void 0 : other.deliveryStatus) != null ? other.deliveryStatus : undefined,
        });
        return ticket;
    }
};
exports.TicketChangeItemMoneyManager = TicketChangeItemMoneyManager;
exports.TicketChangeItemMoneyManager = TicketChangeItemMoneyManager = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object])
], TicketChangeItemMoneyManager);


/***/ }),
/* 193 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketCloseOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_calculator_money_operator_1 = __webpack_require__(179);
const ticket_update_commission_ticket_user_operator_1 = __webpack_require__(181);
let TicketCloseOperation = class TicketCloseOperation {
    constructor(dataSource, ticketManager, ticketProcedureManager, ticketProductManager, ticketLaboratoryManager, ticketRadiologyManager, ticketUserManager, customerManager, paymentManager, ticketUpdateCommissionTicketUserOperator, ticketCalculatorMoney) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketUserManager = ticketUserManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.ticketUpdateCommissionTicketUserOperator = ticketUpdateCommissionTicketUserOperator;
        this.ticketCalculatorMoney = ticketCalculatorMoney;
    }
    async startClose(params) {
        const { oid, ticketId, time, note, userId } = params;
        const PREFIX = `ticketId=${ticketId} close failed`;
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction('READ UNCOMMITTED');
        try {
            const manager = queryRunner.manager;
            const ticketUpdated = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing],
                },
            }, {
                status: () => `CASE 
                            WHEN(paid > "totalMoney") THEN ${ticket_entity_1.TicketStatus.Executing} 
                            WHEN(paid < "totalMoney") THEN ${ticket_entity_1.TicketStatus.Debt} 
                            ELSE ${ticket_entity_1.TicketStatus.Completed}
                        END
                        `,
                updatedAt: time,
                endedAt: time,
            });
            const ticketProcedureList = await this.ticketProcedureManager.findManyBy(manager, {
                ticketId,
            });
            const ticketProductList = await this.ticketProductManager.findManyBy(manager, { ticketId });
            const ticketLaboratoryList = await this.ticketLaboratoryManager.findManyBy(manager, {
                ticketId,
            });
            const ticketRadiologyList = await this.ticketRadiologyManager.findManyBy(manager, {
                ticketId,
            });
            const ticketUserList = await this.ticketUserManager.findManyBy(manager, { ticketId });
            if (ticketProductList.find((i) => i.deliveryStatus === variable_1.DeliveryStatus.Pending)) {
                throw new Error('Không thể đóng phiếu khi chưa xuất hết hàng');
            }
            let ticketUserModifiedList = [];
            let ticketUserDestroyedList = [];
            const ticketUserDeletedList = [];
            if (ticketUserList.length) {
                const response = await this.ticketUpdateCommissionTicketUserOperator.updateCommissionTicketUser({
                    manager,
                    oid,
                    ticketId,
                    ticketOrigin: ticketUpdated,
                    ticketLaboratoryList,
                    ticketProcedureList,
                    ticketProductList,
                    ticketRadiologyList,
                });
                ticketUserModifiedList = response.ticketUserModifiedList;
                ticketUserDestroyedList = response.ticketUserDestroyedList;
            }
            const ticketFix = this.ticketCalculatorMoney.reCalculatorMoney({
                oid,
                ticketOrigin: ticketUpdated,
                ticketProcedureList,
                ticketProductList,
                ticketLaboratoryList,
                ticketRadiologyList,
                ticketUserList: ticketUserModifiedList,
            });
            let customerModified;
            const paymentCreatedList = [];
            if (ticketUpdated.debt) {
                let paidByTopUp = 0;
                const customerOrigin = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticketUpdated.customerId }, { updatedAt: Date.now() });
                if (customerOrigin.debt < 0) {
                    const topUpMoney = -customerOrigin.debt;
                    paidByTopUp = Math.min(ticketUpdated.debt, topUpMoney);
                }
                const newDebtTicket = ticketUpdated.debt - paidByTopUp;
                const newDebtCustomer = customerOrigin.debt + paidByTopUp + newDebtTicket;
                customerModified = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticketUpdated.customerId }, { debt: newDebtCustomer });
                ticketFix.debt = newDebtTicket;
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                    voucherId: ticketId,
                    personType: payment_entity_1.PaymentPersonType.Customer,
                    personId: ticketUpdated.customerId,
                    cashierId: userId,
                    paymentMethodId: 0,
                    createdAt: time,
                    paymentActionType: payment_entity_1.PaymentActionType.Close,
                    moneyDirection: payment_entity_1.MoneyDirection.Other,
                    note: note || '',
                    paidAmount: 0,
                    debtAmount: paidByTopUp + ticketFix.debt,
                    openDebt: customerOrigin.debt,
                    closeDebt: customerModified.debt,
                };
                const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                paymentCreatedList.push(paymentCreated);
            }
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketUpdated.id }, ticketFix);
            await queryRunner.commitTransaction();
            return {
                ticketModified,
                customerModified,
                ticketUserModifiedList,
                ticketUserDeletedList,
                paymentCreatedList,
            };
        }
        catch (error) {
            console.error('error:', error);
            await queryRunner.rollbackTransaction();
            throw error;
        }
        finally {
            await queryRunner.release();
        }
    }
};
exports.TicketCloseOperation = TicketCloseOperation;
exports.TicketCloseOperation = TicketCloseOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _h : Object, typeof (_j = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _j : Object, typeof (_k = typeof ticket_update_commission_ticket_user_operator_1.TicketUpdateCommissionTicketUserOperator !== "undefined" && ticket_update_commission_ticket_user_operator_1.TicketUpdateCommissionTicketUserOperator) === "function" ? _k : Object, typeof (_l = typeof ticket_calculator_money_operator_1.TicketCalculatorMoney !== "undefined" && ticket_calculator_money_operator_1.TicketCalculatorMoney) === "function" ? _l : Object])
], TicketCloseOperation);


/***/ }),
/* 194 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReopenOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let TicketReopenOperation = class TicketReopenOperation {
    constructor(dataSource, ticketManager, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async reopen(params) {
        const { oid, userId, ticketId, time, note } = params;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId }, { endedAt: null, status: ticket_entity_1.TicketStatus.Executing });
            let customerModified;
            const paymentCreatedList = [];
            if (ticketModified.debt > 0) {
                customerModified = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: ticketModified.customerId }, { debt: () => `debt - ${ticketModified.debt}` });
                const customerCloseDebt = customerModified.debt;
                const customerOpenDebt = customerCloseDebt + ticketModified.debt;
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                    voucherId: ticketId,
                    personType: payment_entity_1.PaymentPersonType.Customer,
                    personId: ticketModified.customerId,
                    cashierId: userId,
                    paymentMethodId: 0,
                    createdAt: time,
                    paymentActionType: payment_entity_1.PaymentActionType.Reopen,
                    moneyDirection: payment_entity_1.MoneyDirection.Other,
                    paidAmount: 0,
                    debtAmount: -ticketModified.debt,
                    openDebt: customerOpenDebt,
                    closeDebt: customerCloseDebt,
                    note: note || '',
                };
                const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
                paymentCreatedList.push(paymentCreated);
            }
            return {
                ticketModified,
                customerModified: customerModified,
                paymentCreatedList,
            };
        });
        return transaction;
    }
};
exports.TicketReopenOperation = TicketReopenOperation;
exports.TicketReopenOperation = TicketReopenOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _d : Object])
], TicketReopenOperation);


/***/ }),
/* 195 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReturnProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const product_putaway_operation_1 = __webpack_require__(167);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketReturnProductOperation = class TicketReturnProductOperation {
    constructor(dataSource, ticketManager, productManager, batchManager, ticketProductManager, ticketBatchManager, ticketUserManager, ticketChangeItemMoneyManager, productMovementManager, productPutawayOperation) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
        this.productMovementManager = productMovementManager;
        this.productPutawayOperation = productPutawayOperation;
    }
    async returnProduct(data) {
        const { oid, ticketId, time, options, returnAll } = data;
        let returnList = data.returnList;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: { IN: [ticket_entity_1.TicketStatus.Executing] } }, { updatedAt: Date.now() });
            if (!returnList.length && !returnAll)
                return { ticket: ticketOrigin };
            const ticketBatchOriginList = await this.ticketBatchManager.findManyBy(manager, Object.assign({ oid,
                ticketId, deliveryStatus: variable_1.DeliveryStatus.Delivered }, (returnAll
                ? {}
                : {
                    id: { IN: returnList.filter((i) => !!i.ticketBatchId).map((i) => i.ticketBatchId) },
                })));
            if (returnAll) {
                returnList = ticketBatchOriginList.map((i) => {
                    return {
                        ticketBatchId: i.id,
                        quantityReturn: i.quantity,
                    };
                });
            }
            const ticketBatchOriginMap = array_helper_1.ESArray.arrayToKeyValue(ticketBatchOriginList, 'id');
            const ticketProductOriginList = await this.ticketProductManager.findManyBy(manager, {
                oid,
                ticketId,
                deliveryStatus: variable_1.DeliveryStatus.Delivered,
                id: { IN: ticketBatchOriginList.map((i) => i.ticketProductId) },
            });
            const ticketProductOriginMap = array_helper_1.ESArray.arrayToKeyValue(ticketProductOriginList, 'id');
            const productIdList = ticketBatchOriginList.map((i) => i.productId);
            const batchIdList = ticketBatchOriginList.map((i) => i.batchId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(productIdList) }, isActive: 1 }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, id: { IN: array_helper_1.ESArray.uniqueArray(batchIdList) }, isActive: 1 }, { updatedAt: time });
            const putawayContainer = this.productPutawayOperation.generatePutawayPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: returnList.map((i) => {
                    const ticketBatchOrigin = ticketBatchOriginMap[i.ticketBatchId];
                    return {
                        voucherProductId: ticketBatchOrigin.ticketProductId,
                        voucherBatchId: i.ticketBatchId,
                        warehouseId: ticketBatchOrigin.warehouseId,
                        productId: ticketBatchOrigin.productId,
                        batchId: ticketBatchOrigin.batchId,
                        quantity: i.quantityReturn,
                        costAmount: ticketBatchOrigin.quantity == 0
                            ? 0
                            : (ticketBatchOrigin.costAmount * i.quantityReturn) / ticketBatchOrigin.quantity,
                    };
                }),
            });
            const ticketProductModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Delivered } },
                compare: ['id', 'productId'],
                tempList: putawayContainer.putawayVoucherProductList.map((i) => {
                    return {
                        id: i.voucherProductId,
                        productId: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: (options === null || options === void 0 ? void 0 : options.changePendingIfNoStock)
                    ? {
                        quantity: (t, u) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN "quantity"
                                    ELSE "${u}"."quantity" - "${t}"."putawayQuantity"
                                  END`,
                        costAmount: () => `"costAmount" - "putawayCostAmount"`,
                        deliveryStatus: (t) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.Pending}
                                    ELSE "deliveryStatus"
                                  END`,
                    }
                    : {
                        quantity: () => `"quantity" - "putawayQuantity"`,
                        costAmount: () => `"costAmount" - "putawayCostAmount"`,
                        deliveryStatus: (t) => ` CASE
                                    WHEN  ("quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.NoStock}
                                    ELSE "deliveryStatus"
                                  END`,
                    },
                options: { requireEqualLength: true },
            });
            const ticketProductModifiedMap = array_helper_1.ESArray.arrayToKeyValue(ticketProductModifiedList, 'id');
            const ticketBatchModifiedList = await this.ticketBatchManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Delivered } },
                compare: ['id', 'ticketProductId', 'productId', 'batchId'],
                tempList: putawayContainer.putawayVoucherBatchList.map((i) => {
                    return {
                        id: i.voucherBatchId,
                        ticketProductId: i.voucherProductId,
                        productId: i.productId,
                        batchId: i.batchId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "putawayQuantity"`,
                    costAmount: () => `"costAmount" - "putawayCostAmount"`,
                    deliveryStatus: (t, u) => ` CASE
                                    WHEN  ("${u}"."quantity" = "${t}"."putawayQuantity")
                                      THEN ${variable_1.DeliveryStatus.NoStock}
                                    ELSE ${variable_1.DeliveryStatus.Delivered}
                                  END`,
                },
                options: { requireEqualLength: true },
            });
            const ticketBatchModifiedMap = array_helper_1.ESArray.arrayToKeyValue(ticketBatchModifiedList, 'id');
            const tbModifiedNoStockList = ticketBatchModifiedList.filter((i) => {
                return i.deliveryStatus === variable_1.DeliveryStatus.NoStock;
            });
            if (tbModifiedNoStockList.length) {
                await this.ticketBatchManager.deleteAndReturnEntity(manager, {
                    oid,
                    id: { IN: tbModifiedNoStockList.map((i) => i.id) },
                });
            }
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: putawayContainer.putawayProductList.map((i) => {
                    return {
                        id: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        quantity: i.closeQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = array_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: putawayContainer.putawayBatchList
                    .filter((i) => !!i.batchId)
                    .map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        putawayQuantity: i.putawayQuantity,
                        putawayCostAmount: i.putawayCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" + "putawayQuantity"`,
                    costAmount: () => `"costAmount" + "putawayCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchModifiedMap = array_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = putawayContainer.putawayMovementList.map((paMovement) => {
                const tpOrigin = ticketProductOriginMap[paMovement.voucherProductId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.Ticket,
                    contactId: ticketOrigin.customerId,
                    voucherId: ticketOrigin.id,
                    voucherProductId: tpOrigin.id,
                    warehouseId: paMovement.warehouseId,
                    productId: paMovement.productId,
                    batchId: paMovement.batchId,
                    createdAt: time,
                    isRefund: 1,
                    expectedPrice: tpOrigin.expectedPrice,
                    actualPrice: tpOrigin.actualPrice,
                    quantity: paMovement.putawayQuantity,
                    costAmount: paMovement.putawayCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            const ticketUserOriginList = await this.ticketUserManager.findManyBy(manager, {
                oid,
                ticketId,
                positionType: position_entity_1.PositionInteractType.Product,
                ticketItemId: { IN: ticketProductModifiedList.map((i) => i.id) },
            });
            let ticketUserModifiedList = [];
            let commissionMoneyReturn = 0;
            if (ticketUserOriginList.length) {
                ticketUserModifiedList = await this.ticketUserManager.bulkUpdate({
                    manager,
                    condition: { oid, ticketId, positionType: position_entity_1.PositionInteractType.Product },
                    compare: ['ticketItemId'],
                    update: ['quantity'],
                    tempList: ticketProductModifiedList.map((i) => {
                        return { quantity: i.quantity, ticketItemId: i.id };
                    }),
                });
                commissionMoneyReturn =
                    ticketUserOriginList.reduce((acc, item) => {
                        return acc + item.quantity * item.commissionMoney;
                    }, 0)
                        - ticketUserModifiedList.reduce((acc, item) => {
                            return acc + item.quantity * item.commissionMoney;
                        }, 0);
            }
            let productMoneyReturn = 0;
            let productDiscountReturn = 0;
            let itemsCostAmountReturn = 0;
            ticketProductOriginList.forEach((tpOrigin) => {
                const tpModified = ticketProductModifiedMap[tpOrigin.id];
                productMoneyReturn
                    += tpOrigin.actualPrice * tpOrigin.quantity - tpModified.actualPrice * tpModified.quantity;
                productDiscountReturn
                    += tpOrigin.discountMoney * tpOrigin.quantity
                        - tpModified.discountMoney * tpModified.quantity;
                itemsCostAmountReturn += tpOrigin.costAmount - tpModified.costAmount;
            });
            const { deliveryStatus, ticketProductList } = await this.ticketProductManager.calculatorDeliveryStatus({
                manager,
                oid,
                ticketId,
            });
            const ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                manager,
                oid,
                ticketOrigin,
                itemMoney: {
                    productMoneyAdd: -productMoneyReturn,
                    itemsCostAmountAdd: -itemsCostAmountReturn,
                    itemsDiscountAdd: -productDiscountReturn,
                    commissionMoneyAdd: -commissionMoneyReturn,
                },
                other: { deliveryStatus },
            });
            return {
                ticket,
                productModifiedList,
                batchModifiedList,
                ticketUserModifiedList,
                ticketProductModifiedAll: ticketProductList,
            };
        });
    }
};
exports.TicketReturnProductOperation = TicketReturnProductOperation;
exports.TicketReturnProductOperation = TicketReturnProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketBatchManager !== "undefined" && repositories_1.TicketBatchManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _g : Object, typeof (_h = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _h : Object, typeof (_j = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _j : Object, typeof (_k = typeof product_putaway_operation_1.ProductPutawayOperation !== "undefined" && product_putaway_operation_1.ProductPutawayOperation) === "function" ? _k : Object])
], TicketReturnProductOperation);


/***/ }),
/* 196 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSendProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const product_picking_operation_1 = __webpack_require__(166);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketSendProductOperation = class TicketSendProductOperation {
    constructor(dataSource, ticketManager, productManager, batchManager, ticketProductManager, ticketBatchManager, productMovementManager, ticketChangeItemMoneyManager, productPickingOperation) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketBatchManager = ticketBatchManager;
        this.productMovementManager = productMovementManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
        this.productPickingOperation = productPickingOperation;
    }
    async sendProduct(data) {
        const { oid, ticketId, time, sendAll, ticketProductIdList, allowNegativeQuantity } = data;
        const PREFIX = `TicketId = ${ticketId}, sendProduct failed`;
        const ERROR_LOGIC = `TicketId = ${ticketId}, sendProduct has a logic error occurred: `;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            let ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing],
                },
            }, { updatedAt: Date.now(), status: ticket_entity_1.TicketStatus.Executing });
            const ticketProductOriginList = await this.ticketProductManager.findManyBy(manager, Object.assign(Object.assign({ oid,
                ticketId }, (sendAll ? {} : { id: { IN: ticketProductIdList } })), { deliveryStatus: variable_1.DeliveryStatus.Pending }));
            if (ticketProductOriginList.length === 0) {
                return { ticketModified };
            }
            const ticketProductOriginMap = array_helper_1.ESArray.arrayToKeyValue(ticketProductOriginList, 'id');
            const productIdList = ticketProductOriginList.map((i) => i.productId);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, id: { IN: productIdList }, isActive: 1 }, { updatedAt: time });
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, productId: { IN: productIdList }, isActive: 1 }, { updatedAt: time });
            const batchOriginMap = array_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
            const pickingContainer = this.productPickingOperation.generatePickingPlan({
                productOriginList,
                batchOriginList,
                voucherBatchList: ticketProductOriginList.map((i) => {
                    return Object.assign(Object.assign({}, i), { voucherProductId: i.id, voucherBatchId: 0, costAmount: null });
                }),
                allowNegativeQuantity,
            });
            const ticketProductModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, deliveryStatus: { EQUAL: variable_1.DeliveryStatus.Pending } },
                compare: ['id', 'productId', 'quantity'],
                tempList: pickingContainer.pickingVoucherProductList.map((i) => {
                    return {
                        id: i.voucherProductId,
                        productId: i.productId,
                        quantity: i.pickingQuantity,
                        costAmount: i.pickingCostAmount,
                        deliveryStatus: variable_1.DeliveryStatus.Delivered,
                    };
                }),
                update: ['costAmount', 'deliveryStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductModifiedMap = array_helper_1.ESArray.arrayToKeyValue(ticketProductModifiedList, 'id');
            const ticketBatchInsertList = pickingContainer.pickingVoucherBatchList.map((pickingTicketBatch) => {
                const tp = ticketProductModifiedMap[pickingTicketBatch.voucherProductId];
                const batchOrigin = batchOriginMap[pickingTicketBatch.batchId];
                const ticketBatchInsert = {
                    oid,
                    ticketId,
                    customerId: tp.customerId,
                    ticketProductId: tp.id,
                    warehouseId: (batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.warehouseId) || 0,
                    productId: tp.productId,
                    batchId: pickingTicketBatch.batchId || 0,
                    deliveryStatus: variable_1.DeliveryStatus.Delivered,
                    unitRate: tp.unitRate,
                    quantity: pickingTicketBatch.pickingQuantity,
                    costAmount: pickingTicketBatch.pickingCostAmount,
                    actualPrice: tp.actualPrice,
                    expectedPrice: tp.expectedPrice,
                };
                return ticketBatchInsert;
            });
            await this.ticketBatchManager.insertManyAndReturnEntity(manager, ticketBatchInsertList);
            const productModifiedList = await this.productManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id'],
                tempList: pickingContainer.pickingProductList.map((i) => {
                    return {
                        id: i.productId,
                        quantity: i.closeQuantity,
                        pickingQuantity: i.pickingQuantity,
                    };
                }),
                update: ['quantity'],
                options: { requireEqualLength: true },
            });
            const productModifiedMap = array_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                compare: ['id', 'productId'],
                tempList: pickingContainer.pickingBatchList
                    .filter((i) => !!i.batchId)
                    .map((i) => {
                    return {
                        id: i.batchId,
                        productId: i.productId,
                        pickingQuantity: i.pickingQuantity,
                        pickingCostAmount: i.pickingCostAmount,
                    };
                }),
                update: {
                    quantity: () => `"quantity" - "pickingQuantity"`,
                    costAmount: () => `"costAmount" - "pickingCostAmount"`,
                },
                options: { requireEqualLength: true },
            });
            const batchModifiedMap = array_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productMovementInsertList = pickingContainer.pickingMovementList.map((paMovement) => {
                const tpOrigin = ticketProductOriginMap[paMovement.voucherProductId];
                const batch = batchModifiedMap[paMovement.batchId];
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.Ticket,
                    contactId: ticketModified.customerId,
                    voucherId: ticketModified.id,
                    voucherProductId: tpOrigin.id,
                    warehouseId: (batch === null || batch === void 0 ? void 0 : batch.warehouseId) || 0,
                    productId: paMovement.productId,
                    batchId: paMovement.batchId,
                    createdAt: time,
                    isRefund: 0,
                    expectedPrice: tpOrigin.expectedPrice,
                    actualPrice: tpOrigin.actualPrice,
                    quantity: -paMovement.pickingQuantity,
                    costAmount: -paMovement.pickingCostAmount,
                    openQuantityProduct: paMovement.openQuantityProduct,
                    closeQuantityProduct: paMovement.closeQuantityProduct,
                    openQuantityBatch: paMovement.openQuantityBatch,
                    closeQuantityBatch: paMovement.closeQuantityBatch,
                    openCostAmountBatch: paMovement.openCostAmountBatch,
                    closeCostAmountBatch: paMovement.closeCostAmountBatch,
                };
                return productMovementInsert;
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            const costAmountOrigin = ticketProductOriginList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            const costAmountModified = ticketProductModifiedList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            const costAmountAdd = costAmountModified - costAmountOrigin;
            const { deliveryStatus, ticketProductList } = await this.ticketProductManager.calculatorDeliveryStatus({
                manager,
                oid,
                ticketId,
            });
            if (costAmountAdd != 0 || deliveryStatus !== ticketModified.deliveryStatus) {
                ticketModified = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin: ticketModified,
                    itemMoney: {
                        itemsCostAmountAdd: costAmountAdd,
                    },
                    other: { deliveryStatus },
                });
            }
            return {
                ticketModified,
                ticketProductModifiedAll: ticketProductList,
                productModifiedList,
                batchModifiedList,
            };
        });
    }
};
exports.TicketSendProductOperation = TicketSendProductOperation;
exports.TicketSendProductOperation = TicketSendProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketBatchManager !== "undefined" && repositories_1.TicketBatchManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _g : Object, typeof (_h = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _h : Object, typeof (_j = typeof product_picking_operation_1.ProductPickingOperation !== "undefined" && product_picking_operation_1.ProductPickingOperation) === "function" ? _j : Object])
], TicketSendProductOperation);


/***/ }),
/* 197 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketProcedureListOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketAddTicketProcedureListOperation = class TicketAddTicketProcedureListOperation {
    constructor(dataSource, manager, ticketManager, ticketProcedureManager, ticketProcedureItemManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketProcedureItemManager = ticketProcedureItemManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketProcedureList(params) {
        const { oid, ticketId, ticketProcedureDtoList } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            let ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: {
                    IN: [
                        ticket_entity_1.TicketStatus.Draft,
                        ticket_entity_1.TicketStatus.Schedule,
                        ticket_entity_1.TicketStatus.Deposited,
                        ticket_entity_1.TicketStatus.Executing,
                    ],
                },
            }, { updatedAt: Date.now() });
            const ticketProcedureInsertList = ticketProcedureDtoList.map((i) => {
                const insert = Object.assign(Object.assign({}, i), { oid,
                    ticketId, customerId: ticketModified.customerId, imageIds: JSON.stringify([]), completedSessions: 0 });
                return insert;
            });
            const ticketProcedureCreatedList = await this.ticketProcedureManager.insertManyAndReturnEntity(manager, ticketProcedureInsertList);
            const ticketProcedureItemInsertList = ticketProcedureDtoList
                .map((i, index) => {
                return i.ticketProcedureItemAddList.map((j) => {
                    const insert = {
                        completedAt: j.completedAt,
                        oid,
                        ticketId,
                        ticketProcedureId: ticketProcedureCreatedList[index].id,
                        status: variable_1.TicketProcedureStatus.Pending,
                        imageIds: '[]',
                        result: '',
                    };
                    return insert;
                });
            })
                .flat();
            const ticketProcedureItemCreatedList = await this.ticketProcedureItemManager.insertManyAndReturnEntity(manager, ticketProcedureItemInsertList);
            const ticketProcedureItemCreatedMapList = helpers_1.ESArray.arrayToKeyArray(ticketProcedureItemCreatedList, 'ticketProcedureId');
            ticketProcedureCreatedList.forEach((i) => {
                i.ticketProcedureItemList = ticketProcedureItemCreatedMapList[i.id] || [];
            });
            const itemsDiscountAdd = ticketProcedureCreatedList.reduce((acc, item) => {
                return acc + item.quantity * item.discountMoney;
            }, 0);
            const procedureMoneyAdd = ticketProcedureCreatedList.reduce((acc, item) => {
                return acc + item.quantity * item.actualPrice;
            }, 0);
            if (procedureMoneyAdd != 0 || itemsDiscountAdd !== 0) {
                ticketModified = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin: ticketModified,
                    itemMoney: {
                        procedureMoneyAdd,
                        itemsDiscountAdd,
                    },
                });
            }
            return { ticketModified, ticketProcedureCreatedList };
        });
        return transaction;
    }
};
exports.TicketAddTicketProcedureListOperation = TicketAddTicketProcedureListOperation;
exports.TicketAddTicketProcedureListOperation = TicketAddTicketProcedureListOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProcedureItemManager !== "undefined" && repositories_1.TicketProcedureItemManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketAddTicketProcedureListOperation);


/***/ }),
/* 198 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketDestroyTicketProcedureOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketDestroyTicketProcedureOperation = class TicketDestroyTicketProcedureOperation {
    constructor(dataSource, ticketManager, ticketProcedureManager, ticketProcedureItemManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketProcedureItemManager = ticketProcedureItemManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketProcedure(params) {
        const { oid, ticketId, ticketProcedureId } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProcedureDestroy = await this.ticketProcedureManager.deleteOneAndReturnEntity(manager, {
                oid,
                ticketId,
                id: ticketProcedureId,
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
            });
            if (ticketProcedureDestroy.totalSessions) {
                await this.ticketProcedureItemManager.deleteAndReturnEntity(manager, {
                    oid,
                    ticketId,
                    ticketProcedureId,
                });
            }
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                positionType: position_entity_1.PositionInteractType.Procedure,
                ticketItemId: ticketProcedureDestroy.id,
            });
            const procedureMoneyDelete = ticketProcedureDestroy.quantity * ticketProcedureDestroy.actualPrice;
            const itemsDiscountDelete = ticketProcedureDestroy.quantity * ticketProcedureDestroy.discountMoney;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (procedureMoneyDelete != 0 || itemsDiscountDelete != 0 || commissionMoneyDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        procedureMoneyAdd: -procedureMoneyDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return { ticket, ticketProcedureDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketDestroyTicketProcedureOperation = TicketDestroyTicketProcedureOperation;
exports.TicketDestroyTicketProcedureOperation = TicketDestroyTicketProcedureOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureItemManager !== "undefined" && repositories_1.TicketProcedureItemManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketDestroyTicketProcedureOperation);


/***/ }),
/* 199 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketProcedureOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketUpdateTicketProcedureOperation = class TicketUpdateTicketProcedureOperation {
    constructor(dataSource, ticketManager, ticketProcedureManager, ticketProcedureItemManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketProcedureItemManager = ticketProcedureItemManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketProcedure(params) {
        const { oid, ticketId, ticketProcedureId, ticketProcedureUpdateDto, ticketProcedureItemUpdateList, } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketProcedure failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProcedureOrigin = await this.ticketProcedureManager.findOneBy(manager, {
                oid,
                ticketId,
                id: ticketProcedureId,
            });
            let ticketProcedure = ticketProcedureOrigin;
            let procedureMoneyChange = 0;
            let itemsDiscountChange = 0;
            if (ticketProcedureUpdateDto) {
                if (ticketProcedureOrigin.paymentMoneyStatus !== variable_1.PaymentMoneyStatus.Paid) {
                    ticketProcedure = await this.ticketProcedureManager.updateOneAndReturnEntity(manager, { oid, id: ticketProcedureId }, {
                        quantity: ticketProcedureUpdateDto.quantity,
                        totalSessions: ticketProcedureUpdateDto.totalSessions,
                        expectedPrice: ticketProcedureUpdateDto.expectedPrice,
                        discountType: ticketProcedureUpdateDto.discountType,
                        discountMoney: ticketProcedureUpdateDto.discountMoney,
                        discountPercent: ticketProcedureUpdateDto.discountPercent,
                        actualPrice: ticketProcedureUpdateDto.actualPrice,
                    });
                }
                else {
                    ticketProcedure = await this.ticketProcedureManager.updateOneAndReturnEntity(manager, { oid, id: ticketProcedureId }, { totalSessions: ticketProcedureUpdateDto.totalSessions });
                }
                procedureMoneyChange =
                    ticketProcedure.quantity * ticketProcedure.actualPrice
                        - ticketProcedureOrigin.quantity * ticketProcedureOrigin.actualPrice;
                itemsDiscountChange =
                    ticketProcedure.quantity * ticketProcedure.discountMoney
                        - ticketProcedureOrigin.quantity * ticketProcedureOrigin.discountMoney;
            }
            if (ticketProcedureUpdateDto.totalSessions && ticketProcedureItemUpdateList) {
                await this.ticketProcedureItemManager.delete(manager, {
                    oid,
                    ticketId,
                    ticketProcedureId,
                    status: { NOT: variable_1.TicketProcedureStatus.Completed },
                    id: { NOT_IN: [0, ...ticketProcedureItemUpdateList.map((i) => i.id)] },
                });
                const tpiInsertList = ticketProcedureItemUpdateList
                    .filter((i) => !i.id)
                    .map((i) => {
                    const insert = Object.assign(Object.assign({}, i), { status: variable_1.TicketProcedureStatus.Pending, imageIds: '[]', oid,
                        ticketId,
                        ticketProcedureId, result: '' });
                    return insert;
                });
                if (tpiInsertList.length) {
                    await this.ticketProcedureItemManager.insertMany(manager, tpiInsertList);
                }
                const tpiUpdateList = ticketProcedureItemUpdateList.filter((i) => i.id);
                if (tpiUpdateList.length) {
                    await this.ticketProcedureItemManager.bulkUpdate({
                        manager,
                        condition: { oid, ticketId, ticketProcedureId },
                        compare: ['id'],
                        tempList: tpiUpdateList,
                        update: ['completedAt'],
                        options: { requireEqualLength: true },
                    });
                }
                ticketProcedure.ticketProcedureItemList = await this.ticketProcedureItemManager.findMany(manager, {
                    condition: { oid, ticketId, ticketProcedureId },
                    sort: { id: 'ASC' },
                });
            }
            let ticket = ticketOrigin;
            if (procedureMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        procedureMoneyAdd: procedureMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                    },
                });
            }
            return { ticket, ticketProcedure };
        });
        return transaction;
    }
};
exports.TicketUpdateTicketProcedureOperation = TicketUpdateTicketProcedureOperation;
exports.TicketUpdateTicketProcedureOperation = TicketUpdateTicketProcedureOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureItemManager !== "undefined" && repositories_1.TicketProcedureItemManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketUpdateTicketProcedureOperation);


/***/ }),
/* 200 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketAddTicketProductOperation = class TicketAddTicketProductOperation {
    constructor(dataSource, manager, ticketManager, ticketProductManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketProductList(params) {
        const { oid, ticketId, ticketProductDtoList, ticketProductType } = params;
        const PREFIX = `ticketId=${ticketId} addTicketProduct failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: ticket_entity_1.TicketStatus.Executing,
            }, { updatedAt: Date.now(), deliveryStatus: variable_1.DeliveryStatus.Pending });
            const ticketProductInsertList = ticketProductDtoList.map((i) => {
                const insert = Object.assign(Object.assign({}, i), { oid,
                    ticketId, customerId: ticketOrigin.customerId, deliveryStatus: variable_1.DeliveryStatus.Pending, costAmount: i.costAmount, pickupStrategy: i.pickupStrategy, type: ticketProductType });
                return insert;
            });
            const ticketProductList = await this.ticketProductManager.insertManyAndReturnEntity(manager, ticketProductInsertList);
            const productMoneyAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.actualPrice;
            }, 0);
            const itemsDiscountAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.discountMoney;
            }, 0);
            const itemsCostAmountAdd = ticketProductList.reduce((acc, cur) => {
                return acc + cur.costAmount;
            }, 0);
            let ticket = ticketOrigin;
            if (productMoneyAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return { ticket, ticketProductList };
        });
        return transaction;
    }
};
exports.TicketAddTicketProductOperation = TicketAddTicketProductOperation;
exports.TicketAddTicketProductOperation = TicketAddTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketAddTicketProductOperation);


/***/ }),
/* 201 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketDestroyTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketDestroyTicketProductOperation = class TicketDestroyTicketProductOperation {
    constructor(dataSource, ticketManager, ticketProductManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketProduct(params) {
        const { oid, ticketId, ticketProductId, ticketProductType } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketProduct failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProductDestroy = await this.ticketProductManager.deleteOneAndReturnEntity(manager, {
                oid,
                deliveryStatus: { IN: [variable_1.DeliveryStatus.NoStock, variable_1.DeliveryStatus.Pending] },
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
                id: ticketProductId,
                type: ticketProductType,
            });
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                positionType: position_entity_1.PositionInteractType.Product,
                ticketItemId: ticketProductDestroy.id,
            });
            let deliveryStatus = ticketOrigin.deliveryStatus;
            if (ticketProductDestroy.deliveryStatus === variable_1.DeliveryStatus.Pending) {
                const calcDeliveryStatus = await this.ticketProductManager.calculatorDeliveryStatus({
                    manager,
                    oid,
                    ticketId,
                });
                deliveryStatus = calcDeliveryStatus.deliveryStatus;
            }
            const productMoneyDelete = ticketProductDestroy.quantity * ticketProductDestroy.actualPrice;
            const itemsCostAmountDelete = ticketProductDestroy.costAmount;
            const itemsDiscountDelete = ticketProductDestroy.quantity * ticketProductDestroy.discountMoney;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (productMoneyDelete != 0 || commissionMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd: -productMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                    },
                    other: { deliveryStatus },
                });
            }
            return { ticket, ticketProductDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketDestroyTicketProductOperation = TicketDestroyTicketProductOperation;
exports.TicketDestroyTicketProductOperation = TicketDestroyTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketDestroyTicketProductOperation);


/***/ }),
/* 202 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketProductOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketUpdateTicketProductOperation = class TicketUpdateTicketProductOperation {
    constructor(dataSource, ticketManager, ticketProductManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketProduct(params) {
        const { oid, ticketId, ticketProductId, ticketProductType, ticketProductUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketProduct failed: `;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketProductOrigin = await this.ticketProductManager.updateOneAndReturnEntity(manager, { oid, id: ticketProductId, type: ticketProductType }, { ticketId });
            let ticketProductModified = ticketProductOrigin;
            let productMoneyChange = 0;
            let itemsDiscountChange = 0;
            let itemsCostAmountChange = 0;
            if (ticketProductUpdateDto) {
                if ([variable_1.DeliveryStatus.Pending, variable_1.DeliveryStatus.NoStock].includes(ticketProductOrigin.deliveryStatus)
                    && [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending].includes(ticketProductOrigin.paymentMoneyStatus)) {
                    ticketProductModified = await this.ticketProductManager.updateOneAndReturnEntity(manager, { oid, id: ticketProductId }, {
                        quantity: ticketProductUpdateDto.quantity,
                        quantityPrescription: ticketProductUpdateDto.quantityPrescription,
                        printPrescription: ticketProductUpdateDto.printPrescription,
                        expectedPrice: ticketProductUpdateDto.expectedPrice,
                        discountType: ticketProductUpdateDto.discountType,
                        discountMoney: ticketProductUpdateDto.discountMoney,
                        discountPercent: ticketProductUpdateDto.discountPercent,
                        costAmount: ticketProductUpdateDto.costAmount,
                        actualPrice: ticketProductUpdateDto.actualPrice,
                        hintUsage: ticketProductUpdateDto.hintUsage,
                        deliveryStatus: ticketProductUpdateDto.quantity === 0
                            ? variable_1.DeliveryStatus.NoStock
                            : variable_1.DeliveryStatus.Pending,
                    });
                    productMoneyChange =
                        ticketProductModified.quantity * ticketProductModified.actualPrice
                            - ticketProductOrigin.quantity * ticketProductOrigin.actualPrice;
                    itemsDiscountChange =
                        ticketProductModified.quantity * ticketProductModified.discountMoney
                            - ticketProductOrigin.quantity * ticketProductOrigin.discountMoney;
                    itemsCostAmountChange = ticketProductModified.costAmount - ticketProductOrigin.costAmount;
                }
                else {
                    ticketProductModified = await this.ticketProductManager.updateOneAndReturnEntity(manager, { oid, id: ticketProductId }, {
                        quantityPrescription: ticketProductUpdateDto.quantityPrescription,
                        printPrescription: ticketProductUpdateDto.printPrescription,
                        hintUsage: ticketProductUpdateDto.hintUsage,
                    });
                }
            }
            let deliveryStatus = ticketOrigin.deliveryStatus;
            if (ticketProductModified.deliveryStatus !== variable_1.DeliveryStatus.Delivered) {
                if (ticketProductModified.quantity === 0) {
                    const calc = await this.ticketProductManager.calculatorDeliveryStatus({
                        manager,
                        oid,
                        ticketId,
                    });
                    deliveryStatus = calc.deliveryStatus;
                }
                else {
                    deliveryStatus = variable_1.DeliveryStatus.Pending;
                }
            }
            let ticket = ticketOrigin;
            if (productMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        productMoneyAdd: productMoneyChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                        itemsDiscountAdd: itemsDiscountChange,
                    },
                    other: { deliveryStatus },
                });
            }
            return { ticket, ticketProduct: ticketProductModified };
        });
        return transaction;
    }
};
exports.TicketUpdateTicketProductOperation = TicketUpdateTicketProductOperation;
exports.TicketUpdateTicketProductOperation = TicketUpdateTicketProductOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketUpdateTicketProductOperation);


/***/ }),
/* 203 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketAddTicketRadiologyOperation = class TicketAddTicketRadiologyOperation {
    constructor(dataSource, manager, ticketManager, ticketRadiologyManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyInsertDto } = params;
        const PREFIX = `ticketId=${ticketId} addTicketRadiology failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiology = await this.ticketRadiologyManager.insertOneAndReturnEntity(manager, ticketRadiologyInsertDto);
            const radiologyMoneyAdd = ticketRadiology.actualPrice;
            const itemsCostAmountAdd = ticketRadiology.costPrice;
            const itemsDiscountAdd = ticketRadiology.discountMoney;
            let ticket = ticketOrigin;
            if (radiologyMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return { ticket, ticketRadiology };
        });
        return transaction;
    }
};
exports.TicketAddTicketRadiologyOperation = TicketAddTicketRadiologyOperation;
exports.TicketAddTicketRadiologyOperation = TicketAddTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketAddTicketRadiologyOperation);


/***/ }),
/* 204 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketDestroyTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketDestroyTicketRadiologyOperation = class TicketDestroyTicketRadiologyOperation {
    constructor(dataSource, ticketManager, ticketRadiologyManager, ticketUserManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketUserManager = ticketUserManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyId } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketRadiology failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiologyDestroy = await this.ticketRadiologyManager.deleteOneAndReturnEntity(manager, {
                oid,
                id: ticketRadiologyId,
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
            });
            const ticketUserDestroyList = await this.ticketUserManager.deleteAndReturnEntity(manager, {
                oid,
                positionType: position_entity_1.PositionInteractType.Radiology,
                ticketItemId: ticketRadiologyDestroy.id,
            });
            const radiologyMoneyDelete = ticketRadiologyDestroy.actualPrice;
            const itemsDiscountDelete = ticketRadiologyDestroy.discountMoney;
            const itemsCostAmountDelete = ticketRadiologyDestroy.costPrice;
            const commissionMoneyDelete = ticketUserDestroyList.reduce((acc, item) => {
                return acc + item.commissionMoney * item.quantity;
            }, 0);
            let ticket = ticketOrigin;
            if (radiologyMoneyDelete != 0 || commissionMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd: -radiologyMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                        commissionMoneyAdd: -commissionMoneyDelete,
                    },
                });
            }
            return { ticket, ticketRadiologyDestroy, ticketUserDestroyList };
        });
        return transaction;
    }
};
exports.TicketDestroyTicketRadiologyOperation = TicketDestroyTicketRadiologyOperation;
exports.TicketDestroyTicketRadiologyOperation = TicketDestroyTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _d : Object, typeof (_e = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _e : Object])
], TicketDestroyTicketRadiologyOperation);


/***/ }),
/* 205 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketRadiologyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketUpdateTicketRadiologyOperation = class TicketUpdateTicketRadiologyOperation {
    constructor(dataSource, ticketManager, ticketRadiologyManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateMoneyTicketRadiology(params) {
        const { oid, ticketId, ticketRadiologyId, ticketRadiologyUpdateDto } = params;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketRadiologyOrigin = await this.ticketRadiologyManager.findOneBy(manager, {
                oid,
                id: ticketRadiologyId,
            });
            if (ticketRadiologyOrigin.paymentMoneyStatus === variable_1.PaymentMoneyStatus.Paid) {
                throw new error_1.BusinessError('Phiếu đã thanh toán không thể sửa');
            }
            let ticketRadiology = ticketRadiologyOrigin;
            if (ticketRadiologyUpdateDto) {
                ticketRadiology = await this.ticketRadiologyManager.updateOneAndReturnEntity(manager, { oid, id: ticketRadiologyId }, {
                    expectedPrice: ticketRadiologyUpdateDto.expectedPrice,
                    discountType: ticketRadiologyUpdateDto.discountType,
                    discountMoney: ticketRadiologyUpdateDto.discountMoney,
                    discountPercent: ticketRadiologyUpdateDto.discountPercent,
                    actualPrice: ticketRadiologyUpdateDto.actualPrice,
                });
            }
            const radiologyMoneyChange = ticketRadiology.actualPrice - ticketRadiologyOrigin.actualPrice;
            const itemsDiscountChange = ticketRadiology.discountMoney - ticketRadiologyOrigin.discountMoney;
            const itemsCostAmountChange = ticketRadiology.costPrice - ticketRadiologyOrigin.costPrice;
            let ticket = ticketOrigin;
            if (radiologyMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        radiologyMoneyAdd: radiologyMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                    },
                });
            }
            return { ticket, ticketRadiology };
        });
        return transaction;
    }
};
exports.TicketUpdateTicketRadiologyOperation = TicketUpdateTicketRadiologyOperation;
exports.TicketUpdateTicketRadiologyOperation = TicketUpdateTicketRadiologyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketUpdateTicketRadiologyOperation);


/***/ }),
/* 206 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddSelectLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketAddSelectLaboratoryOperation = class TicketAddSelectLaboratoryOperation {
    constructor(dataSource, manager, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async addSelectLaboratoryList(params) {
        const { oid, ticketId, tlgDtoList } = params;
        const PREFIX = `ticketId=${ticketId} addSelectLaboratoryList failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const tlgEntityList = tlgDtoList.map((i) => {
                const tlgEntity = Object.assign(Object.assign({}, i), { oid,
                    ticketId, roomId: i.roomId, customerId: ticketOrigin.customerId, status: variable_1.TicketLaboratoryStatus.Pending, completedAt: null, result: '' });
                return tlgEntity;
            });
            const tlgInsertList = await this.ticketLaboratoryGroupManager.insertManyAndReturnEntity(manager, tlgEntityList);
            const tlEntityList = tlgDtoList
                .map((tlgDto, tlgDtoIndex) => {
                return tlgDto.ticketLaboratoryList.map((tlDto) => {
                    const tlEntity = Object.assign(Object.assign({}, tlDto), { oid,
                        ticketId, customerId: ticketOrigin.customerId, ticketLaboratoryGroupId: tlgInsertList[tlgDtoIndex].id, roomId: tlgInsertList[tlgDtoIndex].roomId, status: variable_1.TicketLaboratoryStatus.Pending, completedAt: null });
                    return tlEntity;
                });
            })
                .flat();
            const tlInsertList = await this.ticketLaboratoryManager.insertManyAndReturnEntity(manager, tlEntityList);
            const laboratoryMoneyAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.actualPrice;
            }, 0);
            const itemsDiscountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.discountMoney;
            }, 0);
            const itemsCostAmountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.costPrice;
            }, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryInsertList: tlInsertList,
                ticketLaboratoryGroupInsertList: tlgInsertList,
            };
        });
        return transaction;
    }
};
exports.TicketAddSelectLaboratoryOperation = TicketAddSelectLaboratoryOperation;
exports.TicketAddSelectLaboratoryOperation = TicketAddSelectLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketAddSelectLaboratoryOperation);


/***/ }),
/* 207 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeSelectLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketChangeSelectLaboratoryOperation = class TicketChangeSelectLaboratoryOperation {
    constructor(dataSource, manager, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async changeSelectLaboratoryList(params) {
        const { oid, ticketId, ticketLaboratoryGroupDto, ticketLaboratoryListDto } = params;
        const PREFIX = `ticketId=${ticketId} changeSelectLaboratoryList failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            let tlgUpdate;
            if (ticketLaboratoryGroupDto.id !== 0) {
                tlgUpdate = await this.ticketLaboratoryGroupManager.updateOneAndReturnEntity(manager, { oid, ticketId, id: ticketLaboratoryGroupDto.id }, {
                    createdAt: ticketLaboratoryGroupDto.createdAt,
                    roomId: ticketLaboratoryGroupDto.roomId,
                });
            }
            const tlDestroyList = await this.ticketLaboratoryManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryGroupDto.id,
                laboratoryId: {
                    NOT_IN: [0, ...ticketLaboratoryListDto.map((i) => i.laboratoryId)],
                },
            });
            const tlKeepList = await this.ticketLaboratoryManager.findManyBy(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryGroupDto.id,
            });
            const laboratoryIdKeepList = tlKeepList.map((i) => i.laboratoryId);
            const tlEntityList = ticketLaboratoryListDto
                .filter((tlDto) => !laboratoryIdKeepList.includes(tlDto.laboratoryId))
                .map((tlDto) => {
                const tlEntity = Object.assign(Object.assign({}, tlDto), { oid,
                    ticketId, customerId: ticketOrigin.customerId, ticketLaboratoryGroupId: ticketLaboratoryGroupDto.id, roomId: ticketLaboratoryGroupDto.roomId, status: variable_1.TicketLaboratoryStatus.Pending, paymentMoneyStatus: tlgUpdate.paymentMoneyStatus, completedAt: null });
                return tlEntity;
            });
            const tlInsertList = await this.ticketLaboratoryManager.insertManyAndReturnEntity(manager, tlEntityList);
            const laboratoryMoneyAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.actualPrice;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.actualPrice;
                }, 0);
            const itemsDiscountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.discountMoney;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.discountMoney;
                }, 0);
            const itemsCostAmountAdd = tlInsertList.reduce((acc, cur) => {
                return acc + cur.costPrice;
            }, 0)
                - tlDestroyList.reduce((acc, cur) => {
                    return acc + cur.costPrice;
                }, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyAdd != 0 || itemsDiscountAdd != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd,
                        itemsDiscountAdd,
                        itemsCostAmountAdd,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryInsertList: tlInsertList,
                ticketLaboratoryDestroyList: tlDestroyList,
                ticketLaboratoryGroupUpdate: tlgUpdate,
            };
        });
        return transaction;
    }
};
exports.TicketChangeSelectLaboratoryOperation = TicketChangeSelectLaboratoryOperation;
exports.TicketChangeSelectLaboratoryOperation = TicketChangeSelectLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketChangeSelectLaboratoryOperation);


/***/ }),
/* 208 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketDestroyTicketLaboratoryGroupOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketDestroyTicketLaboratoryGroupOperation = class TicketDestroyTicketLaboratoryGroupOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketLaboratoryResultManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketLaboratoryResultManager = ticketLaboratoryResultManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketLaboratoryGroup(params) {
        const { oid, ticketId, ticketLaboratoryGroupId } = params;
        const PREFIX = `ticketId=${ticketLaboratoryGroupId} destroyTicketLaboratoryGroup failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketLaboratoryGroupDestroy = await this.ticketLaboratoryGroupManager.deleteOneAndReturnEntity(manager, {
                oid,
                ticketId,
                id: ticketLaboratoryGroupId,
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
            });
            const ticketLaboratoryDestroyList = await this.ticketLaboratoryManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId,
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
            });
            const ticketLaboratoryResultDestroyList = await this.ticketLaboratoryResultManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId,
            });
            const laboratoryMoneyDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.actualPrice, 0);
            const itemsDiscountDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.discountMoney, 0);
            const itemsCostAmountDelete = ticketLaboratoryDestroyList.reduce((acc, item) => acc + item.costPrice, 0);
            let ticket = ticketOrigin;
            if (laboratoryMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: -laboratoryMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryDestroyList,
                ticketLaboratoryGroupDestroy,
                ticketLaboratoryResultDestroyList,
            };
        });
        return transaction;
    }
};
exports.TicketDestroyTicketLaboratoryGroupOperation = TicketDestroyTicketLaboratoryGroupOperation;
exports.TicketDestroyTicketLaboratoryGroupOperation = TicketDestroyTicketLaboratoryGroupOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketLaboratoryResultManager !== "undefined" && repositories_1.TicketLaboratoryResultManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketDestroyTicketLaboratoryGroupOperation);


/***/ }),
/* 209 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketDestroyTicketLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketDestroyTicketLaboratoryOperation = class TicketDestroyTicketLaboratoryOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketLaboratoryResultManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketLaboratoryResultManager = ticketLaboratoryResultManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async destroyTicketLaboratory(params) {
        const { oid, ticketId, ticketLaboratoryId } = params;
        const PREFIX = `ticketId=${ticketId} destroyTicketLaboratory failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketLaboratoryDestroy = await this.ticketLaboratoryManager.deleteOneAndReturnEntity(manager, {
                oid,
                ticketId,
                id: ticketLaboratoryId,
                status: variable_1.TicketLaboratoryStatus.Pending,
                paymentMoneyStatus: { IN: [variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending] },
            });
            const ticketLaboratoryResultDestroyList = await this.ticketLaboratoryResultManager.deleteAndReturnEntity(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
                ticketLaboratoryId: ticketLaboratoryDestroy.id,
                laboratoryId: ticketLaboratoryDestroy.laboratoryId,
            });
            const ticketLaboratoryRemainList = await this.ticketLaboratoryManager.findManyBy(manager, {
                oid,
                ticketId,
                ticketLaboratoryGroupId: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
            });
            let ticketLaboratoryGroupDestroy = null;
            let ticketLaboratoryGroupModified = null;
            if (!ticketLaboratoryRemainList.length) {
                ticketLaboratoryGroupDestroy =
                    await this.ticketLaboratoryGroupManager.deleteOneAndReturnEntity(manager, {
                        oid,
                        ticketId,
                        id: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
                    });
            }
            else {
                const { paymentMoneyStatus } = this.ticketLaboratoryGroupManager.calculatorPaymentMoneyStatus({
                    ticketLaboratoryList: ticketLaboratoryRemainList,
                });
                ticketLaboratoryGroupModified =
                    await this.ticketLaboratoryGroupManager.updateOneAndReturnEntity(manager, {
                        oid,
                        ticketId,
                        id: ticketLaboratoryDestroy.ticketLaboratoryGroupId,
                    }, { paymentMoneyStatus });
            }
            const laboratoryMoneyDelete = ticketLaboratoryDestroy.actualPrice;
            const itemsDiscountDelete = ticketLaboratoryDestroy.discountMoney;
            const itemsCostAmountDelete = ticketLaboratoryDestroy.costPrice;
            let ticket = ticketOrigin;
            if (laboratoryMoneyDelete != 0 || itemsDiscountDelete != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: -laboratoryMoneyDelete,
                        itemsCostAmountAdd: -itemsCostAmountDelete,
                        itemsDiscountAdd: -itemsDiscountDelete,
                    },
                });
            }
            return {
                ticket,
                ticketLaboratoryDestroy,
                ticketLaboratoryGroupDestroy: ticketLaboratoryGroupDestroy,
                ticketLaboratoryGroupModified: ticketLaboratoryGroupModified,
                ticketLaboratoryResultDestroyList,
            };
        });
        return transaction;
    }
};
exports.TicketDestroyTicketLaboratoryOperation = TicketDestroyTicketLaboratoryOperation;
exports.TicketDestroyTicketLaboratoryOperation = TicketDestroyTicketLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketLaboratoryResultManager !== "undefined" && repositories_1.TicketLaboratoryResultManager) === "function" ? _e : Object, typeof (_f = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _f : Object])
], TicketDestroyTicketLaboratoryOperation);


/***/ }),
/* 210 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketLaboratoryOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const ticket_change_item_money_manager_1 = __webpack_require__(192);
let TicketUpdateTicketLaboratoryOperation = class TicketUpdateTicketLaboratoryOperation {
    constructor(dataSource, ticketManager, ticketLaboratoryManager, ticketChangeItemMoneyManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async updateTicketLaboratory(params) {
        const { oid, ticketId, ticketLaboratoryId, ticketLaboratoryUpdateDto } = params;
        const PREFIX = `ticketId=${ticketId} updateTicketLaboratory failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketOrigin = await this.ticketManager.updateOneAndReturnEntity(manager, { oid, id: ticketId, status: ticket_entity_1.TicketStatus.Executing }, { updatedAt: Date.now() });
            const ticketLaboratoryOrigin = await this.ticketLaboratoryManager.findOneBy(manager, {
                oid,
                id: ticketLaboratoryId,
            });
            if (ticketLaboratoryOrigin.paymentMoneyStatus === variable_1.PaymentMoneyStatus.Paid) {
                throw new error_1.BusinessError('Xét nghiệm đã thanh toán không thể sửa');
            }
            let ticketLaboratory = ticketLaboratoryOrigin;
            let laboratoryMoneyChange = 0;
            let itemsDiscountChange = 0;
            let itemsCostAmountChange = 0;
            if (ticketLaboratoryUpdateDto) {
                ticketLaboratory = await this.ticketLaboratoryManager.updateOneAndReturnEntity(manager, { oid, id: ticketLaboratoryId }, {
                    expectedPrice: ticketLaboratoryUpdateDto.expectedPrice,
                    discountType: ticketLaboratoryUpdateDto.discountType,
                    discountMoney: ticketLaboratoryUpdateDto.discountMoney,
                    discountPercent: ticketLaboratoryUpdateDto.discountPercent,
                    actualPrice: ticketLaboratoryUpdateDto.actualPrice,
                });
                laboratoryMoneyChange = ticketLaboratory.actualPrice - ticketLaboratoryOrigin.actualPrice;
                itemsDiscountChange = ticketLaboratory.discountMoney - ticketLaboratoryOrigin.discountMoney;
                itemsCostAmountChange = ticketLaboratory.costPrice - ticketLaboratoryOrigin.costPrice;
            }
            let ticket = ticketOrigin;
            if (laboratoryMoneyChange != 0 || itemsDiscountChange != 0) {
                ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                    manager,
                    oid,
                    ticketOrigin,
                    itemMoney: {
                        laboratoryMoneyAdd: laboratoryMoneyChange,
                        itemsDiscountAdd: itemsDiscountChange,
                        itemsCostAmountAdd: itemsCostAmountChange,
                    },
                });
            }
            return { ticket, ticketLaboratory };
        });
        return transaction;
    }
};
exports.TicketUpdateTicketLaboratoryOperation = TicketUpdateTicketLaboratoryOperation;
exports.TicketUpdateTicketLaboratoryOperation = TicketUpdateTicketLaboratoryOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _c : Object, typeof (_d = typeof ticket_change_item_money_manager_1.TicketChangeItemMoneyManager !== "undefined" && ticket_change_item_money_manager_1.TicketChangeItemMoneyManager) === "function" ? _d : Object])
], TicketUpdateTicketLaboratoryOperation);


/***/ }),
/* 211 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDepositedOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(149);
const variable_1 = __webpack_require__(21);
const ticket_product_entity_1 = __webpack_require__(71);
const repositories_1 = __webpack_require__(42);
let TicketOrderDepositedOperation = class TicketOrderDepositedOperation {
    constructor(dataSource, manager, ticketManager, ticketAttributeManager, ticketProductManager, ticketProcedureManager, ticketLaboratoryManager, ticketRadiologyManager, ticketSurchargeManager, ticketExpenseManager) {
        this.dataSource = dataSource;
        this.manager = manager;
        this.ticketManager = ticketManager;
        this.ticketAttributeManager = ticketAttributeManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketSurchargeManager = ticketSurchargeManager;
        this.ticketExpenseManager = ticketExpenseManager;
    }
    async update(params) {
        const { oid, ticketId, ticketOrderDepositedUpdateDto, ticketOrderProductDraftListDto, ticketOrderProcedureDraftListDto, ticketOrderSurchargeDraftListDto, ticketOrderExpenseDraftListDto, ticketAttributeDraftListDto, } = params;
        const registeredAt = ticketOrderDepositedUpdateDto.registeredAt;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { id: ticketId, oid }, Object.assign(Object.assign({}, ticketOrderDepositedUpdateDto), { debt: () => `${ticketOrderDepositedUpdateDto.totalMoney} - paid`, registeredAt, startedAt: registeredAt, year: time_helper_1.ESTimer.info(registeredAt, 7).year, month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1, date: time_helper_1.ESTimer.info(registeredAt, 7).date }));
            await this.ticketAttributeManager.delete(manager, { oid, ticketId });
            await this.ticketProductManager.delete(manager, { oid, ticketId });
            await this.ticketProcedureManager.delete(manager, { oid, ticketId });
            await this.ticketSurchargeManager.delete(manager, { oid, ticketId });
            await this.ticketExpenseManager.delete(manager, { oid, ticketId });
            if (ticketOrderProductDraftListDto.length) {
                const ticketProductListInsert = ticketOrderProductDraftListDto.map((i) => {
                    const ticketProduct = Object.assign(Object.assign({}, i), { oid,
                        ticketId, customerId: ticket.customerId, quantityPrescription: i.quantity, deliveryStatus: variable_1.DeliveryStatus.Pending, type: ticket_product_entity_1.TicketProductType.Prescription });
                    return ticketProduct;
                });
                ticket.ticketProductList = await this.ticketProductManager.insertManyAndReturnEntity(manager, ticketProductListInsert);
            }
            if (ticketOrderProcedureDraftListDto.length) {
                const ticketProcedureListInsert = ticketOrderProcedureDraftListDto.map((i) => {
                    const ticketProcedure = Object.assign(Object.assign({}, i), { oid,
                        ticketId, customerId: ticket.customerId, createdAt: ticket.registeredAt, status: variable_1.TicketProcedureStatus.Completed, completedSessions: 0 });
                    return ticketProcedure;
                });
                ticket.ticketProcedureList = await this.ticketProcedureManager.insertManyAndReturnEntity(manager, ticketProcedureListInsert);
            }
            if (ticketOrderSurchargeDraftListDto.length) {
                const ticketSurchargeListInsert = ticketOrderSurchargeDraftListDto.map((i) => {
                    const ticketSurcharge = Object.assign(Object.assign({}, i), { oid,
                        ticketId });
                    return ticketSurcharge;
                });
                await this.ticketSurchargeManager.insertMany(manager, ticketSurchargeListInsert);
            }
            if (ticketOrderExpenseDraftListDto.length) {
                const ticketExpenseListInsert = ticketOrderExpenseDraftListDto.map((i) => {
                    const ticketExpense = Object.assign(Object.assign({}, i), { oid,
                        ticketId });
                    return ticketExpense;
                });
                await this.ticketExpenseManager.insertMany(manager, ticketExpenseListInsert);
            }
            if (ticketAttributeDraftListDto === null || ticketAttributeDraftListDto === void 0 ? void 0 : ticketAttributeDraftListDto.length) {
                const ticketAttributeListInsert = ticketAttributeDraftListDto.map((i) => {
                    const ticketAttribute = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketAttribute;
                });
                await this.ticketAttributeManager.insertMany(manager, ticketAttributeListInsert);
            }
            return { ticket };
        });
    }
};
exports.TicketOrderDepositedOperation = TicketOrderDepositedOperation;
exports.TicketOrderDepositedOperation = TicketOrderDepositedOperation = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketAttributeManager !== "undefined" && repositories_1.TicketAttributeManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketSurchargeManager !== "undefined" && repositories_1.TicketSurchargeManager) === "function" ? _j : Object, typeof (_k = typeof repositories_1.TicketExpenseManager !== "undefined" && repositories_1.TicketExpenseManager) === "function" ? _k : Object])
], TicketOrderDepositedOperation);


/***/ }),
/* 212 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDraftOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const time_helper_1 = __webpack_require__(149);
const variable_1 = __webpack_require__(21);
const ticket_product_entity_1 = __webpack_require__(71);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let TicketOrderDraftOperation = class TicketOrderDraftOperation {
    constructor(dataSource, ticketManager, ticketAttributeManager, ticketProductManager, ticketProcedureManager, ticketSurchargeManager, ticketExpenseManager) {
        this.dataSource = dataSource;
        this.ticketManager = ticketManager;
        this.ticketAttributeManager = ticketAttributeManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketSurchargeManager = ticketSurchargeManager;
        this.ticketExpenseManager = ticketExpenseManager;
    }
    async upsert(params) {
        const { oid, ticketId, ticketOrderProductDraftListDto, ticketOrderProcedureDraftListDto, ticketOrderSurchargeDraftListDto, ticketOrderExpenseDraftListDto, ticketAttributeDraftListDto, } = params;
        const ticketOrderDraftUpsertDto = params.ticketOrderDraftUpsertDto;
        const registeredAt = ticketOrderDraftUpsertDto.registeredAt;
        return await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            let ticket;
            const ticketUpsert = Object.assign(Object.assign({}, ticketOrderDraftUpsertDto), { status: ticket_entity_1.TicketStatus.Draft, deliveryStatus: ticketOrderProductDraftListDto.length
                    ? variable_1.DeliveryStatus.Pending
                    : variable_1.DeliveryStatus.NoStock, paid: 0, debt: ticketOrderDraftUpsertDto.totalMoney, startedAt: registeredAt, year: time_helper_1.ESTimer.info(registeredAt, 7).year, month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1, date: time_helper_1.ESTimer.info(registeredAt, 7).date, dailyIndex: 0, endedAt: null, imageIds: '[]' });
            if (!ticketId) {
                ticket = await this.ticketManager.insertOneAndReturnEntity(manager, Object.assign(Object.assign({}, ticketUpsert), { oid }));
            }
            else {
                ticket = await this.ticketManager.updateOneAndReturnEntity(manager, { id: ticketId, oid }, ticketUpsert);
                await this.ticketAttributeManager.delete(manager, { oid, ticketId });
                await this.ticketProductManager.delete(manager, { oid, ticketId });
                await this.ticketProcedureManager.delete(manager, { oid, ticketId });
                await this.ticketSurchargeManager.delete(manager, { oid, ticketId });
                await this.ticketExpenseManager.delete(manager, { oid, ticketId });
            }
            if (ticketOrderProductDraftListDto.length) {
                const ticketProductListInsert = ticketOrderProductDraftListDto.map((i) => {
                    const ticketProduct = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id, customerId: ticketOrderDraftUpsertDto.customerId, deliveryStatus: variable_1.DeliveryStatus.Pending, quantityPrescription: i.quantity, type: ticket_product_entity_1.TicketProductType.Prescription, costAmount: i.costAmount });
                    return ticketProduct;
                });
                ticket.ticketProductList = await this.ticketProductManager.insertManyAndReturnEntity(manager, ticketProductListInsert);
            }
            if (ticketOrderProcedureDraftListDto) {
                const ticketProcedureListInsert = ticketOrderProcedureDraftListDto.map((i) => {
                    const ticketProcedure = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id, customerId: ticketOrderDraftUpsertDto.customerId, createdAt: ticketOrderDraftUpsertDto.registeredAt, status: variable_1.TicketProcedureStatus.Completed, imageIds: JSON.stringify([]), result: '', completedSessions: 0 });
                    return ticketProcedure;
                });
                ticket.ticketProcedureList = await this.ticketProcedureManager.insertManyAndReturnEntity(manager, ticketProcedureListInsert);
            }
            if (ticketOrderSurchargeDraftListDto.length) {
                const ticketSurchargeListInsert = ticketOrderSurchargeDraftListDto.map((i) => {
                    const ticketSurcharge = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketSurcharge;
                });
                await this.ticketSurchargeManager.insertMany(manager, ticketSurchargeListInsert);
            }
            if (ticketOrderExpenseDraftListDto.length) {
                const ticketExpenseListInsert = ticketOrderExpenseDraftListDto.map((i) => {
                    const ticketExpense = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketExpense;
                });
                await this.ticketExpenseManager.insertMany(manager, ticketExpenseListInsert);
            }
            if (ticketAttributeDraftListDto === null || ticketAttributeDraftListDto === void 0 ? void 0 : ticketAttributeDraftListDto.length) {
                const ticketAttributeListInsert = ticketAttributeDraftListDto.map((i) => {
                    const ticketAttribute = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                    return ticketAttribute;
                });
                await this.ticketAttributeManager.insertMany(manager, ticketAttributeListInsert);
            }
            return { ticket };
        });
    }
};
exports.TicketOrderDraftOperation = TicketOrderDraftOperation;
exports.TicketOrderDraftOperation = TicketOrderDraftOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketAttributeManager !== "undefined" && repositories_1.TicketAttributeManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketSurchargeManager !== "undefined" && repositories_1.TicketSurchargeManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketExpenseManager !== "undefined" && repositories_1.TicketExpenseManager) === "function" ? _g : Object])
], TicketOrderDraftOperation);


/***/ }),
/* 213 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPayDebtOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const error_1 = __webpack_require__(14);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let CustomerPayDebtOperation = class CustomerPayDebtOperation {
    constructor(dataSource, customerManager, paymentManager, ticketManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.ticketManager = ticketManager;
    }
    async startPayDebt(options) {
        const { oid, customerId, cashierId, paymentMethodId, time, paidAmount, dataList } = options;
        let note = options.note;
        const paidAmountReduce = dataList.reduce((acc, item) => acc + item.paidAmount, 0);
        if (paidAmount !== paidAmountReduce) {
            throw new error_1.BusinessError('Tổng số tiền không khớp', { paidAmount, paidAmountReduce });
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModifiedList = await this.ticketManager.bulkUpdate({
                manager,
                tempList: dataList.map((i) => ({
                    id: i.ticketId,
                    paidAmount: i.paidAmount,
                })),
                condition: {
                    oid,
                    status: ticket_entity_1.TicketStatus.Debt,
                    customerId,
                    debt: { RAW_QUERY: '"debt" >= temp."paidAmount"' },
                },
                compare: ['id'],
                update: {
                    paid: (t) => `paid + "${t}"."paidAmount"`,
                    debt: (t) => `debt - "${t}"."paidAmount"`,
                    status: (t, u) => ` CASE
                                    WHEN("${u}"."debt" = "${t}"."paidAmount") THEN ${ticket_entity_1.TicketStatus.Completed} 
                                    ELSE ${ticket_entity_1.TicketStatus.Debt}
                                  END`,
                },
                options: { requireEqualLength: true },
            });
            const customerModified = await this.customerManager.updateOneAndReturnEntity(manager, { oid, id: customerId }, { debt: () => `debt - ${paidAmount}` });
            let customerOpenDebt = customerModified.debt + paidAmount;
            if (!note && dataList.length > 0) {
                note = `Trả nợ ${paidAmount} vào ${dataList.length} đơn: ${dataList.map((i) => i.ticketId)}`;
            }
            const paymentInsertList = dataList.map((item) => {
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                    voucherId: item.ticketId,
                    personType: payment_entity_1.PaymentPersonType.Customer,
                    personId: customerId,
                    createdAt: time,
                    paymentMethodId,
                    cashierId,
                    moneyDirection: payment_entity_1.MoneyDirection.In,
                    note: note || '',
                    paidAmount: item.paidAmount,
                    paymentActionType: payment_entity_1.PaymentActionType.PayDebt,
                    debtAmount: -item.paidAmount,
                    openDebt: customerOpenDebt,
                    closeDebt: customerOpenDebt - item.paidAmount,
                };
                customerOpenDebt = paymentInsert.closeDebt;
                return paymentInsert;
            });
            const paymentCreatedList = await this.paymentManager.insertManyAndReturnEntity(manager, paymentInsertList);
            return { ticketModifiedList, customerModified, paymentCreatedList };
        });
        return transaction;
    }
};
exports.CustomerPayDebtOperation = CustomerPayDebtOperation;
exports.CustomerPayDebtOperation = CustomerPayDebtOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _d : Object])
], CustomerPayDebtOperation);


/***/ }),
/* 214 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPrepaymentMoneyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let CustomerPrepaymentMoneyOperation = class CustomerPrepaymentMoneyOperation {
    constructor(dataSource, customerManager, paymentManager, ticketManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.ticketManager = ticketManager;
    }
    async startPrePaymentMoney(options) {
        const { oid, ticketId, customerId, cashierId, paymentMethodId, time, paidAmount, note } = options;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                customerId,
                status: {
                    IN: [
                        ticket_entity_1.TicketStatus.Draft,
                        ticket_entity_1.TicketStatus.Schedule,
                        ticket_entity_1.TicketStatus.Deposited,
                        ticket_entity_1.TicketStatus.Executing,
                    ],
                },
            }, {
                paid: () => `paid + ${paidAmount}`,
                debt: () => `debt - ${paidAmount}`,
                status: () => ` CASE
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Draft}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Schedule}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Deposited}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Executing}) THEN ${ticket_entity_1.TicketStatus.Executing} 
                              ELSE ${ticket_entity_1.TicketStatus.Executing}
                          END`,
            });
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                voucherId: ticketModified.id,
                personType: payment_entity_1.PaymentPersonType.Customer,
                personId: customerId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.In,
                note: note || '',
                paidAmount,
                paymentActionType: payment_entity_1.PaymentActionType.PrepaymentMoney,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticketModified, paymentCreated, customer };
        });
        return transaction;
    }
};
exports.CustomerPrepaymentMoneyOperation = CustomerPrepaymentMoneyOperation;
exports.CustomerPrepaymentMoneyOperation = CustomerPrepaymentMoneyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _d : Object])
], CustomerPrepaymentMoneyOperation);


/***/ }),
/* 215 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPrepaymentTicketItemListOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const payment_ticket_item_entity_1 = __webpack_require__(81);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let CustomerPrepaymentTicketItemListOperation = class CustomerPrepaymentTicketItemListOperation {
    constructor(dataSource, customerManager, paymentManager, paymentTicketItemManager, ticketManager, ticketProductManager, ticketProcedureManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketRadiologyManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.paymentTicketItemManager = paymentTicketItemManager;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
    }
    async startPrepaymentTicketItemList(options) {
        const { oid, ticketId, customerId, cashierId, paymentMethodId, time, paidAmount, note, ticketItemList, } = options;
        const paidAmountReduce = ticketItemList.reduce((acc, item) => acc + item.actualPrice * item.quantity, 0);
        if (paidAmountReduce !== paidAmount) {
            throw new error_1.BusinessError('Tổng số tiền không khớp', { paidAmount, paidAmountReduce });
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                customerId,
                status: {
                    IN: [
                        ticket_entity_1.TicketStatus.Draft,
                        ticket_entity_1.TicketStatus.Schedule,
                        ticket_entity_1.TicketStatus.Deposited,
                        ticket_entity_1.TicketStatus.Executing,
                    ],
                },
            }, {
                paid: () => `paid + ${paidAmount}`,
                debt: () => `debt - ${paidAmount}`,
                status: () => ` CASE
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Draft}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Schedule}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Deposited}) THEN ${ticket_entity_1.TicketStatus.Deposited} 
                              WHEN("status" = ${ticket_entity_1.TicketStatus.Executing}) THEN ${ticket_entity_1.TicketStatus.Executing} 
                              ELSE ${ticket_entity_1.TicketStatus.Executing}
                          END`,
            });
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                voucherId: ticketModified.id,
                personType: payment_entity_1.PaymentPersonType.Customer,
                personId: customerId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.In,
                paymentActionType: payment_entity_1.PaymentActionType.PrepaymentForTicketItemList,
                note: note || '',
                paidAmount,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            const paymentTicketItemInsertList = ticketItemList.map((i) => {
                const inserter = {
                    oid,
                    paymentId: paymentCreated.id,
                    ticketId: ticketModified.id,
                    ticketItemType: i.ticketItemType,
                    ticketItemId: i.ticketItemId,
                    interactId: i.interactId,
                    expectedPrice: i.expectedPrice,
                    discountMoney: i.discountMoney,
                    discountPercent: i.discountPercent,
                    discountType: i.discountType,
                    actualPrice: i.actualPrice,
                    quantity: i.quantity,
                };
                return inserter;
            });
            const paymentTicketItemCreatedList = await this.paymentTicketItemManager.insertManyAndReturnEntity(manager, paymentTicketItemInsertList);
            const ticketProcedureModifiedList = await this.ticketProcedureManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProcedure)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductConsumableModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProductConsumable)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductPrescriptionModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProductPrescription)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketLaboratoryModifiedList = await this.ticketLaboratoryManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketLaboratory)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketRadiologyModifiedList = await this.ticketRadiologyManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketRadiology)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            let ticketLaboratoryGroupModifiedList;
            if (ticketLaboratoryModifiedList.length) {
                const tlgIdList = ticketLaboratoryModifiedList.map((i) => i.ticketLaboratoryGroupId);
                const ticketLaboratoryList = await this.ticketLaboratoryManager.findManyBy(manager, {
                    oid,
                    ticketLaboratoryGroupId: { IN: tlgIdList },
                });
                const tlgUpdateList = helpers_1.ESArray.uniqueArray(tlgIdList)
                    .filter((i) => !!i)
                    .map((tlgId) => {
                    const tlList = ticketLaboratoryList.filter((i) => i.ticketLaboratoryGroupId === tlgId);
                    const { paymentMoneyStatus } = this.ticketLaboratoryGroupManager.calculatorPaymentMoneyStatus({
                        ticketLaboratoryList: tlList,
                    });
                    return {
                        id: tlgId,
                        paymentMoneyStatus,
                    };
                });
                ticketLaboratoryGroupModifiedList = await this.ticketLaboratoryGroupManager.bulkUpdate({
                    manager,
                    compare: ['id'],
                    condition: { oid },
                    tempList: tlgUpdateList,
                    update: ['paymentMoneyStatus'],
                    options: { requireEqualLength: true },
                });
            }
            return {
                ticketModified,
                customer,
                paymentCreated,
                paymentTicketItemCreatedList,
                ticketProcedureModifiedList,
                ticketProductConsumableModifiedList,
                ticketProductPrescriptionModifiedList,
                ticketLaboratoryModifiedList,
                ticketRadiologyModifiedList,
                ticketLaboratoryGroupModifiedList,
            };
        });
        return transaction;
    }
};
exports.CustomerPrepaymentTicketItemListOperation = CustomerPrepaymentTicketItemListOperation;
exports.CustomerPrepaymentTicketItemListOperation = CustomerPrepaymentTicketItemListOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentTicketItemManager !== "undefined" && repositories_1.PaymentTicketItemManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _j : Object, typeof (_k = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _k : Object])
], CustomerPrepaymentTicketItemListOperation);


/***/ }),
/* 216 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRefundMoneyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let CustomerRefundMoneyOperation = class CustomerRefundMoneyOperation {
    constructor(dataSource, customerManager, paymentManager, ticketManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.ticketManager = ticketManager;
    }
    async startRefundMoney(options) {
        const { oid, ticketId, customerId, cashierId, paymentMethodId, time, refundAmount, note } = options;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing] },
                paid: { GTE: refundAmount },
            }, {
                paid: () => `paid - ${refundAmount}`,
                debt: () => `debt + ${refundAmount}`,
            });
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: ticketModified.customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                voucherId: ticketModified.id,
                personType: payment_entity_1.PaymentPersonType.Customer,
                personId: customerId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                paymentActionType: payment_entity_1.PaymentActionType.RefundMoney,
                note: note || '',
                paidAmount: refundAmount,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { ticketModified, customer, paymentCreated };
        });
        return transaction;
    }
};
exports.CustomerRefundMoneyOperation = CustomerRefundMoneyOperation;
exports.CustomerRefundMoneyOperation = CustomerRefundMoneyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _d : Object])
], CustomerRefundMoneyOperation);


/***/ }),
/* 217 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRefundTicketItemListOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const payment_ticket_item_entity_1 = __webpack_require__(81);
const payment_entity_1 = __webpack_require__(51);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
let CustomerRefundTicketItemListOperation = class CustomerRefundTicketItemListOperation {
    constructor(dataSource, customerManager, paymentManager, paymentTicketItemManager, ticketManager, ticketProductManager, ticketProcedureManager, ticketLaboratoryManager, ticketLaboratoryGroupManager, ticketRadiologyManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
        this.paymentTicketItemManager = paymentTicketItemManager;
        this.ticketManager = ticketManager;
        this.ticketProductManager = ticketProductManager;
        this.ticketProcedureManager = ticketProcedureManager;
        this.ticketLaboratoryManager = ticketLaboratoryManager;
        this.ticketLaboratoryGroupManager = ticketLaboratoryGroupManager;
        this.ticketRadiologyManager = ticketRadiologyManager;
    }
    async startRefundTicketItemList(options) {
        const { oid, ticketId, customerId, cashierId, paymentMethodId, time, refundAmount, note, ticketItemList, } = options;
        const refundAmountReduce = ticketItemList.reduce((acc, item) => acc + item.actualPrice * item.quantity, 0);
        if (refundAmountReduce !== refundAmount) {
            throw new error_1.BusinessError('Tổng số tiền không khớp', { refundAmount, refundAmountReduce });
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const ticketModified = await this.ticketManager.updateOneAndReturnEntity(manager, {
                oid,
                id: ticketId,
                status: { IN: [ticket_entity_1.TicketStatus.Deposited, ticket_entity_1.TicketStatus.Executing] },
                paid: { GTE: refundAmount },
            }, {
                paid: () => `paid - ${refundAmount}`,
                debt: () => `debt + ${refundAmount}`,
            });
            const customer = await this.customerManager.findOneBy(manager, {
                oid,
                id: ticketModified.customerId,
            });
            if (!customer) {
                throw new Error(`Khách hàng không tồn tại trên hệ thống`);
            }
            const customerCloseDebt = customer.debt;
            const customerOpenDebt = customer.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                voucherId: ticketModified.id,
                personType: payment_entity_1.PaymentPersonType.Customer,
                personId: customerId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                paymentActionType: payment_entity_1.PaymentActionType.RefundForTicketItemList,
                note: note || '',
                paidAmount: refundAmount,
                debtAmount: 0,
                openDebt: customerOpenDebt,
                closeDebt: customerCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            const paymentTicketItemInsertList = ticketItemList.map((i) => {
                const inserter = {
                    oid,
                    paymentId: paymentCreated.id,
                    ticketId: ticketModified.id,
                    ticketItemType: i.ticketItemType,
                    ticketItemId: i.ticketItemId,
                    interactId: i.interactId,
                    expectedPrice: i.expectedPrice,
                    discountMoney: i.discountMoney,
                    discountPercent: i.discountPercent,
                    discountType: i.discountType,
                    actualPrice: i.actualPrice,
                    quantity: i.quantity,
                };
                return inserter;
            });
            const paymentTicketItemCreatedList = await this.paymentTicketItemManager.insertManyAndReturnEntity(manager, paymentTicketItemInsertList);
            const ticketProcedureModifiedList = await this.ticketProcedureManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProcedure)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductConsumableModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProductConsumable)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketProductPrescriptionModifiedList = await this.ticketProductManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketProductPrescription)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketLaboratoryModifiedList = await this.ticketLaboratoryManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketLaboratory)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            const ticketRadiologyModifiedList = await this.ticketRadiologyManager.bulkUpdate({
                manager,
                condition: { oid, ticketId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Paid },
                compare: ['id'],
                tempList: ticketItemList
                    .filter((i) => i.ticketItemType === payment_ticket_item_entity_1.TicketItemType.TicketRadiology)
                    .map((i) => (Object.assign(Object.assign({}, i), { id: i.ticketItemId, paymentMoneyStatus: variable_1.PaymentMoneyStatus.Pending }))),
                update: ['paymentMoneyStatus'],
                options: { requireEqualLength: true },
            });
            let ticketLaboratoryGroupModifiedList;
            if (ticketLaboratoryModifiedList.length) {
                const tlgIdList = ticketLaboratoryModifiedList.map((i) => i.ticketLaboratoryGroupId);
                const ticketLaboratoryList = await this.ticketLaboratoryManager.findManyBy(manager, {
                    oid,
                    ticketLaboratoryGroupId: { IN: tlgIdList },
                });
                const tlgUpdateList = helpers_1.ESArray.uniqueArray(tlgIdList)
                    .filter((i) => !!i)
                    .map((tlgId) => {
                    const tlList = ticketLaboratoryList.filter((i) => i.ticketLaboratoryGroupId === tlgId);
                    const { paymentMoneyStatus } = this.ticketLaboratoryGroupManager.calculatorPaymentMoneyStatus({
                        ticketLaboratoryList: tlList,
                    });
                    return {
                        id: tlgId,
                        paymentMoneyStatus,
                    };
                });
                ticketLaboratoryGroupModifiedList = await this.ticketLaboratoryGroupManager.bulkUpdate({
                    manager,
                    compare: ['id'],
                    condition: { oid },
                    tempList: tlgUpdateList,
                    update: ['paymentMoneyStatus'],
                    options: { requireEqualLength: true },
                });
            }
            return {
                ticketModified,
                customer,
                paymentCreated,
                paymentTicketItemCreatedList,
                ticketProcedureModifiedList,
                ticketProductConsumableModifiedList,
                ticketProductPrescriptionModifiedList,
                ticketLaboratoryModifiedList,
                ticketRadiologyModifiedList,
                ticketLaboratoryGroupModifiedList,
            };
        });
        return transaction;
    }
};
exports.CustomerRefundTicketItemListOperation = CustomerRefundTicketItemListOperation;
exports.CustomerRefundTicketItemListOperation = CustomerRefundTicketItemListOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentTicketItemManager !== "undefined" && repositories_1.PaymentTicketItemManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketManager !== "undefined" && repositories_1.TicketManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketProcedureManager !== "undefined" && repositories_1.TicketProcedureManager) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketLaboratoryManager !== "undefined" && repositories_1.TicketLaboratoryManager) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketLaboratoryGroupManager !== "undefined" && repositories_1.TicketLaboratoryGroupManager) === "function" ? _j : Object, typeof (_k = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _k : Object])
], CustomerRefundTicketItemListOperation);


/***/ }),
/* 218 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPayDebtOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const error_1 = __webpack_require__(14);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let DistributorPayDebtOperation = class DistributorPayDebtOperation {
    constructor(dataSource, distributorManager, paymentManager, purchaseOrderManager) {
        this.dataSource = dataSource;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
        this.purchaseOrderManager = purchaseOrderManager;
    }
    async startPayDebt(options) {
        const { oid, distributorId, cashierId, paymentMethodId, time, paidAmount, note, dataList } = options;
        const paidAmountReduce = dataList.reduce((acc, item) => acc + item.paidAmount, 0);
        if (paidAmount !== paidAmountReduce) {
            throw new error_1.BusinessError('Tổng số tiền không khớp', { paidAmount, paidAmountReduce });
        }
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderModifiedList = await this.purchaseOrderManager.bulkUpdate({
                manager,
                tempList: dataList.map((i) => ({
                    id: i.purchaseOrderId,
                    paidAmount: i.paidAmount,
                })),
                condition: {
                    oid,
                    status: purchase_order_entity_1.PurchaseOrderStatus.Debt,
                    distributorId,
                    debt: { RAW_QUERY: '"debt" >= temp."paidAmount"' },
                },
                compare: ['id'],
                update: {
                    paid: (t) => `paid + "${t}"."paidAmount"`,
                    debt: (t) => `debt - "${t}"."paidAmount"`,
                    status: (t, u) => ` CASE
                                    WHEN("${u}"."debt" = "${t}"."paidAmount") THEN ${purchase_order_entity_1.PurchaseOrderStatus.Completed} 
                                    ELSE ${purchase_order_entity_1.PurchaseOrderStatus.Debt}
                                  END`,
                },
                options: { requireEqualLength: true },
            });
            const distributorModified = await this.distributorManager.updateOneAndReturnEntity(manager, { oid, id: distributorId }, { debt: () => `debt - ${paidAmount}` });
            const distributorCloseDebt = distributorModified.debt;
            const distributorOpenDebt = distributorModified.debt + paidAmount;
            const paymentInsertList = purchaseOrderModifiedList.map((purchaseOrderModified) => {
                const paymentInsert = {
                    oid,
                    voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                    voucherId: purchaseOrderModified.id,
                    personType: payment_entity_1.PaymentPersonType.Distributor,
                    personId: purchaseOrderModified.distributorId,
                    createdAt: time,
                    paymentMethodId,
                    cashierId,
                    moneyDirection: payment_entity_1.MoneyDirection.Out,
                    note: note || '',
                    paidAmount,
                    paymentActionType: payment_entity_1.PaymentActionType.PayDebt,
                    debtAmount: -paidAmount,
                    openDebt: distributorOpenDebt,
                    closeDebt: distributorCloseDebt,
                };
                return paymentInsert;
            });
            const paymentCreatedList = await this.paymentManager.insertManyAndReturnEntity(manager, paymentInsertList);
            return { purchaseOrderModifiedList, distributorModified, paymentCreatedList };
        });
        return transaction;
    }
};
exports.DistributorPayDebtOperation = DistributorPayDebtOperation;
exports.DistributorPayDebtOperation = DistributorPayDebtOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.DistributorManager !== "undefined" && repositories_1.DistributorManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _d : Object])
], DistributorPayDebtOperation);


/***/ }),
/* 219 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPrepaymentMoneyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let DistributorPrepaymentMoneyOperation = class DistributorPrepaymentMoneyOperation {
    constructor(dataSource, distributorManager, paymentManager, purchaseOrderManager) {
        this.dataSource = dataSource;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
        this.purchaseOrderManager = purchaseOrderManager;
    }
    async startPrePaymentMoney(options) {
        const { oid, purchaseOrderId, distributorId, cashierId, paymentMethodId, time, paidAmount, note } = options;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderModified = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                oid,
                id: purchaseOrderId,
                distributorId,
                status: {
                    IN: [
                        purchase_order_entity_1.PurchaseOrderStatus.Draft,
                        purchase_order_entity_1.PurchaseOrderStatus.Schedule,
                        purchase_order_entity_1.PurchaseOrderStatus.Deposited,
                        purchase_order_entity_1.PurchaseOrderStatus.Executing,
                    ],
                },
            }, {
                paid: () => `paid + ${paidAmount}`,
                debt: () => `debt - ${paidAmount}`,
                status: () => ` CASE
                              WHEN("status" = ${purchase_order_entity_1.PurchaseOrderStatus.Draft}) THEN ${purchase_order_entity_1.PurchaseOrderStatus.Deposited} 
                              WHEN("status" = ${purchase_order_entity_1.PurchaseOrderStatus.Schedule}) THEN ${purchase_order_entity_1.PurchaseOrderStatus.Deposited} 
                              WHEN("status" = ${purchase_order_entity_1.PurchaseOrderStatus.Deposited}) THEN ${purchase_order_entity_1.PurchaseOrderStatus.Deposited} 
                              WHEN("status" = ${purchase_order_entity_1.PurchaseOrderStatus.Executing}) THEN ${purchase_order_entity_1.PurchaseOrderStatus.Executing} 
                              ELSE ${purchase_order_entity_1.PurchaseOrderStatus.Executing}
                          END`,
            });
            const distributor = await this.distributorManager.findOneBy(manager, {
                oid,
                id: distributorId,
            });
            if (!distributor) {
                throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
            }
            const distributorCloseDebt = distributor.debt;
            const distributorOpenDebt = distributor.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                voucherId: purchaseOrderModified.id,
                personType: payment_entity_1.PaymentPersonType.Distributor,
                personId: distributorId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.Out,
                note: note || '',
                paidAmount,
                paymentActionType: payment_entity_1.PaymentActionType.PrepaymentMoney,
                debtAmount: 0,
                openDebt: distributorOpenDebt,
                closeDebt: distributorCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { purchaseOrderModified, paymentCreated, distributor };
        });
        return transaction;
    }
};
exports.DistributorPrepaymentMoneyOperation = DistributorPrepaymentMoneyOperation;
exports.DistributorPrepaymentMoneyOperation = DistributorPrepaymentMoneyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.DistributorManager !== "undefined" && repositories_1.DistributorManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _d : Object])
], DistributorPrepaymentMoneyOperation);


/***/ }),
/* 220 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorRefundMoneyOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const payment_entity_1 = __webpack_require__(51);
const purchase_order_entity_1 = __webpack_require__(54);
const repositories_1 = __webpack_require__(42);
let DistributorRefundMoneyOperation = class DistributorRefundMoneyOperation {
    constructor(dataSource, distributorManager, paymentManager, purchaseOrderManager) {
        this.dataSource = dataSource;
        this.distributorManager = distributorManager;
        this.paymentManager = paymentManager;
        this.purchaseOrderManager = purchaseOrderManager;
    }
    async startRefundMoney(options) {
        const { oid, purchaseOrderId, distributorId, cashierId, paymentMethodId, time, refundAmount, note } = options;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const purchaseOrderModified = await this.purchaseOrderManager.updateOneAndReturnEntity(manager, {
                oid,
                id: purchaseOrderId,
                status: { IN: [purchase_order_entity_1.PurchaseOrderStatus.Deposited, purchase_order_entity_1.PurchaseOrderStatus.Executing] },
                paid: { GTE: refundAmount },
            }, {
                paid: () => `paid - ${refundAmount}`,
                debt: () => `debt + ${refundAmount}`,
            });
            const distributor = await this.distributorManager.findOneBy(manager, {
                oid,
                id: purchaseOrderModified.distributorId,
            });
            if (!distributor) {
                throw new Error(`Nhà cung cấp không tồn tại trên hệ thống`);
            }
            const distributorCloseDebt = distributor.debt;
            const distributorOpenDebt = distributor.debt;
            const paymentInsert = {
                oid,
                voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                voucherId: purchaseOrderModified.id,
                personType: payment_entity_1.PaymentPersonType.Distributor,
                personId: distributorId,
                createdAt: time,
                paymentMethodId,
                cashierId,
                moneyDirection: payment_entity_1.MoneyDirection.In,
                paymentActionType: payment_entity_1.PaymentActionType.RefundMoney,
                note: note || '',
                paidAmount: refundAmount,
                debtAmount: 0,
                openDebt: distributorOpenDebt,
                closeDebt: distributorCloseDebt,
            };
            const paymentCreated = await this.paymentManager.insertOneAndReturnEntity(manager, paymentInsert);
            return { purchaseOrderModified, distributor, paymentCreated };
        });
        return transaction;
    }
};
exports.DistributorRefundMoneyOperation = DistributorRefundMoneyOperation;
exports.DistributorRefundMoneyOperation = DistributorRefundMoneyOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.DistributorManager !== "undefined" && repositories_1.DistributorManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PurchaseOrderManager !== "undefined" && repositories_1.PurchaseOrderManager) === "function" ? _d : Object])
], DistributorRefundMoneyOperation);


/***/ }),
/* 221 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckReconcileOperation = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const stock_check_entity_1 = __webpack_require__(87);
const repositories_1 = __webpack_require__(42);
let StockCheckReconcileOperation = class StockCheckReconcileOperation {
    constructor(dataSource, stockCheckManager, stockCheckItemManager, batchManager, productManager, productMovementManager) {
        this.dataSource = dataSource;
        this.stockCheckManager = stockCheckManager;
        this.stockCheckItemManager = stockCheckItemManager;
        this.batchManager = batchManager;
        this.productManager = productManager;
        this.productMovementManager = productMovementManager;
    }
    async startReconcile(params) {
        const { oid, stockCheckId, userId, time } = params;
        const PREFIX = `stockCheckId=${stockCheckId} StockCheckReconcileOperation failed`;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const stockCheck = await this.stockCheckManager.updateOneAndReturnEntity(manager, { oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Confirmed }, { status: stock_check_entity_1.StockCheckStatus.Balanced, updatedByUserId: userId, updatedAt: time });
            const stockCheckItemList = await this.stockCheckItemManager.findManyBy(manager, {
                oid,
                stockCheckId,
            });
            const duplicatesBatchId = array_helper_1.ESArray.checkDuplicate(stockCheckItemList, 'batchId');
            if (duplicatesBatchId.length) {
                const batchIdList = duplicatesBatchId.map((i) => i.value);
                throw new error_1.BusinessError(PREFIX, `: Có trùng lặp batchId = ${batchIdList.join('')} }`);
            }
            const batchModifiedList = await this.batchManager.bulkUpdate({
                manager,
                condition: { oid },
                tempList: stockCheckItemList.map((i) => ({
                    id: i.batchId,
                    quantity: i.actualQuantity,
                    costAmount: i.actualCostAmount,
                })),
                compare: ['id'],
                update: ['quantity', 'costAmount'],
            });
            const batchModifiedMap = array_helper_1.ESArray.arrayToKeyValue(batchModifiedList, 'id');
            const productIdList = stockCheckItemList.map((i) => i.productId);
            const productModifiedList = await this.productManager.reCalculateQuantityBySumBatchList({
                manager,
                oid,
                productIdList,
            });
            const productModifiedMap = array_helper_1.ESArray.arrayToKeyValue(productModifiedList, 'id');
            const productCalcMap = {};
            productModifiedList.forEach((i) => {
                productCalcMap[i.id] = { productId: i.id, closeQuantity: i.quantity };
            });
            const productMovementInsertList = [];
            stockCheckItemList.reverse().forEach((scItem) => {
                const productModified = productModifiedMap[scItem.productId];
                const batchModified = batchModifiedMap[scItem.batchId];
                const productCalc = productCalcMap[scItem.productId];
                const quantityDifferent = scItem.actualQuantity - scItem.systemQuantity;
                const costAmountDifferent = scItem.actualCostAmount - scItem.systemCostAmount;
                const productMovementInsert = {
                    oid,
                    movementType: variable_1.MovementType.StockCheck,
                    contactId: userId,
                    voucherId: stockCheckId,
                    voucherProductId: scItem.id,
                    warehouseId: batchModified.warehouseId,
                    productId: scItem.productId,
                    batchId: scItem.batchId || 0,
                    createdAt: time,
                    isRefund: 0,
                    expectedPrice: productModified.retailPrice,
                    actualPrice: productModified.retailPrice,
                    quantity: quantityDifferent,
                    costAmount: costAmountDifferent,
                    openQuantityProduct: productCalc.closeQuantity - quantityDifferent,
                    closeQuantityProduct: productCalc.closeQuantity,
                    openQuantityBatch: batchModified.quantity - quantityDifferent,
                    closeQuantityBatch: batchModified.quantity,
                    openCostAmountBatch: batchModified.costAmount - costAmountDifferent,
                    closeCostAmountBatch: batchModified.costAmount,
                };
                productCalc.closeQuantity = productMovementInsert.openQuantityProduct;
                productMovementInsertList.unshift(productMovementInsert);
            });
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
            return { stockCheck };
        });
        return transaction;
    }
};
exports.StockCheckReconcileOperation = StockCheckReconcileOperation;
exports.StockCheckReconcileOperation = StockCheckReconcileOperation = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.StockCheckManager !== "undefined" && repositories_1.StockCheckManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.StockCheckItemManager !== "undefined" && repositories_1.StockCheckItemManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _f : Object])
], StockCheckReconcileOperation);


/***/ }),
/* 222 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlConfig = void 0;
const config_1 = __webpack_require__(31);
const postgresql_log_1 = __webpack_require__(223);
exports.PostgresqlConfig = (0, config_1.registerAs)('postgres', () => ({
    type: process.env.SQL_TYPE,
    host: process.env.SQL_HOST,
    port: Number(process.env.SQL_PORT),
    database: process.env.SQL_DATABASE,
    username: process.env.SQL_USERNAME,
    password: process.env.SQL_PASSWORD,
    autoLoadEntities: true,
    logger: new postgresql_log_1.PrettySqlLogger({ paramType: 'ReplaceParam' }),
    logging: process.env.NODE_ENV !== 'production' ? 'all' : ['error'],
}));


/***/ }),
/* 223 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrettySqlLogger = void 0;
const cli_highlight_1 = __webpack_require__(224);
const sql_formatter_1 = __webpack_require__(225);
class PrettySqlLogger {
    constructor(data) {
        this.paramType = data.paramType;
    }
    replaceParam(query, parameters) {
        if (!(parameters === null || parameters === void 0 ? void 0 : parameters.length))
            return query;
        let result = query;
        parameters.forEach((param, index) => {
            let formatted = '';
            if (param === null || param === undefined) {
                formatted = 'NULL';
            }
            else if (typeof param === 'string') {
                formatted = `'${param.replace(/'/g, "''")}'`;
            }
            else {
                formatted = param;
            }
            result = result.replace(new RegExp(`\\$${index + 1}\\b`), String(formatted));
        });
        return result;
    }
    guessPostgresType(value) {
        if (value === null || value === undefined)
            return 'text';
        if (typeof value === 'boolean')
            return 'boolean';
        if (typeof value === 'number')
            return Number.isInteger(value) ? 'int' : 'float';
        if (typeof value === 'string') {
            if (/^[0-9a-f-]{36}$/i.test(value))
                return 'uuid';
            if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(value))
                return 'timestamp';
            if (/^\d{4}-\d{2}-\d{2}/.test(value))
                return 'date';
            return 'text';
        }
        if (value instanceof Date)
            return 'timestamp';
        if (Buffer.isBuffer(value))
            return 'bytea';
        if (Array.isArray(value))
            return `${this.guessPostgresType(value[0])}[]`;
        if (typeof value === 'object')
            return 'jsonb';
        return 'text';
    }
    guessAndFormatParamValue(value) {
        if (value === null || value === undefined)
            return 'NULL';
        if (typeof value === 'string')
            return `'${value.replace(/'/g, "''")}'`;
        if (typeof value === 'boolean')
            return value ? 'TRUE' : 'FALSE';
        return value.toString();
    }
    logQuery(query, parameters, _queryRunner) {
        if (process.env.NODE_ENV === 'production')
            return;
        let executeQuery = query;
        if (parameters === null || parameters === void 0 ? void 0 : parameters.length) {
            if (this.paramType === 'PrepareExecute') {
                const types = (parameters !== null && parameters !== void 0 ? parameters : []).map(this.guessPostgresType).join(', ');
                const values = (parameters !== null && parameters !== void 0 ? parameters : []).map(this.guessAndFormatParamValue).join(', ');
                executeQuery = `PREPARE my_query(${types}) AS\n${query};\nEXECUTE my_query(${values});`;
            }
            else if (this.paramType === 'ReplaceParam') {
                executeQuery = this.replaceParam(query, parameters);
            }
        }
        const formattedQuery = (0, sql_formatter_1.format)(executeQuery, {
            language: 'postgresql',
            newlineBeforeSemicolon: false,
            logicalOperatorNewline: 'before',
            linesBetweenQueries: 0,
            expressionWidth: 160,
        });
        const highlightedQuery = (0, cli_highlight_1.highlight)(formattedQuery, {
            language: 'sql',
            ignoreIllegals: true,
        });
        console.log('\n======== 📦 PostgreSQL Query ========');
        console.log(highlightedQuery);
    }
    logQueryError(error, query, parameters, _queryRunner) {
        console.error('==== QUERY ERROR ====');
        console.error((0, sql_formatter_1.format)(query, { language: 'postgresql' }));
        console.error('PARAMETERS:', parameters);
        console.error('ERROR:', error);
    }
    logQuerySlow(time, query, parameters, _queryRunner) {
        console.warn(`==== SLOW QUERY (${time}ms) ====`);
        console.warn((0, sql_formatter_1.format)(query, { language: 'postgresql' }));
        console.warn('PARAMETERS:', parameters);
    }
    logSchemaBuild(message) {
        console.log('Schema build:', message);
    }
    logMigration(message) {
        console.log('Migration:', message);
    }
    log(level, message) {
        console[level](message);
    }
}
exports.PrettySqlLogger = PrettySqlLogger;


/***/ }),
/* 224 */
/***/ ((module) => {

module.exports = require("cli-highlight");

/***/ }),
/* 225 */
/***/ ((module) => {

module.exports = require("sql-formatter");

/***/ }),
/* 226 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const google_driver_config_1 = __webpack_require__(227);
const google_driver_service_1 = __webpack_require__(228);
let GoogleDriverModule = class GoogleDriverModule {
};
exports.GoogleDriverModule = GoogleDriverModule;
exports.GoogleDriverModule = GoogleDriverModule = __decorate([
    (0, common_1.Module)({
        imports: [config_1.ConfigModule.forFeature(google_driver_config_1.GoogleDriverConfig)],
        controllers: [],
        providers: [google_driver_service_1.GoogleDriverService],
        exports: [google_driver_service_1.GoogleDriverService],
    })
], GoogleDriverModule);


/***/ }),
/* 227 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverConfig = void 0;
const config_1 = __webpack_require__(31);
exports.GoogleDriverConfig = (0, config_1.registerAs)('google_driver', () => ({
    clientId: process.env.GG_DRIVER_CLIENT_ID,
    clientSecret: process.env.GG_DRIVER_CLIENT_SECRET,
    redirectURI: process.env.GG_DRIVER_REDIRECT_URI,
}));


/***/ }),
/* 228 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var GoogleDriverService_1;
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GoogleDriverService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const googleapis_1 = __webpack_require__(229);
const stream = __webpack_require__(230);
const time_helper_1 = __webpack_require__(149);
const google_driver_config_1 = __webpack_require__(227);
let GoogleDriverService = GoogleDriverService_1 = class GoogleDriverService {
    constructor(googleDriverConfig) {
        this.googleDriverConfig = googleDriverConfig;
        this.logger = new common_1.Logger(GoogleDriverService_1.name);
        this.cache = {};
    }
    setCache(email, data) {
        this.cache[email] = data;
    }
    getRootFolderName() {
        return 'MEA.VN';
    }
    getDefaultFolderName(oid) {
        return `MEA_${oid.toString().padStart(3, '000')}_${new Date().getFullYear()}`;
    }
    createOAuth2Client() {
        return new googleapis_1.google.auth.OAuth2(this.googleDriverConfig.clientId, this.googleDriverConfig.clientSecret, this.googleDriverConfig.redirectURI);
    }
    createDrive(email) {
        if (!email || !this.cache[email]) {
            throw new Error('Chưa đăng nhập tài khoản Google Driver, email = ' + email);
        }
        const oAuth2Client = this.createOAuth2Client();
        oAuth2Client.setCredentials({ refresh_token: this.cache[email].refreshToken });
        const drive = googleapis_1.google.drive({
            version: 'v3',
            auth: oAuth2Client,
        });
        return drive;
    }
    async getAuthUrl(options) {
        const url = this.createOAuth2Client().generateAuthUrl({
            access_type: 'offline',
            prompt: 'consent',
            scope: [
                'https://www.googleapis.com/auth/drive',
                'https://www.googleapis.com/auth/userinfo.email',
            ],
            state: options.state,
        });
        return { url };
    }
    async logout(email) {
        this.cache[email] = null;
    }
    async loginCallback(query) {
        const oid = Number(query.state);
        const oAuth2Client = this.createOAuth2Client();
        const { tokens } = await oAuth2Client.getToken(query.code);
        const refreshToken = tokens.refresh_token;
        oAuth2Client.setCredentials({ refresh_token: refreshToken });
        const oauth2 = googleapis_1.google.oauth2({
            auth: oAuth2Client,
            version: 'v2',
        });
        const userInfo = await oauth2.userinfo.get();
        const email = userInfo.data.email;
        this.cache[email] = { refreshToken };
        const drive = this.createDrive(email);
        const rootFolder = await this.createRootFolder(drive);
        const defaultFolder = await this.createDefaultFolder(drive, {
            oid,
            rootFolderId: rootFolder.id,
        });
        this.cache[email] = {
            refreshToken,
            rootFolderId: rootFolder.id,
            defaultFolderId: defaultFolder.id,
            defaultFolderName: defaultFolder.name,
        };
        return { email, refreshToken, oid };
    }
    async createRootFolder(drive) {
        const rootFolderName = this.getRootFolderName();
        let rootFolder;
        const folderList = await this.findFolderList(drive, { folderName: rootFolderName });
        rootFolder = folderList[0];
        if (!rootFolder) {
            rootFolder = await this.createFolder(drive, { folderName: rootFolderName });
        }
        return rootFolder;
    }
    async createDefaultFolder(drive, params) {
        const { oid, rootFolderId } = params;
        const defaultFolderName = this.getDefaultFolderName(oid);
        let defaultFolder;
        const folderList = await this.findFolderList(drive, {
            folderName: defaultFolderName,
            parentId: rootFolderId,
        });
        defaultFolder = folderList[0];
        if (!defaultFolder) {
            defaultFolder = await this.createFolder(drive, {
                folderName: defaultFolderName,
                parentFolderId: rootFolderId,
            });
        }
        return defaultFolder;
    }
    async getAllFolders(email) {
        const drive = this.createDrive(email);
        const response = await drive.files.list({
            q: "mimeType='application/vnd.google-apps.folder' and trashed=false and 'me' in owners",
            fields: 'nextPageToken, files(id, name, mimeType, trashed, parents, modifiedTime)',
        });
        const folderList = response.data.files;
        return folderList;
    }
    async findFolderList(drive, condition) {
        const { folderName, parentId } = condition;
        let queryString = '';
        if (folderName)
            queryString += ` and name='${folderName}'`;
        if (parentId)
            queryString += ` and '${parentId}' in parents`;
        const response = await drive.files.list({
            q: `mimeType='application/vnd.google-apps.folder' and trashed=false and 'me' in owners`
                + queryString,
            fields: 'nextPageToken, files(id, name, mimeType, trashed, parents, modifiedTime)',
        });
        const folderList = response.data.files;
        return folderList;
    }
    async createFolder(drive, params) {
        const { folderName, parentFolderId } = params;
        const response = await drive.files.create({
            requestBody: {
                name: folderName,
                mimeType: 'application/vnd.google-apps.folder',
                parents: parentFolderId ? [parentFolderId] : [],
            },
        });
        const folder = response.data;
        await drive.permissions.create({
            fileId: folder.id,
            requestBody: {
                role: 'reader',
                type: 'anyone',
            },
        });
        return folder;
    }
    async getById(drive, fileId) {
        const response = await drive.files.get({
            fileId,
            fields: 'id, name, mimeType, parents, trashed, modifiedTime, size',
        });
        return response.data;
    }
    async trashById(drive, fileId) {
        const response = await drive.files.update({
            fileId,
            requestBody: { trashed: true },
        });
        const fileTrash = response.data;
        return fileTrash;
    }
    async deleteById(drive, fileId) {
        const response = await drive.files.update({
            fileId,
            requestBody: { trashed: true },
        });
        return response.data;
    }
    async trashMultipleFiles(options) {
        const { email, fileIds, oid } = options;
        if (!fileIds.length)
            return { success: [], failed: [] };
        let drive;
        try {
            this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start trashMultipleFiles, with ${fileIds.length} file`);
            drive = this.createDrive(email);
        }
        catch (error) {
            return { success: [], failed: fileIds };
        }
        const promiseSettled = await Promise.allSettled(fileIds.map((id) => this.trashById(drive, id)));
        const result = { success: [], failed: [] };
        promiseSettled.forEach((i, index) => {
            if (i.status === 'fulfilled') {
                result.success.push(i.value.id);
            }
            else {
                this.logger.error('Google Driver trash file error: ' + index);
                this.logger.error(i);
                result.failed.push(fileIds[index]);
            }
        });
        return result;
    }
    async deleteMultipleFiles(email, fileIds) {
        if (!fileIds.length)
            return { success: [], failed: [] };
        let drive;
        try {
            drive = this.createDrive(email);
        }
        catch (error) {
            return { success: [], failed: fileIds };
        }
        const promiseSettled = await Promise.allSettled(fileIds.map((id) => this.deleteById(drive, id)));
        const result = { success: [], failed: [] };
        promiseSettled.forEach((i, index) => {
            if (i.status === 'fulfilled') {
                result.success.push(i.value.id);
            }
            else {
                this.logger.error('Google Driver trash file error: ' + index);
                this.logger.error(i);
                result.failed.push(fileIds[index]);
            }
        });
        return result;
    }
    async createFileByStream(drive, options, permission) {
        const { title, parent, stream, mimetype } = options;
        const response = await drive.files.create({
            requestBody: {
                name: title,
                parents: [parent],
                mimeType: mimetype,
            },
            media: {
                mimeType: mimetype,
                body: stream,
            },
            fields: 'id, name, mimeType, kind, size',
        });
        const file = response.data;
        if (permission) {
            await drive.permissions.create({
                fileId: file.id,
                requestBody: {
                    role: permission.role,
                    type: permission.type,
                    emailAddress: permission.emailAddress,
                    domain: permission.domain,
                },
            });
        }
        return file;
    }
    async createFile(drive, options) {
        const { title, parent, buffer, mimetype } = options;
        const bufferStream = new stream.PassThrough();
        bufferStream.end(buffer);
        return this.createFileByStream(drive, {
            title,
            parent,
            stream: bufferStream,
            mimetype,
        }, { role: 'reader', type: 'anyone' });
    }
    async uploadFileStream(options) {
        const { fileStream, email, oid, fileName, mimetype, permission } = options;
        if (!fileStream)
            return null;
        this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start uploadFileStream with fine name ${fileName}`);
        const drive = this.createDrive(email);
        if (!this.cache[email].rootFolderId) {
            const rootFolder = await this.createRootFolder(drive);
            this.cache[email].rootFolderId = rootFolder.id;
        }
        if (this.cache[email].defaultFolderName !== this.getDefaultFolderName(oid)) {
            const defaultFolder = await this.createDefaultFolder(drive, {
                oid,
                rootFolderId: this.cache[email].rootFolderId,
            });
            this.cache[email].defaultFolderId = defaultFolder.id;
            this.cache[email].defaultFolderName = defaultFolder.name;
        }
        const file = await this.createFileByStream(drive, {
            title: fileName,
            parent: this.cache[email].defaultFolderId,
            stream: fileStream,
            mimetype,
        }, permission);
        return file;
    }
    async uploadMultipleFiles(options) {
        const { files, email, oid, customerId } = options;
        if (!files.length)
            return [];
        this.logger.debug(`[OID=${oid}] GoogleDriver ${email} start uploadMultipleFiles, with ${files.length} file`);
        const drive = this.createDrive(email);
        if (!this.cache[email].rootFolderId) {
            const rootFolder = await this.createRootFolder(drive);
            this.cache[email].rootFolderId = rootFolder.id;
        }
        if (this.cache[email].defaultFolderName !== this.getDefaultFolderName(oid)) {
            const defaultFolder = await this.createDefaultFolder(drive, {
                oid,
                rootFolderId: this.cache[email].rootFolderId,
            });
            this.cache[email].defaultFolderId = defaultFolder.id;
            this.cache[email].defaultFolderName = defaultFolder.name;
        }
        const now = Date.now();
        const data = await Promise.all(files.map((item, index) => {
            return this.createFile(drive, {
                buffer: item.buffer,
                mimetype: item.mimetype,
                parent: this.cache[email].defaultFolderId,
                title: oid
                    + '-'
                    + customerId
                    + '-'
                    + time_helper_1.ESTimer.timeToText(now + index, 'YYYY-MM-DD-hh-mm-ss-xxx'),
            });
        }));
        return data;
    }
};
exports.GoogleDriverService = GoogleDriverService;
exports.GoogleDriverService = GoogleDriverService = GoogleDriverService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(google_driver_config_1.GoogleDriverConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object])
], GoogleDriverService);


/***/ }),
/* 229 */
/***/ ((module) => {

module.exports = require("googleapis");

/***/ }),
/* 230 */
/***/ ((module) => {

module.exports = require("stream");

/***/ }),
/* 231 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AuthModule = void 0;
const common_1 = __webpack_require__(3);
const api_auth_module_1 = __webpack_require__(232);
const api_me_module_1 = __webpack_require__(248);
let AuthModule = class AuthModule {
};
exports.AuthModule = AuthModule;
exports.AuthModule = AuthModule = __decorate([
    (0, common_1.Module)({
        imports: [api_auth_module_1.ApiAuthModule, api_me_module_1.ApiMeModule],
        controllers: [],
        providers: [],
    })
], AuthModule);


/***/ }),
/* 232 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const jwt_extend_module_1 = __webpack_require__(158);
const jwt_config_1 = __webpack_require__(161);
const environments_1 = __webpack_require__(30);
const email_module_1 = __webpack_require__(233);
const api_auth_controller_1 = __webpack_require__(236);
const api_auth_service_1 = __webpack_require__(238);
let ApiAuthModule = class ApiAuthModule {
};
exports.ApiAuthModule = ApiAuthModule;
exports.ApiAuthModule = ApiAuthModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forFeature(environments_1.GlobalConfig),
            config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig),
            jwt_extend_module_1.JwtExtendModule,
            email_module_1.EmailModule,
        ],
        controllers: [api_auth_controller_1.ApiAuthController],
        providers: [api_auth_service_1.ApiAuthService],
    })
], ApiAuthModule);


/***/ }),
/* 233 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailModule = void 0;
const mailer_1 = __webpack_require__(234);
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const environments_1 = __webpack_require__(30);
const email_service_1 = __webpack_require__(235);
let EmailModule = class EmailModule {
};
exports.EmailModule = EmailModule;
exports.EmailModule = EmailModule = __decorate([
    (0, common_1.Module)({
        imports: [
            mailer_1.MailerModule.forRootAsync({
                imports: [config_1.ConfigModule.forFeature(environments_1.EmailConfig)],
                inject: [environments_1.EmailConfig.KEY],
                useFactory: (mailConfig) => {
                    return {
                        transport: {
                            host: mailConfig.host,
                            port: mailConfig.port,
                            auth: {
                                user: mailConfig.user,
                                pass: mailConfig.password,
                            },
                        },
                        defaults: { from: `"${mailConfig.name}" <${mailConfig.from}>` },
                    };
                },
            }),
        ],
        providers: [email_service_1.EmailService],
        exports: [email_service_1.EmailService],
    })
], EmailModule);


/***/ }),
/* 234 */
/***/ ((module) => {

module.exports = require("@nestjs-modules/mailer");

/***/ }),
/* 235 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var EmailService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EmailService = void 0;
const mailer_1 = __webpack_require__(234);
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
let EmailService = EmailService_1 = class EmailService {
    constructor(configService, mailerService) {
        this.configService = configService;
        this.mailerService = mailerService;
        this.logger = new common_1.Logger(EmailService_1.name);
        this.subjectPrefix = this.configService.get('mail.subject_prefix');
    }
    async send(options) {
        return await this.mailerService.sendMail(options);
    }
};
exports.EmailService = EmailService;
exports.EmailService = EmailService = EmailService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof mailer_1.MailerService !== "undefined" && mailer_1.MailerService) === "function" ? _b : Object])
], EmailService);


/***/ }),
/* 236 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const external_request_1 = __webpack_require__(237);
const api_auth_service_1 = __webpack_require__(238);
const request_1 = __webpack_require__(240);
let ApiAuthController = class ApiAuthController {
    constructor(apiAuthService) {
        this.apiAuthService = apiAuthService;
    }
    async login(loginDto, dataExternal) {
        return await this.apiAuthService.login(loginDto, dataExternal);
    }
    async loginRoot(loginDto, dataExternal) {
        return await this.apiAuthService.loginRoot(loginDto, dataExternal);
    }
    async loginDemo(dataExternal) {
        return await this.apiAuthService.loginDemo(dataExternal);
    }
    async forgotPassword(body) {
        return await this.apiAuthService.forgotPassword(body);
    }
    async resetPassword(body) {
        return await this.apiAuthService.resetPassword(body);
    }
    async grantAccessToken(dataExternal, body) {
        return await this.apiAuthService.grantAccessToken(body.refreshToken, dataExternal);
    }
    async logout(body) {
        return this.apiAuthService.logout(body.refreshToken);
    }
};
exports.ApiAuthController = ApiAuthController;
__decorate([
    (0, common_1.Post)('login'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.LoginBody !== "undefined" && request_1.LoginBody) === "function" ? _b : Object, typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "login", null);
__decorate([
    (0, common_1.Post)('login-root'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof request_1.LoginRootBody !== "undefined" && request_1.LoginRootBody) === "function" ? _d : Object, typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "loginRoot", null);
__decorate([
    (0, common_1.Post)('login-demo'),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "loginDemo", null);
__decorate([
    (0, common_1.Post)('forgot-password'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof request_1.ForgotPasswordBody !== "undefined" && request_1.ForgotPasswordBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "forgotPassword", null);
__decorate([
    (0, common_1.Post)('reset-password'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof request_1.ResetPasswordBody !== "undefined" && request_1.ResetPasswordBody) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "resetPassword", null);
__decorate([
    (0, common_1.Post)('refresh-token'),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RefreshTokenBody !== "undefined" && request_1.RefreshTokenBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "grantAccessToken", null);
__decorate([
    (0, common_1.Post)('logout'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof request_1.RefreshTokenBody !== "undefined" && request_1.RefreshTokenBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiAuthController.prototype, "logout", null);
exports.ApiAuthController = ApiAuthController = __decorate([
    (0, swagger_1.ApiTags)('Auth'),
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_auth_service_1.ApiAuthService !== "undefined" && api_auth_service_1.ApiAuthService) === "function" ? _a : Object])
], ApiAuthController);


/***/ }),
/* 237 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.External = void 0;
const common_1 = __webpack_require__(3);
exports.External = (0, common_1.createParamDecorator)((data, ctx) => {
    const request = ctx.switchToHttp().getRequest();
    const requestExternal = request.raw;
    return requestExternal.external;
});


/***/ }),
/* 238 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAuthService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const typeorm_1 = __webpack_require__(44);
const bcrypt = __webpack_require__(239);
const typeorm_2 = __webpack_require__(18);
const cache_token_service_1 = __webpack_require__(155);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(187);
const jwt_extend_service_1 = __webpack_require__(160);
const jwt_config_1 = __webpack_require__(161);
const organization_entity_1 = __webpack_require__(16);
const user_entity_1 = __webpack_require__(20);
const organization_repository_1 = __webpack_require__(111);
const user_repository_1 = __webpack_require__(152);
const environments_1 = __webpack_require__(30);
const email_service_1 = __webpack_require__(235);
let ApiAuthService = class ApiAuthService {
    constructor(globalConfig, jwtConfig, dataSource, manager, emailService, cacheTokenService, jwtExtendService, organizationRepository, userRepository) {
        this.globalConfig = globalConfig;
        this.jwtConfig = jwtConfig;
        this.dataSource = dataSource;
        this.manager = manager;
        this.emailService = emailService;
        this.cacheTokenService = cacheTokenService;
        this.jwtExtendService = jwtExtendService;
        this.organizationRepository = organizationRepository;
        this.userRepository = userRepository;
    }
    async login(loginDto, dataExternal) {
        var _a;
        const { ip, os, browser, mobile } = dataExternal;
        const [user] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'join',
            where: {
                username: loginDto.username,
                organization: { organizationCode: loginDto.organizationCode },
            },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!user.isActive || ((_a = user.organization) === null || _a === void 0 ? void 0 : _a.status) == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const checkPassword = await bcrypt.compare(loginDto.password, user.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async loginRoot(loginRootDto, dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const [root] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'join',
            where: {
                username: loginRootDto.username,
                organization: { organizationCode: loginRootDto.organizationCode },
            },
        });
        if (!root)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!root.isActive || root.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const checkPassword = await bcrypt.compare(loginRootDto.password, root.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        let user;
        if (loginRootDto.uid) {
            user = await this.userRepository.findOne({
                relation: { organization: true },
                relationLoadStrategy: 'join',
                condition: {
                    oid: loginRootDto.oid,
                    id: loginRootDto.uid,
                },
            });
        }
        else {
            user = await this.userRepository.findOne({
                relation: { organization: true },
                relationLoadStrategy: 'join',
                condition: {
                    oid: loginRootDto.oid,
                    isAdmin: 1,
                },
            });
        }
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async loginDemo(dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const [user] = await this.dataSource.getRepository(user_entity_1.default).find({
            relations: { organization: true },
            relationLoadStrategy: 'query',
            where: { id: 4, oid: 4 },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (!user.isActive || user.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const token = this.jwtExtendService.createTokenFromUser(user, ip);
        await this.cacheTokenService.addAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: token.refreshExp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: {
                user,
                accessToken: token.accessToken,
                accessExp: token.accessExp,
                refreshToken: token.refreshToken,
                refreshExp: token.refreshExp,
            },
        };
    }
    async forgotPassword(body) {
        const organization = await this.organizationRepository.findOneBy({
            organizationCode: body.organizationCode,
            email: body.organizationEmail,
        });
        if (!organization) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.NotFound',
                details: 'Organization',
            });
        }
        const user = await this.userRepository.findOne({
            condition: {
                oid: organization.id,
                username: body.username,
            },
        });
        if (!user) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'User' });
        }
        if (!user.isActive || user.organization.status == organization_entity_1.OrganizationStatus.Inactive) {
            throw new exception_filter_1.BusinessException('common.AccountInactive');
        }
        const token = encodeURIComponent((0, string_helper_1.encrypt)(user.hashPassword, this.jwtConfig.accessKey, 30 * 60 * 1000));
        const link = `${this.globalConfig.DOMAIN_FRONT_END}/auth/reset-password`
            + `?token=${token}&organizationCode=${body.organizationCode}`
            + `&username=${body.username}&updatedAt=${user.updatedAt}`
            + `&ver=1`;
        const sendEmailResult = await this.emailService.send({
            to: body.organizationEmail,
            subject: '[MEA] - Quên mật khẩu',
            from: 'medihome.vn@gmail.com',
            text: 'forgot_password',
            html: '<p>Bạn nhận được yêu cầu reset mật khẩu. Nhấn vào đường link sau để cập nhật mật khẩu mới: </p>'
                + `<p><a href="${link}">${link}</a></p>`
                + '<p>Link sẽ bị vô hiệu hóa sau 30 phút</p>',
        });
        return { data: { sendEmailResult } };
    }
    async resetPassword(body) {
        const organization = await this.organizationRepository.findOneBy({
            organizationCode: body.organizationCode,
        });
        if (!organization) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.NotFound',
                details: 'Organization',
            });
        }
        const user = await this.userRepository.findOne({
            condition: {
                oid: organization.id,
                username: body.username,
            },
        });
        if (!user) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'User' });
        }
        if (user.updatedAt !== body.updatedAt) {
            throw new common_1.HttpException('Token đã được sử dụng', common_1.HttpStatus.BAD_GATEWAY);
        }
        let hash;
        try {
            hash = (0, string_helper_1.decrypt)(body.token, this.jwtConfig.accessKey);
        }
        catch (error) {
            throw new common_1.HttpException('Thời gian reset password đã quá hạn', common_1.HttpStatus.BAD_GATEWAY);
        }
        if (user.hashPassword !== hash) {
            throw new exception_filter_1.BusinessException('error.Token.Invalid');
        }
        const hashPassword = await bcrypt.hash(body.password, 5);
        const secret = (0, string_helper_1.encrypt)(body.password, body.username);
        await this.userRepository.update({ id: user.id }, { hashPassword, secret });
        await this.cacheTokenService.removeAllRefreshToken({ oid: user.oid, uid: user.id });
        return { data: true };
    }
    async grantAccessToken(refreshToken, dataExternal) {
        const { ip, os, browser, mobile } = dataExternal;
        const jwtPayloadRefresh = this.jwtExtendService.verifyRefreshToken(refreshToken, ip);
        const checkTokenCache = await this.cacheTokenService.checkRefreshToken({
            oid: jwtPayloadRefresh.data.oid,
            uid: jwtPayloadRefresh.data.uid,
            refreshExp: jwtPayloadRefresh.exp,
        });
        if (!checkTokenCache) {
            throw new exception_filter_1.BusinessException('error.Token.RefreshTokenNoCache', {}, common_1.HttpStatus.UNAUTHORIZED);
        }
        const user = await this.userRepository.findOne({
            relation: { organization: true },
            condition: {
                id: jwtPayloadRefresh.data.uid,
                oid: jwtPayloadRefresh.data.oid,
            },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const token = this.jwtExtendService.createAccessToken(user, ip);
        await this.cacheTokenService.updateAccessToken({
            oid: user.oid,
            uid: user.id,
            accessExp: token.accessExp,
            refreshExp: jwtPayloadRefresh.exp,
            ip,
            os,
            browser,
            mobile,
        });
        return {
            data: { accessExp: token.accessExp, accessToken: token.accessToken },
        };
    }
    async logout(refreshToken) {
        const jwtPayload = this.jwtExtendService.decodeRefreshToken(refreshToken);
        await this.cacheTokenService.removeRefreshToken({
            oid: jwtPayload.data.oid,
            uid: jwtPayload.data.uid,
            refreshExp: jwtPayload.exp,
        });
        return { data: true };
    }
};
exports.ApiAuthService = ApiAuthService;
exports.ApiAuthService = ApiAuthService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(environments_1.GlobalConfig.KEY)),
    __param(1, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __param(3, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _d : Object, typeof (_e = typeof email_service_1.EmailService !== "undefined" && email_service_1.EmailService) === "function" ? _e : Object, typeof (_f = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _f : Object, typeof (_g = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _g : Object, typeof (_h = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _h : Object, typeof (_j = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _j : Object])
], ApiAuthService);


/***/ }),
/* 239 */
/***/ ((module) => {

module.exports = require("bcrypt");

/***/ }),
/* 240 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(241), exports);
__exportStar(__webpack_require__(244), exports);
__exportStar(__webpack_require__(245), exports);
__exportStar(__webpack_require__(246), exports);
__exportStar(__webpack_require__(247), exports);


/***/ }),
/* 241 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ForgotPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class ForgotPasswordBody {
}
exports.ForgotPasswordBody = ForgotPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "organizationCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'duycodecom@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "organizationEmail", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], ForgotPasswordBody.prototype, "username", void 0);


/***/ }),
/* 242 */
/***/ ((module) => {

module.exports = require("class-validator");

/***/ }),
/* 243 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.IsGmail = exports.IsPhone = void 0;
exports.IsNumberGreaterThan = IsNumberGreaterThan;
exports.IsEnumValue = IsEnumValue;
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
let IsPhone = class IsPhone {
    validate(text, args) {
        if (text === '')
            return true;
        if (typeof text !== 'string' || text.length !== 10)
            return false;
        return /((09|03|07|08|05)+([0-9]{8})\b)/g.test(text);
    }
    defaultMessage(args) {
        return '$property must be real phone number !';
    }
};
exports.IsPhone = IsPhone;
exports.IsPhone = IsPhone = __decorate([
    (0, class_validator_1.ValidatorConstraint)({ name: 'isPhone', async: false })
], IsPhone);
let IsGmail = class IsGmail {
    validate(text, args) {
        if (typeof text !== 'string')
            return false;
        return /^([a-zA-Z0-9]|\.|-|_)+(@gmail.com)$/.test(text);
    }
    defaultMessage(args) {
        return '$property must be a gmail address !';
    }
};
exports.IsGmail = IsGmail;
exports.IsGmail = IsGmail = __decorate([
    (0, class_validator_1.ValidatorConstraint)({ name: 'isGmail', async: false })
], IsGmail);
function IsNumberGreaterThan(options, validationOptions) {
    return function (object, propertyName) {
        (0, class_validator_1.registerDecorator)({
            name: 'isNumberGreaterThan',
            target: object.constructor,
            propertyName,
            constraints: [options],
            options: validationOptions,
            validator: {
                validate(value, args) {
                    const [options] = args.constraints;
                    return typeof value === 'number' && value > options;
                },
                defaultMessage(args) {
                    const [options] = args.constraints;
                    return `$property ($value) must be a number and greater than ${options}`;
                },
            },
        });
    };
}
function IsEnumValue(options, validationOptions) {
    return function (object, propertyName) {
        (0, class_validator_1.registerDecorator)({
            name: 'isEnumValue',
            target: object.constructor,
            propertyName,
            constraints: [options],
            options: validationOptions,
            validator: {
                validate(value, args) {
                    const [options] = args.constraints;
                    const valueOptions = (0, typescript_helper_1.valuesEnum)(options);
                    return valueOptions.includes(value);
                },
                defaultMessage(args) {
                    const [options] = args.constraints;
                    return `$property ($value) must be an enum ${(0, typescript_helper_1.stringEnum)(options)}`;
                },
            },
        });
    };
}


/***/ }),
/* 244 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LoginRootBody = exports.LoginBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class LoginBody {
}
exports.LoginBody = LoginBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LoginBody.prototype, "organizationCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], LoginBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], LoginBody.prototype, "password", void 0);
class LoginRootBody extends LoginBody {
}
exports.LoginRootBody = LoginRootBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LoginRootBody.prototype, "oid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LoginRootBody.prototype, "uid", void 0);


/***/ }),
/* 245 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RefreshTokenBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RefreshTokenBody {
}
exports.RefreshTokenBody = RefreshTokenBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", String)
], RefreshTokenBody.prototype, "refreshToken", void 0);


/***/ }),
/* 246 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RegisterBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class RegisterBody {
}
exports.RegisterBody = RegisterBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'example-2@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], RegisterBody.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RegisterBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], RegisterBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], RegisterBody.prototype, "password", void 0);


/***/ }),
/* 247 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ResetPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ResetPasswordBody {
}
exports.ResetPasswordBody = ResetPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "organizationCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "password", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '$2b$05$G17lx6yO8fK2iJK6tqX2XODsCrawFzSht5vJQjE7wlDJO0.4zxPxO' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], ResetPasswordBody.prototype, "token", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ResetPasswordBody.prototype, "updatedAt", void 0);


/***/ }),
/* 248 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeModule = void 0;
const common_1 = __webpack_require__(3);
const api_me_controller_1 = __webpack_require__(249);
const api_me_service_1 = __webpack_require__(254);
let ApiMeModule = class ApiMeModule {
};
exports.ApiMeModule = ApiMeModule;
exports.ApiMeModule = ApiMeModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_me_controller_1.ApiMeController],
        providers: [api_me_service_1.ApiMeService],
        exports: [],
    })
], ApiMeModule);


/***/ }),
/* 249 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const api_me_service_1 = __webpack_require__(254);
const request_1 = __webpack_require__(256);
let ApiMeController = class ApiMeController {
    constructor(apiUserService) {
        this.apiUserService = apiUserService;
    }
    async data({ oid, uid, permissionIds }) {
        const data = await this.apiUserService.data({ oid, uid, permissionIds });
        return { data };
    }
    async info({ oid, uid, permissionIds }) {
        const data = await this.apiUserService.info({ oid, uid, permissionIds });
        return { data };
    }
    async detail({ oid, uid }, body) {
        const data = await this.apiUserService.changePassword(oid, uid, body);
        return { data };
    }
    async updateInfo({ oid, uid }, files, body) {
        const data = await this.apiUserService.updateInfo({ oid, userId: uid, files, body });
        return { data };
    }
};
exports.ApiMeController = ApiMeController;
__decorate([
    (0, common_1.Get)('data'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], ApiMeController.prototype, "data", null);
__decorate([
    (0, common_1.Get)('info'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ApiMeController.prototype, "info", null);
__decorate([
    (0, common_1.Patch)('change-password'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.UserChangePasswordBody !== "undefined" && request_1.UserChangePasswordBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiMeController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('update-info'),
    (0, user_guard_1.UserPermission)(),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFiles)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, Array, typeof (_k = typeof request_1.UserUpdateInfoBody !== "undefined" && request_1.UserUpdateInfoBody) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiMeController.prototype, "updateInfo", null);
exports.ApiMeController = ApiMeController = __decorate([
    (0, swagger_1.ApiTags)('Me'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('me'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_me_service_1.ApiMeService !== "undefined" && api_me_service_1.ApiMeService) === "function" ? _a : Object])
], ApiMeController);


/***/ }),
/* 250 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(26), exports);
__exportStar(__webpack_require__(251), exports);
__exportStar(__webpack_require__(253), exports);
__exportStar(__webpack_require__(28), exports);
__exportStar(__webpack_require__(29), exports);


/***/ }),
/* 251 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.FastifyFileInterceptor = FastifyFileInterceptor;
const common_1 = __webpack_require__(3);
const fastify_multer_1 = __webpack_require__(7);
const multer_1 = __webpack_require__(252);
function FastifyFileInterceptor(fieldName, localOptions) {
    var _a;
    let MixinInterceptor = class MixinInterceptor {
        constructor(options) {
            this.multer = fastify_multer_1.default(Object.assign(Object.assign({}, options), localOptions));
        }
        async intercept(context, next) {
            const ctx = context.switchToHttp();
            await new Promise((resolve, reject) => {
                return this.multer.single(fieldName)(ctx.getRequest(), ctx.getResponse(), (error) => {
                    if (error) {
                        return reject(error);
                    }
                    resolve();
                });
            });
            return next.handle();
        }
    };
    MixinInterceptor = __decorate([
        __param(0, (0, common_1.Optional)()),
        __param(0, (0, common_1.Inject)('MULTER_MODULE_OPTIONS')),
        __metadata("design:paramtypes", [typeof (_a = typeof multer_1.Multer !== "undefined" && multer_1.Multer) === "function" ? _a : Object])
    ], MixinInterceptor);
    const Interceptor = (0, common_1.mixin)(MixinInterceptor);
    return Interceptor;
}


/***/ }),
/* 252 */
/***/ ((module) => {

module.exports = require("multer");

/***/ }),
/* 253 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.FastifyFilesInterceptor = FastifyFilesInterceptor;
const common_1 = __webpack_require__(3);
const fastify_multer_1 = __webpack_require__(7);
const multer_1 = __webpack_require__(252);
function FastifyFilesInterceptor(fieldName, maxCount, localOptions) {
    var _a;
    let MixinInterceptor = class MixinInterceptor {
        constructor(options) {
            this.multer = fastify_multer_1.default(Object.assign(Object.assign({}, options), localOptions));
        }
        async intercept(context, next) {
            const ctx = context.switchToHttp();
            await new Promise((resolve, reject) => {
                return this.multer.array(fieldName, maxCount)(ctx.getRequest(), ctx.getResponse(), (error) => {
                    if (error) {
                        return reject(error);
                    }
                    resolve();
                });
            });
            return next.handle();
        }
    };
    MixinInterceptor = __decorate([
        __param(0, (0, common_1.Optional)()),
        __param(0, (0, common_1.Inject)('MULTER_MODULE_OPTIONS')),
        __metadata("design:paramtypes", [typeof (_a = typeof multer_1.Multer !== "undefined" && multer_1.Multer) === "function" ? _a : Object])
    ], MixinInterceptor);
    const Interceptor = (0, common_1.mixin)(MixinInterceptor);
    return Interceptor;
}


/***/ }),
/* 254 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiMeService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(239);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const string_helper_1 = __webpack_require__(187);
const repositories_1 = __webpack_require__(42);
const user_repository_1 = __webpack_require__(152);
const image_manager_service_1 = __webpack_require__(255);
let ApiMeService = class ApiMeService {
    constructor(userRepository, cacheDataService, imageManagerService, imageRepository) {
        this.userRepository = userRepository;
        this.cacheDataService = cacheDataService;
        this.imageManagerService = imageManagerService;
        this.imageRepository = imageRepository;
    }
    async data(params) {
        const { uid, oid, permissionIds } = params;
        const [user, organization, roomIdList, permissionAll, settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getUser(oid, uid),
            this.cacheDataService.getOrganization(oid),
            this.cacheDataService.getRoomIdList(oid, uid),
            this.cacheDataService.getPermissionAllList(),
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        return {
            user,
            organization,
            roomIdList,
            permissionIds,
            permissionAll,
            settingMap,
            settingMapRoot,
            rootSetting: settingMapRoot.ROOT_SETTING,
        };
    }
    async info(params) {
        const { uid, oid, permissionIds } = params;
        const user = await this.cacheDataService.getUser(oid, uid);
        return { user };
    }
    async changePassword(oid, id, body) {
        const { oldPassword, newPassword } = body;
        const user = await this.userRepository.findOneBy({ id, oid });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const checkPassword = await bcrypt.compare(oldPassword, user.hashPassword);
        if (!checkPassword)
            throw new exception_filter_1.BusinessException('error.User.WrongPassword');
        const hashPassword = await bcrypt.hash(newPassword, 5);
        const secret = (0, string_helper_1.encrypt)(newPassword, user.username);
        await this.userRepository.update({ oid, id }, { hashPassword, secret });
        return true;
    }
    async updateInfo(options) {
        const { oid, userId, body, files } = options;
        const { imagesChange, userInfo } = body;
        const userOrigin = await this.userRepository.findOneBy({ oid, id: userId });
        let userModified;
        let imageIdsStringifyUpdate = userOrigin.imageIds;
        if (imagesChange) {
            const imageIdsUpdate = await this.imageManagerService.changeCloudinaryImageLink({
                oid,
                customerId: userId,
                files,
                imageIdsWait: body.imagesChange.imageIdsWait,
                externalUrlList: body.imagesChange.externalUrlList,
                imageIdsOld: JSON.parse(userOrigin.imageIds || '[]'),
            });
            imageIdsStringifyUpdate = JSON.stringify(imageIdsUpdate);
        }
        if (userOrigin.imageIds !== imageIdsStringifyUpdate) {
            userModified = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, Object.assign(Object.assign({}, userInfo), { imageIds: imageIdsStringifyUpdate }));
        }
        else {
            userModified = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, userInfo);
        }
        const imageIdList = JSON.parse(userModified.imageIds);
        const imageList = await this.imageRepository.findManyByIds(imageIdList);
        const imageMap = helpers_1.ESArray.arrayToKeyValue(imageList, 'id');
        userModified.imageList = imageIdList.map((imageId) => imageMap[imageId]).filter((i) => !!i);
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { user: userModified };
    }
};
exports.ApiMeService = ApiMeService;
exports.ApiMeService = ApiMeService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ImageRepository !== "undefined" && repositories_1.ImageRepository) === "function" ? _d : Object])
], ApiMeService);


/***/ }),
/* 255 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ImageManagerService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageManagerService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const helpers_1 = __webpack_require__(182);
const image_entity_1 = __webpack_require__(19);
const setting_entity_1 = __webpack_require__(41);
const image_repository_1 = __webpack_require__(107);
const setting_repository_1 = __webpack_require__(132);
const google_driver_service_1 = __webpack_require__(228);
let ImageManagerService = ImageManagerService_1 = class ImageManagerService {
    constructor(imageRepository, googleDriverService, cacheDataService, settingRepository) {
        this.imageRepository = imageRepository;
        this.googleDriverService = googleDriverService;
        this.cacheDataService = cacheDataService;
        this.settingRepository = settingRepository;
        this.logger = new common_1.Logger(ImageManagerService_1.name);
    }
    async onModuleInit() {
        try {
            const settingList = await this.settingRepository.findManyBy({ key: setting_entity_1.SettingKey.GOOGLE_DRIVER });
            settingList.forEach((setting) => {
                const data = setting.data ? JSON.parse(setting.data) : {};
                if (!data.email || !data.refreshToken)
                    return;
                this.googleDriverService.setCache(data.email, {
                    rootFolderId: '',
                    refreshToken: data.refreshToken,
                    defaultFolderId: '',
                    defaultFolderName: '',
                });
            });
        }
        catch (error) {
            this.logger.error(error.message);
        }
    }
    async changeGoogleDriverImageList(options) {
        const { oid, customerId, imageIdsKeep, imageIdsOld, files, filesPosition } = options;
        const imageOldList = imageIdsOld.length
            ? await this.imageRepository.findManyByIds(imageIdsOld)
            : [];
        const imageRemoveList = imageOldList.filter((i) => !imageIdsKeep.includes(i.id));
        const imageRemoveMapList = helpers_1.ESArray.arrayToKeyArray(imageRemoveList, 'hostAccount');
        const email = await this.cacheDataService.getEmailGoogleDriver(oid);
        const [imageHostInsertList, ...imageHostTrashResponse] = await Promise.all([
            this.googleDriverService.uploadMultipleFiles({
                files,
                email,
                oid,
                customerId,
            }),
            ...Object.entries(imageRemoveMapList).map(([curEmail, imageList]) => {
                return this.googleDriverService.trashMultipleFiles({
                    oid,
                    email: curEmail,
                    fileIds: imageList.map((i) => i.externalId),
                });
            }),
        ]);
        const imageInsertList = imageHostInsertList.map((i, index) => {
            const draft = {
                oid,
                customerId,
                name: i.name,
                size: Number(i.size),
                mimeType: i.mimeType,
                hostType: image_entity_1.ImageHostType.GoogleDriver,
                hostAccount: email,
                externalId: i.id,
                externalUrl: '',
            };
            return draft;
        });
        const imageHostTrashSuccess = imageHostTrashResponse.map((i) => i.success).flat();
        const imageHostTrashFailed = imageHostTrashResponse.map((i) => i.failed).flat();
        const imageIdsRemoveSuccess = imageRemoveList
            .filter((i) => imageHostTrashSuccess.includes(i.externalId))
            .map((i) => i.id);
        const imageIdsRemoveFailed = imageRemoveList
            .filter((i) => imageHostTrashFailed.includes(i.externalId))
            .map((i) => i.id);
        const [imageIdsNew] = await Promise.all([
            this.imageRepository.insertManyFullField(imageInsertList),
            imageIdsRemoveSuccess.length
                ? this.imageRepository.delete({ id: { IN: imageIdsRemoveSuccess } })
                : null,
            imageIdsRemoveFailed.length
                ? this.imageRepository.update({ id: { IN: imageIdsRemoveFailed } }, { waitDelete: 1 })
                : null,
        ]);
        const imageIdsUpdate = [...imageIdsKeep];
        filesPosition.sort((a, b) => (a < b ? -1 : 1));
        for (let i = 0; i < filesPosition.length; i++) {
            imageIdsUpdate.splice(filesPosition[i], 0, imageIdsNew[i]);
        }
        return imageIdsUpdate;
    }
    async changeCloudinaryImageLink(options) {
        const { oid, customerId, imageIdsWait, imageIdsOld, files, externalUrlList } = options;
        const imageIdsRemove = imageIdsOld.filter((i) => !imageIdsWait.includes(i));
        if (imageIdsRemove.length) {
            await this.imageRepository.updateAndReturnEntity({ oid, id: { IN: imageIdsRemove } }, { waitDelete: 1 });
        }
        const imageInsertList = externalUrlList.map((i) => {
            const insert = {
                oid,
                customerId,
                name: '',
                mimeType: '',
                size: 0,
                hostType: image_entity_1.ImageHostType.Cloudinary,
                hostAccount: '',
                externalId: '',
                externalUrl: i,
            };
            return insert;
        });
        const imageCreatedList = await this.imageRepository.insertManyAndReturnEntity(imageInsertList);
        const imageIdsNew = [];
        for (let i = 0; i < imageIdsWait.length; i++) {
            if (imageIdsWait[i] !== 0) {
                imageIdsNew[i] = imageIdsWait[i];
            }
            if (imageIdsWait[i] === 0) {
                const imageCreated = imageCreatedList.shift();
                imageIdsNew[i] = imageCreated.id;
            }
        }
        return imageIdsNew;
    }
    async removeImageGoogleDriver(oid, imageRemoveList) {
        const imageMapAccount = helpers_1.ESArray.arrayToKeyArray(imageRemoveList, 'hostAccount');
        const imageHostTrashResponse = await Promise.all(Object.entries(imageMapAccount).map(([curEmail, curImageList]) => {
            return this.googleDriverService.trashMultipleFiles({
                oid,
                email: curEmail,
                fileIds: curImageList.map((i) => i.externalId),
            });
        }));
        const imageHostTrashSuccess = imageHostTrashResponse.map((i) => i.success).flat();
        const imageHostTrashFailed = imageHostTrashResponse.map((i) => i.failed).flat();
        const imageIdsRemoveSuccess = imageRemoveList
            .filter((i) => imageHostTrashSuccess.includes(i.externalId))
            .map((i) => i.id);
        const imageIdsRemoveFailed = imageRemoveList
            .filter((i) => imageHostTrashFailed.includes(i.externalId))
            .map((i) => i.id);
        if (imageIdsRemoveSuccess.length) {
            await this.imageRepository.delete({ id: { IN: imageIdsRemoveSuccess } });
        }
    }
    async removeImageCloudinary(oid, imageRemoveList) {
    }
    async removeImageList(options) {
        const { oid, idRemoveList } = options;
        const imageWaitDeleteList = await this.imageRepository.updateAndReturnEntity({ oid, id: { IN: idRemoveList } }, { waitDelete: 1 });
        const imageCloudinaryWaitDelete = imageWaitDeleteList.filter((i) => {
            return i.hostType === image_entity_1.ImageHostType.Cloudinary;
        });
        const imageGoogleWaitDelete = imageWaitDeleteList.filter((i) => {
            return i.hostType === image_entity_1.ImageHostType.Cloudinary;
        });
        await Promise.all([
            this.removeImageCloudinary(oid, imageCloudinaryWaitDelete),
            this.removeImageGoogleDriver(oid, imageGoogleWaitDelete),
        ]);
    }
};
exports.ImageManagerService = ImageManagerService;
exports.ImageManagerService = ImageManagerService = ImageManagerService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _a : Object, typeof (_b = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object, typeof (_d = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _d : Object])
], ImageManagerService);


/***/ }),
/* 256 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(257), exports);
__exportStar(__webpack_require__(258), exports);
__exportStar(__webpack_require__(260), exports);
__exportStar(__webpack_require__(261), exports);


/***/ }),
/* 257 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserChangePasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class UserChangePasswordBody {
}
exports.UserChangePasswordBody = UserChangePasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], UserChangePasswordBody.prototype, "oldPassword", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], UserChangePasswordBody.prototype, "newPassword", void 0);


/***/ }),
/* 258 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGetOneQuery = exports.UserGetManyQuery = exports.UserPaginationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const user_options_request_1 = __webpack_require__(260);
class UserPaginationQuery extends query_1.PaginationQuery {
}
exports.UserPaginationQuery = UserPaginationQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _a : Object)
], UserPaginationQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserSortQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserSortQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_options_request_1.UserSortQuery !== "undefined" && user_options_request_1.UserSortQuery) === "function" ? _b : Object)
], UserPaginationQuery.prototype, "sort", void 0);
class UserGetManyQuery {
}
exports.UserGetManyQuery = UserGetManyQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], UserGetManyQuery.prototype, "limit", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _c : Object)
], UserGetManyQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserRelationQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserRelationQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _d : Object)
], UserGetManyQuery.prototype, "relation", void 0);
class UserGetOneQuery {
}
exports.UserGetOneQuery = UserGetOneQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: user_options_request_1.UserRelationQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => user_options_request_1.UserRelationQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _e : Object)
], UserGetOneQuery.prototype, "relation", void 0);


/***/ }),
/* 259 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.MultiMongoIdQuery = exports.SortQuery = exports.LimitQuery = exports.PaginationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PaginationQuery {
}
exports.PaginationQuery = PaginationQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => parseInt(value)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(1),
    __metadata("design:type", Number)
], PaginationQuery.prototype, "page", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => parseInt(value)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(3),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], PaginationQuery.prototype, "limit", void 0);
class LimitQuery {
}
exports.LimitQuery = LimitQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? parseInt(value) : undefined)),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.Min)(3),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], LimitQuery.prototype, "limit", void 0);
class SortQuery {
}
exports.SortQuery = SortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], SortQuery.prototype, "id", void 0);
class MultiMongoIdQuery {
}
exports.MultiMongoIdQuery = MultiMongoIdQuery;
__decorate([
    (0, swagger_1.ApiProperty)({
        type: String,
        example: '63fdde9517a7317f0e8f959a,63fdde9517a7317f0e8f959a',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === null || value === void 0 ? void 0 : value.length)
            return value === null || value === void 0 ? void 0 : value.split(',');
        else
            return [];
    }),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsMongoId)({ each: true }),
    __metadata("design:type", Array)
], MultiMongoIdQuery.prototype, "ids", void 0);


/***/ }),
/* 260 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserSortQuery = exports.UserFilterQuery = exports.UserRelationQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class UserRelationQuery {
}
exports.UserRelationQuery = UserRelationQuery;
class UserFilterQuery {
}
exports.UserFilterQuery = UserFilterQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[isActive]', example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (['1', 'true'].includes(value))
            return 1;
        if (['0', 'false'].includes(value))
            return 0;
        return undefined;
    }),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[fullName]' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'filter[phone]' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "phone", void 0);
class UserSortQuery extends query_1.SortQuery {
}
exports.UserSortQuery = UserSortQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'sort[fullName]', enum: ['ASC', 'DESC'], example: 'DESC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 261 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserUpdateInfoBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const file_1 = __webpack_require__(262);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsWait", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "externalUrlList", void 0);
class UserInfo {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], UserInfo.prototype, "fullName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UserInfo.prototype, "birthday", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], UserInfo.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], UserInfo.prototype, "gender", void 0);
class UserUpdateInfoBody extends file_1.MultipleFileUpload {
}
exports.UserUpdateInfoBody = UserUpdateInfoBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new UserInfo(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate userInfo failed. Value = ${JSON.stringify(value)} `,
    }),
    __metadata("design:type", UserInfo)
], UserUpdateInfoBody.prototype, "userInfo", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${value}`,
    }),
    __metadata("design:type", ImagesChangeBody)
], UserUpdateInfoBody.prototype, "imagesChange", void 0);


/***/ }),
/* 262 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SingleFileUpload = exports.MultipleFileUpload = void 0;
const swagger_1 = __webpack_require__(6);
class MultipleFileUpload {
}
exports.MultipleFileUpload = MultipleFileUpload;
__decorate([
    (0, swagger_1.ApiProperty)({ type: Array, format: 'binary' }),
    __metadata("design:type", Array)
], MultipleFileUpload.prototype, "files", void 0);
class SingleFileUpload {
}
exports.SingleFileUpload = SingleFileUpload;
__decorate([
    (0, swagger_1.ApiProperty)({ type: 'string', format: 'binary' }),
    __metadata("design:type", String)
], SingleFileUpload.prototype, "file", void 0);


/***/ }),
/* 263 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_customer_module_1 = __webpack_require__(264);
const api_file_icd_module_1 = __webpack_require__(272);
const api_file_laboratory_module_1 = __webpack_require__(275);
const api_file_procedure_module_1 = __webpack_require__(281);
const api_file_product_module_1 = __webpack_require__(287);
const api_file_purchase_order_module_1 = __webpack_require__(293);
const api_file_radiology_module_1 = __webpack_require__(296);
const api_file_ticket_module_1 = __webpack_require__(302);
let ApiFileModule = class ApiFileModule {
};
exports.ApiFileModule = ApiFileModule;
exports.ApiFileModule = ApiFileModule = __decorate([
    (0, common_1.Module)({
        imports: [
            api_file_icd_module_1.ApiFileICDModule,
            api_file_product_module_1.ApiFileProductModule,
            api_file_procedure_module_1.ApiFileProcedureModule,
            api_file_laboratory_module_1.ApiFileLaboratoryModule,
            api_file_radiology_module_1.ApiFileRadiologyModule,
            api_file_purchase_order_module_1.ApiFilePurchaseOrderModule,
            api_file_customer_module_1.ApiFileCustomerModule,
            api_file_ticket_module_1.ApiFileTicketModule,
        ],
        controllers: [],
        providers: [],
    })
], ApiFileModule);


/***/ }),
/* 264 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_customer_controller_1 = __webpack_require__(265);
const api_file_customer_download_excel_1 = __webpack_require__(266);
const api_file_customer_upload_excel_1 = __webpack_require__(270);
let ApiFileCustomerModule = class ApiFileCustomerModule {
};
exports.ApiFileCustomerModule = ApiFileCustomerModule;
exports.ApiFileCustomerModule = ApiFileCustomerModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_customer_controller_1.ApiFileCustomerController],
        providers: [api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel, api_file_customer_upload_excel_1.ApiFileCustomerUploadExcel],
    })
], ApiFileCustomerModule);


/***/ }),
/* 265 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_customer_download_excel_1 = __webpack_require__(266);
const api_file_customer_upload_excel_1 = __webpack_require__(270);
let ApiFileCustomerController = class ApiFileCustomerController {
    constructor(apiFileCustomerDownloadExcel, apiFileCustomerUploadExcel) {
        this.apiFileCustomerDownloadExcel = apiFileCustomerDownloadExcel;
        this.apiFileCustomerUploadExcel = apiFileCustomerUploadExcel;
    }
    async downloadExcel({ oid, user, organization }) {
        return await this.apiFileCustomerDownloadExcel.downloadExcel({ oid });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileCustomerDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileCustomerUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileCustomerController = ApiFileCustomerController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileCustomerController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('download-excel/file-example'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileCustomerController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_CUSTOMER),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileCustomerController.prototype, "uploadExcel", null);
exports.ApiFileCustomerController = ApiFileCustomerController = __decorate([
    (0, swagger_1.ApiTags)('FileCustomer'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-customer'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel !== "undefined" && api_file_customer_download_excel_1.ApiFileCustomerDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_customer_upload_excel_1.ApiFileCustomerUploadExcel !== "undefined" && api_file_customer_upload_excel_1.ApiFileCustomerUploadExcel) === "function" ? _b : Object])
], ApiFileCustomerController);


/***/ }),
/* 266 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
const customer_excel_rule_1 = __webpack_require__(269);
let ApiFileCustomerDownloadExcel = class ApiFileCustomerDownloadExcel {
    constructor(customerRepository) {
        this.customerRepository = customerRepository;
    }
    async downloadExcel(options) {
        const { oid } = options;
        const customerList = await this.customerRepository.findMany({
            condition: { oid },
            sort: { customerCode: 'ASC' },
        });
        const workbook = this.getWorkbookCustomer(customerList);
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA.VN-khach-hang.xlsx',
            },
        };
    }
    getWorkbookCustomer(customerList) {
        const dataRow = {
            style: {
                _num: { alignment: { horizontal: 'center' } },
                customerCode: { alignment: { wrapText: true } },
                fullName: { alignment: { wrapText: true } },
                phone: { alignment: { horizontal: 'center' } },
                debt: { alignment: { horizontal: 'right' } },
                birthday: { alignment: { horizontal: 'center' } },
                yearOfBirth: { alignment: { horizontal: 'center' } },
                gender: { alignment: { horizontal: 'center' } },
                addressProvince: { alignment: { wrapText: true } },
                addressWard: { alignment: { wrapText: true } },
                addressStreet: { alignment: { wrapText: true } },
                facebook: { alignment: { wrapText: true } },
                zalo: { alignment: { wrapText: true } },
                note: { alignment: { wrapText: true } },
            },
            data: [],
        };
        let indexNumber = 0;
        customerList.forEach((customer, index) => {
            indexNumber++;
            const data = {
                _num: indexNumber,
                customerCode: customer.customerCode || '',
                fullName: customer.fullName || '',
                phone: customer.phone || '',
                debt: customer.debt || 0,
                birthday: customer.birthday || '',
                yearOfBirth: customer.yearOfBirth || '',
                gender: [0, 1].includes(customer.gender) ? customer.gender : '',
                addressProvince: customer.addressProvince || '',
                addressWard: customer.addressWard || '',
                addressStreet: customer.addressStreet || '',
                facebook: customer.facebook || '',
                zalo: customer.zalo || '',
                note: customer.note || '',
            };
            dataRow.data.push(data);
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                const rowTitle = worksheet.addRow(Object.values(customer_excel_rule_1.CustomerExcelRules).map((i) => i.title));
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: Object.entries(customer_excel_rule_1.CustomerExcelRules).map(([key, rule]) => ({
                key,
                width: rule.width,
            })),
            rows: [dataRow],
        });
        return workbook;
    }
};
exports.ApiFileCustomerDownloadExcel = ApiFileCustomerDownloadExcel;
exports.ApiFileCustomerDownloadExcel = ApiFileCustomerDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _a : Object])
], ApiFileCustomerDownloadExcel);


/***/ }),
/* 267 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.excelOneSheetWorkbook = void 0;
const exceljs_1 = __webpack_require__(268);
const helpers_1 = __webpack_require__(182);
const excelOneSheetWorkbook = (params) => {
    const { headerSheet, footerSheet, rows, layout, columns } = params;
    const sheetName = layout.sheetName || 'SHEET';
    const workbook = new exceljs_1.Workbook();
    const worksheet = workbook.addWorksheet(sheetName, {
        views: [{ showGridLines: false }],
        pageSetup: {
            orientation: 'portrait',
            fitToPage: true,
            margins: {
                left: 0.25,
                right: 0.25,
                top: 0.75,
                bottom: 0.75,
                header: 0.3,
                footer: 0.3,
            },
        },
        properties: { tabColor: { argb: '6B5B95' }, defaultRowHeight: 18.75 },
    });
    worksheet.columns = columns.map((col) => ({
        key: col.key,
        width: col.width,
    }));
    if (headerSheet && typeof headerSheet === 'function') {
        headerSheet(worksheet);
    }
    rows.forEach((row, index) => {
        row.data.forEach((item) => {
            const currentRow = worksheet.addRow(item);
            currentRow.eachCell((cell) => {
                var _a, _b;
                const keyColumn = cell._column._key;
                const style = {
                    border: {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    },
                    font: {
                        size: 12,
                        bold: false,
                        name: 'Times New Roman',
                    },
                    alignment: { wrapText: true, vertical: 'middle' },
                };
                const styleAll = ((_a = row.style) === null || _a === void 0 ? void 0 : _a['_all']) || {};
                const styleCurrent = ((_b = row.style) === null || _b === void 0 ? void 0 : _b[keyColumn]) || {};
                helpers_1.ESObject.mergeObject(style, styleAll, styleCurrent);
                if (style.mergeCells) {
                    const { value } = cell;
                    const endRow = Number(cell.row);
                    const startRow = endRow - (style.mergeCells.rowspan - 1);
                    const startColumn = Number(cell.col);
                    const endColumn = startColumn + (style.mergeCells.colspan - 1);
                    worksheet.mergeCells(startRow, startColumn, endRow, endColumn);
                    cell = worksheet.getCell(startRow, startColumn);
                    cell.value = value;
                }
                cell.style = style;
            });
        });
    });
    if (footerSheet && typeof footerSheet === 'function') {
        footerSheet(worksheet);
    }
    return workbook;
};
exports.excelOneSheetWorkbook = excelOneSheetWorkbook;


/***/ }),
/* 268 */
/***/ ((module) => {

module.exports = require("exceljs");

/***/ }),
/* 269 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerExcelRules = void 0;
exports.CustomerExcelRules = {
    _num: {
        title: 'STT',
        width: 5,
        type: 'number',
        required: false,
    },
    customerCode: {
        title: 'Mã khách hàng',
        width: 20,
        type: 'string_number',
        required: true,
    },
    fullName: {
        title: 'Tên khách hàng',
        width: 30,
        type: 'string',
        required: true,
    },
    phone: {
        title: 'SĐT',
        width: 15,
        type: 'string',
        required: false,
    },
    debt: {
        title: 'Nợ',
        width: 12,
        type: 'number',
        required: false,
    },
    birthday: {
        title: 'Ngày sinh',
        width: 15,
        type: 'date',
        required: false,
    },
    yearOfBirth: {
        title: 'Năm sinh',
        width: 10,
        type: 'number',
        required: false,
    },
    gender: {
        title: 'Giới tính',
        width: 5,
        type: 'number',
        required: false,
    },
    addressProvince: {
        title: 'Tỉnh',
        width: 20,
        type: 'string',
        required: false,
    },
    addressWard: {
        title: 'Xã',
        width: 20,
        type: 'string',
        required: false,
    },
    addressStreet: {
        title: 'Số nhà / thôn / đường',
        width: 20,
        type: 'string',
        required: false,
    },
    facebook: {
        title: 'Facebook',
        width: 40,
        type: 'string',
        required: false,
    },
    zalo: {
        title: 'Zalo',
        width: 40,
        type: 'string',
        required: false,
    },
    note: {
        title: 'Ghi chú',
        width: 30,
        type: 'string',
        required: false,
    },
};


/***/ }),
/* 270 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileCustomerUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const payment_entity_1 = __webpack_require__(51);
const repositories_1 = __webpack_require__(42);
const excel_process_1 = __webpack_require__(271);
const customer_excel_rule_1 = __webpack_require__(269);
const dataPlainExample = {
    _num: 0,
    customerCode: '',
    fullName: '',
    phone: '',
    debt: 0,
    birthday: 0,
    yearOfBirth: 0,
    gender: 0,
    addressProvince: '',
    addressWard: '',
    addressStreet: '',
    facebook: '',
    zalo: '',
    note: '',
};
let ApiFileCustomerUploadExcel = class ApiFileCustomerUploadExcel {
    constructor(dataSource, customerManager, paymentManager) {
        this.dataSource = dataSource;
        this.customerManager = customerManager;
        this.paymentManager = paymentManager;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: customer_excel_rule_1.CustomerExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(customer_excel_rule_1.CustomerExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const dataPlainList = dataConvertList.map((item, index) => {
            if (!item.customerCode) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã khách hàng không được để trống`);
            }
            const dataPlain = {
                _num: item._num || 0,
                customerCode: item.customerCode || '',
                fullName: item.fullName || '',
                phone: item.phone || '',
                debt: item.debt != null ? item.debt : null,
                birthday: item.birthday ? item.birthday.getTime() : null,
                yearOfBirth: item.yearOfBirth || (item.birthday ? new Date(item.birthday).getFullYear() : null),
                gender: [0, 1].includes(item.gender) ? item.gender : null,
                addressProvince: item.addressProvince || '',
                addressWard: item.addressWard || '',
                addressStreet: item.addressStreet || '',
                facebook: item.facebook || '',
                zalo: item.zalo || '',
                note: item.note || '',
            };
            return dataPlain;
        });
        await this.processDataPlainList({ oid, userId, dataPlainList, time });
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const duplicatesBatchId = helpers_1.ESArray.checkDuplicate(dataPlainList, 'customerCode');
            duplicatesBatchId.forEach(({ value, indices }) => {
                const indicesString = indices.map((i) => i + 2);
                throw new error_1.BusinessError(`Có trùng lặp mã khách hàng = ${value} ở dòng ${indicesString.toString()}`);
            });
            const customerCodeList = dataPlainList.map((i) => i.customerCode);
            const customerOriginList = await this.customerManager.findManyBy(manager, {
                oid,
                customerCode: { IN: customerCodeList },
            });
            const customerOriginMapCode = helpers_1.ESArray.arrayToKeyValue(customerOriginList, 'customerCode');
            const dataPlainInsertList = dataPlainList.filter((i) => !customerOriginMapCode[i.customerCode]);
            const dataPlainUpdateList = dataPlainList.filter((i) => !!customerOriginMapCode[i.customerCode]);
            const dataChangeDebt = dataPlainUpdateList
                .map((i) => {
                const customerOrigin = customerOriginMapCode[i.customerCode];
                const debtUpdate = i.debt != null ? i.debt : customerOrigin.debt;
                return {
                    customerId: customerOrigin.id,
                    debtOrigin: customerOrigin.debt,
                    debtUpdate,
                };
            })
                .filter((i) => i.debtOrigin !== i.debtUpdate);
            if (dataPlainInsertList.length) {
                const customerInsertList = dataPlainInsertList.map((plain) => {
                    const customerInsert = {
                        oid,
                        customerCode: plain.customerCode,
                        fullName: plain.fullName,
                        phone: plain.phone,
                        debt: plain.debt || 0,
                        birthday: plain.birthday,
                        gender: plain.gender,
                        addressProvince: plain.addressProvince,
                        addressWard: plain.addressWard,
                        addressStreet: plain.addressStreet,
                        facebook: plain.facebook,
                        zalo: plain.zalo,
                        customerSourceId: 0,
                        yearOfBirth: plain.yearOfBirth,
                        relative: '',
                        healthHistory: '',
                        note: plain.note,
                        isActive: 1,
                    };
                    return customerInsert;
                });
                await this.customerManager.insertManyAndReturnEntity(manager, customerInsertList);
            }
            if (dataPlainUpdateList.length) {
                await this.customerManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['customerCode'],
                    tempList: dataPlainUpdateList,
                    update: {
                        fullName: true,
                        phone: true,
                        debt: (t, u) => ` CASE
                  WHEN "${t}"."debt" IS NOT NULL THEN "${t}"."debt"::bigint
                  ELSE "${u}"."debt"
                END`,
                        birthday: { cast: 'bigint' },
                        yearOfBirth: true,
                        gender: true,
                        addressProvince: true,
                        addressWard: true,
                        addressStreet: true,
                        facebook: true,
                        zalo: true,
                        note: true,
                    },
                    options: { requireEqualLength: true },
                });
            }
            if (dataChangeDebt.length) {
                const paymentInsertList = dataChangeDebt.map((i) => {
                    const paymentInsert = {
                        oid,
                        voucherType: payment_entity_1.PaymentVoucherType.Other,
                        voucherId: 0,
                        personType: payment_entity_1.PaymentPersonType.Customer,
                        personId: i.customerId,
                        createdAt: time,
                        paymentMethodId: 0,
                        paymentActionType: payment_entity_1.PaymentActionType.FixByExcel,
                        moneyDirection: payment_entity_1.MoneyDirection.Other,
                        note: 'Update Excel',
                        paidAmount: 0,
                        debtAmount: i.debtUpdate - i.debtOrigin,
                        openDebt: i.debtOrigin,
                        closeDebt: i.debtUpdate,
                        cashierId: userId,
                    };
                    return paymentInsert;
                });
                await this.paymentManager.insertMany(manager, paymentInsertList);
            }
        });
    }
};
exports.ApiFileCustomerUploadExcel = ApiFileCustomerUploadExcel;
exports.ApiFileCustomerUploadExcel = ApiFileCustomerUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerManager !== "undefined" && repositories_1.CustomerManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentManager !== "undefined" && repositories_1.PaymentManager) === "function" ? _c : Object])
], ApiFileCustomerUploadExcel);


/***/ }),
/* 271 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ExcelProcess = exports.ExcelColumnName = void 0;
const exceljs_1 = __webpack_require__(268);
const error_1 = __webpack_require__(14);
exports.ExcelColumnName = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
class ExcelProcess {
    static async getData(options) {
        const { file, excelRules, validate } = options;
        const maxSize = (validate === null || validate === void 0 ? void 0 : validate.maxSize) || 5;
        const validTypes = [
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'application/vnd.ms-excel',
            'application/wps-office.xlsx',
        ];
        const isValidType = validTypes.includes(file.mimetype);
        if (!isValidType) {
            throw new error_1.BusinessError('Chỉ chấp nhận file excel');
        }
        if (file.size > maxSize) {
            throw new error_1.BusinessError(`Chỉ chấp nhận file dưới ${Math.round(maxSize / 1024 / 1024)}MB`);
        }
        const workbook = new exceljs_1.Workbook();
        await workbook.xlsx.load(file.buffer);
        const worksheet = workbook.worksheets[0];
        const excelDataGrid = [];
        const excelRuleKeys = Object.keys(excelRules);
        worksheet.eachRow((row, rowNumber) => {
            if (!row.hasValues)
                return;
            const excelDataRow = [];
            for (let colIndex = 0; colIndex <= excelRuleKeys.length; colIndex++) {
                if (colIndex === 0)
                    continue;
                const cell = row.getCell(colIndex);
                const value = cell.value;
                if (value == null) {
                    excelDataRow.push(undefined);
                }
                else if (typeof value === 'object' && value instanceof Date) {
                    excelDataRow.push(value);
                }
                else if (typeof value === 'object' && value.hasOwnProperty('text')) {
                    excelDataRow.push(value.text);
                }
                else {
                    excelDataRow.push(value);
                }
            }
            if (rowNumber === 1) {
                excelDataRow.forEach((t, index) => {
                    const key = excelRuleKeys[index];
                    const rule = excelRules[key];
                    if (t !== rule.title) {
                        const msg = `Hàng ${rowNumber}, tiêu đề không đúng,`
                            + ` cột ${exports.ExcelColumnName[index]} cần có tên là ${rule.title}`;
                        throw new error_1.BusinessError(msg);
                    }
                });
                return;
            }
            excelDataRow.forEach((v, index) => {
                const key = excelRuleKeys[index];
                const rule = excelRules[key];
                const msgPrefix = `STT ${excelDataRow[0]}, hàng ${rowNumber}, `
                    + `cột ${exports.ExcelColumnName[index]}, ${rule.title}: `;
                let msgError = '';
                if (rule.required && (v == null || v === '')) {
                    msgError = `${msgPrefix} không được để trống`;
                }
                if (v != null && v !== '' && rule.type && typeof v !== rule.type) {
                    if (rule.type === 'number' && typeof v !== 'number') {
                        msgError = `${msgPrefix} cần có định dạng là số`;
                    }
                    if (rule.type === 'string' && typeof v !== 'string') {
                        msgError = `${msgPrefix} cần có định dạng là chữ`;
                    }
                    if (rule.type === 'string_number' && !['string', 'number'].includes(typeof v)) {
                        msgError = `${msgPrefix} cần có định dạng là chữ hoặc số`;
                    }
                    if (rule.type === 'date'
                        && v !== ''
                        && Object.prototype.toString.call(v) !== '[object Date]') {
                        msgError = `${msgPrefix} cần có định dạng là ngày`;
                    }
                }
                if (msgError) {
                    throw new error_1.BusinessError(msgError);
                }
            });
            excelDataGrid.push(excelDataRow);
        });
        return excelDataGrid;
    }
}
exports.ExcelProcess = ExcelProcess;


/***/ }),
/* 272 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileICDModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_icd_controller_1 = __webpack_require__(273);
const api_file_icd_upload_excel_1 = __webpack_require__(274);
let ApiFileICDModule = class ApiFileICDModule {
};
exports.ApiFileICDModule = ApiFileICDModule;
exports.ApiFileICDModule = ApiFileICDModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_icd_controller_1.ApiFileICDController],
        providers: [api_file_icd_upload_excel_1.ApiFileICDUploadExcel],
    })
], ApiFileICDModule);


/***/ }),
/* 273 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileICDController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const root_guard_1 = __webpack_require__(15);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const api_file_icd_upload_excel_1 = __webpack_require__(274);
let ApiFileICDController = class ApiFileICDController {
    constructor(apiFileICDUploadExcel) {
        this.apiFileICDUploadExcel = apiFileICDUploadExcel;
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileICDUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileICDController = ApiFileICDController;
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, root_guard_1.IsRoot)(),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _c : Object, typeof (_d = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileICDController.prototype, "uploadExcel", null);
exports.ApiFileICDController = ApiFileICDController = __decorate([
    (0, swagger_1.ApiTags)('FileICD'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-icd'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_icd_upload_excel_1.ApiFileICDUploadExcel !== "undefined" && api_file_icd_upload_excel_1.ApiFileICDUploadExcel) === "function" ? _a : Object])
], ApiFileICDController);


/***/ }),
/* 274 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileICDUploadExcel = exports.ProductExcelRules = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(45);
const repositories_1 = __webpack_require__(42);
const excel_process_1 = __webpack_require__(271);
exports.ProductExcelRules = {
    code: {
        title: 'Mã',
        width: 20,
        type: 'string',
        required: true,
    },
    name: {
        title: 'Tên',
        width: 50,
        type: 'string',
        required: true,
    },
};
const dataPlainExample = {
    code: '',
    name: '',
};
let ApiFileICDUploadExcel = class ApiFileICDUploadExcel {
    constructor(icdRepository) {
        this.icdRepository = icdRepository;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: exports.ProductExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(exports.ProductExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        await this.processDataPlainList({ dataPlainList: dataConvertList });
    }
    async processDataPlainList(data) {
        await this.icdRepository
            .getManager()
            .query(`TRUNCATE TABLE "${entities_1.ICD.name}" RESTART IDENTITY CASCADE;`);
        await this.icdRepository.insertMany(data.dataPlainList);
        return { data: true };
    }
};
exports.ApiFileICDUploadExcel = ApiFileICDUploadExcel;
exports.ApiFileICDUploadExcel = ApiFileICDUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ICDRepository !== "undefined" && repositories_1.ICDRepository) === "function" ? _a : Object])
], ApiFileICDUploadExcel);


/***/ }),
/* 275 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_group_service_1 = __webpack_require__(276);
const api_file_laboratory_controller_1 = __webpack_require__(277);
const api_file_laboratory_download_excel_1 = __webpack_require__(278);
const api_file_laboratory_upload_excel_1 = __webpack_require__(280);
let ApiFileLaboratoryModule = class ApiFileLaboratoryModule {
};
exports.ApiFileLaboratoryModule = ApiFileLaboratoryModule;
exports.ApiFileLaboratoryModule = ApiFileLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_laboratory_controller_1.ApiFileLaboratoryController],
        providers: [
            api_file_laboratory_download_excel_1.ApiFileLaboratoryDownloadExcel,
            api_file_laboratory_upload_excel_1.ApiFileLaboratoryUploadExcel,
            api_laboratory_group_service_1.ApiLaboratoryGroupService,
        ],
    })
], ApiFileLaboratoryModule);


/***/ }),
/* 276 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const laboratory_group_repository_1 = __webpack_require__(108);
let ApiLaboratoryGroupService = class ApiLaboratoryGroupService {
    constructor(laboratoryGroupRepository, laboratoryGroupManager) {
        this.laboratoryGroupRepository = laboratoryGroupRepository;
        this.laboratoryGroupManager = laboratoryGroupManager;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.laboratoryGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratoryGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, id) {
        const laboratoryGroup = await this.laboratoryGroupRepository.findOneBy({ oid, id });
        if (!laboratoryGroup)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { laboratoryGroup } };
    }
    async createOne(oid, body) {
        const laboratoryGroup = await this.laboratoryGroupRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { laboratoryGroup } };
    }
    async updateOne(oid, id, body) {
        const laboratoryGroupList = await this.laboratoryGroupRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { laboratoryGroup: laboratoryGroupList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.laboratoryGroupRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceAll(oid, body) {
        const laboratoryGroupInsertLit = body.laboratoryGroupReplaceAll
            .filter((i) => !i.id)
            .map((i) => {
            const insertDto = {
                name: i.name,
                roomId: i.roomId,
                printHtmlId: i.printHtmlId,
                oid,
            };
            return insertDto;
        });
        const laboratoryGroupUpdateLit = body.laboratoryGroupReplaceAll
            .filter((i) => !!i.id)
            .map((i) => {
            const insertDto = {
                name: i.name,
                roomId: i.roomId,
                printHtmlId: i.printHtmlId,
                id: i.id,
            };
            return insertDto;
        });
        await this.laboratoryGroupRepository.delete({
            oid,
            id: { NOT_IN: laboratoryGroupUpdateLit.map((i) => i.id) },
        });
        if (laboratoryGroupInsertLit.length) {
            await this.laboratoryGroupRepository.insertMany(laboratoryGroupInsertLit);
        }
        if (laboratoryGroupUpdateLit.length) {
            await this.laboratoryGroupManager.bulkUpdate({
                manager: this.laboratoryGroupRepository.getManager(),
                condition: { oid },
                compare: ['id'],
                update: ['name', 'roomId', 'printHtmlId'],
                tempList: laboratoryGroupUpdateLit,
                options: { requireEqualLength: true },
            });
        }
        return { data: true };
    }
    async systemList() {
        const data = await this.laboratoryGroupRepository.findMany({
            condition: { oid: 1 },
        });
        return { data };
    }
    async createByGroupName(oid, groupName) {
        const laboratoryGroupAll = await this.laboratoryGroupRepository.findManyBy({ oid });
        const groupNameList = laboratoryGroupAll.map((i) => i.name);
        const groupNameClean = helpers_1.ESArray.uniqueArray(groupName).filter((i) => !!i);
        const groupNameNoExist = groupNameClean.filter((i) => {
            return !groupNameList.includes(i);
        });
        const lgCreateList = groupNameNoExist.map((i) => {
            const dto = {
                oid,
                name: i,
                printHtmlId: 0,
                roomId: 0,
            };
            return dto;
        });
        const lgInsertedList = await this.laboratoryGroupRepository.insertManyAndReturnEntity(lgCreateList);
        return [...laboratoryGroupAll, ...lgInsertedList];
    }
};
exports.ApiLaboratoryGroupService = ApiLaboratoryGroupService;
exports.ApiLaboratoryGroupService = ApiLaboratoryGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof laboratory_group_repository_1.LaboratoryGroupRepository !== "undefined" && laboratory_group_repository_1.LaboratoryGroupRepository) === "function" ? _a : Object, typeof (_b = typeof laboratory_group_repository_1.LaboratoryGroupManager !== "undefined" && laboratory_group_repository_1.LaboratoryGroupManager) === "function" ? _b : Object])
], ApiLaboratoryGroupService);


/***/ }),
/* 277 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_laboratory_download_excel_1 = __webpack_require__(278);
const api_file_laboratory_upload_excel_1 = __webpack_require__(280);
let ApiFileLaboratoryController = class ApiFileLaboratoryController {
    constructor(apiFileLaboratoryDownloadExcel, apiFileLaboratoryUploadExcel) {
        this.apiFileLaboratoryDownloadExcel = apiFileLaboratoryDownloadExcel;
        this.apiFileLaboratoryUploadExcel = apiFileLaboratoryUploadExcel;
    }
    async downloadExcel({ oid, user, organization }) {
        return await this.apiFileLaboratoryDownloadExcel.downloadExcel({ oid });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileLaboratoryDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileLaboratoryUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileLaboratoryController = ApiFileLaboratoryController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileLaboratoryController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('download-excel/file-example'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileLaboratoryController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_LABORATORY),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileLaboratoryController.prototype, "uploadExcel", null);
exports.ApiFileLaboratoryController = ApiFileLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('FileLaboratory'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_laboratory_download_excel_1.ApiFileLaboratoryDownloadExcel !== "undefined" && api_file_laboratory_download_excel_1.ApiFileLaboratoryDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_laboratory_upload_excel_1.ApiFileLaboratoryUploadExcel !== "undefined" && api_file_laboratory_upload_excel_1.ApiFileLaboratoryUploadExcel) === "function" ? _b : Object])
], ApiFileLaboratoryController);


/***/ }),
/* 278 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileLaboratoryDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
const laboratory_excel_rule_1 = __webpack_require__(279);
let ApiFileLaboratoryDownloadExcel = class ApiFileLaboratoryDownloadExcel {
    constructor(laboratoryRepository) {
        this.laboratoryRepository = laboratoryRepository;
    }
    async downloadExcel(options) {
        const { oid } = options;
        const laboratoryList = await this.laboratoryRepository.findMany({
            relation: { laboratoryGroup: true },
            condition: { oid, level: 1 },
            sort: { laboratoryCode: 'ASC' },
        });
        const workbook = this.getWorkbookLaboratory(laboratoryList);
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA.VN-xet-nghiem.xlsx',
            },
        };
    }
    getWorkbookLaboratory(laboratoryList) {
        const dataRow = {
            style: {
                _num: { alignment: { horizontal: 'center' } },
                laboratoryCode: { alignment: { wrapText: true } },
                name: { alignment: { wrapText: true } },
                laboratoryGroupName: { alignment: { wrapText: true } },
                price: { alignment: { horizontal: 'right' } },
                costPrice: { alignment: { horizontal: 'right' } },
                lowValue: { alignment: { horizontal: 'center' } },
                highValue: { alignment: { horizontal: 'center' } },
                unit: { alignment: { horizontal: 'center' } },
            },
            data: [],
        };
        let indexNumber = 0;
        laboratoryList.forEach((laboratory, index) => {
            var _a;
            indexNumber++;
            const data = {
                _num: indexNumber,
                laboratoryCode: laboratory.laboratoryCode || '',
                name: laboratory.name || '',
                laboratoryGroupName: ((_a = laboratory.laboratoryGroup) === null || _a === void 0 ? void 0 : _a.name) || '',
                price: laboratory.price || 0,
                costPrice: laboratory.costPrice || 0,
                lowValue: laboratory.lowValue || 0,
                highValue: laboratory.highValue || 0,
                unit: laboratory.unit || '',
            };
            dataRow.data.push(data);
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                const rowTitle = worksheet.addRow(Object.values(laboratory_excel_rule_1.LaboratoryExcelRules).map((i) => i.title));
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: Object.entries(laboratory_excel_rule_1.LaboratoryExcelRules).map(([key, rule]) => ({
                key,
                width: rule.width,
            })),
            rows: [dataRow],
        });
        return workbook;
    }
};
exports.ApiFileLaboratoryDownloadExcel = ApiFileLaboratoryDownloadExcel;
exports.ApiFileLaboratoryDownloadExcel = ApiFileLaboratoryDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.LaboratoryRepository !== "undefined" && repositories_1.LaboratoryRepository) === "function" ? _a : Object])
], ApiFileLaboratoryDownloadExcel);


/***/ }),
/* 279 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryExcelRules = void 0;
exports.LaboratoryExcelRules = {
    _num: {
        title: 'STT',
        width: 5,
        type: 'number',
        required: false,
    },
    laboratoryCode: {
        title: 'Mã xét nghiệm',
        width: 20,
        type: 'string_number',
        required: true,
    },
    name: {
        title: 'Tên xét nghiệm',
        width: 50,
        type: 'string',
        required: true,
    },
    laboratoryGroupName: {
        title: 'Nhóm',
        width: 30,
        type: 'string',
        required: false,
    },
    costPrice: {
        title: 'Giá vốn',
        width: 12,
        type: 'number',
        required: false,
    },
    price: {
        title: 'Giá',
        width: 12,
        type: 'number',
        required: true,
    },
    lowValue: {
        title: 'Ngưỡng thấp',
        width: 12,
        type: 'number',
        required: false,
    },
    highValue: {
        title: 'Ngưỡng cao',
        width: 12,
        type: 'number',
        required: false,
    },
    unit: {
        title: 'Đơn vị',
        width: 12,
        type: 'string',
        required: false,
    },
};


/***/ }),
/* 280 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileLaboratoryUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const laboratory_entity_1 = __webpack_require__(66);
const repositories_1 = __webpack_require__(42);
const api_laboratory_group_service_1 = __webpack_require__(276);
const excel_process_1 = __webpack_require__(271);
const laboratory_excel_rule_1 = __webpack_require__(279);
const dataPlainExample = {
    _num: 0,
    laboratoryCode: '',
    name: '',
    price: 0,
    costPrice: 0,
    laboratoryGroupName: '',
    unit: '',
    lowValue: 0,
    highValue: 0,
};
let ApiFileLaboratoryUploadExcel = class ApiFileLaboratoryUploadExcel {
    constructor(dataSource, laboratoryManager, laboratoryGroupRepository, apiLaboratoryGroupService) {
        this.dataSource = dataSource;
        this.laboratoryManager = laboratoryManager;
        this.laboratoryGroupRepository = laboratoryGroupRepository;
        this.apiLaboratoryGroupService = apiLaboratoryGroupService;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: laboratory_excel_rule_1.LaboratoryExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(laboratory_excel_rule_1.LaboratoryExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const groupNameList = dataConvertList.map((i) => i.laboratoryGroupName || '');
        const laboratoryGroupList = await this.apiLaboratoryGroupService.createByGroupName(oid, groupNameList);
        const laboratoryGroupMapName = helpers_1.ESArray.arrayToKeyValue(laboratoryGroupList, 'name');
        const dataPlainList = dataConvertList.map((item, index) => {
            var _a;
            if (!item.laboratoryCode) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã xét nghiệm không được để trống`);
            }
            let laboratoryGroupId = 0;
            const laboratoryGroupName = item.laboratoryGroupName;
            if (laboratoryGroupName) {
                laboratoryGroupId = ((_a = laboratoryGroupMapName[laboratoryGroupName]) === null || _a === void 0 ? void 0 : _a.id) || 0;
            }
            const dataPlain = {
                _num: item._num || 0,
                laboratoryCode: item.laboratoryCode,
                name: item.name || '',
                price: item.price || 0,
                costPrice: item.costPrice || 0,
                laboratoryGroupName: item.laboratoryGroupName || '',
                laboratoryGroupId,
                lowValue: item.lowValue || 0,
                highValue: item.highValue || 0,
                unit: item.unit || '',
            };
            return dataPlain;
        });
        await this.processDataPlainList({ oid, userId, dataPlainList, time });
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const duplicatesBatchId = helpers_1.ESArray.checkDuplicate(dataPlainList, 'laboratoryCode');
            duplicatesBatchId.forEach(({ value, indices }) => {
                const indicesString = indices.map((i) => i + 2);
                throw new error_1.BusinessError(`Có trùng lặp mã xét nghiệm = ${value} ở dòng ${indicesString.toString()}`);
            });
            const laboratoryCodeList = dataPlainList.map((i) => i.laboratoryCode);
            const laboratoryOriginList = await this.laboratoryManager.findManyBy(manager, {
                oid,
                laboratoryCode: { IN: laboratoryCodeList },
            });
            const laboratoryOriginMapCode = helpers_1.ESArray.arrayToKeyValue(laboratoryOriginList, 'laboratoryCode');
            const dataPlainInsertList = dataPlainList.filter((i) => !laboratoryOriginMapCode[i.laboratoryCode]);
            const dataPlainUpdateList = dataPlainList.filter((i) => !!laboratoryOriginMapCode[i.laboratoryCode]);
            if (dataPlainInsertList.length) {
                const laboratoryInsertList = dataPlainInsertList.map((plain) => {
                    const laboratoryInsert = {
                        oid,
                        laboratoryCode: plain.laboratoryCode,
                        name: plain.name,
                        costPrice: plain.costPrice,
                        price: plain.price,
                        laboratoryGroupId: plain.laboratoryGroupId,
                        priority: 0,
                        level: 1,
                        parentId: 0,
                        valueType: laboratory_entity_1.LaboratoryValueType.Number,
                        unit: plain.unit,
                        lowValue: plain.lowValue,
                        highValue: plain.highValue,
                        options: '',
                    };
                    return laboratoryInsert;
                });
                const laboratoryCreatedList = await this.laboratoryManager.insertManyAndReturnEntity(manager, laboratoryInsertList);
                await this.laboratoryManager.updateAndReturnEntity(manager, { oid, id: { IN: laboratoryCreatedList.map((i) => i.id) } }, { parentId: () => '"id"' });
            }
            if (dataPlainUpdateList.length) {
                await this.laboratoryManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['laboratoryCode'],
                    tempList: dataPlainUpdateList,
                    update: [
                        'name',
                        'laboratoryGroupId',
                        'costPrice',
                        'price',
                        'lowValue',
                        'highValue',
                        'unit',
                    ],
                    options: { requireEqualLength: true },
                });
            }
        });
    }
};
exports.ApiFileLaboratoryUploadExcel = ApiFileLaboratoryUploadExcel;
exports.ApiFileLaboratoryUploadExcel = ApiFileLaboratoryUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.LaboratoryManager !== "undefined" && repositories_1.LaboratoryManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.LaboratoryGroupRepository !== "undefined" && repositories_1.LaboratoryGroupRepository) === "function" ? _c : Object, typeof (_d = typeof api_laboratory_group_service_1.ApiLaboratoryGroupService !== "undefined" && api_laboratory_group_service_1.ApiLaboratoryGroupService) === "function" ? _d : Object])
], ApiFileLaboratoryUploadExcel);


/***/ }),
/* 281 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_procedure_group_service_1 = __webpack_require__(282);
const api_file_procedure_controller_1 = __webpack_require__(283);
const api_file_procedure_download_excel_1 = __webpack_require__(284);
const api_file_procedure_upload_excel_1 = __webpack_require__(286);
let ApiFileProcedureModule = class ApiFileProcedureModule {
};
exports.ApiFileProcedureModule = ApiFileProcedureModule;
exports.ApiFileProcedureModule = ApiFileProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_procedure_controller_1.ApiFileProcedureController],
        providers: [api_file_procedure_download_excel_1.ApiFileProcedureDownloadExcel, api_file_procedure_upload_excel_1.ApiFileProcedureUploadExcel, api_procedure_group_service_1.ApiProcedureGroupService],
    })
], ApiFileProcedureModule);


/***/ }),
/* 282 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const procedure_group_repository_1 = __webpack_require__(120);
let ApiProcedureGroupService = class ApiProcedureGroupService {
    constructor(procedureGroupRepository) {
        this.procedureGroupRepository = procedureGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.procedureGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.procedureGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.procedureGroupRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async replaceAll(oid, body) {
        await this.procedureGroupRepository.replaceAll(oid, body.procedureGroupReplaceAll);
        return { data: true };
    }
    async createOne(oid, body) {
        const id = await this.procedureGroupRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.procedureGroupRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.procedureGroupRepository.update({ id, oid }, body);
        const data = await this.procedureGroupRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.procedureGroupRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
    async createByGroupName(oid, groupName) {
        const procedureGroupAll = await this.procedureGroupRepository.findManyBy({ oid });
        const groupNameList = procedureGroupAll.map((i) => i.name);
        const groupNameClean = helpers_1.ESArray.uniqueArray(groupName).filter((i) => !!i);
        const groupNameNoExist = groupNameClean.filter((i) => {
            return !groupNameList.includes(i);
        });
        const lgCreateList = groupNameNoExist.map((i) => {
            const dto = {
                oid,
                name: i,
            };
            return dto;
        });
        const lgInsertedList = await this.procedureGroupRepository.insertManyAndReturnEntity(lgCreateList);
        return [...procedureGroupAll, ...lgInsertedList];
    }
};
exports.ApiProcedureGroupService = ApiProcedureGroupService;
exports.ApiProcedureGroupService = ApiProcedureGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof procedure_group_repository_1.ProcedureGroupRepository !== "undefined" && procedure_group_repository_1.ProcedureGroupRepository) === "function" ? _a : Object])
], ApiProcedureGroupService);


/***/ }),
/* 283 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_procedure_download_excel_1 = __webpack_require__(284);
const api_file_procedure_upload_excel_1 = __webpack_require__(286);
let ApiFileProcedureController = class ApiFileProcedureController {
    constructor(apiFileProcedureDownloadExcel, apiFileProcedureUploadExcel) {
        this.apiFileProcedureDownloadExcel = apiFileProcedureDownloadExcel;
        this.apiFileProcedureUploadExcel = apiFileProcedureUploadExcel;
    }
    async downloadExcel({ oid, user, organization }) {
        return await this.apiFileProcedureDownloadExcel.downloadExcel({ oid });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileProcedureDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileProcedureUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileProcedureController = ApiFileProcedureController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProcedureController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('download-excel/file-example'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProcedureController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PROCEDURE),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProcedureController.prototype, "uploadExcel", null);
exports.ApiFileProcedureController = ApiFileProcedureController = __decorate([
    (0, swagger_1.ApiTags)('FileProcedure'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_procedure_download_excel_1.ApiFileProcedureDownloadExcel !== "undefined" && api_file_procedure_download_excel_1.ApiFileProcedureDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_procedure_upload_excel_1.ApiFileProcedureUploadExcel !== "undefined" && api_file_procedure_upload_excel_1.ApiFileProcedureUploadExcel) === "function" ? _b : Object])
], ApiFileProcedureController);


/***/ }),
/* 284 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProcedureDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
const procedure_excel_rule_1 = __webpack_require__(285);
let ApiFileProcedureDownloadExcel = class ApiFileProcedureDownloadExcel {
    constructor(procedureRepository) {
        this.procedureRepository = procedureRepository;
    }
    async downloadExcel(options) {
        const { oid } = options;
        const procedureList = await this.procedureRepository.findMany({
            relation: { procedureGroup: true },
            condition: { oid },
            sort: { code: 'ASC' },
        });
        const workbook = this.getWorkbookProcedure(procedureList);
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA.VN-dich-vu.xlsx',
            },
        };
    }
    getWorkbookProcedure(procedureList) {
        const dataRow = {
            style: {
                _num: { alignment: { horizontal: 'center' } },
                code: { alignment: { wrapText: true } },
                name: { alignment: { wrapText: true } },
                procedureGroupName: { alignment: { wrapText: true } },
                price: { alignment: { horizontal: 'right' } },
            },
            data: [],
        };
        let indexNumber = 0;
        procedureList.forEach((procedure, index) => {
            var _a;
            indexNumber++;
            const data = {
                _num: indexNumber,
                code: procedure.code || '',
                name: procedure.name || '',
                procedureGroupName: ((_a = procedure.procedureGroup) === null || _a === void 0 ? void 0 : _a.name) || '',
                price: procedure.price || 0,
            };
            dataRow.data.push(data);
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                const rowTitle = worksheet.addRow(Object.values(procedure_excel_rule_1.ProcedureExcelRules).map((i) => i.title));
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: Object.entries(procedure_excel_rule_1.ProcedureExcelRules).map(([key, rule]) => ({
                key,
                width: rule.width,
            })),
            rows: [dataRow],
        });
        return workbook;
    }
};
exports.ApiFileProcedureDownloadExcel = ApiFileProcedureDownloadExcel;
exports.ApiFileProcedureDownloadExcel = ApiFileProcedureDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _a : Object])
], ApiFileProcedureDownloadExcel);


/***/ }),
/* 285 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureExcelRules = void 0;
exports.ProcedureExcelRules = {
    _num: {
        title: 'STT',
        width: 5,
        type: 'number',
        required: false,
    },
    code: {
        title: 'Mã dịch vụ',
        width: 20,
        type: 'string_number',
        required: true,
    },
    name: {
        title: 'Tên dịch vụ',
        width: 50,
        type: 'string',
        required: true,
    },
    procedureGroupName: {
        title: 'Nhóm',
        width: 30,
        type: 'string',
        required: false,
    },
    price: {
        title: 'Giá',
        width: 12,
        type: 'number',
        required: true,
    },
};


/***/ }),
/* 286 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProcedureUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const procedure_entity_1 = __webpack_require__(69);
const repositories_1 = __webpack_require__(42);
const api_procedure_group_service_1 = __webpack_require__(282);
const excel_process_1 = __webpack_require__(271);
const procedure_excel_rule_1 = __webpack_require__(285);
const dataPlainExample = {
    _num: 0,
    code: '',
    name: '',
    price: 0,
    procedureGroupName: '',
};
let ApiFileProcedureUploadExcel = class ApiFileProcedureUploadExcel {
    constructor(dataSource, procedureManager, procedureGroupRepository, apiProcedureGroupService) {
        this.dataSource = dataSource;
        this.procedureManager = procedureManager;
        this.procedureGroupRepository = procedureGroupRepository;
        this.apiProcedureGroupService = apiProcedureGroupService;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: procedure_excel_rule_1.ProcedureExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(procedure_excel_rule_1.ProcedureExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const groupNameList = dataConvertList.map((i) => i.procedureGroupName || '');
        const procedureGroupList = await this.apiProcedureGroupService.createByGroupName(oid, groupNameList);
        const procedureGroupMapName = helpers_1.ESArray.arrayToKeyValue(procedureGroupList, 'name');
        const dataPlainList = dataConvertList.map((item, index) => {
            var _a;
            if (!item.code) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã dịch vụ không được để trống`);
            }
            let procedureGroupId = 0;
            const procedureGroupName = item.procedureGroupName;
            if (procedureGroupName) {
                procedureGroupId = ((_a = procedureGroupMapName[procedureGroupName]) === null || _a === void 0 ? void 0 : _a.id) || 0;
            }
            const dataPlain = {
                _num: item._num || 0,
                code: item.code,
                name: item.name || '',
                price: item.price || 0,
                procedureGroupName: item.procedureGroupName || '',
                procedureGroupId,
            };
            return dataPlain;
        });
        await this.processDataPlainList({ oid, userId, dataPlainList, time });
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const duplicatesBatchId = helpers_1.ESArray.checkDuplicate(dataPlainList, 'code');
            duplicatesBatchId.forEach(({ value, indices }) => {
                const indicesString = indices.map((i) => i + 2);
                throw new error_1.BusinessError(`Có trùng lặp mã dịch vụ = ${value} ở dòng ${indicesString.toString()}`);
            });
            const codeList = dataPlainList.map((i) => i.code);
            const procedureOriginList = await this.procedureManager.findManyBy(manager, {
                oid,
                code: { IN: codeList },
            });
            const procedureOriginMapCode = helpers_1.ESArray.arrayToKeyValue(procedureOriginList, 'code');
            const dataPlainInsertList = dataPlainList.filter((i) => !procedureOriginMapCode[i.code]);
            const dataPlainUpdateList = dataPlainList.filter((i) => !!procedureOriginMapCode[i.code]);
            if (dataPlainInsertList.length) {
                const procedureInsertList = dataPlainInsertList.map((plain) => {
                    const procedureInsert = {
                        oid,
                        code: plain.code,
                        name: plain.name,
                        price: plain.price,
                        procedureGroupId: plain.procedureGroupId,
                        procedureType: procedure_entity_1.ProcedureType.Basic,
                        totalSessions: 0,
                        gapHours: 0,
                        gapHoursType: 0,
                        isActive: 1,
                    };
                    return procedureInsert;
                });
                await this.procedureManager.insertManyAndReturnEntity(manager, procedureInsertList);
            }
            if (dataPlainUpdateList.length) {
                await this.procedureManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['code'],
                    tempList: dataPlainUpdateList,
                    update: ['name', 'price', 'procedureGroupId'],
                    options: { requireEqualLength: true },
                });
            }
        });
    }
};
exports.ApiFileProcedureUploadExcel = ApiFileProcedureUploadExcel;
exports.ApiFileProcedureUploadExcel = ApiFileProcedureUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProcedureManager !== "undefined" && repositories_1.ProcedureManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProcedureGroupRepository !== "undefined" && repositories_1.ProcedureGroupRepository) === "function" ? _c : Object, typeof (_d = typeof api_procedure_group_service_1.ApiProcedureGroupService !== "undefined" && api_procedure_group_service_1.ApiProcedureGroupService) === "function" ? _d : Object])
], ApiFileProcedureUploadExcel);


/***/ }),
/* 287 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_group_service_1 = __webpack_require__(288);
const api_file_product_controller_1 = __webpack_require__(289);
const api_file_product_download_excel_1 = __webpack_require__(290);
const api_file_product_upload_excel_1 = __webpack_require__(292);
let ApiFileProductModule = class ApiFileProductModule {
};
exports.ApiFileProductModule = ApiFileProductModule;
exports.ApiFileProductModule = ApiFileProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_product_controller_1.ApiFileProductController],
        providers: [api_file_product_download_excel_1.ApiFileProductDownloadExcel, api_file_product_upload_excel_1.ApiFileProductUploadExcel, api_product_group_service_1.ApiProductGroupService],
    })
], ApiFileProductModule);


/***/ }),
/* 288 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const product_group_repository_1 = __webpack_require__(122);
let ApiProductGroupService = class ApiProductGroupService {
    constructor(productGroupRepository) {
        this.productGroupRepository = productGroupRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.productGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.productGroupRepository.findMany({
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.productGroupRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async replaceAll(oid, body) {
        await this.productGroupRepository.replaceAll(oid, body.productGroupReplaceAll);
        return { data: true };
    }
    async createOne(oid, body) {
        const id = await this.productGroupRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.productGroupRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.productGroupRepository.update({ id, oid }, body);
        const data = await this.productGroupRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.productGroupRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
    async createByGroupName(oid, groupName) {
        const productGroupAll = await this.productGroupRepository.findManyBy({ oid });
        const groupNameList = productGroupAll.map((i) => i.name);
        const groupNameClean = helpers_1.ESArray.uniqueArray(groupName).filter((i) => !!i);
        const groupNameNoExist = groupNameClean.filter((i) => {
            return !groupNameList.includes(i);
        });
        const lgCreateList = groupNameNoExist.map((i) => {
            const dto = {
                oid,
                name: i,
            };
            return dto;
        });
        const lgInsertedList = await this.productGroupRepository.insertManyAndReturnEntity(lgCreateList);
        return [...productGroupAll, ...lgInsertedList];
    }
};
exports.ApiProductGroupService = ApiProductGroupService;
exports.ApiProductGroupService = ApiProductGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof product_group_repository_1.ProductGroupRepository !== "undefined" && product_group_repository_1.ProductGroupRepository) === "function" ? _a : Object])
], ApiProductGroupService);


/***/ }),
/* 289 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_product_download_excel_1 = __webpack_require__(290);
const api_file_product_upload_excel_1 = __webpack_require__(292);
let ApiFileProductController = class ApiFileProductController {
    constructor(apiFileProductDownloadExcel, apiFileProductUploadExcel) {
        this.apiFileProductDownloadExcel = apiFileProductDownloadExcel;
        this.apiFileProductUploadExcel = apiFileProductUploadExcel;
    }
    async downloadExcel({ oid, user, organization }) {
        return await this.apiFileProductDownloadExcel.downloadExcel({ oid });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileProductDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileProductUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileProductController = ApiFileProductController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('download-excel/file-example'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PRODUCT),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileProductController.prototype, "uploadExcel", null);
exports.ApiFileProductController = ApiFileProductController = __decorate([
    (0, swagger_1.ApiTags)('FileProduct'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_product_download_excel_1.ApiFileProductDownloadExcel !== "undefined" && api_file_product_download_excel_1.ApiFileProductDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_product_upload_excel_1.ApiFileProductUploadExcel !== "undefined" && api_file_product_upload_excel_1.ApiFileProductUploadExcel) === "function" ? _b : Object])
], ApiFileProductController);


/***/ }),
/* 290 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
const product_excel_rule_1 = __webpack_require__(291);
let ApiFileProductDownloadExcel = class ApiFileProductDownloadExcel {
    constructor(productRepository, productGroupRepository, batchRepository) {
        this.productRepository = productRepository;
        this.productGroupRepository = productGroupRepository;
        this.batchRepository = batchRepository;
    }
    async downloadExcel(options) {
        const { oid } = options;
        const productGroupAll = await this.productGroupRepository.findManyBy({ oid });
        const productGroupMap = helpers_1.ESArray.arrayToKeyValue(productGroupAll, 'id');
        const productList = await this.productRepository.findMany({
            condition: { oid, isActive: 1 },
            sort: { productCode: 'ASC' },
        });
        const batchList = await this.batchRepository.findMany({
            condition: { oid },
            sort: { productId: 'ASC' },
        });
        const batchListMap = helpers_1.ESArray.arrayToKeyArray(batchList, 'productId');
        productList.forEach((product) => {
            product.productGroup = productGroupMap[product.productGroupId];
            product.batchList = batchListMap[product.id] || [];
        });
        const workbook = this.getWorkbookProduct(productList);
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA-san-pham.xlsx',
            },
        };
    }
    getWorkbookProduct(productList) {
        const dataRow = {
            style: {
                _num: { alignment: { horizontal: 'center' } },
                productCode: { alignment: { wrapText: true } },
                brandName: { alignment: { wrapText: true } },
                batchId: { alignment: { horizontal: 'center' } },
                lotNumber: { alignment: { horizontal: 'center' } },
                expiryDate: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy' },
                quantity: { numFmt: '###,##0', font: { bold: true } },
                unitBasicName: { alignment: { horizontal: 'center' } },
                costPrice: { numFmt: '###,##0' },
                retailPrice: { numFmt: '###,##0' },
                costAmount: { numFmt: '###,##0' },
                substance: { alignment: { wrapText: true } },
                productGroupName: {},
                route: { alignment: { horizontal: 'center' } },
                source: { alignment: { horizontal: 'center' } },
            },
            data: [],
        };
        let indexNumber = 0;
        productList.forEach((product, productIndex) => {
            var _a, _b;
            const unitArray = JSON.parse(product.unit || '[]');
            const unitBasicName = ((_a = unitArray.find((i) => i.rate === 1)) === null || _a === void 0 ? void 0 : _a.name) || '';
            if (product.batchList.length === 0) {
                indexNumber++;
                const data = {
                    _num: indexNumber,
                    productCode: product.productCode || '',
                    brandName: product.brandName || '',
                    batchId: '',
                    lotNumber: '',
                    expiryDate: '',
                    quantity: product.quantity || 0,
                    unitBasicName,
                    costPrice: product.costPrice || 0,
                    retailPrice: product.retailPrice || 0,
                    costAmount: product.wholesalePrice || 0,
                    substance: product.substance || '',
                    productGroupName: ((_b = product.productGroup) === null || _b === void 0 ? void 0 : _b.name) || '',
                    route: product.route || '',
                    source: product.source || '',
                };
                dataRow.data.push(data);
            }
            else {
                product.batchList.forEach((batch, batchIndex) => {
                    var _a;
                    indexNumber++;
                    const data = {
                        _num: indexNumber,
                        productCode: product.productCode,
                        brandName: product.brandName || '',
                        batchId: batch.id || '',
                        lotNumber: batch.lotNumber || '',
                        expiryDate: batch.expiryDate ? new Date(batch.expiryDate + 7 * 60 * 60 * 1000) : '',
                        quantity: batch.quantity || 0,
                        unitBasicName,
                        costPrice: batch.costPrice || 0,
                        retailPrice: product.retailPrice || 0,
                        costAmount: batch.costAmount || 0,
                        substance: product.substance || '',
                        productGroupName: ((_a = product.productGroup) === null || _a === void 0 ? void 0 : _a.name) || '',
                        route: product.route || '',
                        source: product.source || '',
                    };
                    dataRow.data.push(data);
                });
            }
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                const rowTitle = worksheet.addRow(Object.values(product_excel_rule_1.ProductExcelRules).map((i) => i.title));
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: Object.entries(product_excel_rule_1.ProductExcelRules).map(([key, rule]) => ({ key, width: rule.width })),
            rows: [dataRow],
        });
        return workbook;
    }
};
exports.ApiFileProductDownloadExcel = ApiFileProductDownloadExcel;
exports.ApiFileProductDownloadExcel = ApiFileProductDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductGroupRepository !== "undefined" && repositories_1.ProductGroupRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _c : Object])
], ApiFileProductDownloadExcel);


/***/ }),
/* 291 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductExcelRules = void 0;
exports.ProductExcelRules = {
    _num: {
        title: 'STT',
        width: 5,
        type: 'number',
        required: false,
    },
    productCode: {
        title: 'Mã sản phẩm',
        width: 20,
        type: 'string_number',
        required: true,
    },
    brandName: {
        title: 'Tên sản phẩm',
        width: 50,
        type: 'string',
        required: true,
    },
    batchId: {
        title: 'ID lô',
        width: 7,
        type: 'number',
        required: false,
    },
    lotNumber: {
        title: 'Số lô',
        width: 15,
        type: 'string_number',
        required: false,
    },
    expiryDate: {
        title: 'Hạn sử dụng',
        width: 12,
        type: 'date',
        required: false,
    },
    quantity: {
        title: 'Số lượng',
        width: 10,
        type: 'number',
        required: true,
    },
    unitBasicName: {
        title: 'Đơn vị',
        width: 10,
        type: 'string',
        required: false,
    },
    costPrice: {
        title: 'Giá nhập',
        width: 12,
        type: 'number',
        required: true,
    },
    retailPrice: {
        title: 'Giá bán',
        width: 12,
        type: 'number',
        required: true,
    },
    costAmount: {
        title: 'Tổng vốn còn lại',
        width: 12,
        type: 'number',
        required: false,
    },
    substance: {
        title: 'Hoạt chất',
        width: 30,
        type: 'string',
        required: false,
    },
    productGroupName: {
        title: 'Nhóm',
        width: 24,
        type: 'string',
        required: false,
    },
    route: {
        title: 'Đường dùng',
        width: 12,
        type: 'string',
        required: false,
    },
    source: {
        title: 'Nguồn gốc',
        width: 12,
        type: 'string',
        required: false,
    },
};


/***/ }),
/* 292 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileProductUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const product_entity_1 = __webpack_require__(57);
const repositories_1 = __webpack_require__(42);
const api_product_group_service_1 = __webpack_require__(288);
const excel_process_1 = __webpack_require__(271);
const product_excel_rule_1 = __webpack_require__(291);
const dataPlainExample = {
    _num: 0,
    productCode: '',
    brandName: '',
    batchId: 0,
    lotNumber: '',
    expiryDate: 0,
    quantity: 0,
    unitBasicName: '',
    costPrice: 0,
    retailPrice: 0,
    costAmount: 0,
    substance: '',
    productGroupName: '',
    route: '',
    source: '',
};
let ApiFileProductUploadExcel = class ApiFileProductUploadExcel {
    constructor(dataSource, productGroupRepository, productManager, batchManager, productMovementManager, apiProductGroupService) {
        this.dataSource = dataSource;
        this.productGroupRepository = productGroupRepository;
        this.productManager = productManager;
        this.batchManager = batchManager;
        this.productMovementManager = productMovementManager;
        this.apiProductGroupService = apiProductGroupService;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: product_excel_rule_1.ProductExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(product_excel_rule_1.ProductExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const groupNameList = dataConvertList.map((i) => i.productGroupName || '');
        const productGroupList = await this.apiProductGroupService.createByGroupName(oid, groupNameList);
        const productGroupMapName = helpers_1.ESArray.arrayToKeyValue(productGroupList, 'name');
        const dataPlainList = dataConvertList.map((item, index) => {
            var _a;
            if (!item.productCode) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã sản phẩm không được để trống`);
            }
            let productGroupId = 0;
            const productGroupName = item.productGroupName;
            if (productGroupName) {
                productGroupId = ((_a = productGroupMapName[productGroupName]) === null || _a === void 0 ? void 0 : _a.id) || 0;
            }
            const batchId = item.batchId || 0;
            const lotNumber = String(item.lotNumber || '');
            const expiryDate = item.expiryDate ? item.expiryDate.getTime() : null;
            const quantity = item.quantity;
            const costPrice = Math.round(item.costPrice);
            let costAmount;
            if (costAmount == null || costAmount === '') {
                costAmount = costPrice * quantity;
            }
            else {
                costAmount = Math.round(item.costAmount);
            }
            const retailPrice = Math.round(item.retailPrice || 0);
            const dataPlain = {
                _num: item._num || 0,
                productId: 0,
                productCode: item.productCode,
                brandName: item.brandName,
                batchId,
                lotNumber,
                expiryDate,
                quantity,
                unitBasicName: item.unitBasicName,
                costPrice,
                retailPrice,
                costAmount: costAmount,
                substance: item.substance,
                productGroupId,
                productGroupName: item.productGroupName,
                route: item.route,
                source: item.source,
                productUpsert: {
                    oid,
                    id: 0,
                    productCode: item.productCode,
                    productType: product_entity_1.ProductType.Basic,
                    brandName: item.brandName,
                    productGroupId,
                    costPrice,
                    retailPrice,
                    quantity: 0,
                    unit: JSON.stringify([{ name: item.unitBasicName, rate: 1, default: true }]),
                    warehouseIds: JSON.stringify([0]),
                    wholesalePrice: 0,
                    substance: item.substance,
                    route: item.route,
                    source: item.source,
                    hintUsage: '',
                    image: '',
                    isActive: 1,
                    updatedAt: time,
                    splitBatchByWarehouse: product_entity_1.SplitBatchByWarehouse.Inherit,
                    splitBatchByDistributor: product_entity_1.SplitBatchByDistributor.Inherit,
                    splitBatchByExpiryDate: product_entity_1.SplitBatchByExpiryDate.Inherit,
                    splitBatchByCostPrice: product_entity_1.SplitBatchByCostPrice.Inherit,
                },
                batchUpsert: {
                    oid,
                    id: batchId,
                    productId: 0,
                    lotNumber,
                    costAmount,
                    costPrice,
                    distributorId: 0,
                    expiryDate,
                    isActive: 1,
                    quantity,
                    registeredAt: Date.now(),
                    warehouseId: 0,
                },
            };
            return dataPlain;
        });
        await this.processDataPlainList({ oid, userId, dataPlainList, time });
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const productCodeList = dataPlainList.map((i) => i.productCode);
            const productOriginList = await this.productManager.updateAndReturnEntity(manager, { oid, productCode: { IN: productCodeList }, isActive: 1 }, { updatedAt: time });
            const productOriginMap = helpers_1.ESArray.arrayToKeyValue(productOriginList, 'id');
            const productOriginMapCode = helpers_1.ESArray.arrayToKeyValue(productOriginList, 'productCode');
            const batchOriginList = await this.batchManager.updateAndReturnEntity(manager, { oid, productId: { IN: productOriginList.map((i) => i.id) }, isActive: 1 }, { updatedAt: time });
            const batchOriginMap = helpers_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
            const batchListMapOrigin = helpers_1.ESArray.arrayToKeyArray(batchOriginList, 'productId');
            const batchIdMap = new Map();
            dataPlainList.forEach((plain, index) => {
                const productOrigin = productOriginMapCode[plain.productCode];
                if (productOrigin) {
                    const productId = productOrigin.id;
                    plain.productId = productId;
                    plain.productUpsert.id = productId;
                    plain.batchUpsert.productId = productId;
                }
            });
            dataPlainList
                .filter((plain) => plain.batchId)
                .forEach((plain, index) => {
                const rowIndex = index + 2;
                const batchId = plain.batchId;
                const productOrigin = productOriginMapCode[plain.productCode];
                const batchOrigin = batchOriginMap[batchId];
                if (!batchOrigin || !productOrigin) {
                    throw new error_1.BusinessError(`Lỗi: Dòng ${rowIndex}: Không có lô hàng nào phù hợp với ID = ${batchId}`
                        + ` và mã sản phẩm = ${plain.productCode}`);
                }
                if (batchOrigin.productId !== plain.productId) {
                    throw new error_1.BusinessError(`Lỗi: Dòng ${rowIndex}: ID lô = ${batchId} có mã sản phẩm không đúng, `
                        + `gợi ý mã sản phẩm phù hợp = ${(productOrigin === null || productOrigin === void 0 ? void 0 : productOrigin.productCode) || ''}`);
                }
                batchIdMap.set(batchId, true);
            });
            dataPlainList
                .filter((plain) => !plain.batchId)
                .forEach((plain, index) => {
                if (!plain.productId)
                    return;
                const productOrigin = productOriginMapCode[plain.productCode];
                const batchList = batchListMapOrigin[plain.productId] || [];
                batchList.sort((a, b) => (a <= b ? -1 : 1));
                if (productOrigin.productType === product_entity_1.ProductType.Basic) {
                    if (batchList.length) {
                        const batchId = batchList[0].id;
                        plain.batchId = batchId;
                        plain.batchUpsert.id = batchId;
                    }
                }
                else {
                    const batchExist = batchList.find((batchOrigin) => {
                        return (batchOrigin.lotNumber == plain.batchUpsert.lotNumber
                            && batchOrigin.expiryDate === plain.batchUpsert.expiryDate
                            && !batchIdMap.has(batchOrigin.id));
                    });
                    if (batchExist) {
                        const batchId = batchExist.id;
                        plain.batchUpsert.id = batchId;
                        plain.batchId = batchId;
                        batchIdMap.set(batchId, true);
                    }
                }
            });
            const duplicatesBatchId = helpers_1.ESArray.checkDuplicate(dataPlainList, 'batchId');
            duplicatesBatchId.forEach(({ value, indices }) => {
                if (value === 0)
                    return;
                if (value != 0) {
                    const indicesString = indices.map((i) => i + 2);
                    throw new error_1.BusinessError(`Có trùng lặp mã sản phẩm = ${value} ở dòng ${indicesString.toString()}`);
                }
            });
            const dataPlainInsertList = dataPlainList.filter((i) => !i.productId);
            const dataPlainUpdateList = dataPlainList.filter((i) => !!i.productId);
            const productMovementInsertList = [];
            if (dataPlainInsertList.length) {
                const productCodeMap = new Map();
                const productInsertList = [];
                dataPlainInsertList.forEach((plain) => {
                    if (productCodeMap.has(plain.productCode)) {
                        productCodeMap.get(plain.productCode).productType = product_entity_1.ProductType.SplitBatch;
                    }
                    else {
                        const _a = plain.productUpsert, { id } = _a, productInsertBody = __rest(_a, ["id"]);
                        productInsertBody.quantity = plain.quantity;
                        productInsertList.push(productInsertBody);
                        productCodeMap.set(plain.productCode, productInsertBody);
                    }
                });
                const productCreatedList = await this.productManager.insertManyAndReturnEntity(manager, productInsertList);
                const productCreatedMapProductCode = helpers_1.ESArray.arrayToKeyValue(productCreatedList, 'productCode');
                dataPlainInsertList.forEach((plain, index) => {
                    const productCreated = productCreatedMapProductCode[plain.productCode];
                    plain.productId = productCreated.id;
                    plain.batchUpsert.productId = productCreated.id;
                    plain.productUpsert.id = productCreated.id;
                });
                const batchCreatedList = await this.batchManager.insertManyAndReturnEntity(manager, dataPlainInsertList.map((i) => {
                    const _a = i.batchUpsert, { id } = _a, batchInsert = __rest(_a, ["id"]);
                    return batchInsert;
                }));
                dataPlainInsertList.forEach((item, index) => {
                    const batchId = batchCreatedList[index].id;
                    item.batchId = batchId;
                });
                const productCalcMap = {};
                productCreatedList.forEach((i) => {
                    if (!productCalcMap[i.id]) {
                        productCalcMap[i.id] = { productId: i.id, openQuantity: 0 };
                    }
                });
                dataPlainInsertList.forEach((plain) => {
                    const productCalc = productCalcMap[plain.productId];
                    const productMovementInsert = {
                        oid,
                        movementType: variable_1.MovementType.Excel,
                        contactId: userId,
                        voucherId: 0,
                        voucherProductId: 0,
                        warehouseId: 0,
                        productId: plain.productId,
                        batchId: plain.batchId,
                        createdAt: time,
                        isRefund: 0,
                        expectedPrice: plain.retailPrice,
                        actualPrice: plain.retailPrice,
                        quantity: plain.quantity,
                        costAmount: plain.costAmount,
                        openQuantityProduct: productCalc.openQuantity,
                        closeQuantityProduct: productCalc.openQuantity + plain.quantity,
                        openQuantityBatch: 0,
                        closeQuantityBatch: plain.quantity,
                        openCostAmountBatch: 0,
                        closeCostAmountBatch: plain.costAmount,
                    };
                    productMovementInsertList.push(productMovementInsert);
                    productCalc.openQuantity = productCalc.openQuantity + plain.quantity;
                });
            }
            if (dataPlainUpdateList.length) {
                const productUpdateMap = {};
                dataPlainUpdateList.forEach((plain) => {
                    const productId = plain.productId;
                    const productOrigin = productOriginMap[productId];
                    if (!productUpdateMap[productId]) {
                        productUpdateMap[productId] = Object.assign(Object.assign({}, plain.productUpsert), { openQuantity: productOrigin.quantity });
                    }
                });
                const dataPlainInsertBatch = dataPlainUpdateList.filter((i) => !i.batchId);
                const dataPlainUpdateBatch = dataPlainUpdateList.filter((i) => !!i.batchId);
                const batchCreatedList = await this.batchManager.insertManyAndReturnEntity(manager, dataPlainInsertBatch.map((i) => {
                    const _a = i.batchUpsert, { id } = _a, batchInsert = __rest(_a, ["id"]);
                    return batchInsert;
                }));
                dataPlainInsertBatch.forEach((plain, index) => {
                    const batchId = batchCreatedList[index].id;
                    plain.batchId = batchId;
                    plain.batchUpsert.id = batchId;
                });
                const batchModifiedList = await this.batchManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['id', 'productId'],
                    tempList: dataPlainUpdateBatch.map((plain) => ({
                        id: plain.batchId,
                        productId: plain.productId,
                        lotNumber: plain.lotNumber,
                        expiryDate: plain.expiryDate,
                        quantity: plain.quantity,
                        costPrice: plain.costPrice,
                        costAmount: plain.costAmount,
                    })),
                    update: {
                        lotNumber: true,
                        expiryDate: { cast: 'bigint' },
                        quantity: true,
                        costPrice: true,
                        costAmount: true,
                    },
                    options: { requireEqualLength: true },
                });
                const batchUpsertedMap = helpers_1.ESArray.arrayToKeyValue([...batchCreatedList, ...batchModifiedList], 'id');
                dataPlainUpdateList.forEach((plain) => {
                    const { batchId, productId } = plain;
                    const batchUpserted = batchUpsertedMap[batchId];
                    const batchOrigin = batchOriginMap[batchId];
                    const quantityChange = batchUpserted.quantity - ((batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.quantity) || 0);
                    const costAmountChange = batchUpserted.costAmount - ((batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.costAmount) || 0);
                    const productUpdated = productUpdateMap[productId];
                    const productMovementInsert = {
                        oid,
                        movementType: variable_1.MovementType.Excel,
                        contactId: userId,
                        voucherId: 0,
                        voucherProductId: 0,
                        warehouseId: 0,
                        productId,
                        batchId,
                        createdAt: time,
                        isRefund: 0,
                        expectedPrice: (batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.costPrice) || productOriginMap[productId].costPrice,
                        actualPrice: batchUpserted.costPrice,
                        quantity: quantityChange,
                        costAmount: costAmountChange,
                        openQuantityProduct: productUpdated.openQuantity,
                        closeQuantityProduct: productUpdated.openQuantity + quantityChange,
                        openQuantityBatch: (batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.quantity) || 0,
                        closeQuantityBatch: batchUpserted.quantity,
                        openCostAmountBatch: (batchOrigin === null || batchOrigin === void 0 ? void 0 : batchOrigin.costAmount) || 0,
                        closeCostAmountBatch: batchUpserted.costAmount,
                    };
                    productMovementInsertList.push(productMovementInsert);
                    productUpdated.openQuantity += quantityChange;
                });
                await this.productManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['id'],
                    tempList: Object.values(productUpdateMap).map((i) => (Object.assign(Object.assign({}, i), { quantity: i.openQuantity }))),
                    update: [
                        'brandName',
                        'productGroupId',
                        'costPrice',
                        'retailPrice',
                        'quantity',
                        'route',
                        'source',
                        'substance',
                    ],
                    options: { requireEqualLength: true },
                });
            }
            await this.productMovementManager.insertMany(manager, productMovementInsertList);
        });
    }
};
exports.ApiFileProductUploadExcel = ApiFileProductUploadExcel;
exports.ApiFileProductUploadExcel = ApiFileProductUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductGroupRepository !== "undefined" && repositories_1.ProductGroupRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchManager !== "undefined" && repositories_1.BatchManager) === "function" ? _d : Object, typeof (_e = typeof repositories_1.ProductMovementManager !== "undefined" && repositories_1.ProductMovementManager) === "function" ? _e : Object, typeof (_f = typeof api_product_group_service_1.ApiProductGroupService !== "undefined" && api_product_group_service_1.ApiProductGroupService) === "function" ? _f : Object])
], ApiFileProductUploadExcel);


/***/ }),
/* 293 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFilePurchaseOrderModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_product_download_excel_1 = __webpack_require__(290);
const api_file_purchase_order_controller_1 = __webpack_require__(294);
const api_file_purchase_order_upload_excel_1 = __webpack_require__(295);
let ApiFilePurchaseOrderModule = class ApiFilePurchaseOrderModule {
};
exports.ApiFilePurchaseOrderModule = ApiFilePurchaseOrderModule;
exports.ApiFilePurchaseOrderModule = ApiFilePurchaseOrderModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_purchase_order_controller_1.ApiFilePurchaseOrderController],
        providers: [api_file_purchase_order_upload_excel_1.ApiFilePurchaseOrderUploadExcel, api_file_product_download_excel_1.ApiFileProductDownloadExcel],
    })
], ApiFilePurchaseOrderModule);


/***/ }),
/* 294 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFilePurchaseOrderController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_product_download_excel_1 = __webpack_require__(290);
const api_file_purchase_order_upload_excel_1 = __webpack_require__(295);
let ApiFilePurchaseOrderController = class ApiFilePurchaseOrderController {
    constructor(apiFilePurchaseOrderUploadExcel, apiFileProductDownloadExcel) {
        this.apiFilePurchaseOrderUploadExcel = apiFilePurchaseOrderUploadExcel;
        this.apiFileProductDownloadExcel = apiFileProductDownloadExcel;
    }
    async downloadExcelFileExample({ user, organization }) {
        return await this.apiFileProductDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcelForGeneratePurchaseOrderItemList({ uid, oid }, file, body) {
        return await this.apiFilePurchaseOrderUploadExcel.uploadExcelForGeneratePurchaseOrderItemList({
            oid,
            userId: uid,
            file,
        });
    }
};
exports.ApiFilePurchaseOrderController = ApiFilePurchaseOrderController;
__decorate([
    (0, common_1.Get)('download-excel/file-example-purchase-order-item'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFilePurchaseOrderController.prototype, "downloadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel/generate-purchase-order-item-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PURCHASE_ORDER),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _e : Object, typeof (_f = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiFilePurchaseOrderController.prototype, "uploadExcelForGeneratePurchaseOrderItemList", null);
exports.ApiFilePurchaseOrderController = ApiFilePurchaseOrderController = __decorate([
    (0, swagger_1.ApiTags)('FilePurchaseOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_purchase_order_upload_excel_1.ApiFilePurchaseOrderUploadExcel !== "undefined" && api_file_purchase_order_upload_excel_1.ApiFilePurchaseOrderUploadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_product_download_excel_1.ApiFileProductDownloadExcel !== "undefined" && api_file_product_download_excel_1.ApiFileProductDownloadExcel) === "function" ? _b : Object])
], ApiFilePurchaseOrderController);


/***/ }),
/* 295 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFilePurchaseOrderUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const array_helper_1 = __webpack_require__(154);
const error_1 = __webpack_require__(14);
const product_entity_1 = __webpack_require__(57);
const repositories_1 = __webpack_require__(42);
const product_excel_rule_1 = __webpack_require__(291);
const excel_process_1 = __webpack_require__(271);
const dataPlainExample = {
    _num: 0,
    productCode: '',
    brandName: '',
    batchId: 0,
    lotNumber: '',
    expiryDate: 0,
    quantity: 0,
    unitBasicName: '',
    costPrice: 0,
    retailPrice: 0,
    costAmount: 0,
    substance: '',
    productGroupName: '',
    route: '',
    source: '',
};
let ApiFilePurchaseOrderUploadExcel = class ApiFilePurchaseOrderUploadExcel {
    constructor(dataSource, productRepository, productGroupRepository, batchRepository, productManager) {
        this.dataSource = dataSource;
        this.productRepository = productRepository;
        this.productGroupRepository = productGroupRepository;
        this.batchRepository = batchRepository;
        this.productManager = productManager;
    }
    async uploadExcelForGeneratePurchaseOrderItemList(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const productGroupAll = await this.productGroupRepository.findManyBy({ oid });
        const productGroupMapName = array_helper_1.ESArray.arrayToKeyValue(productGroupAll, 'name');
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: product_excel_rule_1.ProductExcelRules,
            validate: { maxSize: 1 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(product_excel_rule_1.ProductExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const dataPlainList = dataConvertList.map((item, index) => {
            if (!item.productCode) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã sản phẩm không được để trống`);
            }
            let productGroupId = 0;
            if (item.productGroupName) {
                console.log('=================', item.productGroupName);
                const productGroup = productGroupMapName[item.productGroupName];
                if (!productGroup) {
                    throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Hệ thống chưa có nhóm sản phẩm ${item.productGroupName}`);
                }
                productGroupId = productGroup.id;
            }
            const batchId = item.batchId || 0;
            const lotNumber = String(item.lotNumber || '');
            const expiryDate = item.expiryDate ? item.expiryDate.getTime() : null;
            const quantity = item.quantity;
            const costPrice = Math.round(item.costPrice);
            let costAmount;
            if (costAmount == null || costAmount === '') {
                costAmount = costPrice * quantity;
            }
            else {
                costAmount = Math.round(item.costAmount);
            }
            const retailPrice = Math.round(item.retailPrice || 0);
            const dataPlain = {
                _num: item._num || 0,
                productId: 0,
                productCode: item.productCode,
                brandName: item.brandName,
                batchId,
                lotNumber,
                expiryDate,
                quantity,
                unitBasicName: item.unitBasicName,
                costPrice,
                retailPrice,
                costAmount,
                substance: item.substance,
                productGroupName: item.productGroupName,
                productGroupId,
                route: item.route,
                source: item.source,
                productUpsert: {
                    oid,
                    id: 0,
                    productCode: item.productCode,
                    productType: product_entity_1.ProductType.Basic,
                    brandName: item.brandName,
                    costPrice,
                    retailPrice,
                    quantity: 0,
                    unit: JSON.stringify([{ name: item.unitBasicName, rate: 1, default: true }]),
                    warehouseIds: JSON.stringify([0]),
                    wholesalePrice: 0,
                    productGroupId,
                    substance: item.substance,
                    route: item.route,
                    source: item.source,
                    hintUsage: '',
                    image: '',
                    isActive: 1,
                    updatedAt: time,
                    splitBatchByWarehouse: product_entity_1.SplitBatchByWarehouse.Inherit,
                    splitBatchByDistributor: product_entity_1.SplitBatchByDistributor.Inherit,
                    splitBatchByExpiryDate: product_entity_1.SplitBatchByExpiryDate.Inherit,
                    splitBatchByCostPrice: product_entity_1.SplitBatchByCostPrice.Inherit,
                },
            };
            return dataPlain;
        });
        const { productCreatedList, productModifiedList } = await this.processDataPlainList({
            oid,
            userId,
            dataPlainList,
            time,
        });
        const purchaseOrderItemInsertList = dataPlainList.map((plain) => {
            const item = {
                oid,
                distributorId: 0,
                productId: plain.productId,
                batchId: plain.batchId || 0,
                warehouseId: 0,
                lotNumber: plain.lotNumber,
                expiryDate: plain.expiryDate,
                unitRate: 1,
                quantity: plain.quantity,
                costPrice: plain.costPrice,
                listPrice: plain.retailPrice,
                purchaseOrderId: 0,
            };
            return item;
        });
        return { data: { purchaseOrderItemInsertList, productCreatedList, productModifiedList } };
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const productCodeList = dataPlainList.map((i) => i.productCode);
        const productOriginList = await this.productRepository.findManyBy({
            oid,
            productCode: { IN: productCodeList },
        });
        const productOriginMapCode = array_helper_1.ESArray.arrayToKeyValue(productOriginList, 'productCode');
        dataPlainList.forEach((plain, index) => {
            const productOrigin = productOriginMapCode[plain.productCode];
            if (productOrigin) {
                const productId = productOrigin.id;
                plain.productId = productId;
                plain.productUpsert.id = productId;
            }
        });
        const batchOriginList = await this.batchRepository.findManyBy({
            oid,
            id: { IN: dataPlainList.map((i) => i.batchId).filter((i) => !!i) },
            isActive: 1,
        });
        const batchOriginMap = array_helper_1.ESArray.arrayToKeyValue(batchOriginList, 'id');
        dataPlainList
            .filter((plain) => !!plain.batchId)
            .forEach((plain, index) => {
            const rowIndex = index + 2;
            const batchId = plain.batchId;
            const productOrigin = productOriginMapCode[plain.productCode];
            const batchOrigin = batchOriginMap[batchId];
            if (!batchOrigin || !productOrigin) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${rowIndex}: Không có lô hàng nào phù hợp với ID = ${batchId}`
                    + ` và mã sản phẩm = ${plain.productCode}`);
            }
            if (batchOrigin.productId !== plain.productId) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${rowIndex}: ID lô = ${batchId} có mã sản phẩm không đúng, `
                    + `gợi ý mã sản phẩm phù hợp = ${(productOrigin === null || productOrigin === void 0 ? void 0 : productOrigin.productCode) || ''}`);
            }
        });
        const dataPlainInsertList = dataPlainList.filter((i) => !i.productId);
        const dataPlainUpdateList = dataPlainList.filter((i) => !!i.productId);
        let productCreatedList = [];
        let productModifiedList = [];
        if (dataPlainInsertList.length) {
            const productCodeMap = new Map();
            const productInsertList = [];
            dataPlainInsertList.forEach((plain) => {
                if (productCodeMap.has(plain.productCode)) {
                    productCodeMap.get(plain.productCode).productType = product_entity_1.ProductType.SplitBatch;
                }
                else {
                    const _a = plain.productUpsert, { id } = _a, productInsertBody = __rest(_a, ["id"]);
                    productInsertBody.quantity = 0;
                    productInsertList.push(productInsertBody);
                    productCodeMap.set(plain.productCode, productInsertBody);
                }
            });
            productCreatedList = await this.productRepository.insertManyAndReturnEntity(productInsertList);
            const productCreatedMapProductCode = array_helper_1.ESArray.arrayToKeyValue(productCreatedList, 'productCode');
            dataPlainInsertList.forEach((plain, index) => {
                const productCreated = productCreatedMapProductCode[plain.productCode];
                plain.productId = productCreated.id;
                plain.productUpsert.id = productCreated.id;
            });
        }
        if (dataPlainUpdateList.length) {
            const productIdMap = new Map();
            const productUpdateList = [];
            dataPlainInsertList.forEach((plain) => {
                if (productIdMap.has(plain.productCode)) {
                    productIdMap.get(plain.productCode).productType = product_entity_1.ProductType.SplitBatch;
                }
                else {
                    const _a = plain.productUpsert, { id } = _a, productUpdateBody = __rest(_a, ["id"]);
                    productUpdateList.push(productUpdateBody);
                    productIdMap.set(plain.productCode, productUpdateBody);
                }
            });
            productModifiedList = await this.productManager.bulkUpdate({
                manager: this.dataSource.manager,
                condition: { oid, id: { NOT: 0 } },
                compare: ['id'],
                tempList: productUpdateList,
                update: ['brandName', 'productGroupId', 'route', 'source', 'substance'],
                options: { requireEqualLength: true },
            });
        }
        return { dataPlainList, productCreatedList, productModifiedList };
    }
};
exports.ApiFilePurchaseOrderUploadExcel = ApiFilePurchaseOrderUploadExcel;
exports.ApiFilePurchaseOrderUploadExcel = ApiFilePurchaseOrderUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductGroupRepository !== "undefined" && repositories_1.ProductGroupRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.ProductManager !== "undefined" && repositories_1.ProductManager) === "function" ? _e : Object])
], ApiFilePurchaseOrderUploadExcel);


/***/ }),
/* 296 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_group_service_1 = __webpack_require__(297);
const api_file_radiology_controller_1 = __webpack_require__(298);
const api_file_radiology_download_excel_1 = __webpack_require__(299);
const api_file_radiology_upload_excel_1 = __webpack_require__(301);
let ApiFileRadiologyModule = class ApiFileRadiologyModule {
};
exports.ApiFileRadiologyModule = ApiFileRadiologyModule;
exports.ApiFileRadiologyModule = ApiFileRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_radiology_controller_1.ApiFileRadiologyController],
        providers: [api_file_radiology_download_excel_1.ApiFileRadiologyDownloadExcel, api_file_radiology_upload_excel_1.ApiFileRadiologyUploadExcel, api_radiology_group_service_1.ApiRadiologyGroupService],
    })
], ApiFileRadiologyModule);


/***/ }),
/* 297 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
let ApiRadiologyGroupService = class ApiRadiologyGroupService {
    constructor(radiologyGroupRepository, radiologyGroupManager) {
        this.radiologyGroupRepository = radiologyGroupRepository;
        this.radiologyGroupManager = radiologyGroupManager;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.radiologyGroupRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.radiologyGroupRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, id) {
        const radiologyGroup = await this.radiologyGroupRepository.findOneBy({ oid, id });
        if (!radiologyGroup)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { radiologyGroup } };
    }
    async createOne(oid, body) {
        const radiologyGroup = await this.radiologyGroupRepository.insertOneAndReturnEntity(Object.assign({ oid }, body));
        return { data: { radiologyGroup } };
    }
    async updateOne(oid, id, body) {
        const radiologyGroupList = await this.radiologyGroupRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { radiologyGroup: radiologyGroupList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.radiologyGroupRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceAll(oid, body) {
        const radiologyGroupInsertLit = body.radiologyGroupReplaceAll
            .filter((i) => !i.id)
            .map((i) => {
            const insertDto = {
                name: i.name,
                roomId: i.roomId,
                oid,
            };
            return insertDto;
        });
        const radiologyGroupUpdateLit = body.radiologyGroupReplaceAll
            .filter((i) => !!i.id)
            .map((i) => {
            const insertDto = {
                name: i.name,
                roomId: i.roomId,
                id: i.id,
            };
            return insertDto;
        });
        await this.radiologyGroupRepository.delete({
            oid,
            id: { NOT_IN: radiologyGroupUpdateLit.map((i) => i.id) },
        });
        if (radiologyGroupInsertLit.length) {
            await this.radiologyGroupRepository.insertMany(radiologyGroupInsertLit);
        }
        if (radiologyGroupUpdateLit.length) {
            await this.radiologyGroupManager.bulkUpdate({
                manager: this.radiologyGroupRepository.getManager(),
                condition: { oid },
                compare: ['id'],
                update: ['name', 'roomId'],
                tempList: radiologyGroupUpdateLit,
                options: { requireEqualLength: true },
            });
        }
        return { data: true };
    }
    async systemList() {
        const data = await this.radiologyGroupRepository.findMany({
            condition: { oid: 1 },
        });
        return { data };
    }
    async createByGroupName(oid, groupName) {
        const radiologyGroupAll = await this.radiologyGroupRepository.findManyBy({ oid });
        const groupNameList = radiologyGroupAll.map((i) => i.name);
        const groupNameClean = helpers_1.ESArray.uniqueArray(groupName).filter((i) => !!i);
        const groupNameNoExist = groupNameClean.filter((i) => {
            return !groupNameList.includes(i);
        });
        const lgCreateList = groupNameNoExist.map((i) => {
            const dto = {
                oid,
                name: i,
                roomId: 0,
            };
            return dto;
        });
        const lgInsertedList = await this.radiologyGroupRepository.insertManyAndReturnEntity(lgCreateList);
        return [...radiologyGroupAll, ...lgInsertedList];
    }
};
exports.ApiRadiologyGroupService = ApiRadiologyGroupService;
exports.ApiRadiologyGroupService = ApiRadiologyGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RadiologyGroupRepository !== "undefined" && repositories_1.RadiologyGroupRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RadiologyGroupManager !== "undefined" && repositories_1.RadiologyGroupManager) === "function" ? _b : Object])
], ApiRadiologyGroupService);


/***/ }),
/* 298 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const file_1 = __webpack_require__(262);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_file_radiology_download_excel_1 = __webpack_require__(299);
const api_file_radiology_upload_excel_1 = __webpack_require__(301);
let ApiFileRadiologyController = class ApiFileRadiologyController {
    constructor(apiFileRadiologyDownloadExcel, apiFileRadiologyUploadExcel) {
        this.apiFileRadiologyDownloadExcel = apiFileRadiologyDownloadExcel;
        this.apiFileRadiologyUploadExcel = apiFileRadiologyUploadExcel;
    }
    async downloadExcel({ oid, user, organization }) {
        return await this.apiFileRadiologyDownloadExcel.downloadExcel({ oid });
    }
    async uploadExcelFileExample({ user, organization }) {
        return await this.apiFileRadiologyDownloadExcel.downloadExcel({ oid: 1 });
    }
    async uploadExcel({ uid, oid }, file, body) {
        return await this.apiFileRadiologyUploadExcel.uploadExcel({ oid, userId: uid, file });
    }
};
exports.ApiFileRadiologyController = ApiFileRadiologyController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileRadiologyController.prototype, "downloadExcel", null);
__decorate([
    (0, common_1.Get)('download-excel/file-example'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiFileRadiologyController.prototype, "uploadExcelFileExample", null);
__decorate([
    (0, common_1.Post)('upload-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_RADIOLOGY),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFileInterceptor)('file', {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof file_1.FileUploadDto !== "undefined" && file_1.FileUploadDto) === "function" ? _f : Object, typeof (_g = typeof file_1.SingleFileUpload !== "undefined" && file_1.SingleFileUpload) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiFileRadiologyController.prototype, "uploadExcel", null);
exports.ApiFileRadiologyController = ApiFileRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('FileRadiology'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_radiology_download_excel_1.ApiFileRadiologyDownloadExcel !== "undefined" && api_file_radiology_download_excel_1.ApiFileRadiologyDownloadExcel) === "function" ? _a : Object, typeof (_b = typeof api_file_radiology_upload_excel_1.ApiFileRadiologyUploadExcel !== "undefined" && api_file_radiology_upload_excel_1.ApiFileRadiologyUploadExcel) === "function" ? _b : Object])
], ApiFileRadiologyController);


/***/ }),
/* 299 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileRadiologyDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
const radiology_excel_rule_1 = __webpack_require__(300);
let ApiFileRadiologyDownloadExcel = class ApiFileRadiologyDownloadExcel {
    constructor(radiologyRepository) {
        this.radiologyRepository = radiologyRepository;
    }
    async downloadExcel(options) {
        const { oid } = options;
        const radiologyList = await this.radiologyRepository.findMany({
            relation: { radiologyGroup: true },
            condition: { oid },
            sort: { radiologyCode: 'ASC' },
        });
        const workbook = this.getWorkbookRadiology(radiologyList);
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: 'MEA.VN-chan-doan-hinh-anh.xlsx',
            },
        };
    }
    getWorkbookRadiology(radiologyList) {
        const dataRow = {
            style: {
                _num: { alignment: { horizontal: 'center' } },
                radiologyCode: { alignment: { wrapText: true } },
                name: { alignment: { wrapText: true } },
                radiologyGroupName: { alignment: { wrapText: true } },
                costPrice: { alignment: { horizontal: 'right' } },
                price: { alignment: { horizontal: 'right' } },
            },
            data: [],
        };
        let indexNumber = 0;
        radiologyList.forEach((radiology, index) => {
            var _a;
            indexNumber++;
            const data = {
                _num: indexNumber,
                radiologyCode: radiology.radiologyCode || '',
                name: radiology.name || '',
                radiologyGroupName: ((_a = radiology.radiologyGroup) === null || _a === void 0 ? void 0 : _a.name) || '',
                costPrice: radiology.costPrice || 0,
                price: radiology.price || 0,
            };
            dataRow.data.push(data);
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'Sản phẩm' },
            headerSheet: (worksheet) => {
                const rowTitle = worksheet.addRow(Object.values(radiology_excel_rule_1.RadiologyExcelRules).map((i) => i.title));
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: Object.entries(radiology_excel_rule_1.RadiologyExcelRules).map(([key, rule]) => ({
                key,
                width: rule.width,
            })),
            rows: [dataRow],
        });
        return workbook;
    }
};
exports.ApiFileRadiologyDownloadExcel = ApiFileRadiologyDownloadExcel;
exports.ApiFileRadiologyDownloadExcel = ApiFileRadiologyDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _a : Object])
], ApiFileRadiologyDownloadExcel);


/***/ }),
/* 300 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyExcelRules = void 0;
exports.RadiologyExcelRules = {
    _num: {
        title: 'STT',
        width: 5,
        type: 'number',
        required: false,
    },
    radiologyCode: {
        title: 'Mã phiếu',
        width: 20,
        type: 'string_number',
        required: true,
    },
    name: {
        title: 'Tên phiếu',
        width: 50,
        type: 'string',
        required: true,
    },
    radiologyGroupName: {
        title: 'Nhóm',
        width: 30,
        type: 'string',
        required: false,
    },
    costPrice: {
        title: 'Giá vốn',
        width: 12,
        type: 'number',
        required: false,
    },
    price: {
        title: 'Giá',
        width: 12,
        type: 'number',
        required: true,
    },
};


/***/ }),
/* 301 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileRadiologyUploadExcel = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const repositories_1 = __webpack_require__(42);
const api_radiology_group_service_1 = __webpack_require__(297);
const excel_process_1 = __webpack_require__(271);
const radiology_excel_rule_1 = __webpack_require__(300);
const dataPlainExample = {
    _num: 0,
    radiologyCode: '',
    name: '',
    radiologyGroupName: '',
    price: 0,
    costPrice: 0,
};
let ApiFileRadiologyUploadExcel = class ApiFileRadiologyUploadExcel {
    constructor(dataSource, radiologyManager, radiologyGroupRepository, apiRadiologyGroupService) {
        this.dataSource = dataSource;
        this.radiologyManager = radiologyManager;
        this.radiologyGroupRepository = radiologyGroupRepository;
        this.apiRadiologyGroupService = apiRadiologyGroupService;
    }
    async uploadExcel(options) {
        const { oid, userId, file } = options;
        const time = Date.now();
        const excelDataGrid = await excel_process_1.ExcelProcess.getData({
            file,
            excelRules: radiology_excel_rule_1.RadiologyExcelRules,
            validate: { maxSize: 5 * 1024 * 1024 },
        });
        const dataConvertList = excelDataGrid.map((item) => {
            const dataConvert = {};
            Object.keys(radiology_excel_rule_1.RadiologyExcelRules).forEach((key, index) => {
                dataConvert[key] = item[index];
            });
            return dataConvert;
        });
        const groupNameList = dataConvertList.map((i) => i.radiologyGroupName || '');
        const radiologyGroupList = await this.apiRadiologyGroupService.createByGroupName(oid, groupNameList);
        const radiologyGroupMapName = helpers_1.ESArray.arrayToKeyValue(radiologyGroupList, 'name');
        const dataPlainList = dataConvertList.map((item, index) => {
            var _a;
            if (!item.radiologyCode) {
                throw new error_1.BusinessError(`Lỗi: Dòng ${index + 2}: Mã CĐHA không được để trống`);
            }
            let radiologyGroupId = 0;
            const radiologyGroupName = item.radiologyGroupName;
            if (radiologyGroupName) {
                radiologyGroupId = ((_a = radiologyGroupMapName[radiologyGroupName]) === null || _a === void 0 ? void 0 : _a.id) || 0;
            }
            const dataPlain = {
                _num: item._num || 0,
                radiologyCode: item.radiologyCode,
                name: item.name || '',
                radiologyGroupName: item.radiologyGroupName || '',
                radiologyGroupId,
                costPrice: item.costPrice || 0,
                price: item.price || 0,
            };
            return dataPlain;
        });
        await this.processDataPlainList({ oid, userId, dataPlainList, time });
    }
    async processDataPlainList(data) {
        const { oid, userId, dataPlainList, time } = data;
        const transaction = await this.dataSource.transaction('READ UNCOMMITTED', async (manager) => {
            const duplicatesBatchId = helpers_1.ESArray.checkDuplicate(dataPlainList, 'radiologyCode');
            duplicatesBatchId.forEach(({ value, indices }) => {
                const indicesString = indices.map((i) => i + 2);
                throw new error_1.BusinessError(`Có trùng lặp mã CĐHA = ${value} ở dòng ${indicesString.toString()}`);
            });
            const radiologyCodeList = dataPlainList.map((i) => i.radiologyCode);
            const radiologyOriginList = await this.radiologyManager.findManyBy(manager, {
                oid,
                radiologyCode: { IN: radiologyCodeList },
            });
            const radiologyOriginMapCode = helpers_1.ESArray.arrayToKeyValue(radiologyOriginList, 'radiologyCode');
            const dataPlainInsertList = dataPlainList.filter((i) => !radiologyOriginMapCode[i.radiologyCode]);
            const dataPlainUpdateList = dataPlainList.filter((i) => !!radiologyOriginMapCode[i.radiologyCode]);
            if (dataPlainInsertList.length) {
                const radiologyInsertList = dataPlainInsertList.map((plain) => {
                    const radiologyInsert = {
                        oid,
                        radiologyCode: plain.radiologyCode,
                        name: plain.name,
                        radiologyGroupId: plain.radiologyGroupId,
                        costPrice: plain.costPrice,
                        price: plain.price,
                        printHtmlId: 0,
                        requestNoteDefault: '',
                        descriptionDefault: '',
                        resultDefault: '',
                        customStyles: '',
                        customVariables: '',
                    };
                    return radiologyInsert;
                });
                await this.radiologyManager.insertManyAndReturnEntity(manager, radiologyInsertList);
            }
            if (dataPlainUpdateList.length) {
                await this.radiologyManager.bulkUpdate({
                    manager,
                    condition: { oid, id: { NOT: 0 } },
                    compare: ['radiologyCode'],
                    tempList: dataPlainUpdateList,
                    update: ['name', 'radiologyGroupId', 'price', 'costPrice'],
                    options: { requireEqualLength: true },
                });
            }
        });
    }
};
exports.ApiFileRadiologyUploadExcel = ApiFileRadiologyUploadExcel;
exports.ApiFileRadiologyUploadExcel = ApiFileRadiologyUploadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RadiologyManager !== "undefined" && repositories_1.RadiologyManager) === "function" ? _b : Object, typeof (_c = typeof repositories_1.RadiologyGroupRepository !== "undefined" && repositories_1.RadiologyGroupRepository) === "function" ? _c : Object, typeof (_d = typeof api_radiology_group_service_1.ApiRadiologyGroupService !== "undefined" && api_radiology_group_service_1.ApiRadiologyGroupService) === "function" ? _d : Object])
], ApiFileRadiologyUploadExcel);


/***/ }),
/* 302 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketModule = void 0;
const common_1 = __webpack_require__(3);
const api_file_ticket_controller_1 = __webpack_require__(303);
const api_file_ticket_download_excel_1 = __webpack_require__(331);
let ApiFileTicketModule = class ApiFileTicketModule {
};
exports.ApiFileTicketModule = ApiFileTicketModule;
exports.ApiFileTicketModule = ApiFileTicketModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_file_ticket_controller_1.ApiFileTicketController],
        providers: [api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel],
    })
], ApiFileTicketModule);


/***/ }),
/* 303 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const api_file_ticket_download_excel_1 = __webpack_require__(331);
let ApiFileTicketController = class ApiFileTicketController {
    constructor(apiFileTicketDownloadExcel) {
        this.apiFileTicketDownloadExcel = apiFileTicketDownloadExcel;
    }
    async downloadExcel({ user, organization }, query) {
        return await this.apiFileTicketDownloadExcel.downloadExcel({ organization, user, query });
    }
};
exports.ApiFileTicketController = ApiFileTicketController;
__decorate([
    (0, common_1.Get)('download-excel'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketGetManyQuery !== "undefined" && request_1.TicketGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiFileTicketController.prototype, "downloadExcel", null);
exports.ApiFileTicketController = ApiFileTicketController = __decorate([
    (0, swagger_1.ApiTags)('FileTicket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('file-ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel !== "undefined" && api_file_ticket_download_excel_1.ApiFileTicketDownloadExcel) === "function" ? _a : Object])
], ApiFileTicketController);


/***/ }),
/* 304 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(305), exports);
__exportStar(__webpack_require__(314), exports);
__exportStar(__webpack_require__(330), exports);


/***/ }),
/* 305 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketGetOneQuery = exports.TicketGetManyQuery = exports.TicketPaginationQuery = exports.TicketGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const ticket_options_request_1 = __webpack_require__(314);
class TicketGetQuery {
}
exports.TicketGetQuery = TicketGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_options_request_1.TicketRelationQuery !== "undefined" && ticket_options_request_1.TicketRelationQuery) === "function" ? _a : Object)
], TicketGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
            startedAt: { GT: 150000 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_options_request_1.TicketFilterQuery !== "undefined" && ticket_options_request_1.TicketFilterQuery) === "function" ? _b : Object)
], TicketGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_options_request_1.TicketSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_options_request_1.TicketSortQuery !== "undefined" && ticket_options_request_1.TicketSortQuery) === "function" ? _c : Object)
], TicketGetQuery.prototype, "sort", void 0);
class TicketPaginationQuery extends (0, swagger_1.IntersectionType)(TicketGetQuery, dto_1.PaginationQuery) {
}
exports.TicketPaginationQuery = TicketPaginationQuery;
class TicketGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketGetQuery, ['filter', 'relation', 'sort']), dto_1.LimitQuery) {
}
exports.TicketGetManyQuery = TicketGetManyQuery;
class TicketGetOneQuery extends (0, swagger_1.PickType)(TicketGetQuery, ['relation']) {
}
exports.TicketGetOneQuery = TicketGetOneQuery;


/***/ }),
/* 306 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(97), exports);
__exportStar(__webpack_require__(307), exports);
__exportStar(__webpack_require__(308), exports);
__exportStar(__webpack_require__(309), exports);
__exportStar(__webpack_require__(310), exports);
__exportStar(__webpack_require__(311), exports);
__exportStar(__webpack_require__(312), exports);
__exportStar(__webpack_require__(313), exports);
__exportStar(__webpack_require__(259), exports);


/***/ }),
/* 307 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionDate = exports.ConditionDate = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ConditionDate {
}
exports.ConditionDate = ConditionDate;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], ConditionDate.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], ConditionDate.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], ConditionDate.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], ConditionDate.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], ConditionDate.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object)
], ConditionDate.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_g = typeof Date !== "undefined" && Date) === "function" ? _g : Object)
], ConditionDate.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_h = typeof Date !== "undefined" && Date) === "function" ? _h : Object)
], ConditionDate.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_j = typeof Date !== "undefined" && Date) === "function" ? _j : Object)
], ConditionDate.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_k = typeof Date !== "undefined" && Date) === "function" ? _k : Object)
], ConditionDate.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_l = typeof Date !== "undefined" && Date) === "function" ? _l : Object)
], ConditionDate.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value ? new Date(value) : undefined)),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_m = typeof Date !== "undefined" && Date) === "function" ? _m : Object)
], ConditionDate.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionDate.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionDate.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => {
            if (v == null)
                return null;
            return new Date(v);
        });
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsDate)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionDate.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => {
            if (v == null)
                return null;
            return new Date(v);
        });
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsDate)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    __metadata("design:type", Array)
], ConditionDate.prototype, "BETWEEN", void 0);
const transformConditionDate = ({ value, key }) => {
    if (!value)
        return undefined;
    if (typeof value === 'string') {
        const validate = (0, class_validator_1.isDateString)(value);
        if (!validate)
            throw new Error(`${key} must be a DateString`);
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionDate, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionDate failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a DateString`);
    }
};
exports.transformConditionDate = transformConditionDate;


/***/ }),
/* 308 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionEnum = void 0;
exports.createConditionEnum = createConditionEnum;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
function createConditionEnum(enumObject) {
    var _a, _b, _c, _d;
    const EValue = (0, typescript_helper_1.valuesEnum)(enumObject);
    class ConditionEnum {
    }
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_a = typeof T !== "undefined" && T) === "function" ? _a : Object)
    ], ConditionEnum.prototype, "==", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_b = typeof T !== "undefined" && T) === "function" ? _b : Object)
    ], ConditionEnum.prototype, "EQUAL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_c = typeof T !== "undefined" && T) === "function" ? _c : Object)
    ], ConditionEnum.prototype, "!=", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_custom_1.IsEnumValue)(enumObject),
        __metadata("design:type", typeof (_d = typeof T !== "undefined" && T) === "function" ? _d : Object)
    ], ConditionEnum.prototype, "NOT", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsBoolean)(),
        __metadata("design:type", Boolean)
    ], ConditionEnum.prototype, "IS_NULL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsBoolean)(),
        __metadata("design:type", Boolean)
    ], ConditionEnum.prototype, "NOT_NULL", void 0);
    __decorate([
        (0, class_transformer_1.Expose)(),
        (0, class_validator_1.IsArray)(),
        (0, class_validator_1.ArrayMinSize)(1),
        (0, class_validator_custom_1.IsEnumValue)(enumObject, { each: true }),
        __metadata("design:type", Array)
    ], ConditionEnum.prototype, "IN", void 0);
    return ConditionEnum;
}
const transformConditionEnum = ({ value, key }, enumObject) => {
    if (value == null)
        return;
    if (typeof value === 'number' || typeof value === 'string') {
        const enumObjectValueList = (0, typescript_helper_1.valuesEnum)(enumObject);
        for (let i = 0; i < enumObjectValueList.length; i++) {
            const item = enumObjectValueList[i];
            if (item != value)
                continue;
            if (typeof item === 'number') {
                return Number(value);
            }
            if (typeof item === 'string') {
                return String(value);
            }
        }
        throw new Error(`${key} must be a enum ${(0, typescript_helper_1.stringEnum)(enumObject)}`);
    }
    else if (typeof value === 'object') {
        const ConditionEnum = createConditionEnum(enumObject);
        const instance = (0, class_transformer_1.plainToInstance)(ConditionEnum, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionEnum failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Enum or condition of Enum`);
    }
};
exports.transformConditionEnum = transformConditionEnum;


/***/ }),
/* 309 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionMongoId = exports.ConditionMongoId = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ConditionMongoId {
}
exports.ConditionMongoId = ConditionMongoId;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", Boolean)
], ConditionMongoId.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", Boolean)
], ConditionMongoId.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], ConditionMongoId.prototype, "LIKE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsMongoId)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionMongoId.prototype, "IN", void 0);
const transformConditionMongoId = ({ value, key }) => {
    if (!value)
        return undefined;
    if (typeof value === 'string') {
        const validate = (0, class_validator_1.isMongoId)(value);
        if (!validate)
            throw new Error(`${key} must be a mongoID`);
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionMongoId, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionMongoID failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a mongoID`);
    }
};
exports.transformConditionMongoId = transformConditionMongoId;


/***/ }),
/* 310 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionNumber = exports.ConditionNumber = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ConditionNumber {
}
exports.ConditionNumber = ConditionNumber;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionNumber.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionNumber.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionNumber.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ConditionNumber.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    __metadata("design:type", Array)
], ConditionNumber.prototype, "BETWEEN", void 0);
const transformConditionNumber = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'number') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionNumber, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionNumber failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Number or condition of Number`);
    }
};
exports.transformConditionNumber = transformConditionNumber;


/***/ }),
/* 311 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionString = exports.ConditionString = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ConditionString {
}
exports.ConditionString = ConditionString;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", Boolean)
], ConditionString.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", Boolean)
], ConditionString.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ConditionString.prototype, "LIKE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsString)({ each: true }),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionString.prototype, "IN", void 0);
const transformConditionString = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'string') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionString, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionString failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a String`);
    }
};
exports.transformConditionString = transformConditionString;


/***/ }),
/* 312 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.transformConditionTimestamp = exports.ConditionTimestamp = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ConditionTimestamp {
}
exports.ConditionTimestamp = ConditionTimestamp;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, ">", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "GT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, ">=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "GTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "<", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "LT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "<=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "LTE", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "==", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "EQUAL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "!=", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return new Date(value).getTime();
    }),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ConditionTimestamp.prototype, "NOT", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionTimestamp.prototype, "IS_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ConditionTimestamp.prototype, "NOT_NULL", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => new Date(v).getTime());
    }),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ConditionTimestamp.prototype, "IN", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return undefined;
        return value.map((v) => new Date(v).getTime());
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(2),
    (0, class_validator_1.ArrayMaxSize)(2),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ConditionTimestamp.prototype, "BETWEEN", void 0);
const transformConditionTimestamp = ({ value, key }) => {
    if (value == null)
        return;
    if (typeof value === 'number') {
        return value;
    }
    else if (typeof value === 'object') {
        const instance = (0, class_transformer_1.plainToInstance)(ConditionTimestamp, value, {
            exposeUnsetFields: false,
            excludeExtraneousValues: false,
        });
        const validate = (0, class_validator_1.validateSync)(instance, {
            whitelist: true,
            forbidNonWhitelisted: true,
            skipMissingProperties: true,
        });
        if (validate.length) {
            const validateMessage = JSON.stringify(validate.map((i) => i.constraints));
            throw new Error(`${key} ConditionTimestamp failed: ${validateMessage}`);
        }
        return instance;
    }
    else {
        throw new Error(`${key} must be a Number or condition of Number`);
    }
};
exports.transformConditionTimestamp = transformConditionTimestamp;


/***/ }),
/* 313 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.IdMongoParam = exports.IdParam = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class IdParam {
}
exports.IdParam = IdParam;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], IdParam.prototype, "id", void 0);
class IdMongoParam {
}
exports.IdMongoParam = IdMongoParam;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '63fdde9517a7317f0e8f959a' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsMongoId)(),
    __metadata("design:type", String)
], IdMongoParam.prototype, "id", void 0);


/***/ }),
/* 314 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSortQuery = exports.TicketFilterQuery = exports.TicketRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const request_1 = __webpack_require__(315);
const request_2 = __webpack_require__(318);
const request_3 = __webpack_require__(321);
const request_4 = __webpack_require__(324);
const request_5 = __webpack_require__(327);
class TicketRelationQuery {
}
exports.TicketRelationQuery = TicketRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketSurchargeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketExpenseList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_a = typeof request_4.TicketProductGetManyQuery !== "undefined" && request_4.TicketProductGetManyQuery) === "function" ? _a : Object)
], TicketRelationQuery.prototype, "ticketProductList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_b = typeof request_4.TicketProductGetManyQuery !== "undefined" && request_4.TicketProductGetManyQuery) === "function" ? _b : Object)
], TicketRelationQuery.prototype, "ticketProductConsumableList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_c = typeof request_4.TicketProductGetManyQuery !== "undefined" && request_4.TicketProductGetManyQuery) === "function" ? _c : Object)
], TicketRelationQuery.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketBatchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_d = typeof request_3.TicketProcedureGetManyQuery !== "undefined" && request_3.TicketProcedureGetManyQuery) === "function" ? _d : Object)
], TicketRelationQuery.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_e = typeof request_1.TicketLaboratoryGroupGetManyQuery !== "undefined" && request_1.TicketLaboratoryGroupGetManyQuery) === "function" ? _e : Object)
], TicketRelationQuery.prototype, "ticketLaboratoryGroupList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "ticketLaboratoryResultList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_f = typeof request_2.TicketLaboratoryGetManyQuery !== "undefined" && request_2.TicketLaboratoryGetManyQuery) === "function" ? _f : Object)
], TicketRelationQuery.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", typeof (_g = typeof request_5.TicketRadiologyGetManyQuery !== "undefined" && request_5.TicketRadiologyGetManyQuery) === "function" ? _g : Object)
], TicketRelationQuery.prototype, "ticketRadiologyList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "toAppointment", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "customerSource", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRelationQuery.prototype, "imageList", void 0);
const ConditionEnumTicketStatus = (0, dto_1.createConditionEnum)(ticket_entity_1.TicketStatus);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(variable_1.DeliveryStatus);
class TicketFilterQuery {
}
exports.TicketFilterQuery = TicketFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, ticket_entity_1.TicketStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.DeliveryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketFilterQuery.prototype, "deliveryStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketFilterQuery.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_o = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _o : Object)
], TicketFilterQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_p = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _p : Object)
], TicketFilterQuery.prototype, "startedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_q = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _q : Object)
], TicketFilterQuery.prototype, "updatedAt", void 0);
class TicketSortQuery extends dto_1.SortQuery {
}
exports.TicketSortQuery = TicketSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketSortQuery.prototype, "registeredAt", void 0);


/***/ }),
/* 315 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(316), exports);
__exportStar(__webpack_require__(317), exports);


/***/ }),
/* 316 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGroupResponseQuery = exports.TicketLaboratoryGroupSortQuery = exports.TicketLaboratoryGroupFilterQuery = exports.TicketLaboratoryGroupRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryGroupRelationQuery {
}
exports.TicketLaboratoryGroupRelationQuery = TicketLaboratoryGroupRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "ticketLaboratoryResultMap", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryGroupRelationQuery.prototype, "imageList", void 0);
const ConditionEnumTicketLaboratoryStatus = (0, dto_1.createConditionEnum)(variable_1.TicketLaboratoryStatus);
const ConditionEnumPaymentMoneyStatus = (0, dto_1.createConditionEnum)(variable_1.PaymentMoneyStatus);
class TicketLaboratoryGroupFilterQuery {
}
exports.TicketLaboratoryGroupFilterQuery = TicketLaboratoryGroupFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.TicketLaboratoryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketLaboratoryGroupFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.PaymentMoneyStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketLaboratoryGroupFilterQuery.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupFilterQuery.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _e : Object)
], TicketLaboratoryGroupFilterQuery.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], TicketLaboratoryGroupFilterQuery.prototype, "completedAt", void 0);
class TicketLaboratoryGroupSortQuery extends query_1.SortQuery {
}
exports.TicketLaboratoryGroupSortQuery = TicketLaboratoryGroupSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketLaboratoryGroupSortQuery.prototype, "createdAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketLaboratoryGroupSortQuery.prototype, "completedAt", void 0);
class TicketLaboratoryGroupResponseQuery {
}
exports.TicketLaboratoryGroupResponseQuery = TicketLaboratoryGroupResponseQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsObject)(),
    __metadata("design:type", Object)
], TicketLaboratoryGroupResponseQuery.prototype, "ticketLaboratoryGroup", void 0);


/***/ }),
/* 317 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGroupGetOneQuery = exports.TicketLaboratoryGroupGetManyQuery = exports.TicketLaboratoryGroupPaginationQuery = exports.TicketLaboratoryGroupPostQuery = exports.TicketLaboratoryGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_laboratory_group_options_request_1 = __webpack_require__(316);
class TicketLaboratoryGroupGetQuery {
}
exports.TicketLaboratoryGroupGetQuery = TicketLaboratoryGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_group_options_request_1.TicketLaboratoryGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_laboratory_group_options_request_1.TicketLaboratoryGroupRelationQuery !== "undefined" && ticket_laboratory_group_options_request_1.TicketLaboratoryGroupRelationQuery) === "function" ? _a : Object)
], TicketLaboratoryGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_group_options_request_1.TicketLaboratoryGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_laboratory_group_options_request_1.TicketLaboratoryGroupFilterQuery !== "undefined" && ticket_laboratory_group_options_request_1.TicketLaboratoryGroupFilterQuery) === "function" ? _b : Object)
], TicketLaboratoryGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_group_options_request_1.TicketLaboratoryGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_laboratory_group_options_request_1.TicketLaboratoryGroupSortQuery !== "undefined" && ticket_laboratory_group_options_request_1.TicketLaboratoryGroupSortQuery) === "function" ? _c : Object)
], TicketLaboratoryGroupGetQuery.prototype, "sort", void 0);
class TicketLaboratoryGroupPostQuery {
}
exports.TicketLaboratoryGroupPostQuery = TicketLaboratoryGroupPostQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_group_options_request_1.TicketLaboratoryGroupResponseQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof ticket_laboratory_group_options_request_1.TicketLaboratoryGroupResponseQuery !== "undefined" && ticket_laboratory_group_options_request_1.TicketLaboratoryGroupResponseQuery) === "function" ? _d : Object)
], TicketLaboratoryGroupPostQuery.prototype, "response", void 0);
class TicketLaboratoryGroupPaginationQuery extends (0, swagger_1.IntersectionType)(TicketLaboratoryGroupGetQuery, query_1.PaginationQuery) {
}
exports.TicketLaboratoryGroupPaginationQuery = TicketLaboratoryGroupPaginationQuery;
class TicketLaboratoryGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketLaboratoryGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketLaboratoryGroupGetManyQuery = TicketLaboratoryGroupGetManyQuery;
class TicketLaboratoryGroupGetOneQuery extends (0, swagger_1.PickType)(TicketLaboratoryGroupGetQuery, [
    'relation',
]) {
}
exports.TicketLaboratoryGroupGetOneQuery = TicketLaboratoryGroupGetOneQuery;


/***/ }),
/* 318 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(319), exports);
__exportStar(__webpack_require__(320), exports);


/***/ }),
/* 319 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratoryGetOneQuery = exports.TicketLaboratoryGetManyQuery = exports.TicketLaboratoryPaginationQuery = exports.TicketLaboratoryGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_laboratory_options_request_1 = __webpack_require__(320);
class TicketLaboratoryGetQuery {
}
exports.TicketLaboratoryGetQuery = TicketLaboratoryGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratoryRelationQuery) === "function" ? _a : Object)
], TicketLaboratoryGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratoryFilterQuery) === "function" ? _b : Object)
], TicketLaboratoryGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_laboratory_options_request_1.TicketLaboratorySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_laboratory_options_request_1.TicketLaboratorySortQuery !== "undefined" && ticket_laboratory_options_request_1.TicketLaboratorySortQuery) === "function" ? _c : Object)
], TicketLaboratoryGetQuery.prototype, "sort", void 0);
class TicketLaboratoryPaginationQuery extends (0, swagger_1.IntersectionType)(TicketLaboratoryGetQuery, query_1.PaginationQuery) {
}
exports.TicketLaboratoryPaginationQuery = TicketLaboratoryPaginationQuery;
class TicketLaboratoryGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketLaboratoryGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketLaboratoryGetManyQuery = TicketLaboratoryGetManyQuery;
class TicketLaboratoryGetOneQuery extends (0, swagger_1.PickType)(TicketLaboratoryGetQuery, ['relation']) {
}
exports.TicketLaboratoryGetOneQuery = TicketLaboratoryGetOneQuery;


/***/ }),
/* 320 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketLaboratorySortQuery = exports.TicketLaboratoryFilterQuery = exports.TicketLaboratoryRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryRelationQuery {
}
exports.TicketLaboratoryRelationQuery = TicketLaboratoryRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "laboratoryList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketLaboratoryRelationQuery.prototype, "ticket", void 0);
const ConditionEnumTicketLaboratoryStatus = (0, dto_1.createConditionEnum)(variable_1.TicketLaboratoryStatus);
class TicketLaboratoryFilterQuery {
}
exports.TicketLaboratoryFilterQuery = TicketLaboratoryFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.TicketLaboratoryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketLaboratoryFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "laboratoryId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _c : Object)
], TicketLaboratoryFilterQuery.prototype, "createdAt", void 0);
class TicketLaboratorySortQuery extends query_1.SortQuery {
}
exports.TicketLaboratorySortQuery = TicketLaboratorySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketLaboratorySortQuery.prototype, "createdAt", void 0);


/***/ }),
/* 321 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(322), exports);
__exportStar(__webpack_require__(323), exports);


/***/ }),
/* 322 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureGetOneQuery = exports.TicketProcedureGetManyQuery = exports.TicketProcedurePaginationQuery = exports.TicketProcedureGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_procedure_options_request_1 = __webpack_require__(323);
class TicketProcedureGetQuery {
}
exports.TicketProcedureGetQuery = TicketProcedureGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_procedure_options_request_1.TicketProcedureRelationQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureRelationQuery) === "function" ? _a : Object)
], TicketProcedureGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_procedure_options_request_1.TicketProcedureFilterQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureFilterQuery) === "function" ? _b : Object)
], TicketProcedureGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_procedure_options_request_1.TicketProcedureSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_procedure_options_request_1.TicketProcedureSortQuery !== "undefined" && ticket_procedure_options_request_1.TicketProcedureSortQuery) === "function" ? _c : Object)
], TicketProcedureGetQuery.prototype, "sort", void 0);
class TicketProcedurePaginationQuery extends (0, swagger_1.IntersectionType)(TicketProcedureGetQuery, query_1.PaginationQuery) {
}
exports.TicketProcedurePaginationQuery = TicketProcedurePaginationQuery;
class TicketProcedureGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketProcedureGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketProcedureGetManyQuery = TicketProcedureGetManyQuery;
class TicketProcedureGetOneQuery extends (0, swagger_1.PickType)(TicketProcedureGetQuery, ['relation']) {
}
exports.TicketProcedureGetOneQuery = TicketProcedureGetOneQuery;


/***/ }),
/* 323 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureSortQuery = exports.TicketProcedureFilterQuery = exports.TicketProcedureRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketProcedureRelationQuery {
}
exports.TicketProcedureRelationQuery = TicketProcedureRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Object)
], TicketProcedureRelationQuery.prototype, "ticketProcedureItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProcedureRelationQuery.prototype, "ticketUserList", void 0);
const ConditionEnumPaymentMoneyStatus = (0, dto_1.createConditionEnum)(variable_1.PaymentMoneyStatus);
const ConditionEnumTicketProcedureStatus = (0, dto_1.createConditionEnum)(variable_1.TicketProcedureStatus);
class TicketProcedureFilterQuery {
}
exports.TicketProcedureFilterQuery = TicketProcedureFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.PaymentMoneyStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProcedureFilterQuery.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.TicketProcedureStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProcedureFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "procedureId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProcedureFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], TicketProcedureFilterQuery.prototype, "createdAt", void 0);
class TicketProcedureSortQuery extends query_1.SortQuery {
}
exports.TicketProcedureSortQuery = TicketProcedureSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketProcedureSortQuery.prototype, "priority", void 0);


/***/ }),
/* 324 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(325), exports);
__exportStar(__webpack_require__(326), exports);


/***/ }),
/* 325 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductGetOneQuery = exports.TicketProductGetManyQuery = exports.TicketProductPaginationQuery = exports.TicketProductGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_product_options_request_1 = __webpack_require__(326);
class TicketProductGetQuery {
}
exports.TicketProductGetQuery = TicketProductGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_product_options_request_1.TicketProductRelationQuery !== "undefined" && ticket_product_options_request_1.TicketProductRelationQuery) === "function" ? _a : Object)
], TicketProductGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_product_options_request_1.TicketProductFilterQuery !== "undefined" && ticket_product_options_request_1.TicketProductFilterQuery) === "function" ? _b : Object)
], TicketProductGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_product_options_request_1.TicketProductSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_product_options_request_1.TicketProductSortQuery !== "undefined" && ticket_product_options_request_1.TicketProductSortQuery) === "function" ? _c : Object)
], TicketProductGetQuery.prototype, "sort", void 0);
class TicketProductPaginationQuery extends (0, swagger_1.IntersectionType)(TicketProductGetQuery, query_1.PaginationQuery) {
}
exports.TicketProductPaginationQuery = TicketProductPaginationQuery;
class TicketProductGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketProductGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketProductGetManyQuery = TicketProductGetManyQuery;
class TicketProductGetOneQuery extends (0, swagger_1.PickType)(TicketProductGetQuery, ['relation']) {
}
exports.TicketProductGetOneQuery = TicketProductGetOneQuery;


/***/ }),
/* 326 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProductSortQuery = exports.TicketProductFilterQuery = exports.TicketProductRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketProductRelationQuery {
}
exports.TicketProductRelationQuery = TicketProductRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketProductRelationQuery.prototype, "customer", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(variable_1.DeliveryStatus);
const ConditionEnumPaymentMoneyStatus = (0, dto_1.createConditionEnum)(variable_1.PaymentMoneyStatus);
class TicketProductFilterQuery {
}
exports.TicketProductFilterQuery = TicketProductFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.PaymentMoneyStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProductFilterQuery.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.DeliveryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketProductFilterQuery.prototype, "deliveryStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _e : Object)
], TicketProductFilterQuery.prototype, "createdAt", void 0);
class TicketProductSortQuery extends query_1.SortQuery {
}
exports.TicketProductSortQuery = TicketProductSortQuery;


/***/ }),
/* 327 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(328), exports);
__exportStar(__webpack_require__(329), exports);


/***/ }),
/* 328 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyResponseQuery = exports.TicketRadiologySortQuery = exports.TicketRadiologyFilterQuery = exports.TicketRadiologyRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
const ticket_radiology_entity_1 = __webpack_require__(72);
class TicketRadiologyRelationQuery {
}
exports.TicketRadiologyRelationQuery = TicketRadiologyRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRadiologyRelationQuery.prototype, "radiology", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "ticketUserList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketRadiologyRelationQuery.prototype, "imageList", void 0);
const ConditionEnumTicketRadiologyStatus = (0, dto_1.createConditionEnum)(ticket_radiology_entity_1.TicketRadiologyStatus);
const ConditionEnumPaymentMoneyStatus = (0, dto_1.createConditionEnum)(variable_1.PaymentMoneyStatus);
class TicketRadiologyFilterQuery {
}
exports.TicketRadiologyFilterQuery = TicketRadiologyFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, ticket_radiology_entity_1.TicketRadiologyStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRadiologyFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.PaymentMoneyStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketRadiologyFilterQuery.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "roomId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _e : Object)
], TicketRadiologyFilterQuery.prototype, "completedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], TicketRadiologyFilterQuery.prototype, "createdAt", void 0);
class TicketRadiologySortQuery extends query_1.SortQuery {
}
exports.TicketRadiologySortQuery = TicketRadiologySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketRadiologySortQuery.prototype, "completedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketRadiologySortQuery.prototype, "createdAt", void 0);
class TicketRadiologyResponseQuery {
}
exports.TicketRadiologyResponseQuery = TicketRadiologyResponseQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsObject)(),
    __metadata("design:type", Object)
], TicketRadiologyResponseQuery.prototype, "ticketRadiology", void 0);


/***/ }),
/* 329 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyGetOneQuery = exports.TicketRadiologyGetManyQuery = exports.TicketRadiologyPaginationQuery = exports.TicketRadiologyPostQuery = exports.TicketRadiologyGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_radiology_options_request_1 = __webpack_require__(328);
class TicketRadiologyGetQuery {
}
exports.TicketRadiologyGetQuery = TicketRadiologyGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologyRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_radiology_options_request_1.TicketRadiologyRelationQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologyRelationQuery) === "function" ? _a : Object)
], TicketRadiologyGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologyFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_radiology_options_request_1.TicketRadiologyFilterQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologyFilterQuery) === "function" ? _b : Object)
], TicketRadiologyGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_radiology_options_request_1.TicketRadiologySortQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologySortQuery) === "function" ? _c : Object)
], TicketRadiologyGetQuery.prototype, "sort", void 0);
class TicketRadiologyPostQuery {
}
exports.TicketRadiologyPostQuery = TicketRadiologyPostQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_radiology_options_request_1.TicketRadiologyResponseQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof ticket_radiology_options_request_1.TicketRadiologyResponseQuery !== "undefined" && ticket_radiology_options_request_1.TicketRadiologyResponseQuery) === "function" ? _d : Object)
], TicketRadiologyPostQuery.prototype, "response", void 0);
class TicketRadiologyPaginationQuery extends (0, swagger_1.IntersectionType)(TicketRadiologyGetQuery, query_1.PaginationQuery) {
}
exports.TicketRadiologyPaginationQuery = TicketRadiologyPaginationQuery;
class TicketRadiologyGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketRadiologyGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketRadiologyGetManyQuery = TicketRadiologyGetManyQuery;
class TicketRadiologyGetOneQuery extends (0, swagger_1.PickType)(TicketRadiologyGetQuery, ['relation']) {
}
exports.TicketRadiologyGetOneQuery = TicketRadiologyGetOneQuery;


/***/ }),
/* 330 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketParams {
}
exports.TicketParams = TicketParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketParams.prototype, "ticketId", void 0);


/***/ }),
/* 331 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiFileTicketDownloadExcel = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const time_helper_1 = __webpack_require__(149);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const excel_one_sheet_util_1 = __webpack_require__(267);
let ApiFileTicketDownloadExcel = class ApiFileTicketDownloadExcel {
    constructor(ticketRepository, roomRepository) {
        this.ticketRepository = ticketRepository;
        this.roomRepository = roomRepository;
    }
    async downloadExcel(options) {
        var _a, _b, _c, _d, _e, _f;
        const { user, organization, query } = options;
        const ticketList = await this.ticketRepository.findMany({
            relation: {
                customer: true,
            },
            condition: {
                oid: organization.id,
                status: (_a = query.filter) === null || _a === void 0 ? void 0 : _a.status,
                roomId: (_b = query.filter) === null || _b === void 0 ? void 0 : _b.roomId,
                customerId: (_c = query.filter) === null || _c === void 0 ? void 0 : _c.customerId,
                registeredAt: (_d = query.filter) === null || _d === void 0 ? void 0 : _d.registeredAt,
                startedAt: (_e = query.filter) === null || _e === void 0 ? void 0 : _e.startedAt,
                updatedAt: (_f = query.filter) === null || _f === void 0 ? void 0 : _f.updatedAt,
            },
            sort: { id: 'ASC' },
        });
        const roomList = await this.roomRepository.findManyBy({ oid: organization.id });
        const roomMap = helpers_1.ESArray.arrayToKeyValue(roomList, 'id');
        const workbook = this.getWorkbookProduct({
            ticketList,
            roomMap,
            meta: {
                orgName: organization.name,
                orgPhone: organization.phone,
                orgAddress: [organization.addressWard, organization.addressProvince]
                    .filter((i) => !!i)
                    .join(' - ')
                    .replace('Tỉnh', '')
                    .replace('Thành phố', '')
                    .replace('Phường ', '')
                    .replace('Xã ', ''),
                userFullName: user.fullName,
            },
        });
        const buffer = await workbook.xlsx.writeBuffer();
        return {
            data: {
                buffer,
                mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                filename: `MEA_DOANH_THU.xlsx`,
            },
        };
    }
    getWorkbookProduct(options) {
        const { ticketList, roomMap, meta } = options;
        const dataRows = [];
        ticketList.forEach((ticket, ticketIndex) => {
            var _a, _b, _c, _d, _e, _f;
            dataRows.push({
                style: {
                    num: { alignment: { horizontal: 'center' } },
                    id: { alignment: { horizontal: 'center' } },
                    roomId: { alignment: { wrapText: true } },
                    ticketCode: { alignment: { horizontal: 'center' } },
                    customerName: { alignment: { wrapText: true } },
                    status: { alignment: { wrapText: true } },
                    registeredAt: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy h:mm:ss' },
                    endedAt: { alignment: { horizontal: 'center' }, numFmt: 'dd/mm/yyyy h:mm:ss' },
                    itemsCostAmount: { numFmt: '###,##0', font: { bold: true } },
                    itemsDiscount: { numFmt: '###,##0' },
                    productMoney: { numFmt: '###,##0' },
                    procedureMoney: { numFmt: '###,##0' },
                    radiologyMoney: { numFmt: '###,##0' },
                    laboratoryMoney: { numFmt: '###,##0' },
                    itemsActualMoney: { numFmt: '###,##0' },
                    discountMoney: { numFmt: '###,##0' },
                    surcharge: { numFmt: '###,##0' },
                    expense: { numFmt: '###,##0' },
                    totalMoney: { numFmt: '###,##0', font: { bold: true } },
                    paid: { numFmt: '###,##0' },
                    debt: { numFmt: '###,##0' },
                    commissionMoney: { numFmt: '###,##0' },
                    profit: { numFmt: '###,##0', font: { bold: true } },
                },
                data: [
                    {
                        num: ticketIndex + 1,
                        id: ticket.id,
                        roomId: ((_a = roomMap[ticket.roomId]) === null || _a === void 0 ? void 0 : _a.name) || '',
                        ticketCode: ((_b = ticket.date) === null || _b === void 0 ? void 0 : _b.toString().padStart(2, '0'))
                            + ((_c = ticket.month) === null || _c === void 0 ? void 0 : _c.toString().padStart(2, '0'))
                            + ((_d = ticket.year) === null || _d === void 0 ? void 0 : _d.toString().slice(-2))
                            + '_'
                            + ((_e = ticket.dailyIndex) === null || _e === void 0 ? void 0 : _e.toString().padStart(2, '0')),
                        customerName: ((_f = ticket.customer) === null || _f === void 0 ? void 0 : _f.fullName) || '',
                        status: ticket_entity_1.TicketStatusText[ticket.status],
                        registeredAt: ticket.registeredAt
                            ? new Date(ticket.registeredAt + 7 * 60 * 60 * 1000)
                            : '',
                        endedAt: ticket.endedAt ? new Date(ticket.endedAt + 7 * 60 * 60 * 1000) : '',
                        itemsCostAmount: ticket.itemsCostAmount,
                        itemsDiscount: ticket.itemsDiscount,
                        productMoney: ticket.productMoney || 0,
                        procedureMoney: ticket.procedureMoney || 0,
                        radiologyMoney: ticket.radiologyMoney || 0,
                        laboratoryMoney: ticket.laboratoryMoney || 0,
                        itemsActualMoney: ticket.itemsActualMoney || 0,
                        discountMoney: ticket.discountMoney,
                        surcharge: ticket.surcharge || 0,
                        expense: ticket.expense || 0,
                        totalMoney: ticket.totalMoney,
                        paid: ticket.paid || 0,
                        debt: ticket.debt || 0,
                        commissionMoney: ticket.commissionMoney || 0,
                        profit: ticket.profit || 0,
                    },
                ],
            });
        });
        const workbook = (0, excel_one_sheet_util_1.excelOneSheetWorkbook)({
            layout: { sheetName: 'DOANH THU' },
            headerSheet: (worksheet) => {
                worksheet.addRow([meta.orgName]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgPhone]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow([meta.orgAddress]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                });
                worksheet.addRow(['BÁO CÁO DOANH THU']).eachCell((cell) => {
                    cell.font = {
                        size: 16,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(4, 1, 4, 15);
                worksheet
                    .addRow([`Thời gian: ${time_helper_1.ESTimer.timeToText(new Date(), 'hh:mm:ss DD/MM/YYYY', 7)}`])
                    .eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        italic: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center' };
                });
                worksheet.mergeCells(5, 1, 5, 15);
                worksheet.addRow([]);
                const rowTitle = worksheet.addRow([
                    'STT',
                    'ID',
                    'Phòng',
                    'Mã phiếu',
                    'Tên khách hàng',
                    'Trạng thái',
                    'Thời gian đăng ký',
                    'Thời gian kết thúc',
                    'Tổng vốn',
                    'Khuyến mãi thành phần',
                    'Tiền sản phẩm',
                    'Tiền dịch vụ',
                    'Tiền CĐHA',
                    'Tiền Xét nghiệm',
                    'Tổng tiền thành phần',
                    'Khuyến mãi cả đơn',
                    'Phụ thu',
                    'Chi phí',
                    'Tổng tiền',
                    'Đã thu',
                    'Còn nợ',
                    'Hoa hồng',
                    'Lợi nhuận',
                ]);
                rowTitle.height = 32;
                rowTitle.eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        name: 'Times New Roman',
                    };
                    cell.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'D8D8D8' },
                        bgColor: { argb: 'D8D8D8' },
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                });
            },
            columns: [
                { key: 'num', width: 5 },
                { key: 'id', width: 10 },
                { key: 'roomId', width: 15 },
                { key: 'ticketCode', width: 15 },
                { key: 'customerName', width: 30 },
                { key: 'status', width: 15 },
                { key: 'registeredAt', width: 20 },
                { key: 'endedAt', width: 20 },
                { key: 'itemsCostAmount', width: 10 },
                { key: 'itemsDiscount', width: 10 },
                { key: 'productMoney', width: 10 },
                { key: 'procedureMoney', width: 10 },
                { key: 'radiologyMoney', width: 10 },
                { key: 'laboratoryMoney', width: 10 },
                { key: 'itemsActualMoney', width: 10 },
                { key: 'discountMoney', width: 10 },
                { key: 'surcharge', width: 10 },
                { key: 'expense', width: 10 },
                { key: 'totalMoney', width: 10 },
                { key: 'paid', width: 10 },
                { key: 'debt', width: 10 },
                { key: 'commissionMoney', width: 10 },
                { key: 'profit', width: 10 },
            ],
            rows: dataRows,
            footerSheet: (worksheet) => {
                worksheet.addRow(['']);
                worksheet.addRow([`Người xuất báo cáo: ${meta.userFullName}`]).eachCell((cell) => {
                    cell.font = {
                        size: 12,
                        bold: true,
                        italic: true,
                        name: 'Times New Roman',
                    };
                });
            },
        });
        return workbook;
    }
};
exports.ApiFileTicketDownloadExcel = ApiFileTicketDownloadExcel;
exports.ApiFileTicketDownloadExcel = ApiFileTicketDownloadExcel = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RoomRepository !== "undefined" && repositories_1.RoomRepository) === "function" ? _b : Object])
], ApiFileTicketDownloadExcel);


/***/ }),
/* 332 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_data_module_1 = __webpack_require__(333);
const api_root_organization_module_1 = __webpack_require__(337);
const api_root_user_module_1 = __webpack_require__(347);
let ApiRootModule = class ApiRootModule {
};
exports.ApiRootModule = ApiRootModule;
exports.ApiRootModule = ApiRootModule = __decorate([
    (0, common_1.Module)({
        imports: [api_root_organization_module_1.ApiRootOrganizationModule, api_root_user_module_1.ApiRootUserModule, api_root_data_module_1.ApiRootDataModule],
        controllers: [],
        providers: [],
    })
], ApiRootModule);


/***/ }),
/* 333 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_data_controller_1 = __webpack_require__(334);
const api_root_data_service_1 = __webpack_require__(335);
let ApiRootDataModule = class ApiRootDataModule {
};
exports.ApiRootDataModule = ApiRootDataModule;
exports.ApiRootDataModule = ApiRootDataModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_data_controller_1.ApiRootDataController],
        providers: [api_root_data_service_1.ApiRootDataService],
    })
], ApiRootDataModule);


/***/ }),
/* 334 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const api_root_data_service_1 = __webpack_require__(335);
const root_migration_data_body_1 = __webpack_require__(336);
let ApiRootDataController = class ApiRootDataController {
    constructor(apiRootDataService) {
        this.apiRootDataService = apiRootDataService;
    }
    async migration(body) {
        return await this.apiRootDataService.startMigrationData(body);
    }
};
exports.ApiRootDataController = ApiRootDataController;
__decorate([
    (0, common_1.Post)('migration'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof root_migration_data_body_1.RootMigrationDataBody !== "undefined" && root_migration_data_body_1.RootMigrationDataBody) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiRootDataController.prototype, "migration", null);
exports.ApiRootDataController = ApiRootDataController = __decorate([
    (0, common_1.Controller)('root/data'),
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_data_service_1.ApiRootDataService !== "undefined" && api_root_data_service_1.ApiRootDataService) === "function" ? _a : Object])
], ApiRootDataController);


/***/ }),
/* 335 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ApiRootDataService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootDataService = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(18);
const ticket_attribute_repository_1 = __webpack_require__(136);
let ApiRootDataService = ApiRootDataService_1 = class ApiRootDataService {
    constructor(dataSource, ticketAttributeRepository) {
        this.dataSource = dataSource;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.logger = new common_1.Logger(ApiRootDataService_1.name);
    }
    async startMigrationData(body) {
        if (body.key !== '8aobvoyupp8')
            return;
        return { data: true };
    }
};
exports.ApiRootDataService = ApiRootDataService;
exports.ApiRootDataService = ApiRootDataService = ApiRootDataService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object, typeof (_b = typeof ticket_attribute_repository_1.TicketAttributeRepository !== "undefined" && ticket_attribute_repository_1.TicketAttributeRepository) === "function" ? _b : Object])
], ApiRootDataService);


/***/ }),
/* 336 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootMigrationDataBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RootMigrationDataBody {
}
exports.RootMigrationDataBody = RootMigrationDataBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(10),
    __metadata("design:type", String)
], RootMigrationDataBody.prototype, "key", void 0);


/***/ }),
/* 337 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_organization_controller_1 = __webpack_require__(338);
const api_root_organization_service_1 = __webpack_require__(339);
let ApiRootOrganizationModule = class ApiRootOrganizationModule {
};
exports.ApiRootOrganizationModule = ApiRootOrganizationModule;
exports.ApiRootOrganizationModule = ApiRootOrganizationModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_organization_controller_1.ApiRootOrganizationController],
        providers: [api_root_organization_service_1.ApiRootOrganizationService],
    })
], ApiRootOrganizationModule);


/***/ }),
/* 338 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const root_guard_1 = __webpack_require__(15);
const api_root_organization_service_1 = __webpack_require__(339);
const request_1 = __webpack_require__(342);
let ApiRootOrganizationController = class ApiRootOrganizationController {
    constructor(apiRootOrganizationService) {
        this.apiRootOrganizationService = apiRootOrganizationService;
    }
    pagination(query) {
        return this.apiRootOrganizationService.pagination(query);
    }
    async createOne(body) {
        return await this.apiRootOrganizationService.createOne(body);
    }
    async updateOne({ id }, body) {
        return await this.apiRootOrganizationService.updateOne(id, body);
    }
    async clearOne({ id }, body) {
        return await this.apiRootOrganizationService.clearOne(id, body);
    }
};
exports.ApiRootOrganizationController = ApiRootOrganizationController;
__decorate([
    (0, common_1.Get)('organization/pagination'),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.RootOrganizationPaginationQuery !== "undefined" && request_1.RootOrganizationPaginationQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiRootOrganizationController.prototype, "pagination", null);
__decorate([
    (0, common_1.Post)('organization/create'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof request_1.RootOrganizationCreateBody !== "undefined" && request_1.RootOrganizationCreateBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('organization/update/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _d : Object, typeof (_e = typeof request_1.RootOrganizationUpdateBody !== "undefined" && request_1.RootOrganizationUpdateBody) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Put)('organization/clear/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.RootOrganizationClearBody !== "undefined" && request_1.RootOrganizationClearBody) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiRootOrganizationController.prototype, "clearOne", null);
exports.ApiRootOrganizationController = ApiRootOrganizationController = __decorate([
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    (0, common_1.Controller)('root'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_organization_service_1.ApiRootOrganizationService !== "undefined" && api_root_organization_service_1.ApiRootOrganizationService) === "function" ? _a : Object])
], ApiRootOrganizationController);


/***/ }),
/* 339 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var ApiRootOrganizationService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootOrganizationService = void 0;
const common_1 = __webpack_require__(3);
const typeorm_1 = __webpack_require__(44);
const typeorm_2 = __webpack_require__(18);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const AllEntity = __webpack_require__(45);
const entities_1 = __webpack_require__(45);
const organization_repository_1 = __webpack_require__(111);
const socket_emit_service_1 = __webpack_require__(340);
let ApiRootOrganizationService = ApiRootOrganizationService_1 = class ApiRootOrganizationService {
    constructor(socketEmitService, cacheDataService, organizationRepository, manager) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.manager = manager;
        this.logger = new common_1.Logger(ApiRootOrganizationService_1.name);
    }
    async pagination(query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.organizationRepository.pagination({
            page,
            limit,
            relation,
            condition: {},
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async createOne(body) {
        const organization = await this.organizationRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { emailVerify: 0, logoImageId: 0 }));
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async updateOne(oid, body) {
        const organizationRoot = await this.organizationRepository.findOneById(oid);
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, Object.assign(Object.assign({}, body), { emailVerify: organizationRoot.email === body.email ? organizationRoot.emailVerify : 0 }));
        if (!organization) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async clearOne(oid, body) {
        const { tableNameDeleteList, tableNameClearList } = body;
        if (tableNameClearList.includes(entities_1.Customer.name)) {
            await this.manager.update(entities_1.Customer, { oid }, { debt: 0 });
        }
        if (tableNameClearList.includes(entities_1.Distributor.name)) {
            await this.manager.update(entities_1.Distributor, { oid }, { debt: 0 });
        }
        if (tableNameClearList.includes(entities_1.Image.name)) {
            await this.manager.update(entities_1.Image, { oid }, { waitDelete: 1 });
        }
        if (tableNameClearList.includes(entities_1.Product.name)) {
            await this.manager.update(entities_1.Product, { oid }, { quantity: 0 });
        }
        for (let index = 0; index < body.tableNameDeleteList.length; index++) {
            const tableName = tableNameDeleteList[index];
            if (AllEntity[tableName]) {
                if (tableName === AllEntity.Organization.name) {
                    await this.manager.delete(AllEntity[tableName], { id: oid });
                }
                else {
                    await this.manager.delete(AllEntity[tableName], { oid });
                }
            }
        }
        if (!tableNameDeleteList.includes(entities_1.Organization.name)) {
            await this.organizationRepository.updateDataVersion(oid);
        }
        this.cacheDataService.clearOrganization(oid);
        return { data: { oid } };
    }
};
exports.ApiRootOrganizationService = ApiRootOrganizationService;
exports.ApiRootOrganizationService = ApiRootOrganizationService = ApiRootOrganizationService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(3, (0, typeorm_1.InjectEntityManager)()),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.EntityManager !== "undefined" && typeorm_2.EntityManager) === "function" ? _d : Object])
], ApiRootOrganizationService);


/***/ }),
/* 340 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketEmitService = void 0;
const common_1 = __webpack_require__(3);
const socket_variable_1 = __webpack_require__(341);
let SocketEmitService = class SocketEmitService {
    constructor() {
        this.connections = null;
        this.io = null;
    }
    demo(oid) {
        if (!this.io)
            return;
        const dataDemo = new Date().toISOString();
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SERVER_EMIT_DEMO, { dataDemo });
    }
    organizationUpdate(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_ORGANIZATION_UPDATE);
    }
    settingReload(oid) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_SETTING_RELOAD);
    }
    customerUpsert(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_CUSTOMER_UPSERT, data);
    }
    distributorUpsert(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_DISTRIBUTOR_UPSERT, data);
    }
    batchListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_BATCH_LIST_CHANGE, data);
    }
    productListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_PRODUCT_LIST_CHANGE, data);
    }
    procedureListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_PROCEDURE_LIST_CHANGE, data);
    }
    laboratoryListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_LABORATORY_LIST_CHANGE, data);
    }
    radiologyListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_RADIOLOGY_LIST_CHANGE, data);
    }
    positionListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_POSITION_LIST_CHANGE, data);
    }
    discountListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_DISCOUNT_LIST_CHANGE, data);
    }
    socketPurchaseOrderListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_PURCHASE_ORDER_LIST_CHANGE, data);
    }
    socketTicketChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE, data);
    }
    socketTicketListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_LIST_CHANGE, data);
    }
    socketTicketAttributeListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_ATTRIBUTE, data);
    }
    socketTicketUserListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_USER, data);
    }
    socketTicketProcedureListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_PROCEDURE, data);
    }
    socketTicketRadiologyListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_RADIOLOGY, data);
    }
    socketTicketLaboratoryListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_LABORATORY, data);
    }
    socketTicketProductChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_PRODUCT, data);
    }
    socketTicketConsumableChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_CONSUMABLE, data);
    }
    socketTicketPrescriptionChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_PRESCRIPTION, data);
    }
    socketTicketBatchListChange(oid, data) {
        if (!this.io)
            return;
        this.io.in(oid.toString()).emit(socket_variable_1.SOCKET_EVENT.SOCKET_TICKET_CHANGE_BATCH, data);
    }
};
exports.SocketEmitService = SocketEmitService;
exports.SocketEmitService = SocketEmitService = __decorate([
    (0, common_1.Injectable)()
], SocketEmitService);


/***/ }),
/* 341 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SOCKET_EVENT = void 0;
var SOCKET_EVENT;
(function (SOCKET_EVENT) {
    SOCKET_EVENT["SERVER_EMIT_DEMO"] = "SERVER_EMIT_DEMO";
    SOCKET_EVENT["SERVER_EMIT_TICKET_CREATE"] = "SERVER_EMIT_TICKET_CREATE";
    SOCKET_EVENT["CLIENT_EMIT_TICKET_CREATE"] = "CLIENT_EMIT_TICKET_CREATE";
    SOCKET_EVENT["SOCKET_ORGANIZATION_UPDATE"] = "SOCKET_ORGANIZATION_UPDATE";
    SOCKET_EVENT["SOCKET_SETTING_RELOAD"] = "SOCKET_SETTING_RELOAD";
    SOCKET_EVENT["SOCKET_DISTRIBUTOR_UPSERT"] = "SOCKET_DISTRIBUTOR_UPSERT";
    SOCKET_EVENT["SOCKET_CUSTOMER_UPSERT"] = "SOCKET_CUSTOMER_UPSERT";
    SOCKET_EVENT["SOCKET_PRODUCT_LIST_CHANGE"] = "SOCKET_PRODUCT_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_BATCH_LIST_CHANGE"] = "SOCKET_BATCH_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_PROCEDURE_LIST_CHANGE"] = "SOCKET_PROCEDURE_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_LABORATORY_LIST_CHANGE"] = "SOCKET_LABORATORY_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_RADIOLOGY_LIST_CHANGE"] = "SOCKET_RADIOLOGY_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_POSITION_LIST_CHANGE"] = "SOCKET_POSITION_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_DISCOUNT_LIST_CHANGE"] = "SOCKET_DISCOUNT_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_PURCHASE_ORDER_LIST_CHANGE"] = "SOCKET_PURCHASE_ORDER_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE"] = "SOCKET_TICKET_CHANGE";
    SOCKET_EVENT["SOCKET_TICKET_LIST_CHANGE"] = "SOCKET_TICKET_LIST_CHANGE";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_ATTRIBUTE"] = "SOCKET_TICKET_CHANGE_ATTRIBUTE";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_USER"] = "SOCKET_TICKET_CHANGE_USER";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_PROCEDURE"] = "SOCKET_TICKET_CHANGE_PROCEDURE";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_PRODUCT"] = "SOCKET_TICKET_CHANGE_PRODUCT";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_CONSUMABLE"] = "SOCKET_TICKET_CHANGE_CONSUMABLE";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_PRESCRIPTION"] = "SOCKET_TICKET_CHANGE_PRESCRIPTION";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_BATCH"] = "SOCKET_TICKET_CHANGE_BATCH";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_LABORATORY"] = "SOCKET_TICKET_CHANGE_LABORATORY";
    SOCKET_EVENT["SOCKET_TICKET_CHANGE_RADIOLOGY"] = "SOCKET_TICKET_CHANGE_RADIOLOGY";
})(SOCKET_EVENT || (exports.SOCKET_EVENT = SOCKET_EVENT = {}));


/***/ }),
/* 342 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(343), exports);
__exportStar(__webpack_require__(344), exports);
__exportStar(__webpack_require__(345), exports);
__exportStar(__webpack_require__(346), exports);


/***/ }),
/* 343 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationClearBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RootOrganizationClearBody {
}
exports.RootOrganizationClearBody = RootOrganizationClearBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RootOrganizationClearBody.prototype, "tableNameDeleteList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RootOrganizationClearBody.prototype, "tableNameClearList", void 0);


/***/ }),
/* 344 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationGetOneQuery = exports.RootOrganizationGetManyQuery = exports.RootOrganizationPaginationQuery = exports.RootOrganizationGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const root_organization_options_request_1 = __webpack_require__(345);
class RootOrganizationGetQuery {
}
exports.RootOrganizationGetQuery = RootOrganizationGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            userList: true,
            logoImage: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof root_organization_options_request_1.RootOrganizationRelationQuery !== "undefined" && root_organization_options_request_1.RootOrganizationRelationQuery) === "function" ? _a : Object)
], RootOrganizationGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof root_organization_options_request_1.RootOrganizationFilterQuery !== "undefined" && root_organization_options_request_1.RootOrganizationFilterQuery) === "function" ? _b : Object)
], RootOrganizationGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_organization_options_request_1.RootOrganizationSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof root_organization_options_request_1.RootOrganizationSortQuery !== "undefined" && root_organization_options_request_1.RootOrganizationSortQuery) === "function" ? _c : Object)
], RootOrganizationGetQuery.prototype, "sort", void 0);
class RootOrganizationPaginationQuery extends (0, swagger_1.IntersectionType)(RootOrganizationGetQuery, dto_1.PaginationQuery) {
}
exports.RootOrganizationPaginationQuery = RootOrganizationPaginationQuery;
class RootOrganizationGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RootOrganizationGetQuery, ['filter', 'relation', 'sort']), dto_1.LimitQuery) {
}
exports.RootOrganizationGetManyQuery = RootOrganizationGetManyQuery;
class RootOrganizationGetOneQuery extends (0, swagger_1.PickType)(RootOrganizationGetQuery, ['relation']) {
}
exports.RootOrganizationGetOneQuery = RootOrganizationGetOneQuery;


/***/ }),
/* 345 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationSortQuery = exports.RootOrganizationFilterQuery = exports.RootOrganizationRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
class RootOrganizationRelationQuery {
}
exports.RootOrganizationRelationQuery = RootOrganizationRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootOrganizationRelationQuery.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootOrganizationRelationQuery.prototype, "logoImage", void 0);
class RootOrganizationFilterQuery {
}
exports.RootOrganizationFilterQuery = RootOrganizationFilterQuery;
class RootOrganizationSortQuery extends dto_1.SortQuery {
}
exports.RootOrganizationSortQuery = RootOrganizationSortQuery;


/***/ }),
/* 346 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootOrganizationUpdateBody = exports.RootOrganizationCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const organization_entity_1 = __webpack_require__(16);
class RootOrganizationCreateBody {
}
exports.RootOrganizationCreateBody = RootOrganizationCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "organizationCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376899866' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'email', example: 'vm@gmail.com' }),
    (0, class_transformer_1.Expose)({ name: 'email' }),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (!value)
            return value;
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 0 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "emailVerify", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Phòng khám đa khoa Medical' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "facebook", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "level", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "dataVersion", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: JSON.stringify([1, 2, 3, 4]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (typeof i !== 'number')
                    err.push(`${i} is not number`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)({ message: `Validate permissionIds failed: Example: ${JSON.stringify([1, 2, 3, 4])}` }),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "permissionIds", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: organization_entity_1.OrganizationStatus.Active }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(organization_entity_1.OrganizationStatus),
    __metadata("design:type", typeof (_a = typeof organization_entity_1.OrganizationStatus !== "undefined" && organization_entity_1.OrganizationStatus) === "function" ? _a : Object)
], RootOrganizationCreateBody.prototype, "status", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Đã thanh toán ngày' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RootOrganizationCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RootOrganizationCreateBody.prototype, "expiryDate", void 0);
class RootOrganizationUpdateBody extends RootOrganizationCreateBody {
}
exports.RootOrganizationUpdateBody = RootOrganizationUpdateBody;


/***/ }),
/* 347 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserModule = void 0;
const common_1 = __webpack_require__(3);
const api_root_user_controller_1 = __webpack_require__(348);
const api_root_user_service_1 = __webpack_require__(349);
let ApiRootUserModule = class ApiRootUserModule {
};
exports.ApiRootUserModule = ApiRootUserModule;
exports.ApiRootUserModule = ApiRootUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_root_user_controller_1.ApiRootUserController],
        providers: [api_root_user_service_1.ApiRootUserService],
    })
], ApiRootUserModule);


/***/ }),
/* 348 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const root_guard_1 = __webpack_require__(15);
const user_entity_1 = __webpack_require__(20);
const api_root_user_service_1 = __webpack_require__(349);
const device_logout_query_1 = __webpack_require__(351);
const root_user_get_query_1 = __webpack_require__(352);
const root_user_upsert_body_1 = __webpack_require__(354);
let ApiRootUserController = class ApiRootUserController {
    constructor(apiRootUserService) {
        this.apiRootUserService = apiRootUserService;
    }
    pagination(query) {
        return this.apiRootUserService.pagination(query);
    }
    async create(body) {
        return await this.apiRootUserService.create(body);
    }
    async update({ id }, body) {
        return await this.apiRootUserService.update(id, body);
    }
    async userDeleteOne({ id }) {
        return await this.apiRootUserService.deleteOne(id);
    }
    deviceLogout({ id }, body) {
        return this.apiRootUserService.deviceLogout({
            oid: body.oid,
            userId: +id,
            refreshExp: body.refreshExp,
        });
    }
    logoutAll() {
        return this.apiRootUserService.logoutAll();
    }
};
exports.ApiRootUserController = ApiRootUserController;
__decorate([
    (0, common_1.Get)('pagination'),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof root_user_get_query_1.RootUserPaginationQuery !== "undefined" && root_user_get_query_1.RootUserPaginationQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "pagination", null);
__decorate([
    (0, common_1.Post)('create'),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof root_user_upsert_body_1.RootUserCreateBody !== "undefined" && root_user_upsert_body_1.RootUserCreateBody) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _d : Object, typeof (_e = typeof root_user_upsert_body_1.RootUserUpdateBody !== "undefined" && root_user_upsert_body_1.RootUserUpdateBody) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiRootUserController.prototype, "userDeleteOne", null);
__decorate([
    (0, common_1.Post)('device-logout/:id'),
    __param(0, (0, common_1.Param)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof device_logout_query_1.DeviceLogoutBody !== "undefined" && device_logout_query_1.DeviceLogoutBody) === "function" ? _h : Object]),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "deviceLogout", null);
__decorate([
    (0, common_1.Post)('logout-all'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiRootUserController.prototype, "logoutAll", null);
exports.ApiRootUserController = ApiRootUserController = __decorate([
    (0, common_1.Controller)('root/user'),
    (0, swagger_1.ApiTags)('Root'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, root_guard_1.IsRoot)(),
    (0, common_1.SerializeOptions)({ groups: [user_entity_1.UserGroup.ROOT] }),
    __metadata("design:paramtypes", [typeof (_a = typeof api_root_user_service_1.ApiRootUserService !== "undefined" && api_root_user_service_1.ApiRootUserService) === "function" ? _a : Object])
], ApiRootUserController);


/***/ }),
/* 349 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var ApiRootUserService_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRootUserService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(239);
const cache_data_service_1 = __webpack_require__(40);
const cache_token_service_1 = __webpack_require__(155);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(187);
const device_1 = __webpack_require__(350);
const repositories_1 = __webpack_require__(42);
const user_repository_1 = __webpack_require__(152);
const socket_emit_service_1 = __webpack_require__(340);
let ApiRootUserService = ApiRootUserService_1 = class ApiRootUserService {
    constructor(socketEmitService, cacheTokenService, cacheDataService, userRepository, organizationRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
        this.userRepository = userRepository;
        this.organizationRepository = organizationRepository;
        this.logger = new common_1.Logger(ApiRootUserService_1.name);
    }
    async pagination(query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.userRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid: filter === null || filter === void 0 ? void 0 : filter.oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        for (let i = 0; i < data.length; i++) {
            const user = data[i];
            const tokenList = await this.cacheTokenService.getTokenList({
                oid: user.oid,
                uid: user.id,
            });
            user.devices = tokenList.map((j) => {
                const device = new device_1.default();
                device.refreshExp = j.refreshExp;
                device.ip = j.ip;
                device.os = j.os;
                device.browser = j.browser;
                device.mobile = j.mobile;
                device.online =
                    (this.socketEmitService.connections[user.id] || []).some((k) => {
                        return k.refreshExp === j.refreshExp;
                    }) || j.online;
                return device;
            });
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async create(body) {
        const { oid, username, password } = body, other = __rest(body, ["oid", "username", "password"]);
        const existUser = await this.userRepository.findOneBy({
            oid,
            username,
        });
        if (existUser)
            throw new exception_filter_1.BusinessException('error.Register.ExistUsername');
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, username);
        const user = await this.userRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, other), { oid,
            username,
            secret,
            hashPassword, imageIds: JSON.stringify([]) }));
        this.cacheDataService.clearUserAndRoleAndRoom(user.oid);
        return { data: { user } };
    }
    async update(userId, body) {
        const { username, password } = body, other = __rest(body, ["username", "password"]);
        const userOld = await this.userRepository.findOneBy({ id: userId });
        if (!userOld)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, username);
        const [user] = await this.userRepository.updateAndReturnEntity({ id: userId }, Object.assign(Object.assign({}, other), { hashPassword,
            secret,
            username }));
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.clearUserAndRoleAndRoom(user.oid);
        return { data: { user } };
    }
    async deleteOne(id) {
        const [user] = await this.userRepository.updateAndReturnEntity({ id }, { deletedAt: Date.now() });
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        this.cacheDataService.clearUserAndRoleAndRoom(user.oid);
        return { data: { userId: user.id } };
    }
    async deviceLogout(options) {
        const { oid, userId, refreshExp } = options;
        const result = this.cacheTokenService.removeRefreshToken({
            oid,
            uid: userId,
            refreshExp,
        });
        return { data: result };
    }
    async logoutAll() {
        const result = this.cacheTokenService.removeAllExcludeRoot();
        await this.organizationRepository.updateDataVersion(undefined);
        this.cacheDataService.clearOrganization(undefined);
        return { data: result };
    }
};
exports.ApiRootUserService = ApiRootUserService;
exports.ApiRootUserService = ApiRootUserService = ApiRootUserService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object, typeof (_d = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.OrganizationRepository !== "undefined" && repositories_1.OrganizationRepository) === "function" ? _e : Object])
], ApiRootUserService);


/***/ }),
/* 350 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const class_transformer_1 = __webpack_require__(17);
class Device {
}
exports["default"] = Device;
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "refreshExp", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "ip", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "os", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", String)
], Device.prototype, "browser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Number)
], Device.prototype, "mobile", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    __metadata("design:type", Object)
], Device.prototype, "online", void 0);


/***/ }),
/* 351 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DeviceLogoutBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class DeviceLogoutBody {
}
exports.DeviceLogoutBody = DeviceLogoutBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "refreshExp", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "oid", void 0);


/***/ }),
/* 352 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserGetOneQuery = exports.RootUserGetManyQuery = exports.RootUserPaginationQuery = exports.RootUserGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const root_user_options_request_1 = __webpack_require__(353);
class RootUserGetQuery {
}
exports.RootUserGetQuery = RootUserGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            organization: true,
            userRoleList: { role: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof root_user_options_request_1.RootUserRelationQuery !== "undefined" && root_user_options_request_1.RootUserRelationQuery) === "function" ? _a : Object)
], RootUserGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof root_user_options_request_1.RootUserFilterQuery !== "undefined" && root_user_options_request_1.RootUserFilterQuery) === "function" ? _b : Object)
], RootUserGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(root_user_options_request_1.RootUserSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof root_user_options_request_1.RootUserSortQuery !== "undefined" && root_user_options_request_1.RootUserSortQuery) === "function" ? _c : Object)
], RootUserGetQuery.prototype, "sort", void 0);
class RootUserPaginationQuery extends (0, swagger_1.IntersectionType)(RootUserGetQuery, query_1.PaginationQuery) {
}
exports.RootUserPaginationQuery = RootUserPaginationQuery;
class RootUserGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RootUserGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RootUserGetManyQuery = RootUserGetManyQuery;
class RootUserGetOneQuery extends (0, swagger_1.PickType)(RootUserGetQuery, ['relation']) {
}
exports.RootUserGetOneQuery = RootUserGetOneQuery;


/***/ }),
/* 353 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserSortQuery = exports.RootUserFilterQuery = exports.RootUserRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class RootUserRelationQuery {
}
exports.RootUserRelationQuery = RootUserRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RootUserRelationQuery.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], RootUserRelationQuery.prototype, "userRoleList", void 0);
class RootUserFilterQuery {
}
exports.RootUserFilterQuery = RootUserFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "oid", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], RootUserFilterQuery.prototype, "updatedAt", void 0);
class RootUserSortQuery extends query_1.SortQuery {
}
exports.RootUserSortQuery = RootUserSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RootUserSortQuery.prototype, "oid", void 0);


/***/ }),
/* 354 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RootUserUpdateBody = exports.RootUserCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class RootUserCreateBody {
}
exports.RootUserCreateBody = RootUserCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 40 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "oid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "password", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RootUserCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], RootUserCreateBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "isAdmin", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RootUserCreateBody.prototype, "isActive", void 0);
class RootUserUpdateBody extends (0, swagger_1.OmitType)(RootUserCreateBody, ['oid']) {
}
exports.RootUserUpdateBody = RootUserUpdateBody;


/***/ }),
/* 355 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiModule = void 0;
const common_1 = __webpack_require__(3);
const api_address_module_1 = __webpack_require__(356);
const api_appointment_module_1 = __webpack_require__(361);
const api_batch_module_1 = __webpack_require__(373);
const api_customer_source_module_1 = __webpack_require__(381);
const api_customer_module_1 = __webpack_require__(388);
const api_discount_module_1 = __webpack_require__(391);
const api_distributor_module_1 = __webpack_require__(398);
const api_expense_module_1 = __webpack_require__(405);
const api_icd_module_1 = __webpack_require__(412);
const api_laboratory_group_module_1 = __webpack_require__(417);
const api_laboratory_sample_module_1 = __webpack_require__(423);
const api_laboratory_module_1 = __webpack_require__(430);
const api_organization_module_1 = __webpack_require__(442);
const api_payment_method_module_1 = __webpack_require__(452);
const api_payment_module_1 = __webpack_require__(459);
const api_permission_module_1 = __webpack_require__(468);
const api_position_module_1 = __webpack_require__(491);
const api_prescription_sample_module_1 = __webpack_require__(494);
const api_print_html_setting_module_1 = __webpack_require__(501);
const api_print_html_module_1 = __webpack_require__(508);
const api_procedure_group_module_1 = __webpack_require__(515);
const api_procedure_module_1 = __webpack_require__(521);
const api_product_group_module_1 = __webpack_require__(528);
const api_product_movement_module_1 = __webpack_require__(534);
const api_product_module_1 = __webpack_require__(540);
const api_purchase_order_item_module_1 = __webpack_require__(548);
const api_radiology_group_module_1 = __webpack_require__(555);
const api_radiology_sample_module_1 = __webpack_require__(561);
const api_radiology_module_1 = __webpack_require__(568);
const api_role_module_1 = __webpack_require__(577);
const api_room_module_1 = __webpack_require__(584);
const api_setting_module_1 = __webpack_require__(592);
const api_stock_check_module_1 = __webpack_require__(597);
const api_surcharge_module_1 = __webpack_require__(604);
const api_ticket_batch_module_1 = __webpack_require__(611);
const api_ticket_laboratory_group_module_1 = __webpack_require__(617);
const api_ticket_laboratory_module_1 = __webpack_require__(620);
const api_ticket_procedure_module_1 = __webpack_require__(623);
const api_ticket_product_module_1 = __webpack_require__(626);
const api_ticket_radiology_module_1 = __webpack_require__(629);
const api_user_role_module_1 = __webpack_require__(632);
const api_user_room_module_1 = __webpack_require__(638);
const api_user_module_1 = __webpack_require__(644);
const api_warehouse_module_1 = __webpack_require__(653);
const api_purchase_order_module_1 = __webpack_require__(660);
const statistic_module_1 = __webpack_require__(685);
const ticket_module_1 = __webpack_require__(722);
let ApiModule = class ApiModule {
};
exports.ApiModule = ApiModule;
exports.ApiModule = ApiModule = __decorate([
    (0, common_1.Module)({
        imports: [
            api_address_module_1.ApiAddressModule,
            api_icd_module_1.ApiICDModule,
            api_appointment_module_1.ApiAppointmentModule,
            api_batch_module_1.ApiBatchModule,
            api_customer_module_1.ApiCustomerModule,
            api_customer_source_module_1.ApiCustomerSourceModule,
            api_distributor_module_1.ApiDistributorModule,
            api_permission_module_1.ApiPermissionModule,
            api_procedure_module_1.ApiProcedureModule,
            api_product_module_1.ApiProductModule,
            api_product_movement_module_1.ApiProductMovementModule,
            api_purchase_order_module_1.ApiPurchaseOrderModule,
            api_purchase_order_item_module_1.ApiPurchaseOrderItemModule,
            statistic_module_1.StatisticModule,
            api_setting_module_1.ApiSettingModule,
            api_organization_module_1.ApiOrganizationModule,
            api_role_module_1.ApiRoleModule,
            api_position_module_1.ApiPositionModule,
            api_user_module_1.ApiUserModule,
            api_user_role_module_1.ApiUserRoleModule,
            api_user_room_module_1.ApiUserRoomModule,
            api_laboratory_module_1.ApiLaboratoryModule,
            api_laboratory_group_module_1.ApiLaboratoryGroupModule,
            api_laboratory_sample_module_1.ApiLaboratorySampleModule,
            api_radiology_module_1.ApiRadiologyModule,
            api_radiology_group_module_1.ApiRadiologyGroupModule,
            api_prescription_sample_module_1.ApiPrescriptionSampleModule,
            api_warehouse_module_1.ApiWarehouseModule,
            api_product_group_module_1.ApiProductGroupModule,
            api_procedure_group_module_1.ApiProcedureGroupModule,
            api_print_html_module_1.ApiPrintHtmlModule,
            api_print_html_setting_module_1.ApiPrintHtmlSettingModule,
            api_ticket_procedure_module_1.ApiTicketProcedureModule,
            api_ticket_product_module_1.ApiTicketProductModule,
            api_ticket_batch_module_1.ApiTicketBatchModule,
            api_ticket_laboratory_module_1.ApiTicketLaboratoryModule,
            api_ticket_laboratory_group_module_1.ApiTicketLaboratoryGroupModule,
            api_ticket_radiology_module_1.ApiTicketRadiologyModule,
            api_stock_check_module_1.ApiStockCheckModule,
            api_payment_module_1.ApiPaymentModule,
            api_payment_method_module_1.ApiPaymentMethodModule,
            api_discount_module_1.ApiDiscountModule,
            api_room_module_1.ApiRoomModule,
            api_expense_module_1.ApiExpenseModule,
            api_surcharge_module_1.ApiSurchargeModule,
            api_radiology_sample_module_1.ApiRadiologySampleModule,
            ticket_module_1.TicketModule,
        ],
        controllers: [],
        providers: [],
    })
], ApiModule);


/***/ }),
/* 356 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAddressModule = void 0;
const common_1 = __webpack_require__(3);
const api_address_controller_1 = __webpack_require__(357);
const api_address_service_1 = __webpack_require__(358);
let ApiAddressModule = class ApiAddressModule {
};
exports.ApiAddressModule = ApiAddressModule;
exports.ApiAddressModule = ApiAddressModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_address_controller_1.ApiAddressController],
        providers: [api_address_service_1.ApiAddressService],
    })
], ApiAddressModule);


/***/ }),
/* 357 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAddressController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(157);
const api_address_service_1 = __webpack_require__(358);
const request_1 = __webpack_require__(359);
let ApiAddressController = class ApiAddressController {
    constructor(apiAddressService) {
        this.apiAddressService = apiAddressService;
    }
    getAll() {
        return this.apiAddressService.getAll();
    }
    list(body) {
        return this.apiAddressService.replaceAll(body);
    }
};
exports.ApiAddressController = ApiAddressController;
__decorate([
    (0, common_1.Get)('all'),
    (0, user_guard_1.UserPermission)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiAddressController.prototype, "getAll", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, root_guard_1.IsRoot)(),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.AddressReplaceAllBody !== "undefined" && request_1.AddressReplaceAllBody) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiAddressController.prototype, "list", null);
exports.ApiAddressController = ApiAddressController = __decorate([
    (0, swagger_1.ApiTags)('Address'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('address'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_address_service_1.ApiAddressService !== "undefined" && api_address_service_1.ApiAddressService) === "function" ? _a : Object])
], ApiAddressController);


/***/ }),
/* 358 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAddressService = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(45);
const repositories_1 = __webpack_require__(42);
let ApiAddressService = class ApiAddressService {
    constructor(addressRepository) {
        this.addressRepository = addressRepository;
    }
    async getAll() {
        const addressAll = await this.addressRepository.findManyBy({});
        return { data: { addressAll } };
    }
    async replaceAll(body) {
        await this.addressRepository.getManager().query(`TRUNCATE TABLE "${entities_1.Address.name}" RESTART IDENTITY CASCADE;`);
        await this.addressRepository.insertMany(body.addressAll);
        return { data: true };
    }
};
exports.ApiAddressService = ApiAddressService;
exports.ApiAddressService = ApiAddressService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.AddressRepository !== "undefined" && repositories_1.AddressRepository) === "function" ? _a : Object])
], ApiAddressService);


/***/ }),
/* 359 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(360), exports);


/***/ }),
/* 360 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AddressReplaceAllBody = exports.AddressCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class AddressCreateBody {
}
exports.AddressCreateBody = AddressCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AddressCreateBody.prototype, "province", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AddressCreateBody.prototype, "ward", void 0);
class AddressReplaceAllBody {
}
exports.AddressReplaceAllBody = AddressReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: AddressCreateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => AddressCreateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], AddressReplaceAllBody.prototype, "addressAll", void 0);


/***/ }),
/* 361 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentModule = void 0;
const common_1 = __webpack_require__(3);
const api_appointment_controller_1 = __webpack_require__(362);
const api_appointment_service_1 = __webpack_require__(363);
let ApiAppointmentModule = class ApiAppointmentModule {
};
exports.ApiAppointmentModule = ApiAppointmentModule;
exports.ApiAppointmentModule = ApiAppointmentModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_appointment_controller_1.ApiAppointmentController],
        providers: [api_appointment_service_1.ApiAppointmentService],
    })
], ApiAppointmentModule);


/***/ }),
/* 362 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_appointment_service_1 = __webpack_require__(363);
const request_1 = __webpack_require__(364);
let ApiAppointmentController = class ApiAppointmentController {
    constructor(apiAppointmentService) {
        this.apiAppointmentService = apiAppointmentService;
    }
    pagination({ oid }, query) {
        return this.apiAppointmentService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiAppointmentService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiAppointmentService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiAppointmentService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiAppointmentService.updateOne(oid, +id, body);
    }
    async deleteOne({ oid }, { id }) {
        return await this.apiAppointmentService.deleteOne(oid, id);
    }
    async registerTicketClinic({ oid }, { id }, body) {
        return await this.apiAppointmentService.registerTicketClinic({
            oid,
            appointmentId: id,
            body,
        });
    }
};
exports.ApiAppointmentController = ApiAppointmentController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.APPOINTMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.AppointmentPaginationQuery !== "undefined" && request_1.AppointmentPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiAppointmentController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.APPOINTMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.AppointmentGetManyQuery !== "undefined" && request_1.AppointmentGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiAppointmentController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.APPOINTMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.AppointmentGetOneQuery !== "undefined" && request_1.AppointmentGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.APPOINTMENT_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.AppointmentCreateBody !== "undefined" && request_1.AppointmentCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.APPOINTMENT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.AppointmentUpdateBody !== "undefined" && request_1.AppointmentUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.APPOINTMENT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Post)(':id/register-ticket-clinic'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.APPOINTMENT_REGISTER_TICKET),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _s : Object, typeof (_t = typeof request_1.AppointmentRegisterTicketClinicBody !== "undefined" && request_1.AppointmentRegisterTicketClinicBody) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiAppointmentController.prototype, "registerTicketClinic", null);
exports.ApiAppointmentController = ApiAppointmentController = __decorate([
    (0, swagger_1.ApiTags)('Appointment'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('appointment'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_appointment_service_1.ApiAppointmentService !== "undefined" && api_appointment_service_1.ApiAppointmentService) === "function" ? _a : Object])
], ApiAppointmentController);


/***/ }),
/* 363 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiAppointmentService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const time_helper_1 = __webpack_require__(149);
const variable_1 = __webpack_require__(21);
const appointment_entity_1 = __webpack_require__(47);
const ticket_entity_1 = __webpack_require__(59);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
let ApiAppointmentService = class ApiAppointmentService {
    constructor(socketEmitService, appointmentRepository, customerRepository, ticketRepository, ticketAttributeRepository) {
        this.socketEmitService = socketEmitService;
        this.appointmentRepository = appointmentRepository;
        this.customerRepository = customerRepository;
        this.ticketRepository = ticketRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.appointmentRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                appointmentStatus: filter === null || filter === void 0 ? void 0 : filter.appointmentStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter } = query;
        const data = await this.appointmentRepository.findMany({
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                appointmentStatus: filter === null || filter === void 0 ? void 0 : filter.appointmentStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const appointment = await this.appointmentRepository.findOneBy({ oid, id });
        if (!appointment) {
            throw exception_filter_1.BusinessException.create({ message: 'error.Database.NotFound', details: 'Appointment' });
        }
        return { data: { appointment } };
    }
    async createOne(oid, body) {
        const { customerId: cid, customer } = body, ticketBody = __rest(body, ["customerId", "customer"]);
        let customerId = cid;
        if (!customerId) {
            let customerCode = body.customer.customerCode;
            if (!customerCode) {
                const count = await this.customerRepository.getMaxId();
                customerCode = (count + 1).toString();
            }
            customerId = await this.customerRepository.insertOneFullField(Object.assign(Object.assign({}, body.customer), { debt: 0, oid,
                customerCode }));
        }
        const appointment = await this.appointmentRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, ticketBody), { customerId, toTicketId: 0, cancelReason: '', oid }));
        return { data: { appointment } };
    }
    async updateOne(oid, id, body) {
        const [appointment] = await this.appointmentRepository.updateAndReturnEntity({ oid, id }, body);
        if (!appointment) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Appointment',
            });
        }
        return { data: { appointment } };
    }
    async deleteOne(oid, id) {
        const affected = await this.appointmentRepository.delete({
            oid,
            id,
            appointmentStatus: {
                IN: [appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Cancelled],
            },
        });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: { appointmentId: id } };
    }
    async registerTicketClinic(options) {
        const { oid, appointmentId, body } = options;
        const appointment = await this.appointmentRepository.findOneBy({ oid, id: appointmentId });
        const customer = await this.customerRepository.findOneBy({ oid, id: appointment.customerId });
        const countToday = await this.ticketRepository.countToday(oid);
        const registeredAt = body.registeredAt;
        const ticket = await this.ticketRepository.insertOneFullFieldAndReturnEntity({
            oid,
            roomId: body.roomId,
            customerId: customer.id,
            status: ticket_entity_1.TicketStatus.Schedule,
            registeredAt,
            dailyIndex: countToday + 1,
            year: time_helper_1.ESTimer.info(registeredAt, 7).year,
            month: time_helper_1.ESTimer.info(registeredAt, 7).month + 1,
            date: time_helper_1.ESTimer.info(registeredAt, 7).date,
            customerSourceId: 0,
            debt: 0,
            note: '',
            deliveryStatus: variable_1.DeliveryStatus.NoStock,
            procedureMoney: 0,
            productMoney: 0,
            radiologyMoney: 0,
            laboratoryMoney: 0,
            itemsCostAmount: 0,
            itemsDiscount: 0,
            itemsActualMoney: 0,
            discountMoney: 0,
            discountPercent: 0,
            discountType: variable_1.DiscountType.Percent,
            surcharge: 0,
            totalMoney: 0,
            expense: 0,
            commissionMoney: 0,
            profit: 0,
            paid: 0,
            imageIds: JSON.stringify([]),
            startedAt: null,
            endedAt: null,
        });
        if (appointment.reason) {
            ticket.ticketAttributeList =
                await this.ticketAttributeRepository.insertManyFullFieldAndReturnEntity([
                    {
                        key: 'reason',
                        value: appointment.reason || '',
                        oid,
                        ticketId: ticket.id,
                    },
                ]);
        }
        ticket.customer = customer;
        this.socketEmitService.socketTicketChange(oid, { type: 'CREATE', ticket });
        await this.appointmentRepository.updateAndReturnEntity({ oid, id: appointmentId }, {
            appointmentStatus: appointment_entity_1.AppointmentStatus.Completed,
            toTicketId: ticket.id,
        });
        return { data: { appointmentId } };
    }
};
exports.ApiAppointmentService = ApiAppointmentService;
exports.ApiAppointmentService = ApiAppointmentService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _e : Object])
], ApiAppointmentService);


/***/ }),
/* 364 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(365), exports);
__exportStar(__webpack_require__(366), exports);
__exportStar(__webpack_require__(367), exports);
__exportStar(__webpack_require__(368), exports);


/***/ }),
/* 365 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentGetOneQuery = exports.AppointmentGetManyQuery = exports.AppointmentPaginationQuery = exports.AppointmentGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const appointment_entity_1 = __webpack_require__(47);
const appointment_options_request_1 = __webpack_require__(366);
class AppointmentGetQuery {
}
exports.AppointmentGetQuery = AppointmentGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof appointment_options_request_1.AppointmentRelationQuery !== "undefined" && appointment_options_request_1.AppointmentRelationQuery) === "function" ? _a : Object)
], AppointmentGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 3,
            registeredAt: { GT: Date.now() },
            appointmentStatus: { IN: [appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Waiting] },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof appointment_options_request_1.AppointmentFilterQuery !== "undefined" && appointment_options_request_1.AppointmentFilterQuery) === "function" ? _b : Object)
], AppointmentGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            registeredAt: 'DESC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(appointment_options_request_1.AppointmentSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof appointment_options_request_1.AppointmentSortQuery !== "undefined" && appointment_options_request_1.AppointmentSortQuery) === "function" ? _c : Object)
], AppointmentGetQuery.prototype, "sort", void 0);
class AppointmentPaginationQuery extends (0, swagger_1.IntersectionType)(AppointmentGetQuery, query_1.PaginationQuery) {
}
exports.AppointmentPaginationQuery = AppointmentPaginationQuery;
class AppointmentGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(AppointmentGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.AppointmentGetManyQuery = AppointmentGetManyQuery;
class AppointmentGetOneQuery extends (0, swagger_1.PickType)(AppointmentGetQuery, ['relation']) {
}
exports.AppointmentGetOneQuery = AppointmentGetOneQuery;


/***/ }),
/* 366 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentSortQuery = exports.AppointmentFilterQuery = exports.AppointmentRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
const class_validator_custom_1 = __webpack_require__(243);
const appointment_entity_1 = __webpack_require__(47);
class AppointmentRelationQuery {
}
exports.AppointmentRelationQuery = AppointmentRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], AppointmentRelationQuery.prototype, "customer", void 0);
const ConditionEnumAppointmentStatus = (0, dto_1.createConditionEnum)(appointment_entity_1.AppointmentStatus);
class AppointmentFilterQuery {
}
exports.AppointmentFilterQuery = AppointmentFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], AppointmentFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, appointment_entity_1.AppointmentStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], AppointmentFilterQuery.prototype, "appointmentStatus", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _c : Object)
], AppointmentFilterQuery.prototype, "registeredAt", void 0);
class AppointmentSortQuery extends query_1.SortQuery {
}
exports.AppointmentSortQuery = AppointmentSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], AppointmentSortQuery.prototype, "registeredAt", void 0);


/***/ }),
/* 367 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentRegisterTicketClinicBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class AppointmentRegisterTicketClinicBody {
}
exports.AppointmentRegisterTicketClinicBody = AppointmentRegisterTicketClinicBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentRegisterTicketClinicBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentRegisterTicketClinicBody.prototype, "roomId", void 0);


/***/ }),
/* 368 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppointmentUpdateBody = exports.AppointmentCreateBody = exports.AppointmentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const appointment_entity_1 = __webpack_require__(47);
const request_1 = __webpack_require__(369);
class AppointmentBody {
}
exports.AppointmentBody = AppointmentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 0 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "fromTicketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng đến chăm sóc da' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AppointmentBody.prototype, "reason", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentBody.prototype, "customerSourceId", void 0);
class AppointmentCreateBody extends AppointmentBody {
}
exports.AppointmentCreateBody = AppointmentCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], AppointmentCreateBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.CustomerCreateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.CustomerCreateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _a : Object)
], AppointmentCreateBody.prototype, "customer", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: appointment_entity_1.AppointmentStatus.Confirm }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(appointment_entity_1.AppointmentStatus),
    (0, class_validator_1.IsIn)([appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm]),
    __metadata("design:type", typeof (_b = typeof appointment_entity_1.AppointmentStatus !== "undefined" && appointment_entity_1.AppointmentStatus) === "function" ? _b : Object)
], AppointmentCreateBody.prototype, "appointmentStatus", void 0);
class AppointmentUpdateBody extends AppointmentBody {
}
exports.AppointmentUpdateBody = AppointmentUpdateBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: appointment_entity_1.AppointmentStatus.Confirm }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(appointment_entity_1.AppointmentStatus),
    (0, class_validator_1.IsIn)([appointment_entity_1.AppointmentStatus.Waiting, appointment_entity_1.AppointmentStatus.Confirm, appointment_entity_1.AppointmentStatus.Cancelled]),
    __metadata("design:type", typeof (_c = typeof appointment_entity_1.AppointmentStatus !== "undefined" && appointment_entity_1.AppointmentStatus) === "function" ? _c : Object)
], AppointmentUpdateBody.prototype, "appointmentStatus", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng thay đổi kế hoạch' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], AppointmentUpdateBody.prototype, "cancelReason", void 0);


/***/ }),
/* 369 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(370), exports);
__exportStar(__webpack_require__(371), exports);
__exportStar(__webpack_require__(372), exports);


/***/ }),
/* 370 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerGetOneQuery = exports.CustomerGetManyQuery = exports.CustomerPaginationQuery = exports.CustomerGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const customer_options_request_1 = __webpack_require__(371);
class CustomerGetQuery {
}
exports.CustomerGetQuery = CustomerGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof customer_options_request_1.CustomerRelationQuery !== "undefined" && customer_options_request_1.CustomerRelationQuery) === "function" ? _a : Object)
], CustomerGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            searchText: 'ax',
            isActive: 1,
            debt: { GTE: 1000000 },
            updatedAt: { GT: Date.now() },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof customer_options_request_1.CustomerFilterQuery !== "undefined" && customer_options_request_1.CustomerFilterQuery) === "function" ? _b : Object)
], CustomerGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            debt: 'DESC',
            fullName: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_options_request_1.CustomerSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof customer_options_request_1.CustomerSortQuery !== "undefined" && customer_options_request_1.CustomerSortQuery) === "function" ? _c : Object)
], CustomerGetQuery.prototype, "sort", void 0);
class CustomerPaginationQuery extends (0, swagger_1.IntersectionType)(CustomerGetQuery, query_1.PaginationQuery) {
}
exports.CustomerPaginationQuery = CustomerPaginationQuery;
class CustomerGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(CustomerGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.CustomerGetManyQuery = CustomerGetManyQuery;
class CustomerGetOneQuery extends (0, swagger_1.PickType)(CustomerGetQuery, ['relation']) {
}
exports.CustomerGetOneQuery = CustomerGetOneQuery;


/***/ }),
/* 371 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSortQuery = exports.CustomerFilterQuery = exports.CustomerRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_number_1 = __webpack_require__(310);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class CustomerRelationQuery {
}
exports.CustomerRelationQuery = CustomerRelationQuery;
class CustomerFilterQuery {
}
exports.CustomerFilterQuery = CustomerFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], CustomerFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], CustomerFilterQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], CustomerFilterQuery.prototype, "updatedAt", void 0);
class CustomerSortQuery extends query_1.SortQuery {
}
exports.CustomerSortQuery = CustomerSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CustomerSortQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], CustomerSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 372 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerUpdateBody = exports.CustomerCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class CustomerCreateBody {
}
exports.CustomerCreateBody = CustomerCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "customerCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "facebook", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "zalo", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "customerSourceId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1998 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "yearOfBirth", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], CustomerCreateBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Hưng Yên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Dạ Trạch' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Đức Nhuận' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Mẹ Nguyễn Thị Hương, sđt: 0988021146' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "relative", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Mổ ruột thừa năm 2018' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "healthHistory", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng không' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], CustomerCreateBody.prototype, "isActive", void 0);
class CustomerUpdateBody extends (0, swagger_1.PartialType)(CustomerCreateBody) {
}
exports.CustomerUpdateBody = CustomerUpdateBody;


/***/ }),
/* 373 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchModule = void 0;
const common_1 = __webpack_require__(3);
const api_batch_controller_1 = __webpack_require__(374);
const api_batch_service_1 = __webpack_require__(375);
let ApiBatchModule = class ApiBatchModule {
};
exports.ApiBatchModule = ApiBatchModule;
exports.ApiBatchModule = ApiBatchModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_batch_controller_1.ApiBatchController],
        providers: [api_batch_service_1.ApiBatchService],
    })
], ApiBatchModule);


/***/ }),
/* 374 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_batch_service_1 = __webpack_require__(375);
const request_1 = __webpack_require__(376);
let ApiBatchController = class ApiBatchController {
    constructor(apiBatchService) {
        this.apiBatchService = apiBatchService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiBatchService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiBatchService.getList(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiBatchService.getOne(oid, id, query);
        return { data };
    }
    async updateInfo({ oid }, { id }, body) {
        const data = await this.apiBatchService.updateInfo(oid, id, body);
        return { data };
    }
    async updateInfoAndQuantity({ oid, uid }, { id }, body) {
        const data = await this.apiBatchService.updateInfoAndQuantity({
            oid,
            batchId: id,
            body,
            userId: uid,
        });
        return { data };
    }
    async deleteOne({ oid }, { id }) {
        const data = await this.apiBatchService.destroyOne({ oid, batchId: id });
        return { data };
    }
    async batchMerge({ oid, uid }, body) {
        const data = await this.apiBatchService.batchMerge({ oid, body });
        return { data };
    }
};
exports.ApiBatchController = ApiBatchController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.BatchPaginationQuery !== "undefined" && request_1.BatchPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiBatchController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.BatchGetManyQuery !== "undefined" && request_1.BatchGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiBatchController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.BatchGetOneQuery !== "undefined" && request_1.BatchGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiBatchController.prototype, "detail", null);
__decorate([
    (0, common_1.Patch)('update-info/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE_BATCH),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.BatchUpdateInfoBody !== "undefined" && request_1.BatchUpdateInfoBody) === "function" ? _p : Object]),
    __metadata("design:returntype", typeof (_q = typeof Promise !== "undefined" && Promise) === "function" ? _q : Object)
], ApiBatchController.prototype, "updateInfo", null);
__decorate([
    (0, common_1.Patch)('update-info-and-quantity-and-cost-price/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _s : Object, typeof (_t = typeof request_1.BatchUpdateInfoAndQuantityBody !== "undefined" && request_1.BatchUpdateInfoAndQuantityBody) === "function" ? _t : Object]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], ApiBatchController.prototype, "updateInfoAndQuantity", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_DELETE_BATCH),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_v = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _v : Object, typeof (_w = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _w : Object]),
    __metadata("design:returntype", typeof (_x = typeof Promise !== "undefined" && Promise) === "function" ? _x : Object)
], ApiBatchController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Patch)('merge-batch'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_MERGE_BATCH),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_y = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _y : Object, typeof (_z = typeof request_1.BatchMergeBody !== "undefined" && request_1.BatchMergeBody) === "function" ? _z : Object]),
    __metadata("design:returntype", typeof (_0 = typeof Promise !== "undefined" && Promise) === "function" ? _0 : Object)
], ApiBatchController.prototype, "batchMerge", null);
exports.ApiBatchController = ApiBatchController = __decorate([
    (0, swagger_1.ApiTags)('Batch'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('batch'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_batch_service_1.ApiBatchService !== "undefined" && api_batch_service_1.ApiBatchService) === "function" ? _a : Object])
], ApiBatchController);


/***/ }),
/* 375 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiBatchService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const variable_1 = __webpack_require__(21);
const operations_1 = __webpack_require__(164);
const batch_operator_1 = __webpack_require__(165);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
let ApiBatchService = class ApiBatchService {
    constructor(socketEmitService, cacheDataService, organizationRepository, batchRepository, batchOperator, productRepository, ticketBatchRepository, ticketProductRepository, receiptItemRepository, productMovementRepository, productOperation) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.batchRepository = batchRepository;
        this.batchOperator = batchOperator;
        this.productRepository = productRepository;
        this.ticketBatchRepository = ticketBatchRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.receiptItemRepository = receiptItemRepository;
        this.productMovementRepository = productMovementRepository;
        this.productOperation = productOperation;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { total, data } = await this.batchRepository.pagination({
            relation,
            relationLoadStrategy: 'query',
            page,
            limit,
            condition: {
                oid,
                id: filter === null || filter === void 0 ? void 0 : filter.id,
                warehouseId: filter === null || filter === void 0 ? void 0 : filter.warehouseId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                expiryDate: filter === null || filter === void 0 ? void 0 : filter.expiryDate,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
            },
            sort,
        });
        return { batchList: data, page, limit, total };
    }
    async getList(oid, query) {
        const { limit, filter, relation, sort } = query;
        const batchList = await this.batchRepository.findMany({
            relation,
            relationLoadStrategy: 'query',
            condition: {
                oid,
                id: filter === null || filter === void 0 ? void 0 : filter.id,
                warehouseId: filter === null || filter === void 0 ? void 0 : filter.warehouseId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                expiryDate: filter === null || filter === void 0 ? void 0 : filter.expiryDate,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
            },
            limit,
            sort: sort || undefined,
        });
        return { batchList };
    }
    async getOne(oid, id, query) {
        const batch = await this.batchRepository.findOne({
            relation: query.relation,
            condition: { oid, id },
        });
        return { batch };
    }
    async updateInfo(oid, id, body) {
        const batch = await this.batchRepository.updateOneAndReturnEntity({ id, oid }, body);
        this.socketEmitService.batchListChange(oid, { batchUpsertedList: [batch] });
        return { batch };
    }
    async updateInfoAndQuantity(options) {
        const { oid, batchId, userId, body } = options;
        const batchOrigin = await this.batchRepository.findOne({
            relation: { product: true },
            condition: { oid, id: batchId },
        });
        const batchUpdated = await this.batchRepository.updateOneAndReturnEntity({ id: batchId, oid }, {
            lotNumber: body.lotNumber,
            expiryDate: body.expiryDate,
            warehouseId: body.warehouseId,
            distributorId: body.distributorId,
            costPrice: body.costPrice,
            quantity: body.quantity,
            costAmount: body.costAmount,
        });
        let productUpdated;
        if (batchOrigin.quantity !== batchUpdated.quantity
            || batchOrigin.costAmount !== batchUpdated.costAmount) {
            productUpdated = await this.productOperation.reCalculateQuantityBySumBatch({
                oid,
                productId: batchOrigin.productId,
            });
            const productMovement = {
                oid,
                movementType: variable_1.MovementType.UserChange,
                contactId: userId,
                voucherId: 0,
                voucherProductId: 0,
                warehouseId: batchOrigin.warehouseId,
                productId: batchOrigin.productId,
                batchId: batchOrigin.id,
                isRefund: 0,
                quantity: batchUpdated.quantity - batchOrigin.quantity,
                costAmount: batchUpdated.costAmount - batchOrigin.costAmount,
                openQuantityProduct: batchOrigin.product.quantity,
                closeQuantityProduct: productUpdated.quantity,
                openQuantityBatch: batchOrigin.quantity,
                closeQuantityBatch: batchUpdated.quantity,
                openCostAmountBatch: batchOrigin.costAmount,
                closeCostAmountBatch: batchUpdated.costAmount,
                actualPrice: batchUpdated.costPrice,
                expectedPrice: batchOrigin.costPrice,
                createdAt: Date.now(),
            };
            this.productMovementRepository.insertOneFullField(productMovement);
            this.socketEmitService.productListChange(oid, { productUpsertedList: [productUpdated] });
            this.socketEmitService.batchListChange(oid, { batchUpsertedList: [batchUpdated] });
        }
        return { batch: batchUpdated, product: productUpdated };
    }
    async destroyOne(options) {
        const { oid, batchId } = options;
        const [receiptItemList, ticketBatchList, ticketProductList] = await Promise.all([
            this.receiptItemRepository.findMany({
                condition: { oid, batchId },
                limit: 10,
            }),
            this.ticketBatchRepository.findMany({
                condition: { oid, batchId },
                limit: 10,
            }),
            this.ticketProductRepository.findMany({
                condition: { oid, batchId },
                limit: 10,
            }),
        ]);
        let productUpdated;
        if (!(receiptItemList.length > 0 || ticketBatchList.length > 0 || ticketProductList.length > 0)) {
            const batchDestroyed = await this.batchRepository.deleteOneAndReturnEntity({
                oid,
                id: batchId,
            });
            productUpdated = await this.productRepository.updateOneAndReturnEntity({ oid, id: batchDestroyed.productId }, { quantity: () => `quantity - ${batchDestroyed.quantity}` });
            await this.organizationRepository.updateDataVersion(oid);
            this.cacheDataService.clearOrganization(oid);
            this.socketEmitService.productListChange(oid, { productUpsertedList: [productUpdated] });
            this.socketEmitService.batchListChange(oid, { batchDestroyedList: [batchDestroyed] });
        }
        return {
            receiptItemList,
            ticketBatchList,
            ticketProductList,
            batchId,
            product: productUpdated,
            success: !(receiptItemList.length > 0
                || ticketBatchList.length > 0
                || ticketProductList.length > 0),
        };
    }
    async batchMerge(options) {
        const { oid, body } = options;
        const { batchIdSourceList, batchIdTarget, productId } = body;
        batchIdSourceList.forEach((i) => {
            if (isNaN(i) || i <= 0) {
                throw new exception_filter_1.BusinessException('error.ValidateFailed');
            }
        });
        const { batchModified, batchDestroyedList } = await this.batchOperator.mergeBatch({
            oid,
            productId,
            batchIdSourceList,
            batchIdTarget,
        });
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        this.socketEmitService.batchListChange(oid, {
            batchDestroyedList,
            batchUpsertedList: [batchModified],
        });
        return true;
    }
};
exports.ApiBatchService = ApiBatchService;
exports.ApiBatchService = ApiBatchService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.OrganizationRepository !== "undefined" && repositories_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _d : Object, typeof (_e = typeof batch_operator_1.BatchOperator !== "undefined" && batch_operator_1.BatchOperator) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketBatchRepository !== "undefined" && repositories_1.TicketBatchRepository) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _h : Object, typeof (_j = typeof repositories_1.PurchaseOrderItemRepository !== "undefined" && repositories_1.PurchaseOrderItemRepository) === "function" ? _j : Object, typeof (_k = typeof repositories_1.ProductMovementRepository !== "undefined" && repositories_1.ProductMovementRepository) === "function" ? _k : Object, typeof (_l = typeof operations_1.ProductOperation !== "undefined" && operations_1.ProductOperation) === "function" ? _l : Object])
], ApiBatchService);


/***/ }),
/* 376 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(377), exports);
__exportStar(__webpack_require__(379), exports);
__exportStar(__webpack_require__(378), exports);
__exportStar(__webpack_require__(380), exports);


/***/ }),
/* 377 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchGetOneQuery = exports.BatchGetManyQuery = exports.BatchPaginationQuery = exports.BatchGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const batch_options_request_1 = __webpack_require__(378);
class BatchGetQuery {
}
exports.BatchGetQuery = BatchGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ product: true }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof batch_options_request_1.BatchRelationQuery !== "undefined" && batch_options_request_1.BatchRelationQuery) === "function" ? _a : Object)
], BatchGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ quantity: { GT: 10 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof batch_options_request_1.BatchFilterQuery !== "undefined" && batch_options_request_1.BatchFilterQuery) === "function" ? _b : Object)
], BatchGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'ASC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(batch_options_request_1.BatchSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof batch_options_request_1.BatchSortQuery !== "undefined" && batch_options_request_1.BatchSortQuery) === "function" ? _c : Object)
], BatchGetQuery.prototype, "sort", void 0);
class BatchPaginationQuery extends (0, swagger_1.IntersectionType)(BatchGetQuery, query_1.PaginationQuery) {
}
exports.BatchPaginationQuery = BatchPaginationQuery;
class BatchGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(BatchGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.BatchGetManyQuery = BatchGetManyQuery;
class BatchGetOneQuery extends (0, swagger_1.PickType)(BatchGetQuery, ['relation']) {
}
exports.BatchGetOneQuery = BatchGetOneQuery;


/***/ }),
/* 378 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchSortQuery = exports.BatchFilterQuery = exports.BatchRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class BatchRelationQuery {
}
exports.BatchRelationQuery = BatchRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], BatchRelationQuery.prototype, "product", void 0);
class BatchFilterQuery {
}
exports.BatchFilterQuery = BatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "id", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "warehouseId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], BatchFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _e : Object)
], BatchFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _f : Object)
], BatchFilterQuery.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_g = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _g : Object)
], BatchFilterQuery.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_h = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _h : Object)
], BatchFilterQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => BatchFilterQuery),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], BatchFilterQuery.prototype, "$OR", void 0);
class BatchSortQuery extends query_1.SortQuery {
}
exports.BatchSortQuery = BatchSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "expiryDate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "registeredAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], BatchSortQuery.prototype, "productId", void 0);


/***/ }),
/* 379 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchMergeBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class BatchMergeBody {
}
exports.BatchMergeBody = BatchMergeBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], BatchMergeBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], BatchMergeBody.prototype, "batchIdSourceList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], BatchMergeBody.prototype, "batchIdTarget", void 0);


/***/ }),
/* 380 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BatchUpdateInfoAndQuantityBody = exports.BatchUpdateInfoBody = exports.BatchInsertBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class BatchInsertBody {
}
exports.BatchInsertBody = BatchInsertBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], BatchInsertBody.prototype, "lotNumber", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "expiryDate", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], BatchInsertBody.prototype, "isActive", void 0);
class BatchUpdateInfoBody extends (0, swagger_1.PickType)(BatchInsertBody, [
    'lotNumber',
    'expiryDate',
    'warehouseId',
]) {
}
exports.BatchUpdateInfoBody = BatchUpdateInfoBody;
class BatchUpdateInfoAndQuantityBody extends (0, swagger_1.PickType)(BatchInsertBody, [
    'lotNumber',
    'expiryDate',
    'warehouseId',
    'distributorId',
    'costPrice',
    'isActive',
]) {
}
exports.BatchUpdateInfoAndQuantityBody = BatchUpdateInfoAndQuantityBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], BatchUpdateInfoAndQuantityBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], BatchUpdateInfoAndQuantityBody.prototype, "costAmount", void 0);


/***/ }),
/* 381 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceModule = void 0;
const common_1 = __webpack_require__(3);
const api_customer_source_controller_1 = __webpack_require__(382);
const api_customer_source_service_1 = __webpack_require__(383);
let ApiCustomerSourceModule = class ApiCustomerSourceModule {
};
exports.ApiCustomerSourceModule = ApiCustomerSourceModule;
exports.ApiCustomerSourceModule = ApiCustomerSourceModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_customer_source_controller_1.ApiCustomerSourceController],
        providers: [api_customer_source_service_1.ApiCustomerSourceService],
    })
], ApiCustomerSourceModule);


/***/ }),
/* 382 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_customer_source_service_1 = __webpack_require__(383);
const request_1 = __webpack_require__(384);
let ApiCustomerSourceController = class ApiCustomerSourceController {
    constructor(apiCustomerSourceService) {
        this.apiCustomerSourceService = apiCustomerSourceService;
    }
    pagination({ oid }, query) {
        return this.apiCustomerSourceService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiCustomerSourceService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiCustomerSourceService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiCustomerSourceService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiCustomerSourceService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiCustomerSourceService.destroyOne(oid, id);
    }
};
exports.ApiCustomerSourceController = ApiCustomerSourceController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.CustomerSourcePaginationQuery !== "undefined" && request_1.CustomerSourcePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.CustomerSourceGetManyQuery !== "undefined" && request_1.CustomerSourceGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiCustomerSourceController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.CustomerSourceCreateBody !== "undefined" && request_1.CustomerSourceCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.CustomerSourceUpdateBody !== "undefined" && request_1.CustomerSourceUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiCustomerSourceController.prototype, "destroyOne", null);
exports.ApiCustomerSourceController = ApiCustomerSourceController = __decorate([
    (0, swagger_1.ApiTags)('CustomerSource'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('customer-source'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_customer_source_service_1.ApiCustomerSourceService !== "undefined" && api_customer_source_service_1.ApiCustomerSourceService) === "function" ? _a : Object])
], ApiCustomerSourceController);


/***/ }),
/* 383 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerSourceService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const customer_source_repository_1 = __webpack_require__(101);
let ApiCustomerSourceService = class ApiCustomerSourceService {
    constructor(customerSourceRepository) {
        this.customerSourceRepository = customerSourceRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.customerSourceRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.customerSourceRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const data = await this.customerSourceRepository.findOneBy({ oid, id });
        if (!data)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data };
    }
    async createOne(oid, body) {
        const id = await this.customerSourceRepository.insertOne(Object.assign({ oid }, body));
        const data = await this.customerSourceRepository.findOneById(id);
        return { data };
    }
    async updateOne(oid, id, body) {
        const affected = await this.customerSourceRepository.update({ id, oid }, body);
        const data = await this.customerSourceRepository.findOneBy({ oid, id });
        return { data };
    }
    async destroyOne(oid, id) {
        const affected = await this.customerSourceRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        const data = await this.customerSourceRepository.findOneById(id);
        return { data };
    }
};
exports.ApiCustomerSourceService = ApiCustomerSourceService;
exports.ApiCustomerSourceService = ApiCustomerSourceService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof customer_source_repository_1.CustomerSourceRepository !== "undefined" && customer_source_repository_1.CustomerSourceRepository) === "function" ? _a : Object])
], ApiCustomerSourceService);


/***/ }),
/* 384 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(385), exports);
__exportStar(__webpack_require__(386), exports);
__exportStar(__webpack_require__(387), exports);


/***/ }),
/* 385 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceGetOneQuery = exports.CustomerSourceGetManyQuery = exports.CustomerSourcePaginationQuery = exports.CustomerSourceGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const customer_source_options_request_1 = __webpack_require__(386);
class CustomerSourceGetQuery {
}
exports.CustomerSourceGetQuery = CustomerSourceGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof customer_source_options_request_1.CustomerSourceRelationQuery !== "undefined" && customer_source_options_request_1.CustomerSourceRelationQuery) === "function" ? _a : Object)
], CustomerSourceGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof customer_source_options_request_1.CustomerSourceFilterQuery !== "undefined" && customer_source_options_request_1.CustomerSourceFilterQuery) === "function" ? _b : Object)
], CustomerSourceGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(customer_source_options_request_1.CustomerSourceSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof customer_source_options_request_1.CustomerSourceSortQuery !== "undefined" && customer_source_options_request_1.CustomerSourceSortQuery) === "function" ? _c : Object)
], CustomerSourceGetQuery.prototype, "sort", void 0);
class CustomerSourcePaginationQuery extends (0, swagger_1.IntersectionType)(CustomerSourceGetQuery, query_1.PaginationQuery) {
}
exports.CustomerSourcePaginationQuery = CustomerSourcePaginationQuery;
class CustomerSourceGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(CustomerSourceGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.CustomerSourceGetManyQuery = CustomerSourceGetManyQuery;
class CustomerSourceGetOneQuery extends (0, swagger_1.PickType)(CustomerSourceGetQuery, ['relation']) {
}
exports.CustomerSourceGetOneQuery = CustomerSourceGetOneQuery;


/***/ }),
/* 386 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceSortQuery = exports.CustomerSourceFilterQuery = exports.CustomerSourceRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class CustomerSourceRelationQuery {
}
exports.CustomerSourceRelationQuery = CustomerSourceRelationQuery;
class CustomerSourceFilterQuery {
}
exports.CustomerSourceFilterQuery = CustomerSourceFilterQuery;
class CustomerSourceSortQuery extends query_1.SortQuery {
}
exports.CustomerSourceSortQuery = CustomerSourceSortQuery;


/***/ }),
/* 387 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerSourceUpdateBody = exports.CustomerSourceCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class CustomerSourceCreateBody {
}
exports.CustomerSourceCreateBody = CustomerSourceCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], CustomerSourceCreateBody.prototype, "name", void 0);
class CustomerSourceUpdateBody extends (0, swagger_1.PartialType)(CustomerSourceCreateBody) {
}
exports.CustomerSourceUpdateBody = CustomerSourceUpdateBody;


/***/ }),
/* 388 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerModule = void 0;
const common_1 = __webpack_require__(3);
const api_customer_controller_1 = __webpack_require__(389);
const api_customer_service_1 = __webpack_require__(390);
let ApiCustomerModule = class ApiCustomerModule {
};
exports.ApiCustomerModule = ApiCustomerModule;
exports.ApiCustomerModule = ApiCustomerModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_customer_controller_1.ApiCustomerController],
        providers: [api_customer_service_1.ApiCustomerService],
    })
], ApiCustomerModule);


/***/ }),
/* 389 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_customer_service_1 = __webpack_require__(390);
const request_1 = __webpack_require__(369);
let ApiCustomerController = class ApiCustomerController {
    constructor(apiCustomerService) {
        this.apiCustomerService = apiCustomerService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiCustomerService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiCustomerService.getMany(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiCustomerService.getOne(oid, id, query);
        return { data };
    }
    async create({ oid }, body) {
        const data = await this.apiCustomerService.createOne(oid, body);
        return { data };
    }
    async update({ oid }, { id }, body) {
        const data = await this.apiCustomerService.updateOne(oid, +id, body);
        return { data };
    }
    async destroyOne({ oid, organization }, { id }) {
        const data = await this.apiCustomerService.destroyOne({
            oid,
            customerId: id,
        });
        return { data };
    }
};
exports.ApiCustomerController = ApiCustomerController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.CustomerPaginationQuery !== "undefined" && request_1.CustomerPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiCustomerController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.CustomerGetManyQuery !== "undefined" && request_1.CustomerGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiCustomerController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.CustomerGetOneQuery !== "undefined" && request_1.CustomerGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiCustomerController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.CUSTOMER_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiCustomerController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.CUSTOMER_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.CustomerUpdateBody !== "undefined" && request_1.CustomerUpdateBody) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], ApiCustomerController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.CUSTOMER_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiCustomerController.prototype, "destroyOne", null);
exports.ApiCustomerController = ApiCustomerController = __decorate([
    (0, swagger_1.ApiTags)('Customer'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('customer'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_customer_service_1.ApiCustomerService !== "undefined" && api_customer_service_1.ApiCustomerService) === "function" ? _a : Object])
], ApiCustomerController);


/***/ }),
/* 390 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiCustomerService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const error_1 = __webpack_require__(14);
const payment_entity_1 = __webpack_require__(51);
const repositories_1 = __webpack_require__(42);
const customer_repository_1 = __webpack_require__(102);
const organization_repository_1 = __webpack_require__(111);
const socket_emit_service_1 = __webpack_require__(340);
let ApiCustomerService = class ApiCustomerService {
    constructor(socketEmitService, cacheDataService, customerRepository, paymentRepository, paymentTicketItemRepository, organizationRepository, ticketRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.customerRepository = customerRepository;
        this.paymentRepository = paymentRepository;
        this.paymentTicketItemRepository = paymentTicketItemRepository;
        this.organizationRepository = organizationRepository;
        this.ticketRepository = ticketRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data: customerList, total } = await this.customerRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return { customerList, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter } = query;
        const customerList = await this.customerRepository.findMany({
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { customerList };
    }
    async getOne(oid, id, query) {
        const customer = await this.customerRepository.findOneBy({ oid, id });
        if (!customer)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { customer };
    }
    async createOne(oid, body) {
        let customerCode = body.customerCode;
        if (!customerCode) {
            const count = await this.customerRepository.getMaxId();
            customerCode = (count + 1).toString();
        }
        const existCustomer = await this.customerRepository.findOneBy({
            oid,
            customerCode,
        });
        if (existCustomer) {
            throw new error_1.BusinessError(`Trùng mã khách hàng với ${existCustomer.fullName}`);
        }
        const customer = await this.customerRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid, debt: 0, customerCode }));
        this.socketEmitService.customerUpsert(oid, { customer });
        return { customer };
    }
    async updateOne(oid, customerId, customerBody) {
        if (customerBody.customerCode != null) {
            const existCustomer = await this.customerRepository.findOneBy({
                oid,
                customerCode: customerBody.customerCode,
                id: { NOT: customerId },
            });
            if (existCustomer) {
                throw new error_1.BusinessError(`Trùng mã khách hàng với ${existCustomer.fullName}`);
            }
        }
        const customer = await this.customerRepository.updateOneAndReturnEntity({ oid, id: customerId }, customerBody);
        this.socketEmitService.customerUpsert(oid, { customer });
        return { customer };
    }
    async destroyOne(options) {
        const { oid, customerId } = options;
        const ticketList = await this.ticketRepository.findMany({
            condition: { oid, customerId },
            limit: 10,
        });
        if (ticketList.length === 0) {
            const [customerDestroy, paymentDestroyedList] = await Promise.all([
                this.customerRepository.deleteAndReturnEntity({ oid, id: customerId }),
                this.paymentRepository.deleteAndReturnEntity({
                    oid,
                    personId: customerId,
                    personType: payment_entity_1.PaymentPersonType.Customer,
                }),
            ]);
            if (paymentDestroyedList.length) {
                await this.paymentTicketItemRepository.delete({
                    oid,
                    paymentId: { IN: paymentDestroyedList.map((i) => i.id) },
                });
            }
            await this.organizationRepository.updateDataVersion(oid);
            this.cacheDataService.clearOrganization(oid);
        }
        return { ticketList, customerId, success: ticketList.length === 0 };
    }
};
exports.ApiCustomerService = ApiCustomerService;
exports.ApiCustomerService = ApiCustomerService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof customer_repository_1.CustomerRepository !== "undefined" && customer_repository_1.CustomerRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.PaymentTicketItemRepository !== "undefined" && repositories_1.PaymentTicketItemRepository) === "function" ? _e : Object, typeof (_f = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _g : Object])
], ApiCustomerService);


/***/ }),
/* 391 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDiscountModule = void 0;
const common_1 = __webpack_require__(3);
const api_discount_controller_1 = __webpack_require__(392);
const api_discount_service_1 = __webpack_require__(393);
let ApiDiscountModule = class ApiDiscountModule {
};
exports.ApiDiscountModule = ApiDiscountModule;
exports.ApiDiscountModule = ApiDiscountModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_discount_controller_1.ApiDiscountController],
        providers: [api_discount_service_1.ApiDiscountService],
    })
], ApiDiscountModule);


/***/ }),
/* 392 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDiscountController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_discount_service_1 = __webpack_require__(393);
const request_1 = __webpack_require__(394);
let ApiDiscountController = class ApiDiscountController {
    constructor(apiDiscountService) {
        this.apiDiscountService = apiDiscountService;
    }
    list({ oid }, query) {
        return this.apiDiscountService.getMany(oid, query);
    }
    findOne({ oid }, { id }, query) {
        return this.apiDiscountService.getOne(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiDiscountService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiDiscountService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiDiscountService.destroyOne(oid, id);
    }
};
exports.ApiDiscountController = ApiDiscountController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.DiscountGetManyQuery !== "undefined" && request_1.DiscountGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiDiscountController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _e : Object, typeof (_f = typeof request_1.DiscountGetOneQuery !== "undefined" && request_1.DiscountGetOneQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", void 0)
], ApiDiscountController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object, typeof (_h = typeof request_1.DiscountCreateBody !== "undefined" && request_1.DiscountCreateBody) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiDiscountController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_1.DiscountUpdateBody !== "undefined" && request_1.DiscountUpdateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiDiscountController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiDiscountController.prototype, "destroyOne", null);
exports.ApiDiscountController = ApiDiscountController = __decorate([
    (0, swagger_1.ApiTags)('Discount'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('discount'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_discount_service_1.ApiDiscountService !== "undefined" && api_discount_service_1.ApiDiscountService) === "function" ? _a : Object])
], ApiDiscountController);


/***/ }),
/* 393 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDiscountService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const discount_entity_1 = __webpack_require__(77);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
let ApiDiscountService = class ApiDiscountService {
    constructor(socketEmitService, discountRepository, productRepository, procedureRepository, radiologyRepository, laboratoryRepository) {
        this.socketEmitService = socketEmitService;
        this.discountRepository = discountRepository;
        this.productRepository = productRepository;
        this.procedureRepository = procedureRepository;
        this.radiologyRepository = radiologyRepository;
        this.laboratoryRepository = laboratoryRepository;
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const discountList = await this.discountRepository.findMany({
            relation: {},
            condition: {
                oid,
                discountInteractId: filter === null || filter === void 0 ? void 0 : filter.discountInteractId,
            },
            limit,
            sort,
        });
        if (query.relation) {
            await this.generateRelation(discountList, query.relation);
        }
        return { data: { discountList } };
    }
    async getOne(oid, id, query) {
        const discount = await this.discountRepository.findOne({
            condition: { oid, id },
        });
        if (!discount)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation([discount], query.relation);
        }
        return { data: { discount } };
    }
    async createOne(oid, body) {
        const discount = await this.discountRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        this.socketEmitService.discountListChange(oid, { discountUpsertedList: [discount] });
        return { data: { discount } };
    }
    async updateOne(oid, id, body) {
        const discount = await this.discountRepository.updateOneAndReturnEntity({ id, oid }, body);
        this.socketEmitService.discountListChange(oid, { discountUpsertedList: [discount] });
        return { data: { discount } };
    }
    async destroyOne(oid, id) {
        const discountDestroyedList = await this.discountRepository.deleteAndReturnEntity({ oid, id });
        this.socketEmitService.discountListChange(oid, { discountDestroyedList });
        return { data: true };
    }
    async generateRelation(discountList, relation) {
        const productIdList = discountList
            .filter((i) => i.discountInteractType === discount_entity_1.DiscountInteractType.Product)
            .map((i) => i.discountInteractId);
        const procedureIdList = discountList
            .filter((i) => i.discountInteractType === discount_entity_1.DiscountInteractType.Procedure)
            .map((i) => i.discountInteractId);
        const radiologyIdList = discountList
            .filter((i) => i.discountInteractType === discount_entity_1.DiscountInteractType.Radiology)
            .map((i) => i.discountInteractId);
        const laboratoryIdList = discountList
            .filter((i) => i.discountInteractType === discount_entity_1.DiscountInteractType.Laboratory)
            .map((i) => i.discountInteractId);
        const [productList, procedureList, radiologyList, laboratoryList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.product) && productIdList.length
                ? this.productRepository.findManyBy({ id: { IN: helpers_1.ESArray.uniqueArray(productIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.procedure) && procedureIdList.length
                ? this.procedureRepository.findManyBy({ id: { IN: helpers_1.ESArray.uniqueArray(procedureIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.radiology) && radiologyIdList.length
                ? this.radiologyRepository.findManyBy({ id: { IN: helpers_1.ESArray.uniqueArray(radiologyIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.laboratory) && laboratoryIdList.length
                ? this.laboratoryRepository.findManyBy({
                    id: { IN: helpers_1.ESArray.uniqueArray(laboratoryIdList) },
                })
                : [],
        ]);
        const productMap = helpers_1.ESArray.arrayToKeyValue(productList, 'id');
        const procedureMap = helpers_1.ESArray.arrayToKeyValue(procedureList, 'id');
        const laboratoryMap = helpers_1.ESArray.arrayToKeyValue(laboratoryList, 'id');
        const radiologyMap = helpers_1.ESArray.arrayToKeyValue(radiologyList, 'id');
        discountList.forEach((discount) => {
            if (discount.discountInteractType === discount_entity_1.DiscountInteractType.Product) {
                discount.product = productMap[discount.discountInteractId];
            }
            if (discount.discountInteractType === discount_entity_1.DiscountInteractType.Procedure) {
                discount.procedure = procedureMap[discount.discountInteractId];
            }
            if (discount.discountInteractType === discount_entity_1.DiscountInteractType.Radiology) {
                discount.radiology = radiologyMap[discount.discountInteractId];
            }
            if (discount.discountInteractType === discount_entity_1.DiscountInteractType.Laboratory) {
                discount.laboratory = laboratoryMap[discount.discountInteractId];
            }
        });
        return discountList;
    }
};
exports.ApiDiscountService = ApiDiscountService;
exports.ApiDiscountService = ApiDiscountService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.DiscountRepository !== "undefined" && repositories_1.DiscountRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.LaboratoryRepository !== "undefined" && repositories_1.LaboratoryRepository) === "function" ? _f : Object])
], ApiDiscountService);


/***/ }),
/* 394 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(395), exports);
__exportStar(__webpack_require__(396), exports);
__exportStar(__webpack_require__(397), exports);


/***/ }),
/* 395 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DiscountGetOneQuery = exports.DiscountGetManyQuery = exports.DiscountPaginationQuery = exports.DiscountGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const discount_options_request_1 = __webpack_require__(396);
class DiscountGetQuery {
}
exports.DiscountGetQuery = DiscountGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(discount_options_request_1.DiscountRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof discount_options_request_1.DiscountRelationQuery !== "undefined" && discount_options_request_1.DiscountRelationQuery) === "function" ? _a : Object)
], DiscountGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(discount_options_request_1.DiscountFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof discount_options_request_1.DiscountFilterQuery !== "undefined" && discount_options_request_1.DiscountFilterQuery) === "function" ? _b : Object)
], DiscountGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(discount_options_request_1.DiscountSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof discount_options_request_1.DiscountSortQuery !== "undefined" && discount_options_request_1.DiscountSortQuery) === "function" ? _c : Object)
], DiscountGetQuery.prototype, "sort", void 0);
class DiscountPaginationQuery extends (0, swagger_1.IntersectionType)(DiscountGetQuery, query_1.PaginationQuery) {
}
exports.DiscountPaginationQuery = DiscountPaginationQuery;
class DiscountGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(DiscountGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.DiscountGetManyQuery = DiscountGetManyQuery;
class DiscountGetOneQuery extends (0, swagger_1.PickType)(DiscountGetQuery, ['relation']) {
}
exports.DiscountGetOneQuery = DiscountGetOneQuery;


/***/ }),
/* 396 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DiscountSortQuery = exports.DiscountFilterQuery = exports.DiscountRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class DiscountRelationQuery {
}
exports.DiscountRelationQuery = DiscountRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], DiscountRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], DiscountRelationQuery.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], DiscountRelationQuery.prototype, "laboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], DiscountRelationQuery.prototype, "radiology", void 0);
class DiscountFilterQuery {
}
exports.DiscountFilterQuery = DiscountFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountFilterQuery.prototype, "discountInteractId", void 0);
class DiscountSortQuery extends query_1.SortQuery {
}
exports.DiscountSortQuery = DiscountSortQuery;


/***/ }),
/* 397 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DiscountUpdateBody = exports.DiscountCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const discount_entity_1 = __webpack_require__(77);
class DiscountCreateBody {
}
exports.DiscountCreateBody = DiscountCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: discount_entity_1.DiscountInteractType, example: discount_entity_1.DiscountInteractType.Product }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(discount_entity_1.DiscountInteractType),
    __metadata("design:type", typeof (_a = typeof discount_entity_1.DiscountInteractType !== "undefined" && discount_entity_1.DiscountInteractType) === "function" ? _a : Object)
], DiscountCreateBody.prototype, "discountInteractType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountCreateBody.prototype, "discountInteractId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountCreateBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DiscountCreateBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.DiscountType, example: variable_1.DiscountType.Percent }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], DiscountCreateBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: discount_entity_1.DiscountRepeatType, example: discount_entity_1.DiscountRepeatType.Weekly }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(discount_entity_1.DiscountRepeatType),
    __metadata("design:type", typeof (_c = typeof discount_entity_1.DiscountRepeatType !== "undefined" && discount_entity_1.DiscountRepeatType) === "function" ? _c : Object)
], DiscountCreateBody.prototype, "discountRepeatType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DiscountCreateBody.prototype, "periodsDay", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DiscountCreateBody.prototype, "periodsTime", void 0);
class DiscountUpdateBody extends (0, swagger_1.OmitType)(DiscountCreateBody, [
    'discountInteractType',
    'discountInteractId',
]) {
}
exports.DiscountUpdateBody = DiscountUpdateBody;


/***/ }),
/* 398 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorModule = void 0;
const common_1 = __webpack_require__(3);
const api_distributor_controller_1 = __webpack_require__(399);
const api_distributor_service_1 = __webpack_require__(400);
let ApiDistributorModule = class ApiDistributorModule {
};
exports.ApiDistributorModule = ApiDistributorModule;
exports.ApiDistributorModule = ApiDistributorModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_distributor_controller_1.ApiDistributorController],
        providers: [api_distributor_service_1.ApiDistributorService],
    })
], ApiDistributorModule);


/***/ }),
/* 399 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_distributor_service_1 = __webpack_require__(400);
const request_1 = __webpack_require__(401);
let ApiDistributorController = class ApiDistributorController {
    constructor(apiDistributorService) {
        this.apiDistributorService = apiDistributorService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiDistributorService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiDistributorService.getMany(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }) {
        const data = await this.apiDistributorService.getOne(oid, id);
        return { data };
    }
    async createOne({ oid }, body) {
        const data = await this.apiDistributorService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiDistributorService.updateOne(oid, id, body);
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiDistributorService.destroyOne(oid, id);
        return { data };
    }
};
exports.ApiDistributorController = ApiDistributorController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.DISTRIBUTOR),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.DistributorPaginationQuery !== "undefined" && request_1.DistributorPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiDistributorController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.DISTRIBUTOR),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.DistributorGetManyQuery !== "undefined" && request_1.DistributorGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiDistributorController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.DISTRIBUTOR),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], ApiDistributorController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.DISTRIBUTOR_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof request_1.DistributorCreateBody !== "undefined" && request_1.DistributorCreateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", typeof (_o = typeof Promise !== "undefined" && Promise) === "function" ? _o : Object)
], ApiDistributorController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.DISTRIBUTOR_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object, typeof (_r = typeof request_1.DistributorUpdateBody !== "undefined" && request_1.DistributorUpdateBody) === "function" ? _r : Object]),
    __metadata("design:returntype", typeof (_s = typeof Promise !== "undefined" && Promise) === "function" ? _s : Object)
], ApiDistributorController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.DISTRIBUTOR_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _u : Object]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], ApiDistributorController.prototype, "destroyOne", null);
exports.ApiDistributorController = ApiDistributorController = __decorate([
    (0, swagger_1.ApiTags)('Distributor'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('distributor'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_distributor_service_1.ApiDistributorService !== "undefined" && api_distributor_service_1.ApiDistributorService) === "function" ? _a : Object])
], ApiDistributorController);


/***/ }),
/* 400 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiDistributorService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const payment_entity_1 = __webpack_require__(51);
const repositories_1 = __webpack_require__(42);
const distributor_repository_1 = __webpack_require__(104);
const purchase_order_repository_1 = __webpack_require__(126);
const socket_emit_service_1 = __webpack_require__(340);
let ApiDistributorService = class ApiDistributorService {
    constructor(socketEmitService, distributorRepository, paymentRepository, purchaseOrderRepository) {
        this.socketEmitService = socketEmitService;
        this.distributorRepository = distributorRepository;
        this.paymentRepository = paymentRepository;
        this.purchaseOrderRepository = purchaseOrderRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.distributorRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return { distributorList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const distributorList = await this.distributorRepository.findMany({
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                debt: filter === null || filter === void 0 ? void 0 : filter.debt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { distributorList };
    }
    async getOne(oid, id) {
        const distributor = await this.distributorRepository.findOneBy({ oid, id });
        if (!distributor)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { distributor };
    }
    async createOne(oid, body) {
        const distributor = await this.distributorRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid, debt: 0 }));
        this.socketEmitService.distributorUpsert(oid, { distributor });
        return { distributor };
    }
    async updateOne(oid, id, body) {
        const distributor = await this.distributorRepository.updateOneAndReturnEntity({ oid, id }, body);
        this.socketEmitService.distributorUpsert(oid, { distributor });
        return { distributor };
    }
    async destroyOne(oid, distributorId) {
        const purchaseOrderList = await this.purchaseOrderRepository.findMany({
            condition: { oid, distributorId },
            limit: 10,
        });
        if (!purchaseOrderList.length) {
            await Promise.allSettled([
                this.distributorRepository.delete({ oid, id: distributorId }),
                this.paymentRepository.delete({
                    oid,
                    personId: distributorId,
                    personType: payment_entity_1.PaymentPersonType.Distributor,
                }),
            ]);
        }
        return { purchaseOrderList, distributorId, success: purchaseOrderList.length === 0 };
    }
};
exports.ApiDistributorService = ApiDistributorService;
exports.ApiDistributorService = ApiDistributorService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof distributor_repository_1.DistributorRepository !== "undefined" && distributor_repository_1.DistributorRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _c : Object, typeof (_d = typeof purchase_order_repository_1.PurchaseOrderRepository !== "undefined" && purchase_order_repository_1.PurchaseOrderRepository) === "function" ? _d : Object])
], ApiDistributorService);


/***/ }),
/* 401 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(402), exports);
__exportStar(__webpack_require__(403), exports);
__exportStar(__webpack_require__(404), exports);


/***/ }),
/* 402 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorGetOneQuery = exports.DistributorGetManyQuery = exports.DistributorPaginationQuery = exports.DistributorGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const distributor_options_request_1 = __webpack_require__(403);
class DistributorGetQuery {
}
exports.DistributorGetQuery = DistributorGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof distributor_options_request_1.DistributorRelationQuery !== "undefined" && distributor_options_request_1.DistributorRelationQuery) === "function" ? _a : Object)
], DistributorGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1, debt: { GT: 15000 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof distributor_options_request_1.DistributorFilterQuery !== "undefined" && distributor_options_request_1.DistributorFilterQuery) === "function" ? _b : Object)
], DistributorGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(distributor_options_request_1.DistributorSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof distributor_options_request_1.DistributorSortQuery !== "undefined" && distributor_options_request_1.DistributorSortQuery) === "function" ? _c : Object)
], DistributorGetQuery.prototype, "sort", void 0);
class DistributorPaginationQuery extends (0, swagger_1.IntersectionType)(DistributorGetQuery, query_1.PaginationQuery) {
}
exports.DistributorPaginationQuery = DistributorPaginationQuery;
class DistributorGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(DistributorGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.DistributorGetManyQuery = DistributorGetManyQuery;
class DistributorGetOneQuery extends (0, swagger_1.PickType)(DistributorGetQuery, ['relation']) {
}
exports.DistributorGetOneQuery = DistributorGetOneQuery;


/***/ }),
/* 403 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorSortQuery = exports.DistributorFilterQuery = exports.DistributorRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_number_1 = __webpack_require__(310);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class DistributorRelationQuery {
}
exports.DistributorRelationQuery = DistributorRelationQuery;
class DistributorFilterQuery {
}
exports.DistributorFilterQuery = DistributorFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], DistributorFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], DistributorFilterQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], DistributorFilterQuery.prototype, "updatedAt", void 0);
class DistributorSortQuery extends query_1.SortQuery {
}
exports.DistributorSortQuery = DistributorSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], DistributorSortQuery.prototype, "debt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], DistributorSortQuery.prototype, "fullName", void 0);


/***/ }),
/* 404 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorUpdateBody = exports.DistributorCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class DistributorCreateBody {
}
exports.DistributorCreateBody = DistributorCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ default: '0986123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "addressStreet", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng không' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorCreateBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], DistributorCreateBody.prototype, "isActive", void 0);
class DistributorUpdateBody extends (0, swagger_1.PartialType)(DistributorCreateBody) {
}
exports.DistributorUpdateBody = DistributorUpdateBody;


/***/ }),
/* 405 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiExpenseModule = void 0;
const common_1 = __webpack_require__(3);
const api_expense_controller_1 = __webpack_require__(406);
const api_expense_service_1 = __webpack_require__(407);
let ApiExpenseModule = class ApiExpenseModule {
};
exports.ApiExpenseModule = ApiExpenseModule;
exports.ApiExpenseModule = ApiExpenseModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_expense_controller_1.ApiExpenseController],
        providers: [api_expense_service_1.ApiExpenseService],
    })
], ApiExpenseModule);


/***/ }),
/* 406 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiExpenseController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_expense_service_1 = __webpack_require__(407);
const request_1 = __webpack_require__(408);
let ApiExpenseController = class ApiExpenseController {
    constructor(apiExpenseService) {
        this.apiExpenseService = apiExpenseService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiExpenseService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiExpenseService.getMany(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }) {
        const data = await this.apiExpenseService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        const data = await this.apiExpenseService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiExpenseService.updateOne({ oid, expenseId: id, body });
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiExpenseService.destroyOne({ oid, expenseId: id });
        return { data };
    }
};
exports.ApiExpenseController = ApiExpenseController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ExpensePaginationQuery !== "undefined" && request_1.ExpensePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiExpenseController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.ExpenseGetManyQuery !== "undefined" && request_1.ExpenseGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiExpenseController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiExpenseController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_EXPENSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ExpenseCreateBody !== "undefined" && request_1.ExpenseCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiExpenseController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_EXPENSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object, typeof (_q = typeof request_1.ExpenseUpdateBody !== "undefined" && request_1.ExpenseUpdateBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], ApiExpenseController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_EXPENSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], ApiExpenseController.prototype, "destroyOne", null);
exports.ApiExpenseController = ApiExpenseController = __decorate([
    (0, swagger_1.ApiTags)('Expense'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('expense'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_expense_service_1.ApiExpenseService !== "undefined" && api_expense_service_1.ApiExpenseService) === "function" ? _a : Object])
], ApiExpenseController);


/***/ }),
/* 407 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiExpenseService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const error_1 = __webpack_require__(14);
const expense_repository_1 = __webpack_require__(105);
let ApiExpenseService = class ApiExpenseService {
    constructor(expenseRepository) {
        this.expenseRepository = expenseRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.expenseRepository.pagination({
            page,
            limit,
            relation,
            condition: { oid },
            sort,
        });
        return { expenseList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.expenseRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { expenseList: data };
    }
    async getOne(oid, id) {
        const expense = await this.expenseRepository.findOneBy({ oid, id });
        if (!expense)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { expense };
    }
    async createOne(oid, body) {
        let code = body.code;
        if (!code) {
            const count = await this.expenseRepository.getMaxId();
            code = (count + 1).toString();
        }
        const existExpense = await this.expenseRepository.findOneBy({ oid, code });
        if (existExpense) {
            throw new error_1.BusinessError(`Trùng mã chi phí với ${existExpense.name}`);
        }
        const expense = await this.expenseRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({ oid }, body), { code }));
        return { expense };
    }
    async updateOne(options) {
        const { body, expenseId, oid } = options;
        if (body.code != null) {
            const existExpense = await this.expenseRepository.findOneBy({
                oid,
                code: body.code,
                id: { NOT: expenseId },
            });
            if (existExpense) {
                throw new error_1.BusinessError(`Trùng mã chi phí với ${existExpense.name}`);
            }
        }
        const expense = await this.expenseRepository.updateOneAndReturnEntity({ id: expenseId, oid }, body);
        return { expense };
    }
    async destroyOne(options) {
        const { oid, expenseId } = options;
        await this.expenseRepository.delete({ oid, id: expenseId });
        return { expenseId };
    }
};
exports.ApiExpenseService = ApiExpenseService;
exports.ApiExpenseService = ApiExpenseService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof expense_repository_1.ExpenseRepository !== "undefined" && expense_repository_1.ExpenseRepository) === "function" ? _a : Object])
], ApiExpenseService);


/***/ }),
/* 408 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(409), exports);
__exportStar(__webpack_require__(410), exports);
__exportStar(__webpack_require__(411), exports);


/***/ }),
/* 409 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ExpenseGetOneQuery = exports.ExpenseGetManyQuery = exports.ExpensePaginationQuery = exports.ExpenseGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const expense_options_request_1 = __webpack_require__(410);
class ExpenseGetQuery {
}
exports.ExpenseGetQuery = ExpenseGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(expense_options_request_1.ExpenseRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof expense_options_request_1.ExpenseRelationQuery !== "undefined" && expense_options_request_1.ExpenseRelationQuery) === "function" ? _a : Object)
], ExpenseGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(expense_options_request_1.ExpenseFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof expense_options_request_1.ExpenseFilterQuery !== "undefined" && expense_options_request_1.ExpenseFilterQuery) === "function" ? _b : Object)
], ExpenseGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(expense_options_request_1.ExpenseSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof expense_options_request_1.ExpenseSortQuery !== "undefined" && expense_options_request_1.ExpenseSortQuery) === "function" ? _c : Object)
], ExpenseGetQuery.prototype, "sort", void 0);
class ExpensePaginationQuery extends (0, swagger_1.IntersectionType)(ExpenseGetQuery, query_1.PaginationQuery) {
}
exports.ExpensePaginationQuery = ExpensePaginationQuery;
class ExpenseGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ExpenseGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ExpenseGetManyQuery = ExpenseGetManyQuery;
class ExpenseGetOneQuery extends (0, swagger_1.PickType)(ExpenseGetQuery, ['relation']) {
}
exports.ExpenseGetOneQuery = ExpenseGetOneQuery;


/***/ }),
/* 410 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ExpenseSortQuery = exports.ExpenseFilterQuery = exports.ExpenseRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class ExpenseRelationQuery {
}
exports.ExpenseRelationQuery = ExpenseRelationQuery;
class ExpenseFilterQuery {
}
exports.ExpenseFilterQuery = ExpenseFilterQuery;
class ExpenseSortQuery extends query_1.SortQuery {
}
exports.ExpenseSortQuery = ExpenseSortQuery;


/***/ }),
/* 411 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ExpenseUpdateBody = exports.ExpenseCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ExpenseCreateBody {
}
exports.ExpenseCreateBody = ExpenseCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ExpenseCreateBody.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Tiền mặt' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ExpenseCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ExpenseCreateBody.prototype, "isActive", void 0);
class ExpenseUpdateBody extends ExpenseCreateBody {
}
exports.ExpenseUpdateBody = ExpenseUpdateBody;


/***/ }),
/* 412 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiICDModule = void 0;
const common_1 = __webpack_require__(3);
const api_icd_controller_1 = __webpack_require__(413);
const api_icd_service_1 = __webpack_require__(414);
let ApiICDModule = class ApiICDModule {
};
exports.ApiICDModule = ApiICDModule;
exports.ApiICDModule = ApiICDModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_icd_controller_1.ApiICDController],
        providers: [api_icd_service_1.ApiICDService],
    })
], ApiICDModule);


/***/ }),
/* 413 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiICDController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(157);
const api_icd_service_1 = __webpack_require__(414);
const request_1 = __webpack_require__(415);
let ApiICDController = class ApiICDController {
    constructor(apiICDService) {
        this.apiICDService = apiICDService;
    }
    getAll() {
        return this.apiICDService.getAll();
    }
    list(body) {
        return this.apiICDService.replaceAll(body);
    }
};
exports.ApiICDController = ApiICDController;
__decorate([
    (0, common_1.Get)('all'),
    (0, user_guard_1.UserPermission)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiICDController.prototype, "getAll", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, root_guard_1.IsRoot)(),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.ICDReplaceAllBody !== "undefined" && request_1.ICDReplaceAllBody) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiICDController.prototype, "list", null);
exports.ApiICDController = ApiICDController = __decorate([
    (0, swagger_1.ApiTags)('ICD'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('icd'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_icd_service_1.ApiICDService !== "undefined" && api_icd_service_1.ApiICDService) === "function" ? _a : Object])
], ApiICDController);


/***/ }),
/* 414 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiICDService = void 0;
const common_1 = __webpack_require__(3);
const entities_1 = __webpack_require__(45);
const repositories_1 = __webpack_require__(42);
let ApiICDService = class ApiICDService {
    constructor(icdRepository) {
        this.icdRepository = icdRepository;
    }
    async getAll() {
        const icdAll = await this.icdRepository.findManyBy({});
        return { data: { icdAll } };
    }
    async replaceAll(body) {
        await this.icdRepository
            .getManager()
            .query(`TRUNCATE TABLE "${entities_1.ICD.name}" RESTART IDENTITY CASCADE;`);
        await this.icdRepository.insertMany(body.icdAll);
        return { data: true };
    }
};
exports.ApiICDService = ApiICDService;
exports.ApiICDService = ApiICDService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ICDRepository !== "undefined" && repositories_1.ICDRepository) === "function" ? _a : Object])
], ApiICDService);


/***/ }),
/* 415 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(416), exports);


/***/ }),
/* 416 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ICDReplaceAllBody = exports.ICDCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ICDCreateBody {
}
exports.ICDCreateBody = ICDCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ICDCreateBody.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ICDCreateBody.prototype, "name", void 0);
class ICDReplaceAllBody {
}
exports.ICDReplaceAllBody = ICDReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ICDCreateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ICDCreateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ICDReplaceAllBody.prototype, "icdAll", void 0);


/***/ }),
/* 417 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_group_service_1 = __webpack_require__(297);
const api_laboratory_group_controller_1 = __webpack_require__(418);
const api_laboratory_group_service_1 = __webpack_require__(276);
let ApiLaboratoryGroupModule = class ApiLaboratoryGroupModule {
};
exports.ApiLaboratoryGroupModule = ApiLaboratoryGroupModule;
exports.ApiLaboratoryGroupModule = ApiLaboratoryGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_group_controller_1.ApiLaboratoryGroupController],
        providers: [api_laboratory_group_service_1.ApiLaboratoryGroupService, api_radiology_group_service_1.ApiRadiologyGroupService],
    })
], ApiLaboratoryGroupModule);


/***/ }),
/* 418 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_laboratory_group_service_1 = __webpack_require__(276);
const request_1 = __webpack_require__(419);
let ApiLaboratoryGroupController = class ApiLaboratoryGroupController {
    constructor(apiLaboratoryGroupService) {
        this.apiLaboratoryGroupService = apiLaboratoryGroupService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratoryGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiLaboratoryGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiLaboratoryGroupService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiLaboratoryGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiLaboratoryGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiLaboratoryGroupService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiLaboratoryGroupService.replaceAll(oid, body);
    }
    async systemList() {
        return await this.apiLaboratoryGroupService.systemList();
    }
};
exports.ApiLaboratoryGroupController = ApiLaboratoryGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratoryGroupPaginationQuery !== "undefined" && request_1.LaboratoryGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratoryGroupGetManyQuery !== "undefined" && request_1.LaboratoryGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.LaboratoryGroupUpsertBody !== "undefined" && request_1.LaboratoryGroupUpsertBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.LaboratoryGroupUpsertBody !== "undefined" && request_1.LaboratoryGroupUpsertBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.LaboratoryGroupReplaceAllBody !== "undefined" && request_1.LaboratoryGroupReplaceAllBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiLaboratoryGroupController.prototype, "systemList", null);
exports.ApiLaboratoryGroupController = ApiLaboratoryGroupController = __decorate([
    (0, swagger_1.ApiTags)('LaboratoryGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_group_service_1.ApiLaboratoryGroupService !== "undefined" && api_laboratory_group_service_1.ApiLaboratoryGroupService) === "function" ? _a : Object])
], ApiLaboratoryGroupController);


/***/ }),
/* 419 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(420), exports);
__exportStar(__webpack_require__(421), exports);
__exportStar(__webpack_require__(422), exports);


/***/ }),
/* 420 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupGetOneQuery = exports.LaboratoryGroupGetManyQuery = exports.LaboratoryGroupPaginationQuery = exports.LaboratoryGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const laboratory_group_options_request_1 = __webpack_require__(421);
class LaboratoryGroupGetQuery {
}
exports.LaboratoryGroupGetQuery = LaboratoryGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_group_options_request_1.LaboratoryGroupRelationQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupRelationQuery) === "function" ? _a : Object)
], LaboratoryGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_group_options_request_1.LaboratoryGroupFilterQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupFilterQuery) === "function" ? _b : Object)
], LaboratoryGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_group_options_request_1.LaboratoryGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_group_options_request_1.LaboratoryGroupSortQuery !== "undefined" && laboratory_group_options_request_1.LaboratoryGroupSortQuery) === "function" ? _c : Object)
], LaboratoryGroupGetQuery.prototype, "sort", void 0);
class LaboratoryGroupPaginationQuery extends (0, swagger_1.IntersectionType)(LaboratoryGroupGetQuery, query_1.PaginationQuery) {
}
exports.LaboratoryGroupPaginationQuery = LaboratoryGroupPaginationQuery;
class LaboratoryGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratoryGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratoryGroupGetManyQuery = LaboratoryGroupGetManyQuery;
class LaboratoryGroupGetOneQuery extends (0, swagger_1.PickType)(LaboratoryGroupGetQuery, ['relation']) {
}
exports.LaboratoryGroupGetOneQuery = LaboratoryGroupGetOneQuery;


/***/ }),
/* 421 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupSortQuery = exports.LaboratoryGroupFilterQuery = exports.LaboratoryGroupRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class LaboratoryGroupRelationQuery {
}
exports.LaboratoryGroupRelationQuery = LaboratoryGroupRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryGroupRelationQuery.prototype, "printHtml", void 0);
class LaboratoryGroupFilterQuery {
}
exports.LaboratoryGroupFilterQuery = LaboratoryGroupFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupFilterQuery.prototype, "printHtmlId", void 0);
class LaboratoryGroupSortQuery extends query_1.SortQuery {
}
exports.LaboratoryGroupSortQuery = LaboratoryGroupSortQuery;


/***/ }),
/* 422 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGroupReplaceAllBody = exports.LaboratoryGroupUpsertBody = exports.LaboratoryGroupBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class LaboratoryGroupBody {
}
exports.LaboratoryGroupBody = LaboratoryGroupBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], LaboratoryGroupBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], LaboratoryGroupBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryGroupBody.prototype, "roomId", void 0);
class LaboratoryGroupUpsertBody extends (0, swagger_1.OmitType)(LaboratoryGroupBody, ['id']) {
}
exports.LaboratoryGroupUpsertBody = LaboratoryGroupUpsertBody;
class LaboratoryGroupReplaceAllBody {
}
exports.LaboratoryGroupReplaceAllBody = LaboratoryGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryGroupBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryGroupBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryGroupReplaceAllBody.prototype, "laboratoryGroupReplaceAll", void 0);


/***/ }),
/* 423 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratorySampleModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_sample_controller_1 = __webpack_require__(424);
const api_laboratory_sample_service_1 = __webpack_require__(425);
let ApiLaboratorySampleModule = class ApiLaboratorySampleModule {
};
exports.ApiLaboratorySampleModule = ApiLaboratorySampleModule;
exports.ApiLaboratorySampleModule = ApiLaboratorySampleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_sample_controller_1.ApiLaboratorySampleController],
        providers: [api_laboratory_sample_service_1.ApiLaboratorySampleService],
    })
], ApiLaboratorySampleModule);


/***/ }),
/* 424 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratorySampleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_laboratory_sample_service_1 = __webpack_require__(425);
const request_1 = __webpack_require__(426);
let ApiLaboratorySampleController = class ApiLaboratorySampleController {
    constructor(apiLaboratorySampleService) {
        this.apiLaboratorySampleService = apiLaboratorySampleService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratorySampleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiLaboratorySampleService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiLaboratorySampleService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiLaboratorySampleService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiLaboratorySampleService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiLaboratorySampleService.destroyOne(oid, id);
    }
};
exports.ApiLaboratorySampleController = ApiLaboratorySampleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratorySamplePaginationQuery !== "undefined" && request_1.LaboratorySamplePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratorySampleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratorySampleGetManyQuery !== "undefined" && request_1.LaboratorySampleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratorySampleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratorySampleController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.LaboratorySampleCreateBody !== "undefined" && request_1.LaboratorySampleCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratorySampleController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.LaboratorySampleUpdateBody !== "undefined" && request_1.LaboratorySampleUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratorySampleController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratorySampleController.prototype, "destroyOne", null);
exports.ApiLaboratorySampleController = ApiLaboratorySampleController = __decorate([
    (0, swagger_1.ApiTags)('LaboratorySample'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory-sample'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_sample_service_1.ApiLaboratorySampleService !== "undefined" && api_laboratory_sample_service_1.ApiLaboratorySampleService) === "function" ? _a : Object])
], ApiLaboratorySampleController);


/***/ }),
/* 425 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratorySampleService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const laboratory_sample_repository_1 = __webpack_require__(109);
let ApiLaboratorySampleService = class ApiLaboratorySampleService {
    constructor(laboratorySampleRepository) {
        this.laboratorySampleRepository = laboratorySampleRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.laboratorySampleRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratorySampleRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
            sort,
        });
        return { data };
    }
    async getOne(oid, id) {
        const laboratorySample = await this.laboratorySampleRepository.findOneBy({ oid, id });
        if (!laboratorySample)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { laboratorySample } };
    }
    async createOne(oid, body) {
        const laboratorySample = await this.laboratorySampleRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { laboratorySample } };
    }
    async updateOne(oid, id, body) {
        const laboratorySampleList = await this.laboratorySampleRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { laboratorySample: laboratorySampleList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.laboratorySampleRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiLaboratorySampleService = ApiLaboratorySampleService;
exports.ApiLaboratorySampleService = ApiLaboratorySampleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof laboratory_sample_repository_1.LaboratorySampleRepository !== "undefined" && laboratory_sample_repository_1.LaboratorySampleRepository) === "function" ? _a : Object])
], ApiLaboratorySampleService);


/***/ }),
/* 426 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(427), exports);
__exportStar(__webpack_require__(428), exports);
__exportStar(__webpack_require__(429), exports);


/***/ }),
/* 427 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySampleGetOneQuery = exports.LaboratorySampleGetManyQuery = exports.LaboratorySamplePaginationQuery = exports.LaboratorySampleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const laboratory_sample_options_request_1 = __webpack_require__(428);
class LaboratorySampleGetQuery {
}
exports.LaboratorySampleGetQuery = LaboratorySampleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_sample_options_request_1.LaboratorySampleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_sample_options_request_1.LaboratorySampleRelationQuery !== "undefined" && laboratory_sample_options_request_1.LaboratorySampleRelationQuery) === "function" ? _a : Object)
], LaboratorySampleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_sample_options_request_1.LaboratorySampleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_sample_options_request_1.LaboratorySampleFilterQuery !== "undefined" && laboratory_sample_options_request_1.LaboratorySampleFilterQuery) === "function" ? _b : Object)
], LaboratorySampleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_sample_options_request_1.LaboratorySampleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_sample_options_request_1.LaboratorySampleSortQuery !== "undefined" && laboratory_sample_options_request_1.LaboratorySampleSortQuery) === "function" ? _c : Object)
], LaboratorySampleGetQuery.prototype, "sort", void 0);
class LaboratorySamplePaginationQuery extends (0, swagger_1.IntersectionType)(LaboratorySampleGetQuery, query_1.PaginationQuery) {
}
exports.LaboratorySamplePaginationQuery = LaboratorySamplePaginationQuery;
class LaboratorySampleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratorySampleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratorySampleGetManyQuery = LaboratorySampleGetManyQuery;
class LaboratorySampleGetOneQuery extends (0, swagger_1.PickType)(LaboratorySampleGetQuery, ['relation']) {
}
exports.LaboratorySampleGetOneQuery = LaboratorySampleGetOneQuery;


/***/ }),
/* 428 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySampleSortQuery = exports.LaboratorySampleFilterQuery = exports.LaboratorySampleRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class LaboratorySampleRelationQuery {
}
exports.LaboratorySampleRelationQuery = LaboratorySampleRelationQuery;
class LaboratorySampleFilterQuery {
}
exports.LaboratorySampleFilterQuery = LaboratorySampleFilterQuery;
class LaboratorySampleSortQuery extends query_1.SortQuery {
}
exports.LaboratorySampleSortQuery = LaboratorySampleSortQuery;


/***/ }),
/* 429 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySampleUpdateBody = exports.LaboratorySampleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class LaboratorySampleCreateBody {
}
exports.LaboratorySampleCreateBody = LaboratorySampleCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratorySampleCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], LaboratorySampleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratorySampleCreateBody.prototype, "laboratoryIds", void 0);
class LaboratorySampleUpdateBody extends (0, swagger_1.PartialType)(LaboratorySampleCreateBody) {
}
exports.LaboratorySampleUpdateBody = LaboratorySampleUpdateBody;


/***/ }),
/* 430 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_laboratory_group_service_1 = __webpack_require__(276);
const api_laboratory_controller_1 = __webpack_require__(431);
const api_laboratory_service_1 = __webpack_require__(432);
let ApiLaboratoryModule = class ApiLaboratoryModule {
};
exports.ApiLaboratoryModule = ApiLaboratoryModule;
exports.ApiLaboratoryModule = ApiLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_laboratory_controller_1.ApiLaboratoryController],
        providers: [api_laboratory_service_1.ApiLaboratoryService, api_laboratory_group_service_1.ApiLaboratoryGroupService],
    })
], ApiLaboratoryModule);


/***/ }),
/* 431 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_laboratory_service_1 = __webpack_require__(432);
const request_1 = __webpack_require__(433);
let ApiLaboratoryController = class ApiLaboratoryController {
    constructor(apiLaboratoryService) {
        this.apiLaboratoryService = apiLaboratoryService;
    }
    pagination({ oid }, query) {
        return this.apiLaboratoryService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiLaboratoryService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiLaboratoryService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiLaboratoryService.create(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiLaboratoryService.update(oid, id, body);
    }
    async destroy({ oid }, { id }) {
        return await this.apiLaboratoryService.destroy(oid, id);
    }
    async systemList() {
        return await this.apiLaboratoryService.systemList();
    }
    async systemCopy({ oid }, body) {
        return await this.apiLaboratoryService.systemCopy(oid, body);
    }
};
exports.ApiLaboratoryController = ApiLaboratoryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.LaboratoryPaginationQuery !== "undefined" && request_1.LaboratoryPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiLaboratoryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.LaboratoryGetManyQuery !== "undefined" && request_1.LaboratoryGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.LaboratoryGetOneQuery !== "undefined" && request_1.LaboratoryGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.LaboratoryCreateBody !== "undefined" && request_1.LaboratoryCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.LaboratoryUpdateBody !== "undefined" && request_1.LaboratoryUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "destroy", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.LABORATORY),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "systemList", null);
__decorate([
    (0, common_1.Post)('system-copy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.LABORATORY_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.LaboratorySystemCopyBody !== "undefined" && request_1.LaboratorySystemCopyBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiLaboratoryController.prototype, "systemCopy", null);
exports.ApiLaboratoryController = ApiLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('Laboratory'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_laboratory_service_1.ApiLaboratoryService !== "undefined" && api_laboratory_service_1.ApiLaboratoryService) === "function" ? _a : Object])
], ApiLaboratoryController);


/***/ }),
/* 432 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const error_1 = __webpack_require__(14);
const discount_entity_1 = __webpack_require__(77);
const laboratory_entity_1 = __webpack_require__(66);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const laboratory_repository_1 = __webpack_require__(110);
const ticket_laboratory_repository_1 = __webpack_require__(141);
const socket_emit_service_1 = __webpack_require__(340);
const api_laboratory_group_service_1 = __webpack_require__(276);
let ApiLaboratoryService = class ApiLaboratoryService {
    constructor(socketEmitService, laboratoryRepository, laboratoryGroupRepository, ticketLaboratoryRepository, positionRepository, discountRepository, apiLaboratoryGroupService) {
        this.socketEmitService = socketEmitService;
        this.laboratoryRepository = laboratoryRepository;
        this.laboratoryGroupRepository = laboratoryGroupRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.positionRepository = positionRepository;
        this.discountRepository = discountRepository;
        this.apiLaboratoryGroupService = apiLaboratoryGroupService;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.laboratoryRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                laboratoryGroupId: filter === null || filter === void 0 ? void 0 : filter.laboratoryGroupId,
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                parentId: filter === null || filter === void 0 ? void 0 : filter.parentId,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, laboratoryList: data, relation: query.relation });
        }
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.laboratoryRepository.findMany({
            condition: {
                oid,
                laboratoryGroupId: filter === null || filter === void 0 ? void 0 : filter.laboratoryGroupId,
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                parentId: filter === null || filter === void 0 ? void 0 : filter.parentId,
            },
            sort,
            limit,
        });
        if (query.relation) {
            await this.generateRelation({ oid, laboratoryList: data, relation: query.relation });
        }
        return { data };
    }
    async getOne(oid, id, query) {
        var _a, _b;
        const laboratory = await this.laboratoryRepository.findOne({
            relation: {
                laboratoryGroup: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.laboratoryGroup,
            },
            condition: { oid, id },
        });
        if (!laboratory)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation({ oid, laboratoryList: [laboratory], relation: query.relation });
        }
        if ((_b = query === null || query === void 0 ? void 0 : query.relation) === null || _b === void 0 ? void 0 : _b.children) {
            if (laboratory.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
                laboratory.children = await this.laboratoryRepository.findMany({
                    condition: {
                        oid,
                        parentId: laboratory.id,
                        level: 2,
                    },
                    sort: { priority: 'ASC' },
                });
            }
        }
        return { data: { laboratory } };
    }
    async create(oid, body) {
        const { laboratory: laboratoryBody, laboratoryChildren, discountList, positionList } = body;
        let laboratoryCode = laboratoryBody.laboratoryCode;
        let maxId = await this.laboratoryRepository.getMaxId();
        maxId++;
        if (!laboratoryCode) {
            laboratoryCode = maxId.toString();
        }
        const existLaboratory = await this.laboratoryRepository.findOneBy({
            oid,
            laboratoryCode,
        });
        if (existLaboratory) {
            throw new error_1.BusinessError(`Trùng mã xét nghiệm với ${existLaboratory.name}`);
        }
        const laboratoryParentId = await this.laboratoryRepository.insertOneFullField(Object.assign(Object.assign({}, laboratoryBody), { oid, level: 1, parentId: 0, laboratoryCode }));
        const laboratoryParent = await this.laboratoryRepository.updateOneAndReturnEntity({ oid, id: laboratoryParentId }, { parentId: laboratoryParentId });
        if (laboratoryParent.valueType === laboratory_entity_1.LaboratoryValueType.Children && laboratoryChildren.length) {
            const childrenDto = laboratoryChildren.map((i) => {
                maxId++;
                const childDto = Object.assign(Object.assign({}, i), { oid, laboratoryGroupId: laboratoryParent.laboratoryGroupId, level: 2, parentId: laboratoryParent.id, laboratoryCode: maxId.toString() });
                return childDto;
            });
            laboratoryParent.children =
                await this.laboratoryRepository.insertManyFullFieldAndReturnEntity(childrenDto);
        }
        this.socketEmitService.laboratoryListChange(oid, { laboratoryUpsertedList: [laboratoryParent] });
        if (positionList === null || positionList === void 0 ? void 0 : positionList.length) {
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: laboratoryParent.id,
                    positionType: position_entity_1.PositionInteractType.Laboratory,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            laboratoryParent.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, {
                positionUpsertedList,
            });
        }
        if (discountList === null || discountList === void 0 ? void 0 : discountList.length) {
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: laboratoryParent.id, discountInteractType: discount_entity_1.DiscountInteractType.Laboratory, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            laboratoryParent.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, { discountUpsertedList });
        }
        return { data: { laboratory: laboratoryParent } };
    }
    async update(oid, laboratoryId, body) {
        const { laboratory: laboratoryBody, laboratoryChildren, discountList, positionList } = body;
        const laboratoryOrigin = await this.laboratoryRepository.findOneBy({ oid, id: laboratoryId });
        if (!laboratoryOrigin) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (laboratoryOrigin.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
            if (laboratoryBody.valueType !== laboratory_entity_1.LaboratoryValueType.Children) {
                await this.laboratoryRepository.delete({
                    oid,
                    level: 2,
                    parentId: laboratoryId,
                });
            }
        }
        if (laboratoryBody.laboratoryCode != null) {
            const existLaboratory = await this.laboratoryRepository.findOneBy({
                oid,
                laboratoryCode: laboratoryBody.laboratoryCode,
                id: { NOT: laboratoryId },
            });
            if (existLaboratory) {
                throw new error_1.BusinessError(`Trùng mã xét nghiệm với ${existLaboratory.name}`);
            }
        }
        const laboratoryParent = await this.laboratoryRepository.updateOneAndReturnEntity({ oid, id: laboratoryId }, laboratoryBody);
        if (laboratoryParent.valueType === laboratory_entity_1.LaboratoryValueType.Children) {
            await this.laboratoryRepository.delete({
                oid,
                parentId: laboratoryId,
                level: 2,
            });
            let maxId = await this.laboratoryRepository.getMaxId();
            const laboratoryChildrenCreate = laboratoryChildren.map((i) => {
                maxId++;
                const dto = Object.assign(Object.assign({}, laboratoryBody), { oid, level: 2, parentId: laboratoryId, laboratoryGroupId: laboratoryParent.laboratoryGroupId, laboratoryCode: maxId.toString() });
                return dto;
            });
            await this.laboratoryRepository.insertManyFullFieldAndReturnEntity(laboratoryChildrenCreate);
        }
        this.socketEmitService.laboratoryListChange(oid, { laboratoryUpsertedList: [laboratoryParent] });
        if (positionList) {
            const positionDestroyedList = await this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: laboratoryId,
                positionType: position_entity_1.PositionInteractType.Laboratory,
            });
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: laboratoryId,
                    positionType: position_entity_1.PositionInteractType.Laboratory,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            laboratoryParent.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, {
                positionUpsertedList,
                positionDestroyedList,
            });
        }
        if (discountList) {
            const discountDestroyedList = await this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: laboratoryId,
                discountInteractType: discount_entity_1.DiscountInteractType.Laboratory,
            });
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: laboratoryId, discountInteractType: discount_entity_1.DiscountInteractType.Laboratory, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            laboratoryParent.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, {
                discountUpsertedList,
                discountDestroyedList,
            });
        }
        return { data: { laboratory: laboratoryParent } };
    }
    async destroy(oid, laboratoryId) {
        const ticketLaboratoryList = await this.ticketLaboratoryRepository.findMany({
            condition: { oid, laboratoryId },
            limit: 10,
        });
        if (ticketLaboratoryList.length > 0) {
            return {
                data: { ticketLaboratoryList },
                success: false,
            };
        }
        const [positionDestroyedList, discountDestroyedList] = await Promise.all([
            this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: laboratoryId,
                positionType: position_entity_1.PositionInteractType.Laboratory,
            }),
            this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: laboratoryId,
                discountInteractType: discount_entity_1.DiscountInteractType.Laboratory,
            }),
        ]);
        if (positionDestroyedList.length) {
            this.socketEmitService.positionListChange(oid, { positionDestroyedList });
        }
        if (discountDestroyedList.length) {
            this.socketEmitService.discountListChange(oid, { discountDestroyedList });
        }
        const laboratoryDestroyedList = await this.laboratoryRepository.deleteAndReturnEntity({
            oid,
            parentId: laboratoryId,
        });
        this.socketEmitService.laboratoryListChange(oid, { laboratoryDestroyedList });
        return { data: { ticketLaboratoryList: [], laboratoryId } };
    }
    async systemList() {
        const data = await this.laboratoryRepository.findMany({
            condition: { oid: 1 },
            sort: { priority: 'ASC' },
        });
        return { data };
    }
    async systemCopy(oid, body) {
        const laboratorySystemList = await this.laboratoryRepository.findMany({
            relation: { laboratoryGroup: true },
            condition: { oid: 1, parentId: { IN: body.laboratoryIdList } },
            sort: { priority: 'ASC' },
        });
        const laboratoryParentSystemList = laboratorySystemList.filter((i) => i.level === 1);
        const laboratoryParentSystemMap = (0, array_helper_1.arrayToKeyValue)(laboratoryParentSystemList, 'id');
        laboratorySystemList.forEach((i) => {
            var _a;
            if (!laboratoryParentSystemMap[i.parentId].children) {
                laboratoryParentSystemMap[i.parentId].children = [];
            }
            if (i.level === 2) {
                (_a = laboratoryParentSystemMap[i.parentId].children) === null || _a === void 0 ? void 0 : _a.push(i);
            }
        });
        const groupNameList = laboratoryParentSystemList.map((i) => { var _a; return ((_a = i.laboratoryGroup) === null || _a === void 0 ? void 0 : _a.name) || ''; });
        const laboratoryGroupList = await this.apiLaboratoryGroupService.createByGroupName(oid, groupNameList);
        const laboratoryGroupMapName = array_helper_1.ESArray.arrayToKeyValue(laboratoryGroupList, 'name');
        let maxId = await this.laboratoryRepository.getMaxId();
        const laboratoryParentInsertList = laboratoryParentSystemList.map((i) => {
            var _a, _b;
            let laboratoryGroupId = 0;
            const laboratoryGroupName = (_a = i.laboratoryGroup) === null || _a === void 0 ? void 0 : _a.name;
            if (laboratoryGroupName) {
                laboratoryGroupId = ((_b = laboratoryGroupMapName[laboratoryGroupName]) === null || _b === void 0 ? void 0 : _b.id) || 0;
            }
            maxId++;
            const dto = {
                oid,
                name: i.name,
                costPrice: i.costPrice,
                price: i.price,
                laboratoryGroupId,
                level: i.level,
                valueType: i.valueType,
                lowValue: i.lowValue,
                highValue: i.highValue,
                unit: i.unit,
                options: i.options,
                parentId: 0,
                priority: 0,
                laboratoryCode: maxId.toString(),
            };
            return dto;
        });
        const laboratoryParentCreatedList = await this.laboratoryRepository.insertManyAndReturnEntity(laboratoryParentInsertList);
        await this.laboratoryRepository.update({ id: { IN: laboratoryParentCreatedList.map((i) => i.id) } }, {
            parentId: () => `"id"`,
            priority: () => `"id"`,
        });
        const laboratoryChildInsertList = laboratoryParentSystemList
            .map((i, index) => {
            i.children.forEach((c, j) => {
                const lp = laboratoryParentCreatedList[index];
                c.parentId = lp.id;
                c.laboratoryGroupId = lp.laboratoryGroupId;
                c.priority = j + 1;
            });
            return i.children;
        })
            .flat()
            .map((i) => {
            maxId++;
            const dto = {
                oid,
                name: i.name,
                price: i.price,
                costPrice: i.costPrice,
                laboratoryGroupId: i.laboratoryGroupId,
                level: i.level,
                valueType: i.valueType,
                lowValue: i.lowValue,
                highValue: i.highValue,
                unit: i.unit,
                options: i.options,
                parentId: i.parentId,
                priority: i.priority,
                laboratoryCode: maxId.toString(),
            };
            return dto;
        });
        await this.laboratoryRepository.insertMany(laboratoryChildInsertList);
        return { data: true };
    }
    async generateRelation(options) {
        const { oid, laboratoryList, relation } = options;
        const laboratoryIdList = array_helper_1.ESArray.uniqueArray(laboratoryList.map((i) => i.id));
        const laboratoryGroupIdList = array_helper_1.ESArray.uniqueArray(laboratoryList.map((i) => i.laboratoryGroupId));
        const [positionList, discountList, laboratoryGroupList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.positionList) && laboratoryIdList.length
                ? this.positionRepository.findManyBy({
                    oid,
                    positionType: position_entity_1.PositionInteractType.Laboratory,
                    positionInteractId: { IN: laboratoryIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.discountList) && laboratoryIdList.length
                ? this.discountRepository.findManyBy({
                    oid,
                    discountInteractType: discount_entity_1.DiscountInteractType.Laboratory,
                    discountInteractId: { IN: [...laboratoryIdList, 0] },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.laboratoryGroup) && laboratoryGroupIdList.length
                ? this.laboratoryGroupRepository.findManyBy({
                    oid,
                    id: { IN: laboratoryGroupIdList },
                })
                : [],
        ]);
        const laboratoryGroupMap = array_helper_1.ESArray.arrayToKeyValue(laboratoryGroupList, 'id');
        laboratoryList.forEach((laboratory) => {
            if (relation === null || relation === void 0 ? void 0 : relation.positionList) {
                laboratory.positionList = positionList.filter((i) => i.positionInteractId === laboratory.id);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.discountList) {
                laboratory.discountList = discountList.filter((i) => i.discountInteractId === laboratory.id);
                laboratory.discountListExtra = discountList.filter((i) => i.discountInteractId === 0);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.laboratoryGroup) {
                laboratory.laboratoryGroup = laboratoryGroupMap[laboratory.laboratoryGroupId];
            }
        });
        return laboratoryList;
    }
};
exports.ApiLaboratoryService = ApiLaboratoryService;
exports.ApiLaboratoryService = ApiLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof laboratory_repository_1.LaboratoryRepository !== "undefined" && laboratory_repository_1.LaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.LaboratoryGroupRepository !== "undefined" && repositories_1.LaboratoryGroupRepository) === "function" ? _c : Object, typeof (_d = typeof ticket_laboratory_repository_1.TicketLaboratoryRepository !== "undefined" && ticket_laboratory_repository_1.TicketLaboratoryRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.PositionRepository !== "undefined" && repositories_1.PositionRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.DiscountRepository !== "undefined" && repositories_1.DiscountRepository) === "function" ? _f : Object, typeof (_g = typeof api_laboratory_group_service_1.ApiLaboratoryGroupService !== "undefined" && api_laboratory_group_service_1.ApiLaboratoryGroupService) === "function" ? _g : Object])
], ApiLaboratoryService);


/***/ }),
/* 433 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(434), exports);
__exportStar(__webpack_require__(435), exports);
__exportStar(__webpack_require__(436), exports);
__exportStar(__webpack_require__(437), exports);


/***/ }),
/* 434 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryGetOneQuery = exports.LaboratoryGetManyQuery = exports.LaboratoryPaginationQuery = exports.LaboratoryGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const laboratory_options_request_1 = __webpack_require__(435);
class LaboratoryGetQuery {
}
exports.LaboratoryGetQuery = LaboratoryGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratoryRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof laboratory_options_request_1.LaboratoryRelationQuery !== "undefined" && laboratory_options_request_1.LaboratoryRelationQuery) === "function" ? _a : Object)
], LaboratoryGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ level: 1 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratoryFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof laboratory_options_request_1.LaboratoryFilterQuery !== "undefined" && laboratory_options_request_1.LaboratoryFilterQuery) === "function" ? _b : Object)
], LaboratoryGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(laboratory_options_request_1.LaboratorySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof laboratory_options_request_1.LaboratorySortQuery !== "undefined" && laboratory_options_request_1.LaboratorySortQuery) === "function" ? _c : Object)
], LaboratoryGetQuery.prototype, "sort", void 0);
class LaboratoryPaginationQuery extends (0, swagger_1.IntersectionType)(LaboratoryGetQuery, query_1.PaginationQuery) {
}
exports.LaboratoryPaginationQuery = LaboratoryPaginationQuery;
class LaboratoryGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(LaboratoryGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.LaboratoryGetManyQuery = LaboratoryGetManyQuery;
class LaboratoryGetOneQuery extends (0, swagger_1.PickType)(LaboratoryGetQuery, ['relation']) {
}
exports.LaboratoryGetOneQuery = LaboratoryGetOneQuery;


/***/ }),
/* 435 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySortQuery = exports.LaboratoryFilterQuery = exports.LaboratoryRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class LaboratoryRelationQuery {
}
exports.LaboratoryRelationQuery = LaboratoryRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "laboratoryGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "children", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], LaboratoryRelationQuery.prototype, "discountList", void 0);
class LaboratoryFilterQuery {
}
exports.LaboratoryFilterQuery = LaboratoryFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryFilterQuery.prototype, "parentId", void 0);
class LaboratorySortQuery extends query_1.SortQuery {
}
exports.LaboratorySortQuery = LaboratorySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], LaboratorySortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], LaboratorySortQuery.prototype, "laboratoryCode", void 0);


/***/ }),
/* 436 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratorySystemCopyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class LaboratorySystemCopyBody {
}
exports.LaboratorySystemCopyBody = LaboratorySystemCopyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], LaboratorySystemCopyBody.prototype, "laboratoryIdList", void 0);


/***/ }),
/* 437 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LaboratoryUpdateBody = exports.LaboratoryCreateBody = exports.LaboratoryChildUpdate = exports.LaboratoryChildCreate = exports.LaboratoryParentUpsert = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const laboratory_entity_1 = __webpack_require__(66);
const request_1 = __webpack_require__(394);
const request_2 = __webpack_require__(438);
class LaboratoryParentUpsert {
}
exports.LaboratoryParentUpsert = LaboratoryParentUpsert;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "laboratoryCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'GOT' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "lowValue", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], LaboratoryParentUpsert.prototype, "highValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: laboratory_entity_1.LaboratoryValueType, example: laboratory_entity_1.LaboratoryValueType.Number }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(laboratory_entity_1.LaboratoryValueType),
    __metadata("design:type", typeof (_a = typeof laboratory_entity_1.LaboratoryValueType !== "undefined" && laboratory_entity_1.LaboratoryValueType) === "function" ? _a : Object)
], LaboratoryParentUpsert.prototype, "valueType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mg/l' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "unit", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mg/l' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryParentUpsert.prototype, "options", void 0);
class LaboratoryChildCreate extends (0, swagger_1.OmitType)(LaboratoryParentUpsert, [
    'laboratoryGroupId',
]) {
}
exports.LaboratoryChildCreate = LaboratoryChildCreate;
class LaboratoryChildUpdate extends (0, swagger_1.OmitType)(LaboratoryParentUpsert, ['laboratoryGroupId']) {
}
exports.LaboratoryChildUpdate = LaboratoryChildUpdate;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryChildUpdate.prototype, "id", void 0);
class LaboratoryCreateBody {
}
exports.LaboratoryCreateBody = LaboratoryCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryParentUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryParentUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", LaboratoryParentUpsert)
], LaboratoryCreateBody.prototype, "laboratory", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryChildCreate, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryChildCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryCreateBody.prototype, "laboratoryChildren", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryCreateBody.prototype, "discountList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryCreateBody.prototype, "positionList", void 0);
class LaboratoryUpdateBody {
}
exports.LaboratoryUpdateBody = LaboratoryUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryParentUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryParentUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", LaboratoryParentUpsert)
], LaboratoryUpdateBody.prototype, "laboratory", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryChildUpdate, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryChildUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryUpdateBody.prototype, "laboratoryChildren", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryUpdateBody.prototype, "discountList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], LaboratoryUpdateBody.prototype, "positionList", void 0);


/***/ }),
/* 438 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(439), exports);
__exportStar(__webpack_require__(440), exports);
__exportStar(__webpack_require__(441), exports);


/***/ }),
/* 439 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PositionGetOneQuery = exports.PositionGetManyQuery = exports.PositionPaginationQuery = exports.PositionGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const position_entity_1 = __webpack_require__(76);
const position_options_request_1 = __webpack_require__(440);
class PositionGetQuery {
}
exports.PositionGetQuery = PositionGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(position_options_request_1.PositionRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof position_options_request_1.PositionRelationQuery !== "undefined" && position_options_request_1.PositionRelationQuery) === "function" ? _a : Object)
], PositionGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            positionType: position_entity_1.PositionInteractType.Ticket,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(position_options_request_1.PositionFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof position_options_request_1.PositionFilterQuery !== "undefined" && position_options_request_1.PositionFilterQuery) === "function" ? _b : Object)
], PositionGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(position_options_request_1.PositionSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof position_options_request_1.PositionSortQuery !== "undefined" && position_options_request_1.PositionSortQuery) === "function" ? _c : Object)
], PositionGetQuery.prototype, "sort", void 0);
class PositionPaginationQuery extends (0, swagger_1.IntersectionType)(PositionGetQuery, query_1.PaginationQuery) {
}
exports.PositionPaginationQuery = PositionPaginationQuery;
class PositionGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PositionGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PositionGetManyQuery = PositionGetManyQuery;
class PositionGetOneQuery extends (0, swagger_1.PickType)(PositionGetQuery, ['relation']) {
}
exports.PositionGetOneQuery = PositionGetOneQuery;


/***/ }),
/* 440 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PositionSortQuery = exports.PositionFilterQuery = exports.PositionRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const position_entity_1 = __webpack_require__(76);
const ConditionEnumPositionInteractType = (0, dto_1.createConditionEnum)(position_entity_1.PositionInteractType);
class PositionRelationQuery {
}
exports.PositionRelationQuery = PositionRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PositionRelationQuery.prototype, "role", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PositionRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PositionRelationQuery.prototype, "procedure", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PositionRelationQuery.prototype, "laboratory", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PositionRelationQuery.prototype, "radiology", void 0);
class PositionFilterQuery {
}
exports.PositionFilterQuery = PositionFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, position_entity_1.PositionInteractType)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], PositionFilterQuery.prototype, "positionType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PositionFilterQuery.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], PositionFilterQuery.prototype, "positionInteractId", void 0);
class PositionSortQuery extends query_1.SortQuery {
}
exports.PositionSortQuery = PositionSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PositionSortQuery.prototype, "positionType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PositionSortQuery.prototype, "roleId", void 0);


/***/ }),
/* 441 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PositionBasicBody = exports.PositionReplaceListBody = exports.PositionUpdateBody = exports.PositionCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const position_entity_1 = __webpack_require__(76);
const position_options_request_1 = __webpack_require__(440);
class PositionCreateBody {
}
exports.PositionCreateBody = PositionCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PositionCreateBody.prototype, "roleId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: position_entity_1.PositionInteractType, example: position_entity_1.PositionInteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.PositionInteractType),
    __metadata("design:type", typeof (_a = typeof position_entity_1.PositionInteractType !== "undefined" && position_entity_1.PositionInteractType) === "function" ? _a : Object)
], PositionCreateBody.prototype, "positionType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PositionCreateBody.prototype, "positionInteractId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PositionCreateBody.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        enum: (0, typescript_helper_1.valuesEnum)(position_entity_1.CommissionCalculatorType),
        example: position_entity_1.CommissionCalculatorType.VND,
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_b = typeof position_entity_1.CommissionCalculatorType !== "undefined" && position_entity_1.CommissionCalculatorType) === "function" ? _b : Object)
], PositionCreateBody.prototype, "commissionCalculatorType", void 0);
class PositionUpdateBody extends (0, swagger_1.PartialType)(PositionCreateBody) {
}
exports.PositionUpdateBody = PositionUpdateBody;
class PositionReplaceListBody {
}
exports.PositionReplaceListBody = PositionReplaceListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: PositionCreateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => PositionCreateBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], PositionReplaceListBody.prototype, "positionData", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: position_options_request_1.PositionFilterQuery }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => position_options_request_1.PositionFilterQuery),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof position_options_request_1.PositionFilterQuery !== "undefined" && position_options_request_1.PositionFilterQuery) === "function" ? _c : Object)
], PositionReplaceListBody.prototype, "filter", void 0);
let ValidateCommissionValue = class ValidateCommissionValue {
    validate(val, args) {
        const object = args.object;
        if (object.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentActual
            || object.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentExpected) {
            if (val < 0 || val > 100)
                return false;
        }
        return true;
    }
    defaultMessage(args) {
        return 'Giá trị tiền hoa hồng = $value là không hợp lệ';
    }
};
ValidateCommissionValue = __decorate([
    (0, class_validator_1.ValidatorConstraint)({ name: 'validateCommissionValue', async: false })
], ValidateCommissionValue);
class PositionBasicBody {
}
exports.PositionBasicBody = PositionBasicBody;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], PositionBasicBody.prototype, "roleId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Validate)(ValidateCommissionValue),
    __metadata("design:type", Number)
], PositionBasicBody.prototype, "commissionValue", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: position_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_d = typeof position_entity_1.CommissionCalculatorType !== "undefined" && position_entity_1.CommissionCalculatorType) === "function" ? _d : Object)
], PositionBasicBody.prototype, "commissionCalculatorType", void 0);


/***/ }),
/* 442 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationModule = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const jwt_config_1 = __webpack_require__(161);
const environments_1 = __webpack_require__(30);
const email_module_1 = __webpack_require__(233);
const api_organization_controller_1 = __webpack_require__(443);
const api_organization_service_1 = __webpack_require__(445);
let ApiOrganizationModule = class ApiOrganizationModule {
};
exports.ApiOrganizationModule = ApiOrganizationModule;
exports.ApiOrganizationModule = ApiOrganizationModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forFeature(jwt_config_1.JwtConfig),
            config_1.ConfigModule.forFeature(environments_1.GlobalConfig),
            email_module_1.EmailModule,
        ],
        controllers: [api_organization_controller_1.ApiOrganizationController],
        providers: [api_organization_service_1.ApiOrganizationService],
    })
], ApiOrganizationModule);


/***/ }),
/* 443 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const fastify_1 = __webpack_require__(444);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_organization_service_1 = __webpack_require__(445);
const request_1 = __webpack_require__(446);
let ApiOrganizationController = class ApiOrganizationController {
    constructor(apiOrganizationService) {
        this.apiOrganizationService = apiOrganizationService;
    }
    async info({ oid }) {
        return await this.apiOrganizationService.getInfo(oid);
    }
    async updateInfoAndLogo({ oid }, files, body) {
        return await this.apiOrganizationService.updateInfo({ oid, body, files });
    }
    async changeEmail({ oid }, body) {
        return await this.apiOrganizationService.changeEmail(oid, body.email);
    }
    async sendEmailVerifyOrganizationEmail({ oid }) {
        return await this.apiOrganizationService.sendEmailVerifyOrganizationEmail(oid);
    }
    async verifyOrganizationEmail(reply, query) {
        await this.apiOrganizationService.verifyOrganizationEmail(query);
        return reply.type('text/html; charset=utf-8').send(`<h2>Kích hoạt email thành công</h2>`);
    }
};
exports.ApiOrganizationController = ApiOrganizationController;
__decorate([
    (0, common_1.Get)('info'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "info", null);
__decorate([
    (0, common_1.Patch)('update-info'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_UPDATE_INFO),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, Array, typeof (_d = typeof request_1.OrganizationUpdateBody !== "undefined" && request_1.OrganizationUpdateBody) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "updateInfoAndLogo", null);
__decorate([
    (0, common_1.Patch)('change-email'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_VERIFY_EMAIL),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.OrganizationChangeEmailBody !== "undefined" && request_1.OrganizationChangeEmailBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "changeEmail", null);
__decorate([
    (0, common_1.Post)('send-email-verify-organization-email'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_VERIFY_EMAIL),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "sendEmailVerifyOrganizationEmail", null);
__decorate([
    (0, common_1.Get)('verify-organization-email'),
    __param(0, (0, common_1.Res)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof fastify_1.FastifyReply !== "undefined" && fastify_1.FastifyReply) === "function" ? _h : Object, typeof (_j = typeof request_1.VerifyOrganizationEmailQuery !== "undefined" && request_1.VerifyOrganizationEmailQuery) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiOrganizationController.prototype, "verifyOrganizationEmail", null);
exports.ApiOrganizationController = ApiOrganizationController = __decorate([
    (0, swagger_1.ApiTags)('Organization'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('organization'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_organization_service_1.ApiOrganizationService !== "undefined" && api_organization_service_1.ApiOrganizationService) === "function" ? _a : Object])
], ApiOrganizationController);


/***/ }),
/* 444 */
/***/ ((module) => {

module.exports = require("fastify");

/***/ }),
/* 445 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiOrganizationService = void 0;
const common_1 = __webpack_require__(3);
const config_1 = __webpack_require__(31);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(187);
const jwt_config_1 = __webpack_require__(161);
const image_repository_1 = __webpack_require__(107);
const organization_repository_1 = __webpack_require__(111);
const environments_1 = __webpack_require__(30);
const email_service_1 = __webpack_require__(235);
const image_manager_service_1 = __webpack_require__(255);
let ApiOrganizationService = class ApiOrganizationService {
    constructor(globalConfig, jwtConfig, emailService, cacheDataService, imageManagerService, organizationRepository, imageRepository) {
        this.globalConfig = globalConfig;
        this.jwtConfig = jwtConfig;
        this.emailService = emailService;
        this.cacheDataService = cacheDataService;
        this.imageManagerService = imageManagerService;
        this.organizationRepository = organizationRepository;
        this.imageRepository = imageRepository;
    }
    async getInfo(oid) {
        const organization = await this.organizationRepository.findOne({
            relation: { logoImage: true },
            condition: { id: oid },
        });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async updateInfo(options) {
        const { oid, body, files } = options;
        const { organizationInfo } = body;
        const organizationOrigin = await this.organizationRepository.findOneById(oid);
        let image;
        let logoImageId = organizationOrigin.logoImageId || 0;
        if (body.imagesChange) {
            const logoIdNewList = await this.imageManagerService.changeCloudinaryImageLink({
                oid,
                customerId: 0,
                files,
                imageIdsWait: [0],
                externalUrlList: body.imagesChange.externalUrlList,
                imageIdsOld: [organizationOrigin.logoImageId || 0],
            });
            logoImageId = logoIdNewList[0];
        }
        const organization = await this.organizationRepository.updateOneAndReturnEntity({ id: oid }, {
            name: organizationInfo.name,
            addressProvince: organizationInfo.addressProvince,
            addressWard: organizationInfo.addressWard,
            addressStreet: organizationInfo.addressStreet,
            logoImageId,
        });
        if (!organization)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        organization.logoImage = await this.imageRepository.findOneBy({ oid, id: logoImageId });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
    async changeEmail(oid, email) {
        const rootOrganization = await this.organizationRepository.findOneById(oid);
        if (rootOrganization.email === email) {
            throw new common_1.HttpException('Email mới và email cũ cùng địa chỉ', common_1.HttpStatus.BAD_REQUEST);
        }
        const existOrganization = await this.organizationRepository.findOneBy({ email });
        if (existOrganization) {
            throw new common_1.HttpException('Email đã có người khác sử dụng. Vui lòng chọn email khác', common_1.HttpStatus.BAD_REQUEST);
        }
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: oid }, {
            email,
            emailVerify: 0,
        });
        if (!organization) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        this.cacheDataService.updateOrganizationInfo(organization);
        await this.sendEmailVerifyOrganizationEmail(oid);
        return { data: { organization } };
    }
    async sendEmailVerifyOrganizationEmail(oid) {
        const organization = await this.organizationRepository.findOneById(oid);
        if (!organization || !organization.email || organization.emailVerify === 1) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        const token = encodeURIComponent((0, string_helper_1.encrypt)(organization.email, this.jwtConfig.refreshKey, 30 * 60 * 1000));
        const link = `${this.globalConfig.DOMAIN_BACK_END}/organization/verify-organization-email`
            + `?oid=${oid}&email=${organization.email}&token=${token}&ver=1`;
        const sendEmailResult = await this.emailService.send({
            to: organization.email,
            subject: '[MEA] - Kích hoạt email tài khoản',
            from: 'medihome.vn@gmail.com',
            text: 'active_email',
            html: '<p>Nhấn vào đường link sau để kích hoạt email tài khoản: </p>'
                + `<p><a href="${link}">${link}</a></p>`
                + '<p>Link sẽ bị vô hiệu hóa sau 30 phút</p>',
        });
        return { data: { sendEmailResult } };
    }
    async verifyOrganizationEmail(query) {
        let email;
        try {
            email = (0, string_helper_1.decrypt)(query.token, this.jwtConfig.refreshKey);
        }
        catch (error) {
            throw new common_1.HttpException('Thời gian reset password đã quá hạn', common_1.HttpStatus.BAD_GATEWAY);
        }
        if (query.email !== email) {
            throw new exception_filter_1.BusinessException('error.Token.Invalid');
        }
        const [organization] = await this.organizationRepository.updateAndReturnEntity({ id: query.oid }, { emailVerify: 1 });
        this.cacheDataService.updateOrganizationInfo(organization);
        return { data: { organization } };
    }
};
exports.ApiOrganizationService = ApiOrganizationService;
exports.ApiOrganizationService = ApiOrganizationService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(environments_1.GlobalConfig.KEY)),
    __param(1, (0, common_1.Inject)(jwt_config_1.JwtConfig.KEY)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _a : Object, typeof (_b = typeof config_1.ConfigType !== "undefined" && config_1.ConfigType) === "function" ? _b : Object, typeof (_c = typeof email_service_1.EmailService !== "undefined" && email_service_1.EmailService) === "function" ? _c : Object, typeof (_d = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _d : Object, typeof (_e = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _e : Object, typeof (_f = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _f : Object, typeof (_g = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _g : Object])
], ApiOrganizationService);


/***/ }),
/* 446 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(447), exports);
__exportStar(__webpack_require__(448), exports);
__exportStar(__webpack_require__(449), exports);
__exportStar(__webpack_require__(450), exports);
__exportStar(__webpack_require__(451), exports);


/***/ }),
/* 447 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationChangeEmailBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class OrganizationChangeEmailBody {
}
exports.OrganizationChangeEmailBody = OrganizationChangeEmailBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ name: 'email', example: 'vm@gmail.com' }),
    (0, class_transformer_1.Transform)(({ value }) => {
        const [mail, domain] = value.split('@');
        const mailFormat = mail.replace(/\./g, '').replace(/\+.*?$/g, '');
        return `${mailFormat}@${domain}`;
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], OrganizationChangeEmailBody.prototype, "email", void 0);


/***/ }),
/* 448 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationGetOneQuery = exports.OrganizationGetManyQuery = exports.OrganizationPaginationQuery = exports.OrganizationGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const organization_options_request_1 = __webpack_require__(449);
class OrganizationGetQuery {
}
exports.OrganizationGetQuery = OrganizationGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            userList: true,
            logoImage: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof organization_options_request_1.OrganizationRelationQuery !== "undefined" && organization_options_request_1.OrganizationRelationQuery) === "function" ? _a : Object)
], OrganizationGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof organization_options_request_1.OrganizationFilterQuery !== "undefined" && organization_options_request_1.OrganizationFilterQuery) === "function" ? _b : Object)
], OrganizationGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(organization_options_request_1.OrganizationSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof organization_options_request_1.OrganizationSortQuery !== "undefined" && organization_options_request_1.OrganizationSortQuery) === "function" ? _c : Object)
], OrganizationGetQuery.prototype, "sort", void 0);
class OrganizationPaginationQuery extends (0, swagger_1.IntersectionType)(OrganizationGetQuery, query_1.PaginationQuery) {
}
exports.OrganizationPaginationQuery = OrganizationPaginationQuery;
class OrganizationGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(OrganizationGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.OrganizationGetManyQuery = OrganizationGetManyQuery;
class OrganizationGetOneQuery extends (0, swagger_1.PickType)(OrganizationGetQuery, ['relation']) {
}
exports.OrganizationGetOneQuery = OrganizationGetOneQuery;


/***/ }),
/* 449 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationSortQuery = exports.OrganizationFilterQuery = exports.OrganizationRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class OrganizationRelationQuery {
}
exports.OrganizationRelationQuery = OrganizationRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], OrganizationRelationQuery.prototype, "userList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], OrganizationRelationQuery.prototype, "logoImage", void 0);
class OrganizationFilterQuery {
}
exports.OrganizationFilterQuery = OrganizationFilterQuery;
class OrganizationSortQuery extends query_1.SortQuery {
}
exports.OrganizationSortQuery = OrganizationSortQuery;


/***/ }),
/* 450 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OrganizationUpdateBody = exports.OrganizationInfoBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const file_1 = __webpack_require__(262);
class OrganizationInfoBody {
}
exports.OrganizationInfoBody = OrganizationInfoBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Phòng khám đa khoa Medical' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationInfoBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Tỉnh Lâm Đồng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationInfoBody.prototype, "addressProvince", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Xã Tiên Hoàng' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationInfoBody.prototype, "addressWard", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Thôn Trần Lệ Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OrganizationInfoBody.prototype, "addressStreet", void 0);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsWait", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "externalUrlList", void 0);
class OrganizationUpdateBody extends file_1.MultipleFileUpload {
}
exports.OrganizationUpdateBody = OrganizationUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new OrganizationInfoBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate organizationInfoBody failed. Value = ${value} `,
    }),
    __metadata("design:type", OrganizationInfoBody)
], OrganizationUpdateBody.prototype, "organizationInfo", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${value}`,
    }),
    __metadata("design:type", ImagesChangeBody)
], OrganizationUpdateBody.prototype, "imagesChange", void 0);


/***/ }),
/* 451 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VerifyOrganizationEmailQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class VerifyOrganizationEmailQuery {
}
exports.VerifyOrganizationEmailQuery = VerifyOrganizationEmailQuery;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], VerifyOrganizationEmailQuery.prototype, "oid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'mea@gmail.com' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsGmail),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "email", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '$2b$05$G17lx6yO8fK2iJK6tqX2XODsCrawFzSht5vJQjE7wlDJO0.4zxPxO' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "token", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '1' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], VerifyOrganizationEmailQuery.prototype, "ver", void 0);


/***/ }),
/* 452 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodModule = void 0;
const common_1 = __webpack_require__(3);
const api_payment_method_controller_1 = __webpack_require__(453);
const api_payment_method_service_1 = __webpack_require__(454);
let ApiPaymentMethodModule = class ApiPaymentMethodModule {
};
exports.ApiPaymentMethodModule = ApiPaymentMethodModule;
exports.ApiPaymentMethodModule = ApiPaymentMethodModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_payment_method_controller_1.ApiPaymentMethodController],
        providers: [api_payment_method_service_1.ApiPaymentMethodService],
    })
], ApiPaymentMethodModule);


/***/ }),
/* 453 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_payment_method_service_1 = __webpack_require__(454);
const request_1 = __webpack_require__(455);
let ApiPaymentMethodController = class ApiPaymentMethodController {
    constructor(apiPaymentMethodService) {
        this.apiPaymentMethodService = apiPaymentMethodService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiPaymentMethodService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiPaymentMethodService.getMany(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }) {
        const data = await this.apiPaymentMethodService.getOne(oid, id);
        return { data };
    }
    async createOne({ oid }, body) {
        const data = await this.apiPaymentMethodService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiPaymentMethodService.updateOne({ oid, paymentMethodId: id, body });
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiPaymentMethodService.destroyOne({ oid, paymentMethodId: id });
        return { data };
    }
};
exports.ApiPaymentMethodController = ApiPaymentMethodController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PaymentMethodPaginationQuery !== "undefined" && request_1.PaymentMethodPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPaymentMethodController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.PaymentMethodGetManyQuery !== "undefined" && request_1.PaymentMethodGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiPaymentMethodController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], ApiPaymentMethodController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof request_1.PaymentMethodCreateBody !== "undefined" && request_1.PaymentMethodCreateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", typeof (_o = typeof Promise !== "undefined" && Promise) === "function" ? _o : Object)
], ApiPaymentMethodController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object, typeof (_r = typeof request_1.PaymentMethodUpdateBody !== "undefined" && request_1.PaymentMethodUpdateBody) === "function" ? _r : Object]),
    __metadata("design:returntype", typeof (_s = typeof Promise !== "undefined" && Promise) === "function" ? _s : Object)
], ApiPaymentMethodController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _u : Object]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], ApiPaymentMethodController.prototype, "destroyOne", null);
exports.ApiPaymentMethodController = ApiPaymentMethodController = __decorate([
    (0, swagger_1.ApiTags)('PaymentMethod'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('payment-method'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_payment_method_service_1.ApiPaymentMethodService !== "undefined" && api_payment_method_service_1.ApiPaymentMethodService) === "function" ? _a : Object])
], ApiPaymentMethodController);


/***/ }),
/* 454 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentMethodService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const error_1 = __webpack_require__(14);
const payment_method_repository_1 = __webpack_require__(112);
let ApiPaymentMethodService = class ApiPaymentMethodService {
    constructor(paymentMethodRepository) {
        this.paymentMethodRepository = paymentMethodRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.paymentMethodRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        return { paymentMethodList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.paymentMethodRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { paymentMethodList: data };
    }
    async getOne(oid, id) {
        const paymentMethod = await this.paymentMethodRepository.findOneBy({ oid, id });
        if (!paymentMethod)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { paymentMethod };
    }
    async createOne(oid, body) {
        let code = body.code;
        if (!code) {
            const count = await this.paymentMethodRepository.getMaxId();
            code = (count + 1).toString();
        }
        const existPaymentMethod = await this.paymentMethodRepository.findOneBy({ oid, code });
        if (existPaymentMethod) {
            throw new error_1.BusinessError(`Trùng mã thanh toán với ${existPaymentMethod.name}`);
        }
        const paymentMethod = await this.paymentMethodRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({ oid }, body), { code }));
        return { paymentMethod };
    }
    async updateOne(options) {
        const { body, paymentMethodId, oid } = options;
        if (body.code != null) {
            const existPaymentMethod = await this.paymentMethodRepository.findOneBy({
                oid,
                code: body.code,
                id: { NOT: paymentMethodId },
            });
            if (existPaymentMethod) {
                throw new error_1.BusinessError(`Trùng mã thanh toán với ${existPaymentMethod.name}`);
            }
        }
        const paymentMethod = await this.paymentMethodRepository.updateOneAndReturnEntity({ id: paymentMethodId, oid }, body);
        return { paymentMethod };
    }
    async destroyOne(options) {
        const { oid, paymentMethodId } = options;
        await this.paymentMethodRepository.delete({ oid, id: paymentMethodId });
        return { paymentMethodId };
    }
};
exports.ApiPaymentMethodService = ApiPaymentMethodService;
exports.ApiPaymentMethodService = ApiPaymentMethodService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof payment_method_repository_1.PaymentMethodRepository !== "undefined" && payment_method_repository_1.PaymentMethodRepository) === "function" ? _a : Object])
], ApiPaymentMethodService);


/***/ }),
/* 455 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(456), exports);
__exportStar(__webpack_require__(457), exports);
__exportStar(__webpack_require__(458), exports);


/***/ }),
/* 456 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodGetOneQuery = exports.PaymentMethodGetManyQuery = exports.PaymentMethodPaginationQuery = exports.PaymentMethodGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const payment_method_options_request_1 = __webpack_require__(457);
class PaymentMethodGetQuery {
}
exports.PaymentMethodGetQuery = PaymentMethodGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof payment_method_options_request_1.PaymentMethodRelationQuery !== "undefined" && payment_method_options_request_1.PaymentMethodRelationQuery) === "function" ? _a : Object)
], PaymentMethodGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof payment_method_options_request_1.PaymentMethodFilterQuery !== "undefined" && payment_method_options_request_1.PaymentMethodFilterQuery) === "function" ? _b : Object)
], PaymentMethodGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_method_options_request_1.PaymentMethodSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof payment_method_options_request_1.PaymentMethodSortQuery !== "undefined" && payment_method_options_request_1.PaymentMethodSortQuery) === "function" ? _c : Object)
], PaymentMethodGetQuery.prototype, "sort", void 0);
class PaymentMethodPaginationQuery extends (0, swagger_1.IntersectionType)(PaymentMethodGetQuery, query_1.PaginationQuery) {
}
exports.PaymentMethodPaginationQuery = PaymentMethodPaginationQuery;
class PaymentMethodGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PaymentMethodGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PaymentMethodGetManyQuery = PaymentMethodGetManyQuery;
class PaymentMethodGetOneQuery extends (0, swagger_1.PickType)(PaymentMethodGetQuery, ['relation']) {
}
exports.PaymentMethodGetOneQuery = PaymentMethodGetOneQuery;


/***/ }),
/* 457 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodSortQuery = exports.PaymentMethodFilterQuery = exports.PaymentMethodRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class PaymentMethodRelationQuery {
}
exports.PaymentMethodRelationQuery = PaymentMethodRelationQuery;
class PaymentMethodFilterQuery {
}
exports.PaymentMethodFilterQuery = PaymentMethodFilterQuery;
class PaymentMethodSortQuery extends query_1.SortQuery {
}
exports.PaymentMethodSortQuery = PaymentMethodSortQuery;


/***/ }),
/* 458 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentMethodUpdateBody = exports.PaymentMethodCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PaymentMethodCreateBody {
}
exports.PaymentMethodCreateBody = PaymentMethodCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PaymentMethodCreateBody.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Tiền mặt' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], PaymentMethodCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], PaymentMethodCreateBody.prototype, "isActive", void 0);
class PaymentMethodUpdateBody extends (0, swagger_1.PartialType)(PaymentMethodCreateBody) {
}
exports.PaymentMethodUpdateBody = PaymentMethodUpdateBody;


/***/ }),
/* 459 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentModule = void 0;
const common_1 = __webpack_require__(3);
const api_payment_controller_1 = __webpack_require__(460);
const api_payment_service_1 = __webpack_require__(461);
const payment_other_service_1 = __webpack_require__(462);
let ApiPaymentModule = class ApiPaymentModule {
};
exports.ApiPaymentModule = ApiPaymentModule;
exports.ApiPaymentModule = ApiPaymentModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_payment_controller_1.ApiPaymentController],
        providers: [api_payment_service_1.ApiPaymentService, payment_other_service_1.PaymentOtherService],
    })
], ApiPaymentModule);


/***/ }),
/* 460 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_payment_service_1 = __webpack_require__(461);
const payment_other_service_1 = __webpack_require__(462);
const request_1 = __webpack_require__(463);
let ApiPaymentController = class ApiPaymentController {
    constructor(apiPaymentService, paymentOtherService) {
        this.apiPaymentService = apiPaymentService;
        this.paymentOtherService = paymentOtherService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiPaymentService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiPaymentService.getMany(oid, query);
        return { data };
    }
    async moneyOutUpdateInfo({ oid, user }, { id }, body) {
        const data = await this.apiPaymentService.updateInfo({
            oid,
            paymentId: id,
            body,
            userId: user.id,
        });
        return { data };
    }
    async sumMoney({ oid }, query) {
        const data = await this.apiPaymentService.sumMoney(oid, query);
        return { data };
    }
    async otherCreateMoneyOut({ oid, user }, body) {
        const data = await this.paymentOtherService.createMoneyOut({
            oid,
            body,
            userId: user.id,
        });
        return { data };
    }
    async moneyInCreateOther({ oid, user }, body) {
        const data = await this.paymentOtherService.createMoneyIn({
            oid,
            body,
            userId: user.id,
        });
        return { data };
    }
    async moneyOutDestroyOther({ oid, user }, { id }) {
        const data = await this.paymentOtherService.destroyMoneyOut({
            oid,
            paymentId: id,
            userId: user.id,
        });
        return { data };
    }
    async moneyInDestroyOther({ oid, user }, { id }) {
        const data = await this.paymentOtherService.destroyMoneyIn({
            oid,
            paymentId: id,
            userId: user.id,
        });
        return { data };
    }
};
exports.ApiPaymentController = ApiPaymentController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object, typeof (_d = typeof request_1.PaymentPaginationQuery !== "undefined" && request_1.PaymentPaginationQuery) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ApiPaymentController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.PaymentGetManyQuery !== "undefined" && request_1.PaymentGetManyQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiPaymentController.prototype, "list", null);
__decorate([
    (0, common_1.Post)('update-info/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PAYMENT_UPDATE_INFO),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_1.PaymentUpdateInfoBody !== "undefined" && request_1.PaymentUpdateInfoBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiPaymentController.prototype, "moneyOutUpdateInfo", null);
__decorate([
    (0, common_1.Get)('sum-money'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof request_1.PaymentGetManyQuery !== "undefined" && request_1.PaymentGetManyQuery) === "function" ? _p : Object]),
    __metadata("design:returntype", typeof (_q = typeof Promise !== "undefined" && Promise) === "function" ? _q : Object)
], ApiPaymentController.prototype, "sumMoney", null);
__decorate([
    (0, common_1.Post)('other/create-money-out'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_OUT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.OtherPaymentBody !== "undefined" && request_1.OtherPaymentBody) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], ApiPaymentController.prototype, "otherCreateMoneyOut", null);
__decorate([
    (0, common_1.Post)('other/create-money-in'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_IN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof request_1.OtherPaymentBody !== "undefined" && request_1.OtherPaymentBody) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiPaymentController.prototype, "moneyInCreateOther", null);
__decorate([
    (0, common_1.Post)('other/destroy-money-out/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_OUT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], ApiPaymentController.prototype, "moneyOutDestroyOther", null);
__decorate([
    (0, common_1.Post)('other/destroy-money-in/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_IN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_0 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _0 : Object, typeof (_1 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _1 : Object]),
    __metadata("design:returntype", typeof (_2 = typeof Promise !== "undefined" && Promise) === "function" ? _2 : Object)
], ApiPaymentController.prototype, "moneyInDestroyOther", null);
exports.ApiPaymentController = ApiPaymentController = __decorate([
    (0, swagger_1.ApiTags)('Payment'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('payment'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_payment_service_1.ApiPaymentService !== "undefined" && api_payment_service_1.ApiPaymentService) === "function" ? _a : Object, typeof (_b = typeof payment_other_service_1.PaymentOtherService !== "undefined" && payment_other_service_1.PaymentOtherService) === "function" ? _b : Object])
], ApiPaymentController);


/***/ }),
/* 461 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPaymentService = void 0;
const common_1 = __webpack_require__(3);
const array_helper_1 = __webpack_require__(154);
const payment_entity_1 = __webpack_require__(51);
const repositories_1 = __webpack_require__(42);
const payment_repository_1 = __webpack_require__(114);
let ApiPaymentService = class ApiPaymentService {
    constructor(paymentRepository, paymentTicketItemRepository, paymentMethodRepository, customerRepository, ticketRepository, purchaseOrderRepository, distributorRepository, userRepository) {
        this.paymentRepository = paymentRepository;
        this.paymentTicketItemRepository = paymentTicketItemRepository;
        this.paymentMethodRepository = paymentMethodRepository;
        this.customerRepository = customerRepository;
        this.ticketRepository = ticketRepository;
        this.purchaseOrderRepository = purchaseOrderRepository;
        this.distributorRepository = distributorRepository;
        this.userRepository = userRepository;
    }
    async pagination(oid, query) {
        const { page, limit, relation, filter, sort } = query;
        const { data, total } = await this.paymentRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                voucherType: filter === null || filter === void 0 ? void 0 : filter.voucherType,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            sort,
        });
        if (relation) {
            await this.generateRelation(data, relation);
        }
        return { paymentList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { relation, filter, limit, sort } = query;
        const paymentList = await this.paymentRepository.findMany({
            limit,
            condition: {
                oid,
                voucherType: filter === null || filter === void 0 ? void 0 : filter.voucherType,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            sort,
        });
        if (relation) {
            await this.generateRelation(paymentList, relation);
        }
        return { paymentList };
    }
    async generateRelation(paymentList, relation) {
        const paymentIdList = paymentList.map((i) => i.id);
        const paymentIdListHasTicketItem = paymentList
            .filter((i) => {
            return [
                payment_entity_1.PaymentActionType.PrepaymentForTicketItemList,
                payment_entity_1.PaymentActionType.RefundForTicketItemList,
            ].includes(i.paymentActionType);
        })
            .map((i) => i.id);
        const ticketIdList = paymentList
            .filter((i) => i.voucherType === payment_entity_1.PaymentVoucherType.Ticket)
            .map((i) => i.voucherId);
        const purchaseOrderIdList = paymentList
            .filter((i) => i.voucherType === payment_entity_1.PaymentVoucherType.PurchaseOrder)
            .map((i) => i.voucherId);
        const customerIdList = paymentList
            .filter((i) => i.personType === payment_entity_1.PaymentPersonType.Customer)
            .map((i) => i.personId);
        const distributorIdList = paymentList
            .filter((i) => i.personType === payment_entity_1.PaymentPersonType.Distributor)
            .map((i) => i.personId);
        const employeeIdList = paymentList
            .filter((i) => i.personType === payment_entity_1.PaymentPersonType.Employee)
            .map((i) => i.personId);
        const cashierIdList = paymentList.map((i) => i.cashierId);
        const paymentMethodIdList = paymentList.map((i) => i.paymentMethodId);
        const userIdList = [...cashierIdList, ...employeeIdList];
        const [ticketList, purchaseOrderList, customerList, distributorList, userList, paymentMethodList, paymentTicketItemList,] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIdList.length
                ? this.ticketRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(ticketIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.purchaseOrder) && purchaseOrderIdList.length
                ? this.purchaseOrderRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(purchaseOrderIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIdList.length
                ? this.customerRepository.findManyBy({ id: { IN: array_helper_1.ESArray.uniqueArray(customerIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.distributor) && distributorIdList.length
                ? this.distributorRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(distributorIdList) },
                })
                : [],
            ((relation === null || relation === void 0 ? void 0 : relation.employee) || (relation === null || relation === void 0 ? void 0 : relation.cashier)) && userIdList.length
                ? this.userRepository.findManyBy({ id: { IN: array_helper_1.ESArray.uniqueArray(userIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.paymentMethod) && paymentMethodIdList.length
                ? this.paymentMethodRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(paymentMethodIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.paymentTicketItemList) && paymentIdListHasTicketItem.length
                ? this.paymentTicketItemRepository.findManyBy({
                    paymentId: { IN: paymentIdListHasTicketItem },
                })
                : [],
        ]);
        const ticketMap = array_helper_1.ESArray.arrayToKeyValue(ticketList, 'id');
        const purchaseOrderMap = array_helper_1.ESArray.arrayToKeyValue(purchaseOrderList, 'id');
        const customerMap = array_helper_1.ESArray.arrayToKeyValue(customerList, 'id');
        const distributorMap = array_helper_1.ESArray.arrayToKeyValue(distributorList, 'id');
        const userMap = array_helper_1.ESArray.arrayToKeyValue(userList, 'id');
        const paymentMethodMap = array_helper_1.ESArray.arrayToKeyValue(paymentMethodList, 'id');
        paymentList.forEach((payment) => {
            if (relation === null || relation === void 0 ? void 0 : relation.ticket) {
                payment.ticket = ticketMap[payment.voucherId];
            }
            if (relation === null || relation === void 0 ? void 0 : relation.purchaseOrder) {
                payment.purchaseOrder = purchaseOrderMap[payment.voucherId];
            }
            if ((relation === null || relation === void 0 ? void 0 : relation.customer) && payment.personType === payment_entity_1.PaymentPersonType.Customer) {
                payment.customer = customerMap[payment.personId];
            }
            if ((relation === null || relation === void 0 ? void 0 : relation.distributor) && payment.personType === payment_entity_1.PaymentPersonType.Distributor) {
                payment.distributor = distributorMap[payment.personId];
            }
            if ((relation === null || relation === void 0 ? void 0 : relation.employee) && payment.personType === payment_entity_1.PaymentPersonType.Employee) {
                payment.employee = userMap[payment.personId];
            }
            if (relation === null || relation === void 0 ? void 0 : relation.cashier) {
                payment.cashier = userMap[payment.cashierId];
            }
            if (relation === null || relation === void 0 ? void 0 : relation.paymentTicketItemList) {
                payment.paymentTicketItemList = paymentTicketItemList.filter((i) => i.paymentId === payment.id);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.paymentMethod) {
                payment.paymentMethod = paymentMethodMap[payment.paymentMethodId];
            }
        });
        return paymentList;
    }
    async updateInfo(options) {
        const { oid, userId, paymentId, body } = options;
        const payment = await this.paymentRepository.updateOneAndReturnEntity({ oid, id: paymentId, cashierId: userId }, {
            paymentMethodId: body.paymentMethodId,
            note: body.note,
        });
        return { payment };
    }
    async sumMoney(oid, query) {
        const { filter } = query;
        const { dataRaws } = await this.paymentRepository.findAndSelect({
            condition: {
                oid,
                paymentMethodId: filter === null || filter === void 0 ? void 0 : filter.paymentMethodId,
                personType: filter === null || filter === void 0 ? void 0 : filter.personType,
                personId: filter === null || filter === void 0 ? void 0 : filter.personId,
                moneyDirection: filter === null || filter === void 0 ? void 0 : filter.moneyDirection,
                cashierId: filter === null || filter === void 0 ? void 0 : filter.cashierId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            select: ['moneyDirection'],
            aggregate: {
                sumPaidAmount: { SUM: ['paidAmount'] },
                count: { COUNT: '*' },
            },
            groupBy: ['moneyDirection'],
        });
        const aggregate = dataRaws.map((i) => {
            return {
                moneyDirection: i.moneyDirection,
                sumPaidAmount: Number(i.sumPaidAmount),
                count: Number(i.count),
            };
        });
        return { aggregate };
    }
};
exports.ApiPaymentService = ApiPaymentService;
exports.ApiPaymentService = ApiPaymentService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof payment_repository_1.PaymentRepository !== "undefined" && payment_repository_1.PaymentRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PaymentTicketItemRepository !== "undefined" && repositories_1.PaymentTicketItemRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.PaymentMethodRepository !== "undefined" && repositories_1.PaymentMethodRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.PurchaseOrderRepository !== "undefined" && repositories_1.PurchaseOrderRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.DistributorRepository !== "undefined" && repositories_1.DistributorRepository) === "function" ? _g : Object, typeof (_h = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _h : Object])
], ApiPaymentService);


/***/ }),
/* 462 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentOtherService = void 0;
const common_1 = __webpack_require__(3);
const payment_entity_1 = __webpack_require__(51);
const payment_repository_1 = __webpack_require__(114);
let PaymentOtherService = class PaymentOtherService {
    constructor(paymentRepository) {
        this.paymentRepository = paymentRepository;
    }
    async createMoneyOut(options) {
        const { oid, userId, body } = options;
        const paymentInsert = {
            oid,
            voucherType: payment_entity_1.PaymentVoucherType.Other,
            voucherId: 0,
            personType: payment_entity_1.PaymentPersonType.Other,
            personId: 0,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            createdAt: Date.now(),
            moneyDirection: payment_entity_1.MoneyDirection.Out,
            paymentActionType: payment_entity_1.PaymentActionType.Other,
            note: body.note || '',
            paidAmount: body.paidAmount,
            debtAmount: 0,
            openDebt: 0,
            closeDebt: 0,
        };
        const payment = await this.paymentRepository.insertOneAndReturnEntity(paymentInsert);
        return { payment };
    }
    async createMoneyIn(options) {
        const { oid, userId, body } = options;
        const paymentInsert = {
            oid,
            voucherType: payment_entity_1.PaymentVoucherType.Other,
            voucherId: 0,
            personType: payment_entity_1.PaymentPersonType.Other,
            personId: 0,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            createdAt: Date.now(),
            moneyDirection: payment_entity_1.MoneyDirection.In,
            paymentActionType: payment_entity_1.PaymentActionType.Other,
            note: body.note || '',
            paidAmount: body.paidAmount,
            debtAmount: 0,
            openDebt: 0,
            closeDebt: 0,
        };
        const payment = await this.paymentRepository.insertOneAndReturnEntity(paymentInsert);
        return { payment };
    }
    async destroyMoneyOut(options) {
        const { oid, userId, paymentId } = options;
        const payment = await this.paymentRepository.deleteAndReturnEntity({
            oid,
            id: paymentId,
            cashierId: userId,
            voucherId: 0,
            moneyDirection: payment_entity_1.MoneyDirection.Out,
            debtAmount: 0,
        });
        return { payment };
    }
    async destroyMoneyIn(options) {
        const { oid, userId, paymentId } = options;
        const payment = await this.paymentRepository.deleteAndReturnEntity({
            oid,
            id: paymentId,
            cashierId: userId,
            voucherId: 0,
            moneyDirection: payment_entity_1.MoneyDirection.In,
            debtAmount: 0,
        });
        return { payment };
    }
};
exports.PaymentOtherService = PaymentOtherService;
exports.PaymentOtherService = PaymentOtherService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof payment_repository_1.PaymentRepository !== "undefined" && payment_repository_1.PaymentRepository) === "function" ? _a : Object])
], PaymentOtherService);


/***/ }),
/* 463 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(464), exports);
__exportStar(__webpack_require__(465), exports);
__exportStar(__webpack_require__(466), exports);
__exportStar(__webpack_require__(467), exports);


/***/ }),
/* 464 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OtherPaymentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class OtherPaymentBody {
}
exports.OtherPaymentBody = OtherPaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], OtherPaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], OtherPaymentBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], OtherPaymentBody.prototype, "note", void 0);


/***/ }),
/* 465 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentUpdateInfoBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PaymentUpdateInfoBody {
}
exports.PaymentUpdateInfoBody = PaymentUpdateInfoBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PaymentUpdateInfoBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PaymentUpdateInfoBody.prototype, "note", void 0);


/***/ }),
/* 466 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentResponseQuery = exports.PaymentSortQuery = exports.PaymentFilterQuery = exports.PaymentRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const payment_entity_1 = __webpack_require__(51);
class PaymentRelationQuery {
}
exports.PaymentRelationQuery = PaymentRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "employee", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "cashier", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "paymentMethod", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PaymentRelationQuery.prototype, "paymentTicketItemList", void 0);
class PaymentFilterQuery {
}
exports.PaymentFilterQuery = PaymentFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.PaymentVoucherType),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.PaymentVoucherType)),
    __metadata("design:type", typeof (_a = typeof payment_entity_1.PaymentVoucherType !== "undefined" && payment_entity_1.PaymentVoucherType) === "function" ? _a : Object)
], PaymentFilterQuery.prototype, "voucherType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "voucherId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.PaymentPersonType),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.PaymentPersonType)),
    __metadata("design:type", typeof (_b = typeof payment_entity_1.PaymentPersonType !== "undefined" && payment_entity_1.PaymentPersonType) === "function" ? _b : Object)
], PaymentFilterQuery.prototype, "personType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "personId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_entity_1.MoneyDirection),
    (0, class_validator_1.IsIn)((0, typescript_helper_1.valuesEnum)(payment_entity_1.MoneyDirection)),
    __metadata("design:type", typeof (_c = typeof payment_entity_1.MoneyDirection !== "undefined" && payment_entity_1.MoneyDirection) === "function" ? _c : Object)
], PaymentFilterQuery.prototype, "moneyDirection", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PaymentFilterQuery.prototype, "cashierId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _d : Object)
], PaymentFilterQuery.prototype, "createdAt", void 0);
class PaymentSortQuery extends query_1.SortQuery {
}
exports.PaymentSortQuery = PaymentSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PaymentSortQuery.prototype, "createdAt", void 0);
class PaymentResponseQuery {
}
exports.PaymentResponseQuery = PaymentResponseQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsObject)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", PaymentRelationQuery)
], PaymentResponseQuery.prototype, "payment", void 0);


/***/ }),
/* 467 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PaymentPostQuery = exports.PaymentGetOneQuery = exports.PaymentGetManyQuery = exports.PaymentPaginationQuery = exports.PaymentGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const payment_options_1 = __webpack_require__(466);
class PaymentGetQuery {
}
exports.PaymentGetQuery = PaymentGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof payment_options_1.PaymentRelationQuery !== "undefined" && payment_options_1.PaymentRelationQuery) === "function" ? _a : Object)
], PaymentGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            personId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof payment_options_1.PaymentFilterQuery !== "undefined" && payment_options_1.PaymentFilterQuery) === "function" ? _b : Object)
], PaymentGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof payment_options_1.PaymentSortQuery !== "undefined" && payment_options_1.PaymentSortQuery) === "function" ? _c : Object)
], PaymentGetQuery.prototype, "sort", void 0);
class PaymentPaginationQuery extends (0, swagger_1.IntersectionType)(PaymentGetQuery, query_1.PaginationQuery) {
}
exports.PaymentPaginationQuery = PaymentPaginationQuery;
class PaymentGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PaymentGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PaymentGetManyQuery = PaymentGetManyQuery;
class PaymentGetOneQuery extends (0, swagger_1.PickType)(PaymentGetQuery, ['relation']) {
}
exports.PaymentGetOneQuery = PaymentGetOneQuery;
class PaymentPostQuery {
}
exports.PaymentPostQuery = PaymentPostQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(payment_options_1.PaymentResponseQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof payment_options_1.PaymentResponseQuery !== "undefined" && payment_options_1.PaymentResponseQuery) === "function" ? _d : Object)
], PaymentPostQuery.prototype, "response", void 0);


/***/ }),
/* 468 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionModule = void 0;
const common_1 = __webpack_require__(3);
const api_permission_controller_1 = __webpack_require__(469);
const api_permission_service_1 = __webpack_require__(470);
let ApiPermissionModule = class ApiPermissionModule {
};
exports.ApiPermissionModule = ApiPermissionModule;
exports.ApiPermissionModule = ApiPermissionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_permission_controller_1.ApiPermissionController],
        providers: [api_permission_service_1.ApiPermissionService],
    })
], ApiPermissionModule);


/***/ }),
/* 469 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(157);
const api_permission_service_1 = __webpack_require__(470);
const request_1 = __webpack_require__(488);
let ApiPermissionController = class ApiPermissionController {
    constructor(apiPermissionService) {
        this.apiPermissionService = apiPermissionService;
    }
    list(query) {
        return this.apiPermissionService.getMany(query);
    }
    initData() {
        return this.apiPermissionService.initData();
    }
};
exports.ApiPermissionController = ApiPermissionController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof request_1.PermissionGetManyQuery !== "undefined" && request_1.PermissionGetManyQuery) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], ApiPermissionController.prototype, "list", null);
__decorate([
    (0, common_1.Post)('init-data'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], ApiPermissionController.prototype, "initData", null);
exports.ApiPermissionController = ApiPermissionController = __decorate([
    (0, swagger_1.ApiTags)('Permission'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('permission'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_permission_service_1.ApiPermissionService !== "undefined" && api_permission_service_1.ApiPermissionService) === "function" ? _a : Object])
], ApiPermissionController);


/***/ }),
/* 470 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPermissionService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const permission_repository_1 = __webpack_require__(115);
const permission_data_1 = __webpack_require__(471);
let ApiPermissionService = class ApiPermissionService {
    constructor(cacheDataService, permissionRepository) {
        this.cacheDataService = cacheDataService;
        this.permissionRepository = permissionRepository;
    }
    async getMany(query) {
        const { limit, filter, sort } = query;
        const data = await this.permissionRepository.findMany({
            condition: {
                level: filter === null || filter === void 0 ? void 0 : filter.level,
                rootId: filter === null || filter === void 0 ? void 0 : filter.rootId,
            },
            limit,
            sort,
        });
        return { data };
    }
    async initData() {
        await this.permissionRepository.delete({});
        const { idsEffect } = await this.permissionRepository.upsert(permission_data_1.permissionDataAll);
        this.cacheDataService.reloadPermissionAll();
        return { data: { idsEffect } };
    }
};
exports.ApiPermissionService = ApiPermissionService;
exports.ApiPermissionService = ApiPermissionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof permission_repository_1.PermissionRepository !== "undefined" && permission_repository_1.PermissionRepository) === "function" ? _b : Object])
], ApiPermissionService);


/***/ }),
/* 471 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionDataAll = void 0;
const permission_appointment_data_1 = __webpack_require__(472);
const permission_customer_data_1 = __webpack_require__(473);
const permission_distributor_data_1 = __webpack_require__(474);
const permission_file_data_1 = __webpack_require__(475);
const permission_laboratory_data_1 = __webpack_require__(476);
const permission_master_data_data_1 = __webpack_require__(477);
const permission_organization_data_1 = __webpack_require__(478);
const permission_payment_data_1 = __webpack_require__(479);
const permission_procedure_data_1 = __webpack_require__(480);
const permission_product_data_1 = __webpack_require__(481);
const permission_purchase_order_data_1 = __webpack_require__(482);
const permission_radiology_data_1 = __webpack_require__(483);
const permission_statistic_data_1 = __webpack_require__(484);
const permission_stock_check_data_1 = __webpack_require__(485);
const permission_ticket_data_1 = __webpack_require__(486);
const permission_user_data_1 = __webpack_require__(487);
exports.permissionDataAll = [
    ...permission_organization_data_1.permissionOrganization,
    ...permission_user_data_1.permissionUser,
    ...permission_statistic_data_1.permissionStatistic,
    ...permission_master_data_data_1.permissionMasterData,
    ...permission_purchase_order_data_1.permissionPurchaseOrder,
    ...permission_customer_data_1.permissionCustomer,
    ...permission_distributor_data_1.permissionDistributor,
    ...permission_product_data_1.permissionProduct,
    ...permission_procedure_data_1.permissionProcedure,
    ...permission_laboratory_data_1.permissionLaboratory,
    ...permission_radiology_data_1.permissionRadiology,
    ...permission_stock_check_data_1.permissionStockCheck,
    ...permission_payment_data_1.permissionPayment,
    ...permission_file_data_1.permissionFile,
    ...permission_appointment_data_1.permissionAppointment,
    ...permission_ticket_data_1.permissionTicket,
];


/***/ }),
/* 472 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionAppointment = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionAppointment = [
    {
        id: permission_enum_1.PermissionId.APPOINTMENT,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}`,
        name: 'Quản lý hẹn',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
    {
        id: permission_enum_1.PermissionId.APPOINTMENT_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}.${permission_enum_1.PermissionId.APPOINTMENT_MENU}`,
        name: 'Xem menu lịch hẹn',
        parentId: permission_enum_1.PermissionId.APPOINTMENT,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
    {
        id: permission_enum_1.PermissionId.APPOINTMENT_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}.${permission_enum_1.PermissionId.APPOINTMENT_CREATE}`,
        name: 'Tạo lịch hẹn mới',
        parentId: permission_enum_1.PermissionId.APPOINTMENT,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
    {
        id: permission_enum_1.PermissionId.APPOINTMENT_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}.${permission_enum_1.PermissionId.APPOINTMENT_UPDATE}`,
        name: 'Sửa lịch hẹn',
        parentId: permission_enum_1.PermissionId.APPOINTMENT,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
    {
        id: permission_enum_1.PermissionId.APPOINTMENT_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}.${permission_enum_1.PermissionId.APPOINTMENT_DELETE}`,
        name: 'Xóa lịch hẹn',
        parentId: permission_enum_1.PermissionId.APPOINTMENT,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
    {
        id: permission_enum_1.PermissionId.APPOINTMENT_REGISTER_TICKET,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.APPOINTMENT_REGISTER_TICKET],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.APPOINTMENT}.${permission_enum_1.PermissionId.APPOINTMENT_REGISTER_TICKET}`,
        name: 'Đón khách hàng đến và tạo phiếu đón tiếp',
        parentId: permission_enum_1.PermissionId.APPOINTMENT,
        rootId: permission_enum_1.PermissionId.APPOINTMENT,
    },
];


/***/ }),
/* 473 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionCustomer = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionCustomer = [
    {
        id: permission_enum_1.PermissionId.CUSTOMER,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.CUSTOMER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.CUSTOMER}`,
        name: 'Quản lý khách hàng',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.CUSTOMER,
    },
    {
        id: permission_enum_1.PermissionId.CUSTOMER_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.CUSTOMER_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.CUSTOMER}.${permission_enum_1.PermissionId.CUSTOMER_MENU}`,
        name: 'Xem menu khách hàng',
        parentId: permission_enum_1.PermissionId.CUSTOMER,
        rootId: permission_enum_1.PermissionId.CUSTOMER,
    },
    {
        id: permission_enum_1.PermissionId.CUSTOMER_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.CUSTOMER_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.CUSTOMER}.${permission_enum_1.PermissionId.CUSTOMER_CREATE}`,
        name: 'Thêm khách hàng',
        parentId: permission_enum_1.PermissionId.CUSTOMER,
        rootId: permission_enum_1.PermissionId.CUSTOMER,
    },
    {
        id: permission_enum_1.PermissionId.CUSTOMER_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.CUSTOMER_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.CUSTOMER}.${permission_enum_1.PermissionId.CUSTOMER_UPDATE}`,
        name: 'Sửa khách hàng',
        parentId: permission_enum_1.PermissionId.CUSTOMER,
        rootId: permission_enum_1.PermissionId.CUSTOMER,
    },
    {
        id: permission_enum_1.PermissionId.CUSTOMER_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.CUSTOMER_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.CUSTOMER}.${permission_enum_1.PermissionId.CUSTOMER_DELETE}`,
        name: 'Xóa khách hàng',
        parentId: permission_enum_1.PermissionId.CUSTOMER,
        rootId: permission_enum_1.PermissionId.CUSTOMER,
    },
];


/***/ }),
/* 474 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionDistributor = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionDistributor = [
    {
        id: permission_enum_1.PermissionId.DISTRIBUTOR,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.DISTRIBUTOR],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.DISTRIBUTOR}`,
        name: 'Quản lý nhà cung cấp',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.DISTRIBUTOR,
    },
    {
        id: permission_enum_1.PermissionId.DISTRIBUTOR_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.DISTRIBUTOR_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.DISTRIBUTOR}.${permission_enum_1.PermissionId.DISTRIBUTOR_MENU}`,
        name: 'Xem menu nhà cung cấp',
        parentId: permission_enum_1.PermissionId.DISTRIBUTOR,
        rootId: permission_enum_1.PermissionId.DISTRIBUTOR,
    },
    {
        id: permission_enum_1.PermissionId.DISTRIBUTOR_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.DISTRIBUTOR_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.DISTRIBUTOR}.${permission_enum_1.PermissionId.DISTRIBUTOR_CREATE}`,
        name: 'Thêm nhà cung cấp',
        parentId: permission_enum_1.PermissionId.DISTRIBUTOR,
        rootId: permission_enum_1.PermissionId.DISTRIBUTOR,
    },
    {
        id: permission_enum_1.PermissionId.DISTRIBUTOR_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.DISTRIBUTOR_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.DISTRIBUTOR}.${permission_enum_1.PermissionId.DISTRIBUTOR_UPDATE}`,
        name: 'Sửa nhà cung cấp',
        parentId: permission_enum_1.PermissionId.DISTRIBUTOR,
        rootId: permission_enum_1.PermissionId.DISTRIBUTOR,
    },
    {
        id: permission_enum_1.PermissionId.DISTRIBUTOR_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.DISTRIBUTOR_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.DISTRIBUTOR}.${permission_enum_1.PermissionId.DISTRIBUTOR_DELETE}`,
        name: 'Xóa nhà cung cấp',
        parentId: permission_enum_1.PermissionId.DISTRIBUTOR,
        rootId: permission_enum_1.PermissionId.DISTRIBUTOR,
    },
];


/***/ }),
/* 475 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionFile = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionFile = [
    {
        id: permission_enum_1.PermissionId.FILE,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}`,
        name: 'Quản lý File Excel',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PRODUCT}`,
        name: 'Tải file Excel danh sách sản phẩm',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PROCEDURE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PROCEDURE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PROCEDURE}`,
        name: 'Tải file Excel danh sách dịch vụ',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_LABORATORY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_LABORATORY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_LABORATORY}`,
        name: 'Tải file Excel danh sách xét nghiệm',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_RADIOLOGY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_RADIOLOGY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_RADIOLOGY}`,
        name: 'Tải file Excel danh sách phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_CUSTOMER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_CUSTOMER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_CUSTOMER}`,
        name: 'Tải file Excel danh sách khách hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PURCHASE_ORDER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PURCHASE_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_PURCHASE_ORDER}`,
        name: 'Tải file Excel danh sách phiếu nhập hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_ORDER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_ORDER}`,
        name: 'Tải file Excel danh sách bán hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_CLINIC,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_CLINIC],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_DOWNLOAD_TICKET_CLINIC}`,
        name: 'Tải file Excel danh sách phiếu khám',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PRODUCT}`,
        name: 'Upload file Excel danh sách sản phẩm',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PROCEDURE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PROCEDURE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PROCEDURE}`,
        name: 'Upload file Excel danh sách dịch vụ',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_LABORATORY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_LABORATORY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_LABORATORY}`,
        name: 'Upload file Excel danh sách xét nghiệm',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_RADIOLOGY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_RADIOLOGY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_RADIOLOGY}`,
        name: 'Upload file Excel danh sách phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_CUSTOMER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_CUSTOMER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_CUSTOMER}`,
        name: 'Upload file Excel danh sách khách hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PURCHASE_ORDER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PURCHASE_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_PURCHASE_ORDER}`,
        name: 'Upload file Excel danh sách phiếu nhập hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_ORDER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_ORDER}`,
        name: 'Upload file Excel danh sách bán hàng',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
    {
        id: permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_CLINIC,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_CLINIC],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.FILE}.${permission_enum_1.PermissionId.FILE_EXCEL_UPLOAD_TICKET_CLINIC}`,
        name: 'Upload file Excel danh sách phiếu khám',
        parentId: permission_enum_1.PermissionId.FILE,
        rootId: permission_enum_1.PermissionId.FILE,
    },
];


/***/ }),
/* 476 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionLaboratory = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionLaboratory = [
    {
        id: permission_enum_1.PermissionId.LABORATORY,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}`,
        name: 'Quản lý xét nghiệm',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_MENU}`,
        name: 'Xem menu xét nghiệm',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_CREATE}`,
        name: 'Thêm xét nghiệm',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_UPDATE}`,
        name: 'Sửa xét nghiệm',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_DELETE}`,
        name: 'Xóa xét nghiệm',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_GROUP_CRUD}`,
        name: 'Thêm, sửa, xóa nhóm xét nghiệm',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
    {
        id: permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.LABORATORY}.${permission_enum_1.PermissionId.LABORATORY_SAMPLE_CRUD}`,
        name: 'Thêm, sửa, xóa bộ xét nghiệm mẫu',
        parentId: permission_enum_1.PermissionId.LABORATORY,
        rootId: permission_enum_1.PermissionId.LABORATORY,
    },
];


/***/ }),
/* 477 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionMasterData = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionMasterData = [
    {
        id: permission_enum_1.PermissionId.MASTER_DATA,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}`,
        name: 'Quản lý danh mục',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML}`,
        name: 'Cài đặt mẫu in',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_ROOM,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_ROOM],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_ROOM}`,
        name: 'Quản lý danh phòng',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE}`,
        name: 'Quản lý danh sách kho',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_POSITION,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_POSITION],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_POSITION}`,
        name: 'Quản lý vị trí làm việc và hoa hồng',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_DISCOUNT}`,
        name: 'Quản lý chương trình khuyến mãi',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_PAYMENT_METHOD}`,
        name: 'Quản lý các phương thức thanh toán',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_CUSTOMER_SOURCE}`,
        name: 'Quản lý nguồn khách hàng',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE}`,
        name: 'Quản lý phụ phí',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_EXPENSE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_EXPENSE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_EXPENSE}`,
        name: 'Quản lý chi phí',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE}`,
        name: 'Quản lý đơn thuốc mẫu',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
    {
        id: permission_enum_1.PermissionId.MASTER_DATA_RADIOLOGY_CONTENT_SAMPLE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.MASTER_DATA_RADIOLOGY_CONTENT_SAMPLE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.MASTER_DATA}.${permission_enum_1.PermissionId.MASTER_DATA_RADIOLOGY_CONTENT_SAMPLE}`,
        name: 'Quản lý đơn kết quả CĐHA mẫu',
        parentId: permission_enum_1.PermissionId.MASTER_DATA,
        rootId: permission_enum_1.PermissionId.MASTER_DATA,
    },
];


/***/ }),
/* 478 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionOrganization = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionOrganization = [
    {
        id: permission_enum_1.PermissionId.ORGANIZATION,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.ORGANIZATION],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.ORGANIZATION}`,
        name: 'Quản lý cơ sở (Admin)',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.ORGANIZATION,
    },
    {
        id: permission_enum_1.PermissionId.ORGANIZATION_UPDATE_INFO,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.ORGANIZATION_UPDATE_INFO],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.ORGANIZATION}.${permission_enum_1.PermissionId.ORGANIZATION_UPDATE_INFO}`,
        name: 'Sửa thông tin cơ sở',
        parentId: permission_enum_1.PermissionId.ORGANIZATION,
        rootId: permission_enum_1.PermissionId.ORGANIZATION,
    },
    {
        id: permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.ORGANIZATION}.${permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT}`,
        name: 'Chỉnh sửa cài đặt',
        parentId: permission_enum_1.PermissionId.ORGANIZATION,
        rootId: permission_enum_1.PermissionId.ORGANIZATION,
    },
    {
        id: permission_enum_1.PermissionId.ORGANIZATION_VERIFY_EMAIL,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.ORGANIZATION_VERIFY_EMAIL],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.ORGANIZATION}.${permission_enum_1.PermissionId.ORGANIZATION_VERIFY_EMAIL}`,
        name: 'Sửa và kích hoạt email',
        parentId: permission_enum_1.PermissionId.ORGANIZATION,
        rootId: permission_enum_1.PermissionId.ORGANIZATION,
    },
];


/***/ }),
/* 479 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionPayment = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionPayment = [
    {
        id: permission_enum_1.PermissionId.PAYMENT,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}`,
        name: 'Quản lý tài chính',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_MENU}`,
        name: 'Xem menu phiếu thu/chi',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_UPDATE_INFO,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_UPDATE_INFO],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_UPDATE_INFO}`,
        name: 'Sửa thông tin phiếu thanh toán',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_OUT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_OUT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_OUT}`,
        name: 'Tạo phiếu chi tùy chọn',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_IN,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_IN],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_OTHER_CREATE_MONEY_IN}`,
        name: 'Tạo phiếu thu tùy chọn',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_OUT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_OUT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_OUT}`,
        name: 'Xóa phiếu chi tùy chọn',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_IN,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_IN],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.PAYMENT_OTHER_DESTROY_MONEY_IN}`,
        name: 'Xóa phiếu thu tùy chọn',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
];


/***/ }),
/* 480 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionProcedure = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionProcedure = [
    {
        id: permission_enum_1.PermissionId.PROCEDURE,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}`,
        name: 'Quản lý dịch vụ',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
    {
        id: permission_enum_1.PermissionId.PROCEDURE_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}.${permission_enum_1.PermissionId.PROCEDURE_MENU}`,
        name: 'Xem menu dịch vụ',
        parentId: permission_enum_1.PermissionId.PROCEDURE,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
    {
        id: permission_enum_1.PermissionId.PROCEDURE_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}.${permission_enum_1.PermissionId.PROCEDURE_CREATE}`,
        name: 'Thêm dịch vụ',
        parentId: permission_enum_1.PermissionId.PROCEDURE,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
    {
        id: permission_enum_1.PermissionId.PROCEDURE_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}.${permission_enum_1.PermissionId.PROCEDURE_UPDATE}`,
        name: 'Sửa dịch vụ',
        parentId: permission_enum_1.PermissionId.PROCEDURE,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
    {
        id: permission_enum_1.PermissionId.PROCEDURE_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}.${permission_enum_1.PermissionId.PROCEDURE_DELETE}`,
        name: 'Xóa dịch vụ',
        parentId: permission_enum_1.PermissionId.PROCEDURE,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
    {
        id: permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PROCEDURE}.${permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD}`,
        name: 'Thêm, sửa, xóa nhóm dịch vụ',
        parentId: permission_enum_1.PermissionId.PROCEDURE,
        rootId: permission_enum_1.PermissionId.PROCEDURE,
    },
];


/***/ }),
/* 481 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionProduct = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionProduct = [
    {
        id: permission_enum_1.PermissionId.PRODUCT,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}`,
        name: 'Quản lý sản phẩm',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_MENU}`,
        name: 'Xem menu danh sách sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_CREATE}`,
        name: 'Thêm sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_UPDATE}`,
        name: 'Sửa sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_DELETE}`,
        name: 'Xóa sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_UPDATE_BATCH,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_UPDATE_BATCH],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_UPDATE_BATCH}`,
        name: 'Sửa thông tin lô hàng',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_DELETE_BATCH,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_DELETE_BATCH],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_DELETE_BATCH}`,
        name: 'Xóa lô hàng',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_GROUP_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_GROUP_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_GROUP_CRUD}`,
        name: 'Thêm, sửa, xóa nhóm sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_READ_COST_PRICE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_READ_COST_PRICE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_READ_COST_PRICE}`,
        name: 'Xem giá nhập',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_READ_MOVEMENT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_READ_MOVEMENT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_READ_MOVEMENT}`,
        name: 'Xem lịch sử nhập xuất',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_CHANGE_QUANTITY_AND_COST_PRICE}`,
        name: '*** Chỉnh sửa số lượng và giá nhập',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_MERGE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_MERGE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_MERGE}`,
        name: '*** Gộp sản phẩm',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
    {
        id: permission_enum_1.PermissionId.PRODUCT_MERGE_BATCH,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PRODUCT_MERGE_BATCH],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PRODUCT}.${permission_enum_1.PermissionId.PRODUCT_MERGE_BATCH}`,
        name: '*** Gộp lô hàng',
        parentId: permission_enum_1.PermissionId.PRODUCT,
        rootId: permission_enum_1.PermissionId.PRODUCT,
    },
];


/***/ }),
/* 482 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionPurchaseOrder = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionPurchaseOrder = [
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}`,
        name: 'Quản lý phiếu nhập hàng',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_MENU}`,
        name: 'Xem menu phiếu nhập hàng',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD}`,
        name: 'Tạo, sửa, xóa phiếu nháp',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_UPDATE}`,
        name: 'Sửa phiếu nhập hàng đang tạm ứng',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_DESTROY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_DESTROY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_DESTROY}`,
        name: 'Xóa phiếu nhập hàng không còn tạm ứng',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_PAYMENT_MONEY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_PAYMENT_MONEY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_PAYMENT_MONEY}`,
        name: 'Tạo phiếu thanh toán với nhà cung cấp',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_REFUND_MONEY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_REFUND_MONEY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_REFUND_MONEY}`,
        name: 'Tạo phiếu nhận tiền hoàn trả tiền từ nhà cung cấp',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_SEND_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_SEND_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_SEND_PRODUCT}`,
        name: 'Nhập sản phẩm từ phiếu nhập hàng',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_RETURN_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_RETURN_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_RETURN_PRODUCT}`,
        name: 'Hoàn trả sản phẩm từ phiếu nhập hàng',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_CLOSE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_CLOSE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_CLOSE}`,
        name: 'Đóng phiếu',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_TERMINATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_TERMINATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_TERMINATE}`,
        name: 'Hủy phiếu',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
    {
        id: permission_enum_1.PermissionId.PURCHASE_ORDER_CANCELLED_DESTROY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.PURCHASE_ORDER_CANCELLED_DESTROY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PURCHASE_ORDER}.${permission_enum_1.PermissionId.PURCHASE_ORDER_CANCELLED_DESTROY}`,
        name: 'Xóa phiếu đã hủy',
        parentId: permission_enum_1.PermissionId.PURCHASE_ORDER,
        rootId: permission_enum_1.PermissionId.PURCHASE_ORDER,
    },
];


/***/ }),
/* 483 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionRadiology = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionRadiology = [
    {
        id: permission_enum_1.PermissionId.RADIOLOGY,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}`,
        name: 'Quản lý phiếu CĐHA',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_MENU}`,
        name: 'Xem menu phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_CREATE}`,
        name: 'Thêm phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_UPDATE}`,
        name: 'Sửa phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_DELETE}`,
        name: 'Xóa phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD}`,
        name: 'Thêm, sửa, xóa nhóm phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD}`,
        name: 'Thêm, sửa, xóa kết quả phiếu CĐHA mẫu',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
];


/***/ }),
/* 484 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionStatistic = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionStatistic = [
    {
        id: permission_enum_1.PermissionId.STATISTIC,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}`,
        name: 'Quản lý thống kê',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_TICKET,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_TICKET],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_TICKET}`,
        name: 'Xem thống kê phiếu thu',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_PURCHASE_ORDER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_PURCHASE_ORDER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_PURCHASE_ORDER}`,
        name: 'Xem thống kê phiếu nhập',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_PRODUCT}`,
        name: 'Xem thống kê sản phẩm',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_CUSTOMER,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_CUSTOMER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_CUSTOMER}`,
        name: 'Xem thống kê khách hàng',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_PROCEDURE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_PROCEDURE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_PROCEDURE}`,
        name: 'Xem thống kê dịch vụ',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_LABORATORY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_LABORATORY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_LABORATORY}`,
        name: 'Xem thống kê xét nghiệm',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
    {
        id: permission_enum_1.PermissionId.STATISTIC_RADIOLOGY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STATISTIC_RADIOLOGY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STATISTIC}.${permission_enum_1.PermissionId.STATISTIC_RADIOLOGY}`,
        name: 'Xem thống kê phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.STATISTIC,
        rootId: permission_enum_1.PermissionId.STATISTIC,
    },
];


/***/ }),
/* 485 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionStockCheck = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionStockCheck = [
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}`,
        name: 'Quản lý phiếu kiểm kê',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_MENU}`,
        name: 'Xem menu phiếu kiểm kê',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD}`,
        name: 'Tạo, sửa, xóa phiếu nháp',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_SUBMIT}`,
        name: 'Đề nghị duyệt phiếu kiểm kê',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_PENDING_APPROVE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_PENDING_APPROVE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_PENDING_APPROVE}`,
        name: 'Duyệt phiếu kiểm kê',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_CONFIRMED_RECONCILE}`,
        name: '*** Tiến hành cân bằng kho',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_TERMINATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_TERMINATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_TERMINATE}`,
        name: 'Hủy phiếu',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
    {
        id: permission_enum_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.STOCK_CHECK}.${permission_enum_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY}`,
        name: 'Xóa phiếu đã hủy',
        parentId: permission_enum_1.PermissionId.STOCK_CHECK,
        rootId: permission_enum_1.PermissionId.STOCK_CHECK,
    },
];


/***/ }),
/* 486 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionTicket = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionTicket = [
    {
        id: permission_enum_1.PermissionId.TICKET,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}`,
        name: 'Quản lý tiếp đón khách hàng',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_DRAFT_CRUD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_DRAFT_CRUD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_DRAFT_CRUD}`,
        name: 'Thêm, sửa, xóa phiếu nháp',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_START_EXECUTING,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_START_EXECUTING],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_START_EXECUTING}`,
        name: 'Vào phòng',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_ATTRIBUTE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_ATTRIBUTE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_ATTRIBUTE}`,
        name: 'Khám và chẩn đoán',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_USER_POSITION,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_USER_POSITION],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_USER_POSITION}`,
        name: 'Chọn nhân viên thực hiện',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_USER_COMMISSION,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_USER_COMMISSION],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_USER_COMMISSION}`,
        name: 'Chỉnh sửa tiền hoa hồng ***',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE}`,
        name: 'Chỉ định dịch vụ',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE_RESULT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE_RESULT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE_RESULT}`,
        name: 'Trả kết quả thực hiện dịch vụ',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT}`,
        name: 'Chỉ định sản phẩm',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE}`,
        name: 'Chỉ định vật tư tiêu hao',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION}`,
        name: 'Kê đơn thuốc',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY}`,
        name: 'Chỉ định Xét nghiệm',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY_RESULT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY_RESULT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY_RESULT}`,
        name: 'Trả kết quả Xét nghiệm',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY}`,
        name: 'Chỉ định CĐHA',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY_RESULT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY_RESULT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.RADIOLOGY}.${permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY_RESULT}`,
        name: 'Trả kết quả phiếu CĐHA',
        parentId: permission_enum_1.PermissionId.RADIOLOGY,
        rootId: permission_enum_1.PermissionId.RADIOLOGY,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT}`,
        name: 'Xuất sản phẩm',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_RETURN_PRODUCT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_RETURN_PRODUCT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_RETURN_PRODUCT}`,
        name: 'Hoàn trả sản phẩm',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY}`,
        name: 'Tạo phiếu thanh toán với khách hàng',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_REFUND_MONEY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_REFUND_MONEY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_REFUND_MONEY}`,
        name: 'Tạo phiếu hoàn trả tiền cho khách hàng',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CHANGE_DISCOUNT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CHANGE_DISCOUNT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.PAYMENT}.${permission_enum_1.PermissionId.TICKET_CHANGE_DISCOUNT}`,
        name: 'Chỉnh sửa giá tiền và chiết khấu',
        parentId: permission_enum_1.PermissionId.PAYMENT,
        rootId: permission_enum_1.PermissionId.PAYMENT,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_CLOSE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_CLOSE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_CLOSE}`,
        name: 'Kết thúc phiếu',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_REOPEN,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_REOPEN],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_REOPEN}`,
        name: 'Mở lại phiếu',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_TERMINATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_TERMINATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_TERMINATE}`,
        name: 'Hủy phiếu',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
    {
        id: permission_enum_1.PermissionId.TICKET_DESTROY,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.TICKET_DESTROY],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.TICKET}.${permission_enum_1.PermissionId.TICKET_DESTROY}`,
        name: 'Xóa phiếu',
        parentId: permission_enum_1.PermissionId.TICKET,
        rootId: permission_enum_1.PermissionId.TICKET,
    },
];


/***/ }),
/* 487 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.permissionUser = void 0;
const permission_enum_1 = __webpack_require__(83);
exports.permissionUser = [
    {
        id: permission_enum_1.PermissionId.USER,
        level: 1,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}`,
        name: 'Quản lý nhân viên (Admin)',
        parentId: 0,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_MENU}`,
        name: 'Xem menu danh sách nhân viên',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_CREATE}`,
        name: 'Thêm tài khoản nhân viên mới',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_UPDATE}`,
        name: 'Sửa tài khoản nhân viên',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_DELETE}`,
        name: 'Xóa tài khoản nhân viên',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_CHANGE_PASSWORD,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_CHANGE_PASSWORD],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_CHANGE_PASSWORD}`,
        name: 'Đổi mật khẩu tài khoản nhân viên',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ACCOUNT_LOGOUT,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ACCOUNT_LOGOUT],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ACCOUNT_LOGOUT}`,
        name: 'Đăng xuất tài khoản nhân viên',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ROLE_MENU,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ROLE_MENU],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ROLE_MENU}`,
        name: 'Xem menu vai trò',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ROLE_CREATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ROLE_CREATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ROLE_CREATE}`,
        name: 'Thêm vai trò mới',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ROLE_UPDATE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ROLE_UPDATE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ROLE_UPDATE}`,
        name: 'Sửa vai trò',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
    {
        id: permission_enum_1.PermissionId.USER_ROLE_DELETE,
        level: 2,
        code: permission_enum_1.PermissionId[permission_enum_1.PermissionId.USER_ROLE_DELETE],
        isActive: 1,
        pathId: `${permission_enum_1.PermissionId.USER}.${permission_enum_1.PermissionId.USER_ROLE_DELETE}`,
        name: 'Xóa vai trò',
        parentId: permission_enum_1.PermissionId.USER,
        rootId: permission_enum_1.PermissionId.USER,
    },
];


/***/ }),
/* 488 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(489), exports);
__exportStar(__webpack_require__(490), exports);


/***/ }),
/* 489 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionGetOneQuery = exports.PermissionGetManyQuery = exports.PermissionPaginationQuery = exports.PermissionGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const permission_options_request_1 = __webpack_require__(490);
class PermissionGetQuery {
}
exports.PermissionGetQuery = PermissionGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof permission_options_request_1.PermissionRelationQuery !== "undefined" && permission_options_request_1.PermissionRelationQuery) === "function" ? _a : Object)
], PermissionGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            level: { EQUAL: 1 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof permission_options_request_1.PermissionFilterQuery !== "undefined" && permission_options_request_1.PermissionFilterQuery) === "function" ? _b : Object)
], PermissionGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(permission_options_request_1.PermissionSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof permission_options_request_1.PermissionSortQuery !== "undefined" && permission_options_request_1.PermissionSortQuery) === "function" ? _c : Object)
], PermissionGetQuery.prototype, "sort", void 0);
class PermissionPaginationQuery extends (0, swagger_1.IntersectionType)(PermissionGetQuery, query_1.PaginationQuery) {
}
exports.PermissionPaginationQuery = PermissionPaginationQuery;
class PermissionGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PermissionGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PermissionGetManyQuery = PermissionGetManyQuery;
class PermissionGetOneQuery extends (0, swagger_1.PickType)(PermissionGetQuery, ['relation']) {
}
exports.PermissionGetOneQuery = PermissionGetOneQuery;


/***/ }),
/* 490 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PermissionSortQuery = exports.PermissionFilterQuery = exports.PermissionRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class PermissionRelationQuery {
}
exports.PermissionRelationQuery = PermissionRelationQuery;
class PermissionFilterQuery {
}
exports.PermissionFilterQuery = PermissionFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _a : Object)
], PermissionFilterQuery.prototype, "level", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof dto_1.ConditionNumber !== "undefined" && dto_1.ConditionNumber) === "function" ? _b : Object)
], PermissionFilterQuery.prototype, "rootId", void 0);
class PermissionSortQuery extends query_1.SortQuery {
}
exports.PermissionSortQuery = PermissionSortQuery;


/***/ }),
/* 491 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPositionModule = void 0;
const common_1 = __webpack_require__(3);
const api_position_controller_1 = __webpack_require__(492);
const api_position_service_1 = __webpack_require__(493);
let ApiPositionModule = class ApiPositionModule {
};
exports.ApiPositionModule = ApiPositionModule;
exports.ApiPositionModule = ApiPositionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_position_controller_1.ApiPositionController],
        providers: [api_position_service_1.ApiPositionService],
    })
], ApiPositionModule);


/***/ }),
/* 492 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPositionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_position_service_1 = __webpack_require__(493);
const request_1 = __webpack_require__(438);
let ApiPositionController = class ApiPositionController {
    constructor(apiPositionService) {
        this.apiPositionService = apiPositionService;
    }
    pagination({ oid }, query) {
        return this.apiPositionService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiPositionService.getMany(oid, query);
    }
    findOne({ oid }, { id }, query) {
        return this.apiPositionService.getOne(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiPositionService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiPositionService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiPositionService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiPositionService.replaceList(oid, body);
    }
};
exports.ApiPositionController = ApiPositionController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PositionPaginationQuery !== "undefined" && request_1.PositionPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPositionController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PositionGetManyQuery !== "undefined" && request_1.PositionGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiPositionController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.PositionGetOneQuery !== "undefined" && request_1.PositionGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", void 0)
], ApiPositionController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_POSITION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.PositionCreateBody !== "undefined" && request_1.PositionCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiPositionController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_POSITION),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.PositionUpdateBody !== "undefined" && request_1.PositionUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiPositionController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_POSITION),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiPositionController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_POSITION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.PositionReplaceListBody !== "undefined" && request_1.PositionReplaceListBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiPositionController.prototype, "replaceAll", null);
exports.ApiPositionController = ApiPositionController = __decorate([
    (0, swagger_1.ApiTags)('Position'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('position'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_position_service_1.ApiPositionService !== "undefined" && api_position_service_1.ApiPositionService) === "function" ? _a : Object])
], ApiPositionController);


/***/ }),
/* 493 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPositionService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const position_repository_1 = __webpack_require__(116);
let ApiPositionService = class ApiPositionService {
    constructor(positionRepository, productRepository, procedureRepository, radiologyRepository, laboratoryRepository) {
        this.positionRepository = positionRepository;
        this.productRepository = productRepository;
        this.procedureRepository = procedureRepository;
        this.radiologyRepository = radiologyRepository;
        this.laboratoryRepository = laboratoryRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.positionRepository.pagination({
            relation: {
                role: relation === null || relation === void 0 ? void 0 : relation.role,
            },
            page,
            limit,
            condition: {
                oid,
                positionType: filter === null || filter === void 0 ? void 0 : filter.positionType,
                roleId: filter === null || filter === void 0 ? void 0 : filter.roleId,
                positionInteractId: filter === null || filter === void 0 ? void 0 : filter.positionInteractId,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation(data, query.relation);
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const positionList = await this.positionRepository.findMany({
            relation: {
                role: relation === null || relation === void 0 ? void 0 : relation.role,
            },
            condition: {
                oid,
                positionType: filter === null || filter === void 0 ? void 0 : filter.positionType,
                roleId: filter === null || filter === void 0 ? void 0 : filter.roleId,
                positionInteractId: filter === null || filter === void 0 ? void 0 : filter.positionInteractId,
            },
            limit,
            sort,
        });
        if (query.relation) {
            await this.generateRelation(positionList, query.relation);
        }
        return { data: { positionList } };
    }
    async getOne(oid, id, query) {
        var _a;
        const position = await this.positionRepository.findOne({
            relation: { role: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.role },
            condition: { oid, id },
        });
        if (!position)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation([position], query.relation);
        }
        return { data: { position } };
    }
    async createOne(oid, body) {
        const existPosition = await this.positionRepository.findOneBy({
            oid,
            roleId: body.roleId,
            positionType: body.positionType,
            positionInteractId: body.positionInteractId,
        });
        if (existPosition) {
            throw new exception_filter_1.BusinessException('error.Conflict', {
                obj: `Không thể tạo bản ghi trùng lặp. `
                    + `Đã tồn tại bản ghi nội dung tương tự với id = ${existPosition.id}`,
            });
        }
        const position = await this.positionRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { position } };
    }
    async updateOne(oid, id, body) {
        const existPosition = await this.positionRepository.findOneBy({
            id: { NOT: id },
            oid,
            roleId: body.roleId,
            positionType: body.positionType,
            positionInteractId: body.positionInteractId,
        });
        if (existPosition) {
            throw new exception_filter_1.BusinessException('error.Conflict', {
                obj: `Không thể tạo bản ghi trùng lặp. `
                    + `Đã tồn tại bản ghi nội dung tương tự với id = ${existPosition.id}`,
            });
        }
        const positionList = await this.positionRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { position: positionList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.positionRepository.delete({ oid, id });
        if (affected === 0)
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        return { data: true };
    }
    async replaceList(oid, body) {
        var _a;
        await this.positionRepository.delete({
            oid,
            positionType: (_a = body.filter) === null || _a === void 0 ? void 0 : _a.positionType,
        });
        const positionInsertListDto = body.positionData.map((i) => {
            const dto = Object.assign(Object.assign({}, i), { oid });
            return dto;
        });
        const positionList = await this.positionRepository.insertManyAndReturnEntity(positionInsertListDto);
        return { data: { positionList } };
    }
    async generateRelation(positionList, relation) {
        const productIdList = positionList
            .filter((i) => i.positionType === position_entity_1.PositionInteractType.Product)
            .map((i) => i.positionInteractId);
        const procedureIdList = positionList
            .filter((i) => i.positionType === position_entity_1.PositionInteractType.Procedure)
            .map((i) => i.positionInteractId);
        const radiologyIdList = positionList
            .filter((i) => i.positionType === position_entity_1.PositionInteractType.Radiology)
            .map((i) => i.positionInteractId);
        const laboratoryIdList = positionList
            .filter((i) => i.positionType === position_entity_1.PositionInteractType.Laboratory)
            .map((i) => i.positionInteractId);
        const [productList, procedureList, radiologyList, laboratoryList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.product) && productIdList.length
                ? this.productRepository.findManyBy({ id: { IN: array_helper_1.ESArray.uniqueArray(productIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.procedure) && procedureIdList.length
                ? this.procedureRepository.findMany({
                    condition: { id: { IN: array_helper_1.ESArray.uniqueArray(procedureIdList) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.radiology) && radiologyIdList.length
                ? this.radiologyRepository.findManyBy({ id: { IN: array_helper_1.ESArray.uniqueArray(radiologyIdList) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.laboratory) && laboratoryIdList.length
                ? this.laboratoryRepository.findMany({
                    condition: { id: { IN: array_helper_1.ESArray.uniqueArray(laboratoryIdList) } },
                })
                : [],
        ]);
        positionList.forEach((position) => {
            if (position.positionType === position_entity_1.PositionInteractType.Product) {
                position.product = productList.find((i) => i.id === position.positionInteractId);
            }
            if (position.positionType === position_entity_1.PositionInteractType.Procedure) {
                position.procedure = procedureList.find((i) => i.id === position.positionInteractId);
            }
            if (position.positionType === position_entity_1.PositionInteractType.Radiology) {
                position.radiology = radiologyList.find((i) => i.id === position.positionInteractId);
            }
            if (position.positionType === position_entity_1.PositionInteractType.Laboratory) {
                position.laboratory = laboratoryList.find((i) => i.id === position.positionInteractId);
            }
        });
        return positionList;
    }
};
exports.ApiPositionService = ApiPositionService;
exports.ApiPositionService = ApiPositionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof position_repository_1.PositionRepository !== "undefined" && position_repository_1.PositionRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.LaboratoryRepository !== "undefined" && repositories_1.LaboratoryRepository) === "function" ? _e : Object])
], ApiPositionService);


/***/ }),
/* 494 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleModule = void 0;
const common_1 = __webpack_require__(3);
const api_prescription_sample_controller_1 = __webpack_require__(495);
const api_prescription_sample_service_1 = __webpack_require__(496);
let ApiPrescriptionSampleModule = class ApiPrescriptionSampleModule {
};
exports.ApiPrescriptionSampleModule = ApiPrescriptionSampleModule;
exports.ApiPrescriptionSampleModule = ApiPrescriptionSampleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_prescription_sample_controller_1.ApiPrescriptionSampleController],
        providers: [api_prescription_sample_service_1.ApiPrescriptionSampleService],
    })
], ApiPrescriptionSampleModule);


/***/ }),
/* 495 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_prescription_sample_service_1 = __webpack_require__(496);
const request_1 = __webpack_require__(497);
let ApiPrescriptionSampleController = class ApiPrescriptionSampleController {
    constructor(apiPrescriptionSampleService) {
        this.apiPrescriptionSampleService = apiPrescriptionSampleService;
    }
    pagination({ oid }, query) {
        return this.apiPrescriptionSampleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiPrescriptionSampleService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiPrescriptionSampleService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiPrescriptionSampleService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiPrescriptionSampleService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiPrescriptionSampleService.destroyOne(oid, id);
    }
};
exports.ApiPrescriptionSampleController = ApiPrescriptionSampleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PrescriptionSamplePaginationQuery !== "undefined" && request_1.PrescriptionSamplePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.PrescriptionSampleGetManyQuery !== "undefined" && request_1.PrescriptionSampleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiPrescriptionSampleController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.PrescriptionSampleCreateBody !== "undefined" && request_1.PrescriptionSampleCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.PrescriptionSampleUpdateBody !== "undefined" && request_1.PrescriptionSampleUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRESCRIPTION_SAMPLE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiPrescriptionSampleController.prototype, "destroyOne", null);
exports.ApiPrescriptionSampleController = ApiPrescriptionSampleController = __decorate([
    (0, swagger_1.ApiTags)('PrescriptionSample'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('prescription-sample'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_prescription_sample_service_1.ApiPrescriptionSampleService !== "undefined" && api_prescription_sample_service_1.ApiPrescriptionSampleService) === "function" ? _a : Object])
], ApiPrescriptionSampleController);


/***/ }),
/* 496 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrescriptionSampleService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const prescription_sample_repository_1 = __webpack_require__(117);
const product_repository_1 = __webpack_require__(124);
let ApiPrescriptionSampleService = class ApiPrescriptionSampleService {
    constructor(prescriptionSampleRepository, productRepository) {
        this.prescriptionSampleRepository = prescriptionSampleRepository;
        this.productRepository = productRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.prescriptionSampleRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                userId: filter === null || filter === void 0 ? void 0 : filter.userId,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.prescriptionSampleRepository.findMany({
            condition: {
                oid,
                userId: filter === null || filter === void 0 ? void 0 : filter.userId,
            },
            limit,
            sort,
        });
        if (relation === null || relation === void 0 ? void 0 : relation.medicineList) {
            const productIdList = data
                .map((i) => {
                try {
                    i.medicineList = JSON.parse(i.medicines || '[]');
                }
                catch (error) {
                    i.medicineList = [];
                }
                return i.medicineList;
            })
                .flat()
                .map((i) => i.productId);
            const productList = await this.productRepository.findManyBy({
                oid,
                id: { IN: productIdList },
            });
            const productMap = (0, array_helper_1.arrayToKeyValue)(productList, 'id');
            data.forEach((i) => {
                i.medicineList.forEach((j) => {
                    j.product = productMap[j.productId] || null;
                });
            });
        }
        return { data };
    }
    async getOne(oid, id) {
        const prescriptionSample = await this.prescriptionSampleRepository.findOneBy({ oid, id });
        if (!prescriptionSample)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { prescriptionSample } };
    }
    async createOne(oid, body) {
        const prescriptionSample = await this.prescriptionSampleRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body), { oid }));
        return { data: { prescriptionSample } };
    }
    async updateOne(oid, id, body) {
        const prescriptionSampleList = await this.prescriptionSampleRepository.updateAndReturnEntity({ id, oid }, body);
        return { data: { prescriptionSample: prescriptionSampleList[0] } };
    }
    async destroyOne(oid, id) {
        const affected = await this.prescriptionSampleRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { data: true };
    }
};
exports.ApiPrescriptionSampleService = ApiPrescriptionSampleService;
exports.ApiPrescriptionSampleService = ApiPrescriptionSampleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prescription_sample_repository_1.PrescriptionSampleRepository !== "undefined" && prescription_sample_repository_1.PrescriptionSampleRepository) === "function" ? _a : Object, typeof (_b = typeof product_repository_1.ProductRepository !== "undefined" && product_repository_1.ProductRepository) === "function" ? _b : Object])
], ApiPrescriptionSampleService);


/***/ }),
/* 497 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(498), exports);
__exportStar(__webpack_require__(499), exports);
__exportStar(__webpack_require__(500), exports);


/***/ }),
/* 498 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleSortQuery = exports.PrescriptionSampleFilterQuery = exports.PrescriptionSampleRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class PrescriptionSampleRelationQuery {
}
exports.PrescriptionSampleRelationQuery = PrescriptionSampleRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PrescriptionSampleRelationQuery.prototype, "medicineList", void 0);
class PrescriptionSampleFilterQuery {
}
exports.PrescriptionSampleFilterQuery = PrescriptionSampleFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], PrescriptionSampleFilterQuery.prototype, "userId", void 0);
class PrescriptionSampleSortQuery extends query_1.SortQuery {
}
exports.PrescriptionSampleSortQuery = PrescriptionSampleSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PrescriptionSampleSortQuery.prototype, "priority", void 0);


/***/ }),
/* 499 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleUpdateBody = exports.PrescriptionSampleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PrescriptionSampleCreateBody {
}
exports.PrescriptionSampleCreateBody = PrescriptionSampleCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PrescriptionSampleCreateBody.prototype, "userId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PrescriptionSampleCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], PrescriptionSampleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrescriptionSampleCreateBody.prototype, "medicines", void 0);
class PrescriptionSampleUpdateBody extends (0, swagger_1.PartialType)(PrescriptionSampleCreateBody) {
}
exports.PrescriptionSampleUpdateBody = PrescriptionSampleUpdateBody;


/***/ }),
/* 500 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrescriptionSampleGetOneQuery = exports.PrescriptionSampleGetManyQuery = exports.PrescriptionSamplePaginationQuery = exports.PrescriptionSampleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const prescription_sample_options_request_1 = __webpack_require__(498);
class PrescriptionSampleGetQuery {
}
exports.PrescriptionSampleGetQuery = PrescriptionSampleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof prescription_sample_options_request_1.PrescriptionSampleRelationQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleRelationQuery) === "function" ? _a : Object)
], PrescriptionSampleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof prescription_sample_options_request_1.PrescriptionSampleFilterQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleFilterQuery) === "function" ? _b : Object)
], PrescriptionSampleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(prescription_sample_options_request_1.PrescriptionSampleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof prescription_sample_options_request_1.PrescriptionSampleSortQuery !== "undefined" && prescription_sample_options_request_1.PrescriptionSampleSortQuery) === "function" ? _c : Object)
], PrescriptionSampleGetQuery.prototype, "sort", void 0);
class PrescriptionSamplePaginationQuery extends (0, swagger_1.IntersectionType)(PrescriptionSampleGetQuery, query_1.PaginationQuery) {
}
exports.PrescriptionSamplePaginationQuery = PrescriptionSamplePaginationQuery;
class PrescriptionSampleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PrescriptionSampleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PrescriptionSampleGetManyQuery = PrescriptionSampleGetManyQuery;
class PrescriptionSampleGetOneQuery extends (0, swagger_1.PickType)(PrescriptionSampleGetQuery, [
    'relation',
]) {
}
exports.PrescriptionSampleGetOneQuery = PrescriptionSampleGetOneQuery;


/***/ }),
/* 501 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlSettingModule = void 0;
const common_1 = __webpack_require__(3);
const api_print_html_setting_controller_1 = __webpack_require__(502);
const api_print_html_setting_service_1 = __webpack_require__(503);
let ApiPrintHtmlSettingModule = class ApiPrintHtmlSettingModule {
};
exports.ApiPrintHtmlSettingModule = ApiPrintHtmlSettingModule;
exports.ApiPrintHtmlSettingModule = ApiPrintHtmlSettingModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_print_html_setting_controller_1.ApiPrintHtmlSettingController],
        providers: [api_print_html_setting_service_1.ApiPrintHtmlSettingService],
    })
], ApiPrintHtmlSettingModule);


/***/ }),
/* 502 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlSettingController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_print_html_setting_service_1 = __webpack_require__(503);
const request_1 = __webpack_require__(504);
let ApiPrintHtmlSettingController = class ApiPrintHtmlSettingController {
    constructor(apiPrintHtmlSettingService) {
        this.apiPrintHtmlSettingService = apiPrintHtmlSettingService;
    }
    async getList({ oid }, query) {
        const data = await this.apiPrintHtmlSettingService.getList(oid, query);
        return { data };
    }
    async saveListDefault({ oid }, body) {
        const data = await this.apiPrintHtmlSettingService.replaceAll(oid, body);
        return { data };
    }
};
exports.ApiPrintHtmlSettingController = ApiPrintHtmlSettingController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PrintHtmlSettingGetManyQuery !== "undefined" && request_1.PrintHtmlSettingGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPrintHtmlSettingController.prototype, "getList", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.PrintHtmlSettingReplaceAllBody !== "undefined" && request_1.PrintHtmlSettingReplaceAllBody) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiPrintHtmlSettingController.prototype, "saveListDefault", null);
exports.ApiPrintHtmlSettingController = ApiPrintHtmlSettingController = __decorate([
    (0, swagger_1.ApiTags)('PrintHtmlSetting'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('print-html-setting'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_print_html_setting_service_1.ApiPrintHtmlSettingService !== "undefined" && api_print_html_setting_service_1.ApiPrintHtmlSettingService) === "function" ? _a : Object])
], ApiPrintHtmlSettingController);


/***/ }),
/* 503 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlSettingService = void 0;
const common_1 = __webpack_require__(3);
const print_html_setting_repository_1 = __webpack_require__(118);
let ApiPrintHtmlSettingService = class ApiPrintHtmlSettingService {
    constructor(printHtmlRepository, printHtmlManager) {
        this.printHtmlRepository = printHtmlRepository;
        this.printHtmlManager = printHtmlManager;
    }
    async getList(oid, query) {
        const { limit, filter, relation, sort } = query;
        const printHtmlSettingList = await this.printHtmlRepository.findMany({
            relation,
            condition: {
                oid: { IN: [1, oid] },
            },
            limit,
            sort,
        });
        return { printHtmlSettingList };
    }
    async replaceAll(oid, body) {
        const idAll = body.replaceAll.map((i) => i.id);
        await this.printHtmlRepository.delete({ oid, id: { NOT_IN: idAll } });
        const printHtmlInsertList = body.replaceAll
            .filter((i) => i.id === 0)
            .map((i) => {
            const insertList = Object.assign(Object.assign({}, i), { oid });
            return insertList;
        });
        await this.printHtmlRepository.insertManyFullFieldAndReturnEntity(printHtmlInsertList);
        const replaceAll = body.replaceAll.filter((i) => !!i.id);
        await this.printHtmlManager.bulkUpdate({
            manager: this.printHtmlRepository.getManager(),
            condition: { oid },
            compare: ['id'],
            update: ['printHtmlType', 'printHtmlId'],
            tempList: replaceAll,
            options: { requireEqualLength: true },
        });
        return true;
    }
};
exports.ApiPrintHtmlSettingService = ApiPrintHtmlSettingService;
exports.ApiPrintHtmlSettingService = ApiPrintHtmlSettingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof print_html_setting_repository_1.PrintHtmlSettingRepository !== "undefined" && print_html_setting_repository_1.PrintHtmlSettingRepository) === "function" ? _a : Object, typeof (_b = typeof print_html_setting_repository_1.PrintHtmlSettingManager !== "undefined" && print_html_setting_repository_1.PrintHtmlSettingManager) === "function" ? _b : Object])
], ApiPrintHtmlSettingService);


/***/ }),
/* 504 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(505), exports);
__exportStar(__webpack_require__(506), exports);
__exportStar(__webpack_require__(507), exports);


/***/ }),
/* 505 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSettingGetOneQuery = exports.PrintHtmlSettingGetManyQuery = exports.PrintHtmlSettingPaginationQuery = exports.PrintHtmlSettingGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const print_html_setting_options_request_1 = __webpack_require__(506);
class PrintHtmlSettingGetQuery {
}
exports.PrintHtmlSettingGetQuery = PrintHtmlSettingGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_setting_options_request_1.PrintHtmlSettingRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof print_html_setting_options_request_1.PrintHtmlSettingRelationQuery !== "undefined" && print_html_setting_options_request_1.PrintHtmlSettingRelationQuery) === "function" ? _a : Object)
], PrintHtmlSettingGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_setting_options_request_1.PrintHtmlSettingFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof print_html_setting_options_request_1.PrintHtmlSettingFilterQuery !== "undefined" && print_html_setting_options_request_1.PrintHtmlSettingFilterQuery) === "function" ? _b : Object)
], PrintHtmlSettingGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_setting_options_request_1.PrintHtmlSettingSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof print_html_setting_options_request_1.PrintHtmlSettingSortQuery !== "undefined" && print_html_setting_options_request_1.PrintHtmlSettingSortQuery) === "function" ? _c : Object)
], PrintHtmlSettingGetQuery.prototype, "sort", void 0);
class PrintHtmlSettingPaginationQuery extends (0, swagger_1.IntersectionType)(PrintHtmlSettingGetQuery, query_1.PaginationQuery) {
}
exports.PrintHtmlSettingPaginationQuery = PrintHtmlSettingPaginationQuery;
class PrintHtmlSettingGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PrintHtmlSettingGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PrintHtmlSettingGetManyQuery = PrintHtmlSettingGetManyQuery;
class PrintHtmlSettingGetOneQuery extends (0, swagger_1.PickType)(PrintHtmlSettingGetQuery, ['filter', 'relation']) {
}
exports.PrintHtmlSettingGetOneQuery = PrintHtmlSettingGetOneQuery;


/***/ }),
/* 506 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSettingSortQuery = exports.PrintHtmlSettingFilterQuery = exports.PrintHtmlSettingRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class PrintHtmlSettingRelationQuery {
}
exports.PrintHtmlSettingRelationQuery = PrintHtmlSettingRelationQuery;
class PrintHtmlSettingFilterQuery {
}
exports.PrintHtmlSettingFilterQuery = PrintHtmlSettingFilterQuery;
class PrintHtmlSettingSortQuery extends query_1.SortQuery {
}
exports.PrintHtmlSettingSortQuery = PrintHtmlSettingSortQuery;


/***/ }),
/* 507 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSettingReplaceAllBody = exports.PrintHtmlSettingReplace = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PrintHtmlSettingReplace {
}
exports.PrintHtmlSettingReplace = PrintHtmlSettingReplace;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], PrintHtmlSettingReplace.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], PrintHtmlSettingReplace.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], PrintHtmlSettingReplace.prototype, "printHtmlType", void 0);
class PrintHtmlSettingReplaceAllBody {
}
exports.PrintHtmlSettingReplaceAllBody = PrintHtmlSettingReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: PrintHtmlSettingReplace, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => PrintHtmlSettingReplace),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], PrintHtmlSettingReplaceAllBody.prototype, "replaceAll", void 0);


/***/ }),
/* 508 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlModule = void 0;
const common_1 = __webpack_require__(3);
const api_print_html_controller_1 = __webpack_require__(509);
const api_print_html_service_1 = __webpack_require__(510);
let ApiPrintHtmlModule = class ApiPrintHtmlModule {
};
exports.ApiPrintHtmlModule = ApiPrintHtmlModule;
exports.ApiPrintHtmlModule = ApiPrintHtmlModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_print_html_controller_1.ApiPrintHtmlController],
        providers: [api_print_html_service_1.ApiPrintHtmlService],
    })
], ApiPrintHtmlModule);


/***/ }),
/* 509 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_print_html_service_1 = __webpack_require__(510);
const request_1 = __webpack_require__(511);
let ApiPrintHtmlController = class ApiPrintHtmlController {
    constructor(apiPrintHtmlService) {
        this.apiPrintHtmlService = apiPrintHtmlService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiPrintHtmlService.pagination(oid, query);
        return { data };
    }
    async getList({ oid }, query) {
        const data = await this.apiPrintHtmlService.getList(oid, query);
        return { data };
    }
    async getOne({ oid }, query) {
        const data = await this.apiPrintHtmlService.getOne(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }, query) {
        const data = await this.apiPrintHtmlService.detail(oid, id, query);
        return { data };
    }
    async createOne({ oid }, body) {
        const data = await this.apiPrintHtmlService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiPrintHtmlService.updateOne(oid, id, body);
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiPrintHtmlService.destroyOne(oid, id);
        return { data };
    }
    async systemList() {
        const data = await this.apiPrintHtmlService.systemList();
        return { data };
    }
};
exports.ApiPrintHtmlController = ApiPrintHtmlController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PrintHtmlPaginationQuery !== "undefined" && request_1.PrintHtmlPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPrintHtmlController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('get-list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.PrintHtmlGetManyQuery !== "undefined" && request_1.PrintHtmlGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiPrintHtmlController.prototype, "getList", null);
__decorate([
    (0, common_1.Get)('get-one'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.PrintHtmlGetOneQuery !== "undefined" && request_1.PrintHtmlGetOneQuery) === "function" ? _j : Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], ApiPrintHtmlController.prototype, "getOne", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.PrintHtmlGetOneQuery !== "undefined" && request_1.PrintHtmlGetOneQuery) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiPrintHtmlController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.PrintHtmlCreateBody !== "undefined" && request_1.PrintHtmlCreateBody) === "function" ? _r : Object]),
    __metadata("design:returntype", typeof (_s = typeof Promise !== "undefined" && Promise) === "function" ? _s : Object)
], ApiPrintHtmlController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _u : Object, typeof (_v = typeof request_1.PrintHtmlUpdateBody !== "undefined" && request_1.PrintHtmlUpdateBody) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiPrintHtmlController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_PRINT_HTML),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], ApiPrintHtmlController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.UserPermission)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiPrintHtmlController.prototype, "systemList", null);
exports.ApiPrintHtmlController = ApiPrintHtmlController = __decorate([
    (0, swagger_1.ApiTags)('PrintHtml'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('print-html'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_print_html_service_1.ApiPrintHtmlService !== "undefined" && api_print_html_service_1.ApiPrintHtmlService) === "function" ? _a : Object])
], ApiPrintHtmlController);


/***/ }),
/* 510 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPrintHtmlService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const print_html_repository_1 = __webpack_require__(119);
let ApiPrintHtmlService = class ApiPrintHtmlService {
    constructor(printHtmlRepository) {
        this.printHtmlRepository = printHtmlRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.printHtmlRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort: sort || { priority: 'ASC' },
        });
        return { printHtmlList: data, total, page, limit };
    }
    async getList(oid, query) {
        const { limit, filter, relation, sort } = query;
        const printHtmlList = await this.printHtmlRepository.findMany({
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
            sort: sort || { priority: 'ASC' },
        });
        return { printHtmlList };
    }
    async getOne(oid, query) {
        const { filter, relation } = query;
        const printHtml = await this.printHtmlRepository.findOne({
            relation,
            condition: {
                oid: { IN: [1, oid] },
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
        });
        return { printHtml };
    }
    async detail(oid, id, query) {
        const printHtml = await this.printHtmlRepository.findOne({
            condition: {
                oid: { IN: [1, oid] },
                id,
            },
            relation: query.relation,
        });
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { printHtml };
    }
    async createOne(oid, body) {
        const printHtml = await this.printHtmlRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, body));
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.InsertFailed');
        return { printHtml };
    }
    async updateOne(oid, id, body) {
        const printHtml = await this.printHtmlRepository.updateOneAndReturnEntity({ id, oid }, body);
        if (!printHtml)
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        return { printHtml };
    }
    async destroyOne(oid, id) {
        const affected = await this.printHtmlRepository.delete({ oid, id });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        return { printHtmlId: id };
    }
    async systemList() {
        const printHtmlSystem = await this.printHtmlRepository.findMany({
            condition: { oid: 1 },
            sort: { id: 'ASC' },
        });
        return { printHtmlSystem };
    }
};
exports.ApiPrintHtmlService = ApiPrintHtmlService;
exports.ApiPrintHtmlService = ApiPrintHtmlService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof print_html_repository_1.PrintHtmlRepository !== "undefined" && print_html_repository_1.PrintHtmlRepository) === "function" ? _a : Object])
], ApiPrintHtmlService);


/***/ }),
/* 511 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(512), exports);
__exportStar(__webpack_require__(513), exports);
__exportStar(__webpack_require__(514), exports);


/***/ }),
/* 512 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlGetOneQuery = exports.PrintHtmlGetManyQuery = exports.PrintHtmlPaginationQuery = exports.PrintHtmlGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const print_html_options_request_1 = __webpack_require__(513);
class PrintHtmlGetQuery {
}
exports.PrintHtmlGetQuery = PrintHtmlGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof print_html_options_request_1.PrintHtmlRelationQuery !== "undefined" && print_html_options_request_1.PrintHtmlRelationQuery) === "function" ? _a : Object)
], PrintHtmlGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof print_html_options_request_1.PrintHtmlFilterQuery !== "undefined" && print_html_options_request_1.PrintHtmlFilterQuery) === "function" ? _b : Object)
], PrintHtmlGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(print_html_options_request_1.PrintHtmlSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof print_html_options_request_1.PrintHtmlSortQuery !== "undefined" && print_html_options_request_1.PrintHtmlSortQuery) === "function" ? _c : Object)
], PrintHtmlGetQuery.prototype, "sort", void 0);
class PrintHtmlPaginationQuery extends (0, swagger_1.IntersectionType)(PrintHtmlGetQuery, query_1.PaginationQuery) {
}
exports.PrintHtmlPaginationQuery = PrintHtmlPaginationQuery;
class PrintHtmlGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PrintHtmlGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PrintHtmlGetManyQuery = PrintHtmlGetManyQuery;
class PrintHtmlGetOneQuery extends (0, swagger_1.PickType)(PrintHtmlGetQuery, ['filter', 'relation']) {
}
exports.PrintHtmlGetOneQuery = PrintHtmlGetOneQuery;


/***/ }),
/* 513 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlSortQuery = exports.PrintHtmlFilterQuery = exports.PrintHtmlRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class PrintHtmlRelationQuery {
}
exports.PrintHtmlRelationQuery = PrintHtmlRelationQuery;
class PrintHtmlFilterQuery {
}
exports.PrintHtmlFilterQuery = PrintHtmlFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], PrintHtmlFilterQuery.prototype, "updatedAt", void 0);
class PrintHtmlSortQuery extends query_1.SortQuery {
}
exports.PrintHtmlSortQuery = PrintHtmlSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], PrintHtmlSortQuery.prototype, "priority", void 0);


/***/ }),
/* 514 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PrintHtmlUpdateBody = exports.PrintHtmlCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PrintHtmlCreateBody {
}
exports.PrintHtmlCreateBody = PrintHtmlCreateBody;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PrintHtmlCreateBody.prototype, "priority", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PrintHtmlCreateBody.prototype, "printHtmlType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Đơn thuốc' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<div>ĐƠN THUỐC</div>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "html", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<div>ĐƠN THUỐC</div>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "css", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "initVariable", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PrintHtmlCreateBody.prototype, "dataExample", void 0);
class PrintHtmlUpdateBody extends PrintHtmlCreateBody {
}
exports.PrintHtmlUpdateBody = PrintHtmlUpdateBody;


/***/ }),
/* 515 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_procedure_group_controller_1 = __webpack_require__(516);
const api_procedure_group_service_1 = __webpack_require__(282);
let ApiProcedureGroupModule = class ApiProcedureGroupModule {
};
exports.ApiProcedureGroupModule = ApiProcedureGroupModule;
exports.ApiProcedureGroupModule = ApiProcedureGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_procedure_group_controller_1.ApiProcedureGroupController],
        providers: [api_procedure_group_service_1.ApiProcedureGroupService],
    })
], ApiProcedureGroupModule);


/***/ }),
/* 516 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_procedure_group_service_1 = __webpack_require__(282);
const request_1 = __webpack_require__(517);
let ApiProcedureGroupController = class ApiProcedureGroupController {
    constructor(apiProcedureGroupService) {
        this.apiProcedureGroupService = apiProcedureGroupService;
    }
    pagination({ oid }, query) {
        return this.apiProcedureGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiProcedureGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiProcedureGroupService.getOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiProcedureGroupService.replaceAll(oid, body);
    }
    async createOne({ oid }, body) {
        return await this.apiProcedureGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiProcedureGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiProcedureGroupService.destroyOne(oid, id);
    }
};
exports.ApiProcedureGroupController = ApiProcedureGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProcedureGroupPaginationQuery !== "undefined" && request_1.ProcedureGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProcedureGroupGetManyQuery !== "undefined" && request_1.ProcedureGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiProcedureGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.ProcedureGroupReplaceAllBody !== "undefined" && request_1.ProcedureGroupReplaceAllBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ProcedureGroupCreateBody !== "undefined" && request_1.ProcedureGroupCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.ProcedureGroupUpdateBody !== "undefined" && request_1.ProcedureGroupUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiProcedureGroupController.prototype, "destroyOne", null);
exports.ApiProcedureGroupController = ApiProcedureGroupController = __decorate([
    (0, swagger_1.ApiTags)('ProcedureGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('procedure-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_procedure_group_service_1.ApiProcedureGroupService !== "undefined" && api_procedure_group_service_1.ApiProcedureGroupService) === "function" ? _a : Object])
], ApiProcedureGroupController);


/***/ }),
/* 517 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(518), exports);
__exportStar(__webpack_require__(519), exports);
__exportStar(__webpack_require__(520), exports);


/***/ }),
/* 518 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupGetOneQuery = exports.ProcedureGroupGetManyQuery = exports.ProcedureGroupPaginationQuery = exports.ProcedureGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const procedure_group_options_request_1 = __webpack_require__(519);
class ProcedureGroupGetQuery {
}
exports.ProcedureGroupGetQuery = ProcedureGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof procedure_group_options_request_1.ProcedureGroupRelationQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupRelationQuery) === "function" ? _a : Object)
], ProcedureGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof procedure_group_options_request_1.ProcedureGroupFilterQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupFilterQuery) === "function" ? _b : Object)
], ProcedureGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_group_options_request_1.ProcedureGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof procedure_group_options_request_1.ProcedureGroupSortQuery !== "undefined" && procedure_group_options_request_1.ProcedureGroupSortQuery) === "function" ? _c : Object)
], ProcedureGroupGetQuery.prototype, "sort", void 0);
class ProcedureGroupPaginationQuery extends (0, swagger_1.IntersectionType)(ProcedureGroupGetQuery, query_1.PaginationQuery) {
}
exports.ProcedureGroupPaginationQuery = ProcedureGroupPaginationQuery;
class ProcedureGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProcedureGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProcedureGroupGetManyQuery = ProcedureGroupGetManyQuery;
class ProcedureGroupGetOneQuery extends (0, swagger_1.PickType)(ProcedureGroupGetQuery, ['relation']) {
}
exports.ProcedureGroupGetOneQuery = ProcedureGroupGetOneQuery;


/***/ }),
/* 519 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupSortQuery = exports.ProcedureGroupFilterQuery = exports.ProcedureGroupRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class ProcedureGroupRelationQuery {
}
exports.ProcedureGroupRelationQuery = ProcedureGroupRelationQuery;
class ProcedureGroupFilterQuery {
}
exports.ProcedureGroupFilterQuery = ProcedureGroupFilterQuery;
class ProcedureGroupSortQuery extends query_1.SortQuery {
}
exports.ProcedureGroupSortQuery = ProcedureGroupSortQuery;


/***/ }),
/* 520 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGroupReplaceAllBody = exports.ProcedureGroupReplaceBody = exports.ProcedureGroupUpdateBody = exports.ProcedureGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ProcedureGroupCreateBody {
}
exports.ProcedureGroupCreateBody = ProcedureGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProcedureGroupCreateBody.prototype, "name", void 0);
class ProcedureGroupUpdateBody extends (0, swagger_1.PartialType)(ProcedureGroupCreateBody) {
}
exports.ProcedureGroupUpdateBody = ProcedureGroupUpdateBody;
class ProcedureGroupReplaceBody {
}
exports.ProcedureGroupReplaceBody = ProcedureGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProcedureGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], ProcedureGroupReplaceBody.prototype, "id", void 0);
class ProcedureGroupReplaceAllBody {
}
exports.ProcedureGroupReplaceAllBody = ProcedureGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProcedureGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProcedureGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProcedureGroupReplaceAllBody.prototype, "procedureGroupReplaceAll", void 0);


/***/ }),
/* 521 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_procedure_controller_1 = __webpack_require__(522);
const api_procedure_service_1 = __webpack_require__(523);
let ApiProcedureModule = class ApiProcedureModule {
};
exports.ApiProcedureModule = ApiProcedureModule;
exports.ApiProcedureModule = ApiProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_procedure_controller_1.ApiProcedureController],
        providers: [api_procedure_service_1.ApiProcedureService],
    })
], ApiProcedureModule);


/***/ }),
/* 522 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_procedure_service_1 = __webpack_require__(523);
const request_1 = __webpack_require__(524);
let ApiProcedureController = class ApiProcedureController {
    constructor(apiProcedureService) {
        this.apiProcedureService = apiProcedureService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiProcedureService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiProcedureService.getMany(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiProcedureService.getOne(oid, id, query);
        return { data };
    }
    async create({ oid }, body) {
        const data = await this.apiProcedureService.createOne(oid, body);
        return { data };
    }
    async update({ oid }, { id }, body) {
        const data = await this.apiProcedureService.updateOne(oid, id, body);
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiProcedureService.destroyOne(oid, id);
        return data;
    }
};
exports.ApiProcedureController = ApiProcedureController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProcedurePaginationQuery !== "undefined" && request_1.ProcedurePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiProcedureController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.ProcedureGetManyQuery !== "undefined" && request_1.ProcedureGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiProcedureController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.ProcedureGetOneQuery !== "undefined" && request_1.ProcedureGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiProcedureController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.ProcedureUpsertBody !== "undefined" && request_1.ProcedureUpsertBody) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiProcedureController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.ProcedureUpsertBody !== "undefined" && request_1.ProcedureUpsertBody) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], ApiProcedureController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PROCEDURE_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiProcedureController.prototype, "destroyOne", null);
exports.ApiProcedureController = ApiProcedureController = __decorate([
    (0, swagger_1.ApiTags)('Procedure'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_procedure_service_1.ApiProcedureService !== "undefined" && api_procedure_service_1.ApiProcedureService) === "function" ? _a : Object])
], ApiProcedureController);


/***/ }),
/* 523 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProcedureService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const discount_entity_1 = __webpack_require__(77);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const procedure_repository_1 = __webpack_require__(121);
const ticket_procedure_repository_1 = __webpack_require__(143);
const socket_emit_service_1 = __webpack_require__(340);
let ApiProcedureService = class ApiProcedureService {
    constructor(socketEmitService, procedureRepository, procedureGroupRepository, positionRepository, discountRepository, ticketProcedureRepository) {
        this.socketEmitService = socketEmitService;
        this.procedureRepository = procedureRepository;
        this.procedureGroupRepository = procedureGroupRepository;
        this.positionRepository = positionRepository;
        this.discountRepository = discountRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.procedureRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                name: (filter === null || filter === void 0 ? void 0 : filter.searchText) ? { LIKE: filter.searchText } : undefined,
                procedureGroupId: filter === null || filter === void 0 ? void 0 : filter.procedureGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, procedureList: data, relation: query.relation });
        }
        return { procedureList: data, page, limit, total };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const procedureList = await this.procedureRepository.findMany({
            condition: {
                oid,
                name: (filter === null || filter === void 0 ? void 0 : filter.searchText) ? { LIKE: filter.searchText } : undefined,
                procedureGroupId: filter === null || filter === void 0 ? void 0 : filter.procedureGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
            },
            sort: { id: 'ASC' },
            limit,
        });
        if (query.relation) {
            await this.generateRelation({ oid, procedureList, relation: query.relation });
        }
        return { procedureList };
    }
    async getOne(oid, id, query) {
        var _a;
        const procedure = await this.procedureRepository.findOne({
            relation: { procedureGroup: (_a = query === null || query === void 0 ? void 0 : query.relation) === null || _a === void 0 ? void 0 : _a.procedureGroup },
            condition: { oid, id },
        });
        if (!procedure)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation({ oid, procedureList: [procedure], relation: query.relation });
        }
        return { procedure };
    }
    async createOne(oid, body) {
        const { positionList, discountList, procedure: procedureBody } = body;
        let code = procedureBody.code;
        if (!code) {
            const count = await this.procedureRepository.getMaxId();
            code = (count + 1).toString();
        }
        const existProcedure = await this.procedureRepository.findOneBy({ oid, code });
        if (existProcedure) {
            throw new error_1.BusinessError(`Trùng mã dịch vụ với ${existProcedure.name}`);
        }
        const procedure = await this.procedureRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, procedureBody), { oid,
            code }));
        this.socketEmitService.procedureListChange(oid, { procedureUpsertedList: [procedure] });
        if (positionList === null || positionList === void 0 ? void 0 : positionList.length) {
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: procedure.id,
                    positionType: position_entity_1.PositionInteractType.Procedure,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            procedure.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, { positionUpsertedList });
        }
        if (discountList === null || discountList === void 0 ? void 0 : discountList.length) {
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: procedure.id, discountInteractType: discount_entity_1.DiscountInteractType.Procedure, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            procedure.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, { discountUpsertedList });
        }
        return { procedure };
    }
    async updateOne(oid, procedureId, body) {
        const { positionList, discountList, procedure: procedureBody } = body;
        if (procedureBody.code != null) {
            const existProcedure = await this.procedureRepository.findOneBy({
                oid,
                code: procedureBody.code,
                id: { NOT: procedureId },
            });
            if (existProcedure) {
                throw new error_1.BusinessError(`Trùng mã dịch vụ với ${existProcedure.name}`);
            }
        }
        const procedure = await this.procedureRepository.updateOneAndReturnEntity({ oid, id: procedureId }, procedureBody);
        this.socketEmitService.procedureListChange(oid, { procedureUpsertedList: [procedure] });
        if (positionList) {
            const positionDestroyedList = await this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: procedure.id,
                positionType: position_entity_1.PositionInteractType.Procedure,
            });
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: procedure.id,
                    positionType: position_entity_1.PositionInteractType.Procedure,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            procedure.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, {
                positionUpsertedList,
                positionDestroyedList,
            });
        }
        if (discountList) {
            const discountDestroyedList = await this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: procedure.id,
                discountInteractType: discount_entity_1.DiscountInteractType.Procedure,
            });
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: procedure.id, discountInteractType: discount_entity_1.DiscountInteractType.Procedure, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            procedure.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, {
                discountUpsertedList,
                discountDestroyedList,
            });
        }
        return { procedure };
    }
    async destroyOne(oid, procedureId) {
        const ticketProcedureList = await this.ticketProcedureRepository.findMany({
            condition: { oid, procedureId },
            limit: 10,
        });
        if (ticketProcedureList.length > 0) {
            return {
                data: { ticketProcedureList },
                success: false,
            };
        }
        const [positionDestroyedList, discountDestroyedList] = await Promise.all([
            this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: procedureId,
                positionType: position_entity_1.PositionInteractType.Procedure,
            }),
            this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: procedureId,
                discountInteractType: discount_entity_1.DiscountInteractType.Procedure,
            }),
        ]);
        if (positionDestroyedList.length) {
            this.socketEmitService.positionListChange(oid, { positionDestroyedList });
        }
        if (discountDestroyedList.length) {
            this.socketEmitService.discountListChange(oid, { discountDestroyedList });
        }
        const procedure = await this.procedureRepository.deleteOneAndReturnEntity({
            oid,
            id: procedureId,
        });
        this.socketEmitService.procedureListChange(oid, { procedureDestroyedList: [procedure] });
        return { data: { ticketProcedureList: [], procedureId } };
    }
    async generateRelation(options) {
        const { oid, procedureList, relation } = options;
        const procedureIdList = helpers_1.ESArray.uniqueArray(procedureList.map((i) => i.id));
        const procedureGroupIdList = helpers_1.ESArray.uniqueArray(procedureList.map((i) => i.procedureGroupId));
        const [positionList, discountList, procedureGroupList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.positionList) && procedureIdList.length
                ? this.positionRepository.findManyBy({
                    oid,
                    positionType: position_entity_1.PositionInteractType.Procedure,
                    positionInteractId: { IN: procedureIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.discountList) && procedureIdList.length
                ? this.discountRepository.findManyBy({
                    oid,
                    discountInteractType: discount_entity_1.DiscountInteractType.Procedure,
                    discountInteractId: { IN: [...procedureIdList, 0] },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.procedureGroup) && procedureGroupIdList.length
                ? this.procedureGroupRepository.findManyBy({
                    oid,
                    id: { IN: procedureGroupIdList },
                })
                : [],
        ]);
        const procedureGroupMap = helpers_1.ESArray.arrayToKeyValue(procedureGroupList, 'id');
        procedureList.forEach((procedure) => {
            if (relation === null || relation === void 0 ? void 0 : relation.positionList) {
                procedure.positionList = positionList.filter((i) => i.positionInteractId === procedure.id);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.discountList) {
                procedure.discountList = discountList.filter((i) => i.discountInteractId === procedure.id);
                procedure.discountListExtra = discountList.filter((i) => i.discountInteractId === 0);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.procedureGroup) {
                procedure.procedureGroup = procedureGroupMap[procedure.procedureGroupId];
            }
        });
        return procedureList;
    }
};
exports.ApiProcedureService = ApiProcedureService;
exports.ApiProcedureService = ApiProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof procedure_repository_1.ProcedureRepository !== "undefined" && procedure_repository_1.ProcedureRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.ProcedureGroupRepository !== "undefined" && repositories_1.ProcedureGroupRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PositionRepository !== "undefined" && repositories_1.PositionRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.DiscountRepository !== "undefined" && repositories_1.DiscountRepository) === "function" ? _e : Object, typeof (_f = typeof ticket_procedure_repository_1.TicketProcedureRepository !== "undefined" && ticket_procedure_repository_1.TicketProcedureRepository) === "function" ? _f : Object])
], ApiProcedureService);


/***/ }),
/* 524 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(525), exports);
__exportStar(__webpack_require__(526), exports);
__exportStar(__webpack_require__(527), exports);


/***/ }),
/* 525 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureGetOneQuery = exports.ProcedureGetManyQuery = exports.ProcedurePaginationQuery = exports.ProcedureGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const procedure_options_request_1 = __webpack_require__(526);
class ProcedureGetQuery {
}
exports.ProcedureGetQuery = ProcedureGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof procedure_options_request_1.ProcedureRelationQuery !== "undefined" && procedure_options_request_1.ProcedureRelationQuery) === "function" ? _a : Object)
], ProcedureGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof procedure_options_request_1.ProcedureFilterQuery !== "undefined" && procedure_options_request_1.ProcedureFilterQuery) === "function" ? _b : Object)
], ProcedureGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'ASC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(procedure_options_request_1.ProcedureSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof procedure_options_request_1.ProcedureSortQuery !== "undefined" && procedure_options_request_1.ProcedureSortQuery) === "function" ? _c : Object)
], ProcedureGetQuery.prototype, "sort", void 0);
class ProcedurePaginationQuery extends (0, swagger_1.IntersectionType)(ProcedureGetQuery, query_1.PaginationQuery) {
}
exports.ProcedurePaginationQuery = ProcedurePaginationQuery;
class ProcedureGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProcedureGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProcedureGetManyQuery = ProcedureGetManyQuery;
class ProcedureGetOneQuery extends (0, swagger_1.PickType)(ProcedureGetQuery, ['relation']) {
}
exports.ProcedureGetOneQuery = ProcedureGetOneQuery;


/***/ }),
/* 526 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureSortQuery = exports.ProcedureFilterQuery = exports.ProcedureRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class ProcedureRelationQuery {
}
exports.ProcedureRelationQuery = ProcedureRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProcedureRelationQuery.prototype, "procedureGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProcedureRelationQuery.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProcedureRelationQuery.prototype, "discountList", void 0);
class ProcedureFilterQuery {
}
exports.ProcedureFilterQuery = ProcedureFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProcedureFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProcedureFilterQuery.prototype, "procedureGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProcedureFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], ProcedureFilterQuery.prototype, "updatedAt", void 0);
class ProcedureSortQuery extends query_1.SortQuery {
}
exports.ProcedureSortQuery = ProcedureSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProcedureSortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProcedureSortQuery.prototype, "code", void 0);


/***/ }),
/* 527 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProcedureUpsertBody = exports.ProcedureCreate = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const procedure_entity_1 = __webpack_require__(69);
const request_1 = __webpack_require__(394);
const request_2 = __webpack_require__(438);
class ProcedureCreate {
}
exports.ProcedureCreate = ProcedureCreate;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProcedureCreate.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Truyền dịch 500ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProcedureCreate.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "procedureGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: procedure_entity_1.ProcedureType.Basic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_custom_1.IsEnumValue)(procedure_entity_1.ProcedureType),
    __metadata("design:type", typeof (_a = typeof procedure_entity_1.ProcedureType !== "undefined" && procedure_entity_1.ProcedureType) === "function" ? _a : Object)
], ProcedureCreate.prototype, "procedureType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "totalSessions", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "gapHours", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "gapHoursType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProcedureCreate.prototype, "isActive", void 0);
class ProcedureUpsertBody {
}
exports.ProcedureUpsertBody = ProcedureUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProcedureCreate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProcedureCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", ProcedureCreate)
], ProcedureUpsertBody.prototype, "procedure", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProcedureUpsertBody.prototype, "positionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProcedureUpsertBody.prototype, "discountList", void 0);


/***/ }),
/* 528 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_group_controller_1 = __webpack_require__(529);
const api_product_group_service_1 = __webpack_require__(288);
let ApiProductGroupModule = class ApiProductGroupModule {
};
exports.ApiProductGroupModule = ApiProductGroupModule;
exports.ApiProductGroupModule = ApiProductGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_group_controller_1.ApiProductGroupController],
        providers: [api_product_group_service_1.ApiProductGroupService],
    })
], ApiProductGroupModule);


/***/ }),
/* 529 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_product_group_service_1 = __webpack_require__(288);
const request_1 = __webpack_require__(530);
let ApiProductGroupController = class ApiProductGroupController {
    constructor(apiProductGroupService) {
        this.apiProductGroupService = apiProductGroupService;
    }
    pagination({ oid }, query) {
        return this.apiProductGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiProductGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiProductGroupService.getOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiProductGroupService.replaceAll(oid, body);
    }
    async createOne({ oid }, body) {
        return await this.apiProductGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiProductGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiProductGroupService.destroyOne(oid, id);
    }
};
exports.ApiProductGroupController = ApiProductGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductGroupPaginationQuery !== "undefined" && request_1.ProductGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.ProductGroupGetManyQuery !== "undefined" && request_1.ProductGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiProductGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.ProductGroupReplaceAllBody !== "undefined" && request_1.ProductGroupReplaceAllBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.ProductGroupCreateBody !== "undefined" && request_1.ProductGroupCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_1.ProductGroupUpdateBody !== "undefined" && request_1.ProductGroupUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiProductGroupController.prototype, "destroyOne", null);
exports.ApiProductGroupController = ApiProductGroupController = __decorate([
    (0, swagger_1.ApiTags)('ProductGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_group_service_1.ApiProductGroupService !== "undefined" && api_product_group_service_1.ApiProductGroupService) === "function" ? _a : Object])
], ApiProductGroupController);


/***/ }),
/* 530 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(531), exports);
__exportStar(__webpack_require__(532), exports);
__exportStar(__webpack_require__(533), exports);


/***/ }),
/* 531 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupGetOneQuery = exports.ProductGroupGetManyQuery = exports.ProductGroupPaginationQuery = exports.ProductGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const product_group_options_request_1 = __webpack_require__(532);
class ProductGroupGetQuery {
}
exports.ProductGroupGetQuery = ProductGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_group_options_request_1.ProductGroupRelationQuery !== "undefined" && product_group_options_request_1.ProductGroupRelationQuery) === "function" ? _a : Object)
], ProductGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_group_options_request_1.ProductGroupFilterQuery !== "undefined" && product_group_options_request_1.ProductGroupFilterQuery) === "function" ? _b : Object)
], ProductGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_group_options_request_1.ProductGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_group_options_request_1.ProductGroupSortQuery !== "undefined" && product_group_options_request_1.ProductGroupSortQuery) === "function" ? _c : Object)
], ProductGroupGetQuery.prototype, "sort", void 0);
class ProductGroupPaginationQuery extends (0, swagger_1.IntersectionType)(ProductGroupGetQuery, query_1.PaginationQuery) {
}
exports.ProductGroupPaginationQuery = ProductGroupPaginationQuery;
class ProductGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductGroupGetManyQuery = ProductGroupGetManyQuery;
class ProductGroupGetOneQuery extends (0, swagger_1.PickType)(ProductGroupGetQuery, ['relation']) {
}
exports.ProductGroupGetOneQuery = ProductGroupGetOneQuery;


/***/ }),
/* 532 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupSortQuery = exports.ProductGroupFilterQuery = exports.ProductGroupRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class ProductGroupRelationQuery {
}
exports.ProductGroupRelationQuery = ProductGroupRelationQuery;
class ProductGroupFilterQuery {
}
exports.ProductGroupFilterQuery = ProductGroupFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], ProductGroupFilterQuery.prototype, "updatedAt", void 0);
class ProductGroupSortQuery extends query_1.SortQuery {
}
exports.ProductGroupSortQuery = ProductGroupSortQuery;


/***/ }),
/* 533 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGroupReplaceAllBody = exports.ProductGroupReplaceBody = exports.ProductGroupUpdateBody = exports.ProductGroupCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class ProductGroupCreateBody {
}
exports.ProductGroupCreateBody = ProductGroupCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProductGroupCreateBody.prototype, "name", void 0);
class ProductGroupUpdateBody extends (0, swagger_1.PartialType)(ProductGroupCreateBody) {
}
exports.ProductGroupUpdateBody = ProductGroupUpdateBody;
class ProductGroupReplaceBody {
}
exports.ProductGroupReplaceBody = ProductGroupReplaceBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], ProductGroupReplaceBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], ProductGroupReplaceBody.prototype, "id", void 0);
class ProductGroupReplaceAllBody {
}
exports.ProductGroupReplaceAllBody = ProductGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProductGroupReplaceBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductGroupReplaceBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductGroupReplaceAllBody.prototype, "productGroupReplaceAll", void 0);


/***/ }),
/* 534 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_movement_controller_1 = __webpack_require__(535);
const api_product_movement_service_1 = __webpack_require__(536);
let ApiProductMovementModule = class ApiProductMovementModule {
};
exports.ApiProductMovementModule = ApiProductMovementModule;
exports.ApiProductMovementModule = ApiProductMovementModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_movement_controller_1.ApiProductMovementController],
        providers: [api_product_movement_service_1.ApiProductMovementService],
    })
], ApiProductMovementModule);


/***/ }),
/* 535 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_product_movement_service_1 = __webpack_require__(536);
const request_1 = __webpack_require__(537);
let ApiProductMovementController = class ApiProductMovementController {
    constructor(apiProductMovementService) {
        this.apiProductMovementService = apiProductMovementService;
    }
    async paginationProductMovement({ oid }, query) {
        const data = await this.apiProductMovementService.pagination(oid, query);
        return { data };
    }
};
exports.ApiProductMovementController = ApiProductMovementController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_READ_MOVEMENT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductMovementPaginationQuery !== "undefined" && request_1.ProductMovementPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiProductMovementController.prototype, "paginationProductMovement", null);
exports.ApiProductMovementController = ApiProductMovementController = __decorate([
    (0, swagger_1.ApiTags)('Product Movement'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product-movement'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_movement_service_1.ApiProductMovementService !== "undefined" && api_product_movement_service_1.ApiProductMovementService) === "function" ? _a : Object])
], ApiProductMovementController);


/***/ }),
/* 536 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductMovementService = void 0;
const common_1 = __webpack_require__(3);
const array_helper_1 = __webpack_require__(154);
const variable_1 = __webpack_require__(21);
const repositories_1 = __webpack_require__(42);
let ApiProductMovementService = class ApiProductMovementService {
    constructor(productMovementRepository, purchaseOrderRepository, stockCheckRepository, ticketRepository, customerRepository, distributorRepository, userRepository) {
        this.productMovementRepository = productMovementRepository;
        this.purchaseOrderRepository = purchaseOrderRepository;
        this.stockCheckRepository = stockCheckRepository;
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
        this.distributorRepository = distributorRepository;
        this.userRepository = userRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { total, data: productMovementList } = await this.productMovementRepository.pagination({
            relation: { product: relation === null || relation === void 0 ? void 0 : relation.product },
            page,
            limit,
            condition: {
                oid,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                voucherId: filter === null || filter === void 0 ? void 0 : filter.voucherId,
                contactId: filter === null || filter === void 0 ? void 0 : filter.contactId,
                movementType: filter === null || filter === void 0 ? void 0 : filter.movementType,
            },
            sort,
        });
        const purchaseOrderIds = productMovementList
            .filter((i) => i.movementType === variable_1.MovementType.PurchaseOrder)
            .map((i) => i.voucherId);
        const ticketIds = productMovementList
            .filter((i) => i.movementType === variable_1.MovementType.Ticket)
            .map((i) => i.voucherId);
        const stockCheckIds = productMovementList
            .filter((i) => i.movementType === variable_1.MovementType.StockCheck)
            .map((i) => i.voucherId);
        const distributorIds = productMovementList
            .filter((i) => i.movementType === variable_1.MovementType.PurchaseOrder)
            .map((i) => i.contactId);
        const customerIds = productMovementList
            .filter((i) => i.movementType === variable_1.MovementType.Ticket)
            .map((i) => i.contactId);
        const userIds = productMovementList
            .filter((i) => [variable_1.MovementType.UserChange, variable_1.MovementType.StockCheck, variable_1.MovementType.Excel].includes(i.movementType))
            .map((i) => i.contactId);
        const [purchaseOrderList, ticketList, stockCheckList, distributorList, customerList, userList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.purchaseOrder) && purchaseOrderIds.length
                ? this.purchaseOrderRepository.findMany({ condition: { id: { IN: (0, array_helper_1.uniqueArray)(purchaseOrderIds) } } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIds.length
                ? this.ticketRepository.findMany({ condition: { id: { IN: (0, array_helper_1.uniqueArray)(ticketIds) } } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.stockCheck) && stockCheckIds.length
                ? this.stockCheckRepository.findMany({
                    condition: { id: { IN: (0, array_helper_1.uniqueArray)(stockCheckIds) } },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.distributor) && distributorIds.length
                ? this.distributorRepository.findManyBy({ id: { IN: (0, array_helper_1.uniqueArray)(distributorIds) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIds.length
                ? this.customerRepository.findManyBy({ id: { IN: (0, array_helper_1.uniqueArray)(customerIds) } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.user) && userIds.length
                ? this.userRepository.findMany({ condition: { id: { IN: (0, array_helper_1.uniqueArray)(userIds) } } })
                : [],
        ]);
        productMovementList.forEach((mov) => {
            if (mov.movementType === variable_1.MovementType.PurchaseOrder) {
                mov.purchaseOrder = purchaseOrderList.find((v) => v.id === mov.voucherId);
                mov.distributor = distributorList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.Ticket) {
                mov.ticket = ticketList.find((v) => v.id === mov.voucherId);
                mov.customer = customerList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.UserChange) {
                mov.user = userList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.StockCheck) {
                mov.stockCheck = stockCheckList.find((v) => v.id === mov.voucherId);
                mov.user = userList.find((c) => c.id === mov.contactId);
            }
            if (mov.movementType === variable_1.MovementType.Excel) {
                mov.user = userList.find((c) => c.id === mov.contactId);
            }
        });
        return { productMovementList, total, page, limit };
    }
};
exports.ApiProductMovementService = ApiProductMovementService;
exports.ApiProductMovementService = ApiProductMovementService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductMovementRepository !== "undefined" && repositories_1.ProductMovementRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderRepository !== "undefined" && repositories_1.PurchaseOrderRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.StockCheckRepository !== "undefined" && repositories_1.StockCheckRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.DistributorRepository !== "undefined" && repositories_1.DistributorRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _g : Object])
], ApiProductMovementService);


/***/ }),
/* 537 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(538), exports);
__exportStar(__webpack_require__(539), exports);


/***/ }),
/* 538 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementGetOneQuery = exports.ProductMovementGetManyQuery = exports.ProductMovementPaginationQuery = exports.ProductMovementGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
const product_movement_options_request_1 = __webpack_require__(539);
class ProductMovementGetQuery {
}
exports.ProductMovementGetQuery = ProductMovementGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            ticket: true,
            product: true,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_movement_options_request_1.ProductMovementRelationQuery !== "undefined" && product_movement_options_request_1.ProductMovementRelationQuery) === "function" ? _a : Object)
], ProductMovementGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            voucherId: 3,
            movementType: variable_1.MovementType.PurchaseOrder,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_movement_options_request_1.ProductMovementFilterQuery !== "undefined" && product_movement_options_request_1.ProductMovementFilterQuery) === "function" ? _b : Object)
], ProductMovementGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_movement_options_request_1.ProductMovementSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_movement_options_request_1.ProductMovementSortQuery !== "undefined" && product_movement_options_request_1.ProductMovementSortQuery) === "function" ? _c : Object)
], ProductMovementGetQuery.prototype, "sort", void 0);
class ProductMovementPaginationQuery extends (0, swagger_1.IntersectionType)(ProductMovementGetQuery, query_1.PaginationQuery) {
}
exports.ProductMovementPaginationQuery = ProductMovementPaginationQuery;
class ProductMovementGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductMovementGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductMovementGetManyQuery = ProductMovementGetManyQuery;
class ProductMovementGetOneQuery extends (0, swagger_1.PickType)(ProductMovementGetQuery, ['relation']) {
}
exports.ProductMovementGetOneQuery = ProductMovementGetOneQuery;


/***/ }),
/* 539 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMovementSortQuery = exports.ProductMovementFilterQuery = exports.ProductMovementRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const variable_1 = __webpack_require__(21);
const ConditionEnumMovementType = (0, dto_1.createConditionEnum)(variable_1.MovementType);
class ProductMovementRelationQuery {
}
exports.ProductMovementRelationQuery = ProductMovementRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "stockCheck", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "customer", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductMovementRelationQuery.prototype, "user", void 0);
class ProductMovementFilterQuery {
}
exports.ProductMovementFilterQuery = ProductMovementFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductMovementFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "voucherId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(dto_1.transformConditionNumber),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "contactId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.MovementType)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], ProductMovementFilterQuery.prototype, "movementType", void 0);
class ProductMovementSortQuery extends dto_1.SortQuery {
}
exports.ProductMovementSortQuery = ProductMovementSortQuery;


/***/ }),
/* 540 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_product_controller_1 = __webpack_require__(541);
const api_product_service_1 = __webpack_require__(542);
let ApiProductModule = class ApiProductModule {
};
exports.ApiProductModule = ApiProductModule;
exports.ApiProductModule = ApiProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_product_controller_1.ApiProductController],
        providers: [api_product_service_1.ApiProductService],
    })
], ApiProductModule);


/***/ }),
/* 541 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_product_service_1 = __webpack_require__(542);
const request_1 = __webpack_require__(543);
let ApiProductController = class ApiProductController {
    constructor(apiProductService) {
        this.apiProductService = apiProductService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiProductService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiProductService.getList(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiProductService.getOne(oid, id, query);
        return { data };
    }
    async create({ oid }, body) {
        const data = await this.apiProductService.createOne(oid, body);
        return { data };
    }
    async update({ oid }, { id }, body) {
        const data = await this.apiProductService.updateOne(oid, id, body);
        return { data };
    }
    async deleteOne({ oid, organization }, { id }) {
        const data = await this.apiProductService.destroyOne({ organization, oid, productId: id });
        return { data };
    }
    async mergeProduct({ oid, uid, organization }, body) {
        const data = await this.apiProductService.mergeProduct({ oid, body, userId: uid });
        return { data };
    }
};
exports.ApiProductController = ApiProductController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.ProductPaginationQuery !== "undefined" && request_1.ProductPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiProductController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.ProductGetManyQuery !== "undefined" && request_1.ProductGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiProductController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.ProductGetOneQuery !== "undefined" && request_1.ProductGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiProductController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.ProductCreateBody !== "undefined" && request_1.ProductCreateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiProductController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.ProductUpdateBody !== "undefined" && request_1.ProductUpdateBody) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], ApiProductController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiProductController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Patch)('merge-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PRODUCT_MERGE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof request_1.ProductMergeBody !== "undefined" && request_1.ProductMergeBody) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], ApiProductController.prototype, "mergeProduct", null);
exports.ApiProductController = ApiProductController = __decorate([
    (0, swagger_1.ApiTags)('Product'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_product_service_1.ApiProductService !== "undefined" && api_product_service_1.ApiProductService) === "function" ? _a : Object])
], ApiProductController);


/***/ }),
/* 542 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiProductService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const discount_entity_1 = __webpack_require__(77);
const position_entity_1 = __webpack_require__(76);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const organization_repository_1 = __webpack_require__(111);
const product_movement_repository_1 = __webpack_require__(123);
const purchase_order_item_repository_1 = __webpack_require__(125);
const ticket_product_repository_1 = __webpack_require__(144);
const socket_emit_service_1 = __webpack_require__(340);
let ApiProductService = class ApiProductService {
    constructor(socketEmitService, cacheDataService, organizationRepository, ticketProductRepository, purchaseOrderItemRepository, productRepository, productOperation, productGroupRepository, batchRepository, productMovementRepository, positionRepository, discountRepository) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.organizationRepository = organizationRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.purchaseOrderItemRepository = purchaseOrderItemRepository;
        this.productRepository = productRepository;
        this.productOperation = productOperation;
        this.productGroupRepository = productGroupRepository;
        this.batchRepository = batchRepository;
        this.productMovementRepository = productMovementRepository;
        this.positionRepository = positionRepository;
        this.discountRepository = discountRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { total, data } = await this.productRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                productGroupId: filter === null || filter === void 0 ? void 0 : filter.productGroupId,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, productList: data, relation: query.relation });
        }
        return { productList: data, total, page, limit };
    }
    async getList(oid, query) {
        const { filter, limit, relation } = query;
        const productList = await this.productRepository.findMany({
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                productGroupId: filter === null || filter === void 0 ? void 0 : filter.productGroupId,
                quantity: filter === null || filter === void 0 ? void 0 : filter.quantity,
                $OR: filter === null || filter === void 0 ? void 0 : filter.$OR,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        if (query.relation) {
            await this.generateRelation({ oid, productList, relation: query.relation });
        }
        return { productList };
    }
    async getOne(oid, id, query) {
        const { relation, filter } = query;
        const product = await this.productRepository.findOne({
            relation: { productGroup: relation === null || relation === void 0 ? void 0 : relation.productGroup },
            condition: { oid, id },
        });
        if (!product)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation({ oid, productList: [product], relation: query.relation });
        }
        return { product };
    }
    async createOne(oid, body) {
        const { positionList, discountList, product: productBody } = body;
        let productCode = productBody.productCode;
        if (!productCode) {
            const count = await this.productRepository.getMaxId();
            productCode = (count + 1).toString();
        }
        const existProduct = await this.productRepository.findOneBy({
            oid,
            productCode,
        });
        if (existProduct) {
            throw new exception_filter_1.BusinessException(`Trùng mã sản phẩm với ${existProduct.brandName}`);
        }
        const productInserted = await this.productRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, productBody), { oid,
            productCode, updatedAt: Date.now() }));
        this.socketEmitService.productListChange(oid, { productUpsertedList: [productInserted] });
        if (productBody.quantity) {
            const batchCreated = await this.batchRepository.insertOneFullFieldAndReturnEntity({
                oid,
                productId: productInserted.id,
                costPrice: productBody.costPrice,
                quantity: productBody.quantity,
                costAmount: productBody.costPrice * productBody.quantity,
                distributorId: 0,
                expiryDate: null,
                lotNumber: '',
                registeredAt: Date.now(),
                warehouseId: 0,
                isActive: 1,
            });
            this.socketEmitService.batchListChange(oid, { batchUpsertedList: [batchCreated] });
        }
        if (positionList === null || positionList === void 0 ? void 0 : positionList.length) {
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: productInserted.id,
                    positionType: position_entity_1.PositionInteractType.Product,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            productInserted.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, { positionUpsertedList });
        }
        if (discountList === null || discountList === void 0 ? void 0 : discountList.length) {
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: productInserted.id, discountInteractType: discount_entity_1.DiscountInteractType.Product, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            productInserted.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, { discountUpsertedList });
        }
        return { product: productInserted };
    }
    async updateOne(oid, productId, body) {
        const { positionList, discountList, product: productBody } = body;
        const productOrigin = await this.productRepository.findOneBy({ oid, id: productId });
        if (productOrigin.warehouseIds !== productBody.warehouseIds) {
            let bodyWarehouseIdList = [];
            try {
                bodyWarehouseIdList = JSON.parse(productBody.warehouseIds);
            }
            catch (error) { }
            if (bodyWarehouseIdList.includes(0)) {
            }
            else {
                const batchList = await this.batchRepository.findMany({
                    condition: {
                        oid,
                        productId,
                        quantity: { NOT: 0 },
                    },
                });
                const batchError = [];
                batchList.forEach((i) => {
                    if (i.warehouseId === 0)
                        return;
                    if (!bodyWarehouseIdList.includes(i.warehouseId)) {
                        batchError.push(i);
                    }
                });
                if (batchError.length) {
                    throw new exception_filter_1.BusinessException('error.Conflict');
                }
            }
        }
        if (productBody.productCode != null) {
            const existProduct = await this.productRepository.findOneBy({
                oid,
                productCode: productBody.productCode,
                id: { NOT: productId },
            });
            if (existProduct) {
                throw new exception_filter_1.BusinessException(`Trùng mã sản phẩm với ${existProduct.brandName}`);
            }
        }
        const productModified = await this.productRepository.updateOneAndReturnEntity({ oid, id: productId }, productBody);
        this.socketEmitService.productListChange(oid, { productUpsertedList: [productModified] });
        if (positionList) {
            const positionDestroyedList = await this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: productModified.id,
                positionType: position_entity_1.PositionInteractType.Product,
            });
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: productModified.id,
                    positionType: position_entity_1.PositionInteractType.Product,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            productModified.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, {
                positionUpsertedList,
                positionDestroyedList,
            });
        }
        if (discountList) {
            const discountDestroyedList = await this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: productModified.id,
                discountInteractType: discount_entity_1.DiscountInteractType.Product,
            });
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: productModified.id, discountInteractType: discount_entity_1.DiscountInteractType.Product, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            productModified.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, {
                discountUpsertedList,
                discountDestroyedList,
            });
        }
        return { product: productModified };
    }
    async destroyOne(options) {
        const { oid, productId, organization } = options;
        const [purchaseOrderItemList, ticketProductList] = await Promise.all([
            this.purchaseOrderItemRepository.findMany({
                condition: { oid, productId },
                limit: 10,
            }),
            this.ticketProductRepository.findMany({
                condition: { oid, productId },
                limit: 10,
            }),
        ]);
        if (!(purchaseOrderItemList.length > 0 || ticketProductList.length > 0)) {
            const [productDestroyed, batchDestroyedList, productMovementDestroyedList, positionDestroyedList, discountDestroyedList,] = await Promise.all([
                this.productRepository.deleteOneAndReturnEntity({ oid, id: productId }),
                this.batchRepository.deleteAndReturnEntity({ oid, id: productId }),
                this.productMovementRepository.deleteAndReturnEntity({ oid, productId }),
                this.positionRepository.deleteAndReturnEntity({
                    oid,
                    positionInteractId: productId,
                    positionType: position_entity_1.PositionInteractType.Product,
                }),
                this.discountRepository.deleteAndReturnEntity({
                    oid,
                    discountInteractId: productId,
                    discountInteractType: discount_entity_1.DiscountInteractType.Product,
                }),
            ]);
            if (positionDestroyedList.length) {
                this.socketEmitService.positionListChange(oid, { positionDestroyedList });
            }
            if (discountDestroyedList.length) {
                this.socketEmitService.discountListChange(oid, { discountDestroyedList });
            }
            await this.organizationRepository.updateDataVersion(oid);
            this.cacheDataService.clearOrganization(oid);
            this.socketEmitService.productListChange(oid, { productDestroyedList: [productDestroyed] });
            this.socketEmitService.batchListChange(oid, { batchDestroyedList });
        }
        return {
            success: !(purchaseOrderItemList.length > 0 || ticketProductList.length > 0),
            productId,
            ticketProductList,
            purchaseOrderItemList,
        };
    }
    async mergeProduct(options) {
        const { oid, userId, body } = options;
        const { productIdSourceList, productIdTarget } = body;
        productIdSourceList.forEach((i) => {
            if (isNaN(i) || i <= 0) {
                throw new exception_filter_1.BusinessException('error.ValidateFailed');
            }
        });
        const { productModified, productDestroyedList, batchModifiedList } = await this.productOperation.mergeProduct({
            oid,
            userId,
            productIdTarget,
            productIdSourceList,
        });
        await this.organizationRepository.updateDataVersion(oid);
        this.cacheDataService.clearOrganization(oid);
        this.socketEmitService.productListChange(oid, {
            productUpsertedList: [productModified],
            productDestroyedList,
        });
        this.socketEmitService.batchListChange(oid, { batchUpsertedList: batchModifiedList });
        return true;
    }
    async generateRelation(options) {
        const { oid, productList, relation } = options;
        const productIdList = helpers_1.ESArray.uniqueArray(productList.map((i) => i.id));
        const productGroupIdList = helpers_1.ESArray.uniqueArray(productList.map((i) => i.productGroupId));
        const [positionList, discountList, productGroupList, batchList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.positionList) && productIdList.length
                ? this.positionRepository.findManyBy({
                    oid,
                    positionType: position_entity_1.PositionInteractType.Product,
                    positionInteractId: { IN: productIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.discountList) && productIdList.length
                ? this.discountRepository.findManyBy({
                    oid,
                    discountInteractType: discount_entity_1.DiscountInteractType.Product,
                    discountInteractId: { IN: [...productIdList, 0] },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.productGroup) && productGroupIdList.length
                ? this.productGroupRepository.findManyBy({
                    oid,
                    id: { IN: productGroupIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.productGroup) && productGroupIdList.length
                ? this.batchRepository.findMany({
                    condition: {
                        oid,
                        productId: { IN: productIdList },
                    },
                    sort: { expiryDate: 'ASC' },
                })
                : [],
        ]);
        const productGroupMap = helpers_1.ESArray.arrayToKeyValue(productGroupList, 'id');
        productList.forEach((product) => {
            if (relation === null || relation === void 0 ? void 0 : relation.positionList) {
                product.positionList = positionList.filter((i) => i.positionInteractId === product.id);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.discountList) {
                product.discountList = discountList.filter((i) => i.discountInteractId === product.id);
                product.discountListExtra = discountList.filter((i) => i.discountInteractId === 0);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.productGroup) {
                product.productGroup = productGroupMap[product.productGroupId];
            }
            if (relation === null || relation === void 0 ? void 0 : relation.batchList) {
                product.batchList = batchList.filter((i) => i.productId === product.id);
            }
        });
        return productList;
    }
};
exports.ApiProductService = ApiProductService;
exports.ApiProductService = ApiProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof organization_repository_1.OrganizationRepository !== "undefined" && organization_repository_1.OrganizationRepository) === "function" ? _c : Object, typeof (_d = typeof ticket_product_repository_1.TicketProductRepository !== "undefined" && ticket_product_repository_1.TicketProductRepository) === "function" ? _d : Object, typeof (_e = typeof purchase_order_item_repository_1.PurchaseOrderItemRepository !== "undefined" && purchase_order_item_repository_1.PurchaseOrderItemRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _f : Object, typeof (_g = typeof operations_1.ProductOperation !== "undefined" && operations_1.ProductOperation) === "function" ? _g : Object, typeof (_h = typeof repositories_1.ProductGroupRepository !== "undefined" && repositories_1.ProductGroupRepository) === "function" ? _h : Object, typeof (_j = typeof repositories_1.BatchRepository !== "undefined" && repositories_1.BatchRepository) === "function" ? _j : Object, typeof (_k = typeof product_movement_repository_1.ProductMovementRepository !== "undefined" && product_movement_repository_1.ProductMovementRepository) === "function" ? _k : Object, typeof (_l = typeof repositories_1.PositionRepository !== "undefined" && repositories_1.PositionRepository) === "function" ? _l : Object, typeof (_m = typeof repositories_1.DiscountRepository !== "undefined" && repositories_1.DiscountRepository) === "function" ? _m : Object])
], ApiProductService);


/***/ }),
/* 543 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(544), exports);
__exportStar(__webpack_require__(546), exports);
__exportStar(__webpack_require__(545), exports);
__exportStar(__webpack_require__(547), exports);


/***/ }),
/* 544 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductGetOneQuery = exports.ProductGetManyQuery = exports.ProductPaginationQuery = exports.ProductGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const product_options_request_1 = __webpack_require__(545);
class ProductGetQuery {
}
exports.ProductGetQuery = ProductGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ batchList: true }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof product_options_request_1.ProductRelationQuery !== "undefined" && product_options_request_1.ProductRelationQuery) === "function" ? _a : Object)
], ProductGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ isActive: 1, quantity: { GT: 10 } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductFilterQueryFull, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof product_options_request_1.ProductFilterQueryFull !== "undefined" && product_options_request_1.ProductFilterQueryFull) === "function" ? _b : Object)
], ProductGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({ id: 'DESC' }) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(product_options_request_1.ProductSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof product_options_request_1.ProductSortQuery !== "undefined" && product_options_request_1.ProductSortQuery) === "function" ? _c : Object)
], ProductGetQuery.prototype, "sort", void 0);
class ProductPaginationQuery extends (0, swagger_1.IntersectionType)(ProductGetQuery, query_1.PaginationQuery) {
}
exports.ProductPaginationQuery = ProductPaginationQuery;
class ProductGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ProductGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.ProductGetManyQuery = ProductGetManyQuery;
class ProductGetOneQuery extends (0, swagger_1.PickType)(ProductGetQuery, ['relation', 'filter']) {
}
exports.ProductGetOneQuery = ProductGetOneQuery;


/***/ }),
/* 545 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductSortQuery = exports.ProductFilterQueryFull = exports.ProductFilterQuery = exports.BatchFilterQuery = exports.ProductRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const condition_number_1 = __webpack_require__(310);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class ProductRelationQuery {
}
exports.ProductRelationQuery = ProductRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "batchList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "productGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], ProductRelationQuery.prototype, "discountList", void 0);
class BatchFilterQuery {
}
exports.BatchFilterQuery = BatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _a : Object)
], BatchFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _b : Object)
], BatchFilterQuery.prototype, "expiryDate", void 0);
class ProductFilterQuery {
}
exports.ProductFilterQuery = ProductFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductFilterQuery.prototype, "productGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionString),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionString !== "undefined" && dto_1.ConditionString) === "function" ? _c : Object)
], ProductFilterQuery.prototype, "brandName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionString),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_d = typeof dto_1.ConditionString !== "undefined" && dto_1.ConditionString) === "function" ? _d : Object)
], ProductFilterQuery.prototype, "substance", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProductFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_number_1.ConditionNumber),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_e = typeof condition_number_1.ConditionNumber !== "undefined" && condition_number_1.ConditionNumber) === "function" ? _e : Object)
], ProductFilterQuery.prototype, "quantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_f = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _f : Object)
], ProductFilterQuery.prototype, "updatedAt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductFilterQuery.prototype, "$OR", void 0);
class ProductFilterQueryFull extends ProductFilterQuery {
}
exports.ProductFilterQueryFull = ProductFilterQueryFull;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => BatchFilterQuery),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", BatchFilterQuery)
], ProductFilterQueryFull.prototype, "batchList", void 0);
class ProductSortQuery extends query_1.SortQuery {
}
exports.ProductSortQuery = ProductSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProductSortQuery.prototype, "brandName", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], ProductSortQuery.prototype, "quantity", void 0);


/***/ }),
/* 546 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductMergeBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class ProductMergeBody {
}
exports.ProductMergeBody = ProductMergeBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], ProductMergeBody.prototype, "productIdSourceList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ProductMergeBody.prototype, "productIdTarget", void 0);


/***/ }),
/* 547 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProductUpdateBody = exports.ProductCreateBody = exports.ProductUpdate = exports.ProductCreate = exports.UnitConversionBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const product_entity_1 = __webpack_require__(57);
const request_1 = __webpack_require__(394);
const request_2 = __webpack_require__(438);
class UnitConversionBody {
}
exports.UnitConversionBody = UnitConversionBody;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UnitConversionBody.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UnitConversionBody.prototype, "rate", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], UnitConversionBody.prototype, "default", void 0);
class ProductCreate {
}
exports.ProductCreate = ProductCreate;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "productCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Klacid 125mg/5ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "brandName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Clarythromycin 125mg/5ml' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "substance", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 59000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreate.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 45000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreate.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 45000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreate.prototype, "wholesalePrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 59000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], ProductCreate.prototype, "retailPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ProductCreate.prototype, "productGroupId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        name: 'unit',
        type: 'string',
        example: JSON.stringify([{ name: 'Viên', rate: 1 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new UnitConversionBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length)
                    err.push(...validate);
                return instance;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({
        message: `Validate unit failed: Example: ${JSON.stringify([{ name: 'Viên', rate: 1 }])}`,
    }),
    __metadata("design:type", String)
], ProductCreate.prototype, "unit", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "route", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Ấn Độ' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "source", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        example: 'https://cdn.medigoapp.com/product/Klacid_125mg_5ml_4724e139c8.jpg',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "image", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 1 viên/ngày, 9h sáng, sau ăn no' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], ProductCreate.prototype, "hintUsage", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], ProductCreate.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.ProductType, example: product_entity_1.ProductType.Basic }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.ProductType),
    __metadata("design:type", typeof (_a = typeof product_entity_1.ProductType !== "undefined" && product_entity_1.ProductType) === "function" ? _a : Object)
], ProductCreate.prototype, "productType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByWarehouse, example: product_entity_1.SplitBatchByWarehouse.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByWarehouse),
    __metadata("design:type", typeof (_b = typeof product_entity_1.SplitBatchByWarehouse !== "undefined" && product_entity_1.SplitBatchByWarehouse) === "function" ? _b : Object)
], ProductCreate.prototype, "splitBatchByWarehouse", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        enum: product_entity_1.SplitBatchByDistributor,
        example: product_entity_1.SplitBatchByDistributor.Inherit,
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByDistributor),
    __metadata("design:type", typeof (_c = typeof product_entity_1.SplitBatchByDistributor !== "undefined" && product_entity_1.SplitBatchByDistributor) === "function" ? _c : Object)
], ProductCreate.prototype, "splitBatchByDistributor", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByExpiryDate, example: product_entity_1.SplitBatchByExpiryDate.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByExpiryDate),
    __metadata("design:type", typeof (_d = typeof product_entity_1.SplitBatchByExpiryDate !== "undefined" && product_entity_1.SplitBatchByExpiryDate) === "function" ? _d : Object)
], ProductCreate.prototype, "splitBatchByExpiryDate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: product_entity_1.SplitBatchByCostPrice, example: product_entity_1.SplitBatchByCostPrice.Inherit }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(product_entity_1.SplitBatchByCostPrice),
    __metadata("design:type", typeof (_e = typeof product_entity_1.SplitBatchByCostPrice !== "undefined" && product_entity_1.SplitBatchByCostPrice) === "function" ? _e : Object)
], ProductCreate.prototype, "splitBatchByCostPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], ProductCreate.prototype, "warehouseIds", void 0);
class ProductUpdate extends (0, swagger_1.OmitType)(ProductCreate, ['quantity']) {
}
exports.ProductUpdate = ProductUpdate;
class ProductCreateBody {
}
exports.ProductCreateBody = ProductCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProductCreate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", ProductCreate)
], ProductCreateBody.prototype, "product", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductCreateBody.prototype, "positionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductCreateBody.prototype, "discountList", void 0);
class ProductUpdateBody {
}
exports.ProductUpdateBody = ProductUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ProductUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ProductUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", ProductUpdate)
], ProductUpdateBody.prototype, "product", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductUpdateBody.prototype, "positionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], ProductUpdateBody.prototype, "discountList", void 0);


/***/ }),
/* 548 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderItemModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_item_controller_1 = __webpack_require__(549);
const api_purchase_order_item_service_1 = __webpack_require__(551);
let ApiPurchaseOrderItemModule = class ApiPurchaseOrderItemModule {
};
exports.ApiPurchaseOrderItemModule = ApiPurchaseOrderItemModule;
exports.ApiPurchaseOrderItemModule = ApiPurchaseOrderItemModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_purchase_order_item_controller_1.ApiPurchaseOrderItemController],
        providers: [api_purchase_order_item_service_1.ApiPurchaseOrderItemService],
    })
], ApiPurchaseOrderItemModule);


/***/ }),
/* 549 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderItemController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const organization_guard_1 = __webpack_require__(156);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_purchase_order_item_service_1 = __webpack_require__(551);
const request_1 = __webpack_require__(552);
let ApiPurchaseOrderItemController = class ApiPurchaseOrderItemController {
    constructor(apiPurchaseOrderItemService) {
        this.apiPurchaseOrderItemService = apiPurchaseOrderItemService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiPurchaseOrderItemService.pagination(oid, query);
        return { data };
    }
};
exports.ApiPurchaseOrderItemController = ApiPurchaseOrderItemController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PurchaseOrderItemPaginationQuery !== "undefined" && request_1.PurchaseOrderItemPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPurchaseOrderItemController.prototype, "pagination", null);
exports.ApiPurchaseOrderItemController = ApiPurchaseOrderItemController = __decorate([
    (0, swagger_1.ApiTags)('PurchaseOrderItem'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('purchase-order-item'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_purchase_order_item_service_1.ApiPurchaseOrderItemService !== "undefined" && api_purchase_order_item_service_1.ApiPurchaseOrderItemService) === "function" ? _a : Object])
], ApiPurchaseOrderItemController);


/***/ }),
/* 550 */
/***/ ((module) => {

module.exports = require("@nestjs/common/decorators/http/route-params.decorator");

/***/ }),
/* 551 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderItemService = void 0;
const common_1 = __webpack_require__(3);
const purchase_order_item_repository_1 = __webpack_require__(125);
let ApiPurchaseOrderItemService = class ApiPurchaseOrderItemService {
    constructor(purchaseOrderItemRepository) {
        this.purchaseOrderItemRepository = purchaseOrderItemRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data: purchaseOrderItemList } = await this.purchaseOrderItemRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                purchaseOrderId: filter === null || filter === void 0 ? void 0 : filter.purchaseOrderId,
                distributorId: filter === null || filter === void 0 ? void 0 : filter.distributorId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                batchId: filter === null || filter === void 0 ? void 0 : filter.batchId,
            },
            sort,
        });
        return { purchaseOrderItemList, page, limit, total };
    }
};
exports.ApiPurchaseOrderItemService = ApiPurchaseOrderItemService;
exports.ApiPurchaseOrderItemService = ApiPurchaseOrderItemService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_item_repository_1.PurchaseOrderItemRepository !== "undefined" && purchase_order_item_repository_1.PurchaseOrderItemRepository) === "function" ? _a : Object])
], ApiPurchaseOrderItemService);


/***/ }),
/* 552 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(553), exports);
__exportStar(__webpack_require__(554), exports);


/***/ }),
/* 553 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderItemGetOneQuery = exports.PurchaseOrderItemGetManyQuery = exports.PurchaseOrderItemPaginationQuery = exports.PurchaseOrderItemGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const purchase_order_item_options_request_1 = __webpack_require__(554);
class PurchaseOrderItemGetQuery {
}
exports.PurchaseOrderItemGetQuery = PurchaseOrderItemGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_item_options_request_1.PurchaseOrderItemRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof purchase_order_item_options_request_1.PurchaseOrderItemRelationQuery !== "undefined" && purchase_order_item_options_request_1.PurchaseOrderItemRelationQuery) === "function" ? _a : Object)
], PurchaseOrderItemGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_item_options_request_1.PurchaseOrderItemFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof purchase_order_item_options_request_1.PurchaseOrderItemFilterQuery !== "undefined" && purchase_order_item_options_request_1.PurchaseOrderItemFilterQuery) === "function" ? _b : Object)
], PurchaseOrderItemGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_item_options_request_1.PurchaseOrderItemSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof purchase_order_item_options_request_1.PurchaseOrderItemSortQuery !== "undefined" && purchase_order_item_options_request_1.PurchaseOrderItemSortQuery) === "function" ? _c : Object)
], PurchaseOrderItemGetQuery.prototype, "sort", void 0);
class PurchaseOrderItemPaginationQuery extends (0, swagger_1.IntersectionType)(PurchaseOrderItemGetQuery, query_1.PaginationQuery) {
}
exports.PurchaseOrderItemPaginationQuery = PurchaseOrderItemPaginationQuery;
class PurchaseOrderItemGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PurchaseOrderItemGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PurchaseOrderItemGetManyQuery = PurchaseOrderItemGetManyQuery;
class PurchaseOrderItemGetOneQuery extends (0, swagger_1.PickType)(PurchaseOrderItemGetQuery, [
    'relation',
]) {
}
exports.PurchaseOrderItemGetOneQuery = PurchaseOrderItemGetOneQuery;


/***/ }),
/* 554 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderItemSortQuery = exports.PurchaseOrderItemFilterQuery = exports.PurchaseOrderItemRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class PurchaseOrderItemRelationQuery {
}
exports.PurchaseOrderItemRelationQuery = PurchaseOrderItemRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsObject)(),
    __metadata("design:type", Object)
], PurchaseOrderItemRelationQuery.prototype, "purchaseOrder", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PurchaseOrderItemRelationQuery.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PurchaseOrderItemRelationQuery.prototype, "product", void 0);
class PurchaseOrderItemFilterQuery {
}
exports.PurchaseOrderItemFilterQuery = PurchaseOrderItemFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemFilterQuery.prototype, "purchaseOrderId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemFilterQuery.prototype, "batchId", void 0);
class PurchaseOrderItemSortQuery extends query_1.SortQuery {
}
exports.PurchaseOrderItemSortQuery = PurchaseOrderItemSortQuery;


/***/ }),
/* 555 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_group_controller_1 = __webpack_require__(556);
const api_radiology_group_service_1 = __webpack_require__(297);
let ApiRadiologyGroupModule = class ApiRadiologyGroupModule {
};
exports.ApiRadiologyGroupModule = ApiRadiologyGroupModule;
exports.ApiRadiologyGroupModule = ApiRadiologyGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_radiology_group_controller_1.ApiRadiologyGroupController],
        providers: [api_radiology_group_service_1.ApiRadiologyGroupService],
    })
], ApiRadiologyGroupModule);


/***/ }),
/* 556 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_radiology_group_service_1 = __webpack_require__(297);
const request_1 = __webpack_require__(557);
let ApiRadiologyGroupController = class ApiRadiologyGroupController {
    constructor(apiRadiologyGroupService) {
        this.apiRadiologyGroupService = apiRadiologyGroupService;
    }
    pagination({ oid }, query) {
        return this.apiRadiologyGroupService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiRadiologyGroupService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiRadiologyGroupService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiRadiologyGroupService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiRadiologyGroupService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRadiologyGroupService.destroyOne(oid, id);
    }
    async replaceAll({ oid }, body) {
        return await this.apiRadiologyGroupService.replaceAll(oid, body);
    }
    async systemList() {
        return await this.apiRadiologyGroupService.systemList();
    }
};
exports.ApiRadiologyGroupController = ApiRadiologyGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RadiologyGroupPaginationQuery !== "undefined" && request_1.RadiologyGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RadiologyGroupGetManyQuery !== "undefined" && request_1.RadiologyGroupGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyGroupController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.RadiologyGroupUpsertBody !== "undefined" && request_1.RadiologyGroupUpsertBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.RadiologyGroupUpsertBody !== "undefined" && request_1.RadiologyGroupUpsertBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Put)('replace-all'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof request_1.RadiologyGroupReplaceAllBody !== "undefined" && request_1.RadiologyGroupReplaceAllBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "replaceAll", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_GROUP_CRUD),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiRadiologyGroupController.prototype, "systemList", null);
exports.ApiRadiologyGroupController = ApiRadiologyGroupController = __decorate([
    (0, swagger_1.ApiTags)('RadiologyGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('radiology-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_radiology_group_service_1.ApiRadiologyGroupService !== "undefined" && api_radiology_group_service_1.ApiRadiologyGroupService) === "function" ? _a : Object])
], ApiRadiologyGroupController);


/***/ }),
/* 557 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(558), exports);
__exportStar(__webpack_require__(559), exports);
__exportStar(__webpack_require__(560), exports);


/***/ }),
/* 558 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupGetOneQuery = exports.RadiologyGroupGetManyQuery = exports.RadiologyGroupPaginationQuery = exports.RadiologyGroupGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const radiology_group_options_request_1 = __webpack_require__(559);
class RadiologyGroupGetQuery {
}
exports.RadiologyGroupGetQuery = RadiologyGroupGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof radiology_group_options_request_1.RadiologyGroupRelationQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupRelationQuery) === "function" ? _a : Object)
], RadiologyGroupGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof radiology_group_options_request_1.RadiologyGroupFilterQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupFilterQuery) === "function" ? _b : Object)
], RadiologyGroupGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_group_options_request_1.RadiologyGroupSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof radiology_group_options_request_1.RadiologyGroupSortQuery !== "undefined" && radiology_group_options_request_1.RadiologyGroupSortQuery) === "function" ? _c : Object)
], RadiologyGroupGetQuery.prototype, "sort", void 0);
class RadiologyGroupPaginationQuery extends (0, swagger_1.IntersectionType)(RadiologyGroupGetQuery, query_1.PaginationQuery) {
}
exports.RadiologyGroupPaginationQuery = RadiologyGroupPaginationQuery;
class RadiologyGroupGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RadiologyGroupGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RadiologyGroupGetManyQuery = RadiologyGroupGetManyQuery;
class RadiologyGroupGetOneQuery extends (0, swagger_1.PickType)(RadiologyGroupGetQuery, ['relation']) {
}
exports.RadiologyGroupGetOneQuery = RadiologyGroupGetOneQuery;


/***/ }),
/* 559 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupSortQuery = exports.RadiologyGroupFilterQuery = exports.RadiologyGroupRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class RadiologyGroupRelationQuery {
}
exports.RadiologyGroupRelationQuery = RadiologyGroupRelationQuery;
class RadiologyGroupFilterQuery {
}
exports.RadiologyGroupFilterQuery = RadiologyGroupFilterQuery;
class RadiologyGroupSortQuery extends query_1.SortQuery {
}
exports.RadiologyGroupSortQuery = RadiologyGroupSortQuery;


/***/ }),
/* 560 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGroupReplaceAllBody = exports.RadiologyGroupUpsertBody = exports.RadiologyGroupBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RadiologyGroupBody {
}
exports.RadiologyGroupBody = RadiologyGroupBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", Number)
], RadiologyGroupBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Nhóm ABC' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RadiologyGroupBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyGroupBody.prototype, "roomId", void 0);
class RadiologyGroupUpsertBody extends (0, swagger_1.OmitType)(RadiologyGroupBody, ['id']) {
}
exports.RadiologyGroupUpsertBody = RadiologyGroupUpsertBody;
class RadiologyGroupReplaceAllBody {
}
exports.RadiologyGroupReplaceAllBody = RadiologyGroupReplaceAllBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: RadiologyGroupBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RadiologyGroupBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], RadiologyGroupReplaceAllBody.prototype, "radiologyGroupReplaceAll", void 0);


/***/ }),
/* 561 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologySampleModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_sample_controller_1 = __webpack_require__(562);
const api_radiology_sample_service_1 = __webpack_require__(563);
let ApiRadiologySampleModule = class ApiRadiologySampleModule {
};
exports.ApiRadiologySampleModule = ApiRadiologySampleModule;
exports.ApiRadiologySampleModule = ApiRadiologySampleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_radiology_sample_controller_1.ApiRadiologySampleController],
        providers: [api_radiology_sample_service_1.ApiRadiologySampleService],
    })
], ApiRadiologySampleModule);


/***/ }),
/* 562 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologySampleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_radiology_sample_service_1 = __webpack_require__(563);
const request_1 = __webpack_require__(564);
let ApiRadiologySampleController = class ApiRadiologySampleController {
    constructor(apiRadiologySampleService) {
        this.apiRadiologySampleService = apiRadiologySampleService;
    }
    pagination({ oid }, query) {
        return this.apiRadiologySampleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiRadiologySampleService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiRadiologySampleService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiRadiologySampleService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiRadiologySampleService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRadiologySampleService.destroyOne(oid, id);
    }
};
exports.ApiRadiologySampleController = ApiRadiologySampleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RadiologySamplePaginationQuery !== "undefined" && request_1.RadiologySamplePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologySampleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RadiologySampleGetManyQuery !== "undefined" && request_1.RadiologySampleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologySampleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologySampleController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.RadiologySampleCreateBody !== "undefined" && request_1.RadiologySampleCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologySampleController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.RadiologySampleUpdateBody !== "undefined" && request_1.RadiologySampleUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologySampleController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_SAMPLE_CRUD),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologySampleController.prototype, "destroyOne", null);
exports.ApiRadiologySampleController = ApiRadiologySampleController = __decorate([
    (0, swagger_1.ApiTags)('RadiologySample'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('radiology-sample'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_radiology_sample_service_1.ApiRadiologySampleService !== "undefined" && api_radiology_sample_service_1.ApiRadiologySampleService) === "function" ? _a : Object])
], ApiRadiologySampleController);


/***/ }),
/* 563 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologySampleService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const radiology_sample_repository_1 = __webpack_require__(128);
let ApiRadiologySampleService = class ApiRadiologySampleService {
    constructor(radiologySampleRepository) {
        this.radiologySampleRepository = radiologySampleRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.radiologySampleRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                userId: filter === null || filter === void 0 ? void 0 : filter.userId,
                radiologyId: filter === null || filter === void 0 ? void 0 : filter.radiologyId,
            },
            sort,
        });
        return {
            data: {
                radiologySampleList: data,
                total,
                page,
                limit,
            },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const radiologySampleList = await this.radiologySampleRepository.findMany({
            relation,
            condition: {
                oid,
                userId: filter === null || filter === void 0 ? void 0 : filter.userId,
                radiologyId: filter === null || filter === void 0 ? void 0 : filter.radiologyId,
            },
            limit,
            sort,
        });
        return { data: { radiologySampleList } };
    }
    async getOne(oid, id) {
        const radiologySample = await this.radiologySampleRepository.findOneBy({
            oid,
            id,
        });
        if (!radiologySample)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { radiologySample } };
    }
    async createOne(oid, body) {
        const rcsInsert = Object.assign({ oid }, body);
        const radiologySample = await this.radiologySampleRepository.insertOneAndReturnEntity(rcsInsert);
        return { data: { radiologySample } };
    }
    async updateOne(oid, id, body) {
        const radiologySample = await this.radiologySampleRepository.updateOneAndReturnEntity({ id, oid }, body);
        return { data: { radiologySample } };
    }
    async destroyOne(oid, id) {
        const radiologySampleDestroyed = await this.radiologySampleRepository.deleteOneAndReturnEntity({
            oid,
            id,
        });
        return { data: { radiologySampleDestroyed } };
    }
};
exports.ApiRadiologySampleService = ApiRadiologySampleService;
exports.ApiRadiologySampleService = ApiRadiologySampleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof radiology_sample_repository_1.RadiologySampleRepository !== "undefined" && radiology_sample_repository_1.RadiologySampleRepository) === "function" ? _a : Object])
], ApiRadiologySampleService);


/***/ }),
/* 564 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(565), exports);
__exportStar(__webpack_require__(566), exports);
__exportStar(__webpack_require__(567), exports);


/***/ }),
/* 565 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySampleGetOneQuery = exports.RadiologySampleGetManyQuery = exports.RadiologySamplePaginationQuery = exports.RadiologySampleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const radiology_sample_options_request_1 = __webpack_require__(566);
class RadiologySampleGetQuery {
}
exports.RadiologySampleGetQuery = RadiologySampleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_sample_options_request_1.RadiologySampleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof radiology_sample_options_request_1.RadiologySampleRelationQuery !== "undefined" && radiology_sample_options_request_1.RadiologySampleRelationQuery) === "function" ? _a : Object)
], RadiologySampleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_sample_options_request_1.RadiologySampleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof radiology_sample_options_request_1.RadiologySampleFilterQuery !== "undefined" && radiology_sample_options_request_1.RadiologySampleFilterQuery) === "function" ? _b : Object)
], RadiologySampleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_sample_options_request_1.RadiologySampleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof radiology_sample_options_request_1.RadiologySampleSortQuery !== "undefined" && radiology_sample_options_request_1.RadiologySampleSortQuery) === "function" ? _c : Object)
], RadiologySampleGetQuery.prototype, "sort", void 0);
class RadiologySamplePaginationQuery extends (0, swagger_1.IntersectionType)(RadiologySampleGetQuery, query_1.PaginationQuery) {
}
exports.RadiologySamplePaginationQuery = RadiologySamplePaginationQuery;
class RadiologySampleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RadiologySampleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RadiologySampleGetManyQuery = RadiologySampleGetManyQuery;
class RadiologySampleGetOneQuery extends (0, swagger_1.PickType)(RadiologySampleGetQuery, ['relation']) {
}
exports.RadiologySampleGetOneQuery = RadiologySampleGetOneQuery;


/***/ }),
/* 566 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySampleSortQuery = exports.RadiologySampleFilterQuery = exports.RadiologySampleRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class RadiologySampleRelationQuery {
}
exports.RadiologySampleRelationQuery = RadiologySampleRelationQuery;
class RadiologySampleFilterQuery {
}
exports.RadiologySampleFilterQuery = RadiologySampleFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleFilterQuery.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleFilterQuery.prototype, "userId", void 0);
class RadiologySampleSortQuery extends query_1.SortQuery {
}
exports.RadiologySampleSortQuery = RadiologySampleSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySampleSortQuery.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySampleSortQuery.prototype, "priority", void 0);


/***/ }),
/* 567 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySampleUpdateBody = exports.RadiologySampleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RadiologySampleCreateBody {
}
exports.RadiologySampleCreateBody = RadiologySampleCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RadiologySampleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleCreateBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleCreateBody.prototype, "userId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleCreateBody.prototype, "radiologyId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologySampleCreateBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologySampleCreateBody.prototype, "description", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologySampleCreateBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologySampleCreateBody.prototype, "customStyles", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologySampleCreateBody.prototype, "customVariables", void 0);
class RadiologySampleUpdateBody extends (0, swagger_1.PartialType)(RadiologySampleCreateBody) {
}
exports.RadiologySampleUpdateBody = RadiologySampleUpdateBody;


/***/ }),
/* 568 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_radiology_group_service_1 = __webpack_require__(297);
const api_radiology_controller_1 = __webpack_require__(569);
const api_radiology_service_1 = __webpack_require__(570);
let ApiRadiologyModule = class ApiRadiologyModule {
};
exports.ApiRadiologyModule = ApiRadiologyModule;
exports.ApiRadiologyModule = ApiRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_radiology_controller_1.ApiRadiologyController],
        providers: [api_radiology_service_1.ApiRadiologyService, api_radiology_group_service_1.ApiRadiologyGroupService],
    })
], ApiRadiologyModule);


/***/ }),
/* 569 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_radiology_service_1 = __webpack_require__(570);
const request_1 = __webpack_require__(571);
let ApiRadiologyController = class ApiRadiologyController {
    constructor(apiRadiologyService) {
        this.apiRadiologyService = apiRadiologyService;
    }
    pagination({ oid }, query) {
        return this.apiRadiologyService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiRadiologyService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiRadiologyService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiRadiologyService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiRadiologyService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRadiologyService.destroyOne(oid, id);
    }
    async systemList() {
        return await this.apiRadiologyService.systemList();
    }
    async systemCopy({ oid }, body) {
        return await this.apiRadiologyService.systemCopy(oid, body);
    }
};
exports.ApiRadiologyController = ApiRadiologyController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RadiologyPaginationQuery !== "undefined" && request_1.RadiologyPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRadiologyController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RadiologyGetManyQuery !== "undefined" && request_1.RadiologyGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.RadiologyGetOneQuery !== "undefined" && request_1.RadiologyGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RadiologyUpsertBody !== "undefined" && request_1.RadiologyUpsertBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_UPDATE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.RadiologyUpsertBody !== "undefined" && request_1.RadiologyUpsertBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Get)('system-list'),
    (0, user_guard_1.UserPermission)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "systemList", null);
__decorate([
    (0, common_1.Post)('system-copy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.RADIOLOGY_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof request_1.RadiologySystemCopyBody !== "undefined" && request_1.RadiologySystemCopyBody) === "function" ? _s : Object]),
    __metadata("design:returntype", Promise)
], ApiRadiologyController.prototype, "systemCopy", null);
exports.ApiRadiologyController = ApiRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('Radiology'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_radiology_service_1.ApiRadiologyService !== "undefined" && api_radiology_service_1.ApiRadiologyService) === "function" ? _a : Object])
], ApiRadiologyController);


/***/ }),
/* 570 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const discount_entity_1 = __webpack_require__(77);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
const api_radiology_group_service_1 = __webpack_require__(297);
let ApiRadiologyService = class ApiRadiologyService {
    constructor(socketEmitService, radiologyRepository, radiologyGroupRepository, printHtmlRepository, ticketRadiologyRepository, positionRepository, discountRepository, apiRadiologyGroupService) {
        this.socketEmitService = socketEmitService;
        this.radiologyRepository = radiologyRepository;
        this.radiologyGroupRepository = radiologyGroupRepository;
        this.printHtmlRepository = printHtmlRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.positionRepository = positionRepository;
        this.discountRepository = discountRepository;
        this.apiRadiologyGroupService = apiRadiologyGroupService;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data, total } = await this.radiologyRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                radiologyGroupId: filter === null || filter === void 0 ? void 0 : filter.radiologyGroupId,
                printHtmlId: filter === null || filter === void 0 ? void 0 : filter.printHtmlId,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, radiologyList: data, relation: query.relation });
        }
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const data = await this.radiologyRepository.findMany({
            condition: {
                oid,
                radiologyGroupId: filter === null || filter === void 0 ? void 0 : filter.radiologyGroupId,
                printHtmlId: filter === null || filter === void 0 ? void 0 : filter.printHtmlId,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
            limit,
        });
        if (query.relation) {
            await this.generateRelation({ oid, radiologyList: data, relation: query.relation });
        }
        return { data };
    }
    async getOne(oid, id, query) {
        const radiology = await this.radiologyRepository.findOne({
            condition: { oid, id },
        });
        if (!radiology)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query.relation) {
            await this.generateRelation({ oid, radiologyList: [radiology], relation: query.relation });
        }
        return { data: { radiology } };
    }
    async createOne(oid, body) {
        const { positionList, radiology: radiologyBody, discountList } = body;
        let radiologyCode = radiologyBody.radiologyCode;
        if (!radiologyCode) {
            const maxId = await this.radiologyRepository.getMaxId();
            radiologyCode = (maxId + 1).toString();
        }
        const existRadiology = await this.radiologyRepository.findOneBy({
            oid,
            radiologyCode,
        });
        if (existRadiology) {
            throw new exception_filter_1.BusinessException(`Trùng mã phiếu với ${existRadiology.name}`);
        }
        const radiology = await this.radiologyRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, radiologyBody), { oid,
            radiologyCode }));
        this.socketEmitService.radiologyListChange(oid, { radiologyUpsertedList: [radiology] });
        if (positionList === null || positionList === void 0 ? void 0 : positionList.length) {
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: radiology.id,
                    positionType: position_entity_1.PositionInteractType.Radiology,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            radiology.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, { positionUpsertedList });
        }
        if (discountList === null || discountList === void 0 ? void 0 : discountList.length) {
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: radiology.id, discountInteractType: discount_entity_1.DiscountInteractType.Radiology, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            radiology.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, { discountUpsertedList });
        }
        return { data: { radiology } };
    }
    async updateOne(oid, radiologyId, body) {
        const { positionList, radiology: radiologyBody, discountList } = body;
        if (radiologyBody.radiologyCode != null) {
            const existRadiology = await this.radiologyRepository.findOneBy({
                oid,
                radiologyCode: radiologyBody.radiologyCode,
                id: { NOT: radiologyId },
            });
            if (existRadiology) {
                throw new exception_filter_1.BusinessException(`Trùng mã sản phẩm với ${existRadiology.name}`);
            }
        }
        const radiology = await this.radiologyRepository.updateOneAndReturnEntity({ oid, id: radiologyId }, radiologyBody);
        this.socketEmitService.radiologyListChange(oid, { radiologyUpsertedList: [radiology] });
        if (positionList) {
            const positionDestroyedList = await this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: radiology.id,
                positionType: position_entity_1.PositionInteractType.Radiology,
            });
            const positionDtoList = positionList.map((i) => {
                const dto = {
                    oid,
                    roleId: i.roleId,
                    commissionCalculatorType: i.commissionCalculatorType,
                    commissionValue: i.commissionValue,
                    positionInteractId: radiology.id,
                    positionType: position_entity_1.PositionInteractType.Radiology,
                };
                return dto;
            });
            const positionUpsertedList = await this.positionRepository.insertManyFullFieldAndReturnEntity(positionDtoList);
            radiology.positionList = positionUpsertedList;
            this.socketEmitService.positionListChange(oid, {
                positionUpsertedList,
                positionDestroyedList,
            });
        }
        if (discountList) {
            const discountDestroyedList = await this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: radiology.id,
                discountInteractType: discount_entity_1.DiscountInteractType.Radiology,
            });
            const discountListDto = discountList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { discountInteractId: radiology.id, discountInteractType: discount_entity_1.DiscountInteractType.Radiology, oid });
                return dto;
            });
            const discountUpsertedList = await this.discountRepository.insertManyFullFieldAndReturnEntity(discountListDto);
            radiology.discountList = discountUpsertedList;
            this.socketEmitService.discountListChange(oid, {
                discountUpsertedList,
                discountDestroyedList,
            });
        }
        return { data: { radiology } };
    }
    async destroyOne(oid, radiologyId) {
        const ticketRadiologyList = await this.ticketRadiologyRepository.findMany({
            condition: { oid, radiologyId },
            limit: 10,
        });
        if (ticketRadiologyList.length > 0) {
            return {
                data: { ticketRadiologyList },
                success: false,
            };
        }
        const [positionDestroyedList, discountDestroyedList] = await Promise.all([
            this.positionRepository.deleteAndReturnEntity({
                oid,
                positionInteractId: radiologyId,
                positionType: position_entity_1.PositionInteractType.Radiology,
            }),
            this.discountRepository.deleteAndReturnEntity({
                oid,
                discountInteractId: radiologyId,
                discountInteractType: discount_entity_1.DiscountInteractType.Radiology,
            }),
        ]);
        if (positionDestroyedList.length) {
            this.socketEmitService.positionListChange(oid, { positionDestroyedList });
        }
        if (discountDestroyedList.length) {
            this.socketEmitService.discountListChange(oid, { discountDestroyedList });
        }
        const radiology = await this.radiologyRepository.deleteOneAndReturnEntity({
            oid,
            id: radiologyId,
        });
        this.socketEmitService.radiologyListChange(oid, { radiologyDestroyedList: [radiology] });
        return { data: { ticketRadiologyList: [], radiologyId } };
    }
    async systemList() {
        const data = await this.radiologyRepository.findMany({
            relation: { printHtml: true },
            condition: { oid: 1 },
            sort: { radiologyCode: 'ASC' },
        });
        return { data };
    }
    async systemCopy(oid, body) {
        const radiologySystemList = await this.radiologyRepository.findMany({
            relation: { radiologyGroup: true },
            condition: { oid: 1, id: { IN: body.radiologyIdList } },
        });
        const groupNameList = radiologySystemList.map((i) => { var _a; return ((_a = i.radiologyGroup) === null || _a === void 0 ? void 0 : _a.name) || ''; });
        const radiologyGroupList = await this.apiRadiologyGroupService.createByGroupName(oid, groupNameList);
        const radiologyGroupMapName = helpers_1.ESArray.arrayToKeyValue(radiologyGroupList, 'name');
        let maxId = await this.radiologyRepository.getMaxId();
        const radiologyInsertList = radiologySystemList.map((i) => {
            var _a, _b;
            let radiologyGroupId = 0;
            const radiologyGroupName = (_a = i.radiologyGroup) === null || _a === void 0 ? void 0 : _a.name;
            if (radiologyGroupName) {
                radiologyGroupId = ((_b = radiologyGroupMapName[radiologyGroupName]) === null || _b === void 0 ? void 0 : _b.id) || 0;
            }
            maxId++;
            const dto = {
                oid,
                name: i.name,
                costPrice: i.costPrice,
                price: i.price,
                printHtmlId: i.printHtmlId,
                radiologyGroupId,
                descriptionDefault: i.descriptionDefault,
                requestNoteDefault: i.requestNoteDefault,
                resultDefault: i.resultDefault,
                customVariables: i.customVariables,
                customStyles: i.customStyles,
                radiologyCode: maxId.toString(),
            };
            return dto;
        });
        const insertIds = await this.radiologyRepository.insertMany(radiologyInsertList);
        return { data: true };
    }
    async generateRelation(options) {
        const { oid, radiologyList, relation } = options;
        const radiologyIdList = helpers_1.ESArray.uniqueArray(radiologyList.map((i) => i.id));
        const radiologyGroupIdList = helpers_1.ESArray.uniqueArray(radiologyList.map((i) => i.radiologyGroupId));
        const printHtmlIdList = helpers_1.ESArray.uniqueArray(radiologyList.map((i) => i.printHtmlId));
        const [positionList, discountList, radiologyGroupList, printHtmlList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.positionList) && radiologyIdList.length
                ? this.positionRepository.findManyBy({
                    oid,
                    positionType: position_entity_1.PositionInteractType.Radiology,
                    positionInteractId: { IN: radiologyIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.discountList) && radiologyIdList.length
                ? this.discountRepository.findManyBy({
                    oid,
                    discountInteractType: discount_entity_1.DiscountInteractType.Radiology,
                    discountInteractId: { IN: [...radiologyIdList, 0] },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.radiologyGroup) && radiologyGroupIdList.length
                ? this.radiologyGroupRepository.findManyBy({
                    oid,
                    id: { IN: radiologyGroupIdList },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.printHtml) && printHtmlIdList.length
                ? this.printHtmlRepository.findManyBy({
                    oid,
                    id: { IN: printHtmlIdList },
                })
                : [],
        ]);
        const radiologyGroupMap = helpers_1.ESArray.arrayToKeyValue(radiologyGroupList, 'id');
        const printHtmlMap = helpers_1.ESArray.arrayToKeyValue(printHtmlList, 'id');
        radiologyList.forEach((radiology) => {
            if (relation === null || relation === void 0 ? void 0 : relation.positionList) {
                radiology.positionList = positionList.filter((i) => i.positionInteractId === radiology.id);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.discountList) {
                radiology.discountList = discountList.filter((i) => i.discountInteractId === radiology.id);
                radiology.discountListExtra = discountList.filter((i) => i.discountInteractId === 0);
            }
            if (relation === null || relation === void 0 ? void 0 : relation.radiologyGroup) {
                radiology.radiologyGroup = radiologyGroupMap[radiology.radiologyGroupId];
            }
            if (relation === null || relation === void 0 ? void 0 : relation.printHtml) {
                radiology.printHtml = printHtmlMap[radiology.printHtmlId];
            }
        });
        return radiologyList;
    }
};
exports.ApiRadiologyService = ApiRadiologyService;
exports.ApiRadiologyService = ApiRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.RadiologyGroupRepository !== "undefined" && repositories_1.RadiologyGroupRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.PrintHtmlRepository !== "undefined" && repositories_1.PrintHtmlRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.PositionRepository !== "undefined" && repositories_1.PositionRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.DiscountRepository !== "undefined" && repositories_1.DiscountRepository) === "function" ? _g : Object, typeof (_h = typeof api_radiology_group_service_1.ApiRadiologyGroupService !== "undefined" && api_radiology_group_service_1.ApiRadiologyGroupService) === "function" ? _h : Object])
], ApiRadiologyService);


/***/ }),
/* 571 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(572), exports);
__exportStar(__webpack_require__(573), exports);
__exportStar(__webpack_require__(574), exports);
__exportStar(__webpack_require__(575), exports);


/***/ }),
/* 572 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyGetOneQuery = exports.RadiologyGetManyQuery = exports.RadiologyPaginationQuery = exports.RadiologyGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const radiology_options_request_1 = __webpack_require__(573);
class RadiologyGetQuery {
}
exports.RadiologyGetQuery = RadiologyGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologyRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof radiology_options_request_1.RadiologyRelationQuery !== "undefined" && radiology_options_request_1.RadiologyRelationQuery) === "function" ? _a : Object)
], RadiologyGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologyFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof radiology_options_request_1.RadiologyFilterQuery !== "undefined" && radiology_options_request_1.RadiologyFilterQuery) === "function" ? _b : Object)
], RadiologyGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(radiology_options_request_1.RadiologySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof radiology_options_request_1.RadiologySortQuery !== "undefined" && radiology_options_request_1.RadiologySortQuery) === "function" ? _c : Object)
], RadiologyGetQuery.prototype, "sort", void 0);
class RadiologyPaginationQuery extends (0, swagger_1.IntersectionType)(RadiologyGetQuery, query_1.PaginationQuery) {
}
exports.RadiologyPaginationQuery = RadiologyPaginationQuery;
class RadiologyGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RadiologyGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RadiologyGetManyQuery = RadiologyGetManyQuery;
class RadiologyGetOneQuery extends (0, swagger_1.PickType)(RadiologyGetQuery, ['relation']) {
}
exports.RadiologyGetOneQuery = RadiologyGetOneQuery;


/***/ }),
/* 573 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySortQuery = exports.RadiologyFilterQuery = exports.RadiologyRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
class RadiologyRelationQuery {
}
exports.RadiologyRelationQuery = RadiologyRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "radiologyGroup", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "printHtml", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "positionList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], RadiologyRelationQuery.prototype, "discountList", void 0);
class RadiologyFilterQuery {
}
exports.RadiologyFilterQuery = RadiologyFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologyFilterQuery.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RadiologyFilterQuery.prototype, "printHtmlId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _a : Object)
], RadiologyFilterQuery.prototype, "updatedAt", void 0);
class RadiologySortQuery extends query_1.SortQuery {
}
exports.RadiologySortQuery = RadiologySortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySortQuery.prototype, "name", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RadiologySortQuery.prototype, "radiologyCode", void 0);


/***/ }),
/* 574 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologySystemCopyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RadiologySystemCopyBody {
}
exports.RadiologySystemCopyBody = RadiologySystemCopyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], RadiologySystemCopyBody.prototype, "radiologyIdList", void 0);


/***/ }),
/* 575 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RadiologyUpsertBody = exports.RadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const DOMPurify = __webpack_require__(576);
const request_1 = __webpack_require__(394);
const request_2 = __webpack_require__(438);
class RadiologyBody {
}
exports.RadiologyBody = RadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "radiologyCode", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Siêu âm tuyến giáp' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyBody.prototype, "radiologyGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], RadiologyBody.prototype, "price", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Siêu âm thai, rau, ối' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "requestNoteDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '<h1>Âm tính</h1>' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => DOMPurify.sanitize(value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "descriptionDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Chưa có dấu hiệu bất thường' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "resultDefault", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "customVariables", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RadiologyBody.prototype, "customStyles", void 0);
class RadiologyUpsertBody {
}
exports.RadiologyUpsertBody = RadiologyUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: RadiologyBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RadiologyBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", RadiologyBody)
], RadiologyUpsertBody.prototype, "radiology", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.PositionBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.PositionBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], RadiologyUpsertBody.prototype, "positionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.DiscountUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.DiscountUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], RadiologyUpsertBody.prototype, "discountList", void 0);


/***/ }),
/* 576 */
/***/ ((module) => {

module.exports = require("isomorphic-dompurify");

/***/ }),
/* 577 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleModule = void 0;
const common_1 = __webpack_require__(3);
const api_role_controller_1 = __webpack_require__(578);
const api_role_service_1 = __webpack_require__(579);
let ApiRoleModule = class ApiRoleModule {
};
exports.ApiRoleModule = ApiRoleModule;
exports.ApiRoleModule = ApiRoleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_role_controller_1.ApiRoleController],
        providers: [api_role_service_1.ApiRoleService],
    })
], ApiRoleModule);


/***/ }),
/* 578 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_role_service_1 = __webpack_require__(579);
const request_1 = __webpack_require__(580);
let ApiRoleController = class ApiRoleController {
    constructor(apiRoleService) {
        this.apiRoleService = apiRoleService;
    }
    pagination({ oid }, query) {
        return this.apiRoleService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiRoleService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiRoleService.getOne(oid, id, query);
    }
    async create({ oid }, body) {
        return await this.apiRoleService.createOne(oid, body);
    }
    async update({ oid }, { id }, body) {
        return await this.apiRoleService.updateOne(oid, +id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiRoleService.destroyOne(oid, id);
    }
};
exports.ApiRoleController = ApiRoleController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RolePaginationQuery !== "undefined" && request_1.RolePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiRoleController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.RoleGetManyQuery !== "undefined" && request_1.RoleGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiRoleController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.RoleGetOneQuery !== "undefined" && request_1.RoleGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ROLE_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.RoleCreateBody !== "undefined" && request_1.RoleCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "create", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ROLE_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.RoleUpdateBody !== "undefined" && request_1.RoleUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ROLE_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], ApiRoleController.prototype, "destroyOne", null);
exports.ApiRoleController = ApiRoleController = __decorate([
    (0, swagger_1.ApiTags)('Role'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('role'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_role_service_1.ApiRoleService !== "undefined" && api_role_service_1.ApiRoleService) === "function" ? _a : Object])
], ApiRoleController);


/***/ }),
/* 579 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoleService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(42);
let ApiRoleService = class ApiRoleService {
    constructor(roleRepository, userRepository, userRoleRepository, cacheDataService) {
        this.roleRepository = roleRepository;
        this.userRepository = userRepository;
        this.userRoleRepository = userRoleRepository;
        this.cacheDataService = cacheDataService;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.roleRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.roleRepository.findMany({
            relation,
            condition: {
                oid,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const role = await this.roleRepository.findOne({
            relation: query.relation,
            condition: { oid, id },
        });
        if (!role)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { role } };
    }
    async createOne(oid, body) {
        const { userIdList } = body, other = __rest(body, ["userIdList"]);
        const role = await this.roleRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, other), { oid }));
        if (userIdList.length) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            role.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(userIdList.map((i) => ({
                oid,
                roleId: role.id,
                userId: i,
            })));
        }
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { data: { role } };
    }
    async updateOne(oid, roleId, body) {
        const { userIdList } = body, other = __rest(body, ["userIdList"]);
        const [role] = await this.roleRepository.updateAndReturnEntity({ oid, id: roleId }, other);
        if (!role) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        await this.userRoleRepository.delete({ oid, roleId });
        if (userIdList.length) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            role.userRoleList = await this.userRoleRepository.insertManyFullFieldAndReturnEntity(userIdList.map((i) => ({
                oid,
                roleId: role.id,
                userId: i,
            })));
        }
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { data: { role } };
    }
    async destroyOne(oid, roleId) {
        const affected = await this.roleRepository.delete({ oid, id: roleId });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.DeleteFailed');
        }
        await this.userRoleRepository.delete({ oid, roleId });
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { data: { roleId } };
    }
};
exports.ApiRoleService = ApiRoleService;
exports.ApiRoleService = ApiRoleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RoleRepository !== "undefined" && repositories_1.RoleRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _c : Object, typeof (_d = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _d : Object])
], ApiRoleService);


/***/ }),
/* 580 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(581), exports);
__exportStar(__webpack_require__(582), exports);
__exportStar(__webpack_require__(583), exports);


/***/ }),
/* 581 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleGetOneQuery = exports.RoleGetManyQuery = exports.RolePaginationQuery = exports.RoleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const role_options_request_1 = __webpack_require__(582);
class RoleGetQuery {
}
exports.RoleGetQuery = RoleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof role_options_request_1.RoleRelationQuery !== "undefined" && role_options_request_1.RoleRelationQuery) === "function" ? _a : Object)
], RoleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            isActive: 1,
            updatedAt: { GT: Date.now() },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof role_options_request_1.RoleFilterQuery !== "undefined" && role_options_request_1.RoleFilterQuery) === "function" ? _b : Object)
], RoleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
            code: 'DESC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(role_options_request_1.RoleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof role_options_request_1.RoleSortQuery !== "undefined" && role_options_request_1.RoleSortQuery) === "function" ? _c : Object)
], RoleGetQuery.prototype, "sort", void 0);
class RolePaginationQuery extends (0, swagger_1.IntersectionType)(RoleGetQuery, query_1.PaginationQuery) {
}
exports.RolePaginationQuery = RolePaginationQuery;
class RoleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RoleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RoleGetManyQuery = RoleGetManyQuery;
class RoleGetOneQuery extends (0, swagger_1.PickType)(RoleGetQuery, ['relation']) {
}
exports.RoleGetOneQuery = RoleGetOneQuery;


/***/ }),
/* 582 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleSortQuery = exports.RoleFilterQuery = exports.RoleRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class RoleRelationQuery {
}
exports.RoleRelationQuery = RoleRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], RoleRelationQuery.prototype, "userRoleList", void 0);
class RoleFilterQuery {
}
exports.RoleFilterQuery = RoleFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RoleFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], RoleFilterQuery.prototype, "updatedAt", void 0);
class RoleSortQuery extends query_1.SortQuery {
}
exports.RoleSortQuery = RoleSortQuery;


/***/ }),
/* 583 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoleUpdateBody = exports.RoleCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class RoleCreateBody {
}
exports.RoleCreateBody = RoleCreateBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'DOCTOR' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "roleCode", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Bác sĩ' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 2, 3, 4]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (typeof i !== 'number' || i <= 0) {
                    err.push(i + ' is not number');
                }
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: 'Validate permissions failed: Example: ' + JSON.stringify([4, 5, 6]) }),
    __metadata("design:type", String)
], RoleCreateBody.prototype, "permissionIds", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], RoleCreateBody.prototype, "isActive", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RoleCreateBody.prototype, "userIdList", void 0);
class RoleUpdateBody extends RoleCreateBody {
}
exports.RoleUpdateBody = RoleUpdateBody;


/***/ }),
/* 584 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoomModule = void 0;
const common_1 = __webpack_require__(3);
const api_room_controller_1 = __webpack_require__(585);
const api_room_service_1 = __webpack_require__(586);
let ApiRoomModule = class ApiRoomModule {
};
exports.ApiRoomModule = ApiRoomModule;
exports.ApiRoomModule = ApiRoomModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_room_controller_1.ApiRoomController],
        providers: [api_room_service_1.ApiRoomService],
    })
], ApiRoomModule);


/***/ }),
/* 585 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoomController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_room_service_1 = __webpack_require__(586);
const request_1 = __webpack_require__(587);
let ApiRoomController = class ApiRoomController {
    constructor(apiRoomService) {
        this.apiRoomService = apiRoomService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiRoomService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiRoomService.getMany(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }, query) {
        const data = await this.apiRoomService.getOne({ oid, roomId: id, query });
        return { data };
    }
    async createOne({ oid }, body) {
        const data = await this.apiRoomService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiRoomService.updateOne(oid, id, body);
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiRoomService.destroyOne(oid, id);
        return { data };
    }
    async mergeRoom({ oid, uid, organization }, body) {
        const data = await this.apiRoomService.mergeRoom({ oid, body, userId: uid });
        return { data };
    }
};
exports.ApiRoomController = ApiRoomController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.RoomPaginationQuery !== "undefined" && request_1.RoomPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiRoomController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.RoomGetManyQuery !== "undefined" && request_1.RoomGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiRoomController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.RoomGetOneQuery !== "undefined" && request_1.RoomGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiRoomController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_ROOM),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_1.RoomCreateBody !== "undefined" && request_1.RoomCreateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiRoomController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_ROOM),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object, typeof (_s = typeof request_1.RoomUpdateBody !== "undefined" && request_1.RoomUpdateBody) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], ApiRoomController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_ROOM),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], ApiRoomController.prototype, "destroyOne", null);
__decorate([
    (0, common_1.Post)('merge-room'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_ROOM),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof request_1.RoomMergeBody !== "undefined" && request_1.RoomMergeBody) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], ApiRoomController.prototype, "mergeRoom", null);
exports.ApiRoomController = ApiRoomController = __decorate([
    (0, swagger_1.ApiTags)('Room'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('room'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_room_service_1.ApiRoomService !== "undefined" && api_room_service_1.ApiRoomService) === "function" ? _a : Object])
], ApiRoomController);


/***/ }),
/* 586 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiRoomService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const error_1 = __webpack_require__(14);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
let ApiRoomService = class ApiRoomService {
    constructor(cacheDataService, roomRepository, userRepository, userRoomRepository, ticketRepository, roomOperation) {
        this.cacheDataService = cacheDataService;
        this.roomRepository = roomRepository;
        this.userRepository = userRepository;
        this.userRoomRepository = userRoomRepository;
        this.ticketRepository = ticketRepository;
        this.roomOperation = roomOperation;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.roomRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
            },
            sort,
        });
        if (relation) {
            await this.generateRelation(data, relation);
        }
        return { roomList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter, relation, sort } = query;
        const roomList = await this.roomRepository.findMany({
            relation,
            condition: { oid },
            limit,
            sort,
        });
        if (relation) {
            await this.generateRelation(roomList, relation);
        }
        return { roomList };
    }
    async getOne(options) {
        const { oid, roomId, query } = options;
        const room = await this.roomRepository.findOneBy({ oid, id: roomId });
        if (!room)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        if (query === null || query === void 0 ? void 0 : query.relation) {
            const dataRelation = await this.generateRelation([room], query.relation);
        }
        return { room };
    }
    async createOne(oid, body) {
        const { room: roomBody, userIdList } = body;
        let code = roomBody.code;
        if (!code) {
            const count = await this.roomRepository.getMaxId();
            code = (count + 1).toString();
        }
        const room = await this.roomRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, roomBody), { oid,
            code }));
        if (userIdList === null || userIdList === void 0 ? void 0 : userIdList.length) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const userRoomInsertList = userIdList.map((i) => {
                const insert = {
                    oid,
                    roomId: room.id,
                    userId: i,
                };
                return insert;
            });
            room.userRoomList =
                await this.userRoomRepository.insertManyAndReturnEntity(userRoomInsertList);
        }
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { room };
    }
    async updateOne(oid, roomId, body) {
        const { room: roomBody, userIdList } = body;
        if (roomBody.code != null) {
            const existProcedure = await this.roomRepository.findOneBy({
                oid,
                code: roomBody.code,
                id: { NOT: roomId },
            });
            if (existProcedure) {
                throw new error_1.BusinessError(`Trùng mã phòng với ${existProcedure.name}`);
            }
        }
        const room = await this.roomRepository.updateOneAndReturnEntity({ id: roomId, oid }, roomBody);
        if (userIdList) {
            const userList = await this.userRepository.findManyBy({
                oid,
                id: { IN: userIdList },
            });
            if (userList.length !== userIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            await this.userRoomRepository.delete({ oid, roomId });
            const userRoomInsertList = userIdList.map((i) => {
                const insert = {
                    oid,
                    roomId: room.id,
                    userId: i,
                };
                return insert;
            });
            room.userRoomList =
                await this.userRoomRepository.insertManyAndReturnEntity(userRoomInsertList);
        }
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { room };
    }
    async destroyOne(oid, roomId) {
        const ticketList = await this.ticketRepository.findMany({
            condition: { oid, roomId },
            limit: 10,
        });
        if (!ticketList.length) {
            await this.roomRepository.delete({ oid, id: roomId });
            await this.userRoomRepository.delete({ oid, roomId });
            this.cacheDataService.clearUserAndRoleAndRoom(oid);
        }
        return { ticketList, roomId, success: ticketList.length === 0 };
    }
    async mergeRoom(options) {
        const { oid, userId, body } = options;
        const { roomIdSourceList, roomIdTarget } = body;
        roomIdSourceList.forEach((i) => {
            if (isNaN(i) || i <= 0) {
                throw new exception_filter_1.BusinessException('error.ValidateFailed');
            }
        });
        await this.roomOperation.mergeRoom({ oid, userId, roomIdSourceList, roomIdTarget });
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return true;
    }
    async generateRelation(roomList, relation) {
        var _a;
        const roomIdList = helpers_1.ESArray.uniqueArray(roomList.map((i) => i.id));
        const [userRoomList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.userRoomList) && roomIdList.length
                ? this.userRoomRepository.findMany({
                    condition: { roomId: { IN: roomIdList } },
                    relation: { user: !!((_a = relation === null || relation === void 0 ? void 0 : relation.userRoomList) === null || _a === void 0 ? void 0 : _a.user) },
                    relationLoadStrategy: 'query',
                })
                : [],
        ]);
        roomList.forEach((room) => {
            if (relation.userRoomList) {
                room.userRoomList = userRoomList.filter((ur) => ur.roomId === room.id);
            }
        });
        return roomList;
    }
};
exports.ApiRoomService = ApiRoomService;
exports.ApiRoomService = ApiRoomService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.RoomRepository !== "undefined" && repositories_1.RoomRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.UserRoomRepository !== "undefined" && repositories_1.UserRoomRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _e : Object, typeof (_f = typeof operations_1.RoomOperation !== "undefined" && operations_1.RoomOperation) === "function" ? _f : Object])
], ApiRoomService);


/***/ }),
/* 587 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(588), exports);
__exportStar(__webpack_require__(590), exports);
__exportStar(__webpack_require__(589), exports);
__exportStar(__webpack_require__(591), exports);


/***/ }),
/* 588 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomGetOneQuery = exports.RoomGetManyQuery = exports.RoomPaginationQuery = exports.RoomGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const room_options_request_1 = __webpack_require__(589);
class RoomGetQuery {
}
exports.RoomGetQuery = RoomGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(room_options_request_1.RoomRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof room_options_request_1.RoomRelationQuery !== "undefined" && room_options_request_1.RoomRelationQuery) === "function" ? _a : Object)
], RoomGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(room_options_request_1.RoomFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof room_options_request_1.RoomFilterQuery !== "undefined" && room_options_request_1.RoomFilterQuery) === "function" ? _b : Object)
], RoomGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(room_options_request_1.RoomSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof room_options_request_1.RoomSortQuery !== "undefined" && room_options_request_1.RoomSortQuery) === "function" ? _c : Object)
], RoomGetQuery.prototype, "sort", void 0);
class RoomPaginationQuery extends (0, swagger_1.IntersectionType)(RoomGetQuery, query_1.PaginationQuery) {
}
exports.RoomPaginationQuery = RoomPaginationQuery;
class RoomGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(RoomGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.RoomGetManyQuery = RoomGetManyQuery;
class RoomGetOneQuery extends (0, swagger_1.PickType)(RoomGetQuery, ['relation']) {
}
exports.RoomGetOneQuery = RoomGetOneQuery;


/***/ }),
/* 589 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomSortQuery = exports.RoomFilterQuery = exports.RoomRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class RoomRelationQuery {
}
exports.RoomRelationQuery = RoomRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], RoomRelationQuery.prototype, "userRoomList", void 0);
class RoomFilterQuery {
}
exports.RoomFilterQuery = RoomFilterQuery;
class RoomSortQuery extends query_1.SortQuery {
}
exports.RoomSortQuery = RoomSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], RoomSortQuery.prototype, "code", void 0);


/***/ }),
/* 590 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomMergeBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class RoomMergeBody {
}
exports.RoomMergeBody = RoomMergeBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], RoomMergeBody.prototype, "roomIdSourceList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], RoomMergeBody.prototype, "roomIdTarget", void 0);


/***/ }),
/* 591 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RoomUpdateBody = exports.RoomCreateBody = exports.RoomUpdate = exports.RoomCreate = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const room_entity_1 = __webpack_require__(25);
class RoomCreate {
}
exports.RoomCreate = RoomCreate;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], RoomCreate.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], RoomCreate.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RoomCreate.prototype, "isCommon", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: room_entity_1.RoomType.Product }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(room_entity_1.RoomType),
    __metadata("design:type", typeof (_a = typeof room_entity_1.RoomType !== "undefined" && room_entity_1.RoomType) === "function" ? _a : Object)
], RoomCreate.prototype, "roomType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({}),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], RoomCreate.prototype, "roomStyle", void 0);
class RoomUpdate extends (0, swagger_1.OmitType)(RoomCreate, ['roomType']) {
}
exports.RoomUpdate = RoomUpdate;
class RoomCreateBody {
}
exports.RoomCreateBody = RoomCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: RoomCreate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RoomCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", RoomCreate)
], RoomCreateBody.prototype, "room", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RoomCreateBody.prototype, "userIdList", void 0);
class RoomUpdateBody {
}
exports.RoomUpdateBody = RoomUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: RoomUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => RoomUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", RoomUpdate)
], RoomUpdateBody.prototype, "room", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], RoomUpdateBody.prototype, "userIdList", void 0);


/***/ }),
/* 592 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingModule = void 0;
const common_1 = __webpack_require__(3);
const google_driver_module_1 = __webpack_require__(226);
const api_setting_google_driver_service_1 = __webpack_require__(593);
const api_setting_controller_1 = __webpack_require__(594);
const api_setting_service_1 = __webpack_require__(595);
let ApiSettingModule = class ApiSettingModule {
};
exports.ApiSettingModule = ApiSettingModule;
exports.ApiSettingModule = ApiSettingModule = __decorate([
    (0, common_1.Module)({
        imports: [google_driver_module_1.GoogleDriverModule],
        controllers: [api_setting_controller_1.ApiSettingController],
        providers: [api_setting_service_1.ApiSettingService, api_setting_google_driver_service_1.ApiSettingGoogleDriverService],
    })
], ApiSettingModule);


/***/ }),
/* 593 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingGoogleDriverService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const setting_entity_1 = __webpack_require__(41);
const setting_repository_1 = __webpack_require__(132);
const google_driver_service_1 = __webpack_require__(228);
const socket_emit_service_1 = __webpack_require__(340);
let ApiSettingGoogleDriverService = class ApiSettingGoogleDriverService {
    constructor(googleDriverService, cacheDataService, socketEmitService, settingRepository) {
        this.googleDriverService = googleDriverService;
        this.cacheDataService = cacheDataService;
        this.socketEmitService = socketEmitService;
        this.settingRepository = settingRepository;
    }
    async getAuthUrl(options) {
        const { url } = await this.googleDriverService.getAuthUrl({ state: options.state });
        return { data: { url } };
    }
    async logout(oid) {
        const setting = await this.settingRepository.findOneBy({
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
            oid,
        });
        if (!setting)
            return;
        const { email } = JSON.parse(setting.data);
        await this.googleDriverService.logout(email);
        await this.settingRepository.delete({ id: setting.id });
        await this.cacheDataService.reloadSettingMap(oid);
        return { data: true };
    }
    async loginCallback(query) {
        const { oid, email, refreshToken } = await this.googleDriverService.loginCallback(query);
        await this.settingRepository.upsertSetting({
            oid,
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
            data: JSON.stringify({ oid, email, refreshToken }),
        });
        await this.cacheDataService.reloadSettingMap(oid);
        this.socketEmitService.settingReload(oid);
    }
    async getAllAccounts() {
        const data = await this.settingRepository.findManyBy({
            key: setting_entity_1.SettingKey.GOOGLE_DRIVER,
        });
        return { data: data.map((i) => JSON.parse(i.data)) };
    }
    async getAllFolders(email) {
        const data = await this.googleDriverService.getAllFolders(email);
        return { data };
    }
};
exports.ApiSettingGoogleDriverService = ApiSettingGoogleDriverService;
exports.ApiSettingGoogleDriverService = ApiSettingGoogleDriverService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _c : Object, typeof (_d = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _d : Object])
], ApiSettingGoogleDriverService);


/***/ }),
/* 594 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const fastify_1 = __webpack_require__(444);
const root_guard_1 = __webpack_require__(15);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_setting_google_driver_service_1 = __webpack_require__(593);
const api_setting_service_1 = __webpack_require__(595);
const setting_upsert_request_1 = __webpack_require__(596);
let ApiSettingController = class ApiSettingController {
    constructor(apiSettingService, apiSettingGoogleDriverService) {
        this.apiSettingService = apiSettingService;
        this.apiSettingGoogleDriverService = apiSettingGoogleDriverService;
    }
    async getMap({ oid }) {
        return await this.apiSettingService.getMap(oid);
    }
    async upsert({ oid }, { type }, body) {
        await this.apiSettingService.upsert(oid, type, body);
        return { success: true };
    }
    async getAuthUrl({ oid }) {
        return this.apiSettingGoogleDriverService.getAuthUrl({ state: `${oid}` });
    }
    async authLogout({ oid }) {
        return this.apiSettingGoogleDriverService.logout(oid);
    }
    async authCallback(query, reply) {
        await this.apiSettingGoogleDriverService.loginCallback(query);
        return reply.type('text/html').send(`<script>window.close();</script>`);
    }
    async getAllFolders() {
        return await this.apiSettingGoogleDriverService.getAllFolders('');
    }
    async getAllAccounts() {
        return await this.apiSettingGoogleDriverService.getAllAccounts();
    }
};
exports.ApiSettingController = ApiSettingController;
__decorate([
    (0, common_1.Get)('get-map'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getMap", null);
__decorate([
    (0, common_1.Post)('upsert/:type'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof setting_upsert_request_1.SettingUpsertParams !== "undefined" && setting_upsert_request_1.SettingUpsertParams) === "function" ? _e : Object, typeof (_f = typeof setting_upsert_request_1.SettingUpsertBody !== "undefined" && setting_upsert_request_1.SettingUpsertBody) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "upsert", null);
__decorate([
    (0, common_1.Get)('google-driver/get-auth-url'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAuthUrl", null);
__decorate([
    (0, common_1.Post)('google-driver/logout'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.ORGANIZATION_SETTING_UPSERT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "authLogout", null);
__decorate([
    (0, common_1.Get)('google-driver/login-callback'),
    __param(0, (0, common_1.Query)()),
    __param(1, (0, common_1.Res)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_j = typeof fastify_1.FastifyReply !== "undefined" && fastify_1.FastifyReply) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "authCallback", null);
__decorate([
    (0, common_1.Get)('google-driver/get-all-folders'),
    (0, user_guard_1.UserPermission)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAllFolders", null);
__decorate([
    (0, common_1.Get)('google-driver/get-all-accounts'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], ApiSettingController.prototype, "getAllAccounts", null);
exports.ApiSettingController = ApiSettingController = __decorate([
    (0, swagger_1.ApiTags)('Setting'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('setting'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_setting_service_1.ApiSettingService !== "undefined" && api_setting_service_1.ApiSettingService) === "function" ? _a : Object, typeof (_b = typeof api_setting_google_driver_service_1.ApiSettingGoogleDriverService !== "undefined" && api_setting_google_driver_service_1.ApiSettingGoogleDriverService) === "function" ? _b : Object])
], ApiSettingController);


/***/ }),
/* 595 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSettingService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const setting_repository_1 = __webpack_require__(132);
const socket_emit_service_1 = __webpack_require__(340);
let ApiSettingService = class ApiSettingService {
    constructor(cacheDataService, socketEmitService, settingRepository) {
        this.cacheDataService = cacheDataService;
        this.socketEmitService = socketEmitService;
        this.settingRepository = settingRepository;
    }
    async getMap(oid) {
        const settingMap = await this.cacheDataService.getSettingMap(oid);
        return { data: { settingMap } };
    }
    async upsert(oid, key, body) {
        const data = await this.settingRepository.upsertSetting({
            oid,
            key,
            data: body.data,
        });
        await this.cacheDataService.reloadSettingMap(oid);
        this.socketEmitService.settingReload(oid);
        return { data };
    }
};
exports.ApiSettingService = ApiSettingService;
exports.ApiSettingService = ApiSettingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _b : Object, typeof (_c = typeof setting_repository_1.SettingRepository !== "undefined" && setting_repository_1.SettingRepository) === "function" ? _c : Object])
], ApiSettingService);


/***/ }),
/* 596 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SettingUpsertBody = exports.SettingUpsertParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const setting_entity_1 = __webpack_require__(41);
class SettingUpsertParams {
}
exports.SettingUpsertParams = SettingUpsertParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: setting_entity_1.SettingKey.GOOGLE_DRIVER }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", typeof (_a = typeof setting_entity_1.SettingKey !== "undefined" && setting_entity_1.SettingKey) === "function" ? _a : Object)
], SettingUpsertParams.prototype, "type", void 0);
class SettingUpsertBody {
}
exports.SettingUpsertBody = SettingUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], SettingUpsertBody.prototype, "data", void 0);


/***/ }),
/* 597 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckModule = void 0;
const common_1 = __webpack_require__(3);
const api_stock_check_controller_1 = __webpack_require__(598);
const api_stock_check_service_1 = __webpack_require__(599);
let ApiStockCheckModule = class ApiStockCheckModule {
};
exports.ApiStockCheckModule = ApiStockCheckModule;
exports.ApiStockCheckModule = ApiStockCheckModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_stock_check_controller_1.ApiStockCheckController],
        providers: [api_stock_check_service_1.ApiStockCheckService],
    })
], ApiStockCheckModule);


/***/ }),
/* 598 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_stock_check_service_1 = __webpack_require__(599);
const request_1 = __webpack_require__(600);
let ApiStockCheckController = class ApiStockCheckController {
    constructor(apiStockCheckService) {
        this.apiStockCheckService = apiStockCheckService;
    }
    async pagination({ oid }, query) {
        return await this.apiStockCheckService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiStockCheckService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiStockCheckService.getOne({ oid, id, query });
    }
    async upsertDraft({ oid, uid }, body) {
        return await this.apiStockCheckService.upsertDraft({
            oid,
            userId: uid,
            body,
        });
    }
    async draftDestroy({ oid }, { id }) {
        return await this.apiStockCheckService.destroy({
            oid,
            stockCheckId: id,
        });
    }
    async draftSubmit({ oid, uid }, { id }) {
        return await this.apiStockCheckService.draftSubmit({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async pendingApprove({ oid, uid }, { id }) {
        return await this.apiStockCheckService.pendingApprove({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async confirmReconcile({ oid, uid }, { id }) {
        return await this.apiStockCheckService.confirmReconcile({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async void({ oid, uid }, { id }) {
        return await this.apiStockCheckService.void({
            oid,
            stockCheckId: id,
            userId: uid,
        });
    }
    async cancelledDestroy({ oid }, { id }) {
        return await this.apiStockCheckService.destroy({
            oid,
            stockCheckId: id,
        });
    }
};
exports.ApiStockCheckController = ApiStockCheckController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.STOCK_CHECK),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StockCheckPaginationQuery !== "undefined" && request_1.StockCheckPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.STOCK_CHECK),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.StockCheckGetManyQuery !== "undefined" && request_1.StockCheckGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.STOCK_CHECK),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.StockCheckGetOneQuery !== "undefined" && request_1.StockCheckGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('upsert-draft'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.StockCheckUpsertDraftBody !== "undefined" && request_1.StockCheckUpsertDraftBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "upsertDraft", null);
__decorate([
    (0, common_1.Delete)('draft-destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Post)('draft-submit/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "draftSubmit", null);
__decorate([
    (0, common_1.Post)('pending-approve/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "pendingApprove", null);
__decorate([
    (0, common_1.Post)('confirm-reconcile/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "confirmReconcile", null);
__decorate([
    (0, common_1.Post)('void/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "void", null);
__decorate([
    (0, common_1.Delete)('cancelled-destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STOCK_CHECK_CANCELLED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _x : Object]),
    __metadata("design:returntype", Promise)
], ApiStockCheckController.prototype, "cancelledDestroy", null);
exports.ApiStockCheckController = ApiStockCheckController = __decorate([
    (0, swagger_1.ApiTags)('StockCheck'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('stock-check'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_stock_check_service_1.ApiStockCheckService !== "undefined" && api_stock_check_service_1.ApiStockCheckService) === "function" ? _a : Object])
], ApiStockCheckController);


/***/ }),
/* 599 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiStockCheckService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const stock_check_entity_1 = __webpack_require__(87);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
let ApiStockCheckService = class ApiStockCheckService {
    constructor(stockCheckRepository, stockCheckItemRepository, stockCheckReconcileOperation) {
        this.stockCheckRepository = stockCheckRepository;
        this.stockCheckItemRepository = stockCheckItemRepository;
        this.stockCheckReconcileOperation = stockCheckReconcileOperation;
    }
    async pagination(oid, query) {
        const { page, limit, relation } = query;
        const { createdByUserId, updatedByUserId, createdAt, status } = query.filter || {};
        const { total, data } = await this.stockCheckRepository.pagination({
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
            page: query.page,
            limit: query.limit,
            condition: {
                oid,
                status,
                createdAt,
                updatedByUserId,
                createdByUserId,
            },
            sort: query.sort || { id: 'DESC' },
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { relation, limit } = query;
        const { createdByUserId, updatedByUserId, createdAt, status } = query.filter || {};
        const stockCheckList = await this.stockCheckRepository.findMany({
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
            limit,
            condition: {
                oid,
                status,
                createdAt,
                updatedByUserId,
                createdByUserId,
            },
            sort: query.sort || { id: 'DESC' },
        });
        return { data: { stockCheckList } };
    }
    async getOne(options) {
        const { oid, id, query } = options;
        const { relation } = query;
        const stockCheck = await this.stockCheckRepository.findOne({
            condition: { oid, id },
            relation: {
                stockCheckItemList: relation === null || relation === void 0 ? void 0 : relation.stockCheckItemList,
                createdByUser: relation === null || relation === void 0 ? void 0 : relation.createdByUser,
                updatedByUser: relation === null || relation === void 0 ? void 0 : relation.updatedByUser,
            },
            relationLoadStrategy: 'query',
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        return { data: { stockCheck } };
    }
    async upsertDraft(params) {
        const { oid, body, userId } = params;
        const { stockCheckBody, stockCheckId, stockCheckItemBodyList } = body;
        const duplicateBatchId = array_helper_1.ESArray.checkDuplicate(stockCheckItemBodyList, 'batchId');
        if (duplicateBatchId.length) {
            throw new exception_filter_1.BusinessException(`Tạo phiếu không thành công, xuất hiện 2 sản phẩm trùng nhau`);
        }
        let stockCheck;
        if (!stockCheckId) {
            stockCheck = await this.stockCheckRepository.insertOneFullFieldAndReturnEntity({
                oid,
                createdAt: stockCheckBody.createdAt,
                createdByUserId: stockCheckBody.createdByUserId,
                note: stockCheckBody.note,
                status: stock_check_entity_1.StockCheckStatus.Draft,
                updatedAt: Date.now(),
                updatedByUserId: 0,
            });
        }
        else {
            stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Draft }, {
                createdAt: stockCheckBody.createdAt,
                createdByUserId: stockCheckBody.createdByUserId,
                note: stockCheckBody.note,
            });
            await this.stockCheckItemRepository.delete({ oid, stockCheckId });
        }
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        const stockCheckItemInsertList = stockCheckItemBodyList.map((i) => {
            const insertDto = {
                oid,
                stockCheckId: stockCheck.id,
                productId: i.productId,
                batchId: i.batchId,
                systemQuantity: i.systemQuantity,
                actualQuantity: i.actualQuantity,
                systemCostAmount: i.systemCostAmount,
                actualCostAmount: i.actualCostAmount,
                note: i.note,
            };
            return insertDto;
        });
        await this.stockCheckItemRepository.insertManyFullField(stockCheckItemInsertList);
        return { data: { stockCheck } };
    }
    async draftSubmit(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Draft }, {
            status: stock_check_entity_1.StockCheckStatus.Pending,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async pendingApprove(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({ oid, id: stockCheckId, status: stock_check_entity_1.StockCheckStatus.Pending }, {
            status: stock_check_entity_1.StockCheckStatus.Confirmed,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async confirmReconcile(params) {
        const { oid, stockCheckId, userId } = params;
        const { stockCheck } = await this.stockCheckReconcileOperation.startReconcile({
            oid,
            stockCheckId,
            userId,
            time: Date.now(),
        });
        return { data: { stockCheck } };
    }
    async void(params) {
        const { oid, stockCheckId, userId } = params;
        const stockCheck = await this.stockCheckRepository.updateOneAndReturnEntity({
            oid,
            id: stockCheckId,
            status: { IN: [stock_check_entity_1.StockCheckStatus.Pending, stock_check_entity_1.StockCheckStatus.Confirmed] },
        }, {
            status: stock_check_entity_1.StockCheckStatus.Cancelled,
            updatedByUserId: userId,
        });
        if (!stockCheck) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        return { data: { stockCheck } };
    }
    async destroy(params) {
        const { oid, stockCheckId } = params;
        const stockCheckOrigin = await this.stockCheckRepository.findOneBy({ oid, id: stockCheckId });
        if (![stock_check_entity_1.StockCheckStatus.Draft, stock_check_entity_1.StockCheckStatus.Cancelled].includes(stockCheckOrigin.status)) {
            throw new exception_filter_1.BusinessException('error.Conflict');
        }
        await this.stockCheckItemRepository.delete({ oid, stockCheckId });
        await this.stockCheckRepository.delete({ oid, id: stockCheckId });
        return { data: { stockCheckId } };
    }
};
exports.ApiStockCheckService = ApiStockCheckService;
exports.ApiStockCheckService = ApiStockCheckService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.StockCheckRepository !== "undefined" && repositories_1.StockCheckRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.StockCheckItemRepository !== "undefined" && repositories_1.StockCheckItemRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.StockCheckReconcileOperation !== "undefined" && operations_1.StockCheckReconcileOperation) === "function" ? _c : Object])
], ApiStockCheckService);


/***/ }),
/* 600 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(601), exports);
__exportStar(__webpack_require__(602), exports);
__exportStar(__webpack_require__(603), exports);


/***/ }),
/* 601 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckGetOneQuery = exports.StockCheckGetManyQuery = exports.StockCheckPaginationQuery = exports.StockCheckGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const stock_check_options_request_1 = __webpack_require__(602);
class StockCheckGetQuery {
}
exports.StockCheckGetQuery = StockCheckGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            createdByUser: true,
            stockCheckItemList: { product: true, batch: true },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof stock_check_options_request_1.StockCheckRelationQuery !== "undefined" && stock_check_options_request_1.StockCheckRelationQuery) === "function" ? _a : Object)
], StockCheckGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ createdByUserId: 33 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof stock_check_options_request_1.StockCheckFilterQuery !== "undefined" && stock_check_options_request_1.StockCheckFilterQuery) === "function" ? _b : Object)
], StockCheckGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(stock_check_options_request_1.StockCheckSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof stock_check_options_request_1.StockCheckSortQuery !== "undefined" && stock_check_options_request_1.StockCheckSortQuery) === "function" ? _c : Object)
], StockCheckGetQuery.prototype, "sort", void 0);
class StockCheckPaginationQuery extends (0, swagger_1.IntersectionType)(StockCheckGetQuery, query_1.PaginationQuery) {
}
exports.StockCheckPaginationQuery = StockCheckPaginationQuery;
class StockCheckGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(StockCheckGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.StockCheckGetManyQuery = StockCheckGetManyQuery;
class StockCheckGetOneQuery extends (0, swagger_1.PickType)(StockCheckGetQuery, ['relation']) {
}
exports.StockCheckGetOneQuery = StockCheckGetOneQuery;


/***/ }),
/* 602 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckSortQuery = exports.StockCheckFilterQuery = exports.StockCheckRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const stock_check_entity_1 = __webpack_require__(87);
class StockCheckRelationQuery {
}
exports.StockCheckRelationQuery = StockCheckRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], StockCheckRelationQuery.prototype, "stockCheckItemList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "updatedByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "createdByUser", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Boolean)
], StockCheckRelationQuery.prototype, "reconciledByUser", void 0);
const ConditionEnumStockCheckStatus = (0, dto_1.createConditionEnum)(stock_check_entity_1.StockCheckStatus);
class StockCheckFilterQuery {
}
exports.StockCheckFilterQuery = StockCheckFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckFilterQuery.prototype, "createdByUserId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckFilterQuery.prototype, "updatedByUserId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, stock_check_entity_1.StockCheckStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], StockCheckFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _c : Object)
], StockCheckFilterQuery.prototype, "createdAt", void 0);
class StockCheckSortQuery extends query_1.SortQuery {
}
exports.StockCheckSortQuery = StockCheckSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StockCheckSortQuery.prototype, "createdAt", void 0);


/***/ }),
/* 603 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StockCheckUpsertDraftBody = exports.StockCheckBody = exports.StockCheckItemBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class StockCheckItemBody {
}
exports.StockCheckItemBody = StockCheckItemBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "systemQuantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "actualQuantity", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "systemCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckItemBody.prototype, "actualCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], StockCheckItemBody.prototype, "note", void 0);
class StockCheckBody {
}
exports.StockCheckBody = StockCheckBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], StockCheckBody.prototype, "createdByUserId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], StockCheckBody.prototype, "note", void 0);
class StockCheckUpsertDraftBody {
}
exports.StockCheckUpsertDraftBody = StockCheckUpsertDraftBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StockCheckUpsertDraftBody.prototype, "stockCheckId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: StockCheckItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => StockCheckItemBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], StockCheckUpsertDraftBody.prototype, "stockCheckItemBodyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: StockCheckBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => StockCheckBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StockCheckBody)
], StockCheckUpsertDraftBody.prototype, "stockCheckBody", void 0);


/***/ }),
/* 604 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSurchargeModule = void 0;
const common_1 = __webpack_require__(3);
const api_surcharge_controller_1 = __webpack_require__(605);
const api_surcharge_service_1 = __webpack_require__(606);
let ApiSurchargeModule = class ApiSurchargeModule {
};
exports.ApiSurchargeModule = ApiSurchargeModule;
exports.ApiSurchargeModule = ApiSurchargeModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_surcharge_controller_1.ApiSurchargeController],
        providers: [api_surcharge_service_1.ApiSurchargeService],
    })
], ApiSurchargeModule);


/***/ }),
/* 605 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSurchargeController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_surcharge_service_1 = __webpack_require__(606);
const request_1 = __webpack_require__(607);
let ApiSurchargeController = class ApiSurchargeController {
    constructor(apiSurchargeService) {
        this.apiSurchargeService = apiSurchargeService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiSurchargeService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiSurchargeService.getMany(oid, query);
        return { data };
    }
    async findOne({ oid }, { id }) {
        const data = await this.apiSurchargeService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        const data = await this.apiSurchargeService.createOne(oid, body);
        return { data };
    }
    async updateOne({ oid }, { id }, body) {
        const data = await this.apiSurchargeService.updateOne({ oid, surchargeId: id, body });
        return { data };
    }
    async destroyOne({ oid }, { id }) {
        const data = await this.apiSurchargeService.destroyOne({ oid, surchargeId: id });
        return { data };
    }
};
exports.ApiSurchargeController = ApiSurchargeController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.SurchargePaginationQuery !== "undefined" && request_1.SurchargePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiSurchargeController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.SurchargeGetManyQuery !== "undefined" && request_1.SurchargeGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiSurchargeController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiSurchargeController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.SurchargeCreateBody !== "undefined" && request_1.SurchargeCreateBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiSurchargeController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object, typeof (_q = typeof request_1.SurchargeUpdateBody !== "undefined" && request_1.SurchargeUpdateBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], ApiSurchargeController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_SURCHARGE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], ApiSurchargeController.prototype, "destroyOne", null);
exports.ApiSurchargeController = ApiSurchargeController = __decorate([
    (0, swagger_1.ApiTags)('Surcharge'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('surcharge'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_surcharge_service_1.ApiSurchargeService !== "undefined" && api_surcharge_service_1.ApiSurchargeService) === "function" ? _a : Object])
], ApiSurchargeController);


/***/ }),
/* 606 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiSurchargeService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const error_1 = __webpack_require__(14);
const surcharge_repository_1 = __webpack_require__(135);
let ApiSurchargeService = class ApiSurchargeService {
    constructor(surchargeRepository) {
        this.surchargeRepository = surchargeRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.surchargeRepository.pagination({
            page,
            limit,
            relation,
            condition: { oid },
            sort,
        });
        return { surchargeList: data, total, page, limit };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.surchargeRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { surchargeList: data };
    }
    async getOne(oid, id) {
        const surcharge = await this.surchargeRepository.findOneBy({ oid, id });
        if (!surcharge)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { surcharge };
    }
    async createOne(oid, body) {
        let code = body.code;
        if (!code) {
            const count = await this.surchargeRepository.getMaxId();
            code = (count + 1).toString();
        }
        const existSurcharge = await this.surchargeRepository.findOneBy({ oid, code });
        if (existSurcharge) {
            throw new error_1.BusinessError(`Trùng mã phụ phí với ${existSurcharge.name}`);
        }
        const surcharge = await this.surchargeRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({ oid }, body), { code }));
        return { surcharge };
    }
    async updateOne(options) {
        const { oid, surchargeId, body } = options;
        if (body.code != null) {
            const existSurcharge = await this.surchargeRepository.findOneBy({
                oid,
                code: body.code,
                id: { NOT: surchargeId },
            });
            if (existSurcharge) {
                throw new error_1.BusinessError(`Trùng mã phụ phí với ${existSurcharge.name}`);
            }
        }
        const surcharge = await this.surchargeRepository.updateOneAndReturnEntity({ id: surchargeId, oid }, body);
        return { surcharge };
    }
    async destroyOne(options) {
        const { oid, surchargeId } = options;
        await this.surchargeRepository.delete({ oid, id: surchargeId });
        return { surchargeId };
    }
};
exports.ApiSurchargeService = ApiSurchargeService;
exports.ApiSurchargeService = ApiSurchargeService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof surcharge_repository_1.SurchargeRepository !== "undefined" && surcharge_repository_1.SurchargeRepository) === "function" ? _a : Object])
], ApiSurchargeService);


/***/ }),
/* 607 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(608), exports);
__exportStar(__webpack_require__(609), exports);
__exportStar(__webpack_require__(610), exports);


/***/ }),
/* 608 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SurchargeGetOneQuery = exports.SurchargeGetManyQuery = exports.SurchargePaginationQuery = exports.SurchargeGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const surcharge_options_request_1 = __webpack_require__(609);
class SurchargeGetQuery {
}
exports.SurchargeGetQuery = SurchargeGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(surcharge_options_request_1.SurchargeRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof surcharge_options_request_1.SurchargeRelationQuery !== "undefined" && surcharge_options_request_1.SurchargeRelationQuery) === "function" ? _a : Object)
], SurchargeGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ printHtmlId: 0 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(surcharge_options_request_1.SurchargeFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof surcharge_options_request_1.SurchargeFilterQuery !== "undefined" && surcharge_options_request_1.SurchargeFilterQuery) === "function" ? _b : Object)
], SurchargeGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(surcharge_options_request_1.SurchargeSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof surcharge_options_request_1.SurchargeSortQuery !== "undefined" && surcharge_options_request_1.SurchargeSortQuery) === "function" ? _c : Object)
], SurchargeGetQuery.prototype, "sort", void 0);
class SurchargePaginationQuery extends (0, swagger_1.IntersectionType)(SurchargeGetQuery, query_1.PaginationQuery) {
}
exports.SurchargePaginationQuery = SurchargePaginationQuery;
class SurchargeGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(SurchargeGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.SurchargeGetManyQuery = SurchargeGetManyQuery;
class SurchargeGetOneQuery extends (0, swagger_1.PickType)(SurchargeGetQuery, ['relation']) {
}
exports.SurchargeGetOneQuery = SurchargeGetOneQuery;


/***/ }),
/* 609 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SurchargeSortQuery = exports.SurchargeFilterQuery = exports.SurchargeRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class SurchargeRelationQuery {
}
exports.SurchargeRelationQuery = SurchargeRelationQuery;
class SurchargeFilterQuery {
}
exports.SurchargeFilterQuery = SurchargeFilterQuery;
class SurchargeSortQuery extends query_1.SortQuery {
}
exports.SurchargeSortQuery = SurchargeSortQuery;


/***/ }),
/* 610 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SurchargeUpdateBody = exports.SurchargeCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class SurchargeCreateBody {
}
exports.SurchargeCreateBody = SurchargeCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 105000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], SurchargeCreateBody.prototype, "code", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Tiền mặt' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], SurchargeCreateBody.prototype, "name", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], SurchargeCreateBody.prototype, "isActive", void 0);
class SurchargeUpdateBody extends SurchargeCreateBody {
}
exports.SurchargeUpdateBody = SurchargeUpdateBody;


/***/ }),
/* 611 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_batch_controller_1 = __webpack_require__(612);
const api_ticket_batch_service_1 = __webpack_require__(613);
let ApiTicketBatchModule = class ApiTicketBatchModule {
};
exports.ApiTicketBatchModule = ApiTicketBatchModule;
exports.ApiTicketBatchModule = ApiTicketBatchModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_batch_controller_1.ApiTicketBatchController],
        providers: [api_ticket_batch_service_1.ApiTicketBatchService],
    })
], ApiTicketBatchModule);


/***/ }),
/* 612 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_batch_service_1 = __webpack_require__(613);
const request_1 = __webpack_require__(614);
let ApiTicketBatchController = class ApiTicketBatchController {
    constructor(apiTicketBatchService) {
        this.apiTicketBatchService = apiTicketBatchService;
    }
    async pagination({ oid }, query) {
        return await this.apiTicketBatchService.pagination(oid, query);
    }
    async list({ oid }, query) {
        return await this.apiTicketBatchService.getList(oid, query);
    }
};
exports.ApiTicketBatchController = ApiTicketBatchController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketBatchPaginationQuery !== "undefined" && request_1.TicketBatchPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketBatchController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.TicketBatchGetManyQuery !== "undefined" && request_1.TicketBatchGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], ApiTicketBatchController.prototype, "list", null);
exports.ApiTicketBatchController = ApiTicketBatchController = __decorate([
    (0, swagger_1.ApiTags)('TicketBatch'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-batch'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_batch_service_1.ApiTicketBatchService !== "undefined" && api_ticket_batch_service_1.ApiTicketBatchService) === "function" ? _a : Object])
], ApiTicketBatchController);


/***/ }),
/* 613 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketBatchService = void 0;
const common_1 = __webpack_require__(3);
const ticket_batch_repository_1 = __webpack_require__(137);
let ApiTicketBatchService = class ApiTicketBatchService {
    constructor(ticketBatchRepository) {
        this.ticketBatchRepository = ticketBatchRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data } = await this.ticketBatchRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
            },
            sort,
        });
        return {
            data,
            meta: { page, limit, total },
        };
    }
    async getList(oid, query) {
        const { filter, limit, relation, sort } = query;
        const ticketBatchList = await this.ticketBatchRepository.findMany({
            relation,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
            },
            relationLoadStrategy: 'query',
            sort,
        });
        return { data: { ticketBatchList } };
    }
};
exports.ApiTicketBatchService = ApiTicketBatchService;
exports.ApiTicketBatchService = ApiTicketBatchService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_batch_repository_1.TicketBatchRepository !== "undefined" && ticket_batch_repository_1.TicketBatchRepository) === "function" ? _a : Object])
], ApiTicketBatchService);


/***/ }),
/* 614 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(615), exports);
__exportStar(__webpack_require__(616), exports);


/***/ }),
/* 615 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchGetOneQuery = exports.TicketBatchGetManyQuery = exports.TicketBatchPaginationQuery = exports.TicketBatchGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const ticket_batch_options_request_1 = __webpack_require__(616);
class TicketBatchGetQuery {
}
exports.TicketBatchGetQuery = TicketBatchGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof ticket_batch_options_request_1.TicketBatchRelationQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchRelationQuery) === "function" ? _a : Object)
], TicketBatchGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            customerId: 1,
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof ticket_batch_options_request_1.TicketBatchFilterQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchFilterQuery) === "function" ? _b : Object)
], TicketBatchGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            id: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(ticket_batch_options_request_1.TicketBatchSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof ticket_batch_options_request_1.TicketBatchSortQuery !== "undefined" && ticket_batch_options_request_1.TicketBatchSortQuery) === "function" ? _c : Object)
], TicketBatchGetQuery.prototype, "sort", void 0);
class TicketBatchPaginationQuery extends (0, swagger_1.IntersectionType)(TicketBatchGetQuery, query_1.PaginationQuery) {
}
exports.TicketBatchPaginationQuery = TicketBatchPaginationQuery;
class TicketBatchGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(TicketBatchGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.TicketBatchGetManyQuery = TicketBatchGetManyQuery;
class TicketBatchGetOneQuery extends (0, swagger_1.PickType)(TicketBatchGetQuery, ['relation']) {
}
exports.TicketBatchGetOneQuery = TicketBatchGetOneQuery;


/***/ }),
/* 616 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketBatchSortQuery = exports.TicketBatchFilterQuery = exports.TicketBatchRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const variable_1 = __webpack_require__(21);
class TicketBatchRelationQuery {
}
exports.TicketBatchRelationQuery = TicketBatchRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "product", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "batch", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "ticket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], TicketBatchRelationQuery.prototype, "customer", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(variable_1.DeliveryStatus);
class TicketBatchFilterQuery {
}
exports.TicketBatchFilterQuery = TicketBatchFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketBatchFilterQuery.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, variable_1.DeliveryStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], TicketBatchFilterQuery.prototype, "deliveryStatus", void 0);
class TicketBatchSortQuery extends query_1.SortQuery {
}
exports.TicketBatchSortQuery = TicketBatchSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], TicketBatchSortQuery.prototype, "ticketProductId", void 0);


/***/ }),
/* 617 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryGroupModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_laboratory_group_controller_1 = __webpack_require__(618);
const api_ticket_laboratory_group_service_1 = __webpack_require__(619);
let ApiTicketLaboratoryGroupModule = class ApiTicketLaboratoryGroupModule {
};
exports.ApiTicketLaboratoryGroupModule = ApiTicketLaboratoryGroupModule;
exports.ApiTicketLaboratoryGroupModule = ApiTicketLaboratoryGroupModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_laboratory_group_controller_1.ApiTicketLaboratoryGroupController],
        providers: [api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService],
        exports: [api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService],
    })
], ApiTicketLaboratoryGroupModule);


/***/ }),
/* 618 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryGroupController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_laboratory_group_service_1 = __webpack_require__(619);
const request_1 = __webpack_require__(315);
let ApiTicketLaboratoryGroupController = class ApiTicketLaboratoryGroupController {
    constructor(apiTicketLaboratoryGroupService) {
        this.apiTicketLaboratoryGroupService = apiTicketLaboratoryGroupService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiTicketLaboratoryGroupService.pagination(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiTicketLaboratoryGroupService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiTicketLaboratoryGroupController = ApiTicketLaboratoryGroupController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketLaboratoryGroupPaginationQuery !== "undefined" && request_1.TicketLaboratoryGroupPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketLaboratoryGroupController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketLaboratoryGroupGetOneQuery !== "undefined" && request_1.TicketLaboratoryGroupGetOneQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketLaboratoryGroupController.prototype, "detail", null);
exports.ApiTicketLaboratoryGroupController = ApiTicketLaboratoryGroupController = __decorate([
    (0, swagger_1.ApiTags)('TicketLaboratoryGroup'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-laboratory-group'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService !== "undefined" && api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService) === "function" ? _a : Object])
], ApiTicketLaboratoryGroupController);


/***/ }),
/* 619 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryGroupService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
let ApiTicketLaboratoryGroupService = class ApiTicketLaboratoryGroupService {
    constructor(ticketLaboratoryGroupRepository, ticketLaboratoryRepository, ticketLaboratoryResultRepository, customerRepository, ticketUserRepository, ticketRepository) {
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
        this.customerRepository = customerRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.ticketRepository = ticketRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data: ticketLaboratoryGroupList } = await this.ticketLaboratoryGroupRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                paymentMoneyStatus: filter === null || filter === void 0 ? void 0 : filter.paymentMoneyStatus,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                roomId: filter === null || filter === void 0 ? void 0 : filter.roomId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                completedAt: filter === null || filter === void 0 ? void 0 : filter.completedAt,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation(ticketLaboratoryGroupList, query.relation);
        }
        return { ticketLaboratoryGroupList, page, limit, total };
    }
    async getOne(oid, id, query) {
        const { relation } = query;
        const ticketLaboratoryGroup = await this.ticketLaboratoryGroupRepository.findOne({
            condition: { oid, id },
        });
        if (!ticketLaboratoryGroup) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (query.relation) {
            await this.generateRelation([ticketLaboratoryGroup], query.relation);
        }
        return { ticketLaboratoryGroup };
    }
    async generateRelation(ticketLaboratoryGroupList, relation) {
        const tlgIdList = helpers_1.ESArray.uniqueArray(ticketLaboratoryGroupList.map((i) => i.id));
        const customerIdList = helpers_1.ESArray.uniqueArray(ticketLaboratoryGroupList.map((i) => i.customerId));
        const ticketIdList = helpers_1.ESArray.uniqueArray(ticketLaboratoryGroupList.map((i) => i.ticketId));
        const [ticketList, customerList, ticketUserList, ticketLaboratoryList, ticketLaboratoryResultList,] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIdList.length
                ? this.ticketRepository.findManyBy({ id: { IN: ticketIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIdList.length
                ? this.customerRepository.findManyBy({ id: { IN: customerIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketUserList) && ticketIdList.length && tlgIdList.length
                ? this.ticketUserRepository.findMany({
                    condition: {
                        ticketId: { IN: ticketIdList },
                        positionType: position_entity_1.PositionInteractType.LaboratoryGroup,
                        ticketItemId: { IN: tlgIdList },
                    },
                    sort: { id: 'ASC' },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) && ticketIdList.length && tlgIdList.length
                ? this.ticketLaboratoryRepository.findMany({
                    condition: {
                        ticketId: { IN: ticketIdList },
                        ticketLaboratoryGroupId: { IN: tlgIdList },
                    },
                    sort: { id: 'ASC' },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryResultMap) && ticketIdList.length && tlgIdList.length
                ? this.ticketLaboratoryResultRepository.findManyBy({
                    ticketId: { IN: ticketIdList },
                    ticketLaboratoryGroupId: { IN: tlgIdList },
                })
                : [],
        ]);
        ticketLaboratoryGroupList.forEach((tlg) => {
            tlg.ticket = ticketList.find((t) => t.id === tlg.ticketId);
            tlg.customer = customerList.find((c) => c.id === tlg.customerId);
            if (relation.ticketUserList) {
                tlg.ticketUserList = ticketUserList.filter((tu) => tu.ticketItemId === tlg.id);
            }
            if (relation.ticketLaboratoryList) {
                tlg.ticketLaboratoryList = ticketLaboratoryList.filter((tl) => {
                    return tl.ticketLaboratoryGroupId === tlg.id;
                });
            }
            if (relation.ticketLaboratoryResultMap) {
                tlg.ticketLaboratoryResultMap = helpers_1.ESArray.arrayToKeyValue(ticketLaboratoryResultList, 'laboratoryId');
            }
        });
        return ticketLaboratoryGroupList;
    }
};
exports.ApiTicketLaboratoryGroupService = ApiTicketLaboratoryGroupService;
exports.ApiTicketLaboratoryGroupService = ApiTicketLaboratoryGroupService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.TicketLaboratoryGroupRepository !== "undefined" && repositories_1.TicketLaboratoryGroupRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryResultRepository !== "undefined" && repositories_1.TicketLaboratoryResultRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _f : Object])
], ApiTicketLaboratoryGroupService);


/***/ }),
/* 620 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_laboratory_controller_1 = __webpack_require__(621);
const api_ticket_laboratory_service_1 = __webpack_require__(622);
let ApiTicketLaboratoryModule = class ApiTicketLaboratoryModule {
};
exports.ApiTicketLaboratoryModule = ApiTicketLaboratoryModule;
exports.ApiTicketLaboratoryModule = ApiTicketLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_laboratory_controller_1.ApiTicketLaboratoryController],
        providers: [api_ticket_laboratory_service_1.ApiTicketLaboratoryService],
    })
], ApiTicketLaboratoryModule);


/***/ }),
/* 621 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_laboratory_service_1 = __webpack_require__(622);
const request_1 = __webpack_require__(318);
let ApiTicketLaboratoryController = class ApiTicketLaboratoryController {
    constructor(apiTicketLaboratoryService) {
        this.apiTicketLaboratoryService = apiTicketLaboratoryService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiTicketLaboratoryService.pagination(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiTicketLaboratoryService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiTicketLaboratoryController = ApiTicketLaboratoryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketLaboratoryPaginationQuery !== "undefined" && request_1.TicketLaboratoryPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketLaboratoryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketLaboratoryGetOneQuery !== "undefined" && request_1.TicketLaboratoryGetOneQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketLaboratoryController.prototype, "detail", null);
exports.ApiTicketLaboratoryController = ApiTicketLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('TicketLaboratory'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_laboratory_service_1.ApiTicketLaboratoryService !== "undefined" && api_ticket_laboratory_service_1.ApiTicketLaboratoryService) === "function" ? _a : Object])
], ApiTicketLaboratoryController);


/***/ }),
/* 622 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const repositories_1 = __webpack_require__(42);
const laboratory_repository_1 = __webpack_require__(110);
const ticket_laboratory_repository_1 = __webpack_require__(141);
const user_repository_1 = __webpack_require__(152);
const socket_emit_service_1 = __webpack_require__(340);
let ApiTicketLaboratoryService = class ApiTicketLaboratoryService {
    constructor(socketEmitService, ticketLaboratoryRepository, laboratoryRepository, userRepository, ticketRepository) {
        this.socketEmitService = socketEmitService;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.laboratoryRepository = laboratoryRepository;
        this.userRepository = userRepository;
        this.ticketRepository = ticketRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data: ticketLaboratoryList } = await this.ticketLaboratoryRepository.pagination({
            relation: {
                customer: relation === null || relation === void 0 ? void 0 : relation.customer,
                ticket: relation === null || relation === void 0 ? void 0 : relation.ticket,
                laboratoryList: relation === null || relation === void 0 ? void 0 : relation.laboratoryList,
            },
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                laboratoryId: filter === null || filter === void 0 ? void 0 : filter.laboratoryId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            sort,
        });
        return { ticketLaboratoryList, page, limit, total };
    }
    async getOne(oid, id, query) {
        const { relation } = query;
        const ticketLaboratory = await this.ticketLaboratoryRepository.findOne({
            relation: {
                customer: relation === null || relation === void 0 ? void 0 : relation.customer,
                ticket: relation === null || relation === void 0 ? void 0 : relation.ticket,
                laboratoryList: relation === null || relation === void 0 ? void 0 : relation.laboratoryList,
            },
            condition: { oid, id },
        });
        if (!ticketLaboratory) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        return { ticketLaboratory };
    }
};
exports.ApiTicketLaboratoryService = ApiTicketLaboratoryService;
exports.ApiTicketLaboratoryService = ApiTicketLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof ticket_laboratory_repository_1.TicketLaboratoryRepository !== "undefined" && ticket_laboratory_repository_1.TicketLaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof laboratory_repository_1.LaboratoryRepository !== "undefined" && laboratory_repository_1.LaboratoryRepository) === "function" ? _c : Object, typeof (_d = typeof user_repository_1.UserRepository !== "undefined" && user_repository_1.UserRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _e : Object])
], ApiTicketLaboratoryService);


/***/ }),
/* 623 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_procedure_controller_1 = __webpack_require__(624);
const api_ticket_procedure_service_1 = __webpack_require__(625);
let ApiTicketProcedureModule = class ApiTicketProcedureModule {
};
exports.ApiTicketProcedureModule = ApiTicketProcedureModule;
exports.ApiTicketProcedureModule = ApiTicketProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_procedure_controller_1.ApiTicketProcedureController],
        providers: [api_ticket_procedure_service_1.ApiTicketProcedureService],
    })
], ApiTicketProcedureModule);


/***/ }),
/* 624 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_procedure_service_1 = __webpack_require__(625);
const request_1 = __webpack_require__(321);
let ApiTicketProcedureController = class ApiTicketProcedureController {
    constructor(apiTicketProcedureService) {
        this.apiTicketProcedureService = apiTicketProcedureService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiTicketProcedureService.pagination(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiTicketProcedureService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiTicketProcedureController = ApiTicketProcedureController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketProcedurePaginationQuery !== "undefined" && request_1.TicketProcedurePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketProcedureController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketProcedureGetOneQuery !== "undefined" && request_1.TicketProcedureGetOneQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketProcedureController.prototype, "detail", null);
exports.ApiTicketProcedureController = ApiTicketProcedureController = __decorate([
    (0, swagger_1.ApiTags)('TicketProcedure'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_procedure_service_1.ApiTicketProcedureService !== "undefined" && api_ticket_procedure_service_1.ApiTicketProcedureService) === "function" ? _a : Object])
], ApiTicketProcedureController);


/***/ }),
/* 625 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProcedureService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const image_repository_1 = __webpack_require__(107);
const ticket_procedure_repository_1 = __webpack_require__(143);
const ticket_user_repository_1 = __webpack_require__(147);
let ApiTicketProcedureService = class ApiTicketProcedureService {
    constructor(ticketProcedureRepository, ticketProcedureItemRepository, ticketRepository, customerRepository, procedureRepository, ticketUserRepository, imageRepository) {
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketProcedureItemRepository = ticketProcedureItemRepository;
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
        this.procedureRepository = procedureRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.imageRepository = imageRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data: ticketProcedureList } = await this.ticketProcedureRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                paymentMoneyStatus: filter === null || filter === void 0 ? void 0 : filter.paymentMoneyStatus,
                procedureId: filter === null || filter === void 0 ? void 0 : filter.procedureId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, ticketProcedureList, relation });
        }
        return { ticketProcedureList, page, limit, total };
    }
    async getList(oid, query) {
        const { limit, filter, relation, sort } = query;
        const ticketProcedureList = await this.ticketProcedureRepository.findMany({
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                paymentMoneyStatus: filter === null || filter === void 0 ? void 0 : filter.paymentMoneyStatus,
                procedureId: filter === null || filter === void 0 ? void 0 : filter.procedureId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
            },
            limit,
            sort,
        });
        if (query.relation) {
            await this.generateRelation({ oid, ticketProcedureList, relation });
        }
        return { ticketProcedureList };
    }
    async getOne(oid, id, query) {
        const ticketProcedure = await this.ticketProcedureRepository.findOne({
            condition: { oid, id },
        });
        if (!ticketProcedure) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (query.relation) {
            await this.generateRelation({
                oid,
                ticketProcedureList: [ticketProcedure],
                relation: query.relation,
            });
        }
        return { ticketProcedure };
    }
    async generateRelation(object) {
        var _a;
        const { oid, ticketProcedureList, relation } = object;
        const ticketProcedureIdList = ticketProcedureList.map((i) => i.id);
        const ticketIdList = ticketProcedureList.map((i) => i.ticketId);
        const customerIdList = ticketProcedureList.map((i) => i.customerId);
        const procedureIdList = ticketProcedureList.map((i) => i.procedureId);
        const [ticketList, customerList, procedureList, ticketProcedureItemList, ticketUserList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIdList.length
                ? this.ticketRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(ticketIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIdList.length
                ? this.customerRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(customerIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.procedure) && procedureIdList.length
                ? this.procedureRepository.findManyBy({
                    id: { IN: array_helper_1.ESArray.uniqueArray(procedureIdList) },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketProcedureItemList) && ticketProcedureIdList.length
                ? this.ticketProcedureItemRepository.findMany({
                    condition: {
                        oid,
                        ticketProcedureId: { IN: array_helper_1.ESArray.uniqueArray(ticketProcedureIdList) },
                    },
                    sort: { id: 'ASC' },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketUserList) && ticketProcedureIdList.length
                ? this.ticketUserRepository.findManyBy({
                    oid,
                    ticketId: { IN: array_helper_1.ESArray.uniqueArray(ticketIdList) },
                    positionType: position_entity_1.PositionInteractType.Procedure,
                    ticketItemId: { IN: array_helper_1.ESArray.uniqueArray(ticketProcedureIdList) },
                })
                : [],
        ]);
        const ticketMap = array_helper_1.ESArray.arrayToKeyValue(ticketList, 'id');
        const procedureMap = array_helper_1.ESArray.arrayToKeyValue(procedureList, 'id');
        const customerMap = array_helper_1.ESArray.arrayToKeyValue(customerList, 'id');
        let imageMap = {};
        if ((_a = relation === null || relation === void 0 ? void 0 : relation.ticketProcedureItemList) === null || _a === void 0 ? void 0 : _a.imageList) {
            const imageIdList = array_helper_1.ESArray.uniqueArray(ticketProcedureItemList
                .map((i) => {
                try {
                    return JSON.parse(i.imageIds);
                }
                catch (error) {
                    return [];
                }
            })
                .flat());
            if (imageIdList.length) {
                const imageList = await this.imageRepository.findManyByIds(imageIdList);
                imageMap = array_helper_1.ESArray.arrayToKeyValue(imageList || [], 'id');
            }
        }
        ticketProcedureList.forEach((tp) => {
            if (relation.ticket) {
                tp.ticket = ticketMap[tp.ticketId];
            }
            if (relation.customer) {
                tp.customer = customerMap[tp.customerId];
            }
            if (relation.procedure) {
                tp.procedure = procedureMap[tp.procedureId];
            }
            if (relation.ticketProcedureItemList) {
                tp.ticketProcedureItemList = ticketProcedureItemList.filter((i) => {
                    return i.ticketProcedureId === tp.id;
                });
                if (relation.ticketProcedureItemList.imageList) {
                    tp.ticketProcedureItemList.forEach((tpi) => {
                        try {
                            const imageIdList = JSON.parse(tpi.imageIds);
                            tpi.imageList = imageIdList.map((i) => imageMap[i]);
                        }
                        catch (error) {
                            tpi.imageList = [];
                        }
                    });
                }
            }
            if (relation.ticketUserList) {
                tp.ticketUserList = ticketUserList.filter((ticketUser) => {
                    return tp.ticketId === ticketUser.ticketId && tp.id === ticketUser.ticketItemId;
                });
            }
        });
        return ticketProcedureList;
    }
};
exports.ApiTicketProcedureService = ApiTicketProcedureService;
exports.ApiTicketProcedureService = ApiTicketProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_procedure_repository_1.TicketProcedureRepository !== "undefined" && ticket_procedure_repository_1.TicketProcedureRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketProcedureItemRepository !== "undefined" && repositories_1.TicketProcedureItemRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _e : Object, typeof (_f = typeof ticket_user_repository_1.TicketUserRepository !== "undefined" && ticket_user_repository_1.TicketUserRepository) === "function" ? _f : Object, typeof (_g = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _g : Object])
], ApiTicketProcedureService);


/***/ }),
/* 626 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_product_controller_1 = __webpack_require__(627);
const api_ticket_product_service_1 = __webpack_require__(628);
let ApiTicketProductModule = class ApiTicketProductModule {
};
exports.ApiTicketProductModule = ApiTicketProductModule;
exports.ApiTicketProductModule = ApiTicketProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_product_controller_1.ApiTicketProductController],
        providers: [api_ticket_product_service_1.ApiTicketProductService],
    })
], ApiTicketProductModule);


/***/ }),
/* 627 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_product_service_1 = __webpack_require__(628);
const request_1 = __webpack_require__(324);
let ApiTicketProductController = class ApiTicketProductController {
    constructor(apiTicketProductService) {
        this.apiTicketProductService = apiTicketProductService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiTicketProductService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiTicketProductService.getList(oid, query);
        return { data };
    }
    async destroyZero({ oid }, { id }) {
        const data = await this.apiTicketProductService.destroyZero(oid, id);
        return { data };
    }
};
exports.ApiTicketProductController = ApiTicketProductController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketProductPaginationQuery !== "undefined" && request_1.TicketProductPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketProductController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketProductGetManyQuery !== "undefined" && request_1.TicketProductGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiTicketProductController.prototype, "list", null);
__decorate([
    (0, common_1.Delete)('destroy-zero/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], ApiTicketProductController.prototype, "destroyZero", null);
exports.ApiTicketProductController = ApiTicketProductController = __decorate([
    (0, swagger_1.ApiTags)('TicketProduct'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-product'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_product_service_1.ApiTicketProductService !== "undefined" && api_ticket_product_service_1.ApiTicketProductService) === "function" ? _a : Object])
], ApiTicketProductController);


/***/ }),
/* 628 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketProductService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
const ticket_product_repository_1 = __webpack_require__(144);
let ApiTicketProductService = class ApiTicketProductService {
    constructor(ticketProductRepository, productRepository) {
        this.ticketProductRepository = ticketProductRepository;
        this.productRepository = productRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { total, data: ticketProductList } = await this.ticketProductRepository.pagination({
            relation,
            page,
            limit,
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            sort,
        });
        return { page, limit, total, ticketProductList };
    }
    async getList(oid, query) {
        const { filter, limit, relation, sort } = query;
        const ticketProductList = await this.ticketProductRepository.findMany({
            condition: {
                oid,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                productId: filter === null || filter === void 0 ? void 0 : filter.productId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
            },
            limit,
            sort,
        });
        return { ticketProductList };
    }
    async destroyZero(oid, ticketProductId) {
        await this.ticketProductRepository.delete({
            oid,
            id: ticketProductId,
            quantity: 0,
        });
        return { ticketProductId };
    }
};
exports.ApiTicketProductService = ApiTicketProductService;
exports.ApiTicketProductService = ApiTicketProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_product_repository_1.TicketProductRepository !== "undefined" && ticket_product_repository_1.TicketProductRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _b : Object])
], ApiTicketProductService);


/***/ }),
/* 629 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_radiology_controller_1 = __webpack_require__(630);
const api_ticket_radiology_service_1 = __webpack_require__(631);
let ApiTicketRadiologyModule = class ApiTicketRadiologyModule {
};
exports.ApiTicketRadiologyModule = ApiTicketRadiologyModule;
exports.ApiTicketRadiologyModule = ApiTicketRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_radiology_controller_1.ApiTicketRadiologyController],
        providers: [api_ticket_radiology_service_1.ApiTicketRadiologyService],
        exports: [api_ticket_radiology_service_1.ApiTicketRadiologyService],
    })
], ApiTicketRadiologyModule);


/***/ }),
/* 630 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_ticket_radiology_service_1 = __webpack_require__(631);
const request_1 = __webpack_require__(327);
let ApiTicketRadiologyController = class ApiTicketRadiologyController {
    constructor(apiTicketRadiologyService) {
        this.apiTicketRadiologyService = apiTicketRadiologyService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiTicketRadiologyService.pagination(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiTicketRadiologyService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiTicketRadiologyController = ApiTicketRadiologyController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketRadiologyPaginationQuery !== "undefined" && request_1.TicketRadiologyPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketRadiologyController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketRadiologyGetOneQuery !== "undefined" && request_1.TicketRadiologyGetOneQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketRadiologyController.prototype, "detail", null);
exports.ApiTicketRadiologyController = ApiTicketRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('TicketRadiology'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket-radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_ticket_radiology_service_1.ApiTicketRadiologyService !== "undefined" && api_ticket_radiology_service_1.ApiTicketRadiologyService) === "function" ? _a : Object])
], ApiTicketRadiologyController);


/***/ }),
/* 631 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const image_repository_1 = __webpack_require__(107);
const ticket_radiology_repository_1 = __webpack_require__(145);
let ApiTicketRadiologyService = class ApiTicketRadiologyService {
    constructor(ticketRadiologyRepository, customerRepository, ticketUserRepository, ticketRepository, imageRepository) {
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.customerRepository = customerRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.ticketRepository = ticketRepository;
        this.imageRepository = imageRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, relation, sort } = query;
        const { data: ticketRadiologyList, total } = await this.ticketRadiologyRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                roomId: filter === null || filter === void 0 ? void 0 : filter.roomId,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                paymentMoneyStatus: filter === null || filter === void 0 ? void 0 : filter.paymentMoneyStatus,
                radiologyId: filter === null || filter === void 0 ? void 0 : filter.radiologyId,
                ticketId: filter === null || filter === void 0 ? void 0 : filter.ticketId,
                createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                completedAt: filter === null || filter === void 0 ? void 0 : filter.completedAt,
            },
            sort,
        });
        if (query.relation) {
            await this.generateRelation(ticketRadiologyList, query.relation);
        }
        return { ticketRadiologyList, page, limit, total };
    }
    async getOne(oid, id, query) {
        const ticketRadiology = await this.ticketRadiologyRepository.findOne({
            condition: { oid, id },
        });
        if (!ticketRadiology) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (query.relation) {
            await this.generateRelation([ticketRadiology], query.relation);
        }
        return { ticketRadiology };
    }
    async generateRelation(ticketRadiologyList, relation) {
        const ticketRadiologyIdList = array_helper_1.ESArray.uniqueArray(ticketRadiologyList.map((i) => i.id));
        const customerIdList = array_helper_1.ESArray.uniqueArray(ticketRadiologyList.map((i) => i.customerId));
        const ticketIdList = array_helper_1.ESArray.uniqueArray(ticketRadiologyList.map((i) => i.ticketId));
        const imageIdList = array_helper_1.ESArray.uniqueArray(ticketRadiologyList.map((i) => JSON.parse(i.imageIds)).flat());
        const [ticketList, customerList, ticketUserList, imageList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.ticket) && ticketIdList.length
                ? this.ticketRepository.findManyBy({ id: { IN: ticketIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.customer) && customerIdList.length
                ? this.customerRepository.findManyBy({ id: { IN: customerIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.ticketUserList) && ticketIdList.length && ticketRadiologyIdList.length
                ? this.ticketUserRepository.findMany({
                    condition: {
                        ticketId: { IN: ticketIdList },
                        positionType: position_entity_1.PositionInteractType.Radiology,
                        ticketItemId: { IN: ticketRadiologyIdList },
                    },
                    sort: { id: 'ASC' },
                })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.imageList) && imageIdList.length
                ? this.imageRepository.findManyByIds(imageIdList)
                : [],
        ]);
        const imageMap = array_helper_1.ESArray.arrayToKeyValue(imageList, 'id');
        ticketRadiologyList.forEach((tr) => {
            tr.ticket = ticketList.find((t) => t.id === tr.ticketId);
            tr.customer = customerList.find((c) => c.id === tr.customerId);
            if (relation.ticketUserList) {
                tr.ticketUserList = ticketUserList.filter((tu) => tu.ticketItemId === tr.id);
            }
            if (relation.imageList) {
                tr.imageList = [];
                const imageIds = JSON.parse(tr.imageIds);
                tr.imageList = imageIds.map((i) => imageMap[i]);
            }
        });
        return ticketRadiologyList;
    }
};
exports.ApiTicketRadiologyService = ApiTicketRadiologyService;
exports.ApiTicketRadiologyService = ApiTicketRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_radiology_repository_1.TicketRadiologyRepository !== "undefined" && ticket_radiology_repository_1.TicketRadiologyRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _e : Object])
], ApiTicketRadiologyService);


/***/ }),
/* 632 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleModule = void 0;
const common_1 = __webpack_require__(3);
const api_user_role_controller_1 = __webpack_require__(633);
const api_user_role_service_1 = __webpack_require__(634);
let ApiUserRoleModule = class ApiUserRoleModule {
};
exports.ApiUserRoleModule = ApiUserRoleModule;
exports.ApiUserRoleModule = ApiUserRoleModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_user_role_controller_1.ApiUserRoleController],
        providers: [api_user_role_service_1.ApiUserRoleService],
    })
], ApiUserRoleModule);


/***/ }),
/* 633 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_user_role_service_1 = __webpack_require__(634);
const request_1 = __webpack_require__(635);
let ApiUserRoleController = class ApiUserRoleController {
    constructor(apiUserRoleService) {
        this.apiUserRoleService = apiUserRoleService;
    }
    list({ oid }, query) {
        return this.apiUserRoleService.getMany(oid, query);
    }
};
exports.ApiUserRoleController = ApiUserRoleController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.UserRoleGetManyQuery !== "undefined" && request_1.UserRoleGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiUserRoleController.prototype, "list", null);
exports.ApiUserRoleController = ApiUserRoleController = __decorate([
    (0, swagger_1.ApiTags)('UserRole'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('user-role'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_user_role_service_1.ApiUserRoleService !== "undefined" && api_user_role_service_1.ApiUserRoleService) === "function" ? _a : Object])
], ApiUserRoleController);


/***/ }),
/* 634 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoleService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
let ApiUserRoleService = class ApiUserRoleService {
    constructor(userRoleRepository) {
        this.userRoleRepository = userRoleRepository;
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.userRoleRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
};
exports.ApiUserRoleService = ApiUserRoleService;
exports.ApiUserRoleService = ApiUserRoleService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _a : Object])
], ApiUserRoleService);


/***/ }),
/* 635 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(636), exports);
__exportStar(__webpack_require__(637), exports);


/***/ }),
/* 636 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleGetOneQuery = exports.UserRoleGetManyQuery = exports.UserRolePaginationQuery = exports.UserRoleGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const user_role_options_request_1 = __webpack_require__(637);
class UserRoleGetQuery {
}
exports.UserRoleGetQuery = UserRoleGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_role_options_request_1.UserRoleRelationQuery !== "undefined" && user_role_options_request_1.UserRoleRelationQuery) === "function" ? _a : Object)
], UserRoleGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_role_options_request_1.UserRoleFilterQuery !== "undefined" && user_role_options_request_1.UserRoleFilterQuery) === "function" ? _b : Object)
], UserRoleGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_role_options_request_1.UserRoleSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_role_options_request_1.UserRoleSortQuery !== "undefined" && user_role_options_request_1.UserRoleSortQuery) === "function" ? _c : Object)
], UserRoleGetQuery.prototype, "sort", void 0);
class UserRolePaginationQuery extends (0, swagger_1.IntersectionType)(UserRoleGetQuery, query_1.PaginationQuery) {
}
exports.UserRolePaginationQuery = UserRolePaginationQuery;
class UserRoleGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(UserRoleGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.UserRoleGetManyQuery = UserRoleGetManyQuery;
class UserRoleGetOneQuery extends (0, swagger_1.PickType)(UserRoleGetQuery, ['relation']) {
}
exports.UserRoleGetOneQuery = UserRoleGetOneQuery;


/***/ }),
/* 637 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoleSortQuery = exports.UserRoleFilterQuery = exports.UserRoleRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class UserRoleRelationQuery {
}
exports.UserRoleRelationQuery = UserRoleRelationQuery;
class UserRoleFilterQuery {
}
exports.UserRoleFilterQuery = UserRoleFilterQuery;
class UserRoleSortQuery extends query_1.SortQuery {
}
exports.UserRoleSortQuery = UserRoleSortQuery;


/***/ }),
/* 638 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoomModule = void 0;
const common_1 = __webpack_require__(3);
const api_user_room_controller_1 = __webpack_require__(639);
const api_user_room_service_1 = __webpack_require__(640);
let ApiUserRoomModule = class ApiUserRoomModule {
};
exports.ApiUserRoomModule = ApiUserRoomModule;
exports.ApiUserRoomModule = ApiUserRoomModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_user_room_controller_1.ApiUserRoomController],
        providers: [api_user_room_service_1.ApiUserRoomService],
    })
], ApiUserRoomModule);


/***/ }),
/* 639 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoomController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const api_user_room_service_1 = __webpack_require__(640);
const request_1 = __webpack_require__(641);
let ApiUserRoomController = class ApiUserRoomController {
    constructor(apiUserRoomService) {
        this.apiUserRoomService = apiUserRoomService;
    }
    list({ oid }, query) {
        return this.apiUserRoomService.getMany(oid, query);
    }
};
exports.ApiUserRoomController = ApiUserRoomController;
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.UserRoomGetManyQuery !== "undefined" && request_1.UserRoomGetManyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiUserRoomController.prototype, "list", null);
exports.ApiUserRoomController = ApiUserRoomController = __decorate([
    (0, swagger_1.ApiTags)('UserRoom'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('user-room'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_user_room_service_1.ApiUserRoomService !== "undefined" && api_user_room_service_1.ApiUserRoomService) === "function" ? _a : Object])
], ApiUserRoomController);


/***/ }),
/* 640 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserRoomService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
let ApiUserRoomService = class ApiUserRoomService {
    constructor(userRoomRepository) {
        this.userRoomRepository = userRoomRepository;
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.userRoomRepository.findMany({
            relation,
            condition: {
                oid,
            },
            limit,
        });
        return { data };
    }
};
exports.ApiUserRoomService = ApiUserRoomService;
exports.ApiUserRoomService = ApiUserRoomService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.UserRoomRepository !== "undefined" && repositories_1.UserRoomRepository) === "function" ? _a : Object])
], ApiUserRoomService);


/***/ }),
/* 641 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(642), exports);
__exportStar(__webpack_require__(643), exports);


/***/ }),
/* 642 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoomGetOneQuery = exports.UserRoomGetManyQuery = exports.UserRoomPaginationQuery = exports.UserRoomGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const user_room_options_request_1 = __webpack_require__(643);
class UserRoomGetQuery {
}
exports.UserRoomGetQuery = UserRoomGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_room_options_request_1.UserRoomRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_room_options_request_1.UserRoomRelationQuery !== "undefined" && user_room_options_request_1.UserRoomRelationQuery) === "function" ? _a : Object)
], UserRoomGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_room_options_request_1.UserRoomFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_room_options_request_1.UserRoomFilterQuery !== "undefined" && user_room_options_request_1.UserRoomFilterQuery) === "function" ? _b : Object)
], UserRoomGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_room_options_request_1.UserRoomSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_room_options_request_1.UserRoomSortQuery !== "undefined" && user_room_options_request_1.UserRoomSortQuery) === "function" ? _c : Object)
], UserRoomGetQuery.prototype, "sort", void 0);
class UserRoomPaginationQuery extends (0, swagger_1.IntersectionType)(UserRoomGetQuery, query_1.PaginationQuery) {
}
exports.UserRoomPaginationQuery = UserRoomPaginationQuery;
class UserRoomGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(UserRoomGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.UserRoomGetManyQuery = UserRoomGetManyQuery;
class UserRoomGetOneQuery extends (0, swagger_1.PickType)(UserRoomGetQuery, ['relation']) {
}
exports.UserRoomGetOneQuery = UserRoomGetOneQuery;


/***/ }),
/* 643 */
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserRoomSortQuery = exports.UserRoomFilterQuery = exports.UserRoomRelationQuery = void 0;
const query_1 = __webpack_require__(259);
class UserRoomRelationQuery {
}
exports.UserRoomRelationQuery = UserRoomRelationQuery;
class UserRoomFilterQuery {
}
exports.UserRoomFilterQuery = UserRoomFilterQuery;
class UserRoomSortQuery extends query_1.SortQuery {
}
exports.UserRoomSortQuery = UserRoomSortQuery;


/***/ }),
/* 644 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserModule = void 0;
const common_1 = __webpack_require__(3);
const api_user_controller_1 = __webpack_require__(645);
const api_user_service_1 = __webpack_require__(646);
let ApiUserModule = class ApiUserModule {
};
exports.ApiUserModule = ApiUserModule;
exports.ApiUserModule = ApiUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_user_controller_1.ApiUserController],
        providers: [api_user_service_1.ApiUserService],
    })
], ApiUserModule);


/***/ }),
/* 645 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_user_service_1 = __webpack_require__(646);
const request_1 = __webpack_require__(647);
const device_logout_query_1 = __webpack_require__(651);
const new_password_body_1 = __webpack_require__(652);
let ApiUserController = class ApiUserController {
    constructor(apiUserService) {
        this.apiUserService = apiUserService;
    }
    pagination({ oid }, query) {
        return this.apiUserService.pagination({ oid, query });
    }
    list({ oid }, query) {
        return this.apiUserService.getMany(oid, query);
    }
    async detail({ oid }, { id }, query) {
        return await this.apiUserService.getOne(oid, id, query);
    }
    async createOne({ oid }, body) {
        return await this.apiUserService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiUserService.updateOne(oid, +id, body);
    }
    async newPassword({ oid }, { id }, { password }) {
        return await this.apiUserService.newPassword(oid, +id, password);
    }
    async deleteOne({ oid }, { id }) {
        return await this.apiUserService.deleteOne(oid, id);
    }
    deviceLogout({ oid }, { id }, body) {
        return this.apiUserService.deviceLogout({
            oid,
            userId: +id,
            refreshExp: body.refreshExp,
        });
    }
};
exports.ApiUserController = ApiUserController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.UserPaginationQuery !== "undefined" && request_1.UserPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.UserGetManyQuery !== "undefined" && request_1.UserGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object, typeof (_h = typeof request_1.UserGetOneQuery !== "undefined" && request_1.UserGetOneQuery) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "detail", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ACCOUNT_CREATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.UserCreateBody !== "undefined" && request_1.UserCreateBody) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ACCOUNT_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.UserUpdateBody !== "undefined" && request_1.UserUpdateBody) === "function" ? _o : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Patch)('new-password/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ACCOUNT_CHANGE_PASSWORD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _q : Object, typeof (_r = typeof new_password_body_1.NewPasswordBody !== "undefined" && new_password_body_1.NewPasswordBody) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "newPassword", null);
__decorate([
    (0, common_1.Delete)('delete/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ACCOUNT_DELETE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _t : Object]),
    __metadata("design:returntype", Promise)
], ApiUserController.prototype, "deleteOne", null);
__decorate([
    (0, common_1.Post)('device-logout/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.USER_ACCOUNT_LOGOUT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _v : Object, typeof (_w = typeof device_logout_query_1.DeviceLogoutBody !== "undefined" && device_logout_query_1.DeviceLogoutBody) === "function" ? _w : Object]),
    __metadata("design:returntype", void 0)
], ApiUserController.prototype, "deviceLogout", null);
exports.ApiUserController = ApiUserController = __decorate([
    (0, swagger_1.ApiTags)('User'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('user'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_user_service_1.ApiUserService !== "undefined" && api_user_service_1.ApiUserService) === "function" ? _a : Object])
], ApiUserController);


/***/ }),
/* 646 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiUserService = void 0;
const common_1 = __webpack_require__(3);
const bcrypt = __webpack_require__(239);
const cache_data_service_1 = __webpack_require__(40);
const cache_token_service_1 = __webpack_require__(155);
const exception_filter_1 = __webpack_require__(9);
const string_helper_1 = __webpack_require__(187);
const device_1 = __webpack_require__(350);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
let ApiUserService = class ApiUserService {
    constructor(socketEmitService, userRepository, userRoleRepository, userRoomRepository, roleRepository, roomRepository, cacheTokenService, cacheDataService) {
        this.socketEmitService = socketEmitService;
        this.userRepository = userRepository;
        this.userRoleRepository = userRoleRepository;
        this.userRoomRepository = userRoomRepository;
        this.roleRepository = roleRepository;
        this.roomRepository = roomRepository;
        this.cacheTokenService = cacheTokenService;
        this.cacheDataService = cacheDataService;
    }
    async pagination(options) {
        const { oid, query } = options;
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.userRepository.pagination({
            page,
            limit,
            relation: {
                organization: !!relation.organization,
                userRoleList: relation.userRoleList ? { role: true } : false,
            },
            condition: {
                oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ username: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        for (let i = 0; i < data.length; i++) {
            const user = data[i];
            const tokenData = await this.cacheTokenService.getTokenList({
                oid,
                uid: user.id,
            });
            user.devices = tokenData.map((j) => {
                const device = new device_1.default();
                device.refreshExp = j.refreshExp;
                device.ip = j.ip;
                device.os = j.os;
                device.browser = j.browser;
                device.mobile = j.mobile;
                device.online =
                    (this.socketEmitService.connections[user.id] || []).some((k) => {
                        return k.refreshExp === j.refreshExp;
                    }) || j.online;
                return device;
            });
        }
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.userRepository.findMany({
            relation,
            condition: {
                oid,
                isAdmin: filter === null || filter === void 0 ? void 0 : filter.isAdmin,
                isActive: filter === null || filter === void 0 ? void 0 : filter.isActive,
                $OR: (filter === null || filter === void 0 ? void 0 : filter.searchText)
                    ? [{ fullName: { LIKE: filter.searchText } }, { phone: { LIKE: filter.searchText } }]
                    : undefined,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id, query) {
        const user = await this.userRepository.findOne({
            relation: query.relation,
            condition: { id, oid },
        });
        if (!user)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { user } };
    }
    async createOne(oid, body) {
        const { user: userBody, account, roleIdList, roomIdList } = body;
        const existUser = await this.userRepository.findOneBy({
            oid,
            username: account.username,
        });
        if (existUser) {
            throw new exception_filter_1.BusinessException('error.Register.ExistUsername');
        }
        const hashPassword = await bcrypt.hash(account.password, 5);
        const secret = (0, string_helper_1.encrypt)(account.password, account.username);
        const user = await this.userRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, userBody), { oid, username: account.username, isAdmin: 0, secret,
            hashPassword, imageIds: JSON.stringify([]) }));
        if (roleIdList.length) {
            const roleList = await this.roleRepository.findManyBy({
                oid,
                id: { IN: roleIdList },
            });
            if (roleList.length !== roleIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const userRoleInsertList = roleIdList.map((i) => {
                const insert = {
                    oid,
                    roleId: i,
                    userId: user.id,
                };
                return insert;
            });
            user.userRoleList =
                await this.userRoleRepository.insertManyAndReturnEntity(userRoleInsertList);
        }
        if (roomIdList.length) {
            const roomList = await this.roomRepository.findManyBy({
                oid,
                id: { IN: roomIdList },
            });
            if (roomList.length !== roomIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const userRoomInsertList = roomIdList.map((i) => {
                const insert = {
                    oid,
                    roomId: i,
                    userId: user.id,
                };
                return insert;
            });
            user.userRoomList =
                await this.userRoomRepository.insertManyAndReturnEntity(userRoomInsertList);
        }
        this.cacheDataService.clearUserAndRoleAndRoom(user.oid);
        return { data: { user } };
    }
    async updateOne(oid, userId, body) {
        const { user: userBody, account, roleIdList, roomIdList } = body;
        let user;
        if (account) {
            const hashPassword = await bcrypt.hash(account.password, 5);
            const secret = (0, string_helper_1.encrypt)(account.password, account.username);
            user = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, Object.assign(Object.assign({}, userBody), { username: account.username, hashPassword,
                secret }));
        }
        else {
            user = await this.userRepository.updateOneAndReturnEntity({ oid, id: userId }, userBody);
        }
        if (!user) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        if (roleIdList) {
            await this.userRoleRepository.delete({ oid, userId });
            const roleList = await this.roleRepository.findManyBy({
                oid,
                id: { IN: roleIdList },
            });
            if (roleList.length !== roleIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const userRoleInsertList = roleIdList.map((i) => {
                const insert = {
                    oid,
                    roleId: i,
                    userId: user.id,
                };
                return insert;
            });
            user.userRoleList =
                await this.userRoleRepository.insertManyAndReturnEntity(userRoleInsertList);
        }
        if (roomIdList) {
            await this.userRoomRepository.delete({ oid, userId });
            const roomList = await this.roomRepository.findManyBy({
                oid,
                id: { IN: roomIdList },
            });
            if (roomList.length !== roomIdList.length) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const userRoomInsertList = roomIdList.map((i) => {
                const insert = {
                    oid,
                    roomId: i,
                    userId: user.id,
                };
                return insert;
            });
            user.userRoomList =
                await this.userRoomRepository.insertManyAndReturnEntity(userRoomInsertList);
        }
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { data: { user } };
    }
    async newPassword(oid, id, password) {
        const user = await this.userRepository.findOneBy({ oid, id });
        const hashPassword = await bcrypt.hash(password, 5);
        const secret = (0, string_helper_1.encrypt)(password, user.username);
        const affected = await this.userRepository.update({ oid, id }, { hashPassword, secret });
        if (affected === 0) {
            throw new exception_filter_1.BusinessException('error.Database.UpdateFailed');
        }
        return { data: true };
    }
    async deleteOne(oid, userId) {
        const user = await this.userRepository.deleteOneAndReturnEntity({ oid, id: userId });
        await Promise.all([
            this.userRoleRepository.delete({ oid, userId }),
            this.userRoomRepository.delete({ oid, userId }),
        ]);
        this.cacheDataService.clearUserAndRoleAndRoom(oid);
        return { data: { userId } };
    }
    async deviceLogout(options) {
        const { oid, userId, refreshExp } = options;
        const result = this.cacheTokenService.removeRefreshToken({
            oid,
            uid: userId,
            refreshExp,
        });
        return { data: true };
    }
};
exports.ApiUserService = ApiUserService;
exports.ApiUserService = ApiUserService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.UserRepository !== "undefined" && repositories_1.UserRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.UserRoleRepository !== "undefined" && repositories_1.UserRoleRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.UserRoomRepository !== "undefined" && repositories_1.UserRoomRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.RoleRepository !== "undefined" && repositories_1.RoleRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.RoomRepository !== "undefined" && repositories_1.RoomRepository) === "function" ? _f : Object, typeof (_g = typeof cache_token_service_1.CacheTokenService !== "undefined" && cache_token_service_1.CacheTokenService) === "function" ? _g : Object, typeof (_h = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _h : Object])
], ApiUserService);


/***/ }),
/* 647 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(648), exports);
__exportStar(__webpack_require__(649), exports);
__exportStar(__webpack_require__(650), exports);


/***/ }),
/* 648 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserGetOneQuery = exports.UserGetManyQuery = exports.UserPaginationQuery = exports.UserGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const user_options_request_1 = __webpack_require__(649);
class UserGetQuery {
}
exports.UserGetQuery = UserGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ userRoleList: {} }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof user_options_request_1.UserRelationQuery !== "undefined" && user_options_request_1.UserRelationQuery) === "function" ? _a : Object)
], UserGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            searchText: 'a',
            isActive: 1,
            isAdmin: 1,
            updatedAt: { LT: 1000 },
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof user_options_request_1.UserFilterQuery !== "undefined" && user_options_request_1.UserFilterQuery) === "function" ? _b : Object)
], UserGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({
            phone: 'ASC',
            id: 'DESC',
            username: 'ASC',
        }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(user_options_request_1.UserSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof user_options_request_1.UserSortQuery !== "undefined" && user_options_request_1.UserSortQuery) === "function" ? _c : Object)
], UserGetQuery.prototype, "sort", void 0);
class UserPaginationQuery extends (0, swagger_1.IntersectionType)(UserGetQuery, query_1.PaginationQuery) {
}
exports.UserPaginationQuery = UserPaginationQuery;
class UserGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(UserGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.UserGetManyQuery = UserGetManyQuery;
class UserGetOneQuery extends (0, swagger_1.PickType)(UserGetQuery, ['relation']) {
}
exports.UserGetOneQuery = UserGetOneQuery;


/***/ }),
/* 649 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserSortQuery = exports.UserFilterQuery = exports.UserRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class UserRelationQuery {
}
exports.UserRelationQuery = UserRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], UserRelationQuery.prototype, "organization", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], UserRelationQuery.prototype, "userRoleList", void 0);
class UserFilterQuery {
}
exports.UserFilterQuery = UserFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], UserFilterQuery.prototype, "searchText", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isAdmin", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserFilterQuery.prototype, "isActive", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], UserFilterQuery.prototype, "updatedAt", void 0);
class UserSortQuery extends query_1.SortQuery {
}
exports.UserSortQuery = UserSortQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "phone", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], UserSortQuery.prototype, "username", void 0);


/***/ }),
/* 650 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserUpdateBody = exports.UserCreateBody = exports.UserBody = exports.AccountBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class AccountBody {
}
exports.AccountBody = AccountBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'admin' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MinLength)(4),
    __metadata("design:type", String)
], AccountBody.prototype, "username", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], AccountBody.prototype, "password", void 0);
class UserBody {
}
exports.UserBody = UserBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '0376123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Validate)(class_validator_custom_1.IsPhone),
    __metadata("design:type", String)
], UserBody.prototype, "phone", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Phạm Hoàng Mai' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], UserBody.prototype, "fullName", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], UserBody.prototype, "birthday", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ enum: [0, 1], example: variable_1.EGender.Female }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", typeof (_a = typeof variable_1.EGender !== "undefined" && variable_1.EGender) === "function" ? _a : Object)
], UserBody.prototype, "gender", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)([0, 1]),
    __metadata("design:type", Number)
], UserBody.prototype, "isActive", void 0);
class UserCreateBody {
}
exports.UserCreateBody = UserCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: UserBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => UserBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", UserBody)
], UserCreateBody.prototype, "user", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: AccountBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => AccountBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", AccountBody)
], UserCreateBody.prototype, "account", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], UserCreateBody.prototype, "roleIdList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], UserCreateBody.prototype, "roomIdList", void 0);
class UserUpdateBody {
}
exports.UserUpdateBody = UserUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: UserBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => UserBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", UserBody)
], UserUpdateBody.prototype, "user", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: AccountBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => AccountBody),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", AccountBody)
], UserUpdateBody.prototype, "account", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], UserUpdateBody.prototype, "roleIdList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4] }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], UserUpdateBody.prototype, "roomIdList", void 0);


/***/ }),
/* 651 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DeviceLogoutBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class DeviceLogoutBody {
}
exports.DeviceLogoutBody = DeviceLogoutBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], DeviceLogoutBody.prototype, "refreshExp", void 0);


/***/ }),
/* 652 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.NewPasswordBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class NewPasswordBody {
}
exports.NewPasswordBody = NewPasswordBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Abc@123456' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.MinLength)(6),
    __metadata("design:type", String)
], NewPasswordBody.prototype, "password", void 0);


/***/ }),
/* 653 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseModule = void 0;
const common_1 = __webpack_require__(3);
const api_warehouse_controller_1 = __webpack_require__(654);
const api_warehouse_service_1 = __webpack_require__(655);
let ApiWarehouseModule = class ApiWarehouseModule {
};
exports.ApiWarehouseModule = ApiWarehouseModule;
exports.ApiWarehouseModule = ApiWarehouseModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_warehouse_controller_1.ApiWarehouseController],
        providers: [api_warehouse_service_1.ApiWarehouseService],
    })
], ApiWarehouseModule);


/***/ }),
/* 654 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const api_warehouse_service_1 = __webpack_require__(655);
const request_1 = __webpack_require__(656);
let ApiWarehouseController = class ApiWarehouseController {
    constructor(apiWarehouseService) {
        this.apiWarehouseService = apiWarehouseService;
    }
    pagination({ oid }, query) {
        return this.apiWarehouseService.pagination(oid, query);
    }
    list({ oid }, query) {
        return this.apiWarehouseService.getMany(oid, query);
    }
    findOne({ oid }, { id }) {
        return this.apiWarehouseService.getOne(oid, id);
    }
    async createOne({ oid }, body) {
        return await this.apiWarehouseService.createOne(oid, body);
    }
    async updateOne({ oid }, { id }, body) {
        return await this.apiWarehouseService.updateOne(oid, id, body);
    }
    async destroyOne({ oid }, { id }) {
        return await this.apiWarehouseService.destroyOne({ oid, warehouseId: id });
    }
};
exports.ApiWarehouseController = ApiWarehouseController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.WarehousePaginationQuery !== "undefined" && request_1.WarehousePaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.WarehouseGetManyQuery !== "undefined" && request_1.WarehouseGetManyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _g : Object]),
    __metadata("design:returntype", void 0)
], ApiWarehouseController.prototype, "findOne", null);
__decorate([
    (0, common_1.Post)('create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof request_1.WarehouseCreateBody !== "undefined" && request_1.WarehouseCreateBody) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "createOne", null);
__decorate([
    (0, common_1.Patch)('update/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _l : Object, typeof (_m = typeof request_1.WarehouseUpdateBody !== "undefined" && request_1.WarehouseUpdateBody) === "function" ? _m : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "updateOne", null);
__decorate([
    (0, common_1.Delete)('destroy/:id'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.MASTER_DATA_WAREHOUSE),
    (0, swagger_1.ApiParam)({ name: 'id', example: 1 }),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], ApiWarehouseController.prototype, "destroyOne", null);
exports.ApiWarehouseController = ApiWarehouseController = __decorate([
    (0, swagger_1.ApiTags)('Warehouse'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('warehouse'),
    __metadata("design:paramtypes", [typeof (_a = typeof api_warehouse_service_1.ApiWarehouseService !== "undefined" && api_warehouse_service_1.ApiWarehouseService) === "function" ? _a : Object])
], ApiWarehouseController);


/***/ }),
/* 655 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiWarehouseService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const batch_repository_1 = __webpack_require__(100);
const warehouse_repository_1 = __webpack_require__(153);
let ApiWarehouseService = class ApiWarehouseService {
    constructor(warehouseRepository, batchRepository) {
        this.warehouseRepository = warehouseRepository;
        this.batchRepository = batchRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { data, total } = await this.warehouseRepository.pagination({
            page,
            limit,
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        return {
            data,
            meta: { total, page, limit },
        };
    }
    async getMany(oid, query) {
        const { limit, filter, relation } = query;
        const data = await this.warehouseRepository.findMany({
            relation,
            condition: {
                oid,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
        });
        return { data };
    }
    async getOne(oid, id) {
        const warehouse = await this.warehouseRepository.findOneBy({ oid, id });
        if (!warehouse)
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        return { data: { warehouse } };
    }
    async createOne(oid, body) {
        const warehouse = await this.warehouseRepository.insertOneFullFieldAndReturnEntity(Object.assign({ oid }, body));
        return { data: { warehouse } };
    }
    async updateOne(oid, id, body) {
        const [warehouse] = await this.warehouseRepository.updateAndReturnEntity({ id, oid }, body);
        if (!warehouse) {
            throw exception_filter_1.BusinessException.create({
                message: 'error.Database.UpdateFailed',
                details: 'Warehouse',
            });
        }
        return { data: { warehouse } };
    }
    async destroyOne(options) {
        const { oid, warehouseId } = options;
        const countBatch = await this.batchRepository.countBy({ oid, warehouseId });
        if (countBatch > 0) {
            return {
                data: { countBatch },
                success: false,
            };
        }
        await this.warehouseRepository.delete({ oid, id: warehouseId });
        return { data: { countBatch: 0, warehouseId } };
    }
};
exports.ApiWarehouseService = ApiWarehouseService;
exports.ApiWarehouseService = ApiWarehouseService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof warehouse_repository_1.WarehouseRepository !== "undefined" && warehouse_repository_1.WarehouseRepository) === "function" ? _a : Object, typeof (_b = typeof batch_repository_1.BatchRepository !== "undefined" && batch_repository_1.BatchRepository) === "function" ? _b : Object])
], ApiWarehouseService);


/***/ }),
/* 656 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(657), exports);
__exportStar(__webpack_require__(658), exports);
__exportStar(__webpack_require__(659), exports);


/***/ }),
/* 657 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseGetOneQuery = exports.WarehouseGetManyQuery = exports.WarehousePaginationQuery = exports.WarehouseGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const warehouse_options_request_1 = __webpack_require__(658);
class WarehouseGetQuery {
}
exports.WarehouseGetQuery = WarehouseGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String, example: JSON.stringify({}) }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof warehouse_options_request_1.WarehouseRelationQuery !== "undefined" && warehouse_options_request_1.WarehouseRelationQuery) === "function" ? _a : Object)
], WarehouseGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ updatedAt: { GT: Date.now() } }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof warehouse_options_request_1.WarehouseFilterQuery !== "undefined" && warehouse_options_request_1.WarehouseFilterQuery) === "function" ? _b : Object)
], WarehouseGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(warehouse_options_request_1.WarehouseSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof warehouse_options_request_1.WarehouseSortQuery !== "undefined" && warehouse_options_request_1.WarehouseSortQuery) === "function" ? _c : Object)
], WarehouseGetQuery.prototype, "sort", void 0);
class WarehousePaginationQuery extends (0, swagger_1.IntersectionType)(WarehouseGetQuery, query_1.PaginationQuery) {
}
exports.WarehousePaginationQuery = WarehousePaginationQuery;
class WarehouseGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(WarehouseGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.WarehouseGetManyQuery = WarehouseGetManyQuery;
class WarehouseGetOneQuery extends (0, swagger_1.PickType)(WarehouseGetQuery, ['relation']) {
}
exports.WarehouseGetOneQuery = WarehouseGetOneQuery;


/***/ }),
/* 658 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseSortQuery = exports.WarehouseFilterQuery = exports.WarehouseRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const condition_timestamp_1 = __webpack_require__(312);
const query_1 = __webpack_require__(259);
class WarehouseRelationQuery {
}
exports.WarehouseRelationQuery = WarehouseRelationQuery;
class WarehouseFilterQuery {
}
exports.WarehouseFilterQuery = WarehouseFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => condition_timestamp_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof condition_timestamp_1.ConditionTimestamp !== "undefined" && condition_timestamp_1.ConditionTimestamp) === "function" ? _a : Object)
], WarehouseFilterQuery.prototype, "updatedAt", void 0);
class WarehouseSortQuery extends query_1.SortQuery {
}
exports.WarehouseSortQuery = WarehouseSortQuery;


/***/ }),
/* 659 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WarehouseUpdateBody = exports.WarehouseCreateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class WarehouseCreateBody {
}
exports.WarehouseCreateBody = WarehouseCreateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Ngô Nhật Dương' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], WarehouseCreateBody.prototype, "name", void 0);
class WarehouseUpdateBody extends (0, swagger_1.PartialType)(WarehouseCreateBody) {
}
exports.WarehouseUpdateBody = WarehouseUpdateBody;


/***/ }),
/* 660 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_action_module_1 = __webpack_require__(661);
const purchase_order_money_module_1 = __webpack_require__(666);
const api_purchase_order_query_module_1 = __webpack_require__(673);
const api_purchase_order_reception_module_1 = __webpack_require__(679);
let ApiPurchaseOrderModule = class ApiPurchaseOrderModule {
};
exports.ApiPurchaseOrderModule = ApiPurchaseOrderModule;
exports.ApiPurchaseOrderModule = ApiPurchaseOrderModule = __decorate([
    (0, common_1.Module)({
        imports: [
            api_purchase_order_query_module_1.ApiPurchaseOrderQueryModule,
            api_purchase_order_reception_module_1.ApiPurchaseOrderReceptionModule,
            purchase_order_money_module_1.PurchaseOrderMoneyModule,
            api_purchase_order_action_module_1.ApiPurchaseOrderActionModule,
        ],
        controllers: [],
        providers: [],
    })
], ApiPurchaseOrderModule);


/***/ }),
/* 661 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderActionModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_action_controller_1 = __webpack_require__(662);
const purchase_order_action_service_1 = __webpack_require__(663);
let ApiPurchaseOrderActionModule = class ApiPurchaseOrderActionModule {
};
exports.ApiPurchaseOrderActionModule = ApiPurchaseOrderActionModule;
exports.ApiPurchaseOrderActionModule = ApiPurchaseOrderActionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_purchase_order_action_controller_1.ApiPurchaseOrderActionController],
        providers: [purchase_order_action_service_1.PurchaseOrderActionService],
    })
], ApiPurchaseOrderActionModule);


/***/ }),
/* 662 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderActionController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const purchase_order_action_service_1 = __webpack_require__(663);
const request_1 = __webpack_require__(664);
let ApiPurchaseOrderActionController = class ApiPurchaseOrderActionController {
    constructor(purchaseOrderActionService) {
        this.purchaseOrderActionService = purchaseOrderActionService;
    }
    async draftDestroy({ oid }, { id }) {
        const data = await this.purchaseOrderActionService.destroy({
            oid,
            purchaseOrderId: id,
        });
        return { data };
    }
    async depositedDestroy({ oid }, { id }) {
        const data = await this.purchaseOrderActionService.destroy({
            oid,
            purchaseOrderId: id,
        });
        return { data };
    }
    async cancelledDestroy({ oid }, { id }) {
        const data = await this.purchaseOrderActionService.destroy({
            oid,
            purchaseOrderId: id,
        });
        return { data };
    }
    async sendProductAndPaymentAndClose({ oid, uid }, { id }, body) {
        const data = await this.purchaseOrderActionService.sendProductAndPaymentAndClose({
            oid,
            userId: uid,
            purchaseOrderId: id,
            body,
        });
        return { data };
    }
    async sendProduct({ oid, uid }, { id }) {
        const data = await this.purchaseOrderActionService.sendProduct({
            oid,
            userId: uid,
            purchaseOrderId: id,
        });
        return { data };
    }
    async close({ oid, uid }, { id }) {
        const data = await this.purchaseOrderActionService.close({
            oid,
            userId: uid,
            purchaseOrderId: id,
        });
        return { data };
    }
    async terminate({ oid, uid }, { id }) {
        const data = await this.purchaseOrderActionService.terminate({
            oid,
            userId: uid,
            purchaseOrderId: id,
        });
        return { data };
    }
};
exports.ApiPurchaseOrderActionController = ApiPurchaseOrderActionController;
__decorate([
    (0, common_1.Delete)('/:id/draft-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPurchaseOrderActionController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/deposited-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiPurchaseOrderActionController.prototype, "depositedDestroy", null);
__decorate([
    (0, common_1.Delete)('/:id/cancelled-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_CANCELLED_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], ApiPurchaseOrderActionController.prototype, "cancelledDestroy", null);
__decorate([
    (0, common_1.Post)('/:id/send-product-and-payment-and-close'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_SEND_PRODUCT, permission_enum_1.PermissionId.PURCHASE_ORDER_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _l : Object, typeof (_m = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _m : Object, typeof (_o = typeof request_1.PurchaseOrderPaymentMoneyBody !== "undefined" && request_1.PurchaseOrderPaymentMoneyBody) === "function" ? _o : Object]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], ApiPurchaseOrderActionController.prototype, "sendProductAndPaymentAndClose", null);
__decorate([
    (0, common_1.Post)('/:id/send-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_SEND_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _q : Object, typeof (_r = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _r : Object]),
    __metadata("design:returntype", typeof (_s = typeof Promise !== "undefined" && Promise) === "function" ? _s : Object)
], ApiPurchaseOrderActionController.prototype, "sendProduct", null);
__decorate([
    (0, common_1.Post)('/:id/close'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_t = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _t : Object, typeof (_u = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _u : Object]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], ApiPurchaseOrderActionController.prototype, "close", null);
__decorate([
    (0, common_1.Post)('/:id/terminate'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_TERMINATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _x : Object]),
    __metadata("design:returntype", typeof (_y = typeof Promise !== "undefined" && Promise) === "function" ? _y : Object)
], ApiPurchaseOrderActionController.prototype, "terminate", null);
exports.ApiPurchaseOrderActionController = ApiPurchaseOrderActionController = __decorate([
    (0, swagger_1.ApiTags)('PurchaseOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_action_service_1.PurchaseOrderActionService !== "undefined" && purchase_order_action_service_1.PurchaseOrderActionService) === "function" ? _a : Object])
], ApiPurchaseOrderActionController);


/***/ }),
/* 663 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderActionService = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
const purchase_order_entity_1 = __webpack_require__(54);
const operations_1 = __webpack_require__(164);
const purchase_order_repository_1 = __webpack_require__(126);
const socket_emit_service_1 = __webpack_require__(340);
let PurchaseOrderActionService = class PurchaseOrderActionService {
    constructor(socketEmitService, purchaseOrderRepository, purchaseOrderSendProductOperation, purchaseOrderCloseOperation, purchaseOrderReturnProductOperation, purchaseOrderReopenOperation, distributorPrepaymentMoneyOperation, distributorRefundMoneyOperation) {
        this.socketEmitService = socketEmitService;
        this.purchaseOrderRepository = purchaseOrderRepository;
        this.purchaseOrderSendProductOperation = purchaseOrderSendProductOperation;
        this.purchaseOrderCloseOperation = purchaseOrderCloseOperation;
        this.purchaseOrderReturnProductOperation = purchaseOrderReturnProductOperation;
        this.purchaseOrderReopenOperation = purchaseOrderReopenOperation;
        this.distributorPrepaymentMoneyOperation = distributorPrepaymentMoneyOperation;
        this.distributorRefundMoneyOperation = distributorRefundMoneyOperation;
    }
    async destroy(params) {
        const { oid, purchaseOrderId } = params;
        await this.purchaseOrderRepository.destroy({ oid, purchaseOrderId });
        return { purchaseOrderId };
    }
    async sendProductAndPaymentAndClose(params) {
        const { oid, userId, purchaseOrderId, body } = params;
        const sendProductResult = await this.purchaseOrderSendProductOperation.sendProduct({
            oid,
            userId,
            purchaseOrderId,
            time: Date.now(),
        });
        const paymentCreatedList = [];
        if (body.paidAmount > 0) {
            const prepaymentResult = await this.distributorPrepaymentMoneyOperation.startPrePaymentMoney({
                cashierId: userId,
                distributorId: body.distributorId,
                oid,
                purchaseOrderId,
                paymentMethodId: body.paymentMethodId,
                note: body.note,
                paidAmount: body.paidAmount,
                time: Date.now(),
            });
            paymentCreatedList.push(prepaymentResult.paymentCreated);
        }
        const closeResult = await this.purchaseOrderCloseOperation.startClose({
            oid,
            userId,
            purchaseOrderId,
            time: Date.now(),
            note: '',
        });
        paymentCreatedList.push(...closeResult.paymentCreatedList);
        if (closeResult.distributorModified) {
            this.socketEmitService.distributorUpsert(oid, {
                distributor: closeResult.distributorModified,
            });
        }
        this.socketEmitService.productListChange(oid, {
            productUpsertedList: sendProductResult.productList || [],
        });
        this.socketEmitService.batchListChange(oid, {
            batchUpsertedList: sendProductResult.batchList || [],
        });
        return {
            purchaseOrderModified: closeResult.purchaseOrderModified,
            distributorModified: closeResult.distributorModified,
            paymentCreatedList,
        };
    }
    async sendProduct(params) {
        const { oid, userId, purchaseOrderId } = params;
        const sendProductResult = await this.purchaseOrderSendProductOperation.sendProduct({
            oid,
            userId,
            purchaseOrderId,
            time: Date.now(),
        });
        this.socketEmitService.productListChange(oid, {
            productUpsertedList: sendProductResult.productList || [],
        });
        this.socketEmitService.batchListChange(oid, {
            batchUpsertedList: sendProductResult.batchList || [],
        });
        return { purchaseOrderModified: sendProductResult.purchaseOrder };
    }
    async close(params) {
        const { oid, userId, purchaseOrderId } = params;
        const closeResult = await this.purchaseOrderCloseOperation.startClose({
            oid,
            userId,
            purchaseOrderId,
            time: Date.now(),
            note: '',
        });
        if (closeResult.distributorModified) {
            this.socketEmitService.distributorUpsert(oid, {
                distributor: closeResult.distributorModified,
            });
        }
        return {
            purchaseOrderModified: closeResult.purchaseOrderModified,
            paymentCreatedList: closeResult.paymentCreatedList,
            distributorModified: closeResult.distributorModified,
        };
    }
    async terminate(params) {
        const { oid, userId, purchaseOrderId } = params;
        const time = Date.now();
        let distributorModified;
        const purchaseOrderOrigin = await this.purchaseOrderRepository.findOneBy({
            oid,
            id: purchaseOrderId,
        });
        const paymentCreatedList = [];
        if ([purchase_order_entity_1.PurchaseOrderStatus.Completed, purchase_order_entity_1.PurchaseOrderStatus.Debt].includes(purchaseOrderOrigin.status)) {
            const reopenResult = await this.purchaseOrderReopenOperation.reopen({
                oid,
                userId,
                time,
                purchaseOrderId,
                note: '',
            });
            distributorModified = reopenResult.distributorModified;
            paymentCreatedList.push(...reopenResult.paymentCreatedList);
        }
        if (purchaseOrderOrigin.paid > 0) {
            const refundResult = await this.distributorRefundMoneyOperation.startRefundMoney({
                oid,
                cashierId: userId,
                time,
                purchaseOrderId,
                paymentMethodId: 0,
                refundAmount: purchaseOrderOrigin.paid,
                note: 'Hủy phiếu',
                distributorId: purchaseOrderOrigin.distributorId,
            });
            distributorModified = refundResult.distributor;
            paymentCreatedList.push(refundResult.paymentCreated);
        }
        if (purchaseOrderOrigin.deliveryStatus === variable_1.DeliveryStatus.Delivered) {
            const returnResult = await this.purchaseOrderReturnProductOperation.returnAllProduct({
                oid,
                purchaseOrderId,
                time: Date.now(),
            });
            this.socketEmitService.productListChange(oid, {
                productUpsertedList: returnResult.productList || [],
            });
            this.socketEmitService.batchListChange(oid, {
                batchUpsertedList: returnResult.batchList || [],
            });
        }
        if (distributorModified) {
            this.socketEmitService.distributorUpsert(oid, { distributor: distributorModified });
        }
        const purchaseOrderModified = await this.purchaseOrderRepository.updateOneAndReturnEntity({ oid, id: purchaseOrderId, deliveryStatus: variable_1.DeliveryStatus.Pending }, { status: purchase_order_entity_1.PurchaseOrderStatus.Cancelled });
        return { purchaseOrderModified, paymentCreatedList, distributorModified };
    }
};
exports.PurchaseOrderActionService = PurchaseOrderActionService;
exports.PurchaseOrderActionService = PurchaseOrderActionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof purchase_order_repository_1.PurchaseOrderRepository !== "undefined" && purchase_order_repository_1.PurchaseOrderRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.PurchaseOrderSendProductOperation !== "undefined" && operations_1.PurchaseOrderSendProductOperation) === "function" ? _c : Object, typeof (_d = typeof operations_1.PurchaseOrderCloseOperation !== "undefined" && operations_1.PurchaseOrderCloseOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.PurchaseOrderReturnProductOperation !== "undefined" && operations_1.PurchaseOrderReturnProductOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.PurchaseOrderReopenOperation !== "undefined" && operations_1.PurchaseOrderReopenOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.DistributorPrepaymentMoneyOperation !== "undefined" && operations_1.DistributorPrepaymentMoneyOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.DistributorRefundMoneyOperation !== "undefined" && operations_1.DistributorRefundMoneyOperation) === "function" ? _h : Object])
], PurchaseOrderActionService);


/***/ }),
/* 664 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(665), exports);


/***/ }),
/* 665 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderPaymentMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class PurchaseOrderPaymentMoneyBody {
}
exports.PurchaseOrderPaymentMoneyBody = PurchaseOrderPaymentMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderPaymentMoneyBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PurchaseOrderPaymentMoneyBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PurchaseOrderPaymentMoneyBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PurchaseOrderPaymentMoneyBody.prototype, "note", void 0);


/***/ }),
/* 666 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderMoneyModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_money_controller_1 = __webpack_require__(667);
const purchase_order_money_service_1 = __webpack_require__(668);
let PurchaseOrderMoneyModule = class PurchaseOrderMoneyModule {
};
exports.PurchaseOrderMoneyModule = PurchaseOrderMoneyModule;
exports.PurchaseOrderMoneyModule = PurchaseOrderMoneyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_purchase_order_money_controller_1.ApiPurchaseOrderMoneyController],
        providers: [purchase_order_money_service_1.PurchaseOrderMoneyService],
    })
], PurchaseOrderMoneyModule);


/***/ }),
/* 667 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderMoneyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const purchase_order_money_service_1 = __webpack_require__(668);
const request_1 = __webpack_require__(669);
let ApiPurchaseOrderMoneyController = class ApiPurchaseOrderMoneyController {
    constructor(purchaseOrderMoneyService) {
        this.purchaseOrderMoneyService = purchaseOrderMoneyService;
    }
    async prepaymentMoney({ oid, uid }, { id }, body) {
        const data = await this.purchaseOrderMoneyService.prepaymentMoney({
            oid,
            userId: uid,
            body,
            purchaseOrderId: id,
        });
        return { data };
    }
    async payDebt({ oid, uid }, body) {
        const data = await this.purchaseOrderMoneyService.payDebt({
            oid,
            userId: uid,
            body,
        });
        return { data };
    }
    async refundMoney({ oid, uid }, { id }, body) {
        const data = await this.purchaseOrderMoneyService.refundMoney({
            oid,
            userId: uid,
            body,
            purchaseOrderId: id,
        });
        return { data };
    }
};
exports.ApiPurchaseOrderMoneyController = ApiPurchaseOrderMoneyController;
__decorate([
    (0, common_1.Post)('/:id/prepayment-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_PAYMENT_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _c : Object, typeof (_d = typeof request_1.DistributorPrepaymentBody !== "undefined" && request_1.DistributorPrepaymentBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ApiPurchaseOrderMoneyController.prototype, "prepaymentMoney", null);
__decorate([
    (0, common_1.Post)('pay-debt'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_PAYMENT_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.DistributorPayDebtBody !== "undefined" && request_1.DistributorPayDebtBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiPurchaseOrderMoneyController.prototype, "payDebt", null);
__decorate([
    (0, common_1.Post)('/:id/refund-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_REFUND_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_1.DistributorRefundMoneyBody !== "undefined" && request_1.DistributorRefundMoneyBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiPurchaseOrderMoneyController.prototype, "refundMoney", null);
exports.ApiPurchaseOrderMoneyController = ApiPurchaseOrderMoneyController = __decorate([
    (0, swagger_1.ApiTags)('PurchaseOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_money_service_1.PurchaseOrderMoneyService !== "undefined" && purchase_order_money_service_1.PurchaseOrderMoneyService) === "function" ? _a : Object])
], ApiPurchaseOrderMoneyController);


/***/ }),
/* 668 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderMoneyService = void 0;
const common_1 = __webpack_require__(3);
const operations_1 = __webpack_require__(164);
const socket_emit_service_1 = __webpack_require__(340);
let PurchaseOrderMoneyService = class PurchaseOrderMoneyService {
    constructor(socketEmitService, distributorPayDebtOperation, distributorPrepaymentMoneyOperation, distributorRefundMoneyOperation) {
        this.socketEmitService = socketEmitService;
        this.distributorPayDebtOperation = distributorPayDebtOperation;
        this.distributorPrepaymentMoneyOperation = distributorPrepaymentMoneyOperation;
        this.distributorRefundMoneyOperation = distributorRefundMoneyOperation;
    }
    async prepaymentMoney(data) {
        const { oid, userId, purchaseOrderId, body, options } = data;
        const prepaymentResult = await this.distributorPrepaymentMoneyOperation.startPrePaymentMoney({
            oid,
            purchaseOrderId,
            distributorId: body.distributorId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            paidAmount: body.paidAmount,
            note: body.note,
        });
        const { purchaseOrderModified, distributor, paymentCreated } = prepaymentResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitPurchaseOrder)) {
            this.socketEmitService.socketPurchaseOrderListChange(oid, {
                purchaseOrderUpsertedList: [purchaseOrderModified],
            });
        }
        return { purchaseOrderModified, distributor, paymentCreated };
    }
    async payDebt(data) {
        const { oid, userId, body, options } = data;
        const payDebtResult = await this.distributorPayDebtOperation.startPayDebt({
            oid,
            distributorId: body.distributorId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            paidAmount: body.paidAmount,
            note: body.note,
            dataList: body.dataList,
        });
        const { purchaseOrderModifiedList, distributorModified, paymentCreatedList } = payDebtResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketPurchaseOrderListChange(oid, {
                purchaseOrderUpsertedList: purchaseOrderModifiedList,
            });
        }
        if (!(options === null || options === void 0 ? void 0 : options.noEmitDistributor)) {
            this.socketEmitService.distributorUpsert(oid, { distributor: distributorModified });
        }
        return { purchaseOrderModifiedList, distributorModified, paymentCreatedList };
    }
    async refundMoney(data) {
        const { oid, userId, body, options, purchaseOrderId } = data;
        const payDebtResult = await this.distributorRefundMoneyOperation.startRefundMoney({
            oid,
            purchaseOrderId,
            distributorId: body.distributorId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            refundAmount: body.refundAmount,
            note: body.note,
        });
        const { purchaseOrderModified, distributor, paymentCreated } = payDebtResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitPurchaseOrder)) {
            this.socketEmitService.socketPurchaseOrderListChange(oid, {
                purchaseOrderUpsertedList: [purchaseOrderModified],
            });
        }
        return { purchaseOrderModified, distributor, paymentCreated };
    }
};
exports.PurchaseOrderMoneyService = PurchaseOrderMoneyService;
exports.PurchaseOrderMoneyService = PurchaseOrderMoneyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof operations_1.DistributorPayDebtOperation !== "undefined" && operations_1.DistributorPayDebtOperation) === "function" ? _b : Object, typeof (_c = typeof operations_1.DistributorPrepaymentMoneyOperation !== "undefined" && operations_1.DistributorPrepaymentMoneyOperation) === "function" ? _c : Object, typeof (_d = typeof operations_1.DistributorRefundMoneyOperation !== "undefined" && operations_1.DistributorRefundMoneyOperation) === "function" ? _d : Object])
], PurchaseOrderMoneyService);


/***/ }),
/* 669 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(670), exports);
__exportStar(__webpack_require__(671), exports);
__exportStar(__webpack_require__(672), exports);


/***/ }),
/* 670 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPayDebtBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class DataList {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DataList.prototype, "purchaseOrderId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DataList.prototype, "paidAmount", void 0);
class DistributorPayDebtBody {
}
exports.DistributorPayDebtBody = DistributorPayDebtBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPayDebtBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPayDebtBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DistributorPayDebtBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorPayDebtBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: DataList, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => DataList),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], DistributorPayDebtBody.prototype, "dataList", void 0);


/***/ }),
/* 671 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorPrepaymentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class DistributorPrepaymentBody {
}
exports.DistributorPrepaymentBody = DistributorPrepaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPrepaymentBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorPrepaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DistributorPrepaymentBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorPrepaymentBody.prototype, "note", void 0);


/***/ }),
/* 672 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DistributorRefundMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class DistributorRefundMoneyBody {
}
exports.DistributorRefundMoneyBody = DistributorRefundMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorRefundMoneyBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DistributorRefundMoneyBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DistributorRefundMoneyBody.prototype, "refundAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], DistributorRefundMoneyBody.prototype, "note", void 0);


/***/ }),
/* 673 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderQueryModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_query_controller_1 = __webpack_require__(674);
const purchase_order_query_service_1 = __webpack_require__(675);
let ApiPurchaseOrderQueryModule = class ApiPurchaseOrderQueryModule {
};
exports.ApiPurchaseOrderQueryModule = ApiPurchaseOrderQueryModule;
exports.ApiPurchaseOrderQueryModule = ApiPurchaseOrderQueryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_purchase_order_query_controller_1.ApiPurchaseOrderQueryController],
        providers: [purchase_order_query_service_1.ApiPurchaseOrderQueryService],
    })
], ApiPurchaseOrderQueryModule);


/***/ }),
/* 674 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderQueryController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const organization_guard_1 = __webpack_require__(156);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const purchase_order_query_service_1 = __webpack_require__(675);
const request_1 = __webpack_require__(676);
let ApiPurchaseOrderQueryController = class ApiPurchaseOrderQueryController {
    constructor(apiPurchaseOrderQueryService) {
        this.apiPurchaseOrderQueryService = apiPurchaseOrderQueryService;
    }
    async pagination({ oid }, query) {
        const data = await this.apiPurchaseOrderQueryService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.apiPurchaseOrderQueryService.getMany(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.apiPurchaseOrderQueryService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiPurchaseOrderQueryController = ApiPurchaseOrderQueryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PurchaseOrderPaginationQuery !== "undefined" && request_1.PurchaseOrderPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPurchaseOrderQueryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.PurchaseOrderGetManyQuery !== "undefined" && request_1.PurchaseOrderGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiPurchaseOrderQueryController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('/:id/detail'),
    (0, organization_guard_1.OrganizationPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.PurchaseOrderGetOneQuery !== "undefined" && request_1.PurchaseOrderGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiPurchaseOrderQueryController.prototype, "detail", null);
exports.ApiPurchaseOrderQueryController = ApiPurchaseOrderQueryController = __decorate([
    (0, swagger_1.ApiTags)('PurchaseOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_query_service_1.ApiPurchaseOrderQueryService !== "undefined" && purchase_order_query_service_1.ApiPurchaseOrderQueryService) === "function" ? _a : Object])
], ApiPurchaseOrderQueryController);


/***/ }),
/* 675 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderQueryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const payment_entity_1 = __webpack_require__(51);
const repositories_1 = __webpack_require__(42);
const batch_repository_1 = __webpack_require__(100);
const purchase_order_repository_1 = __webpack_require__(126);
let ApiPurchaseOrderQueryService = class ApiPurchaseOrderQueryService {
    constructor(purchaseOrderRepository, purchaseOrderItemRepository, distributorRepository, productRepository, batchRepository, paymentRepository) {
        this.purchaseOrderRepository = purchaseOrderRepository;
        this.purchaseOrderItemRepository = purchaseOrderItemRepository;
        this.distributorRepository = distributorRepository;
        this.productRepository = productRepository;
        this.batchRepository = batchRepository;
        this.paymentRepository = paymentRepository;
    }
    async pagination(oid, query) {
        const { page, limit, filter, sort, relation } = query;
        const { startedAt, distributorId, status } = query.filter || {};
        const { total, data: purchaseOrderList } = await this.purchaseOrderRepository.pagination({
            page: query.page,
            limit: query.limit,
            condition: {
                oid,
                distributorId,
                status,
                startedAt,
            },
            sort: query.sort || { id: 'DESC' },
        });
        if (query.relation) {
            await this.generateRelation(purchaseOrderList, query.relation);
        }
        return { purchaseOrderList, total, page, limit };
    }
    async getMany(oid, query) {
        const { relation, limit } = query;
        const { startedAt, distributorId, status } = query.filter || {};
        const purchaseOrderList = await this.purchaseOrderRepository.findMany({
            condition: {
                oid,
                distributorId,
                status,
                startedAt,
            },
            limit,
        });
        if (query.relation) {
            await this.generateRelation(purchaseOrderList, query.relation);
        }
        return { purchaseOrderList };
    }
    async getOne(oid, purchaseOrderId, query) {
        const purchaseOrder = await this.purchaseOrderRepository.findOneBy({ oid, id: purchaseOrderId });
        if (!purchaseOrder) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (query.relation) {
            await this.generateRelation([purchaseOrder], query.relation);
        }
        return { purchaseOrder };
    }
    async generateRelation(purchaseOrderList, relation) {
        var _a, _b;
        const purchaseOrderIdList = array_helper_1.ESArray.uniqueArray(purchaseOrderList.map((i) => i.id));
        const distributorIdList = array_helper_1.ESArray.uniqueArray(purchaseOrderList.map((i) => i.distributorId));
        const [purchaseOrderItemList, distributorList, paymentList] = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.purchaseOrderItemList) && purchaseOrderIdList.length
                ? this.purchaseOrderItemRepository.findManyBy({ purchaseOrderId: { IN: purchaseOrderIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.distributor) && distributorIdList.length
                ? this.distributorRepository.findManyBy({ id: { IN: distributorIdList } })
                : [],
            (relation === null || relation === void 0 ? void 0 : relation.paymentList) && purchaseOrderIdList.length
                ? this.paymentRepository.findMany({
                    condition: {
                        voucherId: { IN: purchaseOrderIdList },
                        voucherType: payment_entity_1.PaymentVoucherType.PurchaseOrder,
                    },
                    sort: { id: 'ASC' },
                })
                : [],
        ]);
        purchaseOrderList.forEach((r) => {
            r.purchaseOrderItemList = purchaseOrderItemList.filter((ri) => ri.purchaseOrderId === r.id);
            r.distributor = distributorList.find((d) => d.id === r.distributorId);
            r.paymentList = paymentList.filter((p) => p.voucherId === r.id);
        });
        if (relation === null || relation === void 0 ? void 0 : relation.purchaseOrderItemList) {
            const productIdList = array_helper_1.ESArray.uniqueArray(purchaseOrderItemList.map((i) => i.productId));
            const batchIdList = array_helper_1.ESArray.uniqueArray(purchaseOrderItemList.map((i) => i.batchId));
            const [productList, batchList] = await Promise.all([
                ((_a = relation === null || relation === void 0 ? void 0 : relation.purchaseOrderItemList) === null || _a === void 0 ? void 0 : _a.product) && productIdList.length
                    ? this.productRepository.findManyBy({ id: { IN: productIdList } })
                    : [],
                ((_b = relation === null || relation === void 0 ? void 0 : relation.purchaseOrderItemList) === null || _b === void 0 ? void 0 : _b.batch) && batchIdList.length
                    ? this.batchRepository.findManyBy({ id: { IN: batchIdList } })
                    : [],
            ]);
            const productMap = array_helper_1.ESArray.arrayToKeyValue(productList, 'id');
            const batchMap = array_helper_1.ESArray.arrayToKeyValue(batchList, 'id');
            purchaseOrderItemList.forEach((ri) => {
                ri.batch = batchMap[ri.batchId];
                ri.product = productMap[ri.productId];
            });
        }
        return purchaseOrderList;
    }
};
exports.ApiPurchaseOrderQueryService = ApiPurchaseOrderQueryService;
exports.ApiPurchaseOrderQueryService = ApiPurchaseOrderQueryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_repository_1.PurchaseOrderRepository !== "undefined" && purchase_order_repository_1.PurchaseOrderRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PurchaseOrderItemRepository !== "undefined" && repositories_1.PurchaseOrderItemRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.DistributorRepository !== "undefined" && repositories_1.DistributorRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _d : Object, typeof (_e = typeof batch_repository_1.BatchRepository !== "undefined" && batch_repository_1.BatchRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _f : Object])
], ApiPurchaseOrderQueryService);


/***/ }),
/* 676 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(677), exports);
__exportStar(__webpack_require__(678), exports);


/***/ }),
/* 677 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderGetOneQuery = exports.PurchaseOrderGetManyQuery = exports.PurchaseOrderPaginationQuery = exports.PurchaseOrderGetQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
const purchase_order_options_request_1 = __webpack_require__(678);
class PurchaseOrderGetQuery {
}
exports.PurchaseOrderGetQuery = PurchaseOrderGetQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({}),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_options_request_1.PurchaseOrderRelationQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_a = typeof purchase_order_options_request_1.PurchaseOrderRelationQuery !== "undefined" && purchase_order_options_request_1.PurchaseOrderRelationQuery) === "function" ? _a : Object)
], PurchaseOrderGetQuery.prototype, "relation", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ distributorId: 33 }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_options_request_1.PurchaseOrderFilterQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof purchase_order_options_request_1.PurchaseOrderFilterQuery !== "undefined" && purchase_order_options_request_1.PurchaseOrderFilterQuery) === "function" ? _b : Object)
], PurchaseOrderGetQuery.prototype, "filter", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: String,
        example: JSON.stringify({ id: 'ASC' }),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(purchase_order_options_request_1.PurchaseOrderSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof purchase_order_options_request_1.PurchaseOrderSortQuery !== "undefined" && purchase_order_options_request_1.PurchaseOrderSortQuery) === "function" ? _c : Object)
], PurchaseOrderGetQuery.prototype, "sort", void 0);
class PurchaseOrderPaginationQuery extends (0, swagger_1.IntersectionType)(PurchaseOrderGetQuery, query_1.PaginationQuery) {
}
exports.PurchaseOrderPaginationQuery = PurchaseOrderPaginationQuery;
class PurchaseOrderGetManyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(PurchaseOrderGetQuery, ['filter', 'relation', 'sort']), query_1.LimitQuery) {
}
exports.PurchaseOrderGetManyQuery = PurchaseOrderGetManyQuery;
class PurchaseOrderGetOneQuery extends (0, swagger_1.PickType)(PurchaseOrderGetQuery, ['relation']) {
}
exports.PurchaseOrderGetOneQuery = PurchaseOrderGetOneQuery;


/***/ }),
/* 678 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderSortQuery = exports.PurchaseOrderFilterQuery = exports.PurchaseOrderRelationQuery = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const query_1 = __webpack_require__(259);
const purchase_order_entity_1 = __webpack_require__(54);
class PurchaseOrderRelationQuery {
}
exports.PurchaseOrderRelationQuery = PurchaseOrderRelationQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PurchaseOrderRelationQuery.prototype, "distributor", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsBoolean)(),
    __metadata("design:type", Boolean)
], PurchaseOrderRelationQuery.prototype, "paymentList", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], PurchaseOrderRelationQuery.prototype, "purchaseOrderItemList", void 0);
const ConditionEnumDeliveryStatus = (0, dto_1.createConditionEnum)(purchase_order_entity_1.PurchaseOrderStatus);
class PurchaseOrderFilterQuery {
}
exports.PurchaseOrderFilterQuery = PurchaseOrderFilterQuery;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderFilterQuery.prototype, "distributorId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)((params) => (0, dto_1.transformConditionEnum)(params, purchase_order_entity_1.PurchaseOrderStatus)),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", Object)
], PurchaseOrderFilterQuery.prototype, "status", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => dto_1.ConditionTimestamp),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_c = typeof dto_1.ConditionTimestamp !== "undefined" && dto_1.ConditionTimestamp) === "function" ? _c : Object)
], PurchaseOrderFilterQuery.prototype, "startedAt", void 0);
class PurchaseOrderSortQuery extends query_1.SortQuery {
}
exports.PurchaseOrderSortQuery = PurchaseOrderSortQuery;


/***/ }),
/* 679 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderReceptionModule = void 0;
const common_1 = __webpack_require__(3);
const api_purchase_order_reception_controller_1 = __webpack_require__(680);
const purchase_order_reception_service_1 = __webpack_require__(681);
let ApiPurchaseOrderReceptionModule = class ApiPurchaseOrderReceptionModule {
};
exports.ApiPurchaseOrderReceptionModule = ApiPurchaseOrderReceptionModule;
exports.ApiPurchaseOrderReceptionModule = ApiPurchaseOrderReceptionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_purchase_order_reception_controller_1.ApiPurchaseOrderReceptionController],
        providers: [purchase_order_reception_service_1.ApiPurchaseOrderReceptionService],
    })
], ApiPurchaseOrderReceptionModule);


/***/ }),
/* 680 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderReceptionController = void 0;
const common_1 = __webpack_require__(3);
const route_params_decorator_1 = __webpack_require__(550);
const swagger_1 = __webpack_require__(6);
const param_1 = __webpack_require__(313);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const purchase_order_reception_service_1 = __webpack_require__(681);
const request_1 = __webpack_require__(682);
let ApiPurchaseOrderReceptionController = class ApiPurchaseOrderReceptionController {
    constructor(apiPurchaseOrderReceptionService) {
        this.apiPurchaseOrderReceptionService = apiPurchaseOrderReceptionService;
    }
    async createDraft({ oid }, body) {
        const data = await this.apiPurchaseOrderReceptionService.createDraft({ oid, body });
        return { data };
    }
    async updateDraft({ oid }, { id }, body) {
        const data = await this.apiPurchaseOrderReceptionService.updateDraft({
            oid,
            purchaseOrderId: id,
            body,
        });
        return { data };
    }
    async depositedUpdate({ oid }, { id }, body) {
        const data = await this.apiPurchaseOrderReceptionService.depositedUpdate({
            oid,
            purchaseOrderId: id,
            body,
        });
        return { data };
    }
};
exports.ApiPurchaseOrderReceptionController = ApiPurchaseOrderReceptionController;
__decorate([
    (0, common_1.Post)('create-draft'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.PurchaseOrderUpsertDraftBody !== "undefined" && request_1.PurchaseOrderUpsertDraftBody) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiPurchaseOrderReceptionController.prototype, "createDraft", null);
__decorate([
    (0, common_1.Patch)('/:id/update-draft'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_1.PurchaseOrderUpsertDraftBody !== "undefined" && request_1.PurchaseOrderUpsertDraftBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiPurchaseOrderReceptionController.prototype, "updateDraft", null);
__decorate([
    (0, common_1.Patch)('/:id/deposited-update'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.PURCHASE_ORDER_DEPOSITED_UPDATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, route_params_decorator_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof param_1.IdParam !== "undefined" && param_1.IdParam) === "function" ? _k : Object, typeof (_l = typeof request_1.PurchaseOrderUpdateDepositedBody !== "undefined" && request_1.PurchaseOrderUpdateDepositedBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiPurchaseOrderReceptionController.prototype, "depositedUpdate", null);
exports.ApiPurchaseOrderReceptionController = ApiPurchaseOrderReceptionController = __decorate([
    (0, swagger_1.ApiTags)('PurchaseOrder'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof purchase_order_reception_service_1.ApiPurchaseOrderReceptionService !== "undefined" && purchase_order_reception_service_1.ApiPurchaseOrderReceptionService) === "function" ? _a : Object])
], ApiPurchaseOrderReceptionController);


/***/ }),
/* 681 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiPurchaseOrderReceptionService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const array_helper_1 = __webpack_require__(154);
const entities_1 = __webpack_require__(45);
const product_entity_1 = __webpack_require__(57);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const batch_repository_1 = __webpack_require__(100);
let ApiPurchaseOrderReceptionService = class ApiPurchaseOrderReceptionService {
    constructor(cacheDataService, productRepository, batchRepository, purchaseOrderDraft, purchaseOrderDepositedOperation) {
        this.cacheDataService = cacheDataService;
        this.productRepository = productRepository;
        this.batchRepository = batchRepository;
        this.purchaseOrderDraft = purchaseOrderDraft;
        this.purchaseOrderDepositedOperation = purchaseOrderDepositedOperation;
    }
    async createDraft(params) {
        const { oid, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { purchaseOrder: purchaseOrderBody, purchaseOrderItemList, distributorId } = body;
        const productIdList = purchaseOrderItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = array_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique }, isActive: 1 }),
            this.batchRepository.findMany({
                condition: { oid, productId: { IN: productIdUnique }, isActive: 1 },
                sort: { id: 'DESC' },
            }),
        ]);
        const batchListMap = array_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = array_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        purchaseOrderItemList.forEach((purchaseOrderItem, index) => {
            if (purchaseOrderItem.batchId)
                return;
            const batchFind = (batchListMap[purchaseOrderItem.productId] || []).find((batch) => {
                const product = productMap[purchaseOrderItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                if (product.productType === product_entity_1.ProductType.Basic) {
                    return true;
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != purchaseOrderItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != purchaseOrderItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != purchaseOrderItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                purchaseOrderItem.batchId = batchFind.id;
            }
        });
        const purchaseOrderItemListNoBatch = purchaseOrderItemList.filter((i) => !i.batchId);
        const batchInsertList = purchaseOrderItemListNoBatch.map((purchaseOrderItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: purchaseOrderItem.productId,
                warehouseId: purchaseOrderItem.warehouseId,
                lotNumber: purchaseOrderItem.lotNumber,
                expiryDate: purchaseOrderItem.expiryDate,
                costPrice: purchaseOrderItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
                isActive: 1,
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        purchaseOrderItemListNoBatch.forEach((purchaseOrderItem, index) => {
            purchaseOrderItem.batchId = batchIdInsertList[index];
        });
        try {
            const { purchaseOrder } = await this.purchaseOrderDraft.createDraft({
                oid,
                purchaseOrderInsertDto: Object.assign(Object.assign({}, purchaseOrderBody), { distributorId }),
                purchaseOrderItemListDto: purchaseOrderItemList,
            });
            return { purchaseOrderId: purchaseOrder.id };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async updateDraft(params) {
        const { oid, purchaseOrderId, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { purchaseOrder: purchaseOrderBody, purchaseOrderItemList, distributorId } = body;
        const productIdList = purchaseOrderItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = array_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique }, isActive: 1 }),
            this.batchRepository.findMany({
                condition: { oid, productId: { IN: productIdUnique }, isActive: 1 },
                sort: { id: 'DESC' },
            }),
        ]);
        const batchListMap = array_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = array_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        purchaseOrderItemList.forEach((purchaseOrderItem, index) => {
            if (purchaseOrderItem.batchId)
                return;
            const batchFind = (batchListMap[purchaseOrderItem.productId] || []).find((batch) => {
                const product = productMap[purchaseOrderItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                if (product.productType === product_entity_1.ProductType.Basic) {
                    return true;
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != purchaseOrderItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != purchaseOrderItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != purchaseOrderItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                purchaseOrderItem.batchId = batchFind.id;
            }
        });
        const purchaseOrderItemListNoBatch = purchaseOrderItemList.filter((i) => !i.batchId);
        const batchInsertList = purchaseOrderItemListNoBatch.map((purchaseOrderItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: purchaseOrderItem.productId,
                warehouseId: purchaseOrderItem.warehouseId,
                lotNumber: purchaseOrderItem.lotNumber,
                expiryDate: purchaseOrderItem.expiryDate,
                costPrice: purchaseOrderItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
                isActive: 1,
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        purchaseOrderItemListNoBatch.forEach((purchaseOrderItem, index) => {
            purchaseOrderItem.batchId = batchIdInsertList[index];
        });
        try {
            await this.purchaseOrderDraft.updateDraft({
                oid,
                purchaseOrderId,
                purchaseOrderUpdateDto: Object.assign(Object.assign({}, purchaseOrderBody), { distributorId }),
                purchaseOrderItemListDto: purchaseOrderItemList,
            });
            return { purchaseOrderId };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
    async depositedUpdate(params) {
        const { oid, purchaseOrderId, body } = params;
        const [settingMap, settingMapRoot] = await Promise.all([
            this.cacheDataService.getSettingMap(oid),
            this.cacheDataService.getSettingMap(1),
        ]);
        const productSettingCommon = settingMap.PRODUCT_SETTING || {};
        const productSettingRoot = settingMapRoot.PRODUCT_SETTING || {};
        const { purchaseOrder: purchaseOrderDto, purchaseOrderItemList, distributorId } = body;
        const productIdList = purchaseOrderItemList.filter((i) => !i.batchId).map((i) => i.productId);
        const productIdUnique = array_helper_1.ESArray.uniqueArray(productIdList);
        const [productList, batchList] = await Promise.all([
            this.productRepository.findManyBy({ oid, id: { IN: productIdUnique }, isActive: 1 }),
            this.batchRepository.findMany({
                condition: { oid, productId: { IN: productIdUnique }, isActive: 1 },
                sort: { id: 'DESC' },
            }),
        ]);
        const batchListMap = array_helper_1.ESArray.arrayToKeyArray(batchList, 'productId');
        const productMap = array_helper_1.ESArray.arrayToKeyValue(productList, 'id');
        purchaseOrderItemList.forEach((purchaseOrderItem, index) => {
            if (purchaseOrderItem.batchId)
                return;
            const batchFind = (batchListMap[purchaseOrderItem.productId] || []).find((batch) => {
                const product = productMap[purchaseOrderItem.productId];
                if (!product) {
                    throw new exception_filter_1.BusinessException(`Có sản phẩm không hợp lệ, vị trí ${index}`);
                }
                if (product.productType === product_entity_1.ProductType.Basic) {
                    return true;
                }
                const splitRule = entities_1.Product.getProductSettingRule(product, productSettingCommon, productSettingRoot);
                if (batch.warehouseId != purchaseOrderItem.warehouseId) {
                    if (splitRule.splitBatchByWarehouse === product_entity_1.SplitBatchByWarehouse.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.distributorId != distributorId) {
                    if (splitRule.splitBatchByDistributor === product_entity_1.SplitBatchByDistributor.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.expiryDate != purchaseOrderItem.expiryDate) {
                    if (splitRule.splitBatchByExpiryDate === product_entity_1.SplitBatchByExpiryDate.SplitOnDifferent) {
                        return false;
                    }
                }
                if (batch.costPrice != purchaseOrderItem.costPrice) {
                    if (splitRule.splitBatchByCostPrice === product_entity_1.SplitBatchByCostPrice.SplitOnDifferent) {
                        return false;
                    }
                }
                return true;
            });
            if (batchFind) {
                purchaseOrderItem.batchId = batchFind.id;
            }
        });
        const purchaseOrderItemListNoBatch = purchaseOrderItemList.filter((i) => !i.batchId);
        const batchInsertList = purchaseOrderItemListNoBatch.map((purchaseOrderItem) => {
            const batchInsert = {
                oid,
                distributorId,
                productId: purchaseOrderItem.productId,
                warehouseId: purchaseOrderItem.warehouseId,
                lotNumber: purchaseOrderItem.lotNumber,
                expiryDate: purchaseOrderItem.expiryDate,
                costPrice: purchaseOrderItem.costPrice,
                quantity: 0,
                costAmount: 0,
                registeredAt: Date.now(),
                isActive: 1,
            };
            return batchInsert;
        });
        const batchIdInsertList = await this.batchRepository.insertMany(batchInsertList);
        purchaseOrderItemListNoBatch.forEach((purchaseOrderItem, index) => {
            purchaseOrderItem.batchId = batchIdInsertList[index];
        });
        try {
            await this.purchaseOrderDepositedOperation.update({
                oid,
                purchaseOrderId,
                purchaseOrderUpdateDto: purchaseOrderDto,
                purchaseOrderItemListDto: purchaseOrderItemList,
            });
            return { purchaseOrderId };
        }
        catch (error) {
            throw new common_1.HttpException(error.message, common_1.HttpStatus.BAD_REQUEST);
        }
    }
};
exports.ApiPurchaseOrderReceptionService = ApiPurchaseOrderReceptionService;
exports.ApiPurchaseOrderReceptionService = ApiPurchaseOrderReceptionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _b : Object, typeof (_c = typeof batch_repository_1.BatchRepository !== "undefined" && batch_repository_1.BatchRepository) === "function" ? _c : Object, typeof (_d = typeof operations_1.PurchaseOrderDraftOperation !== "undefined" && operations_1.PurchaseOrderDraftOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.PurchaseOrderDepositedOperation !== "undefined" && operations_1.PurchaseOrderDepositedOperation) === "function" ? _e : Object])
], ApiPurchaseOrderReceptionService);


/***/ }),
/* 682 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(683), exports);
__exportStar(__webpack_require__(684), exports);


/***/ }),
/* 683 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderItemBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class PurchaseOrderItemBody {
}
exports.PurchaseOrderItemBody = PurchaseOrderItemBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'ABC12345' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PurchaseOrderItemBody.prototype, "lotNumber", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1679995369195 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "expiryDate", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderItemBody.prototype, "listPrice", void 0);


/***/ }),
/* 684 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PurchaseOrderUpdateDepositedBody = exports.PurchaseOrderUpsertDraftBody = exports.PurchaseOrderUpsert = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const purchase_order_item_body_1 = __webpack_require__(683);
class PurchaseOrderUpsert {
}
exports.PurchaseOrderUpsert = PurchaseOrderUpsert;
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "startedAt", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 80000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 10 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.DiscountType, example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], PurchaseOrderUpsert.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 50000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "surcharge", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], PurchaseOrderUpsert.prototype, "totalMoney", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], PurchaseOrderUpsert.prototype, "note", void 0);
class PurchaseOrderUpsertDraftBody {
}
exports.PurchaseOrderUpsertDraftBody = PurchaseOrderUpsertDraftBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], PurchaseOrderUpsertDraftBody.prototype, "distributorId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: PurchaseOrderUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => PurchaseOrderUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", PurchaseOrderUpsert)
], PurchaseOrderUpsertDraftBody.prototype, "purchaseOrder", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: purchase_order_item_body_1.PurchaseOrderItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => purchase_order_item_body_1.PurchaseOrderItemBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], PurchaseOrderUpsertDraftBody.prototype, "purchaseOrderItemList", void 0);
class PurchaseOrderUpdateDepositedBody extends PurchaseOrderUpsertDraftBody {
}
exports.PurchaseOrderUpdateDepositedBody = PurchaseOrderUpdateDepositedBody;


/***/ }),
/* 685 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_customer_module_1 = __webpack_require__(686);
const statistic_laboratory_module_1 = __webpack_require__(689);
const statistic_procedure_module_1 = __webpack_require__(694);
const statistic_product_module_1 = __webpack_require__(699);
const statistic_purchase_order_module_1 = __webpack_require__(705);
const statistic_radiology_module_1 = __webpack_require__(711);
const statistic_ticket_module_1 = __webpack_require__(716);
let StatisticModule = class StatisticModule {
};
exports.StatisticModule = StatisticModule;
exports.StatisticModule = StatisticModule = __decorate([
    (0, common_1.Module)({
        imports: [
            statistic_customer_module_1.StatisticCustomerModule,
            statistic_laboratory_module_1.StatisticLaboratoryModule,
            statistic_procedure_module_1.StatisticProcedureModule,
            statistic_product_module_1.StatisticProductModule,
            statistic_purchase_order_module_1.StatisticPurchaseOrderModule,
            statistic_radiology_module_1.StatisticRadiologyModule,
            statistic_ticket_module_1.StatisticTicketModule,
        ],
        controllers: [],
        providers: [],
    })
], StatisticModule);


/***/ }),
/* 686 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticCustomerModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_customer_controller_1 = __webpack_require__(687);
const statistic_customer_service_1 = __webpack_require__(688);
let StatisticCustomerModule = class StatisticCustomerModule {
};
exports.StatisticCustomerModule = StatisticCustomerModule;
exports.StatisticCustomerModule = StatisticCustomerModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_customer_controller_1.StatisticCustomerController],
        providers: [statistic_customer_service_1.StatisticCustomerService],
    })
], StatisticCustomerModule);


/***/ }),
/* 687 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticCustomerController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const statistic_customer_service_1 = __webpack_require__(688);
let StatisticCustomerController = class StatisticCustomerController {
    constructor(statisticProcedureService) {
        this.statisticProcedureService = statisticProcedureService;
    }
    async sumCustomerDebt({ oid }) {
        const data = await this.statisticProcedureService.sumCustomerDebt(oid);
        return { data };
    }
};
exports.StatisticCustomerController = StatisticCustomerController;
__decorate([
    (0, common_1.Get)('sum-customer-debt'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], StatisticCustomerController.prototype, "sumCustomerDebt", null);
exports.StatisticCustomerController = StatisticCustomerController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/customer'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_customer_service_1.StatisticCustomerService !== "undefined" && statistic_customer_service_1.StatisticCustomerService) === "function" ? _a : Object])
], StatisticCustomerController);


/***/ }),
/* 688 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticCustomerService = void 0;
const common_1 = __webpack_require__(3);
const repositories_1 = __webpack_require__(42);
let StatisticCustomerService = class StatisticCustomerService {
    constructor(customerRepository) {
        this.customerRepository = customerRepository;
    }
    async sumCustomerDebt(oid) {
        const { dataRaws } = await this.customerRepository.findAndSelect({
            condition: { oid },
            aggregate: { sumDebt: { SUM: ['debt'] } },
        });
        return { customerSumDebt: Number(dataRaws[0].sumDebt) };
    }
};
exports.StatisticCustomerService = StatisticCustomerService;
exports.StatisticCustomerService = StatisticCustomerService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _a : Object])
], StatisticCustomerService);


/***/ }),
/* 689 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_laboratory_controller_1 = __webpack_require__(690);
const statistic_laboratory_service_1 = __webpack_require__(693);
let StatisticLaboratoryModule = class StatisticLaboratoryModule {
};
exports.StatisticLaboratoryModule = StatisticLaboratoryModule;
exports.StatisticLaboratoryModule = StatisticLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_laboratory_controller_1.StatisticLaboratoryController],
        providers: [statistic_laboratory_service_1.StatisticLaboratoryService],
    })
], StatisticLaboratoryModule);


/***/ }),
/* 690 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(691);
const statistic_laboratory_service_1 = __webpack_require__(693);
let StatisticLaboratoryController = class StatisticLaboratoryController {
    constructor(statisticLaboratoryService) {
        this.statisticLaboratoryService = statisticLaboratoryService;
    }
    async statisticTicketLaboratory({ oid }, query) {
        const data = await this.statisticLaboratoryService.statisticTicketLaboratory(oid, query);
        return { data };
    }
};
exports.StatisticLaboratoryController = StatisticLaboratoryController;
__decorate([
    (0, common_1.Get)('statistic-ticket-laboratory'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StatisticTicketLaboratoryQuery !== "undefined" && request_1.StatisticTicketLaboratoryQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], StatisticLaboratoryController.prototype, "statisticTicketLaboratory", null);
exports.StatisticLaboratoryController = StatisticLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/laboratory'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_laboratory_service_1.StatisticLaboratoryService !== "undefined" && statistic_laboratory_service_1.StatisticLaboratoryService) === "function" ? _a : Object])
], StatisticLaboratoryController);


/***/ }),
/* 691 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(692), exports);


/***/ }),
/* 692 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketLaboratoryQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const request_1 = __webpack_require__(318);
class StatisticTicketLaboratorySortQuery {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketLaboratorySortQuery.prototype, "laboratoryId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketLaboratorySortQuery.prototype, "count", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketLaboratorySortQuery.prototype, "sumCostAmount", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketLaboratorySortQuery.prototype, "sumActualAmount", void 0);
class StatisticTicketLaboratoryQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(request_1.TicketLaboratoryGetQuery, ['filter', 'relation']), dto_1.PaginationQuery) {
}
exports.StatisticTicketLaboratoryQuery = StatisticTicketLaboratoryQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(StatisticTicketLaboratorySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StatisticTicketLaboratorySortQuery)
], StatisticTicketLaboratoryQuery.prototype, "sortStatistic", void 0);


/***/ }),
/* 693 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
let StatisticLaboratoryService = class StatisticLaboratoryService {
    constructor(laboratoryRepository, ticketLaboratoryRepository) {
        this.laboratoryRepository = laboratoryRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
    }
    async statisticTicketLaboratory(oid, query) {
        const { page, limit, filter, sortStatistic } = query;
        const promiseData = await Promise.all([
            this.ticketLaboratoryRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                aggregate: {
                    count: { COUNT: '*' },
                    sumCostAmount: { SUM: ['costPrice'] },
                    sumActualAmount: { SUM: ['actualPrice'] },
                },
            }),
            this.ticketLaboratoryRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                groupBy: ['laboratoryId'],
                select: ['laboratoryId'],
                aggregate: {
                    count: { COUNT: '*' },
                    sumCostAmount: { SUM: ['costPrice'] },
                    sumActualAmount: { SUM: ['actualPrice'] },
                },
                orderBy: sortStatistic || { laboratoryId: 'DESC' },
                limit: limit || 20,
                page: page || 1,
            }),
        ]);
        const statisticTotal = promiseData[0].dataRaws;
        const statisticPagination = promiseData[1].dataRaws;
        let laboratoryMap = {};
        const laboratoryIds = statisticPagination.map((i) => i.laboratoryId);
        if (laboratoryIds.length) {
            const laboratoryList = await this.laboratoryRepository.findManyBy({
                oid,
                id: { IN: laboratoryIds },
                level: 1,
            });
            laboratoryMap = helpers_1.ESArray.arrayToKeyValue(laboratoryList, 'id');
        }
        return {
            statisticTotal: {
                count: Number(statisticTotal[0].count),
                sumActualAmount: Number(statisticTotal[0].sumActualAmount),
                sumCostAmount: Number(statisticTotal[0].sumCostAmount),
            },
            statisticPagination: statisticPagination.map((i) => {
                return {
                    count: Number(i.count),
                    laboratoryId: i.laboratoryId,
                    laboratory: laboratoryMap[i.laboratoryId],
                    sumCostAmount: Number(i.sumCostAmount),
                    sumActualAmount: Number(i.sumActualAmount),
                };
            }),
        };
    }
};
exports.StatisticLaboratoryService = StatisticLaboratoryService;
exports.StatisticLaboratoryService = StatisticLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.LaboratoryRepository !== "undefined" && repositories_1.LaboratoryRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _b : Object])
], StatisticLaboratoryService);


/***/ }),
/* 694 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_procedure_controller_1 = __webpack_require__(695);
const statistic_procedure_service_1 = __webpack_require__(698);
let StatisticProcedureModule = class StatisticProcedureModule {
};
exports.StatisticProcedureModule = StatisticProcedureModule;
exports.StatisticProcedureModule = StatisticProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_procedure_controller_1.StatisticProcedureController],
        providers: [statistic_procedure_service_1.StatisticProcedureService],
    })
], StatisticProcedureModule);


/***/ }),
/* 695 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(696);
const statistic_procedure_service_1 = __webpack_require__(698);
let StatisticProcedureController = class StatisticProcedureController {
    constructor(statisticProcedureService) {
        this.statisticProcedureService = statisticProcedureService;
    }
    async statisticTicketProcedure({ oid }, query) {
        const data = await this.statisticProcedureService.statisticTicketProcedure(oid, query);
        return { data };
    }
};
exports.StatisticProcedureController = StatisticProcedureController;
__decorate([
    (0, common_1.Get)('statistic-ticket-procedure'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StatisticTicketProcedureQuery !== "undefined" && request_1.StatisticTicketProcedureQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], StatisticProcedureController.prototype, "statisticTicketProcedure", null);
exports.StatisticProcedureController = StatisticProcedureController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/procedure'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_procedure_service_1.StatisticProcedureService !== "undefined" && statistic_procedure_service_1.StatisticProcedureService) === "function" ? _a : Object])
], StatisticProcedureController);


/***/ }),
/* 696 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(697), exports);


/***/ }),
/* 697 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketProcedureQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const request_1 = __webpack_require__(321);
class StatisticTicketProcedureSortQuery {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProcedureSortQuery.prototype, "procedureId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProcedureSortQuery.prototype, "count", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProcedureSortQuery.prototype, "sumQuantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProcedureSortQuery.prototype, "sumActualAmount", void 0);
class StatisticTicketProcedureQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(request_1.TicketProcedureGetQuery, ['filter', 'relation']), dto_1.PaginationQuery) {
}
exports.StatisticTicketProcedureQuery = StatisticTicketProcedureQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(StatisticTicketProcedureSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StatisticTicketProcedureSortQuery)
], StatisticTicketProcedureQuery.prototype, "sortStatistic", void 0);


/***/ }),
/* 698 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProcedureService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
let StatisticProcedureService = class StatisticProcedureService {
    constructor(procedureRepository, ticketProcedureRepository) {
        this.procedureRepository = procedureRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
    }
    async statisticTicketProcedure(oid, query) {
        const { page, limit, filter, sortStatistic } = query;
        const promiseData = await Promise.all([
            this.ticketProcedureRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                aggregate: {
                    count: { COUNT: '*' },
                    sumActualAmount: { SUM: [{ MUL: ['quantity', 'actualPrice'] }] },
                },
            }),
            this.ticketProcedureRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                groupBy: ['procedureId'],
                select: ['procedureId'],
                aggregate: {
                    count: { COUNT: '*' },
                    sumQuantity: { SUM: ['quantity'] },
                    sumActualAmount: { SUM: [{ MUL: ['quantity', 'actualPrice'] }] },
                },
                orderBy: sortStatistic || { procedureId: 'DESC' },
                limit: limit || 20,
                page: page || 1,
            }),
        ]);
        const statisticTotal = promiseData[0].dataRaws;
        const statisticPagination = promiseData[1].dataRaws;
        let procedureMap = {};
        const procedureIds = statisticPagination.map((i) => i.procedureId);
        if (procedureIds.length) {
            const procedureList = await this.procedureRepository.findManyBy({
                oid,
                id: { IN: procedureIds },
            });
            procedureMap = helpers_1.ESArray.arrayToKeyValue(procedureList, 'id');
        }
        return {
            statisticTotal: {
                count: Number(statisticTotal[0].count),
                sumActualAmount: Number(statisticTotal[0].sumActualAmount),
            },
            statisticPagination: statisticPagination.map((i) => {
                return {
                    count: Number(i.count),
                    procedureId: i.procedureId,
                    procedure: procedureMap[i.procedureId],
                    sumQuantity: Number(i.sumQuantity),
                    sumActualAmount: Number(i.sumActualAmount),
                };
            }),
        };
    }
};
exports.StatisticProcedureService = StatisticProcedureService;
exports.StatisticProcedureService = StatisticProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProcedureRepository !== "undefined" && repositories_1.ProcedureRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _b : Object])
], StatisticProcedureService);


/***/ }),
/* 699 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_product_controller_1 = __webpack_require__(700);
const statistic_product_service_1 = __webpack_require__(704);
let StatisticProductModule = class StatisticProductModule {
};
exports.StatisticProductModule = StatisticProductModule;
exports.StatisticProductModule = StatisticProductModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_product_controller_1.StatisticProductController],
        providers: [statistic_product_service_1.StatisticProductService],
    })
], StatisticProductModule);


/***/ }),
/* 700 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(701);
const statistic_ticket_product_query_1 = __webpack_require__(702);
const statistic_product_service_1 = __webpack_require__(704);
let StatisticProductController = class StatisticProductController {
    constructor(statisticProductService) {
        this.statisticProductService = statisticProductService;
    }
    async sumWarehouse({ oid }) {
        const data = await this.statisticProductService.sumWarehouse(oid);
        return { data };
    }
    async topProductHighSumRetailMoney({ oid }, query) {
        const data = await this.statisticProductService.topProductHighMoney(oid, query);
        return { data };
    }
    async statisticTicketProduct({ oid }, query) {
        const data = await this.statisticProductService.statisticTicketProduct(oid, query);
        return { data };
    }
};
exports.StatisticProductController = StatisticProductController;
__decorate([
    (0, common_1.Get)('sum-warehouse'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], StatisticProductController.prototype, "sumWarehouse", null);
__decorate([
    (0, common_1.Get)('top-product-high-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _d : Object, typeof (_e = typeof request_1.StatisticProductHighMoneyQuery !== "undefined" && request_1.StatisticProductHighMoneyQuery) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], StatisticProductController.prototype, "topProductHighSumRetailMoney", null);
__decorate([
    (0, common_1.Get)('statistic-ticket-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof statistic_ticket_product_query_1.StatisticTicketProductQuery !== "undefined" && statistic_ticket_product_query_1.StatisticTicketProductQuery) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], StatisticProductController.prototype, "statisticTicketProduct", null);
exports.StatisticProductController = StatisticProductController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/product'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_product_service_1.StatisticProductService !== "undefined" && statistic_product_service_1.StatisticProductService) === "function" ? _a : Object])
], StatisticProductController);


/***/ }),
/* 701 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(702), exports);
__exportStar(__webpack_require__(703), exports);


/***/ }),
/* 702 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketProductQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const request_1 = __webpack_require__(324);
class StatisticTicketProductSortQuery {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "productId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "count", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "sumQuantity", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "sumCostAmount", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "sumActualAmount", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketProductSortQuery.prototype, "sumProfitAmount", void 0);
class StatisticTicketProductQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(request_1.TicketProductGetQuery, ['filter', 'relation']), dto_1.PaginationQuery) {
}
exports.StatisticTicketProductQuery = StatisticTicketProductQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(StatisticTicketProductSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StatisticTicketProductSortQuery)
], StatisticTicketProductQuery.prototype, "sortStatistic", void 0);


/***/ }),
/* 703 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductHighMoneyQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
class StatisticProductHighMoneyQuery extends dto_1.LimitQuery {
}
exports.StatisticProductHighMoneyQuery = StatisticProductHighMoneyQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        enum: ['quantity', 'costAmount', 'retailAmount'],
        example: 'costAmount',
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['quantity', 'costAmount', 'retailAmount']),
    __metadata("design:type", String)
], StatisticProductHighMoneyQuery.prototype, "orderBy", void 0);


/***/ }),
/* 704 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticProductService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const variable_1 = __webpack_require__(21);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
let StatisticProductService = class StatisticProductService {
    constructor(productRepository, ticketProductRepository, statisticProductOperation) {
        this.productRepository = productRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.statisticProductOperation = statisticProductOperation;
    }
    async sumWarehouse(oid) {
        const data = await this.statisticProductOperation.sumWarehouse(oid);
        return data;
    }
    async topProductHighMoney(oid, query) {
        const { orderBy, limit } = query;
        const data = await this.statisticProductOperation.topProductHighMoney({
            oid,
            limit,
            orderBy,
        });
        return data;
    }
    async statisticTicketProduct(oid, query) {
        const { filter, sortStatistic, page, limit } = query;
        const promiseData = await Promise.all([
            this.ticketProductRepository.findAndSelect({
                condition: {
                    oid,
                    deliveryStatus: { IN: [variable_1.DeliveryStatus.Delivered] },
                    quantity: { GT: 0 },
                    createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                },
                groupBy: ['productId'],
                select: ['productId'],
                aggregate: {
                    count: { COUNT: '*' },
                    sumQuantity: { SUM: ['quantity'] },
                    sumCostAmount: { SUM: ['costAmount'] },
                    sumActualAmount: { SUM: [{ MUL: ['quantity', 'actualPrice'] }] },
                    sumProfitAmount: { SUM: [{ SUB: [{ MUL: ['quantity', 'actualPrice'] }, 'costAmount'] }] },
                },
                orderBy: sortStatistic || { productId: 'DESC' },
                limit: limit || 20,
                page: page || 1,
            }),
            this.ticketProductRepository.countGroup({
                condition: {
                    oid,
                    deliveryStatus: { IN: [variable_1.DeliveryStatus.Delivered] },
                    quantity: { GT: 0 },
                    createdAt: filter === null || filter === void 0 ? void 0 : filter.createdAt,
                },
                groupBy: ['productId'],
            }),
        ]);
        const dataRaws = promiseData[0].dataRaws;
        const total = promiseData[1];
        let productMap = {};
        const productIds = dataRaws.map((i) => i.productId);
        if (productIds.length) {
            const productList = await this.productRepository.findManyBy({
                oid,
                id: { IN: productIds },
            });
            productMap = helpers_1.ESArray.arrayToKeyValue(productList, 'id');
        }
        const dataStatistic = dataRaws.map((i) => {
            return {
                count: Number(i.count),
                productId: i.productId,
                product: productMap[i.productId],
                sumQuantity: Number(i.sumQuantity),
                sumCostAmount: Number(i.sumCostAmount),
                sumActualAmount: Number(i.sumActualAmount),
                sumProfitAmount: Number(i.sumProfitAmount),
            };
        });
        return { dataStatistic, total };
    }
};
exports.StatisticProductService = StatisticProductService;
exports.StatisticProductService = StatisticProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.ProductRepository !== "undefined" && repositories_1.ProductRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _b : Object, typeof (_c = typeof operations_1.StatisticProductOperation !== "undefined" && operations_1.StatisticProductOperation) === "function" ? _c : Object])
], StatisticProductService);


/***/ }),
/* 705 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticPurchaseOrderModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_purchase_order_controller_1 = __webpack_require__(706);
const statistic_purchase_order_service_1 = __webpack_require__(710);
let StatisticPurchaseOrderModule = class StatisticPurchaseOrderModule {
};
exports.StatisticPurchaseOrderModule = StatisticPurchaseOrderModule;
exports.StatisticPurchaseOrderModule = StatisticPurchaseOrderModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_purchase_order_controller_1.StatisticPurchaseOrderController],
        providers: [statistic_purchase_order_service_1.StatisticPurchaseOrderService],
    })
], StatisticPurchaseOrderModule);


/***/ }),
/* 706 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticPurchaseOrderController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(707);
const statistic_purchase_order_service_1 = __webpack_require__(710);
let StatisticPurchaseOrderController = class StatisticPurchaseOrderController {
    constructor(statisticPurchaseOrderService) {
        this.statisticPurchaseOrderService = statisticPurchaseOrderService;
    }
    async statisticPurchaseOrder({ oid }, query) {
        const data = await this.statisticPurchaseOrderService.statisticPurchaseOrder(oid, query);
        return { data };
    }
};
exports.StatisticPurchaseOrderController = StatisticPurchaseOrderController;
__decorate([
    (0, common_1.Get)('statistic'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_PURCHASE_ORDER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StatisticTimeQuery !== "undefined" && request_1.StatisticTimeQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], StatisticPurchaseOrderController.prototype, "statisticPurchaseOrder", null);
exports.StatisticPurchaseOrderController = StatisticPurchaseOrderController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/purchase-order'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_purchase_order_service_1.StatisticPurchaseOrderService !== "undefined" && statistic_purchase_order_service_1.StatisticPurchaseOrderService) === "function" ? _a : Object])
], StatisticPurchaseOrderController);


/***/ }),
/* 707 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(708), exports);
__exportStar(__webpack_require__(709), exports);


/***/ }),
/* 708 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticMonthQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class StatisticMonthQuery {
}
exports.StatisticMonthQuery = StatisticMonthQuery;
__decorate([
    (0, swagger_1.ApiProperty)({}),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], StatisticMonthQuery.prototype, "year", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({}),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Min)(1),
    (0, class_validator_1.Max)(12),
    __metadata("design:type", Number)
], StatisticMonthQuery.prototype, "month", void 0);


/***/ }),
/* 709 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTimeQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const query_1 = __webpack_require__(259);
class StatisticTimeQuery extends query_1.LimitQuery {
}
exports.StatisticTimeQuery = StatisticTimeQuery;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], StatisticTimeQuery.prototype, "fromTime", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], StatisticTimeQuery.prototype, "toTime", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['date', 'month']),
    __metadata("design:type", String)
], StatisticTimeQuery.prototype, "timeType", void 0);


/***/ }),
/* 710 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticPurchaseOrderService = void 0;
const common_1 = __webpack_require__(3);
const time_helper_1 = __webpack_require__(149);
const statistic_purchase_order_operation_1 = __webpack_require__(177);
let StatisticPurchaseOrderService = class StatisticPurchaseOrderService {
    constructor(statisticPurchaseOrderOperation) {
        this.statisticPurchaseOrderOperation = statisticPurchaseOrderOperation;
    }
    async statisticPurchaseOrder(oid, query) {
        const { fromTime, toTime, timeType } = query;
        const data = await this.statisticPurchaseOrderOperation.statisticPurchaseOrder({
            oid,
            fromTime,
            toTime,
            timeType,
        });
        const dataMap = {};
        const date = new Date(fromTime.getTime());
        do {
            const currentTime = time_helper_1.ESTimer.info(date, 7);
            let time = '';
            if (timeType === 'date') {
                time = time_helper_1.ESTimer.timeToText(date, 'DD/MM/YYYY', 7);
                date.setDate(date.getDate() + 1);
            }
            if (timeType === 'month') {
                time = time_helper_1.ESTimer.timeToText(date, 'MM/YYYY', 7);
                date.setMonth(date.getMonth() + 1);
            }
            dataMap[time] = {
                oid,
                year: currentTime.year,
                month: currentTime.month + 1,
                date: currentTime.date,
                sumDiscountMoney: 0,
                sumTotalMoney: 0,
                sumDebt: 0,
                countPurchaseOrder: 0,
            };
        } while (date.getTime() <= toTime.getTime());
        data.forEach((i) => {
            const year = i.year;
            const month = `0${i.month}`.slice(-2);
            const date = `0${i.date}`.slice(-2);
            let time = '';
            if (timeType === 'date')
                time = `${date}/${month}/${year}`;
            if (timeType === 'month')
                time = `${month}/${year}`;
            dataMap[time] = i;
        });
        return dataMap;
    }
};
exports.StatisticPurchaseOrderService = StatisticPurchaseOrderService;
exports.StatisticPurchaseOrderService = StatisticPurchaseOrderService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_purchase_order_operation_1.StatisticPurchaseOrderOperation !== "undefined" && statistic_purchase_order_operation_1.StatisticPurchaseOrderOperation) === "function" ? _a : Object])
], StatisticPurchaseOrderService);


/***/ }),
/* 711 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_radiology_controller_1 = __webpack_require__(712);
const statistic_radiology_service_1 = __webpack_require__(715);
let StatisticRadiologyModule = class StatisticRadiologyModule {
};
exports.StatisticRadiologyModule = StatisticRadiologyModule;
exports.StatisticRadiologyModule = StatisticRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_radiology_controller_1.StatisticRadiologyController],
        providers: [statistic_radiology_service_1.StatisticRadiologyService],
    })
], StatisticRadiologyModule);


/***/ }),
/* 712 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(713);
const statistic_radiology_service_1 = __webpack_require__(715);
let StatisticRadiologyController = class StatisticRadiologyController {
    constructor(statisticRadiologyService) {
        this.statisticRadiologyService = statisticRadiologyService;
    }
    async statisticTicketRadiology({ oid }, query) {
        const data = await this.statisticRadiologyService.statisticTicketRadiology(oid, query);
        return { data };
    }
};
exports.StatisticRadiologyController = StatisticRadiologyController;
__decorate([
    (0, common_1.Get)('statistic-ticket-radiology'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StatisticTicketRadiologyQuery !== "undefined" && request_1.StatisticTicketRadiologyQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], StatisticRadiologyController.prototype, "statisticTicketRadiology", null);
exports.StatisticRadiologyController = StatisticRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/radiology'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_radiology_service_1.StatisticRadiologyService !== "undefined" && statistic_radiology_service_1.StatisticRadiologyService) === "function" ? _a : Object])
], StatisticRadiologyController);


/***/ }),
/* 713 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(714), exports);


/***/ }),
/* 714 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketRadiologyQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const ticket_radiology_query_1 = __webpack_require__(329);
class StatisticTicketRadiologySortQuery {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketRadiologySortQuery.prototype, "radiologyId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketRadiologySortQuery.prototype, "count", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketRadiologySortQuery.prototype, "sumCostAmount", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketRadiologySortQuery.prototype, "sumActualAmount", void 0);
class StatisticTicketRadiologyQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(ticket_radiology_query_1.TicketRadiologyGetQuery, ['filter', 'relation']), dto_1.PaginationQuery) {
}
exports.StatisticTicketRadiologyQuery = StatisticTicketRadiologyQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(StatisticTicketRadiologySortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StatisticTicketRadiologySortQuery)
], StatisticTicketRadiologyQuery.prototype, "sortStatistic", void 0);


/***/ }),
/* 715 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
let StatisticRadiologyService = class StatisticRadiologyService {
    constructor(radiologyRepository, ticketRadiologyRepository) {
        this.radiologyRepository = radiologyRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
    }
    async statisticTicketRadiology(oid, query) {
        const { page, limit, filter, sortStatistic } = query;
        const promiseData = await Promise.all([
            this.ticketRadiologyRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                aggregate: {
                    count: { COUNT: '*' },
                    sumCostAmount: { SUM: ['costPrice'] },
                    sumActualAmount: { SUM: ['actualPrice'] },
                },
            }),
            this.ticketRadiologyRepository.findAndSelect({
                condition: {
                    oid,
                    createdAt: filter.createdAt,
                    status: filter.status,
                },
                groupBy: ['radiologyId'],
                select: ['radiologyId'],
                aggregate: {
                    count: { COUNT: '*' },
                    sumCostAmount: { SUM: ['costPrice'] },
                    sumActualAmount: { SUM: ['actualPrice'] },
                },
                orderBy: sortStatistic || { radiologyId: 'DESC' },
                limit: limit || 20,
                page: page || 1,
            }),
        ]);
        const statisticTotal = promiseData[0].dataRaws;
        const statisticPagination = promiseData[1].dataRaws;
        let radiologyMap = {};
        const radiologyIds = statisticPagination.map((i) => i.radiologyId);
        if (radiologyIds.length) {
            const radiologyList = await this.radiologyRepository.findManyBy({
                oid,
                id: { IN: radiologyIds },
            });
            radiologyMap = helpers_1.ESArray.arrayToKeyValue(radiologyList, 'id');
        }
        return {
            statisticTotal: {
                count: Number(statisticTotal[0].count),
                sumActualAmount: Number(statisticTotal[0].sumActualAmount),
                sumCostAmount: Number(statisticTotal[0].sumCostAmount),
            },
            statisticPagination: statisticPagination.map((i) => {
                return {
                    count: Number(i.count),
                    radiologyId: i.radiologyId,
                    radiology: radiologyMap[i.radiologyId],
                    sumCostAmount: Number(i.sumCostAmount),
                    sumActualAmount: Number(i.sumActualAmount),
                };
            }),
        };
    }
};
exports.StatisticRadiologyService = StatisticRadiologyService;
exports.StatisticRadiologyService = StatisticRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof repositories_1.RadiologyRepository !== "undefined" && repositories_1.RadiologyRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _b : Object])
], StatisticRadiologyService);


/***/ }),
/* 716 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketModule = void 0;
const common_1 = __webpack_require__(3);
const statistic_ticket_controller_1 = __webpack_require__(717);
const statistic_ticket_service_1 = __webpack_require__(721);
let StatisticTicketModule = class StatisticTicketModule {
};
exports.StatisticTicketModule = StatisticTicketModule;
exports.StatisticTicketModule = StatisticTicketModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [statistic_ticket_controller_1.StatisticTicketController],
        providers: [statistic_ticket_service_1.StatisticTicketService],
    })
], StatisticTicketModule);


/***/ }),
/* 717 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(718);
const statistic_ticket_query_1 = __webpack_require__(720);
const statistic_ticket_service_1 = __webpack_require__(721);
let StatisticTicketController = class StatisticTicketController {
    constructor(statisticTicketService) {
        this.statisticTicketService = statisticTicketService;
    }
    async groupByCustomer({ oid }, query) {
        const data = await this.statisticTicketService.groupByCustomer(oid, query);
        return { data };
    }
    async statistic({ oid }, query) {
        const data = await this.statisticTicketService.statistic(oid, query);
        return { data };
    }
};
exports.StatisticTicketController = StatisticTicketController;
__decorate([
    (0, common_1.Get)('group-by-customer'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_CUSTOMER),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.StatisticTicketQuery !== "undefined" && request_1.StatisticTicketQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], StatisticTicketController.prototype, "groupByCustomer", null);
__decorate([
    (0, common_1.Get)('statistic'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.STATISTIC_TICKET),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof statistic_ticket_query_1.StatisticTicketQueryTime !== "undefined" && statistic_ticket_query_1.StatisticTicketQueryTime) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], StatisticTicketController.prototype, "statistic", null);
exports.StatisticTicketController = StatisticTicketController = __decorate([
    (0, swagger_1.ApiTags)('Statistic'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('statistic/ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof statistic_ticket_service_1.StatisticTicketService !== "undefined" && statistic_ticket_service_1.StatisticTicketService) === "function" ? _a : Object])
], StatisticTicketController);


/***/ }),
/* 718 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(719), exports);


/***/ }),
/* 719 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketQuery = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const dto_1 = __webpack_require__(306);
const request_1 = __webpack_require__(304);
class StatisticTicketSortQuery {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "countTicket", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "customerId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumItemsCostAmount", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumSurcharge", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumExpense", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumTotalMoney", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumDebt", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['ASC', 'DESC']),
    __metadata("design:type", String)
], StatisticTicketSortQuery.prototype, "sumProfit", void 0);
class StatisticTicketQuery extends (0, swagger_1.IntersectionType)((0, swagger_1.PickType)(request_1.TicketGetQuery, ['filter', 'relation']), dto_1.PaginationQuery) {
}
exports.StatisticTicketQuery = StatisticTicketQuery;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: String }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            if (!value)
                return undefined;
            const plain = JSON.parse(value);
            return (0, class_transformer_1.plainToInstance)(StatisticTicketSortQuery, plain, {
                exposeUnsetFields: false,
                excludeExtraneousValues: false,
            });
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => value }),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", StatisticTicketSortQuery)
], StatisticTicketQuery.prototype, "sortStatistic", void 0);


/***/ }),
/* 720 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketQueryTime = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const request_1 = __webpack_require__(304);
class StatisticTicketQueryTime extends (0, swagger_1.PickType)(request_1.TicketGetQuery, ['filter']) {
}
exports.StatisticTicketQueryTime = StatisticTicketQueryTime;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsIn)(['date', 'month']),
    __metadata("design:type", String)
], StatisticTicketQueryTime.prototype, "groupTimeType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], StatisticTicketQueryTime.prototype, "fromTime", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Date),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsDate)(),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], StatisticTicketQueryTime.prototype, "toTime", void 0);


/***/ }),
/* 721 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.StatisticTicketService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
let StatisticTicketService = class StatisticTicketService {
    constructor(statisticTicketOperation, ticketRepository, customerRepository) {
        this.statisticTicketOperation = statisticTicketOperation;
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
    }
    async groupByCustomer(oid, query) {
        var _a, _b;
        const { dataRaws } = await this.ticketRepository.findAndSelect({
            condition: {
                oid,
                startedAt: (_a = query === null || query === void 0 ? void 0 : query.filter) === null || _a === void 0 ? void 0 : _a.startedAt,
                status: (_b = query === null || query === void 0 ? void 0 : query.filter) === null || _b === void 0 ? void 0 : _b.status,
            },
            groupBy: ['customerId'],
            select: ['customerId'],
            aggregate: {
                countTicket: { COUNT: '*' },
                sumItemsCostAmount: { SUM: ['itemsCostAmount'] },
                sumExpense: { SUM: ['expense'] },
                sumSurcharge: { SUM: ['surcharge'] },
                sumTotalMoney: { SUM: ['totalMoney'] },
                sumDebt: { SUM: ['debt'] },
                sumProfit: { SUM: ['profit'] },
            },
            limit: query.limit || 20,
            orderBy: query.sortStatistic || { customerId: 'DESC' },
            page: query.page || 1,
        });
        const customerIds = dataRaws.map((i) => i.customerId);
        const customerList = await this.customerRepository.findManyBy({
            oid,
            id: { IN: customerIds },
        });
        const customerMap = helpers_1.ESArray.arrayToKeyValue(customerList, 'id');
        const dataStatistic = dataRaws.map((i) => ({
            customerId: i.customerId,
            sumItemsCostAmount: i.sumItemsCostAmount,
            sumExpense: i.sumExpense,
            sumSurcharge: i.sumSurcharge,
            sumTotalMoney: i.sumTotalMoney,
            sumProfit: i.sumProfit,
            sumDebt: i.sumDebt,
            countTicket: i.countTicket,
            customer: customerMap[i.customerId],
        }));
        return { dataStatistic };
    }
    async statistic(oid, query) {
        const { filter, groupTimeType, fromTime, toTime } = query;
        const data = await this.statisticTicketOperation.statistic({
            condition: {
                oid,
                registeredAt: {
                    GTE: fromTime.getTime(),
                    LTE: toTime.getTime(),
                },
                roomId: filter.roomId,
                status: filter.status,
            },
            groupTimeType,
        });
        const dataMap = {};
        const date = new Date(fromTime.getTime());
        do {
            const currentTime = helpers_1.ESTimer.info(date, 7);
            let time = '';
            if (groupTimeType === 'date') {
                time = helpers_1.ESTimer.timeToText(date, 'DD/MM/YYYY', 7);
                date.setDate(date.getDate() + 1);
            }
            if (groupTimeType === 'month') {
                time = helpers_1.ESTimer.timeToText(date, 'MM/YYYY', 7);
                date.setMonth(date.getMonth() + 1);
            }
            dataMap[time] = {
                oid,
                year: currentTime.year,
                month: currentTime.month + 1,
                date: currentTime.date,
                sumItemsCostAmount: 0,
                sumProcedureMoney: 0,
                sumProductMoney: 0,
                sumRadiologyMoney: 0,
                sumLaboratoryMoney: 0,
                sumSurcharge: 0,
                sumExpense: 0,
                sumDiscountMoney: 0,
                sumTotalMoney: 0,
                sumProfit: 0,
                sumDebt: 0,
                countTicket: 0,
            };
        } while (date.getTime() <= toTime.getTime());
        data.forEach((i) => {
            const year = i.year;
            const month = `0${i.month}`.slice(-2);
            const date = `0${i.date}`.slice(-2);
            let time = '';
            if (groupTimeType === 'date')
                time = `${date}/${month}/${year}`;
            if (groupTimeType === 'month')
                time = `${month}/${year}`;
            dataMap[time] = Object.assign(Object.assign({}, i), { oid });
        });
        return dataMap;
    }
};
exports.StatisticTicketService = StatisticTicketService;
exports.StatisticTicketService = StatisticTicketService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof operations_1.StatisticTicketOperation !== "undefined" && operations_1.StatisticTicketOperation) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _c : Object])
], StatisticTicketService);


/***/ }),
/* 722 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_action_module_1 = __webpack_require__(723);
const ticket_change_attribute_module_1 = __webpack_require__(731);
const ticket_change_laboratory_module_1 = __webpack_require__(737);
const ticket_change_procedure_module_1 = __webpack_require__(755);
const ticket_change_product_module_1 = __webpack_require__(764);
const ticket_change_radiology_module_1 = __webpack_require__(775);
const ticket_change_user_module_1 = __webpack_require__(738);
const ticket_money_module_1 = __webpack_require__(785);
const ticket_order_module_1 = __webpack_require__(793);
const ticket_query_module_1 = __webpack_require__(802);
const ticket_reception_module_1 = __webpack_require__(805);
let TicketModule = class TicketModule {
};
exports.TicketModule = TicketModule;
exports.TicketModule = TicketModule = __decorate([
    (0, common_1.Module)({
        imports: [
            ticket_query_module_1.TicketQueryModule,
            ticket_change_user_module_1.TicketChangeUserModule,
            ticket_reception_module_1.TicketReceptionModule,
            ticket_change_attribute_module_1.TicketChangeAttributeModule,
            ticket_money_module_1.TicketMoneyModule,
            ticket_action_module_1.TicketActionModule,
            ticket_change_procedure_module_1.TicketChangeProcedureModule,
            ticket_change_product_module_1.TicketChangeProductModule,
            ticket_change_radiology_module_1.TicketChangeRadiologyModule,
            ticket_change_laboratory_module_1.TicketChangeLaboratoryModule,
            ticket_order_module_1.TicketOrderModule,
        ],
        controllers: [],
        providers: [],
    })
], TicketModule);


/***/ }),
/* 723 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketActionModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_action_controller_1 = __webpack_require__(724);
const ticket_action_service_1 = __webpack_require__(730);
let TicketActionModule = class TicketActionModule {
};
exports.TicketActionModule = TicketActionModule;
exports.TicketActionModule = TicketActionModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [ticket_action_controller_1.TicketActionController],
        providers: [ticket_action_service_1.TicketActionService],
    })
], TicketActionModule);


/***/ }),
/* 724 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketActionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(725);
const ticket_change_all_money_body_1 = __webpack_require__(726);
const ticket_action_service_1 = __webpack_require__(730);
let TicketActionController = class TicketActionController {
    constructor(ticketActionService) {
        this.ticketActionService = ticketActionService;
    }
    async startExecuting({ oid }, { ticketId }) {
        const data = await this.ticketActionService.startExecuting({ oid, ticketId });
        return { data };
    }
    async changeDiscount({ oid }, { ticketId }, body) {
        const data = await this.ticketActionService.changeDiscount({ oid, ticketId, body });
        return { data };
    }
    async changeAllMoney({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketActionService.changeAllMoney({ oid, body, ticketId });
        return { data };
    }
    async sendProduct({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketActionService.sendProduct({
            oid,
            ticketId,
            sendAll: false,
            ticketProductIdList: body.ticketProductIdList,
        });
        return { data };
    }
    async returnProduct({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketActionService.returnProduct({
            oid,
            ticketId,
            returnAll: false,
            returnList: body.returnList,
        });
        return { data };
    }
    async close({ oid, uid }, { ticketId }) {
        const data = await this.ticketActionService.close({ oid, userId: uid, ticketId });
        return { data };
    }
    async reopen({ oid, uid }, { ticketId }) {
        const data = await this.ticketActionService.reopen({ oid, userId: uid, ticketId });
        return { data };
    }
    async terminate({ oid, uid }, { ticketId }) {
        const data = await this.ticketActionService.terminate({ oid, userId: uid, ticketId });
        return { data };
    }
    async destroy({ oid }, { ticketId }) {
        const data = await this.ticketActionService.destroy({
            oid,
            ticketId,
        });
        return { data };
    }
};
exports.TicketActionController = TicketActionController;
__decorate([
    (0, common_1.Post)('/:ticketId/start-executing'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_START_EXECUTING),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], TicketActionController.prototype, "startExecuting", null);
__decorate([
    (0, common_1.Post)('/:ticketId/change-discount'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_DISCOUNT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketClinicChangeDiscountBody !== "undefined" && request_2.TicketClinicChangeDiscountBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketActionController.prototype, "changeDiscount", null);
__decorate([
    (0, common_1.Post)('/:ticketId/change-all-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_DISCOUNT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _k : Object, typeof (_l = typeof ticket_change_all_money_body_1.TicketChangeAllMoneyBody !== "undefined" && ticket_change_all_money_body_1.TicketChangeAllMoneyBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], TicketActionController.prototype, "changeAllMoney", null);
__decorate([
    (0, common_1.Post)('/:ticketId/send-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _p : Object, typeof (_q = typeof request_2.TicketSendProductListBody !== "undefined" && request_2.TicketSendProductListBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], TicketActionController.prototype, "sendProduct", null);
__decorate([
    (0, common_1.Post)('/:ticketId/return-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_RETURN_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _t : Object, typeof (_u = typeof request_2.TicketReturnProductListBody !== "undefined" && request_2.TicketReturnProductListBody) === "function" ? _u : Object]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], TicketActionController.prototype, "returnProduct", null);
__decorate([
    (0, common_1.Post)('/:ticketId/close'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_w = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _w : Object, typeof (_x = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _x : Object]),
    __metadata("design:returntype", typeof (_y = typeof Promise !== "undefined" && Promise) === "function" ? _y : Object)
], TicketActionController.prototype, "close", null);
__decorate([
    (0, common_1.Post)('/:ticketId/reopen'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_REOPEN),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_z = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _z : Object, typeof (_0 = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _0 : Object]),
    __metadata("design:returntype", typeof (_1 = typeof Promise !== "undefined" && Promise) === "function" ? _1 : Object)
], TicketActionController.prototype, "reopen", null);
__decorate([
    (0, common_1.Post)('/:ticketId/terminate'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_TERMINATE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_2 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _2 : Object, typeof (_3 = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _3 : Object]),
    __metadata("design:returntype", typeof (_4 = typeof Promise !== "undefined" && Promise) === "function" ? _4 : Object)
], TicketActionController.prototype, "terminate", null);
__decorate([
    (0, common_1.Delete)('/:ticketId/destroy'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_5 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _5 : Object, typeof (_6 = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _6 : Object]),
    __metadata("design:returntype", typeof (_7 = typeof Promise !== "undefined" && Promise) === "function" ? _7 : Object)
], TicketActionController.prototype, "destroy", null);
exports.TicketActionController = TicketActionController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_action_service_1.TicketActionService !== "undefined" && ticket_action_service_1.TicketActionService) === "function" ? _a : Object])
], TicketActionController);


/***/ }),
/* 725 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(726), exports);
__exportStar(__webpack_require__(727), exports);
__exportStar(__webpack_require__(728), exports);
__exportStar(__webpack_require__(729), exports);


/***/ }),
/* 726 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeAllMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const helpers_1 = __webpack_require__(182);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketItemChangeMoney {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketItemChangeMoney.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 3 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketItemChangeMoney.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketItemChangeMoney.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketItemChangeMoney.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, helpers_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketItemChangeMoney.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketItemChangeMoney.prototype, "actualPrice", void 0);
class TicketChangeAllMoneyBody {
}
exports.TicketChangeAllMoneyBody = TicketChangeAllMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemChangeMoney, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketItemChangeMoney),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketChangeAllMoneyBody.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemChangeMoney, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketItemChangeMoney),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketChangeAllMoneyBody.prototype, "ticketProductList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemChangeMoney, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketItemChangeMoney),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketChangeAllMoneyBody.prototype, "ticketLaboratoryList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemChangeMoney, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketItemChangeMoney),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketChangeAllMoneyBody.prototype, "ticketRadiologyList", void 0);


/***/ }),
/* 727 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketClinicChangeDiscountBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketClinicChangeDiscountBody {
}
exports.TicketClinicChangeDiscountBody = TicketClinicChangeDiscountBody;
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketClinicChangeDiscountBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketClinicChangeDiscountBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketClinicChangeDiscountBody.prototype, "discountPercent", void 0);


/***/ }),
/* 728 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReturnProductListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class ReturnListBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], ReturnListBody.prototype, "ticketBatchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 3 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], ReturnListBody.prototype, "quantityReturn", void 0);
class TicketReturnProductListBody {
}
exports.TicketReturnProductListBody = TicketReturnProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: ReturnListBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ReturnListBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReturnProductListBody.prototype, "returnList", void 0);


/***/ }),
/* 729 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketSendProductAndPaymentBody = exports.TicketPaymentMoneyBody = exports.TicketSendProductListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketSendProductListBody {
}
exports.TicketSendProductListBody = TicketSendProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: [2, 3, 4], isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], TicketSendProductListBody.prototype, "ticketProductIdList", void 0);
class TicketPaymentMoneyBody {
}
exports.TicketPaymentMoneyBody = TicketPaymentMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPaymentMoneyBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPaymentMoneyBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 2 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketPaymentMoneyBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1200000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketPaymentMoneyBody.prototype, "note", void 0);
class TicketSendProductAndPaymentBody extends (0, swagger_1.IntersectionType)(TicketPaymentMoneyBody, TicketSendProductListBody) {
}
exports.TicketSendProductAndPaymentBody = TicketSendProductAndPaymentBody;


/***/ }),
/* 730 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketActionService = void 0;
const common_1 = __webpack_require__(3);
const cache_data_service_1 = __webpack_require__(40);
const exception_filter_1 = __webpack_require__(9);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const ticket_product_entity_1 = __webpack_require__(71);
const ticket_radiology_entity_1 = __webpack_require__(72);
const ticket_entity_1 = __webpack_require__(59);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const image_manager_service_1 = __webpack_require__(255);
const socket_emit_service_1 = __webpack_require__(340);
let TicketActionService = class TicketActionService {
    constructor(socketEmitService, cacheDataService, imageManagerService, ticketRepository, ticketReopenOperation, ticketSendProductOperation, ticketReturnProductOperation, ticketChangeAllMoneyOperator, ticketCloseOperation, ticketChangeDiscountOperation, customerRefundMoneyOperation) {
        this.socketEmitService = socketEmitService;
        this.cacheDataService = cacheDataService;
        this.imageManagerService = imageManagerService;
        this.ticketRepository = ticketRepository;
        this.ticketReopenOperation = ticketReopenOperation;
        this.ticketSendProductOperation = ticketSendProductOperation;
        this.ticketReturnProductOperation = ticketReturnProductOperation;
        this.ticketChangeAllMoneyOperator = ticketChangeAllMoneyOperator;
        this.ticketCloseOperation = ticketCloseOperation;
        this.ticketChangeDiscountOperation = ticketChangeDiscountOperation;
        this.customerRefundMoneyOperation = customerRefundMoneyOperation;
    }
    async startExecuting(options) {
        const { oid, ticketId } = options;
        const ticketModified = await this.ticketRepository.updateOneAndReturnEntity({
            oid,
            id: ticketId,
            status: { IN: [ticket_entity_1.TicketStatus.Schedule, ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Deposited] },
        }, {
            status: ticket_entity_1.TicketStatus.Executing,
            startedAt: Date.now(),
        });
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: ticketModified });
        return { ticketModified };
    }
    async changeDiscount(params) {
        const { oid, ticketId, body } = params;
        const { ticket } = await this.ticketChangeDiscountOperation.changeDiscount({
            oid,
            ticketId,
            discountType: body.discountType,
            discountMoney: body.discountMoney,
            discountPercent: body.discountPercent,
        });
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        return { ticket };
    }
    async changeAllMoney(params) {
        const { oid, ticketId, body } = params;
        const time = Date.now();
        const { ticket } = await this.ticketChangeAllMoneyOperator.changeItemMoney({
            oid,
            ticketUpdate: { id: ticketId },
            ticketProductUpdate: body.ticketProductList,
            ticketProcedureUpdate: body.ticketProcedureList,
            ticketLaboratoryUpdate: body.ticketLaboratoryList,
            ticketRadiologyUpdate: body.ticketRadiologyList,
        });
        this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticket] });
        return { ticket };
    }
    async sendProduct(params) {
        const { oid, ticketId, sendAll, ticketProductIdList, options } = params;
        const time = Date.now();
        const allowNegativeQuantity = await this.cacheDataService.getSettingAllowNegativeQuantity(oid);
        const sendProductResult = await this.ticketSendProductOperation.sendProduct({
            oid,
            ticketId,
            ticketProductIdList,
            time,
            sendAll,
            allowNegativeQuantity,
        });
        const { ticketModified, ticketProductModifiedAll } = sendProductResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, {
                ticketUpsertedList: [ticketModified],
            });
        }
        if (sendProductResult.productModifiedList) {
            this.socketEmitService.productListChange(oid, {
                productUpsertedList: sendProductResult.productModifiedList,
            });
            this.socketEmitService.batchListChange(oid, {
                batchUpsertedList: sendProductResult.batchModifiedList,
            });
        }
        if (ticketProductModifiedAll) {
            this.socketEmitService.socketTicketProductChange(oid, {
                ticketId,
                ticketProductUpsertList: ticketProductModifiedAll.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Product;
                }),
            });
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductUpsertList: ticketProductModifiedAll.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Consumable;
                }),
            });
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductUpsertList: ticketProductModifiedAll.filter((i) => {
                    return i.type === ticket_product_entity_1.TicketProductType.Prescription;
                }),
            });
        }
        return {
            ticketModified,
            ticketProductModifiedAll: ticketProductModifiedAll,
        };
    }
    async returnProduct(params) {
        const { oid, ticketId, returnAll, returnList } = params;
        const returnProductResult = await this.ticketReturnProductOperation.returnProduct({
            oid,
            ticketId,
            time: Date.now(),
            returnList,
            returnAll,
        });
        const ticketProductModifiedAll = returnProductResult.ticketProductModifiedAll;
        this.socketEmitService.productListChange(oid, {
            productUpsertedList: returnProductResult.productModifiedList || [],
        });
        this.socketEmitService.batchListChange(oid, {
            batchUpsertedList: returnProductResult.batchModifiedList || [],
        });
        this.socketEmitService.socketTicketChange(oid, {
            type: 'UPDATE',
            ticket: returnProductResult.ticket,
        });
        this.socketEmitService.socketTicketUserListChange(oid, {
            ticketId,
            ticketUserUpsertList: returnProductResult.ticketUserModifiedList || [],
        });
        this.socketEmitService.socketTicketProductChange(oid, {
            ticketId,
            ticketProductReplaceList: ticketProductModifiedAll.filter((i) => {
                return i.type === ticket_product_entity_1.TicketProductType.Product;
            }),
        });
        this.socketEmitService.socketTicketConsumableChange(oid, {
            ticketId,
            ticketProductReplaceList: ticketProductModifiedAll.filter((i) => {
                return i.type === ticket_product_entity_1.TicketProductType.Consumable;
            }),
        });
        this.socketEmitService.socketTicketPrescriptionChange(oid, {
            ticketId,
            ticketProductReplaceList: ticketProductModifiedAll.filter((i) => {
                return i.type === ticket_product_entity_1.TicketProductType.Prescription;
            }),
        });
        return { ticketModified: returnProductResult.ticket, ticketProductModifiedAll };
    }
    async close(params) {
        var _a, _b;
        const { oid, userId, ticketId, options } = params;
        const closeResult = await this.ticketCloseOperation.startClose({
            oid,
            ticketId,
            time: Date.now(),
            userId,
            note: '',
        });
        const { ticketModified, customerModified, paymentCreatedList } = closeResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        if (customerModified && !(options === null || options === void 0 ? void 0 : options.noEmitCustomer)) {
            this.socketEmitService.customerUpsert(oid, { customer: customerModified });
        }
        if (((_a = closeResult.ticketUserDeletedList) === null || _a === void 0 ? void 0 : _a.length) || ((_b = closeResult.ticketUserModifiedList) === null || _b === void 0 ? void 0 : _b.length)) {
            this.socketEmitService.socketTicketUserListChange(oid, {
                ticketId,
                ticketUserDestroyList: closeResult.ticketUserDeletedList,
                ticketUserUpsertList: [...closeResult.ticketUserModifiedList],
            });
        }
        return { ticketModified, customerModified, paymentCreatedList };
    }
    async reopen(params) {
        const { oid, userId, ticketId } = params;
        const reopenResult = await this.ticketReopenOperation.reopen({
            oid,
            userId,
            ticketId,
            time: Date.now(),
            note: '',
        });
        const { ticketModified, customerModified, paymentCreatedList } = reopenResult;
        this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        if (customerModified) {
            this.socketEmitService.customerUpsert(oid, { customer: customerModified });
        }
        return { ticketModified, customerModified, paymentCreatedList };
    }
    async terminate(options) {
        const { oid, userId, ticketId } = options;
        const time = Date.now();
        let ticketModified = await this.ticketRepository.findOneBy({ oid, id: ticketId });
        const paymentCreatedList = [];
        let ticketProductModifiedAll;
        let customerModified;
        if ([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed].includes(ticketModified.status)) {
            const reopenResult = await this.ticketReopenOperation.reopen({
                oid,
                userId,
                ticketId,
                time,
                note: 'Hủy phiếu',
            });
            if (reopenResult.customerModified) {
                customerModified = reopenResult.customerModified;
            }
            paymentCreatedList.push(...reopenResult.paymentCreatedList);
            ticketModified = reopenResult.ticketModified;
        }
        if (ticketModified.paid > 0) {
            const refundOverpaidResult = await this.customerRefundMoneyOperation.startRefundMoney({
                oid,
                customerId: ticketModified.customerId,
                cashierId: userId,
                ticketId,
                refundAmount: ticketModified.paid,
                time,
                paymentMethodId: 0,
                note: 'Hủy phiếu',
            });
            customerModified = refundOverpaidResult.customer;
            paymentCreatedList.push(refundOverpaidResult.paymentCreated);
            ticketModified = refundOverpaidResult.ticketModified;
        }
        if (ticketModified.deliveryStatus === variable_1.DeliveryStatus.Delivered) {
            const returnProductResult = await this.returnProduct({
                oid,
                ticketId,
                returnAll: true,
                returnList: [],
            });
            ticketModified = returnProductResult.ticketModified;
            ticketProductModifiedAll = returnProductResult.ticketProductModifiedAll;
        }
        ticketModified = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, {
            status: ticket_entity_1.TicketStatus.Cancelled,
            discountMoney: ticketModified.discountMoney - ticketModified.discountMoney,
            discountPercent: 0,
            profit: 0,
            totalMoney: ticketModified.totalMoney + ticketModified.discountMoney,
            debt: ticketModified.debt + ticketModified.discountMoney,
        });
        if (customerModified) {
            this.socketEmitService.customerUpsert(oid, { customer: customerModified });
        }
        return { ticketModified, customerModified, paymentCreatedList, ticketProductModifiedAll };
    }
    async destroy(params) {
        const { oid, ticketId } = params;
        const ticket = await this.ticketRepository.findOne({
            relationLoadStrategy: 'query',
            relation: { ticketProductList: {}, ticketRadiologyList: {} },
            condition: {
                id: ticketId,
                oid,
            },
        });
        if (!ticket) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (ticket.paid) {
            throw new error_1.BusinessError('Không thể hủy phiếu đã thanh toán, cần hoàn trả thanh toán trước');
        }
        if (ticket.ticketProductList.find((i) => i.deliveryStatus === variable_1.DeliveryStatus.Delivered)) {
            throw new error_1.BusinessError('Không thể hủy phiếu đã gửi hàng, cần hoàn trả hàng trước khi hủy');
        }
        if (ticket.ticketRadiologyList.find((i) => i.status === ticket_radiology_entity_1.TicketRadiologyStatus.Completed)) {
            throw new error_1.BusinessError('Không thể hủy phiếu CĐHA đã có kết quả, cần hủy kết quả trước');
        }
        await this.imageManagerService.removeImageList({
            oid,
            idRemoveList: JSON.parse(ticket.imageIds || '[]'),
        });
        await this.ticketRepository.update({ oid, id: ticketId }, { status: ticket_entity_1.TicketStatus.Cancelled });
        await this.ticketRepository.destroy({ oid, ticketId });
        this.socketEmitService.socketTicketChange(oid, { type: 'DESTROY', ticket });
        return { ticketId };
    }
};
exports.TicketActionService = TicketActionService;
exports.TicketActionService = TicketActionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _b : Object, typeof (_c = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketReopenOperation !== "undefined" && operations_1.TicketReopenOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketSendProductOperation !== "undefined" && operations_1.TicketSendProductOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketReturnProductOperation !== "undefined" && operations_1.TicketReturnProductOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketChangeAllMoneyOperator !== "undefined" && operations_1.TicketChangeAllMoneyOperator) === "function" ? _h : Object, typeof (_j = typeof operations_1.TicketCloseOperation !== "undefined" && operations_1.TicketCloseOperation) === "function" ? _j : Object, typeof (_k = typeof operations_1.TicketChangeDiscountOperation !== "undefined" && operations_1.TicketChangeDiscountOperation) === "function" ? _k : Object, typeof (_l = typeof operations_1.CustomerRefundMoneyOperation !== "undefined" && operations_1.CustomerRefundMoneyOperation) === "function" ? _l : Object])
], TicketActionService);


/***/ }),
/* 731 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeAttributeModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_change_attribute_controller_1 = __webpack_require__(732);
const ticket_change_attribute_service_1 = __webpack_require__(736);
let TicketChangeAttributeModule = class TicketChangeAttributeModule {
};
exports.TicketChangeAttributeModule = TicketChangeAttributeModule;
exports.TicketChangeAttributeModule = TicketChangeAttributeModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [ticket_change_attribute_controller_1.TicketChangeAttributeController],
        providers: [ticket_change_attribute_service_1.TicketChangeAttributeService],
    })
], TicketChangeAttributeModule);


/***/ }),
/* 732 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeAttributeController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(733);
const ticket_change_attribute_service_1 = __webpack_require__(736);
let TicketChangeAttributeController = class TicketChangeAttributeController {
    constructor(ticketChangeAttributeService) {
        this.ticketChangeAttributeService = ticketChangeAttributeService;
    }
    async updateDiagnosisBasic({ oid }, files, { ticketId }, body) {
        const data = await this.ticketChangeAttributeService.updateDiagnosis({
            oid,
            ticketId,
            body,
            files,
        });
        return { data };
    }
    async updateTicketAttributeList({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeAttributeService.updateTicketAttributeList({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
};
exports.TicketChangeAttributeController = TicketChangeAttributeController;
__decorate([
    (0, common_1.Post)(':ticketId/attribute/update-diagnosis'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_ATTRIBUTE),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.UploadedFiles)()),
    __param(2, (0, common_1.Param)()),
    __param(3, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, Array, typeof (_c = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_2.TicketUpdateDiagnosisBody !== "undefined" && request_2.TicketUpdateDiagnosisBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], TicketChangeAttributeController.prototype, "updateDiagnosisBasic", null);
__decorate([
    (0, common_1.Post)(':ticketId/attribute/update-ticket-attribute-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_ATTRIBUTE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _g : Object, typeof (_h = typeof request_2.TicketUpdateTicketAttributeListBody !== "undefined" && request_2.TicketUpdateTicketAttributeListBody) === "function" ? _h : Object]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], TicketChangeAttributeController.prototype, "updateTicketAttributeList", null);
exports.TicketChangeAttributeController = TicketChangeAttributeController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_attribute_service_1.TicketChangeAttributeService !== "undefined" && ticket_change_attribute_service_1.TicketChangeAttributeService) === "function" ? _a : Object])
], TicketChangeAttributeController);


/***/ }),
/* 733 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(734), exports);
__exportStar(__webpack_require__(735), exports);


/***/ }),
/* 734 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketAttributeListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketAttributeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketUpdateTicketAttributeListBody {
}
exports.TicketUpdateTicketAttributeListBody = TicketUpdateTicketAttributeListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketAttributeListBody.prototype, "ticketAttributeList", void 0);


/***/ }),
/* 735 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateDiagnosisBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const file_1 = __webpack_require__(262);
class TicketAttributeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsWait", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "externalUrlList", void 0);
class TicketUpdateDiagnosisBody extends file_1.MultipleFileUpload {
}
exports.TicketUpdateDiagnosisBody = TicketUpdateDiagnosisBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketUpdateDiagnosisBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ key: 'REASON', value: 'Đau bụng' }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new TicketAttributeBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length) {
                    const errValidate = validate.map((i) => {
                        const { target } = i, other = __rest(i, ["target"]);
                        return other;
                    });
                    err.push(...errValidate);
                }
                return instance;
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)({
        message: ({ value }) => `Validate ticketAttributeList failed. Value = ${JSON.stringify(value)}. Example: `
            + JSON.stringify([{ key: 'REASON', value: 'Đau bụng' }]),
    }),
    __metadata("design:type", Array)
], TicketUpdateDiagnosisBody.prototype, "ticketAttributeChangeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value);
            result.forEach((i) => {
                if (!i || typeof i !== 'string')
                    err.push(i);
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], TicketUpdateDiagnosisBody.prototype, "ticketAttributeKeyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({ message: ({ value }) => `Validate imagesChange failed. Value = ${value}` }),
    __metadata("design:type", ImagesChangeBody)
], TicketUpdateDiagnosisBody.prototype, "imagesChange", void 0);


/***/ }),
/* 736 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeAttributeService = void 0;
const common_1 = __webpack_require__(3);
const helpers_1 = __webpack_require__(182);
const repositories_1 = __webpack_require__(42);
const image_manager_service_1 = __webpack_require__(255);
const socket_emit_service_1 = __webpack_require__(340);
let TicketChangeAttributeService = class TicketChangeAttributeService {
    constructor(socketEmitService, ticketAttributeRepository, imageManagerService, imageRepository, ticketRepository) {
        this.socketEmitService = socketEmitService;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.imageManagerService = imageManagerService;
        this.imageRepository = imageRepository;
        this.ticketRepository = ticketRepository;
    }
    async updateDiagnosis(options) {
        const { oid, ticketId, body, files } = options;
        const { imagesChange, ticketAttributeChangeList, ticketAttributeKeyList } = body;
        let ticket = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, { note: body.note });
        if (imagesChange) {
            const imageIdsUpdate = await this.imageManagerService.changeCloudinaryImageLink({
                oid,
                customerId: ticket.customerId,
                files,
                imageIdsWait: imagesChange.imageIdsWait,
                externalUrlList: imagesChange.externalUrlList,
                imageIdsOld: JSON.parse(ticket.imageIds || '[]'),
            });
            if (ticket.imageIds !== JSON.stringify(imageIdsUpdate)) {
                const ticketUpdateList = await this.ticketRepository.updateAndReturnEntity({ oid, id: ticketId }, { imageIds: JSON.stringify(imageIdsUpdate) });
                ticket = ticketUpdateList[0];
                ticket.imageList = [];
                const imageIds = JSON.parse(ticket.imageIds);
                const imageList = await this.imageRepository.findManyByIds(imageIds);
                const imageMap = helpers_1.ESArray.arrayToKeyValue(imageList, 'id');
                imageIds.forEach((i) => {
                    ticket.imageList.push(imageMap[i]);
                });
            }
        }
        if (ticketAttributeChangeList) {
            await this.ticketAttributeRepository.delete({
                oid,
                ticketId,
                key: { IN: ticketAttributeKeyList },
            });
            const ticketAttributeInsertList = ticketAttributeChangeList.map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid,
                    ticketId });
                return dto;
            });
            await this.ticketAttributeRepository.insertMany(ticketAttributeInsertList);
            const ticketAttributeList = await this.ticketAttributeRepository.findManyBy({
                oid,
                ticketId,
            });
            this.socketEmitService.socketTicketAttributeListChange(oid, {
                ticketId,
                ticketAttributeList,
            });
        }
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        return true;
    }
    async updateTicketAttributeList(options) {
        const { oid, ticketId, body } = options;
        const ticketAttributeKeyList = body.ticketAttributeList.map((i) => i.key);
        await this.ticketAttributeRepository.delete({
            oid,
            ticketId,
            key: { IN: ticketAttributeKeyList },
        });
        const ticketAttributeInsertList = body.ticketAttributeList
            .filter((i) => !!i.value)
            .map((i) => {
            const dto = {
                oid,
                ticketId,
                key: i.key,
                value: i.value,
            };
            return dto;
        });
        const ticketAttributeList = await this.ticketAttributeRepository.insertManyAndReturnEntity(ticketAttributeInsertList);
        this.socketEmitService.socketTicketAttributeListChange(oid, {
            ticketId,
            ticketAttributeList,
        });
        return true;
    }
};
exports.TicketChangeAttributeService = TicketChangeAttributeService;
exports.TicketChangeAttributeService = TicketChangeAttributeService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _b : Object, typeof (_c = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _c : Object, typeof (_d = typeof repositories_1.ImageRepository !== "undefined" && repositories_1.ImageRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _e : Object])
], TicketChangeAttributeService);


/***/ }),
/* 737 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeLaboratoryModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_laboratory_group_module_1 = __webpack_require__(617);
const ticket_change_user_module_1 = __webpack_require__(738);
const ticket_change_laboratory_controller_1 = __webpack_require__(746);
const ticket_change_laboratory_service_1 = __webpack_require__(754);
let TicketChangeLaboratoryModule = class TicketChangeLaboratoryModule {
};
exports.TicketChangeLaboratoryModule = TicketChangeLaboratoryModule;
exports.TicketChangeLaboratoryModule = TicketChangeLaboratoryModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_change_user_module_1.TicketChangeUserModule, api_ticket_laboratory_group_module_1.ApiTicketLaboratoryGroupModule],
        controllers: [ticket_change_laboratory_controller_1.TicketChangeLaboratoryController],
        providers: [ticket_change_laboratory_service_1.TicketChangeLaboratoryService],
    })
], TicketChangeLaboratoryModule);


/***/ }),
/* 738 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeUserModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_change_user_controller_1 = __webpack_require__(739);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeUserModule = class TicketChangeUserModule {
};
exports.TicketChangeUserModule = TicketChangeUserModule;
exports.TicketChangeUserModule = TicketChangeUserModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [ticket_change_user_controller_1.TicketChangeUserController],
        providers: [ticket_change_user_service_1.TicketChangeUserService],
        exports: [ticket_change_user_service_1.TicketChangeUserService],
    })
], TicketChangeUserModule);


/***/ }),
/* 739 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeUserController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const ticket_params_1 = __webpack_require__(330);
const request_1 = __webpack_require__(740);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeUserController = class TicketChangeUserController {
    constructor(ticketChangeUserService) {
        this.ticketChangeUserService = ticketChangeUserService;
    }
    async destroyTicketUser({ oid }, { ticketId, ticketUserId }) {
        const data = await this.ticketChangeUserService.destroyTicketUser({
            oid,
            ticketId,
            ticketUserId,
        });
        return { data };
    }
    async updateTicketUserCommission({ oid }, { ticketId, ticketUserId }, body) {
        const data = await this.ticketChangeUserService.updateTicketUserCommission({
            oid,
            ticketId,
            ticketUserId,
            body,
        });
        return { data };
    }
    async updateTicketUserPositionList({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeUserService.updateTicketUserPositionList({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
};
exports.TicketChangeUserController = TicketChangeUserController;
__decorate([
    (0, common_1.Delete)(':ticketId/user/destroy-ticket-user/:ticketUserId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_USER_POSITION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketChangeUserParams !== "undefined" && request_1.TicketChangeUserParams) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], TicketChangeUserController.prototype, "destroyTicketUser", null);
__decorate([
    (0, common_1.Post)(':ticketId/user/update-ticket-user-commission/:ticketUserId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_USER_COMMISSION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketChangeUserParams !== "undefined" && request_1.TicketChangeUserParams) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketUpdateTicketUserCommissionBody !== "undefined" && request_1.TicketUpdateTicketUserCommissionBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketChangeUserController.prototype, "updateTicketUserCommission", null);
__decorate([
    (0, common_1.Post)(':ticketId/user/update-ticket-user-position'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_USER_POSITION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _k : Object, typeof (_l = typeof request_1.TicketUpdateTicketUserPositionListBody !== "undefined" && request_1.TicketUpdateTicketUserPositionListBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], TicketChangeUserController.prototype, "updateTicketUserPositionList", null);
exports.TicketChangeUserController = TicketChangeUserController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _a : Object])
], TicketChangeUserController);


/***/ }),
/* 740 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(741), exports);
__exportStar(__webpack_require__(742), exports);
__exportStar(__webpack_require__(743), exports);
__exportStar(__webpack_require__(744), exports);


/***/ }),
/* 741 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketUserPositionListBody = exports.TicketUserAddBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const position_entity_1 = __webpack_require__(76);
class TicketUserAddBody {
}
exports.TicketUserAddBody = TicketUserAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserAddBody.prototype, "roleId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserAddBody.prototype, "userId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: position_entity_1.PositionInteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.PositionInteractType),
    __metadata("design:type", typeof (_a = typeof position_entity_1.PositionInteractType !== "undefined" && position_entity_1.PositionInteractType) === "function" ? _a : Object)
], TicketUserAddBody.prototype, "positionType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserAddBody.prototype, "positionInteractId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserAddBody.prototype, "ticketItemId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserAddBody.prototype, "quantity", void 0);
class TicketAddTicketUserPositionListBody {
}
exports.TicketAddTicketUserPositionListBody = TicketAddTicketUserPositionListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketUserAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketUserAddBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketAddTicketUserPositionListBody.prototype, "ticketUserList", void 0);


/***/ }),
/* 742 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUserBasicBody = exports.TicketChangeUserParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const ticket_params_1 = __webpack_require__(330);
class TicketChangeUserParams extends ticket_params_1.TicketParams {
}
exports.TicketChangeUserParams = TicketChangeUserParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeUserParams.prototype, "ticketUserId", void 0);
class TicketUserBasicBody {
}
exports.TicketUserBasicBody = TicketUserBasicBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "roleId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUserBasicBody.prototype, "userId", void 0);


/***/ }),
/* 743 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketUserCommissionBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const position_entity_1 = __webpack_require__(76);
class TicketUpdateTicketUserCommissionBody {
}
exports.TicketUpdateTicketUserCommissionBody = TicketUpdateTicketUserCommissionBody;
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(position_entity_1.CommissionCalculatorType), example: position_entity_1.CommissionCalculatorType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.CommissionCalculatorType),
    __metadata("design:type", typeof (_a = typeof position_entity_1.CommissionCalculatorType !== "undefined" && position_entity_1.CommissionCalculatorType) === "function" ? _a : Object)
], TicketUpdateTicketUserCommissionBody.prototype, "commissionCalculatorType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserCommissionBody.prototype, "commissionMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserCommissionBody.prototype, "commissionPercentActual", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserCommissionBody.prototype, "commissionPercentExpected", void 0);


/***/ }),
/* 744 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketUserPositionListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const position_entity_1 = __webpack_require__(76);
const ticket_change_user_request_1 = __webpack_require__(742);
class TicketUpdateTicketUserPositionListBody {
}
exports.TicketUpdateTicketUserPositionListBody = TicketUpdateTicketUserPositionListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: position_entity_1.PositionInteractType.Ticket }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(position_entity_1.PositionInteractType),
    __metadata("design:type", typeof (_a = typeof position_entity_1.PositionInteractType !== "undefined" && position_entity_1.PositionInteractType) === "function" ? _a : Object)
], TicketUpdateTicketUserPositionListBody.prototype, "positionType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserPositionListBody.prototype, "positionInteractId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserPositionListBody.prototype, "ticketItemId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketUserPositionListBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_change_user_request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_change_user_request_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketUserPositionListBody.prototype, "ticketUserList", void 0);


/***/ }),
/* 745 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeUserService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const position_entity_1 = __webpack_require__(76);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
let TicketChangeUserService = class TicketChangeUserService {
    constructor(socketEmitService, positionRepository, ticketUserRepository, ticketUserManager) {
        this.socketEmitService = socketEmitService;
        this.positionRepository = positionRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.ticketUserManager = ticketUserManager;
    }
    async addTicketUserPositionList(options) {
        const { oid, ticketId, body } = options;
        const tuInsertBodyList = body.ticketUserList.filter((i) => i.userId !== 0);
        if (!tuInsertBodyList.length)
            return;
        const positionList = await this.positionRepository.findManyBy({
            oid,
            positionType: { IN: body.ticketUserList.map((i) => i.positionType) },
            positionInteractId: { IN: body.ticketUserList.map((i) => i.positionInteractId) },
        });
        const ticketUserInsertList = tuInsertBodyList.map((i) => {
            const position = positionList.find((p) => {
                return (p.positionType === i.positionType
                    && p.positionInteractId === i.positionInteractId
                    && p.roleId === i.roleId);
            });
            if (!position) {
                throw new exception_filter_1.BusinessException('error.Conflict');
            }
            const insertDto = {
                oid,
                ticketId,
                roleId: i.roleId,
                userId: i.userId,
                positionType: i.positionType,
                positionInteractId: i.positionInteractId,
                ticketItemId: i.ticketItemId,
                ticketItemExpectedPrice: 0,
                ticketItemActualPrice: 0,
                quantity: i.quantity,
                createdAt: Date.now(),
                commissionCalculatorType: position.commissionCalculatorType,
                commissionMoney: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.VND
                    ? position.commissionValue
                    : 0,
                commissionPercentActual: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentActual
                    ? position.commissionValue
                    : 0,
                commissionPercentExpected: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentExpected
                    ? position.commissionValue
                    : 0,
            };
            return insertDto;
        });
        const ticketUserCreatedList = await this.ticketUserRepository.insertManyAndReturnEntity(ticketUserInsertList);
        this.socketEmitService.socketTicketUserListChange(oid, {
            ticketId,
            ticketUserUpsertList: ticketUserCreatedList,
        });
    }
    async destroyTicketUser(options) {
        const { oid, ticketId, ticketUserId } = options;
        const ticketUserDestroyList = await this.ticketUserRepository.deleteAndReturnEntity({
            oid,
            ticketId,
            id: ticketUserId,
        });
        this.socketEmitService.socketTicketUserListChange(oid, {
            ticketId,
            ticketUserDestroyList,
        });
        return true;
    }
    async updateTicketUserCommission(options) {
        const { oid, ticketId, ticketUserId, body } = options;
        const ticketUserUpdateList = await this.ticketUserRepository.updateAndReturnEntity({ oid, ticketId, id: ticketUserId }, {
            commissionCalculatorType: body.commissionCalculatorType,
            commissionMoney: body.commissionMoney,
            commissionPercentActual: body.commissionPercentActual,
            commissionPercentExpected: body.commissionPercentExpected,
        });
        this.socketEmitService.socketTicketUserListChange(oid, {
            ticketId,
            ticketUserUpsertList: ticketUserUpdateList,
        });
        return true;
    }
    async updateTicketUserPositionList(options) {
        const { oid, ticketId, body } = options;
        const tuDestroyBodyList = body.ticketUserList.filter((i) => i.id !== 0 && i.userId === 0);
        let ticketUserDestroyList = [];
        if (tuDestroyBodyList.length) {
            ticketUserDestroyList = await this.ticketUserRepository.deleteAndReturnEntity({
                oid,
                id: { IN: tuDestroyBodyList.map((i) => i.id) },
            });
        }
        const tuInsertBodyList = body.ticketUserList.filter((i) => i.id === 0 && i.userId !== 0);
        let ticketUserCreatedList = [];
        if (tuInsertBodyList.length) {
            const positionList = await this.positionRepository.findManyBy({
                oid,
                positionType: body.positionType,
                positionInteractId: body.positionInteractId,
            });
            const ticketUserInsertList = tuInsertBodyList.map((i) => {
                const position = positionList.find((c) => c.roleId === i.roleId);
                if (!position) {
                    throw new exception_filter_1.BusinessException('error.Conflict');
                }
                const insertDto = {
                    oid,
                    ticketId,
                    roleId: i.roleId,
                    userId: i.userId,
                    positionType: body.positionType,
                    positionInteractId: body.positionInteractId,
                    ticketItemId: body.ticketItemId,
                    ticketItemExpectedPrice: 0,
                    ticketItemActualPrice: 0,
                    quantity: body.quantity,
                    createdAt: Date.now(),
                    commissionCalculatorType: position.commissionCalculatorType,
                    commissionMoney: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.VND
                        ? position.commissionValue
                        : 0,
                    commissionPercentActual: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentActual
                        ? position.commissionValue
                        : 0,
                    commissionPercentExpected: position.commissionCalculatorType === position_entity_1.CommissionCalculatorType.PercentExpected
                        ? position.commissionValue
                        : 0,
                };
                return insertDto;
            });
            ticketUserCreatedList =
                await this.ticketUserRepository.insertManyAndReturnEntity(ticketUserInsertList);
        }
        const tuUpdateBodyList = body.ticketUserList.filter((i) => i.id !== 0 && i.userId !== 0);
        let ticketUserModifiedList = [];
        if (tuUpdateBodyList) {
            const ticketUserUpdateList = tuUpdateBodyList.map((i) => {
                const updateDto = {
                    oid,
                    id: i.id,
                    ticketId,
                    roleId: i.roleId,
                    userId: i.userId,
                    quantity: body.quantity,
                };
                return updateDto;
            });
            ticketUserModifiedList = await this.ticketUserManager.bulkUpdate({
                manager: this.ticketUserRepository.getManager(),
                condition: { oid },
                compare: ['id', 'ticketId'],
                tempList: ticketUserUpdateList,
                update: ['userId', 'quantity'],
                options: { requireEqualLength: false },
            });
        }
        this.socketEmitService.socketTicketUserListChange(oid, {
            ticketId,
            ticketUserDestroyList,
            ticketUserUpsertList: [...ticketUserCreatedList, ...ticketUserModifiedList],
        });
        return true;
    }
};
exports.TicketChangeUserService = TicketChangeUserService;
exports.TicketChangeUserService = TicketChangeUserService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.PositionRepository !== "undefined" && repositories_1.PositionRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketUserManager !== "undefined" && repositories_1.TicketUserManager) === "function" ? _d : Object])
], TicketChangeUserService);


/***/ }),
/* 746 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeLaboratoryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(315);
const ticket_params_1 = __webpack_require__(330);
const request_2 = __webpack_require__(747);
const ticket_change_laboratory_service_1 = __webpack_require__(754);
let TicketChangeLaboratoryController = class TicketChangeLaboratoryController {
    constructor(ticketChangeLaboratoryService) {
        this.ticketChangeLaboratoryService = ticketChangeLaboratoryService;
    }
    async upsertLaboratory({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeLaboratoryService.upsertLaboratory({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async destroyTicketLaboratory({ oid }, { ticketId, ticketLaboratoryId }) {
        const data = await this.ticketChangeLaboratoryService.destroyTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
        });
        return { data };
    }
    async destroyTicketLaboratoryGroup({ oid }, { ticketId, ticketLaboratoryGroupId }) {
        const data = await this.ticketChangeLaboratoryService.destroyTicketLaboratoryGroup({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
        return { data };
    }
    async updateTicketLaboratory({ oid }, { ticketId, ticketLaboratoryId }, body) {
        const data = await this.ticketChangeLaboratoryService.updateTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
            body,
        });
        return { data };
    }
    async updatePriorityTicketLaboratory({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeLaboratoryService.updatePriorityTicketLaboratory({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async updateResultTicketLaboratory({ oid }, { ticketId, ticketLaboratoryGroupId }, body, query) {
        const data = await this.ticketChangeLaboratoryService.updateResult({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
            body,
            query,
        });
        return { data };
    }
    async cancelResultTicketLaboratory({ oid }, { ticketId, ticketLaboratoryGroupId }) {
        const data = await this.ticketChangeLaboratoryService.cancelResult({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
        return { data };
    }
};
exports.TicketChangeLaboratoryController = TicketChangeLaboratoryController;
__decorate([
    (0, common_1.Post)(':ticketId/laboratory/upsert-laboratory'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_2.TicketUpsertLaboratoryBody !== "undefined" && request_2.TicketUpsertLaboratoryBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], TicketChangeLaboratoryController.prototype, "upsertLaboratory", null);
__decorate([
    (0, common_1.Delete)(':ticketId/laboratory/destroy-ticket-laboratory/:ticketLaboratoryId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketChangeLaboratoryParams !== "undefined" && request_2.TicketChangeLaboratoryParams) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketChangeLaboratoryController.prototype, "destroyTicketLaboratory", null);
__decorate([
    (0, common_1.Delete)(':ticketId/laboratory/destroy-ticket-laboratory-group/:ticketLaboratoryGroupId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_2.TicketChangeLaboratoryGroupParams !== "undefined" && request_2.TicketChangeLaboratoryGroupParams) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], TicketChangeLaboratoryController.prototype, "destroyTicketLaboratoryGroup", null);
__decorate([
    (0, common_1.Post)(':ticketId/laboratory/update-ticket-laboratory/:ticketLaboratoryId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof request_2.TicketChangeLaboratoryParams !== "undefined" && request_2.TicketChangeLaboratoryParams) === "function" ? _o : Object, typeof (_p = typeof request_2.TicketUpdateTicketLaboratoryBody !== "undefined" && request_2.TicketUpdateTicketLaboratoryBody) === "function" ? _p : Object]),
    __metadata("design:returntype", typeof (_q = typeof Promise !== "undefined" && Promise) === "function" ? _q : Object)
], TicketChangeLaboratoryController.prototype, "updateTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':ticketId/laboratory/update-priority-ticket-laboratory'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof ticket_params_1.TicketParams !== "undefined" && ticket_params_1.TicketParams) === "function" ? _s : Object, typeof (_t = typeof request_2.TicketUpdatePriorityTicketLaboratoryBody !== "undefined" && request_2.TicketUpdatePriorityTicketLaboratoryBody) === "function" ? _t : Object]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], TicketChangeLaboratoryController.prototype, "updatePriorityTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':ticketId/laboratory/update-result/:ticketLaboratoryGroupId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY_RESULT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __param(3, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_v = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _v : Object, typeof (_w = typeof request_2.TicketChangeLaboratoryGroupParams !== "undefined" && request_2.TicketChangeLaboratoryGroupParams) === "function" ? _w : Object, typeof (_x = typeof request_2.TicketUpdateLaboratoryGroupResultBody !== "undefined" && request_2.TicketUpdateLaboratoryGroupResultBody) === "function" ? _x : Object, typeof (_y = typeof request_1.TicketLaboratoryGroupPostQuery !== "undefined" && request_1.TicketLaboratoryGroupPostQuery) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], TicketChangeLaboratoryController.prototype, "updateResultTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':ticketId/laboratory/cancel-result/:ticketLaboratoryGroupId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_LABORATORY_RESULT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_0 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _0 : Object, typeof (_1 = typeof request_2.TicketChangeLaboratoryGroupParams !== "undefined" && request_2.TicketChangeLaboratoryGroupParams) === "function" ? _1 : Object]),
    __metadata("design:returntype", typeof (_2 = typeof Promise !== "undefined" && Promise) === "function" ? _2 : Object)
], TicketChangeLaboratoryController.prototype, "cancelResultTicketLaboratory", null);
exports.TicketChangeLaboratoryController = TicketChangeLaboratoryController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_laboratory_service_1.TicketChangeLaboratoryService !== "undefined" && ticket_change_laboratory_service_1.TicketChangeLaboratoryService) === "function" ? _a : Object])
], TicketChangeLaboratoryController);


/***/ }),
/* 747 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(748), exports);
__exportStar(__webpack_require__(749), exports);
__exportStar(__webpack_require__(750), exports);
__exportStar(__webpack_require__(751), exports);
__exportStar(__webpack_require__(752), exports);
__exportStar(__webpack_require__(753), exports);


/***/ }),
/* 748 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeLaboratoryGroupParams = exports.TicketChangeLaboratoryParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketChangeLaboratoryParams {
}
exports.TicketChangeLaboratoryParams = TicketChangeLaboratoryParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeLaboratoryParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeLaboratoryParams.prototype, "ticketLaboratoryId", void 0);
class TicketChangeLaboratoryGroupParams {
}
exports.TicketChangeLaboratoryGroupParams = TicketChangeLaboratoryGroupParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeLaboratoryGroupParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketChangeLaboratoryGroupParams.prototype, "ticketLaboratoryGroupId", void 0);


/***/ }),
/* 749 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateLaboratoryGroupResultBody = exports.LaboratoryGroupResultBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class LaboratoryGroupResultBody {
}
exports.LaboratoryGroupResultBody = LaboratoryGroupResultBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], LaboratoryGroupResultBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupResultBody.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupResultBody.prototype, "ticketLaboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Âm tính' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], LaboratoryGroupResultBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], LaboratoryGroupResultBody.prototype, "attention", void 0);
class TicketUpdateLaboratoryGroupResultBody {
}
exports.TicketUpdateLaboratoryGroupResultBody = TicketUpdateLaboratoryGroupResultBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: LaboratoryGroupResultBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => LaboratoryGroupResultBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateLaboratoryGroupResultBody.prototype, "ticketLaboratoryResultUpdateList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketUpdateLaboratoryGroupResultBody.prototype, "completedAt", void 0);


/***/ }),
/* 750 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketLaboratoryListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "actualPrice", void 0);
class TicketUpdateTicketLaboratoryListBody {
}
exports.TicketUpdateTicketLaboratoryListBody = TicketUpdateTicketLaboratoryListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketUpdateTicketLaboratoryListBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketLaboratoryListBody.prototype, "ticketLaboratoryList", void 0);


/***/ }),
/* 751 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdatePriorityTicketLaboratoryBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "priority", void 0);
class TicketUpdatePriorityTicketLaboratoryBody {
}
exports.TicketUpdatePriorityTicketLaboratoryBody = TicketUpdatePriorityTicketLaboratoryBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePriorityTicketLaboratoryBody.prototype, "ticketLaboratoryList", void 0);


/***/ }),
/* 752 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketLaboratoryBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const request_1 = __webpack_require__(740);
class TicketLaboratoryBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryBody.prototype, "actualPrice", void 0);
class TicketUpdateTicketLaboratoryBody {
}
exports.TicketUpdateTicketLaboratoryBody = TicketUpdateTicketLaboratoryBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketLaboratoryBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketLaboratoryBody)
], TicketUpdateTicketLaboratoryBody.prototype, "ticketLaboratory", void 0);


/***/ }),
/* 753 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpsertLaboratoryBody = exports.TicketLaboratoryGroupUpdateBody = exports.TicketLaboratoryGroupAddBody = exports.TicketLaboratoryUpdateBody = exports.TicketLaboratoryAddBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketLaboratoryAddBody {
}
exports.TicketLaboratoryAddBody = TicketLaboratoryAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "laboratoryId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketLaboratoryAddBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryAddBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PaymentMoneyStatus),
    (0, class_validator_1.IsIn)([variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending]),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketLaboratoryAddBody.prototype, "paymentMoneyStatus", void 0);
class TicketLaboratoryUpdateBody extends (0, swagger_1.OmitType)(TicketLaboratoryAddBody, [
    'paymentMoneyStatus',
]) {
}
exports.TicketLaboratoryUpdateBody = TicketLaboratoryUpdateBody;
class TicketLaboratoryGroupAddBody {
}
exports.TicketLaboratoryGroupAddBody = TicketLaboratoryGroupAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupAddBody.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupAddBody.prototype, "roomId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupAddBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PaymentMoneyStatus),
    (0, class_validator_1.IsIn)([variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending]),
    __metadata("design:type", typeof (_c = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _c : Object)
], TicketLaboratoryGroupAddBody.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketLaboratoryGroupAddBody.prototype, "ticketLaboratoryList", void 0);
class TicketLaboratoryGroupUpdateBody {
}
exports.TicketLaboratoryGroupUpdateBody = TicketLaboratoryGroupUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupUpdateBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupUpdateBody.prototype, "laboratoryGroupId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupUpdateBody.prototype, "roomId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketLaboratoryGroupUpdateBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryUpdateBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketLaboratoryGroupUpdateBody.prototype, "ticketLaboratoryList", void 0);
class TicketUpsertLaboratoryBody {
}
exports.TicketUpsertLaboratoryBody = TicketUpsertLaboratoryBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryGroupAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryGroupAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpsertLaboratoryBody.prototype, "ticketLaboratoryGroupAddList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketLaboratoryGroupUpdateBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketLaboratoryGroupUpdateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketLaboratoryGroupUpdateBody)
], TicketUpsertLaboratoryBody.prototype, "ticketLaboratoryGroupUpdate", void 0);


/***/ }),
/* 754 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeLaboratoryService = void 0;
const common_1 = __webpack_require__(3);
const error_1 = __webpack_require__(14);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
const api_ticket_laboratory_group_service_1 = __webpack_require__(619);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeLaboratoryService = class TicketChangeLaboratoryService {
    constructor(socketEmitService, ticketLaboratoryRepository, ticketLaboratoryGroupRepository, ticketLaboratoryResultRepository, ticketAddSelectLaboratoryOperation, ticketChangeSelectLaboratoryOperation, ticketUpdateTicketLaboratoryOperation, ticketDestroyTicketLaboratoryOperation, ticketDestroyTlgOperation, ticketChangeUserService, apiTicketLaboratoryGroupService) {
        this.socketEmitService = socketEmitService;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
        this.ticketAddSelectLaboratoryOperation = ticketAddSelectLaboratoryOperation;
        this.ticketChangeSelectLaboratoryOperation = ticketChangeSelectLaboratoryOperation;
        this.ticketUpdateTicketLaboratoryOperation = ticketUpdateTicketLaboratoryOperation;
        this.ticketDestroyTicketLaboratoryOperation = ticketDestroyTicketLaboratoryOperation;
        this.ticketDestroyTlgOperation = ticketDestroyTlgOperation;
        this.ticketChangeUserService = ticketChangeUserService;
        this.apiTicketLaboratoryGroupService = apiTicketLaboratoryGroupService;
    }
    async upsertLaboratory(options) {
        const { oid, ticketId, body } = options;
        if (body.ticketLaboratoryGroupAddList.length) {
            const result = await this.ticketAddSelectLaboratoryOperation.addSelectLaboratoryList({
                oid,
                ticketId,
                tlgDtoList: body.ticketLaboratoryGroupAddList,
            });
            this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: result.ticket });
            this.socketEmitService.socketTicketLaboratoryListChange(oid, {
                ticketId,
                ticketLaboratoryUpsertList: result.ticketLaboratoryInsertList,
                ticketLaboratoryGroupUpsertList: result.ticketLaboratoryGroupInsertList,
            });
        }
        if (body.ticketLaboratoryGroupUpdate) {
            const _a = body.ticketLaboratoryGroupUpdate, { ticketLaboratoryList: ticketLaboratoryListDto } = _a, ticketLaboratoryGroupDto = __rest(_a, ["ticketLaboratoryList"]);
            const result = await this.ticketChangeSelectLaboratoryOperation.changeSelectLaboratoryList({
                oid,
                ticketId,
                ticketLaboratoryGroupDto,
                ticketLaboratoryListDto,
            });
            this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: result.ticket });
            this.socketEmitService.socketTicketLaboratoryListChange(oid, {
                ticketId,
                ticketLaboratoryUpsertList: result.ticketLaboratoryInsertList,
                ticketLaboratoryDestroyList: result.ticketLaboratoryDestroyList,
                ticketLaboratoryGroupUpsertList: [result.ticketLaboratoryGroupUpdate],
            });
        }
        return true;
    }
    async destroyTicketLaboratory(options) {
        const { oid, ticketId, ticketLaboratoryId } = options;
        const result = await this.ticketDestroyTicketLaboratoryOperation.destroyTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
        });
        const { ticket } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketLaboratoryListChange(oid, {
            ticketId,
            ticketLaboratoryDestroyList: [result.ticketLaboratoryDestroy],
            ticketLaboratoryGroupDestroyList: result.ticketLaboratoryGroupDestroy
                ? [result.ticketLaboratoryGroupDestroy]
                : undefined,
            ticketLaboratoryGroupUpsertList: result.ticketLaboratoryGroupModified
                ? [result.ticketLaboratoryGroupModified]
                : undefined,
        });
        return true;
    }
    async destroyTicketLaboratoryGroup(options) {
        const { oid, ticketId, ticketLaboratoryGroupId } = options;
        const ticketLaboratoryGroupOrigin = await this.ticketLaboratoryGroupRepository.findOneBy({
            oid,
            id: ticketLaboratoryGroupId,
        });
        if (ticketLaboratoryGroupOrigin.status === variable_1.TicketLaboratoryStatus.Completed) {
            throw new error_1.BusinessError('Phiếu đã hoàn thành không thể xóa');
        }
        if (ticketLaboratoryGroupOrigin.paymentMoneyStatus === variable_1.PaymentMoneyStatus.Paid) {
            throw new error_1.BusinessError('Phiếu đã đóng tiền không thể xóa');
        }
        const result = await this.ticketDestroyTlgOperation.destroyTicketLaboratoryGroup({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
        const { ticket } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketLaboratoryListChange(oid, {
            ticketId,
            ticketLaboratoryGroupDestroyList: [result.ticketLaboratoryGroupDestroy],
            ticketLaboratoryDestroyList: result.ticketLaboratoryDestroyList,
            ticketLaboratoryResultDestroyList: result.ticketLaboratoryResultDestroyList,
        });
        return true;
    }
    async updateTicketLaboratory(options) {
        const { oid, ticketId, ticketLaboratoryId, body } = options;
        const result = await this.ticketUpdateTicketLaboratoryOperation.updateTicketLaboratory({
            oid,
            ticketId,
            ticketLaboratoryId,
            ticketLaboratoryUpdateDto: body.ticketLaboratory,
        });
        const { ticket, ticketLaboratory } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketLaboratoryListChange(oid, {
            ticketId,
            ticketLaboratoryUpsertList: [ticketLaboratory],
        });
        if (body.ticketUserList) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Laboratory,
                    positionInteractId: ticketLaboratory.laboratoryId,
                    ticketItemId: ticketLaboratory.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return true;
    }
    async updatePriorityTicketLaboratory(options) {
        const { oid, ticketId, body } = options;
        return true;
    }
    async updateResult(options) {
        var _a, _b, _c, _d, _e, _f;
        const { oid, ticketId, ticketLaboratoryGroupId, body } = options;
        const response = (_a = options.query) === null || _a === void 0 ? void 0 : _a.response;
        const ticketLaboratoryGroupUpdate = await this.ticketLaboratoryGroupRepository.updateOneAndReturnEntity({ oid, id: ticketLaboratoryGroupId }, { completedAt: body.completedAt, status: variable_1.TicketLaboratoryStatus.Completed });
        const ticketLaboratoryUpdateList = await this.ticketLaboratoryRepository.updateAndReturnEntity({ oid, ticketId, ticketLaboratoryGroupId }, { completedAt: body.completedAt, status: variable_1.TicketLaboratoryStatus.Completed });
        const tlrBodyInsertList = body.ticketLaboratoryResultUpdateList.filter((i) => {
            return !i.id;
        });
        const tlrBodyUpdateList = body.ticketLaboratoryResultUpdateList.filter((i) => {
            return !!i.id;
        });
        let tlrInsertList = [];
        let tlrUpdateList = [];
        if (tlrBodyInsertList.length) {
            const tlrDtoInsertList = tlrBodyInsertList.map((i) => {
                const dtoInsert = Object.assign(Object.assign({}, i), { oid,
                    ticketId,
                    ticketLaboratoryGroupId, laboratoryGroupId: ticketLaboratoryGroupUpdate.laboratoryGroupId, customerId: (ticketLaboratoryGroupUpdate === null || ticketLaboratoryGroupUpdate === void 0 ? void 0 : ticketLaboratoryGroupUpdate.customerId) || 0 });
                return dtoInsert;
            });
            tlrInsertList =
                await this.ticketLaboratoryResultRepository.insertManyAndReturnEntity(tlrDtoInsertList);
        }
        if (tlrBodyUpdateList.length) {
            tlrUpdateList = await this.ticketLaboratoryResultRepository.updateResultList({
                oid,
                ticketId,
                ticketLaboratoryResultDtoList: body.ticketLaboratoryResultUpdateList,
            });
        }
        this.socketEmitService.socketTicketLaboratoryListChange(oid, {
            ticketId,
            ticketLaboratoryGroupUpsertList: [ticketLaboratoryGroupUpdate],
            ticketLaboratoryUpsertList: ticketLaboratoryUpdateList,
            ticketLaboratoryResultUpsertList: [...tlrInsertList, ...tlrUpdateList],
        });
        ticketLaboratoryGroupUpdate.ticketLaboratoryList = ticketLaboratoryUpdateList;
        await this.apiTicketLaboratoryGroupService.generateRelation([ticketLaboratoryGroupUpdate], {
            ticket: (_b = response === null || response === void 0 ? void 0 : response.ticketLaboratoryGroup) === null || _b === void 0 ? void 0 : _b.ticket,
            customer: (_c = response === null || response === void 0 ? void 0 : response.ticketLaboratoryGroup) === null || _c === void 0 ? void 0 : _c.customer,
            ticketUserList: (_d = response === null || response === void 0 ? void 0 : response.ticketLaboratoryGroup) === null || _d === void 0 ? void 0 : _d.customer,
            ticketLaboratoryList: false,
            ticketLaboratoryResultMap: (_e = response === null || response === void 0 ? void 0 : response.ticketLaboratoryGroup) === null || _e === void 0 ? void 0 : _e.ticketLaboratoryResultMap,
            imageList: (_f = response === null || response === void 0 ? void 0 : response.ticketLaboratoryGroup) === null || _f === void 0 ? void 0 : _f.imageList,
        });
        return { ticketLaboratoryGroup: ticketLaboratoryGroupUpdate };
    }
    async cancelResult(options) {
        const { oid, ticketId, ticketLaboratoryGroupId } = options;
        const ticketLaboratoryGroupUpdate = await this.ticketLaboratoryGroupRepository.updateOneAndReturnEntity({ oid, id: ticketLaboratoryGroupId }, { status: variable_1.TicketLaboratoryStatus.Pending });
        const ticketLaboratoryUpdateList = await this.ticketLaboratoryRepository.updateAndReturnEntity({ oid, ticketId, ticketLaboratoryGroupId }, { status: variable_1.TicketLaboratoryStatus.Pending });
        const ticketLaboratoryResultDestroyList = await this.ticketLaboratoryResultRepository.deleteAndReturnEntity({
            oid,
            ticketId,
            ticketLaboratoryGroupId,
        });
        this.socketEmitService.socketTicketLaboratoryListChange(oid, {
            ticketId,
            ticketLaboratoryGroupUpsertList: [ticketLaboratoryGroupUpdate],
            ticketLaboratoryUpsertList: ticketLaboratoryUpdateList,
            ticketLaboratoryResultDestroyList,
        });
        return true;
    }
};
exports.TicketChangeLaboratoryService = TicketChangeLaboratoryService;
exports.TicketChangeLaboratoryService = TicketChangeLaboratoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketLaboratoryGroupRepository !== "undefined" && repositories_1.TicketLaboratoryGroupRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketLaboratoryResultRepository !== "undefined" && repositories_1.TicketLaboratoryResultRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketAddSelectLaboratoryOperation !== "undefined" && operations_1.TicketAddSelectLaboratoryOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketChangeSelectLaboratoryOperation !== "undefined" && operations_1.TicketChangeSelectLaboratoryOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketUpdateTicketLaboratoryOperation !== "undefined" && operations_1.TicketUpdateTicketLaboratoryOperation) === "function" ? _g : Object, typeof (_h = typeof operations_1.TicketDestroyTicketLaboratoryOperation !== "undefined" && operations_1.TicketDestroyTicketLaboratoryOperation) === "function" ? _h : Object, typeof (_j = typeof operations_1.TicketDestroyTicketLaboratoryGroupOperation !== "undefined" && operations_1.TicketDestroyTicketLaboratoryGroupOperation) === "function" ? _j : Object, typeof (_k = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _k : Object, typeof (_l = typeof api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService !== "undefined" && api_ticket_laboratory_group_service_1.ApiTicketLaboratoryGroupService) === "function" ? _l : Object])
], TicketChangeLaboratoryService);


/***/ }),
/* 755 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProcedureModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_procedure_service_1 = __webpack_require__(625);
const ticket_change_user_module_1 = __webpack_require__(738);
const ticket_change_procedure_controller_1 = __webpack_require__(756);
const ticket_change_procedure_service_1 = __webpack_require__(763);
let TicketChangeProcedureModule = class TicketChangeProcedureModule {
};
exports.TicketChangeProcedureModule = TicketChangeProcedureModule;
exports.TicketChangeProcedureModule = TicketChangeProcedureModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_change_user_module_1.TicketChangeUserModule],
        controllers: [ticket_change_procedure_controller_1.TicketChangeProcedureController],
        providers: [ticket_change_procedure_service_1.TicketChangeProcedureService, api_ticket_procedure_service_1.ApiTicketProcedureService],
    })
], TicketChangeProcedureModule);


/***/ }),
/* 756 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProcedureController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(757);
const ticket_add_ticket_procedure_list_body_1 = __webpack_require__(758);
const ticket_procedure_update_result_request_1 = __webpack_require__(762);
const ticket_change_procedure_service_1 = __webpack_require__(763);
let TicketChangeProcedureController = class TicketChangeProcedureController {
    constructor(ticketChangeProcedureService) {
        this.ticketChangeProcedureService = ticketChangeProcedureService;
    }
    async addTicketProcedureList({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProcedureService.addTicketProcedureList({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async destroyTicketProcedure({ oid }, { ticketId, ticketProcedureId }) {
        const data = await this.ticketChangeProcedureService.destroyTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
        });
        return { data };
    }
    async updateTicketProcedure({ oid }, { ticketId, ticketProcedureId }, body) {
        const data = await this.ticketChangeProcedureService.updateTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
            body,
        });
        return { data };
    }
    async updatePriorityTicketProcedure({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProcedureService.updatePriorityTicketProcedure({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async updateResultTicketProcedureItem({ oid }, { ticketId }, body, files) {
        const data = await this.ticketChangeProcedureService.updateResultTicketProcedureItem({
            oid,
            ticketId,
            body,
            files,
        });
        return { data };
    }
};
exports.TicketChangeProcedureController = TicketChangeProcedureController;
__decorate([
    (0, common_1.Post)(':ticketId/procedure/add-ticket-procedure-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof ticket_add_ticket_procedure_list_body_1.TicketAddTicketProcedureListBody !== "undefined" && ticket_add_ticket_procedure_list_body_1.TicketAddTicketProcedureListBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], TicketChangeProcedureController.prototype, "addTicketProcedureList", null);
__decorate([
    (0, common_1.Delete)(':ticketId/procedure/destroy-ticket-procedure/:ticketProcedureId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketChangeProcedureParams !== "undefined" && request_2.TicketChangeProcedureParams) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketChangeProcedureController.prototype, "destroyTicketProcedure", null);
__decorate([
    (0, common_1.Post)(':ticketId/procedure/update-ticket-procedure/:ticketProcedureId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_2.TicketChangeProcedureParams !== "undefined" && request_2.TicketChangeProcedureParams) === "function" ? _k : Object, typeof (_l = typeof request_2.TicketUpdateTicketProcedureBody !== "undefined" && request_2.TicketUpdateTicketProcedureBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], TicketChangeProcedureController.prototype, "updateTicketProcedure", null);
__decorate([
    (0, common_1.Post)(':ticketId/procedure/update-priority-ticket-procedure'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _p : Object, typeof (_q = typeof request_2.TicketUpdatePriorityTicketProcedureBody !== "undefined" && request_2.TicketUpdatePriorityTicketProcedureBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], TicketChangeProcedureController.prototype, "updatePriorityTicketProcedure", null);
__decorate([
    (0, common_1.Post)(':ticketId/procedure/update-result-ticket-procedure-item'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE_RESULT),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __param(3, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _t : Object, typeof (_u = typeof ticket_procedure_update_result_request_1.TicketProcedureUpdateResultBody !== "undefined" && ticket_procedure_update_result_request_1.TicketProcedureUpdateResultBody) === "function" ? _u : Object, Array]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], TicketChangeProcedureController.prototype, "updateResultTicketProcedureItem", null);
exports.TicketChangeProcedureController = TicketChangeProcedureController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_procedure_service_1.TicketChangeProcedureService !== "undefined" && ticket_change_procedure_service_1.TicketChangeProcedureService) === "function" ? _a : Object])
], TicketChangeProcedureController);


/***/ }),
/* 757 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(758), exports);
__exportStar(__webpack_require__(759), exports);
__exportStar(__webpack_require__(760), exports);
__exportStar(__webpack_require__(761), exports);


/***/ }),
/* 758 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketProcedureListBody = exports.TicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const request_1 = __webpack_require__(740);
class TicketProcedureItemBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? Number(value) : value)),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureItemBody.prototype, "completedAt", void 0);
class TicketProcedureBasicBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "procedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "totalSessions", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedureBasicBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.TicketProcedureStatus.Pending }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.TicketProcedureStatus),
    __metadata("design:type", typeof (_b = typeof variable_1.TicketProcedureStatus !== "undefined" && variable_1.TicketProcedureStatus) === "function" ? _b : Object)
], TicketProcedureBasicBody.prototype, "status", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PaymentMoneyStatus),
    (0, class_validator_1.IsIn)([variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending]),
    __metadata("design:type", typeof (_c = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _c : Object)
], TicketProcedureBasicBody.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? Number(value) : value)),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureBasicBody.prototype, "createdAt", void 0);
class TicketProcedureBody {
}
exports.TicketProcedureBody = TicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureItemBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureItemBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketProcedureBody.prototype, "ticketProcedureItemList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketProcedureBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBasicBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProcedureBasicBody)
], TicketProcedureBody.prototype, "ticketProcedure", void 0);
class TicketAddTicketProcedureListBody {
}
exports.TicketAddTicketProcedureListBody = TicketAddTicketProcedureListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketAddTicketProcedureListBody.prototype, "ticketProcedureList", void 0);


/***/ }),
/* 759 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProcedureParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketChangeProcedureParams {
}
exports.TicketChangeProcedureParams = TicketChangeProcedureParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeProcedureParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeProcedureParams.prototype, "ticketProcedureId", void 0);


/***/ }),
/* 760 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdatePriorityTicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "priority", void 0);
class TicketUpdatePriorityTicketProcedureBody {
}
exports.TicketUpdatePriorityTicketProcedureBody = TicketUpdatePriorityTicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePriorityTicketProcedureBody.prototype, "ticketProcedureList", void 0);


/***/ }),
/* 761 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketProcedureBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const request_1 = __webpack_require__(740);
class TicketProcedureItemBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureItemBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? Number(value) : value)),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureItemBody.prototype, "completedAt", void 0);
class TicketProcedureBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "totalSessions", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProcedureBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProcedureBody.prototype, "actualPrice", void 0);
class TicketUpdateTicketProcedureBody {
}
exports.TicketUpdateTicketProcedureBody = TicketUpdateTicketProcedureBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketProcedureBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureItemBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureItemBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketProcedureBody.prototype, "ticketProcedureItemList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProcedureBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProcedureBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProcedureBody)
], TicketUpdateTicketProcedureBody.prototype, "ticketProcedure", void 0);


/***/ }),
/* 762 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketProcedureUpdateResultBody = exports.TicketProcedureItemUpdateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const file_1 = __webpack_require__(262);
const request_1 = __webpack_require__(740);
class TicketProcedureItemUpdateBody extends file_1.MultipleFileUpload {
}
exports.TicketProcedureItemUpdateBody = TicketProcedureItemUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureItemUpdateBody.prototype, "ticketProcedureItemId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureItemUpdateBody.prototype, "ticketProcedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProcedureItemUpdateBody.prototype, "completedAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Trước khi vào khám 5 ngày, bla...bla...' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProcedureItemUpdateBody.prototype, "result", void 0);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsWait", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "externalUrlList", void 0);
class TicketProcedureUpdateResultBody extends file_1.MultipleFileUpload {
}
exports.TicketProcedureUpdateResultBody = TicketProcedureUpdateResultBody;
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ userId: 1, roleId: 2 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new request_1.TicketUserBasicBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length) {
                    const errValidate = validate.map((i) => {
                        const { target } = i, other = __rest(i, ["target"]);
                        return other;
                    });
                    err.push(...errValidate);
                }
                return instance;
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)({
        message: ({ value }) => `Validate TicketUserBasicBody failed. Value = ${JSON.stringify(value)}.`,
    }),
    __metadata("design:type", Array)
], TicketProcedureUpdateResultBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new TicketProcedureItemUpdateBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => {
            return `Validate imagesChange failed. Value = ${JSON.stringify(value)}: `;
        },
    }),
    __metadata("design:type", TicketProcedureItemUpdateBody)
], TicketProcedureUpdateResultBody.prototype, "ticketProcedureItem", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${value}`,
    }),
    __metadata("design:type", ImagesChangeBody)
], TicketProcedureUpdateResultBody.prototype, "imagesChange", void 0);


/***/ }),
/* 763 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProcedureService = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
const position_entity_1 = __webpack_require__(76);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const image_manager_service_1 = __webpack_require__(255);
const socket_emit_service_1 = __webpack_require__(340);
const api_ticket_procedure_service_1 = __webpack_require__(625);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeProcedureService = class TicketChangeProcedureService {
    constructor(socketEmitService, imageManagerService, ticketProcedureRepository, ticketProcedureItemRepository, ticketAddTicketProcedureListOperation, ticketClinicDestroyTicketProcedureOperation, ticketClinicUpdateTicketProcedureOperation, ticketChangeUserService, apiTicketProcedureService) {
        this.socketEmitService = socketEmitService;
        this.imageManagerService = imageManagerService;
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketProcedureItemRepository = ticketProcedureItemRepository;
        this.ticketAddTicketProcedureListOperation = ticketAddTicketProcedureListOperation;
        this.ticketClinicDestroyTicketProcedureOperation = ticketClinicDestroyTicketProcedureOperation;
        this.ticketClinicUpdateTicketProcedureOperation = ticketClinicUpdateTicketProcedureOperation;
        this.ticketChangeUserService = ticketChangeUserService;
        this.apiTicketProcedureService = apiTicketProcedureService;
    }
    async addTicketProcedureList(options) {
        const { oid, ticketId, body } = options;
        const result = await this.ticketAddTicketProcedureListOperation.addTicketProcedureList({
            oid,
            ticketId,
            ticketProcedureDtoList: body.ticketProcedureList.map((i) => {
                return Object.assign(Object.assign({}, i.ticketProcedure), { ticketProcedureItemAddList: i.ticketProcedureItemList });
            }),
        });
        const { ticketModified, ticketProcedureCreatedList } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: ticketModified });
        this.socketEmitService.socketTicketProcedureListChange(oid, {
            ticketId,
            ticketProcedureUpsertList: ticketProcedureCreatedList,
        });
        const ticketUserListBody = body.ticketProcedureList.map((i) => i.ticketUserList).flat();
        if (ticketUserListBody.length) {
            this.ticketChangeUserService.addTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    ticketUserList: body.ticketProcedureList
                        .map((i, tpIndex) => {
                        return i.ticketUserList.map((j) => {
                            const ticketProcedureCreated = ticketProcedureCreatedList[tpIndex];
                            const itemBody = Object.assign(Object.assign({}, j), { positionType: position_entity_1.PositionInteractType.Procedure, positionInteractId: ticketProcedureCreated.procedureId, ticketItemId: ticketProcedureCreated.id, quantity: ticketProcedureCreated.quantity });
                            return itemBody;
                        });
                    })
                        .flat(),
                },
            });
        }
        return true;
    }
    async destroyTicketProcedure(options) {
        const { oid, ticketId, ticketProcedureId } = options;
        const result = await this.ticketClinicDestroyTicketProcedureOperation.destroyTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
        });
        const { ticket } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketProcedureListChange(oid, {
            ticketId,
            ticketProcedureDestroyList: [result.ticketProcedureDestroy],
        });
        if (result.ticketUserDestroyList) {
            this.socketEmitService.socketTicketUserListChange(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return true;
    }
    async updateTicketProcedure(options) {
        const { oid, ticketId, ticketProcedureId, body } = options;
        const result = await this.ticketClinicUpdateTicketProcedureOperation.updateTicketProcedure({
            oid,
            ticketId,
            ticketProcedureId,
            ticketProcedureUpdateDto: body.ticketProcedure,
            ticketProcedureItemUpdateList: body.ticketProcedureItemList,
        });
        const { ticket, ticketProcedure } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketProcedureListChange(oid, {
            ticketId,
            ticketProcedureUpsertList: [ticketProcedure],
        });
        if (body.ticketUserList) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Procedure,
                    positionInteractId: ticketProcedure.procedureId,
                    ticketItemId: ticketProcedure.id,
                    quantity: ticketProcedure.quantity,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return true;
    }
    async updatePriorityTicketProcedure(options) {
        const { oid, ticketId, body } = options;
        const ticketProcedureList = await this.ticketProcedureRepository.updatePriorityList({
            oid,
            ticketId,
            updateData: body.ticketProcedureList,
        });
        ticketProcedureList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        this.socketEmitService.socketTicketProcedureListChange(oid, {
            ticketId,
            ticketProcedureUpsertList: ticketProcedureList,
        });
        return true;
    }
    async updateResultTicketProcedureItem(options) {
        var _a;
        const { oid, ticketId, body, files } = options;
        const ticketProcedureOrigin = await this.ticketProcedureRepository.findOneBy({
            oid,
            id: body.ticketProcedureItem.ticketProcedureId,
        });
        const ticketProcedureItemOrigin = await this.ticketProcedureItemRepository.findOneBy({
            oid,
            id: body.ticketProcedureItem.ticketProcedureItemId,
            ticketProcedureId: body.ticketProcedureItem.ticketProcedureId,
        });
        const { customerId } = ticketProcedureOrigin;
        let imageIdsUpdateString = ticketProcedureItemOrigin.imageIds;
        if (body.imagesChange) {
            const imageIdsUpdate = await this.imageManagerService.changeCloudinaryImageLink({
                oid,
                customerId,
                files,
                imageIdsWait: body.imagesChange.imageIdsWait,
                externalUrlList: body.imagesChange.externalUrlList,
                imageIdsOld: JSON.parse(ticketProcedureItemOrigin.imageIds),
            });
            imageIdsUpdateString = JSON.stringify(imageIdsUpdate);
        }
        const ticketProcedureItemModified = await this.ticketProcedureItemRepository.updateOneAndReturnEntity({
            oid,
            ticketId,
            id: body.ticketProcedureItem.ticketProcedureItemId,
        }, {
            result: body.ticketProcedureItem.result,
            completedAt: body.ticketProcedureItem.completedAt,
            imageIds: imageIdsUpdateString,
            status: variable_1.TicketProcedureStatus.Completed,
        });
        let ticketProcedureModified = ticketProcedureOrigin;
        if (ticketProcedureItemOrigin.status !== variable_1.TicketProcedureStatus.Completed) {
            ticketProcedureModified = await this.ticketProcedureRepository.updateOneAndReturnEntity({
                oid,
                ticketId,
                id: body.ticketProcedureItem.ticketProcedureId,
            }, {
                completedSessions: ticketProcedureOrigin.completedSessions + 1,
                status: ticketProcedureOrigin.completedSessions + 1 < ticketProcedureOrigin.totalSessions
                    ? variable_1.TicketProcedureStatus.Executing
                    : variable_1.TicketProcedureStatus.Completed,
            });
        }
        if ((_a = body.ticketUserList) === null || _a === void 0 ? void 0 : _a.length) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Procedure,
                    positionInteractId: ticketProcedureOrigin.procedureId,
                    ticketItemId: ticketProcedureOrigin.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        await this.apiTicketProcedureService.generateRelation({
            ticketProcedureList: [ticketProcedureModified],
            oid,
            relation: { ticketProcedureItemList: { imageList: true } },
        }),
            this.socketEmitService.socketTicketProcedureListChange(oid, {
                ticketId,
                ticketProcedureUpsertList: [ticketProcedureModified],
            });
        return { ticketProcedure: ticketProcedureModified };
    }
};
exports.TicketChangeProcedureService = TicketChangeProcedureService;
exports.TicketChangeProcedureService = TicketChangeProcedureService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureItemRepository !== "undefined" && repositories_1.TicketProcedureItemRepository) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketAddTicketProcedureListOperation !== "undefined" && operations_1.TicketAddTicketProcedureListOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketDestroyTicketProcedureOperation !== "undefined" && operations_1.TicketDestroyTicketProcedureOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketUpdateTicketProcedureOperation !== "undefined" && operations_1.TicketUpdateTicketProcedureOperation) === "function" ? _g : Object, typeof (_h = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _h : Object, typeof (_j = typeof api_ticket_procedure_service_1.ApiTicketProcedureService !== "undefined" && api_ticket_procedure_service_1.ApiTicketProcedureService) === "function" ? _j : Object])
], TicketChangeProcedureService);


/***/ }),
/* 764 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProductModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_change_user_module_1 = __webpack_require__(738);
const ticket_change_product_controller_1 = __webpack_require__(765);
const ticket_change_product_service_1 = __webpack_require__(774);
let TicketChangeProductModule = class TicketChangeProductModule {
};
exports.TicketChangeProductModule = TicketChangeProductModule;
exports.TicketChangeProductModule = TicketChangeProductModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_change_user_module_1.TicketChangeUserModule],
        controllers: [ticket_change_product_controller_1.TicketChangeProductController],
        providers: [ticket_change_product_service_1.TicketChangeProductService],
    })
], TicketChangeProductModule);


/***/ }),
/* 765 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19, _20, _21;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProductController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const ticket_product_entity_1 = __webpack_require__(71);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(766);
const ticket_change_product_service_1 = __webpack_require__(774);
let TicketChangeProductController = class TicketChangeProductController {
    constructor(ticketChangeProductService) {
        this.ticketChangeProductService = ticketChangeProductService;
    }
    async addTicketProduct({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.addTicketProductList({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Product,
            body,
        });
        return { data };
    }
    async addTicketProductConsumable({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.addTicketProductList({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
        return { data };
    }
    async addTicketProductPrescription({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.addTicketProductList({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
        return { data };
    }
    async destroyTicketProduct({ oid }, { ticketId, ticketProductId }) {
        const data = await this.ticketChangeProductService.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Product,
        });
        return { data };
    }
    async destroyTicketProductConsumable({ oid }, { ticketId, ticketProductId }) {
        const data = await this.ticketChangeProductService.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
        });
        return { data };
    }
    async destroyTicketProductPrescription({ oid }, { ticketId, ticketProductId }) {
        const data = await this.ticketChangeProductService.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
        });
        return { data };
    }
    async updatePriorityTicketProduct({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.updatePriorityTicketProduct({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Product,
            body,
        });
        return { data };
    }
    async updatePriorityTicketProductConsumable({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.updatePriorityTicketProduct({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
        return { data };
    }
    async updatePriorityTicketProductPrescription({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeProductService.updatePriorityTicketProduct({
            oid,
            ticketId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
        return { data };
    }
    async updateTicketProduct({ oid }, { ticketId, ticketProductId }, body) {
        const data = await this.ticketChangeProductService.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Product,
            body,
        });
        return { data };
    }
    async updateTicketProductConsumable({ oid }, { ticketId, ticketProductId }, body) {
        const data = await this.ticketChangeProductService.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Consumable,
            body,
        });
        return { data };
    }
    async updateTicketProductPrescription({ oid }, { ticketId, ticketProductId }, body) {
        const data = await this.ticketChangeProductService.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType: ticket_product_entity_1.TicketProductType.Prescription,
            body,
        });
        return { data };
    }
};
exports.TicketChangeProductController = TicketChangeProductController;
__decorate([
    (0, common_1.Post)(':ticketId/product/add-ticket-product-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_2.TicketAddTicketProductListBody !== "undefined" && request_2.TicketAddTicketProductListBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], TicketChangeProductController.prototype, "addTicketProduct", null);
__decorate([
    (0, common_1.Post)(':ticketId/consumable/add-ticket-product-consumable-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _g : Object, typeof (_h = typeof request_2.TicketAddTicketProductListBody !== "undefined" && request_2.TicketAddTicketProductListBody) === "function" ? _h : Object]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], TicketChangeProductController.prototype, "addTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':ticketId/prescription/add-ticket-product-prescription-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _k : Object, typeof (_l = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _l : Object, typeof (_m = typeof request_2.TicketAddTicketProductListBody !== "undefined" && request_2.TicketAddTicketProductListBody) === "function" ? _m : Object]),
    __metadata("design:returntype", typeof (_o = typeof Promise !== "undefined" && Promise) === "function" ? _o : Object)
], TicketChangeProductController.prototype, "addTicketProductPrescription", null);
__decorate([
    (0, common_1.Delete)(':ticketId/product/destroy-ticket-product/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _p : Object, typeof (_q = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], TicketChangeProductController.prototype, "destroyTicketProduct", null);
__decorate([
    (0, common_1.Delete)(':ticketId/consumable/destroy-ticket-product-consumable/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _t : Object]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], TicketChangeProductController.prototype, "destroyTicketProductConsumable", null);
__decorate([
    (0, common_1.Delete)(':ticketId/prescription/destroy-ticket-product-prescription/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_v = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _v : Object, typeof (_w = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _w : Object]),
    __metadata("design:returntype", typeof (_x = typeof Promise !== "undefined" && Promise) === "function" ? _x : Object)
], TicketChangeProductController.prototype, "destroyTicketProductPrescription", null);
__decorate([
    (0, common_1.Post)(':ticketId/product/update-priority-ticket-product'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_y = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _y : Object, typeof (_z = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _z : Object, typeof (_0 = typeof request_2.TicketUpdatePriorityTicketProductBody !== "undefined" && request_2.TicketUpdatePriorityTicketProductBody) === "function" ? _0 : Object]),
    __metadata("design:returntype", typeof (_1 = typeof Promise !== "undefined" && Promise) === "function" ? _1 : Object)
], TicketChangeProductController.prototype, "updatePriorityTicketProduct", null);
__decorate([
    (0, common_1.Post)(':ticketId/consumable/update-priority-ticket-product-consumable'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_2 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _2 : Object, typeof (_3 = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _3 : Object, typeof (_4 = typeof request_2.TicketUpdatePriorityTicketProductBody !== "undefined" && request_2.TicketUpdatePriorityTicketProductBody) === "function" ? _4 : Object]),
    __metadata("design:returntype", typeof (_5 = typeof Promise !== "undefined" && Promise) === "function" ? _5 : Object)
], TicketChangeProductController.prototype, "updatePriorityTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':ticketId/prescription/update-priority-ticket-product-prescription'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_6 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _6 : Object, typeof (_7 = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _7 : Object, typeof (_8 = typeof request_2.TicketUpdatePriorityTicketProductBody !== "undefined" && request_2.TicketUpdatePriorityTicketProductBody) === "function" ? _8 : Object]),
    __metadata("design:returntype", typeof (_9 = typeof Promise !== "undefined" && Promise) === "function" ? _9 : Object)
], TicketChangeProductController.prototype, "updatePriorityTicketProductPrescription", null);
__decorate([
    (0, common_1.Post)(':ticketId/product/update-ticket-product/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_10 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _10 : Object, typeof (_11 = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _11 : Object, typeof (_12 = typeof request_2.TicketUpdateTicketProductBody !== "undefined" && request_2.TicketUpdateTicketProductBody) === "function" ? _12 : Object]),
    __metadata("design:returntype", typeof (_13 = typeof Promise !== "undefined" && Promise) === "function" ? _13 : Object)
], TicketChangeProductController.prototype, "updateTicketProduct", null);
__decorate([
    (0, common_1.Post)(':ticketId/consumable/update-ticket-product-consumable/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_CONSUMABLE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_14 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _14 : Object, typeof (_15 = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _15 : Object, typeof (_16 = typeof request_2.TicketUpdateTicketProductBody !== "undefined" && request_2.TicketUpdateTicketProductBody) === "function" ? _16 : Object]),
    __metadata("design:returntype", typeof (_17 = typeof Promise !== "undefined" && Promise) === "function" ? _17 : Object)
], TicketChangeProductController.prototype, "updateTicketProductConsumable", null);
__decorate([
    (0, common_1.Post)(':ticketId/prescription/update-ticket-product-prescription/:ticketProductId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_PRESCRIPTION),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_18 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _18 : Object, typeof (_19 = typeof request_2.TicketChangeProductParams !== "undefined" && request_2.TicketChangeProductParams) === "function" ? _19 : Object, typeof (_20 = typeof request_2.TicketUpdateTicketProductBody !== "undefined" && request_2.TicketUpdateTicketProductBody) === "function" ? _20 : Object]),
    __metadata("design:returntype", typeof (_21 = typeof Promise !== "undefined" && Promise) === "function" ? _21 : Object)
], TicketChangeProductController.prototype, "updateTicketProductPrescription", null);
exports.TicketChangeProductController = TicketChangeProductController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_product_service_1.TicketChangeProductService !== "undefined" && ticket_change_product_service_1.TicketChangeProductService) === "function" ? _a : Object])
], TicketChangeProductController);


/***/ }),
/* 766 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(767), exports);
__exportStar(__webpack_require__(768), exports);
__exportStar(__webpack_require__(769), exports);
__exportStar(__webpack_require__(770), exports);
__exportStar(__webpack_require__(771), exports);
__exportStar(__webpack_require__(772), exports);
__exportStar(__webpack_require__(773), exports);


/***/ }),
/* 767 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketProductListBody = exports.TicketProductAddBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketProductAddBody {
}
exports.TicketProductAddBody = TicketProductAddBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.PickupStrategy, example: variable_1.PickupStrategy.AutoWithExpiryDate }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PickupStrategy),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketProductAddBody.prototype, "pickupStrategy", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PaymentMoneyStatus),
    (0, class_validator_1.IsIn)([variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending]),
    __metadata("design:type", typeof (_b = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _b : Object)
], TicketProductAddBody.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], TicketProductAddBody.prototype, "warehouseIds", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "printPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_c = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _c : Object)
], TicketProductAddBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductAddBody.prototype, "hintUsage", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductAddBody.prototype, "createdAt", void 0);
class TicketAddTicketProductListBody {
}
exports.TicketAddTicketProductListBody = TicketAddTicketProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductAddBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductAddBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketAddTicketProductListBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 768 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProductParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketChangeProductParams {
}
exports.TicketChangeProductParams = TicketChangeProductParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeProductParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeProductParams.prototype, "ticketProductId", void 0);


/***/ }),
/* 769 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateConsumableBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const helpers_1 = __webpack_require__(182);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketProductConsumableBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, helpers_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductConsumableBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductConsumableBody.prototype, "actualPrice", void 0);
class TicketUpdateConsumableBody {
}
exports.TicketUpdateConsumableBody = TicketUpdateConsumableBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductConsumableBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductConsumableBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateConsumableBody.prototype, "ticketProductConsumableList", void 0);


/***/ }),
/* 770 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdatePrescriptionBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const helpers_1 = __webpack_require__(182);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketProductPrescriptionBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "warehouseId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 52 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, helpers_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductPrescriptionBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketProductPrescriptionBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductPrescriptionBody.prototype, "hintUsage", void 0);
class TicketAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'advice' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketUpdatePrescriptionBody {
}
exports.TicketUpdatePrescriptionBody = TicketUpdatePrescriptionBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductPrescriptionBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductPrescriptionBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePrescriptionBody.prototype, "ticketProductPrescriptionList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ArrayMinSize)(1),
    __metadata("design:type", Array)
], TicketUpdatePrescriptionBody.prototype, "ticketAttributeKeyList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePrescriptionBody.prototype, "ticketAttributeChangeList", void 0);


/***/ }),
/* 771 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdatePriorityTicketProductBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "priority", void 0);
class TicketUpdatePriorityTicketProductBody {
}
exports.TicketUpdatePriorityTicketProductBody = TicketUpdatePriorityTicketProductBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePriorityTicketProductBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 772 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketProductListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductBody.prototype, "hintUsage", void 0);
class TicketUpdateTicketProductListBody {
}
exports.TicketUpdateTicketProductListBody = TicketUpdateTicketProductListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketProductListBody.prototype, "ticketProductList", void 0);


/***/ }),
/* 773 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateTicketProductBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const request_1 = __webpack_require__(740);
class TicketProductBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "quantityPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "printPrescription", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketProductBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketProductBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketProductBody.prototype, "hintUsage", void 0);
class TicketUpdateTicketProductBody {
}
exports.TicketUpdateTicketProductBody = TicketUpdateTicketProductBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateTicketProductBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketProductBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketProductBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketProductBody)
], TicketUpdateTicketProductBody.prototype, "ticketProduct", void 0);


/***/ }),
/* 774 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeProductService = void 0;
const common_1 = __webpack_require__(3);
const position_entity_1 = __webpack_require__(76);
const ticket_product_entity_1 = __webpack_require__(71);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeProductService = class TicketChangeProductService {
    constructor(socketEmitService, ticketProductRepository, ticketProductManager, ticketAddTicketProductOperation, ticketDestroyTicketProductOperation, ticketUpdateTicketProductOperation, ticketChangeUserService) {
        this.socketEmitService = socketEmitService;
        this.ticketProductRepository = ticketProductRepository;
        this.ticketProductManager = ticketProductManager;
        this.ticketAddTicketProductOperation = ticketAddTicketProductOperation;
        this.ticketDestroyTicketProductOperation = ticketDestroyTicketProductOperation;
        this.ticketUpdateTicketProductOperation = ticketUpdateTicketProductOperation;
        this.ticketChangeUserService = ticketChangeUserService;
    }
    async addTicketProductList(options) {
        const { oid, ticketId, ticketProductType, body } = options;
        const result = await this.ticketAddTicketProductOperation.addTicketProductList({
            oid,
            ticketId,
            ticketProductType,
            ticketProductDtoList: body.ticketProductList,
        });
        const { ticket } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Product) {
            this.socketEmitService.socketTicketProductChange(oid, {
                ticketId,
                ticketProductUpsertList: result.ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductUpsertList: result.ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductUpsertList: result.ticketProductList,
            });
        }
        return true;
    }
    async destroyTicketProduct(options) {
        const { oid, ticketId, ticketProductId, ticketProductType } = options;
        const result = await this.ticketDestroyTicketProductOperation.destroyTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType,
        });
        const { ticket, ticketProductDestroy } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        if (ticketProductDestroy.type === ticket_product_entity_1.TicketProductType.Product) {
            this.socketEmitService.socketTicketProductChange(oid, {
                ticketId,
                ticketProductDestroyList: [ticketProductDestroy],
            });
        }
        if (ticketProductDestroy.type === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductDestroyList: [ticketProductDestroy],
            });
        }
        if (ticketProductDestroy.type === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductDestroyList: [ticketProductDestroy],
            });
        }
        if (result.ticketUserDestroyList) {
            this.socketEmitService.socketTicketUserListChange(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return true;
    }
    async updatePriorityTicketProduct(options) {
        const { oid, ticketId, body, ticketProductType } = options;
        const ticketProductList = await this.ticketProductManager.bulkUpdate({
            manager: this.ticketProductRepository.getManager(),
            condition: { oid, ticketId },
            update: ['priority'],
            compare: ['id'],
            tempList: body.ticketProductList,
            options: { requireEqualLength: true },
        });
        ticketProductList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Product) {
            this.socketEmitService.socketTicketProductChange(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList,
            });
        }
        if (ticketProductType === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductReplaceList: ticketProductList,
            });
        }
        return true;
    }
    async updateTicketProduct(options) {
        const { oid, ticketId, ticketProductId, ticketProductType, body } = options;
        const result = await this.ticketUpdateTicketProductOperation.updateTicketProduct({
            oid,
            ticketId,
            ticketProductId,
            ticketProductType,
            ticketProductUpdateDto: body.ticketProduct,
        });
        const { ticket, ticketProduct } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        if (ticketProduct.type === ticket_product_entity_1.TicketProductType.Product) {
            this.socketEmitService.socketTicketProductChange(oid, {
                ticketId,
                ticketProductUpsertList: [ticketProduct],
            });
        }
        if (ticketProduct.type === ticket_product_entity_1.TicketProductType.Consumable) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductUpsertList: [ticketProduct],
            });
        }
        if (ticketProduct.type === ticket_product_entity_1.TicketProductType.Prescription) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductUpsertList: [ticketProduct],
            });
        }
        if (body.ticketUserList) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Product,
                    positionInteractId: ticketProduct.productId,
                    ticketItemId: ticketProduct.id,
                    quantity: ticketProduct.quantity,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return true;
    }
};
exports.TicketChangeProductService = TicketChangeProductService;
exports.TicketChangeProductService = TicketChangeProductService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProductManager !== "undefined" && repositories_1.TicketProductManager) === "function" ? _c : Object, typeof (_d = typeof operations_1.TicketAddTicketProductOperation !== "undefined" && operations_1.TicketAddTicketProductOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketDestroyTicketProductOperation !== "undefined" && operations_1.TicketDestroyTicketProductOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketUpdateTicketProductOperation !== "undefined" && operations_1.TicketUpdateTicketProductOperation) === "function" ? _f : Object, typeof (_g = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _g : Object])
], TicketChangeProductService);


/***/ }),
/* 775 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeRadiologyModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_radiology_module_1 = __webpack_require__(629);
const ticket_change_user_module_1 = __webpack_require__(738);
const ticket_change_radiology_controller_1 = __webpack_require__(776);
const ticket_change_radiology_service_1 = __webpack_require__(784);
let TicketChangeRadiologyModule = class TicketChangeRadiologyModule {
};
exports.TicketChangeRadiologyModule = TicketChangeRadiologyModule;
exports.TicketChangeRadiologyModule = TicketChangeRadiologyModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_change_user_module_1.TicketChangeUserModule, api_ticket_radiology_module_1.ApiTicketRadiologyModule],
        controllers: [ticket_change_radiology_controller_1.TicketChangeRadiologyController],
        providers: [ticket_change_radiology_service_1.TicketChangeRadiologyService],
    })
], TicketChangeRadiologyModule);


/***/ }),
/* 776 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeRadiologyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const interceptor_1 = __webpack_require__(250);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(327);
const request_2 = __webpack_require__(304);
const request_3 = __webpack_require__(777);
const ticket_change_radiology_service_1 = __webpack_require__(784);
let TicketChangeRadiologyController = class TicketChangeRadiologyController {
    constructor(ticketChangeRadiologyService) {
        this.ticketChangeRadiologyService = ticketChangeRadiologyService;
    }
    async addTicketRadiology({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeRadiologyService.addTicketRadiology({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async destroyTicketRadiology({ oid }, { ticketId, ticketRadiologyId }) {
        const data = await this.ticketChangeRadiologyService.destroyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
        });
        return { data };
    }
    async updateTicketLaboratory({ oid }, { ticketId, ticketRadiologyId }, body) {
        const data = await this.ticketChangeRadiologyService.updateMoneyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
            body,
        });
        return { data };
    }
    async updatePriorityTicketRadiology({ oid }, { ticketId }, body) {
        const data = await this.ticketChangeRadiologyService.updatePriorityTicketRadiology({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
    async updateResult({ oid }, { ticketId, ticketRadiologyId }, body, query, files) {
        const data = await this.ticketChangeRadiologyService.updateResult({
            oid,
            ticketRadiologyId,
            body,
            query,
            files,
        });
        return { data };
    }
    async cancelResultTicketRadiology({ oid }, { ticketId, ticketRadiologyId }, body) {
        const data = await this.ticketChangeRadiologyService.cancelResult({
            oid,
            ticketRadiologyId,
            body,
        });
        return { data };
    }
};
exports.TicketChangeRadiologyController = TicketChangeRadiologyController;
__decorate([
    (0, common_1.Post)(':ticketId/radiology/add-ticket-radiology'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_2.TicketParams !== "undefined" && request_2.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_3.TicketAddTicketRadiologyBody !== "undefined" && request_3.TicketAddTicketRadiologyBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], TicketChangeRadiologyController.prototype, "addTicketRadiology", null);
__decorate([
    (0, common_1.Delete)(':ticketId/radiology/destroy-ticket-radiology/:ticketRadiologyId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_3.TicketChangeRadiologyParams !== "undefined" && request_3.TicketChangeRadiologyParams) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketChangeRadiologyController.prototype, "destroyTicketRadiology", null);
__decorate([
    (0, common_1.Post)(':ticketId/radiology/update-money-ticket-radiology/:ticketRadiologyId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_3.TicketChangeRadiologyParams !== "undefined" && request_3.TicketChangeRadiologyParams) === "function" ? _k : Object, typeof (_l = typeof request_3.TicketUpdateMoneyTicketRadiologyBody !== "undefined" && request_3.TicketUpdateMoneyTicketRadiologyBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], TicketChangeRadiologyController.prototype, "updateTicketLaboratory", null);
__decorate([
    (0, common_1.Post)(':ticketId/radiology/update-priority-ticket-radiology'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof request_2.TicketParams !== "undefined" && request_2.TicketParams) === "function" ? _p : Object, typeof (_q = typeof request_3.TicketUpdatePriorityTicketRadiologyBody !== "undefined" && request_3.TicketUpdatePriorityTicketRadiologyBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], TicketChangeRadiologyController.prototype, "updatePriorityTicketRadiology", null);
__decorate([
    (0, common_1.Post)(':ticketId/radiology/update-result/:ticketRadiologyId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY_RESULT),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, common_1.UseInterceptors)((0, interceptor_1.FastifyFilesInterceptor)('files', 10, {})),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __param(3, (0, common_1.Query)()),
    __param(4, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_3.TicketChangeRadiologyParams !== "undefined" && request_3.TicketChangeRadiologyParams) === "function" ? _t : Object, typeof (_u = typeof request_3.TicketRadiologyUpdateResultBody !== "undefined" && request_3.TicketRadiologyUpdateResultBody) === "function" ? _u : Object, typeof (_v = typeof request_1.TicketRadiologyPostQuery !== "undefined" && request_1.TicketRadiologyPostQuery) === "function" ? _v : Object, Array]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], TicketChangeRadiologyController.prototype, "updateResult", null);
__decorate([
    (0, common_1.Post)(':ticketId/radiology/cancel-result/:ticketRadiologyId'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_RADIOLOGY_RESULT),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof request_3.TicketChangeRadiologyParams !== "undefined" && request_3.TicketChangeRadiologyParams) === "function" ? _y : Object, typeof (_z = typeof request_3.TicketRadiologyCancelResultBody !== "undefined" && request_3.TicketRadiologyCancelResultBody) === "function" ? _z : Object]),
    __metadata("design:returntype", typeof (_0 = typeof Promise !== "undefined" && Promise) === "function" ? _0 : Object)
], TicketChangeRadiologyController.prototype, "cancelResultTicketRadiology", null);
exports.TicketChangeRadiologyController = TicketChangeRadiologyController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_change_radiology_service_1.TicketChangeRadiologyService !== "undefined" && ticket_change_radiology_service_1.TicketChangeRadiologyService) === "function" ? _a : Object])
], TicketChangeRadiologyController);


/***/ }),
/* 777 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(778), exports);
__exportStar(__webpack_require__(779), exports);
__exportStar(__webpack_require__(780), exports);
__exportStar(__webpack_require__(781), exports);
__exportStar(__webpack_require__(782), exports);
__exportStar(__webpack_require__(783), exports);


/***/ }),
/* 778 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketAddTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketAddTicketRadiologyBody {
}
exports.TicketAddTicketRadiologyBody = TicketAddTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: variable_1.PaymentMoneyStatus.NoEffect }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PaymentMoneyStatus),
    (0, class_validator_1.IsIn)([variable_1.PaymentMoneyStatus.NoEffect, variable_1.PaymentMoneyStatus.Pending]),
    __metadata("design:type", typeof (_a = typeof variable_1.PaymentMoneyStatus !== "undefined" && variable_1.PaymentMoneyStatus) === "function" ? _a : Object)
], TicketAddTicketRadiologyBody.prototype, "paymentMoneyStatus", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "createdAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "radiologyId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "roomId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "costPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketAddTicketRadiologyBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketAddTicketRadiologyBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketAddTicketRadiologyBody.prototype, "description", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketAddTicketRadiologyBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketAddTicketRadiologyBody.prototype, "customStyles", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketAddTicketRadiologyBody.prototype, "customVariables", void 0);


/***/ }),
/* 779 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeRadiologyParams = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketChangeRadiologyParams {
}
exports.TicketChangeRadiologyParams = TicketChangeRadiologyParams;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeRadiologyParams.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketChangeRadiologyParams.prototype, "ticketRadiologyId", void 0);


/***/ }),
/* 780 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdatePriorityTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
class TicketRadiologyBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "priority", void 0);
class TicketUpdatePriorityTicketRadiologyBody {
}
exports.TicketUpdatePriorityTicketRadiologyBody = TicketUpdatePriorityTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketRadiologyBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketRadiologyBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdatePriorityTicketRadiologyBody.prototype, "ticketRadiologyList", void 0);


/***/ }),
/* 781 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyCancelResultBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const DOMPurify = __webpack_require__(576);
class TicketRadiologyCancelResultBody {
}
exports.TicketRadiologyCancelResultBody = TicketRadiologyCancelResultBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyCancelResultBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Mổ viêm ruột thừa 2002' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => DOMPurify.sanitize(value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyCancelResultBody.prototype, "description", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Trước khi vào khám 5 ngày, bla...bla...' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyCancelResultBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyCancelResultBody.prototype, "customStyles", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyCancelResultBody.prototype, "customVariables", void 0);


/***/ }),
/* 782 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketRadiologyUpdateResultBody = exports.TicketRadiologyUpdateBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const DOMPurify = __webpack_require__(576);
const file_1 = __webpack_require__(262);
const request_1 = __webpack_require__(740);
class TicketRadiologyUpdateBody extends file_1.MultipleFileUpload {
}
exports.TicketRadiologyUpdateBody = TicketRadiologyUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyUpdateBody.prototype, "printHtmlId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Mổ viêm ruột thừa 2002' }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => DOMPurify.sanitize(value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "description", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Trước khi vào khám 5 ngày, bla...bla...' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "result", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "customStyles", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketRadiologyUpdateBody.prototype, "customVariables", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => (value != null ? Number(value) : value)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketRadiologyUpdateBody.prototype, "completedAt", void 0);
class ImagesChangeBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.IsNumber)({}, { each: true }),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "imageIdsWait", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    __metadata("design:type", Array)
], ImagesChangeBody.prototype, "externalUrlList", void 0);
class TicketRadiologyUpdateResultBody extends file_1.MultipleFileUpload {
}
exports.TicketRadiologyUpdateResultBody = TicketRadiologyUpdateResultBody;
__decorate([
    (0, swagger_1.ApiProperty)({
        type: 'string',
        example: JSON.stringify([{ userId: 1, roleId: 2 }]),
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                const instance = Object.assign(new request_1.TicketUserBasicBody(), i);
                const validate = (0, class_validator_1.validateSync)(instance, {
                    whitelist: true,
                    forbidNonWhitelisted: true,
                    skipMissingProperties: true,
                });
                if (validate.length) {
                    const errValidate = validate.map((i) => {
                        const { target } = i, other = __rest(i, ["target"]);
                        return other;
                    });
                    err.push(...errValidate);
                }
                return instance;
            });
            if (err.length)
                return JSON.stringify(err);
            else
                return result;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsArray)({
        message: ({ value }) => `Validate TicketUserBasicBody failed. Value = ${JSON.stringify(value)}.`,
    }),
    __metadata("design:type", Array)
], TicketRadiologyUpdateResultBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new TicketRadiologyUpdateBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => {
            return `Validate imagesChange failed. Value = ${JSON.stringify(value)}: `;
        },
    }),
    __metadata("design:type", TicketRadiologyUpdateBody)
], TicketRadiologyUpdateResultBody.prototype, "ticketRadiology", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        if (value === undefined)
            return undefined;
        try {
            const instance = Object.assign(new ImagesChangeBody(), JSON.parse(value));
            const validate = (0, class_validator_1.validateSync)(instance, {
                whitelist: true,
                forbidNonWhitelisted: true,
                skipMissingProperties: true,
            });
            if (validate.length) {
                const errValidate = validate.map((i) => {
                    const { target } = i, other = __rest(i, ["target"]);
                    return other;
                });
                return JSON.stringify(errValidate);
            }
            return instance;
        }
        catch (error) {
            return error.message;
        }
    }),
    (0, class_validator_1.IsObject)({
        message: ({ value }) => `Validate imagesChange failed. Value = ${value}`,
    }),
    __metadata("design:type", ImagesChangeBody)
], TicketRadiologyUpdateResultBody.prototype, "imagesChange", void 0);


/***/ }),
/* 783 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketUpdateMoneyTicketRadiologyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const request_1 = __webpack_require__(740);
class TicketRadiologyBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketRadiologyBody.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketRadiologyBody.prototype, "actualPrice", void 0);
class TicketUpdateMoneyTicketRadiologyBody {
}
exports.TicketUpdateMoneyTicketRadiologyBody = TicketUpdateMoneyTicketRadiologyBody;
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: request_1.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.TicketUserBasicBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketUpdateMoneyTicketRadiologyBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketRadiologyBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketRadiologyBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketRadiologyBody)
], TicketUpdateMoneyTicketRadiologyBody.prototype, "ticketRadiology", void 0);


/***/ }),
/* 784 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketChangeRadiologyService = void 0;
const common_1 = __webpack_require__(3);
const error_1 = __webpack_require__(14);
const position_entity_1 = __webpack_require__(76);
const ticket_radiology_entity_1 = __webpack_require__(72);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const image_manager_service_1 = __webpack_require__(255);
const socket_emit_service_1 = __webpack_require__(340);
const api_ticket_radiology_service_1 = __webpack_require__(631);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketChangeRadiologyService = class TicketChangeRadiologyService {
    constructor(socketEmitService, imageManagerService, ticketRadiologyRepository, ticketRadiologyManager, ticketAddTicketRadiologyOperation, ticketDestroyTicketRadiologyOperation, ticketUpdateTicketRadiologyOperation, ticketChangeUserService, apiTicketRadiologyService) {
        this.socketEmitService = socketEmitService;
        this.imageManagerService = imageManagerService;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.ticketRadiologyManager = ticketRadiologyManager;
        this.ticketAddTicketRadiologyOperation = ticketAddTicketRadiologyOperation;
        this.ticketDestroyTicketRadiologyOperation = ticketDestroyTicketRadiologyOperation;
        this.ticketUpdateTicketRadiologyOperation = ticketUpdateTicketRadiologyOperation;
        this.ticketChangeUserService = ticketChangeUserService;
        this.apiTicketRadiologyService = apiTicketRadiologyService;
    }
    async addTicketRadiology(options) {
        const { oid, ticketId, body } = options;
        const result = await this.ticketAddTicketRadiologyOperation.addTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyInsertDto: Object.assign(Object.assign({}, body), { oid,
                ticketId, imageIds: JSON.stringify([]), completedAt: null, status: ticket_radiology_entity_1.TicketRadiologyStatus.Pending }),
        });
        const { ticket, ticketRadiology } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId,
            ticketRadiologyUpsertList: [ticketRadiology],
        });
        return true;
    }
    async destroyTicketRadiology(options) {
        const { oid, ticketId, ticketRadiologyId } = options;
        const ticketRadiologyOrigin = await this.ticketRadiologyRepository.findOneBy({
            oid,
            id: ticketRadiologyId,
        });
        if (ticketRadiologyOrigin.status === ticket_radiology_entity_1.TicketRadiologyStatus.Completed) {
            throw new error_1.BusinessError('Phiếu đã hoàn thành không thể xóa');
        }
        const imageIdsUpdate = await this.imageManagerService.removeImageList({
            oid,
            idRemoveList: JSON.parse(ticketRadiologyOrigin.imageIds),
        });
        const result = await this.ticketDestroyTicketRadiologyOperation.destroyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
        });
        const { ticket } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket });
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId,
            ticketRadiologyDestroyList: [result.ticketRadiologyDestroy],
        });
        if (result.ticketUserDestroyList.length) {
            this.socketEmitService.socketTicketUserListChange(oid, {
                ticketId,
                ticketUserDestroyList: result.ticketUserDestroyList,
            });
        }
        return true;
    }
    async updateMoneyTicketRadiology(options) {
        var _a;
        const { oid, ticketId, ticketRadiologyId, body } = options;
        const result = await this.ticketUpdateTicketRadiologyOperation.updateMoneyTicketRadiology({
            oid,
            ticketId,
            ticketRadiologyId,
            ticketRadiologyUpdateDto: body.ticketRadiology,
        });
        const { ticket, ticketRadiology } = result;
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: result.ticket });
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId,
            ticketRadiologyUpsertList: [result.ticketRadiology],
        });
        if ((_a = body.ticketUserList) === null || _a === void 0 ? void 0 : _a.length) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Radiology,
                    positionInteractId: ticketRadiology.radiologyId,
                    ticketItemId: ticketRadiology.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        return true;
    }
    async updatePriorityTicketRadiology(options) {
        const { oid, ticketId, body } = options;
        const ticketRadiologyList = await this.ticketRadiologyManager.bulkUpdate({
            manager: this.ticketRadiologyRepository.getManager(),
            condition: { oid, ticketId },
            compare: ['id'],
            update: ['priority'],
            tempList: body.ticketRadiologyList,
            options: { requireEqualLength: true },
        });
        ticketRadiologyList.sort((a, b) => (a.priority < b.priority ? -1 : 1));
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId,
            ticketRadiologyUpsertList: ticketRadiologyList,
        });
        return true;
    }
    async updateResult(options) {
        var _a, _b, _c, _d, _e, _f;
        const { oid, ticketRadiologyId, body, files } = options;
        const response = (_a = options.query) === null || _a === void 0 ? void 0 : _a.response;
        const ticketRadiologyOrigin = await this.ticketRadiologyRepository.findOneBy({
            oid,
            id: ticketRadiologyId,
        });
        const { ticketId, customerId } = ticketRadiologyOrigin;
        let imageIdsUpdateString = ticketRadiologyOrigin.imageIds;
        if (body.imagesChange) {
            const imageIdsUpdate = await this.imageManagerService.changeCloudinaryImageLink({
                oid,
                customerId,
                files,
                imageIdsWait: body.imagesChange.imageIdsWait,
                externalUrlList: body.imagesChange.externalUrlList,
                imageIdsOld: JSON.parse(ticketRadiologyOrigin.imageIds),
            });
            imageIdsUpdateString = JSON.stringify(imageIdsUpdate);
        }
        const ticketRadiologyModified = await this.ticketRadiologyRepository.updateOneAndReturnEntity({
            oid,
            ticketId,
            id: ticketRadiologyId,
        }, {
            printHtmlId: body.ticketRadiology.printHtmlId,
            description: body.ticketRadiology.description,
            customStyles: body.ticketRadiology.customStyles,
            customVariables: body.ticketRadiology.customVariables,
            result: body.ticketRadiology.result,
            completedAt: body.ticketRadiology.completedAt,
            imageIds: imageIdsUpdateString,
            status: ticket_radiology_entity_1.TicketRadiologyStatus.Completed,
        });
        if ((_b = body.ticketUserList) === null || _b === void 0 ? void 0 : _b.length) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Radiology,
                    positionInteractId: ticketRadiologyModified.radiologyId,
                    ticketItemId: ticketRadiologyModified.id,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        await this.apiTicketRadiologyService.generateRelation([ticketRadiologyModified], {
            radiology: false,
            ticket: (_c = response === null || response === void 0 ? void 0 : response.ticketRadiology) === null || _c === void 0 ? void 0 : _c.ticket,
            customer: (_d = response === null || response === void 0 ? void 0 : response.ticketRadiology) === null || _d === void 0 ? void 0 : _d.customer,
            ticketUserList: (_e = response === null || response === void 0 ? void 0 : response.ticketRadiology) === null || _e === void 0 ? void 0 : _e.ticketUserList,
            imageList: (_f = response === null || response === void 0 ? void 0 : response.ticketRadiology) === null || _f === void 0 ? void 0 : _f.imageList,
        });
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId,
            ticketRadiologyUpsertList: [ticketRadiologyModified],
        });
        return { ticketRadiology: ticketRadiologyModified };
    }
    async cancelResult(options) {
        const { oid, ticketRadiologyId, body } = options;
        const ticketRadiologyOrigin = await this.ticketRadiologyRepository.findOneBy({
            oid,
            id: ticketRadiologyId,
        });
        await this.imageManagerService.removeImageList({
            oid,
            idRemoveList: JSON.parse(ticketRadiologyOrigin.imageIds),
        });
        const ticketRadiologyModified = await this.ticketRadiologyRepository.updateOneAndReturnEntity({
            oid,
            ticketId: ticketRadiologyOrigin.ticketId,
            id: ticketRadiologyId,
        }, {
            printHtmlId: body.printHtmlId,
            description: body.description,
            result: body.result,
            customStyles: body.customStyles,
            customVariables: body.customVariables,
            completedAt: null,
            imageIds: JSON.stringify([]),
            status: ticket_radiology_entity_1.TicketRadiologyStatus.Pending,
        });
        ticketRadiologyModified.imageList = [];
        this.socketEmitService.socketTicketRadiologyListChange(oid, {
            ticketId: ticketRadiologyOrigin.ticketId,
            ticketRadiologyUpsertList: [ticketRadiologyModified],
        });
        return { ticketRadiology: ticketRadiologyModified };
    }
};
exports.TicketChangeRadiologyService = TicketChangeRadiologyService;
exports.TicketChangeRadiologyService = TicketChangeRadiologyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof image_manager_service_1.ImageManagerService !== "undefined" && image_manager_service_1.ImageManagerService) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRadiologyManager !== "undefined" && repositories_1.TicketRadiologyManager) === "function" ? _d : Object, typeof (_e = typeof operations_1.TicketAddTicketRadiologyOperation !== "undefined" && operations_1.TicketAddTicketRadiologyOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.TicketDestroyTicketRadiologyOperation !== "undefined" && operations_1.TicketDestroyTicketRadiologyOperation) === "function" ? _f : Object, typeof (_g = typeof operations_1.TicketUpdateTicketRadiologyOperation !== "undefined" && operations_1.TicketUpdateTicketRadiologyOperation) === "function" ? _g : Object, typeof (_h = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _h : Object, typeof (_j = typeof api_ticket_radiology_service_1.ApiTicketRadiologyService !== "undefined" && api_ticket_radiology_service_1.ApiTicketRadiologyService) === "function" ? _j : Object])
], TicketChangeRadiologyService);


/***/ }),
/* 785 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketMoneyModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_money_controller_1 = __webpack_require__(786);
const ticket_money_service_1 = __webpack_require__(792);
let TicketMoneyModule = class TicketMoneyModule {
};
exports.TicketMoneyModule = TicketMoneyModule;
exports.TicketMoneyModule = TicketMoneyModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_money_controller_1.ApiTicketMoneyController],
        providers: [ticket_money_service_1.TicketMoneyService],
        exports: [ticket_money_service_1.TicketMoneyService],
    })
], TicketMoneyModule);


/***/ }),
/* 786 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketMoneyController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(787);
const ticket_money_service_1 = __webpack_require__(792);
let ApiTicketMoneyController = class ApiTicketMoneyController {
    constructor(ticketMoneyService) {
        this.ticketMoneyService = ticketMoneyService;
    }
    async prepaymentMoney({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketMoneyService.prepaymentMoney({
            oid,
            ticketId,
            userId: uid,
            body,
        });
        return { data };
    }
    async payDebt({ oid, uid }, body) {
        const data = await this.ticketMoneyService.payDebt({
            oid,
            userId: uid,
            body,
        });
        return { data };
    }
    async refundMoney({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketMoneyService.refundMoney({ oid, ticketId, userId: uid, body });
        return { data };
    }
    async customerPrepaymentTicketItemList({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketMoneyService.prepaymentTicketItemList({
            oid,
            ticketId,
            userId: uid,
            body,
        });
        return { data };
    }
    async refundTicketItemList({ oid, uid }, { ticketId }, body) {
        const data = await this.ticketMoneyService.refundTicketItemList({
            oid,
            ticketId,
            userId: uid,
            body,
        });
        return { data };
    }
};
exports.ApiTicketMoneyController = ApiTicketMoneyController;
__decorate([
    (0, common_1.Post)(':ticketId/prepayment-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _c : Object, typeof (_d = typeof request_2.CustomerPrepaymentBody !== "undefined" && request_2.CustomerPrepaymentBody) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ApiTicketMoneyController.prototype, "prepaymentMoney", null);
__decorate([
    (0, common_1.Post)('pay-debt'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _f : Object, typeof (_g = typeof request_2.CustomerPayDebtBody !== "undefined" && request_2.CustomerPayDebtBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketMoneyController.prototype, "payDebt", null);
__decorate([
    (0, common_1.Post)(':ticketId/refund-money'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_REFUND_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _k : Object, typeof (_l = typeof request_2.CustomerRefundMoneyBody !== "undefined" && request_2.CustomerRefundMoneyBody) === "function" ? _l : Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], ApiTicketMoneyController.prototype, "refundMoney", null);
__decorate([
    (0, common_1.Post)(':ticketId/prepayment-ticket-item-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_o = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _o : Object, typeof (_p = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _p : Object, typeof (_q = typeof request_2.CustomerPrepaymentTicketItemListBody !== "undefined" && request_2.CustomerPrepaymentTicketItemListBody) === "function" ? _q : Object]),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], ApiTicketMoneyController.prototype, "customerPrepaymentTicketItemList", null);
__decorate([
    (0, common_1.Post)(':ticketId/refund-ticket-item-list'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_REFUND_MONEY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_s = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _s : Object, typeof (_t = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _t : Object, typeof (_u = typeof request_2.CustomerRefundTicketItemListBody !== "undefined" && request_2.CustomerRefundTicketItemListBody) === "function" ? _u : Object]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], ApiTicketMoneyController.prototype, "refundTicketItemList", null);
exports.ApiTicketMoneyController = ApiTicketMoneyController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_money_service_1.TicketMoneyService !== "undefined" && ticket_money_service_1.TicketMoneyService) === "function" ? _a : Object])
], ApiTicketMoneyController);


/***/ }),
/* 787 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(788), exports);
__exportStar(__webpack_require__(789), exports);
__exportStar(__webpack_require__(790), exports);
__exportStar(__webpack_require__(791), exports);


/***/ }),
/* 788 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPayDebtBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class DataList {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], DataList.prototype, "ticketId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], DataList.prototype, "paidAmount", void 0);
class CustomerPayDebtBody {
}
exports.CustomerPayDebtBody = CustomerPayDebtBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPayDebtBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPayDebtBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerPayDebtBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerPayDebtBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: DataList, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => DataList),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], CustomerPayDebtBody.prototype, "dataList", void 0);


/***/ }),
/* 789 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRefundTicketItemListBody = exports.CustomerPrepaymentTicketItemListBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const payment_ticket_item_entity_1 = __webpack_require__(81);
class TicketItemBody {
}
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "ticketItemId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(payment_ticket_item_entity_1.TicketItemType),
    __metadata("design:type", typeof (_a = typeof payment_ticket_item_entity_1.TicketItemType !== "undefined" && payment_ticket_item_entity_1.TicketItemType) === "function" ? _a : Object)
], TicketItemBody.prototype, "ticketItemType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "interactId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "expectedPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "discountMoney", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "discountPercent", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketItemBody.prototype, "discountType", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "actualPrice", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", Number)
], TicketItemBody.prototype, "quantity", void 0);
class CustomerPrepaymentTicketItemListBody {
}
exports.CustomerPrepaymentTicketItemListBody = CustomerPrepaymentTicketItemListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPrepaymentTicketItemListBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPrepaymentTicketItemListBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerPrepaymentTicketItemListBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerPrepaymentTicketItemListBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => TicketItemBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], CustomerPrepaymentTicketItemListBody.prototype, "ticketItemList", void 0);
class CustomerRefundTicketItemListBody {
}
exports.CustomerRefundTicketItemListBody = CustomerRefundTicketItemListBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerRefundTicketItemListBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerRefundTicketItemListBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerRefundTicketItemListBody.prototype, "refundAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerRefundTicketItemListBody.prototype, "note", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketItemBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => TicketItemBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], CustomerRefundTicketItemListBody.prototype, "ticketItemList", void 0);


/***/ }),
/* 790 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerPrepaymentBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class CustomerPrepaymentBody {
}
exports.CustomerPrepaymentBody = CustomerPrepaymentBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPrepaymentBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerPrepaymentBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerPrepaymentBody.prototype, "paidAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerPrepaymentBody.prototype, "note", void 0);


/***/ }),
/* 791 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CustomerRefundMoneyBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class CustomerRefundMoneyBody {
}
exports.CustomerRefundMoneyBody = CustomerRefundMoneyBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerRefundMoneyBody.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], CustomerRefundMoneyBody.prototype, "paymentMethodId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], CustomerRefundMoneyBody.prototype, "refundAmount", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Khách hàng còn bo thêm tiền' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], CustomerRefundMoneyBody.prototype, "note", void 0);


/***/ }),
/* 792 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketMoneyService = void 0;
const common_1 = __webpack_require__(3);
const operations_1 = __webpack_require__(164);
const socket_emit_service_1 = __webpack_require__(340);
let TicketMoneyService = class TicketMoneyService {
    constructor(socketEmitService, customerPayDebtOperation, customerPrepaymentMoneyOperation, customerPrepaymentTicketItemListOperation, customerRefundMoneyOperation, customerRefundTicketItemListOperation) {
        this.socketEmitService = socketEmitService;
        this.customerPayDebtOperation = customerPayDebtOperation;
        this.customerPrepaymentMoneyOperation = customerPrepaymentMoneyOperation;
        this.customerPrepaymentTicketItemListOperation = customerPrepaymentTicketItemListOperation;
        this.customerRefundMoneyOperation = customerRefundMoneyOperation;
        this.customerRefundTicketItemListOperation = customerRefundTicketItemListOperation;
    }
    async prepaymentMoney(data) {
        const { oid, ticketId, userId, body, options } = data;
        const prepaymentResult = await this.customerPrepaymentMoneyOperation.startPrePaymentMoney({
            oid,
            ticketId,
            customerId: body.customerId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            paidAmount: body.paidAmount,
            note: body.note,
        });
        const { ticketModified, customer, paymentCreated } = prepaymentResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        return { ticketModified, customer, paymentCreated };
    }
    async payDebt(data) {
        const { oid, userId, body, options } = data;
        const payDebtResult = await this.customerPayDebtOperation.startPayDebt({
            oid,
            customerId: body.customerId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            paidAmount: body.paidAmount,
            note: body.note,
            dataList: body.dataList,
        });
        const { ticketModifiedList, customerModified, paymentCreatedList } = payDebtResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: ticketModifiedList });
        }
        if (!(options === null || options === void 0 ? void 0 : options.noEmitCustomer)) {
            this.socketEmitService.customerUpsert(oid, { customer: customerModified });
        }
        return { ticketModifiedList, customerModified, paymentCreatedList };
    }
    async refundMoney(data) {
        const { oid, ticketId, userId, body, options } = data;
        const payDebtResult = await this.customerRefundMoneyOperation.startRefundMoney({
            oid,
            ticketId,
            customerId: body.customerId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            refundAmount: body.refundAmount,
            note: body.note,
        });
        const { ticketModified, customer, paymentCreated } = payDebtResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        return { ticketModified, customer, paymentCreated };
    }
    async prepaymentTicketItemList(data) {
        var _a, _b, _c, _d, _e;
        const { oid, ticketId, userId, body, options } = data;
        const prepaymentResult = await this.customerPrepaymentTicketItemListOperation.startPrepaymentTicketItemList({
            oid,
            ticketId,
            customerId: body.customerId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            note: body.note,
            paidAmount: body.paidAmount,
            ticketItemList: body.ticketItemList,
        });
        const { ticketModified, customer, paymentCreated } = prepaymentResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        if ((_a = prepaymentResult.ticketProcedureModifiedList) === null || _a === void 0 ? void 0 : _a.length) {
            this.socketEmitService.socketTicketProcedureListChange(oid, {
                ticketId,
                ticketProcedureUpsertList: prepaymentResult.ticketProcedureModifiedList,
            });
        }
        if ((_b = prepaymentResult.ticketProductConsumableModifiedList) === null || _b === void 0 ? void 0 : _b.length) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductUpsertList: prepaymentResult.ticketProductConsumableModifiedList,
            });
        }
        if ((_c = prepaymentResult.ticketProductPrescriptionModifiedList) === null || _c === void 0 ? void 0 : _c.length) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductUpsertList: prepaymentResult.ticketProductPrescriptionModifiedList,
            });
        }
        if ((_d = prepaymentResult.ticketLaboratoryModifiedList) === null || _d === void 0 ? void 0 : _d.length) {
            this.socketEmitService.socketTicketLaboratoryListChange(oid, {
                ticketId,
                ticketLaboratoryUpsertList: prepaymentResult.ticketLaboratoryModifiedList,
                ticketLaboratoryGroupUpsertList: prepaymentResult.ticketLaboratoryGroupModifiedList || [],
            });
        }
        if ((_e = prepaymentResult.ticketRadiologyModifiedList) === null || _e === void 0 ? void 0 : _e.length) {
            this.socketEmitService.socketTicketRadiologyListChange(oid, {
                ticketId,
                ticketRadiologyUpsertList: prepaymentResult.ticketRadiologyModifiedList,
            });
        }
        return { ticketModified, customer, paymentCreated };
    }
    async refundTicketItemList(params) {
        var _a, _b, _c, _d, _e;
        const { oid, ticketId, userId, body, options } = params;
        const refundResult = await this.customerRefundTicketItemListOperation.startRefundTicketItemList({
            oid,
            ticketId,
            customerId: body.customerId,
            cashierId: userId,
            paymentMethodId: body.paymentMethodId,
            time: Date.now(),
            refundAmount: body.refundAmount,
            note: body.note,
            ticketItemList: body.ticketItemList,
        });
        const { ticketModified, customer, paymentCreated } = refundResult;
        if (!(options === null || options === void 0 ? void 0 : options.noEmitTicket)) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        if ((_a = refundResult.ticketProcedureModifiedList) === null || _a === void 0 ? void 0 : _a.length) {
            this.socketEmitService.socketTicketProcedureListChange(oid, {
                ticketId,
                ticketProcedureUpsertList: refundResult.ticketProcedureModifiedList,
            });
        }
        if ((_b = refundResult.ticketProductConsumableModifiedList) === null || _b === void 0 ? void 0 : _b.length) {
            this.socketEmitService.socketTicketConsumableChange(oid, {
                ticketId,
                ticketProductUpsertList: refundResult.ticketProductConsumableModifiedList,
            });
        }
        if ((_c = refundResult.ticketProductPrescriptionModifiedList) === null || _c === void 0 ? void 0 : _c.length) {
            this.socketEmitService.socketTicketPrescriptionChange(oid, {
                ticketId,
                ticketProductUpsertList: refundResult.ticketProductPrescriptionModifiedList,
            });
        }
        if ((_d = refundResult.ticketLaboratoryModifiedList) === null || _d === void 0 ? void 0 : _d.length) {
            this.socketEmitService.socketTicketLaboratoryListChange(oid, {
                ticketId,
                ticketLaboratoryUpsertList: refundResult.ticketLaboratoryModifiedList,
                ticketLaboratoryGroupUpsertList: refundResult.ticketLaboratoryGroupModifiedList || [],
            });
        }
        if ((_e = refundResult.ticketRadiologyModifiedList) === null || _e === void 0 ? void 0 : _e.length) {
            this.socketEmitService.socketTicketRadiologyListChange(oid, {
                ticketId,
                ticketRadiologyUpsertList: refundResult.ticketRadiologyModifiedList,
            });
        }
        return { ticketModified, customer, paymentCreated };
    }
};
exports.TicketMoneyService = TicketMoneyService;
exports.TicketMoneyService = TicketMoneyService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof operations_1.CustomerPayDebtOperation !== "undefined" && operations_1.CustomerPayDebtOperation) === "function" ? _b : Object, typeof (_c = typeof operations_1.CustomerPrepaymentMoneyOperation !== "undefined" && operations_1.CustomerPrepaymentMoneyOperation) === "function" ? _c : Object, typeof (_d = typeof operations_1.CustomerPrepaymentTicketItemListOperation !== "undefined" && operations_1.CustomerPrepaymentTicketItemListOperation) === "function" ? _d : Object, typeof (_e = typeof operations_1.CustomerRefundMoneyOperation !== "undefined" && operations_1.CustomerRefundMoneyOperation) === "function" ? _e : Object, typeof (_f = typeof operations_1.CustomerRefundTicketItemListOperation !== "undefined" && operations_1.CustomerRefundTicketItemListOperation) === "function" ? _f : Object])
], TicketMoneyService);


/***/ }),
/* 793 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_action_service_1 = __webpack_require__(730);
const ticket_money_module_1 = __webpack_require__(785);
const ticket_order_controller_1 = __webpack_require__(794);
const ticket_order_service_1 = __webpack_require__(801);
let TicketOrderModule = class TicketOrderModule {
};
exports.TicketOrderModule = TicketOrderModule;
exports.TicketOrderModule = TicketOrderModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_money_module_1.TicketMoneyModule],
        controllers: [ticket_order_controller_1.TicketOrderController],
        providers: [ticket_order_service_1.TicketOrderService, ticket_action_service_1.TicketActionService],
    })
], TicketOrderModule);


/***/ }),
/* 794 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(725);
const request_2 = __webpack_require__(795);
const ticket_order_service_1 = __webpack_require__(801);
let TicketOrderController = class TicketOrderController {
    constructor(ticketOrderService) {
        this.ticketOrderService = ticketOrderService;
    }
    async draftUpsert({ oid, uid }, body) {
        const data = await this.ticketOrderService.draftUpsert({
            oid,
            userId: uid,
            body,
        });
        return { data };
    }
    async depositedUpdate({ oid, uid }, { id }, body) {
        const data = await this.ticketOrderService.depositedUpdate({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
        return { data };
    }
    async debtSuccessCreate({ oid, uid }, body) {
        const data = await this.ticketOrderService.debtSuccessCreate({
            oid,
            userId: uid,
            body,
        });
        return { data };
    }
    async debtSuccessUpdate({ oid, uid }, { id }, body) {
        const data = await this.ticketOrderService.debtSuccessUpdate({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
        return { data };
    }
    async draftDestroy({ oid }, { id }) {
        const data = await this.ticketOrderService.destroy({
            oid,
            ticketId: id,
        });
        return { data };
    }
    async depositedDestroy({ oid }, { id }) {
        const data = await this.ticketOrderService.destroy({
            oid,
            ticketId: id,
        });
        return { data };
    }
    async destroy({ oid }, { id }) {
        const data = await this.ticketOrderService.destroy({
            oid,
            ticketId: id,
        });
        return { data };
    }
    async sendProductAndPaymentAndClose({ oid, uid }, { id }, body) {
        const data = await this.ticketOrderService.sendProductAndPaymentAndClose({
            oid,
            userId: uid,
            ticketId: id,
            body,
        });
        return { data };
    }
};
exports.TicketOrderController = TicketOrderController;
__decorate([
    (0, common_1.Post)('/order/draft-upsert'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_2.TicketOrderDraftUpsertBody !== "undefined" && request_2.TicketOrderDraftUpsertBody) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], TicketOrderController.prototype, "draftUpsert", null);
__decorate([
    (0, common_1.Patch)('/order/:id/deposited-update'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT, permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketOrderDepositedUpdateBody !== "undefined" && request_2.TicketOrderDepositedUpdateBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], TicketOrderController.prototype, "depositedUpdate", null);
__decorate([
    (0, common_1.Post)('/order/debt-success-create'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT, permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT, permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY, permission_enum_1.PermissionId.TICKET_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _j : Object, typeof (_k = typeof request_2.TicketOrderDebtSuccessInsertBody !== "undefined" && request_2.TicketOrderDebtSuccessInsertBody) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], TicketOrderController.prototype, "debtSuccessCreate", null);
__decorate([
    (0, common_1.Patch)('/order/:id/debt-success-update'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT, permission_enum_1.PermissionId.TICKET_CHANGE_PROCEDURE, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT, permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_RETURN_PRODUCT, permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY, permission_enum_1.PermissionId.TICKET_REOPEN, permission_enum_1.PermissionId.TICKET_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _m : Object, typeof (_o = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _o : Object, typeof (_p = typeof request_2.TicketOrderDebtSuccessUpdateBody !== "undefined" && request_2.TicketOrderDebtSuccessUpdateBody) === "function" ? _p : Object]),
    __metadata("design:returntype", typeof (_q = typeof Promise !== "undefined" && Promise) === "function" ? _q : Object)
], TicketOrderController.prototype, "debtSuccessUpdate", null);
__decorate([
    (0, common_1.Delete)('/order/:id/draft-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _r : Object, typeof (_s = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _s : Object]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], TicketOrderController.prototype, "draftDestroy", null);
__decorate([
    (0, common_1.Delete)('/order/:id/deposited-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_u = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _u : Object, typeof (_v = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _v : Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], TicketOrderController.prototype, "depositedDestroy", null);
__decorate([
    (0, common_1.Delete)('/order/:id/cancelled-destroy'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_DESTROY),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_x = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _x : Object, typeof (_y = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _y : Object]),
    __metadata("design:returntype", typeof (_z = typeof Promise !== "undefined" && Promise) === "function" ? _z : Object)
], TicketOrderController.prototype, "destroy", null);
__decorate([
    (0, common_1.Post)('/order/:id/send-product-and-payment-and-close'),
    (0, user_guard_1.UserPermission)(permission_enum_1.PermissionId.TICKET_CHANGE_PRODUCT_SEND_PRODUCT, permission_enum_1.PermissionId.TICKET_PAYMENT_MONEY, permission_enum_1.PermissionId.TICKET_CLOSE),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_0 = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _0 : Object, typeof (_1 = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _1 : Object, typeof (_2 = typeof request_1.TicketSendProductAndPaymentBody !== "undefined" && request_1.TicketSendProductAndPaymentBody) === "function" ? _2 : Object]),
    __metadata("design:returntype", typeof (_3 = typeof Promise !== "undefined" && Promise) === "function" ? _3 : Object)
], TicketOrderController.prototype, "sendProductAndPaymentAndClose", null);
exports.TicketOrderController = TicketOrderController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_order_service_1.TicketOrderService !== "undefined" && ticket_order_service_1.TicketOrderService) === "function" ? _a : Object])
], TicketOrderController);


/***/ }),
/* 795 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(796), exports);
__exportStar(__webpack_require__(797), exports);
__exportStar(__webpack_require__(798), exports);
__exportStar(__webpack_require__(799), exports);
__exportStar(__webpack_require__(800), exports);


/***/ }),
/* 796 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderExpenseDraft = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketOrderExpenseDraft {
}
exports.TicketOrderExpenseDraft = TicketOrderExpenseDraft;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderExpenseDraft.prototype, "expenseId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderExpenseDraft.prototype, "money", void 0);


/***/ }),
/* 797 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderProcedureDraft = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketOrderProcedureDraft {
}
exports.TicketOrderProcedureDraft = TicketOrderProcedureDraft;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "procedureId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "totalSessions", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketOrderProcedureDraft.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProcedureDraft.prototype, "actualPrice", void 0);


/***/ }),
/* 798 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderProductDraft = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const typescript_helper_1 = __webpack_require__(190);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
class TicketOrderProductDraft {
}
exports.TicketOrderProductDraft = TicketOrderProductDraft;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "priority", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.PickupStrategy, example: variable_1.PickupStrategy.AutoWithExpiryDate }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.PickupStrategy),
    __metadata("design:type", typeof (_a = typeof variable_1.PickupStrategy !== "undefined" && variable_1.PickupStrategy) === "function" ? _a : Object)
], TicketOrderProductDraft.prototype, "pickupStrategy", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ type: 'string', example: JSON.stringify([1, 5, 10]) }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Transform)(({ value }) => {
        try {
            const err = [];
            const result = JSON.parse(value).map((i) => {
                if (!Number.isInteger)
                    err.push(`${i} is not integer`);
                return i;
            });
            if (err.length)
                return err;
            else
                return JSON.stringify(result);
        }
        catch (error) {
            return [error.message];
        }
    }),
    (0, class_validator_1.IsString)({ message: `Validate warehouseIds failed: Example: ${JSON.stringify([1, 2, 3])}` }),
    __metadata("design:type", String)
], TicketOrderProductDraft.prototype, "warehouseIds", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "productId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 56 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "batchId", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 1 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "unitRate", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 4 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "quantity", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "costAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 25000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "expectedPrice", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: (0, typescript_helper_1.valuesEnum)(variable_1.DiscountType), example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_b = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _b : Object)
], TicketOrderProductDraft.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Transform)(({ value }) => Math.round(value || 0)),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderProductDraft.prototype, "actualPrice", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({ example: 'Uống 2 lần/ngày sáng 1 viên, chiều 1 viên' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderProductDraft.prototype, "hintUsage", void 0);


/***/ }),
/* 799 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderSurchargeDraft = void 0;
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
class TicketOrderSurchargeDraft {
}
exports.TicketOrderSurchargeDraft = TicketOrderSurchargeDraft;
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderSurchargeDraft.prototype, "surchargeId", void 0);
__decorate([
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNotEmpty)(),
    (0, class_validator_custom_1.IsNumberGreaterThan)(0),
    __metadata("design:type", Number)
], TicketOrderSurchargeDraft.prototype, "money", void 0);


/***/ }),
/* 800 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderDebtSuccessUpdateBody = exports.TicketOrderDebtSuccessInsertBody = exports.TicketOrderDepositedUpdateBody = exports.TicketOrderDraftUpsertBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const class_validator_custom_1 = __webpack_require__(243);
const variable_1 = __webpack_require__(21);
const ticket_order_expense_draft_1 = __webpack_require__(796);
const ticket_order_procedure_draft_1 = __webpack_require__(797);
const ticket_order_product_draft_1 = __webpack_require__(798);
const ticket_order_surcharge_draft_1 = __webpack_require__(799);
class TicketOrderBasic {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "roomId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsPositive)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsCostAmount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "procedureMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 750000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "productMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsActualMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "itemsDiscount", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "discountMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 22500 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    (0, class_validator_1.Max)(100),
    (0, class_validator_1.Min)(0),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "discountPercent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ enum: variable_1.DiscountType, example: variable_1.DiscountType.VND }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_custom_1.IsEnumValue)(variable_1.DiscountType),
    __metadata("design:type", typeof (_a = typeof variable_1.DiscountType !== "undefined" && variable_1.DiscountType) === "function" ? _a : Object)
], TicketOrderBasic.prototype, "discountType", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 12000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "surcharge", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "totalMoney", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "paid", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1250000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "debt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "expense", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 20000 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "profit", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: Date.now() }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketOrderBasic.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: '' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketOrderBasic.prototype, "note", void 0);
class TicketOrderBasicDraftUpsert extends (0, swagger_1.OmitType)(TicketOrderBasic, ['paid', 'debt']) {
}
class TicketOrderBasicDepositedUpdate extends (0, swagger_1.OmitType)(TicketOrderBasic, [
    'customerId',
    'paid',
    'debt',
]) {
}
class TicketOrderBasicDebtSuccessInsert extends (0, swagger_1.OmitType)(TicketOrderBasic, ['debt']) {
}
class TicketOrderBasicDebtSuccessUpdate extends (0, swagger_1.OmitType)(TicketOrderBasic, [
    'customerId',
    'debt',
]) {
}
class TicketOrderAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Diagnosis' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketOrderAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.Allow)(),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketOrderAttributeBody.prototype, "value", void 0);
class TicketOrderRelation {
}
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_order_product_draft_1.TicketOrderProductDraft, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_order_product_draft_1.TicketOrderProductDraft),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderProductDraftList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: ticket_order_procedure_draft_1.TicketOrderProcedureDraft, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => ticket_order_procedure_draft_1.TicketOrderProcedureDraft),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderProcedureDraftList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: ticket_order_surcharge_draft_1.TicketOrderSurchargeDraft,
        isArray: true,
        example: [
            { key: 'xx', name: 'Hoa hồng', money: 10000 },
            { key: 'xxe', name: 'Ship', money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => ticket_order_surcharge_draft_1.TicketOrderSurchargeDraft),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderSurchargeDraftList", void 0);
__decorate([
    (0, swagger_1.ApiPropertyOptional)({
        type: ticket_order_expense_draft_1.TicketOrderExpenseDraft,
        isArray: true,
        example: [
            { key: 'xx', name: 'Vật tư', money: 10000 },
            { key: 'xxe', name: 'Ship', money: 200000 },
        ],
    }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_transformer_1.Type)(() => ticket_order_expense_draft_1.TicketOrderExpenseDraft),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketOrderRelation.prototype, "ticketOrderExpenseDraftList", void 0);
class TicketOrderDraftUpsertBody extends TicketOrderRelation {
}
exports.TicketOrderDraftUpsertBody = TicketOrderDraftUpsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => Number),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsInt)(),
    __metadata("design:type", Number)
], TicketOrderDraftUpsertBody.prototype, "ticketId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDraftUpsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDraftUpsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDraftUpsert)
], TicketOrderDraftUpsertBody.prototype, "ticketOrderDraftUpsert", void 0);
class TicketOrderDepositedUpdateBody extends TicketOrderRelation {
}
exports.TicketOrderDepositedUpdateBody = TicketOrderDepositedUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDepositedUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDepositedUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDepositedUpdate)
], TicketOrderDepositedUpdateBody.prototype, "ticketOrderDepositedUpdate", void 0);
class TicketOrderDebtSuccessInsertBody extends TicketOrderRelation {
}
exports.TicketOrderDebtSuccessInsertBody = TicketOrderDebtSuccessInsertBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDebtSuccessInsert }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDebtSuccessInsert),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDebtSuccessInsert)
], TicketOrderDebtSuccessInsertBody.prototype, "ticketOrderDebtSuccessInsert", void 0);
class TicketOrderDebtSuccessUpdateBody extends TicketOrderRelation {
}
exports.TicketOrderDebtSuccessUpdateBody = TicketOrderDebtSuccessUpdateBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketOrderBasicDebtSuccessUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketOrderBasicDebtSuccessUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketOrderBasicDebtSuccessUpdate)
], TicketOrderDebtSuccessUpdateBody.prototype, "ticketOrderDebtSuccessUpdate", void 0);


/***/ }),
/* 801 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketOrderService = void 0;
const common_1 = __webpack_require__(3);
const variable_1 = __webpack_require__(21);
const ticket_entity_1 = __webpack_require__(59);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
const ticket_action_service_1 = __webpack_require__(730);
const ticket_money_service_1 = __webpack_require__(792);
let TicketOrderService = class TicketOrderService {
    constructor(socketEmitService, ticketOrderDraftOperation, ticketOrderDepositedOperation, ticketRepository, ticketActionService, ticketMoneyService) {
        this.socketEmitService = socketEmitService;
        this.ticketOrderDraftOperation = ticketOrderDraftOperation;
        this.ticketOrderDepositedOperation = ticketOrderDepositedOperation;
        this.ticketRepository = ticketRepository;
        this.ticketActionService = ticketActionService;
        this.ticketMoneyService = ticketMoneyService;
    }
    async draftUpsert(params) {
        const { oid, body, userId } = params;
        const { ticket } = await this.ticketOrderDraftOperation.upsert({
            oid,
            ticketId: body.ticketId,
            ticketOrderDraftUpsertDto: Object.assign(Object.assign({}, body.ticketOrderDraftUpsert), { customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, commissionMoney: 0 }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { printPrescription: 1, paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect, createdAt: body.ticketOrderDraftUpsert.registeredAt });
            }),
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect });
            }),
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        return { ticket };
    }
    async depositedUpdate(params) {
        const { oid, userId, ticketId, body } = params;
        const { ticket } = await this.ticketOrderDepositedOperation.update({
            oid,
            ticketId,
            ticketOrderDepositedUpdateDto: Object.assign(Object.assign({}, body.ticketOrderDepositedUpdate), { customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, commissionMoney: 0 }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { printPrescription: 1, paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect, createdAt: body.ticketOrderDepositedUpdate.registeredAt });
            }),
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect });
            }),
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        return { ticket };
    }
    async debtSuccessCreate(params) {
        const { oid, body, userId } = params;
        const _a = body.ticketOrderDebtSuccessInsert, { paid } = _a, ticketOrderDraftInsertBody = __rest(_a, ["paid"]);
        const time = ticketOrderDraftInsertBody.registeredAt;
        const draftResponse = await this.ticketOrderDraftOperation.upsert({
            oid,
            ticketId: 0,
            ticketOrderDraftUpsertDto: Object.assign(Object.assign({}, ticketOrderDraftInsertBody), { customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, commissionMoney: 0 }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { printPrescription: 1, paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect, createdAt: body.ticketOrderDebtSuccessInsert.registeredAt });
            }),
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect });
            }),
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        const ticketId = draftResponse.ticket.id;
        const customerId = draftResponse.ticket.customerId;
        if (body.ticketOrderProductDraftList.length) {
            await this.ticketActionService.sendProduct({
                oid,
                ticketId,
                ticketProductIdList: draftResponse.ticket.ticketProductList || [].map((i) => i.id),
                sendAll: true,
            });
        }
        if (paid > 0) {
            await this.ticketMoneyService.prepaymentMoney({
                oid,
                userId,
                ticketId,
                body: { customerId, paymentMethodId: 0, paidAmount: paid, note: '' },
            });
        }
        const closeResult = await this.ticketActionService.close({ oid, userId, ticketId });
        return { ticket: closeResult.ticketModified };
    }
    async debtSuccessUpdate(params) {
        const { oid, userId, ticketId, body } = params;
        const time = Date.now();
        let ticket = await this.ticketRepository.findOneBy({ oid, id: ticketId });
        const customerId = ticket.customerId;
        if ([ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Schedule].includes(ticket.status)) {
            return { data: { ticketId } };
        }
        if ([ticket_entity_1.TicketStatus.Debt, ticket_entity_1.TicketStatus.Completed].includes(ticket.status)) {
            const responseReopen = await this.ticketActionService.reopen({
                oid,
                ticketId,
                userId,
            });
            ticket = responseReopen.ticketModified;
        }
        if (ticket.paid) {
            await this.ticketMoneyService.refundMoney({
                oid,
                userId,
                ticketId,
                body: {
                    customerId,
                    note: 'Sửa đơn',
                    paymentMethodId: 0,
                    refundAmount: ticket.paid,
                },
            });
        }
        await this.ticketActionService.returnProduct({
            oid,
            returnAll: true,
            ticketId,
            returnList: [],
        });
        const _a = body.ticketOrderDebtSuccessUpdate, { paid: paidBody } = _a, ticketBodyUpdate = __rest(_a, ["paid"]);
        const responseUpdate = await this.ticketOrderDepositedOperation.update({
            oid,
            ticketId,
            ticketOrderDepositedUpdateDto: Object.assign(Object.assign({}, ticketBodyUpdate), { customerSourceId: 0, laboratoryMoney: 0, radiologyMoney: 0, commissionMoney: 0 }),
            ticketOrderProductDraftListDto: body.ticketOrderProductDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { printPrescription: 1, paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect, createdAt: body.ticketOrderDebtSuccessUpdate.registeredAt });
            }),
            ticketOrderProcedureDraftListDto: body.ticketOrderProcedureDraftList.map((i) => {
                return Object.assign(Object.assign({}, i), { paymentMoneyStatus: variable_1.PaymentMoneyStatus.NoEffect });
            }),
            ticketOrderSurchargeDraftListDto: body.ticketOrderSurchargeDraftList,
            ticketOrderExpenseDraftListDto: body.ticketOrderExpenseDraftList,
        });
        ticket = responseUpdate.ticket;
        const responseSendAllProduct = await this.ticketActionService.sendProduct({
            ticketId,
            oid,
            sendAll: true,
            ticketProductIdList: responseUpdate.ticket.ticketProductList.map((i) => i.id),
        });
        if (paidBody > 0) {
            await this.ticketMoneyService.prepaymentMoney({
                oid,
                userId,
                ticketId,
                body: { customerId, paymentMethodId: 0, paidAmount: paidBody, note: 'Sửa đơn' },
            });
        }
        const closeResult = await this.ticketActionService.close({
            oid,
            ticketId,
            userId,
        });
        ticket = closeResult.ticketModified;
        return { ticket };
    }
    async destroy(params) {
        const { oid, ticketId } = params;
        await this.ticketRepository.destroy({ oid, ticketId });
        return { ticketId };
    }
    async sendProductAndPaymentAndClose(params) {
        const { oid, ticketId, body, userId } = params;
        const time = Date.now();
        const paymentCreatedList = [];
        let ticketModified;
        let customerModified;
        let ticketProductModifiedAll;
        if (body.ticketProductIdList.length) {
            const sendProductResult = await this.ticketActionService.sendProduct({
                oid,
                sendAll: true,
                ticketId,
                ticketProductIdList: [],
                options: { noEmitTicket: true },
            });
            if (sendProductResult.ticketModified) {
                ticketModified = sendProductResult.ticketModified;
            }
            ticketProductModifiedAll = sendProductResult.ticketProductModifiedAll;
        }
        const customerId = body.customerId;
        if (body.paidAmount > 0) {
            const prepaymentResult = await this.ticketMoneyService.prepaymentMoney({
                oid,
                userId,
                ticketId,
                body: {
                    customerId,
                    note: body.note,
                    paidAmount: body.paidAmount,
                    paymentMethodId: body.paymentMethodId,
                },
            });
            paymentCreatedList.push(prepaymentResult.paymentCreated);
            ticketModified = prepaymentResult.ticketModified;
        }
        const closeResult = await this.ticketActionService.close({
            oid,
            ticketId,
            userId,
            options: { noEmitCustomer: true, noEmitTicket: true },
        });
        paymentCreatedList.push(...closeResult.paymentCreatedList);
        if (closeResult.ticketModified) {
            ticketModified = closeResult.ticketModified;
        }
        if (closeResult.customerModified) {
            customerModified = closeResult.customerModified;
        }
        if (ticketModified) {
            this.socketEmitService.socketTicketListChange(oid, { ticketUpsertedList: [ticketModified] });
        }
        if (customerModified) {
            this.socketEmitService.customerUpsert(oid, { customer: customerModified });
        }
        return {
            ticketModified: closeResult.ticketModified,
            paymentCreatedList,
            ticketProductModifiedAll: ticketProductModifiedAll || [],
        };
    }
};
exports.TicketOrderService = TicketOrderService;
exports.TicketOrderService = TicketOrderService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof operations_1.TicketOrderDraftOperation !== "undefined" && operations_1.TicketOrderDraftOperation) === "function" ? _b : Object, typeof (_c = typeof operations_1.TicketOrderDepositedOperation !== "undefined" && operations_1.TicketOrderDepositedOperation) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _d : Object, typeof (_e = typeof ticket_action_service_1.TicketActionService !== "undefined" && ticket_action_service_1.TicketActionService) === "function" ? _e : Object, typeof (_f = typeof ticket_money_service_1.TicketMoneyService !== "undefined" && ticket_money_service_1.TicketMoneyService) === "function" ? _f : Object])
], TicketOrderService);


/***/ }),
/* 802 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketQueryModule = void 0;
const common_1 = __webpack_require__(3);
const api_ticket_procedure_service_1 = __webpack_require__(625);
const api_ticket_query_controller_1 = __webpack_require__(803);
const ticket_query_service_1 = __webpack_require__(804);
let TicketQueryModule = class TicketQueryModule {
};
exports.TicketQueryModule = TicketQueryModule;
exports.TicketQueryModule = TicketQueryModule = __decorate([
    (0, common_1.Module)({
        imports: [],
        controllers: [api_ticket_query_controller_1.ApiTicketQueryController],
        providers: [ticket_query_service_1.TicketQueryService, api_ticket_procedure_service_1.ApiTicketProcedureService],
    })
], TicketQueryModule);


/***/ }),
/* 803 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketQueryController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const dto_1 = __webpack_require__(306);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const request_1 = __webpack_require__(304);
const ticket_query_service_1 = __webpack_require__(804);
let ApiTicketQueryController = class ApiTicketQueryController {
    constructor(ticketQueryService) {
        this.ticketQueryService = ticketQueryService;
    }
    async pagination({ oid }, query) {
        const data = await this.ticketQueryService.pagination(oid, query);
        return { data };
    }
    async list({ oid }, query) {
        const data = await this.ticketQueryService.getMany(oid, query);
        return { data };
    }
    async detail({ oid }, { id }, query) {
        const data = await this.ticketQueryService.getOne(oid, id, query);
        return { data };
    }
};
exports.ApiTicketQueryController = ApiTicketQueryController;
__decorate([
    (0, common_1.Get)('pagination'),
    (0, user_guard_1.UserPermissionOr)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_1.TicketPaginationQuery !== "undefined" && request_1.TicketPaginationQuery) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketQueryController.prototype, "pagination", null);
__decorate([
    (0, common_1.Get)('list'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketGetManyQuery !== "undefined" && request_1.TicketGetManyQuery) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ApiTicketQueryController.prototype, "list", null);
__decorate([
    (0, common_1.Get)('detail/:id'),
    (0, user_guard_1.UserPermission)(),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _h : Object, typeof (_j = typeof dto_1.IdParam !== "undefined" && dto_1.IdParam) === "function" ? _j : Object, typeof (_k = typeof request_1.TicketGetOneQuery !== "undefined" && request_1.TicketGetOneQuery) === "function" ? _k : Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], ApiTicketQueryController.prototype, "detail", null);
exports.ApiTicketQueryController = ApiTicketQueryController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_query_service_1.TicketQueryService !== "undefined" && ticket_query_service_1.TicketQueryService) === "function" ? _a : Object])
], ApiTicketQueryController);


/***/ }),
/* 804 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketQueryService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const helpers_1 = __webpack_require__(182);
const payment_entity_1 = __webpack_require__(51);
const ticket_product_entity_1 = __webpack_require__(71);
const repositories_1 = __webpack_require__(42);
const image_repository_1 = __webpack_require__(107);
const ticket_repository_1 = __webpack_require__(148);
const api_ticket_procedure_service_1 = __webpack_require__(625);
let TicketQueryService = class TicketQueryService {
    constructor(ticketRepository, customerRepository, appointmentRepository, ticketAttributeRepository, ticketSurchargeRepository, ticketExpenseRepository, ticketProductRepository, ticketBatchRepository, ticketProcedureRepository, ticketRadiologyRepository, ticketLaboratoryRepository, ticketLaboratoryGroupRepository, ticketLaboratoryResultRepository, ticketUserRepository, paymentRepository, customerSourceRepository, imageRepository, apiTicketProcedureService) {
        this.ticketRepository = ticketRepository;
        this.customerRepository = customerRepository;
        this.appointmentRepository = appointmentRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.ticketSurchargeRepository = ticketSurchargeRepository;
        this.ticketExpenseRepository = ticketExpenseRepository;
        this.ticketProductRepository = ticketProductRepository;
        this.ticketBatchRepository = ticketBatchRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketRadiologyRepository = ticketRadiologyRepository;
        this.ticketLaboratoryRepository = ticketLaboratoryRepository;
        this.ticketLaboratoryGroupRepository = ticketLaboratoryGroupRepository;
        this.ticketLaboratoryResultRepository = ticketLaboratoryResultRepository;
        this.ticketUserRepository = ticketUserRepository;
        this.paymentRepository = paymentRepository;
        this.customerSourceRepository = customerSourceRepository;
        this.imageRepository = imageRepository;
        this.apiTicketProcedureService = apiTicketProcedureService;
    }
    async pagination(oid, query) {
        const { page, limit, sort, relation, filter } = query;
        const { data: ticketList, total } = await this.ticketRepository.pagination({
            page,
            limit,
            condition: {
                oid,
                roomId: filter === null || filter === void 0 ? void 0 : filter.roomId,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            sort,
        });
        if (relation) {
            await this.generateRelation({ oid, ticketList, relation });
        }
        return { ticketList, total, page, limit };
    }
    async getMany(oid, query) {
        const { relation, limit, sort, filter } = query;
        const ticketList = await this.ticketRepository.findMany({
            condition: {
                oid,
                roomId: filter === null || filter === void 0 ? void 0 : filter.roomId,
                customerId: filter === null || filter === void 0 ? void 0 : filter.customerId,
                status: filter === null || filter === void 0 ? void 0 : filter.status,
                deliveryStatus: filter === null || filter === void 0 ? void 0 : filter.deliveryStatus,
                registeredAt: filter === null || filter === void 0 ? void 0 : filter.registeredAt,
                startedAt: filter === null || filter === void 0 ? void 0 : filter.startedAt,
                updatedAt: filter === null || filter === void 0 ? void 0 : filter.updatedAt,
            },
            limit,
            sort,
        });
        if (relation) {
            await this.generateRelation({ oid, ticketList, relation });
        }
        return { ticketList };
    }
    async getOne(oid, ticketId, { relation }) {
        const ticket = await this.ticketRepository.findOneBy({ oid, id: ticketId });
        if (!ticket) {
            throw new exception_filter_1.BusinessException('error.Database.NotFound');
        }
        if (relation) {
            await this.generateRelation({ oid, ticketList: [ticket], relation });
        }
        return { ticket };
    }
    async generateRelation(options) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        const { oid, ticketList, relation } = options;
        const ticketIdList = ticketList.map((i) => i.id);
        const customerIdList = ticketList.map((i) => i.customerId);
        const customerSourceIdList = ticketList.map((i) => i.customerSourceId).filter((i) => !!i);
        const imageIdList = ticketList
            .map((i) => {
            try {
                return JSON.parse(i.imageIds);
            }
            catch (error) {
                return [];
            }
        })
            .flat();
        const dataPromise = await Promise.all([
            (relation === null || relation === void 0 ? void 0 : relation.customer)
                ? this.customerRepository.findMany({ condition: { oid, id: { IN: customerIdList } } })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.paymentList)
                ? this.paymentRepository.findMany({
                    condition: {
                        oid,
                        voucherType: payment_entity_1.PaymentVoucherType.Ticket,
                        voucherId: { IN: ticketIdList },
                    },
                    sort: { id: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductList)
                ? this.ticketProductRepository.findMany({
                    relation: ((_a = relation === null || relation === void 0 ? void 0 : relation.ticketProductList) === null || _a === void 0 ? void 0 : _a.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketProductList.filter) || {})), { oid, ticketId: { IN: ticketIdList } }),
                    sort: (relation === null || relation === void 0 ? void 0 : relation.ticketProductList.sort) || { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList)
                ? this.ticketProductRepository.findMany({
                    relationLoadStrategy: 'query',
                    relation: ((_b = relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList) === null || _b === void 0 ? void 0 : _b.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList.filter) || {})), { oid, ticketId: { IN: ticketIdList }, type: ticket_product_entity_1.TicketProductType.Prescription }),
                    sort: (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList.sort) || { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList)
                ? this.ticketProductRepository.findMany({
                    relation: ((_c = relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList) === null || _c === void 0 ? void 0 : _c.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList.filter) || {})), { oid, ticketId: { IN: ticketIdList }, type: ticket_product_entity_1.TicketProductType.Consumable }),
                    sort: (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList.sort) || { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketBatchList)
                ? this.ticketBatchRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                    relation: {
                        batch: (_d = relation === null || relation === void 0 ? void 0 : relation.ticketBatchList) === null || _d === void 0 ? void 0 : _d.batch,
                    },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList)
                ? this.apiTicketProcedureService.getList(oid, {
                    filter: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList.filter) || {})), { oid, ticketId: { IN: ticketIdList } }),
                    relation: relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList.relation,
                    sort: { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList)
                ? this.ticketLaboratoryRepository.findMany({
                    relation: ((_e = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) === null || _e === void 0 ? void 0 : _e.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList.filter) || {})), { oid, ticketId: { IN: ticketIdList } }),
                    sort: { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList)
                ? this.ticketLaboratoryGroupRepository.findMany({
                    relation: ((_f = relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList) === null || _f === void 0 ? void 0 : _f.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList.filter) || {})), { oid, ticketId: { IN: ticketIdList } }),
                    sort: { id: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryResultList)
                ? this.ticketLaboratoryResultRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList)
                ? this.ticketRadiologyRepository.findMany({
                    relation: ((_g = relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList) === null || _g === void 0 ? void 0 : _g.relation) || {},
                    condition: Object.assign(Object.assign({}, ((relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList.filter) || {})), { oid, ticketId: { IN: ticketIdList } }),
                    sort: { priority: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketUserList)
                ? this.ticketUserRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                    relation: {
                        user: (_h = relation === null || relation === void 0 ? void 0 : relation.ticketUserList) === null || _h === void 0 ? void 0 : _h.user,
                    },
                    sort: { positionType: 'ASC', roleId: 'ASC' },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketAttributeList)
                ? this.ticketAttributeRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketSurchargeList)
                ? this.ticketSurchargeRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.ticketExpenseList)
                ? this.ticketExpenseRepository.findMany({
                    condition: { oid, ticketId: { IN: ticketIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.imageList) && imageIdList.length
                ? this.imageRepository.findMany({
                    condition: { oid, id: { IN: imageIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.customerSource) && (customerSourceIdList === null || customerSourceIdList === void 0 ? void 0 : customerSourceIdList.length)
                ? this.customerSourceRepository.findMany({
                    condition: { oid, id: { IN: customerSourceIdList } },
                })
                : undefined,
            (relation === null || relation === void 0 ? void 0 : relation.toAppointment) && (relation === null || relation === void 0 ? void 0 : relation.toAppointment)
                ? this.appointmentRepository.findMany({
                    condition: { oid, fromTicketId: { IN: ticketIdList } },
                })
                : undefined,
        ]);
        const customerList = dataPromise[0];
        const paymentList = dataPromise[1];
        const ticketProductList = dataPromise[2];
        const ticketProductPrescriptionList = dataPromise[3];
        const ticketProductConsumableList = dataPromise[4];
        const ticketBatchList = dataPromise[5];
        const ticketProcedureList = ((_j = dataPromise[6]) === null || _j === void 0 ? void 0 : _j.ticketProcedureList) || [];
        const ticketLaboratoryList = dataPromise[7];
        const ticketLaboratoryGroupList = dataPromise[8];
        const ticketLaboratoryResultList = dataPromise[9];
        const ticketRadiologyList = dataPromise[10];
        const ticketUserList = dataPromise[11];
        const ticketAttributeList = dataPromise[12];
        const ticketSurchargeList = dataPromise[13];
        const ticketExpenseList = dataPromise[14];
        const imageList = dataPromise[15];
        const customerSourceList = dataPromise[16];
        const toAppointmentList = dataPromise[17];
        const imageMap = helpers_1.ESArray.arrayToKeyValue(imageList || [], 'id');
        ticketList.forEach((ticket) => {
            if (relation === null || relation === void 0 ? void 0 : relation.customer) {
                ticket.customer = customerList.find((i) => {
                    return i.id === ticket.customerId;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.paymentList) {
                ticket.paymentList = paymentList.filter((i) => {
                    return i.voucherId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductList) {
                ticket.ticketProductList = ticketProductList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductPrescriptionList) {
                ticket.ticketProductPrescriptionList = ticketProductPrescriptionList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProductConsumableList) {
                ticket.ticketProductConsumableList = ticketProductConsumableList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketBatchList) {
                ticket.ticketBatchList = ticketBatchList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketProcedureList) {
                ticket.ticketProcedureList = ticketProcedureList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryList) {
                ticket.ticketLaboratoryList = ticketLaboratoryList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryGroupList) {
                ticket.ticketLaboratoryGroupList = ticketLaboratoryGroupList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketLaboratoryResultList) {
                ticket.ticketLaboratoryResultList = ticketLaboratoryResultList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketRadiologyList) {
                ticket.ticketRadiologyList = ticketRadiologyList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketUserList) {
                ticket.ticketUserList = ticketUserList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketAttributeList) {
                ticket.ticketAttributeList = ticketAttributeList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketSurchargeList) {
                ticket.ticketSurchargeList = ticketSurchargeList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.ticketExpenseList) {
                ticket.ticketExpenseList = ticketExpenseList.filter((i) => {
                    return i.ticketId === ticket.id;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.imageList) {
                try {
                    const imageIdList = JSON.parse(ticket.imageIds);
                    ticket.imageList = imageIdList.map((imageId) => imageMap[imageId]).filter((i) => !!i);
                }
                catch (error) {
                    ticket.imageList = [];
                }
            }
            if (relation === null || relation === void 0 ? void 0 : relation.customerSource) {
                ticket.customerSource = (customerSourceList || []).find((i) => {
                    return i.id === ticket.customerSourceId;
                });
            }
            if (relation === null || relation === void 0 ? void 0 : relation.toAppointment) {
                ticket.toAppointment = toAppointmentList.find((i) => {
                    return i.fromTicketId === ticket.id;
                });
            }
        });
        return ticketList;
    }
};
exports.TicketQueryService = TicketQueryService;
exports.TicketQueryService = TicketQueryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_repository_1.TicketRepository !== "undefined" && ticket_repository_1.TicketRepository) === "function" ? _a : Object, typeof (_b = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.TicketSurchargeRepository !== "undefined" && repositories_1.TicketSurchargeRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.TicketExpenseRepository !== "undefined" && repositories_1.TicketExpenseRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketProductRepository !== "undefined" && repositories_1.TicketProductRepository) === "function" ? _g : Object, typeof (_h = typeof repositories_1.TicketBatchRepository !== "undefined" && repositories_1.TicketBatchRepository) === "function" ? _h : Object, typeof (_j = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _j : Object, typeof (_k = typeof repositories_1.TicketRadiologyRepository !== "undefined" && repositories_1.TicketRadiologyRepository) === "function" ? _k : Object, typeof (_l = typeof repositories_1.TicketLaboratoryRepository !== "undefined" && repositories_1.TicketLaboratoryRepository) === "function" ? _l : Object, typeof (_m = typeof repositories_1.TicketLaboratoryGroupRepository !== "undefined" && repositories_1.TicketLaboratoryGroupRepository) === "function" ? _m : Object, typeof (_o = typeof repositories_1.TicketLaboratoryResultRepository !== "undefined" && repositories_1.TicketLaboratoryResultRepository) === "function" ? _o : Object, typeof (_p = typeof repositories_1.TicketUserRepository !== "undefined" && repositories_1.TicketUserRepository) === "function" ? _p : Object, typeof (_q = typeof repositories_1.PaymentRepository !== "undefined" && repositories_1.PaymentRepository) === "function" ? _q : Object, typeof (_r = typeof repositories_1.CustomerSourceRepository !== "undefined" && repositories_1.CustomerSourceRepository) === "function" ? _r : Object, typeof (_s = typeof image_repository_1.ImageRepository !== "undefined" && image_repository_1.ImageRepository) === "function" ? _s : Object, typeof (_t = typeof api_ticket_procedure_service_1.ApiTicketProcedureService !== "undefined" && api_ticket_procedure_service_1.ApiTicketProcedureService) === "function" ? _t : Object])
], TicketQueryService);


/***/ }),
/* 805 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReceptionModule = void 0;
const common_1 = __webpack_require__(3);
const ticket_change_user_module_1 = __webpack_require__(738);
const api_ticket_reception_controller_1 = __webpack_require__(806);
const ticket_reception_service_1 = __webpack_require__(809);
let TicketReceptionModule = class TicketReceptionModule {
};
exports.TicketReceptionModule = TicketReceptionModule;
exports.TicketReceptionModule = TicketReceptionModule = __decorate([
    (0, common_1.Module)({
        imports: [ticket_change_user_module_1.TicketChangeUserModule],
        controllers: [api_ticket_reception_controller_1.ApiTicketReceptionController],
        providers: [ticket_reception_service_1.TicketReceptionService],
    })
], TicketReceptionModule);


/***/ }),
/* 806 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ApiTicketReceptionController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const user_guard_1 = __webpack_require__(157);
const external_request_1 = __webpack_require__(237);
const permission_enum_1 = __webpack_require__(83);
const request_1 = __webpack_require__(304);
const request_2 = __webpack_require__(807);
const ticket_reception_service_1 = __webpack_require__(809);
let ApiTicketReceptionController = class ApiTicketReceptionController {
    constructor(ticketReceptionService) {
        this.ticketReceptionService = ticketReceptionService;
    }
    async receptionCreate({ oid }, body) {
        const data = await this.ticketReceptionService.receptionCreate({
            oid,
            body,
        });
        return { data };
    }
    async receptionUpdate({ oid }, { ticketId }, body) {
        const data = await this.ticketReceptionService.receptionUpdate({
            oid,
            ticketId,
            body,
        });
        return { data };
    }
};
exports.ApiTicketReceptionController = ApiTicketReceptionController;
__decorate([
    (0, common_1.Post)('reception-create'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object, typeof (_c = typeof request_2.TicketReceptionCreateTicketBody !== "undefined" && request_2.TicketReceptionCreateTicketBody) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ApiTicketReceptionController.prototype, "receptionCreate", null);
__decorate([
    (0, common_1.Post)('/:ticketId/reception-update'),
    (0, user_guard_1.UserPermissionOr)(permission_enum_1.PermissionId.TICKET_DRAFT_CRUD),
    __param(0, (0, external_request_1.External)()),
    __param(1, (0, common_1.Param)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _e : Object, typeof (_f = typeof request_1.TicketParams !== "undefined" && request_1.TicketParams) === "function" ? _f : Object, typeof (_g = typeof request_2.TicketReceptionUpdateTicketBody !== "undefined" && request_2.TicketReceptionUpdateTicketBody) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ApiTicketReceptionController.prototype, "receptionUpdate", null);
exports.ApiTicketReceptionController = ApiTicketReceptionController = __decorate([
    (0, swagger_1.ApiTags)('Ticket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    (0, common_1.Controller)('ticket'),
    __metadata("design:paramtypes", [typeof (_a = typeof ticket_reception_service_1.TicketReceptionService !== "undefined" && ticket_reception_service_1.TicketReceptionService) === "function" ? _a : Object])
], ApiTicketReceptionController);


/***/ }),
/* 807 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(808), exports);


/***/ }),
/* 808 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReceptionUpdateTicketBody = exports.TicketReceptionCreateTicketBody = void 0;
const swagger_1 = __webpack_require__(6);
const class_transformer_1 = __webpack_require__(17);
const class_validator_1 = __webpack_require__(242);
const ticket_entity_1 = __webpack_require__(59);
const request_1 = __webpack_require__(369);
const request_2 = __webpack_require__(757);
const request_3 = __webpack_require__(740);
class TicketAttributeBody {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Diagnosis' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.MaxLength)(100),
    (0, class_validator_1.IsNotEmpty)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "key", void 0);
__decorate([
    (0, swagger_1.ApiProperty)(),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    __metadata("design:type", String)
], TicketAttributeBody.prototype, "value", void 0);
class TicketReceptionCreate {
}
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketReceptionCreate.prototype, "roomId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketReceptionCreate.prototype, "customerSourceId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketReceptionCreate.prototype, "customerId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 45 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketReceptionCreate.prototype, "fromAppointmentId", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: ticket_entity_1.TicketStatus.Draft }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsIn)([ticket_entity_1.TicketStatus.Draft, ticket_entity_1.TicketStatus.Executing]),
    __metadata("design:type", typeof (_a = typeof ticket_entity_1.TicketStatus !== "undefined" && ticket_entity_1.TicketStatus) === "function" ? _a : Object)
], TicketReceptionCreate.prototype, "status", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 1678890707005 }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsNumber)(),
    __metadata("design:type", Number)
], TicketReceptionCreate.prototype, "registeredAt", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ example: 'Trước khi vào khám 5 ngày, bla...bla...' }),
    (0, class_transformer_1.Expose)(),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsString)(),
    __metadata("design:type", String)
], TicketReceptionCreate.prototype, "note", void 0);
class TicketReceptionUpdate extends (0, swagger_1.PickType)(TicketReceptionCreate, [
    'roomId',
    'customerSourceId',
    'registeredAt',
    'note',
]) {
}
class TicketReceptionCreateTicketBody {
}
exports.TicketReceptionCreateTicketBody = TicketReceptionCreateTicketBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReceptionCreateTicketBody.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_3.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_3.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReceptionCreateTicketBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_2.TicketProcedureBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_2.TicketProcedureBody),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReceptionCreateTicketBody.prototype, "ticketProcedureList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_1.CustomerCreateBody }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_1.CustomerCreateBody),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", typeof (_b = typeof request_1.CustomerCreateBody !== "undefined" && request_1.CustomerCreateBody) === "function" ? _b : Object)
], TicketReceptionCreateTicketBody.prototype, "customer", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketReceptionCreate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketReceptionCreate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketReceptionCreate)
], TicketReceptionCreateTicketBody.prototype, "ticketReception", void 0);
class TicketReceptionUpdateTicketBody {
}
exports.TicketReceptionUpdateTicketBody = TicketReceptionUpdateTicketBody;
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketAttributeBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketAttributeBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReceptionUpdateTicketBody.prototype, "ticketAttributeList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: request_3.TicketUserBasicBody, isArray: true }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => request_3.TicketUserBasicBody),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.IsArray)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", Array)
], TicketReceptionUpdateTicketBody.prototype, "ticketUserList", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({ type: TicketReceptionUpdate }),
    (0, class_transformer_1.Expose)(),
    (0, class_transformer_1.Type)(() => TicketReceptionUpdate),
    (0, class_validator_1.IsDefined)(),
    (0, class_validator_1.ValidateNested)({ each: true }),
    __metadata("design:type", TicketReceptionUpdate)
], TicketReceptionUpdateTicketBody.prototype, "ticketReception", void 0);


/***/ }),
/* 809 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TicketReceptionService = void 0;
const common_1 = __webpack_require__(3);
const exception_filter_1 = __webpack_require__(9);
const time_helper_1 = __webpack_require__(149);
const variable_1 = __webpack_require__(21);
const appointment_entity_1 = __webpack_require__(47);
const position_entity_1 = __webpack_require__(76);
const ticket_entity_1 = __webpack_require__(59);
const operations_1 = __webpack_require__(164);
const repositories_1 = __webpack_require__(42);
const socket_emit_service_1 = __webpack_require__(340);
const ticket_change_user_service_1 = __webpack_require__(745);
let TicketReceptionService = class TicketReceptionService {
    constructor(socketEmitService, ticketRepository, ticketProcedureRepository, ticketProcedureItemRepository, customerRepository, appointmentRepository, ticketAttributeRepository, ticketChangeUserService, ticketChangeItemMoneyManager) {
        this.socketEmitService = socketEmitService;
        this.ticketRepository = ticketRepository;
        this.ticketProcedureRepository = ticketProcedureRepository;
        this.ticketProcedureItemRepository = ticketProcedureItemRepository;
        this.customerRepository = customerRepository;
        this.appointmentRepository = appointmentRepository;
        this.ticketAttributeRepository = ticketAttributeRepository;
        this.ticketChangeUserService = ticketChangeUserService;
        this.ticketChangeItemMoneyManager = ticketChangeItemMoneyManager;
    }
    async receptionCreate(options) {
        var _a;
        const { oid, body } = options;
        const { ticketReception } = body;
        let customer;
        let ticketAttributeList = [];
        let ticketProcedureList = [];
        if (!ticketReception.customerId) {
            let customerCode = body.customer.customerCode;
            if (!customerCode) {
                const count = await this.customerRepository.getMaxId();
                customerCode = (count + 1).toString();
            }
            customer = await this.customerRepository.insertOneFullFieldAndReturnEntity(Object.assign(Object.assign({}, body.customer), { debt: 0, oid,
                customerCode }));
            this.socketEmitService.customerUpsert(oid, { customer });
        }
        else {
            customer = await this.customerRepository.findOneBy({
                oid,
                id: ticketReception.customerId,
            });
        }
        if (!customer)
            throw new exception_filter_1.BusinessException('error.SystemError');
        const ticketListToday = await this.ticketRepository.findManyBy({
            oid,
            registeredAt: {
                GTE: time_helper_1.ESTimer.startOfDate(ticketReception.registeredAt, 7).getTime(),
                LTE: time_helper_1.ESTimer.endOfDate(ticketReception.registeredAt, 7).getTime(),
            },
        });
        let maxDailyIndex = 0;
        ticketListToday.forEach((i) => {
            if (i.dailyIndex > maxDailyIndex) {
                maxDailyIndex = i.dailyIndex;
            }
        });
        let ticket = await this.ticketRepository.insertOneFullFieldAndReturnEntity({
            oid,
            customerId: customer.id,
            roomId: ticketReception.roomId,
            status: ticketReception.status,
            registeredAt: ticketReception.registeredAt,
            startedAt: ticketReception.status === ticket_entity_1.TicketStatus.Executing ? ticketReception.registeredAt : null,
            customerSourceId: ticketReception.customerSourceId,
            dailyIndex: maxDailyIndex + 1,
            year: time_helper_1.ESTimer.info(ticketReception.registeredAt, 7).year,
            month: time_helper_1.ESTimer.info(ticketReception.registeredAt, 7).month + 1,
            date: time_helper_1.ESTimer.info(ticketReception.registeredAt, 7).date,
            debt: 0,
            note: ticketReception.note,
            deliveryStatus: variable_1.DeliveryStatus.NoStock,
            procedureMoney: 0,
            productMoney: 0,
            radiologyMoney: 0,
            laboratoryMoney: 0,
            itemsCostAmount: 0,
            itemsDiscount: 0,
            itemsActualMoney: 0,
            discountMoney: 0,
            discountPercent: 0,
            discountType: variable_1.DiscountType.VND,
            surcharge: 0,
            totalMoney: 0,
            expense: 0,
            commissionMoney: 0,
            profit: 0,
            paid: 0,
            imageIds: JSON.stringify([]),
            endedAt: null,
        });
        if (ticketReception.fromAppointmentId) {
            await this.appointmentRepository.update({ oid, id: ticketReception.fromAppointmentId }, {
                toTicketId: ticket.id,
                appointmentStatus: appointment_entity_1.AppointmentStatus.Completed,
            });
        }
        if (body.ticketAttributeList) {
            const ticketAttributeInsertList = body.ticketAttributeList
                .filter((i) => !!i.value)
                .map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid, ticketId: ticket.id });
                return dto;
            });
            ticketAttributeList =
                await this.ticketAttributeRepository.insertManyAndReturnEntity(ticketAttributeInsertList);
        }
        if (body.ticketUserList) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId: ticket.id,
                body: {
                    positionType: position_entity_1.PositionInteractType.Ticket,
                    positionInteractId: 0,
                    ticketItemId: 0,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        if ((_a = body.ticketProcedureList) === null || _a === void 0 ? void 0 : _a.length) {
            const ticketProcedureInsertList = body.ticketProcedureList.map((i) => {
                const insert = Object.assign(Object.assign({}, i.ticketProcedure), { customerId: ticket.customerId, status: variable_1.TicketProcedureStatus.Completed, oid, createdAt: Date.now(), ticketId: ticket.id, completedSessions: 0 });
                return insert;
            });
            ticketProcedureList =
                await this.ticketProcedureRepository.insertManyAndReturnEntity(ticketProcedureInsertList);
            const ticketProcedureItemInsertList = body
                .ticketProcedureList.map((i, index) => {
                return (i.ticketProcedureItemList || []).map((j) => {
                    const insert = {
                        oid,
                        completedAt: j.completedAt,
                        ticketId: ticket.id,
                        ticketProcedureId: ticketProcedureList[index].id,
                        status: variable_1.TicketProcedureStatus.Pending,
                        imageIds: '[]',
                        result: '',
                    };
                    return insert;
                });
            })
                .flat();
            await this.ticketProcedureItemRepository.insertManyFullField(ticketProcedureItemInsertList);
            const procedureMoney = ticketProcedureList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.actualPrice;
            }, 0);
            const procedureDiscount = ticketProcedureList.reduce((acc, cur) => {
                return acc + cur.quantity * cur.discountMoney;
            }, 0);
            ticket = await this.ticketChangeItemMoneyManager.changeItemMoney({
                manager: this.ticketRepository.getManager(),
                oid,
                ticketOrigin: ticket,
                itemMoney: {
                    procedureMoneyAdd: procedureMoney,
                    itemsDiscountAdd: procedureDiscount,
                },
            });
        }
        ticket.customer = customer;
        ticket.ticketAttributeList = ticketAttributeList;
        ticket.ticketProcedureList = ticketProcedureList;
        this.socketEmitService.socketTicketChange(oid, { type: 'CREATE', ticket });
        return { ticket };
    }
    async receptionUpdate(options) {
        const { oid, body, ticketId } = options;
        const { ticketReception } = body;
        const registeredTime = time_helper_1.ESTimer.info(ticketReception.registeredAt, 7);
        const ticketModified = await this.ticketRepository.updateOneAndReturnEntity({ oid, id: ticketId }, {
            registeredAt: ticketReception.registeredAt,
            customerSourceId: ticketReception.customerSourceId,
            roomId: ticketReception.roomId,
            note: ticketReception.note,
            year: registeredTime.year,
            month: registeredTime.month + 1,
            date: registeredTime.date,
            updatedAt: Date.now(),
        });
        if (body.ticketAttributeList) {
            const attributeKeyRemove = body.ticketAttributeList.map((i) => i.key);
            if (attributeKeyRemove.length) {
                await this.ticketAttributeRepository.delete({
                    oid,
                    ticketId,
                    key: { IN: body.ticketAttributeList.map((i) => i.key) },
                });
            }
            const ticketAttributeInsertList = body.ticketAttributeList
                .filter((i) => !!i.value)
                .map((i) => {
                const dto = Object.assign(Object.assign({}, i), { oid,
                    ticketId });
                return dto;
            });
            await this.ticketAttributeRepository.insertMany(ticketAttributeInsertList);
            ticketModified.ticketAttributeList = await this.ticketAttributeRepository.findManyBy({
                oid,
                ticketId,
            });
        }
        if (body.ticketUserList) {
            this.ticketChangeUserService.updateTicketUserPositionList({
                oid,
                ticketId,
                body: {
                    positionType: position_entity_1.PositionInteractType.Ticket,
                    positionInteractId: 0,
                    ticketItemId: 0,
                    quantity: 1,
                    ticketUserList: body.ticketUserList,
                },
            });
        }
        ticketModified.customer = await this.customerRepository.findOneById(ticketModified.customerId);
        this.socketEmitService.socketTicketChange(oid, { type: 'UPDATE', ticket: ticketModified });
        return { ticket: ticketModified };
    }
};
exports.TicketReceptionService = TicketReceptionService;
exports.TicketReceptionService = TicketReceptionService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof repositories_1.TicketRepository !== "undefined" && repositories_1.TicketRepository) === "function" ? _b : Object, typeof (_c = typeof repositories_1.TicketProcedureRepository !== "undefined" && repositories_1.TicketProcedureRepository) === "function" ? _c : Object, typeof (_d = typeof repositories_1.TicketProcedureItemRepository !== "undefined" && repositories_1.TicketProcedureItemRepository) === "function" ? _d : Object, typeof (_e = typeof repositories_1.CustomerRepository !== "undefined" && repositories_1.CustomerRepository) === "function" ? _e : Object, typeof (_f = typeof repositories_1.AppointmentRepository !== "undefined" && repositories_1.AppointmentRepository) === "function" ? _f : Object, typeof (_g = typeof repositories_1.TicketAttributeRepository !== "undefined" && repositories_1.TicketAttributeRepository) === "function" ? _g : Object, typeof (_h = typeof ticket_change_user_service_1.TicketChangeUserService !== "undefined" && ticket_change_user_service_1.TicketChangeUserService) === "function" ? _h : Object, typeof (_j = typeof operations_1.TicketChangeItemMoneyManager !== "undefined" && operations_1.TicketChangeItemMoneyManager) === "function" ? _j : Object])
], TicketReceptionService);


/***/ }),
/* 810 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const app_service_1 = __webpack_require__(811);
let AppController = class AppController {
    constructor(appService) {
        this.appService = appService;
    }
    getHello(req) {
        return this.appService.getHello();
    }
};
exports.AppController = AppController;
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, common_1.Req)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", String)
], AppController.prototype, "getHello", null);
exports.AppController = AppController = __decorate([
    (0, swagger_1.ApiTags)('Home'),
    (0, common_1.Controller)(),
    __metadata("design:paramtypes", [typeof (_a = typeof app_service_1.AppService !== "undefined" && app_service_1.AppService) === "function" ? _a : Object])
], AppController);


/***/ }),
/* 811 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var AppService_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AppService = void 0;
const common_1 = __webpack_require__(3);
let AppService = AppService_1 = class AppService {
    constructor() {
        this.logger = new common_1.Logger(AppService_1.name);
    }
    async onModuleInit() {
    }
    getHello() {
        return 'MEA-NestJS: Hello World!';
    }
};
exports.AppService = AppService;
exports.AppService = AppService = AppService_1 = __decorate([
    (0, common_1.Injectable)()
], AppService);


/***/ }),
/* 812 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HealthModule = void 0;
const axios_1 = __webpack_require__(813);
const common_1 = __webpack_require__(3);
const terminus_1 = __webpack_require__(814);
const health_controller_1 = __webpack_require__(815);
let HealthModule = class HealthModule {
};
exports.HealthModule = HealthModule;
exports.HealthModule = HealthModule = __decorate([
    (0, common_1.Module)({
        imports: [terminus_1.TerminusModule.forRoot(), axios_1.HttpModule],
        controllers: [health_controller_1.HealthController],
    })
], HealthModule);


/***/ }),
/* 813 */
/***/ ((module) => {

module.exports = require("@nestjs/axios");

/***/ }),
/* 814 */
/***/ ((module) => {

module.exports = require("@nestjs/terminus");

/***/ }),
/* 815 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HealthController = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(816);
const swagger_1 = __webpack_require__(6);
const terminus_1 = __webpack_require__(814);
let HealthController = class HealthController {
    constructor(health, http, db, disk, memory) {
        this.health = health;
        this.http = http;
        this.db = db;
        this.disk = disk;
        this.memory = memory;
    }
    check() {
        const pathStorage = process.platform === 'win32' ? 'C:\\' : '/';
        const thresholdPercent = process.platform === 'win32' ? 0.99 : 0.5;
        return this.health.check([
            () => this.db.pingCheck('database'),
        ]);
    }
};
exports.HealthController = HealthController;
__decorate([
    (0, common_1.Get)(),
    (0, terminus_1.HealthCheck)(),
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_MINUTE),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], HealthController.prototype, "check", null);
exports.HealthController = HealthController = __decorate([
    (0, swagger_1.ApiTags)('Health'),
    (0, common_1.Controller)('health'),
    __metadata("design:paramtypes", [typeof (_a = typeof terminus_1.HealthCheckService !== "undefined" && terminus_1.HealthCheckService) === "function" ? _a : Object, typeof (_b = typeof terminus_1.HttpHealthIndicator !== "undefined" && terminus_1.HttpHealthIndicator) === "function" ? _b : Object, typeof (_c = typeof terminus_1.TypeOrmHealthIndicator !== "undefined" && terminus_1.TypeOrmHealthIndicator) === "function" ? _c : Object, typeof (_d = typeof terminus_1.DiskHealthIndicator !== "undefined" && terminus_1.DiskHealthIndicator) === "function" ? _d : Object, typeof (_e = typeof terminus_1.MemoryHealthIndicator !== "undefined" && terminus_1.MemoryHealthIndicator) === "function" ? _e : Object])
], HealthController);


/***/ }),
/* 816 */
/***/ ((module) => {

module.exports = require("@nestjs/schedule");

/***/ }),
/* 817 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ImageManagerModule = void 0;
const common_1 = __webpack_require__(3);
const google_driver_module_1 = __webpack_require__(226);
const image_manager_service_1 = __webpack_require__(255);
let ImageManagerModule = class ImageManagerModule {
};
exports.ImageManagerModule = ImageManagerModule;
exports.ImageManagerModule = ImageManagerModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [google_driver_module_1.GoogleDriverModule],
        providers: [image_manager_service_1.ImageManagerService],
        exports: [image_manager_service_1.ImageManagerService],
    })
], ImageManagerModule);


/***/ }),
/* 818 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CronJobModule = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(816);
const google_driver_module_1 = __webpack_require__(226);
const cron_job_controller_1 = __webpack_require__(819);
const postgresql_job_1 = __webpack_require__(820);
let CronJobModule = class CronJobModule {
};
exports.CronJobModule = CronJobModule;
exports.CronJobModule = CronJobModule = __decorate([
    (0, common_1.Module)({
        imports: [schedule_1.ScheduleModule.forRoot(), google_driver_module_1.GoogleDriverModule],
        controllers: [cron_job_controller_1.CronJobController],
        providers: [postgresql_job_1.PostgresqlJob],
    })
], CronJobModule);


/***/ }),
/* 819 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CronJobController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const root_guard_1 = __webpack_require__(15);
const postgresql_job_1 = __webpack_require__(820);
let CronJobController = class CronJobController {
    constructor(postgresqlJob) {
        this.postgresqlJob = postgresqlJob;
    }
    async startJobBackupPostgres() {
        await this.postgresqlJob.startBackupPostgres();
        return await this.postgresqlJob.startJobUploadPostgres();
    }
};
exports.CronJobController = CronJobController;
__decorate([
    (0, common_1.Post)('job-backup-postgres'),
    (0, root_guard_1.IsRoot)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], CronJobController.prototype, "startJobBackupPostgres", null);
exports.CronJobController = CronJobController = __decorate([
    (0, common_1.Controller)('cron-job'),
    (0, swagger_1.ApiTags)('Cron-Job'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    __metadata("design:paramtypes", [typeof (_a = typeof postgresql_job_1.PostgresqlJob !== "undefined" && postgresql_job_1.PostgresqlJob) === "function" ? _a : Object])
], CronJobController);


/***/ }),
/* 820 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var PostgresqlJob_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PostgresqlJob = void 0;
const common_1 = __webpack_require__(3);
const schedule_1 = __webpack_require__(816);
const fs_1 = __webpack_require__(821);
const mime_types_1 = __webpack_require__(822);
const path_1 = __webpack_require__(33);
const cache_data_service_1 = __webpack_require__(40);
const google_driver_service_1 = __webpack_require__(228);
let PostgresqlJob = PostgresqlJob_1 = class PostgresqlJob {
    constructor(cacheDataService, googleDriverService) {
        this.cacheDataService = cacheDataService;
        this.googleDriverService = googleDriverService;
        this.logger = new common_1.Logger(PostgresqlJob_1.name);
    }
    async startBackupPostgres() {
        this.logger.debug('===== Start Backup Database Postgres =====');
    }
    async startJobUploadPostgres() {
        this.logger.debug('===== Start Upload Database to GoogleDriver =====');
        const oid = 1;
        const appDir = process.cwd();
        const backupDir = (0, path_1.join)(appDir, 'data', 'backup');
        const sqlFiles = (0, fs_1.readdirSync)(backupDir)
            .filter((fileName) => fileName.endsWith('.sql'))
            .map((fileName) => {
            const fullPath = (0, path_1.join)(backupDir, fileName);
            const stats = (0, fs_1.statSync)(fullPath);
            return { fileName, fullPath, mtime: stats.mtime };
        });
        if (sqlFiles.length === 0) {
            throw new Error('Không tìm thấy file .sql nào trong thư mục ./data/backup');
        }
        const latestFile = sqlFiles.reduce((a, b) => (a.mtime > b.mtime ? a : b));
        const mimetype = (0, mime_types_1.lookup)(latestFile.fullPath) || 'application/sql';
        const fileStream = (0, fs_1.createReadStream)(latestFile.fullPath);
        const email = await this.cacheDataService.getEmailGoogleDriver(oid);
        const file = await this.googleDriverService.uploadFileStream({
            oid,
            fileStream,
            fileName: latestFile.fileName,
            mimetype,
            email,
        });
        return { data: { file } };
    }
};
exports.PostgresqlJob = PostgresqlJob;
__decorate([
    (0, schedule_1.Cron)('0 0 19 * * *'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], PostgresqlJob.prototype, "startBackupPostgres", null);
__decorate([
    (0, schedule_1.Cron)('0 30 19 * * *'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], PostgresqlJob.prototype, "startJobUploadPostgres", null);
exports.PostgresqlJob = PostgresqlJob = PostgresqlJob_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _a : Object, typeof (_b = typeof google_driver_service_1.GoogleDriverService !== "undefined" && google_driver_service_1.GoogleDriverService) === "function" ? _b : Object])
], PostgresqlJob);


/***/ }),
/* 821 */
/***/ ((module) => {

module.exports = require("fs");

/***/ }),
/* 822 */
/***/ ((module) => {

module.exports = require("mime-types");

/***/ }),
/* 823 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EventListenerModule = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(824);
const visit_event_emit_1 = __webpack_require__(825);
const visit_event_listener_1 = __webpack_require__(827);
let EventListenerModule = class EventListenerModule {
};
exports.EventListenerModule = EventListenerModule;
exports.EventListenerModule = EventListenerModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [event_emitter_1.EventEmitterModule.forRoot()],
        controllers: [],
        providers: [visit_event_emit_1.VisitEventEmit, visit_event_listener_1.VisitEventListener],
        exports: [visit_event_emit_1.VisitEventEmit],
    })
], EventListenerModule);


/***/ }),
/* 824 */
/***/ ((module) => {

module.exports = require("@nestjs/event-emitter");

/***/ }),
/* 825 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VisitEventEmit = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(824);
const visit_event_constants_1 = __webpack_require__(826);
let VisitEventEmit = class VisitEventEmit {
    constructor(eventEmitter) {
        this.eventEmitter = eventEmitter;
    }
    async emitSendProductList(payload) {
        this.eventEmitter.emit(visit_event_constants_1.VISIT_EVENT.SEND_VISIT_PRODUCT_LIST, payload);
    }
    async emitRefundProductList(payload) {
        this.eventEmitter.emit(visit_event_constants_1.VISIT_EVENT.REFUND_VISIT_PRODUCT_LIST, payload);
    }
};
exports.VisitEventEmit = VisitEventEmit;
exports.VisitEventEmit = VisitEventEmit = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof event_emitter_1.EventEmitter2 !== "undefined" && event_emitter_1.EventEmitter2) === "function" ? _a : Object])
], VisitEventEmit);


/***/ }),
/* 826 */
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VISIT_EVENT = void 0;
exports.VISIT_EVENT = {
    SEND_VISIT_PRODUCT_LIST: 'SEND_VISIT_PRODUCT_LIST',
    REFUND_VISIT_PRODUCT_LIST: 'REFUND_VISIT_PRODUCT_LIST',
};


/***/ }),
/* 827 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var VisitEventListener_1;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.VisitEventListener = void 0;
const common_1 = __webpack_require__(3);
const event_emitter_1 = __webpack_require__(824);
const visit_event_constants_1 = __webpack_require__(826);
let VisitEventListener = VisitEventListener_1 = class VisitEventListener {
    constructor() {
        this.logger = new common_1.Logger(VisitEventListener_1.name);
    }
    async listenSendProductList(payload) {
    }
    async listenRefundProductList(payload) {
    }
};
exports.VisitEventListener = VisitEventListener;
__decorate([
    (0, event_emitter_1.OnEvent)(visit_event_constants_1.VISIT_EVENT.SEND_VISIT_PRODUCT_LIST),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], VisitEventListener.prototype, "listenSendProductList", null);
__decorate([
    (0, event_emitter_1.OnEvent)(visit_event_constants_1.VISIT_EVENT.REFUND_VISIT_PRODUCT_LIST),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], VisitEventListener.prototype, "listenRefundProductList", null);
exports.VisitEventListener = VisitEventListener = VisitEventListener_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], VisitEventListener);


/***/ }),
/* 828 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketModule = void 0;
const common_1 = __webpack_require__(3);
const jwt_extend_module_1 = __webpack_require__(158);
const socket_emit_service_1 = __webpack_require__(340);
const socket_controller_1 = __webpack_require__(829);
const socket_gateway_1 = __webpack_require__(830);
let SocketModule = class SocketModule {
};
exports.SocketModule = SocketModule;
exports.SocketModule = SocketModule = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [jwt_extend_module_1.JwtExtendModule],
        controllers: [socket_controller_1.SocketController],
        providers: [socket_gateway_1.SocketGateway, socket_emit_service_1.SocketEmitService],
        exports: [socket_emit_service_1.SocketEmitService],
    })
], SocketModule);


/***/ }),
/* 829 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketController = void 0;
const common_1 = __webpack_require__(3);
const swagger_1 = __webpack_require__(6);
const external_request_1 = __webpack_require__(237);
const socket_emit_service_1 = __webpack_require__(340);
let SocketController = class SocketController {
    constructor(socketEmitService) {
        this.socketEmitService = socketEmitService;
    }
    async serverEmitDemo({ oid }) {
        this.socketEmitService.demo(oid);
    }
};
exports.SocketController = SocketController;
__decorate([
    (0, common_1.Get)('server-emit-demo'),
    __param(0, (0, external_request_1.External)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof external_request_1.TExternal !== "undefined" && external_request_1.TExternal) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], SocketController.prototype, "serverEmitDemo", null);
exports.SocketController = SocketController = __decorate([
    (0, common_1.Controller)('socket'),
    (0, swagger_1.ApiTags)('Socket'),
    (0, swagger_1.ApiBearerAuth)('access-token'),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object])
], SocketController);


/***/ }),
/* 830 */
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var SocketGateway_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SocketGateway = void 0;
const common_1 = __webpack_require__(3);
const websockets_1 = __webpack_require__(831);
const request_ip_1 = __webpack_require__(8);
const socket_io_1 = __webpack_require__(832);
const cache_data_service_1 = __webpack_require__(40);
const jwt_extend_service_1 = __webpack_require__(160);
const socket_emit_service_1 = __webpack_require__(340);
const socket_variable_1 = __webpack_require__(341);
let SocketGateway = SocketGateway_1 = class SocketGateway {
    constructor(socketEmitService, jwtExtendService, cacheDataService) {
        this.socketEmitService = socketEmitService;
        this.jwtExtendService = jwtExtendService;
        this.cacheDataService = cacheDataService;
        this.logger = new common_1.Logger(SocketGateway_1.name);
        this.connections = {};
    }
    afterInit(io) {
        this.socketEmitService.io = io;
        this.socketEmitService.connections = this.connections;
        this.logger.debug('🚀 ===== [SOCKET] SocketGateway Init =====');
    }
    async handleConnection(socket, ...args) {
        var _a;
        const { token } = socket.handshake.auth;
        const ip = (0, request_ip_1.getClientIp)(socket.client.request);
        try {
            if (!token) {
                throw new Error('error.Token.Empty');
            }
            const jwtPayloadRefresh = this.jwtExtendService.verifyRefreshToken(token, ip);
            const { uid, oid } = jwtPayloadRefresh.data;
            socket.data.user = await this.cacheDataService.getUser(oid, uid);
            socket.join(oid.toString());
            (_a = this.connections)[uid] || (_a[uid] = []);
            this.connections[uid].push({
                socketId: socket.id,
                refreshExp: jwtPayloadRefresh.exp,
            });
            this.logger.debug(`[OID=${oid}] UserId ${uid} with IP ${ip}, `
                + `socketId ${socket.id} connected, join room ${oid}`);
        }
        catch (error) {
            this.logger.warn(`IP ${ip} with SocketId ${socket.id} has invalid token. ERROR: ${error.message}`);
            socket.disconnect();
        }
    }
    async handleDisconnect(socket) {
        var _a, _b, _c;
        const oid = (_a = socket.data.user) === null || _a === void 0 ? void 0 : _a.oid;
        const uid = (_b = socket.data.user) === null || _b === void 0 ? void 0 : _b.id;
        this.connections[uid] = (_c = this.connections[uid]) === null || _c === void 0 ? void 0 : _c.filter((i) => i.socketId !== socket.id);
        this.logger.debug(`[OID=${oid}] UserId ${uid} with socketId ${socket.id} disconnected`);
    }
    async clientEmitVisitCreate(socket, data) {
        this.io
            .in(socket.data.user.oid.toString())
            .emit(socket_variable_1.SOCKET_EVENT.SERVER_EMIT_TICKET_CREATE, `${data}, ${new Date().toISOString()}`);
        return new Date().toISOString();
    }
};
exports.SocketGateway = SocketGateway;
__decorate([
    (0, websockets_1.WebSocketServer)(),
    __metadata("design:type", typeof (_d = typeof socket_io_1.Server !== "undefined" && socket_io_1.Server) === "function" ? _d : Object)
], SocketGateway.prototype, "io", void 0);
__decorate([
    (0, websockets_1.SubscribeMessage)(socket_variable_1.SOCKET_EVENT.CLIENT_EMIT_TICKET_CREATE),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _e : Object, Object]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], SocketGateway.prototype, "clientEmitVisitCreate", null);
exports.SocketGateway = SocketGateway = SocketGateway_1 = __decorate([
    (0, websockets_1.WebSocketGateway)({ cors: { origin: '*' }, transports: ['websocket'] }),
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof socket_emit_service_1.SocketEmitService !== "undefined" && socket_emit_service_1.SocketEmitService) === "function" ? _a : Object, typeof (_b = typeof jwt_extend_service_1.JwtExtendService !== "undefined" && jwt_extend_service_1.JwtExtendService) === "function" ? _b : Object, typeof (_c = typeof cache_data_service_1.CacheDataService !== "undefined" && cache_data_service_1.CacheDataService) === "function" ? _c : Object])
], SocketGateway);


/***/ }),
/* 831 */
/***/ ((module) => {

module.exports = require("@nestjs/websockets");

/***/ }),
/* 832 */
/***/ ((module) => {

module.exports = require("socket.io");

/***/ })
/******/ 	]);
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
var exports = __webpack_exports__;

Object.defineProperty(exports, "__esModule", ({ value: true }));
const cors_1 = __webpack_require__(1);
const helmet_1 = __webpack_require__(2);
const common_1 = __webpack_require__(3);
const core_1 = __webpack_require__(4);
const platform_fastify_1 = __webpack_require__(5);
const swagger_1 = __webpack_require__(6);
const fastify_multer_1 = __webpack_require__(7);
const requestIp = __webpack_require__(8);
const exception_filter_1 = __webpack_require__(9);
const root_guard_1 = __webpack_require__(15);
const access_log_interceptor_1 = __webpack_require__(26);
const timeout_interceptor_1 = __webpack_require__(28);
const transform_response_interceptor_1 = __webpack_require__(29);
const environments_1 = __webpack_require__(30);
const app_module_1 = __webpack_require__(32);
async function bootstrap() {
    const logger = new common_1.Logger('bootstrap');
    const fastifyAdapter = new platform_fastify_1.FastifyAdapter();
    const app = await core_1.NestFactory.create(app_module_1.AppModule, fastifyAdapter, {
        logger: ['error', 'warn', 'log', 'debug'],
    });
    app.register(cors_1.default, { origin: '*' });
    app.register(fastify_multer_1.contentParser);
    await app.register(helmet_1.default, {
        contentSecurityPolicy: false,
    });
    app.use(requestIp.mw());
    app.useGlobalInterceptors(new access_log_interceptor_1.AccessLogInterceptor(), new timeout_interceptor_1.TimeoutInterceptor(), new transform_response_interceptor_1.TransformResponseInterceptor(), new common_1.ClassSerializerInterceptor(app.get(core_1.Reflector), {
        excludeExtraneousValues: true,
        exposeUnsetFields: false,
    }));
    app.useGlobalFilters(new exception_filter_1.ServerExceptionFilter());
    app.useGlobalGuards(new root_guard_1.RootGuard(app.get(core_1.Reflector)));
    app.useGlobalPipes(new common_1.ValidationPipe({
        validationError: { target: false, value: false },
        skipMissingProperties: true,
        whitelist: true,
        forbidNonWhitelisted: true,
        transform: true,
        transformOptions: {
            excludeExtraneousValues: false,
            exposeUnsetFields: false,
        },
        exceptionFactory: (errors = []) => new exception_filter_1.ValidationException(errors),
    }));
    const { NODE_VERSION, NODE_ENV, API_PUBLIC_HOST, API_PUBLIC_PORT, SQL_TYPE, SQL_HOST, SQL_PORT, SQL_DATABASE, } = (0, environments_1.GlobalConfig)();
    if (NODE_ENV !== 'production') {
        const config = new swagger_1.DocumentBuilder()
            .setTitle('Simple API')
            .setDescription('MEA API use Swagger')
            .setVersion('1.0')
            .addBearerAuth({ type: 'http', description: 'Access token' }, 'access-token')
            .build();
        const document = swagger_1.SwaggerModule.createDocument(app, config);
        swagger_1.SwaggerModule.setup('documents', app, document, {
            swaggerOptions: { persistAuthorization: true },
        });
    }
    await app.listen(API_PUBLIC_PORT, '0.0.0.0', () => {
        logger.debug(`🚀 ===== [API] Server document: http://${API_PUBLIC_HOST}:${API_PUBLIC_PORT}/documents/ =====`);
        logger.debug(`🚀 ===== [SQL] Database: jdbc:${SQL_TYPE}://${SQL_HOST}:${SQL_PORT}/${SQL_DATABASE} =====`);
        logger.debug(`🚀 ===== [TIME] ${new Date().toLocaleString()}, TimezoneOffset ${new Date().getTimezoneOffset()} =====`);
        logger.debug(`🚀 ===== [NODE] NodeJS version: ${NODE_VERSION} =====`);
    });
}
bootstrap();

})();

/******/ })()
;